{"version":3,"file":"worker-entry-CJJEx_P-.js","sources":["../../../../node_modules/.pnpm/yaml@2.8.1/node_modules/yaml/browser/dist/nodes/identity.js","../../../../node_modules/.pnpm/yaml@2.8.1/node_modules/yaml/browser/dist/visit.js","../../../../node_modules/.pnpm/yaml@2.8.1/node_modules/yaml/browser/dist/doc/directives.js","../../../../node_modules/.pnpm/yaml@2.8.1/node_modules/yaml/browser/dist/doc/anchors.js","../../../../node_modules/.pnpm/yaml@2.8.1/node_modules/yaml/browser/dist/doc/applyReviver.js","../../../../node_modules/.pnpm/yaml@2.8.1/node_modules/yaml/browser/dist/nodes/toJS.js","../../../../node_modules/.pnpm/yaml@2.8.1/node_modules/yaml/browser/dist/nodes/Node.js","../../../../node_modules/.pnpm/yaml@2.8.1/node_modules/yaml/browser/dist/nodes/Alias.js","../../../../node_modules/.pnpm/yaml@2.8.1/node_modules/yaml/browser/dist/nodes/Scalar.js","../../../../node_modules/.pnpm/yaml@2.8.1/node_modules/yaml/browser/dist/doc/createNode.js","../../../../node_modules/.pnpm/yaml@2.8.1/node_modules/yaml/browser/dist/nodes/Collection.js","../../../../node_modules/.pnpm/yaml@2.8.1/node_modules/yaml/browser/dist/stringify/stringifyComment.js","../../../../node_modules/.pnpm/yaml@2.8.1/node_modules/yaml/browser/dist/stringify/foldFlowLines.js","../../../../node_modules/.pnpm/yaml@2.8.1/node_modules/yaml/browser/dist/stringify/stringifyString.js","../../../../node_modules/.pnpm/yaml@2.8.1/node_modules/yaml/browser/dist/stringify/stringify.js","../../../../node_modules/.pnpm/yaml@2.8.1/node_modules/yaml/browser/dist/stringify/stringifyPair.js","../../../../node_modules/.pnpm/yaml@2.8.1/node_modules/yaml/browser/dist/log.js","../../../../node_modules/.pnpm/yaml@2.8.1/node_modules/yaml/browser/dist/schema/yaml-1.1/merge.js","../../../../node_modules/.pnpm/yaml@2.8.1/node_modules/yaml/browser/dist/nodes/addPairToJSMap.js","../../../../node_modules/.pnpm/yaml@2.8.1/node_modules/yaml/browser/dist/nodes/Pair.js","../../../../node_modules/.pnpm/yaml@2.8.1/node_modules/yaml/browser/dist/stringify/stringifyCollection.js","../../../../node_modules/.pnpm/yaml@2.8.1/node_modules/yaml/browser/dist/nodes/YAMLMap.js","../../../../node_modules/.pnpm/yaml@2.8.1/node_modules/yaml/browser/dist/schema/common/map.js","../../../../node_modules/.pnpm/yaml@2.8.1/node_modules/yaml/browser/dist/nodes/YAMLSeq.js","../../../../node_modules/.pnpm/yaml@2.8.1/node_modules/yaml/browser/dist/schema/common/seq.js","../../../../node_modules/.pnpm/yaml@2.8.1/node_modules/yaml/browser/dist/schema/common/string.js","../../../../node_modules/.pnpm/yaml@2.8.1/node_modules/yaml/browser/dist/schema/common/null.js","../../../../node_modules/.pnpm/yaml@2.8.1/node_modules/yaml/browser/dist/schema/core/bool.js","../../../../node_modules/.pnpm/yaml@2.8.1/node_modules/yaml/browser/dist/stringify/stringifyNumber.js","../../../../node_modules/.pnpm/yaml@2.8.1/node_modules/yaml/browser/dist/schema/core/float.js","../../../../node_modules/.pnpm/yaml@2.8.1/node_modules/yaml/browser/dist/schema/core/int.js","../../../../node_modules/.pnpm/yaml@2.8.1/node_modules/yaml/browser/dist/schema/core/schema.js","../../../../node_modules/.pnpm/yaml@2.8.1/node_modules/yaml/browser/dist/schema/json/schema.js","../../../../node_modules/.pnpm/yaml@2.8.1/node_modules/yaml/browser/dist/schema/yaml-1.1/binary.js","../../../../node_modules/.pnpm/yaml@2.8.1/node_modules/yaml/browser/dist/schema/yaml-1.1/pairs.js","../../../../node_modules/.pnpm/yaml@2.8.1/node_modules/yaml/browser/dist/schema/yaml-1.1/omap.js","../../../../node_modules/.pnpm/yaml@2.8.1/node_modules/yaml/browser/dist/schema/yaml-1.1/bool.js","../../../../node_modules/.pnpm/yaml@2.8.1/node_modules/yaml/browser/dist/schema/yaml-1.1/float.js","../../../../node_modules/.pnpm/yaml@2.8.1/node_modules/yaml/browser/dist/schema/yaml-1.1/int.js","../../../../node_modules/.pnpm/yaml@2.8.1/node_modules/yaml/browser/dist/schema/yaml-1.1/set.js","../../../../node_modules/.pnpm/yaml@2.8.1/node_modules/yaml/browser/dist/schema/yaml-1.1/timestamp.js","../../../../node_modules/.pnpm/yaml@2.8.1/node_modules/yaml/browser/dist/schema/yaml-1.1/schema.js","../../../../node_modules/.pnpm/yaml@2.8.1/node_modules/yaml/browser/dist/schema/tags.js","../../../../node_modules/.pnpm/yaml@2.8.1/node_modules/yaml/browser/dist/schema/Schema.js","../../../../node_modules/.pnpm/yaml@2.8.1/node_modules/yaml/browser/dist/stringify/stringifyDocument.js","../../../../node_modules/.pnpm/yaml@2.8.1/node_modules/yaml/browser/dist/doc/Document.js","../../../../node_modules/.pnpm/yaml@2.8.1/node_modules/yaml/browser/dist/errors.js","../../../../node_modules/.pnpm/yaml@2.8.1/node_modules/yaml/browser/dist/compose/resolve-props.js","../../../../node_modules/.pnpm/yaml@2.8.1/node_modules/yaml/browser/dist/compose/util-contains-newline.js","../../../../node_modules/.pnpm/yaml@2.8.1/node_modules/yaml/browser/dist/compose/util-flow-indent-check.js","../../../../node_modules/.pnpm/yaml@2.8.1/node_modules/yaml/browser/dist/compose/util-map-includes.js","../../../../node_modules/.pnpm/yaml@2.8.1/node_modules/yaml/browser/dist/compose/resolve-block-map.js","../../../../node_modules/.pnpm/yaml@2.8.1/node_modules/yaml/browser/dist/compose/resolve-block-seq.js","../../../../node_modules/.pnpm/yaml@2.8.1/node_modules/yaml/browser/dist/compose/resolve-end.js","../../../../node_modules/.pnpm/yaml@2.8.1/node_modules/yaml/browser/dist/compose/resolve-flow-collection.js","../../../../node_modules/.pnpm/yaml@2.8.1/node_modules/yaml/browser/dist/compose/compose-collection.js","../../../../node_modules/.pnpm/yaml@2.8.1/node_modules/yaml/browser/dist/compose/resolve-block-scalar.js","../../../../node_modules/.pnpm/yaml@2.8.1/node_modules/yaml/browser/dist/compose/resolve-flow-scalar.js","../../../../node_modules/.pnpm/yaml@2.8.1/node_modules/yaml/browser/dist/compose/compose-scalar.js","../../../../node_modules/.pnpm/yaml@2.8.1/node_modules/yaml/browser/dist/compose/util-empty-scalar-position.js","../../../../node_modules/.pnpm/yaml@2.8.1/node_modules/yaml/browser/dist/compose/compose-node.js","../../../../node_modules/.pnpm/yaml@2.8.1/node_modules/yaml/browser/dist/compose/compose-doc.js","../../../../node_modules/.pnpm/yaml@2.8.1/node_modules/yaml/browser/dist/compose/composer.js","../../../../node_modules/.pnpm/yaml@2.8.1/node_modules/yaml/browser/dist/parse/cst.js","../../../../node_modules/.pnpm/yaml@2.8.1/node_modules/yaml/browser/dist/parse/lexer.js","../../../../node_modules/.pnpm/yaml@2.8.1/node_modules/yaml/browser/dist/parse/line-counter.js","../../../../node_modules/.pnpm/yaml@2.8.1/node_modules/yaml/browser/dist/parse/parser.js","../../../../node_modules/.pnpm/yaml@2.8.1/node_modules/yaml/browser/dist/public-api.js","../../../../node_modules/.pnpm/zod@3.25.76/node_modules/zod/v3/helpers/util.js","../../../../node_modules/.pnpm/zod@3.25.76/node_modules/zod/v3/ZodError.js","../../../../node_modules/.pnpm/zod@3.25.76/node_modules/zod/v3/locales/en.js","../../../../node_modules/.pnpm/zod@3.25.76/node_modules/zod/v3/errors.js","../../../../node_modules/.pnpm/zod@3.25.76/node_modules/zod/v3/helpers/parseUtil.js","../../../../node_modules/.pnpm/zod@3.25.76/node_modules/zod/v3/helpers/errorUtil.js","../../../../node_modules/.pnpm/zod@3.25.76/node_modules/zod/v3/types.js","../../src/runtime/interpolation/filters.ts","../../src/runtime/interpolation/resolver.ts","../../src/runtime/interpolation/interpolator.ts","../../src/types/operation.ts","../../src/types/constants.ts","../../src/runtime/output-types.ts","../../src/observability/types.ts","../../src/observability/logger.ts","../../src/types/branded.ts","../../src/observability/context.ts","../../src/primitives/ensemble.ts","../../src/runtime/parser.ts","../../src/runtime/flow-types.ts","../../src/types/result.ts","../../src/errors/error-types.ts","../../src/runtime/graph-executor.ts","../../src/runtime/state-manager.ts","../../src/utils/safe-fetch.ts","../../src/agents/base-agent.ts","../../src/agents/function-agent.ts","../../src/utils/script-loader.ts","../../src/agents/code-agent.ts","../../src/agents/think-providers/base-provider.ts","../../src/agents/think-providers/openai-provider.ts","../../src/agents/think-providers/anthropic-provider.ts","../../src/agents/think-providers/cloudflare-provider.ts","../../src/agents/think-providers/custom-provider.ts","../../src/agents/think-providers/registry.ts","../../src/utils/component-resolver.ts","../../src/utils/templates/engines/base.ts","../../src/utils/templates/engines/simple.ts","../../../../node_modules/.pnpm/liquidjs@10.24.0/node_modules/liquidjs/dist/liquid.browser.mjs","../../src/utils/templates/engines/liquid.ts","../../src/agents/think-agent.ts","../../src/storage/repository.ts","../../src/storage/kv-repository.ts","../../src/storage/d1-repository.ts","../../src/storage/r2-repository.ts","../../src/storage/hyperdrive-repository.ts","../../src/config/constants.ts","../../src/storage/query-cache.ts","../../src/agents/storage-agent.ts","../../src/agents/data/export-formats.ts","../../src/agents/data-agent.ts","../../src/agents/api-agent.ts","../../src/agents/email/providers/base.ts","../../src/agents/email/providers/cloudflare.ts","../../src/agents/email/providers/resend.ts","../../src/agents/email/providers/smtp.ts","../../src/agents/email/providers/index.ts","../../../../node_modules/.pnpm/handlebars@4.7.8/node_modules/handlebars/dist/handlebars.runtime.js","../../src/utils/templates/engines/handlebars.ts","../../src/utils/templates/engines/index.ts","../../src/agents/email/template-loader.ts","../../src/agents/email/email-agent.ts","../../src/agents/sms/providers/base.ts","../../src/agents/sms/providers/twilio.ts","../../src/agents/sms/providers/index.ts","../../src/agents/sms/sms-agent.ts","../../src/agents/form/utils/validation.ts","../../src/agents/form/utils/renderer.ts","../../src/agents/form/utils/csrf.ts","../../src/agents/form/utils/rate-limit.ts","../../src/agents/form/form-agent.ts","../../src/agents/html/utils/template-loader.ts","../../src/runtime/component-loader.ts","../../src/agents/html/utils/cookies.ts","../../src/agents/html/html-agent.ts","../../src/agents/pdf/utils/pdf-generator.ts","../../src/agents/pdf/utils/storage.ts","../../src/agents/pdf/pdf-agent.ts","../../src/agents/built-in/registry.ts","../../src/runtime/scoring/scoring-executor.ts","../../src/runtime/scoring/ensemble-scorer.ts","../../src/runtime/notifications/webhook-notifier.ts","../../src/runtime/notifications/email-notifier.ts","../../src/runtime/notifications/notification-manager.ts","../../src/components/schemas.ts","../../src/components/prompts.ts","../../src/components/configs.ts","../../src/components/queries.ts","../../src/components/scripts.ts","../../src/components/templates.ts","../../src/components/registry.ts","../../src/components/discovery.ts","../../src/runtime/output-resolver.ts","../../src/runtime/memory/working-memory.ts","../../src/runtime/memory/session-memory.ts","../../src/runtime/memory/long-term-memory.ts","../../src/runtime/memory/semantic-memory.ts","../../src/runtime/memory/analytical-memory.ts","../../src/runtime/memory/memory-manager.ts","../../src/runtime/executor.ts","../../src/runtime/plugin-registry.ts","../../src/runtime/trigger-registry.ts","../../src/runtime/http-middleware-registry.ts","../../src/agents/queue/queue-agent.ts","../../src/utils/loader.ts","../../src/utils/ensemble-loader.ts","../../../../node_modules/.pnpm/jose@6.1.2/node_modules/jose/dist/webapi/lib/buffer_utils.js","../../../../node_modules/.pnpm/jose@6.1.2/node_modules/jose/dist/webapi/lib/base64.js","../../../../node_modules/.pnpm/jose@6.1.2/node_modules/jose/dist/webapi/util/base64url.js","../../../../node_modules/.pnpm/jose@6.1.2/node_modules/jose/dist/webapi/util/errors.js","../../../../node_modules/.pnpm/jose@6.1.2/node_modules/jose/dist/webapi/lib/crypto_key.js","../../../../node_modules/.pnpm/jose@6.1.2/node_modules/jose/dist/webapi/lib/invalid_key_input.js","../../../../node_modules/.pnpm/jose@6.1.2/node_modules/jose/dist/webapi/lib/is_key_like.js","../../../../node_modules/.pnpm/jose@6.1.2/node_modules/jose/dist/webapi/lib/is_disjoint.js","../../../../node_modules/.pnpm/jose@6.1.2/node_modules/jose/dist/webapi/lib/is_object.js","../../../../node_modules/.pnpm/jose@6.1.2/node_modules/jose/dist/webapi/lib/check_key_length.js","../../../../node_modules/.pnpm/jose@6.1.2/node_modules/jose/dist/webapi/lib/jwk_to_key.js","../../../../node_modules/.pnpm/jose@6.1.2/node_modules/jose/dist/webapi/key/import.js","../../../../node_modules/.pnpm/jose@6.1.2/node_modules/jose/dist/webapi/lib/validate_crit.js","../../../../node_modules/.pnpm/jose@6.1.2/node_modules/jose/dist/webapi/lib/validate_algorithms.js","../../../../node_modules/.pnpm/jose@6.1.2/node_modules/jose/dist/webapi/lib/is_jwk.js","../../../../node_modules/.pnpm/jose@6.1.2/node_modules/jose/dist/webapi/lib/normalize_key.js","../../../../node_modules/.pnpm/jose@6.1.2/node_modules/jose/dist/webapi/lib/check_key_type.js","../../../../node_modules/.pnpm/jose@6.1.2/node_modules/jose/dist/webapi/lib/subtle_dsa.js","../../../../node_modules/.pnpm/jose@6.1.2/node_modules/jose/dist/webapi/lib/get_sign_verify_key.js","../../../../node_modules/.pnpm/jose@6.1.2/node_modules/jose/dist/webapi/lib/verify.js","../../../../node_modules/.pnpm/jose@6.1.2/node_modules/jose/dist/webapi/jws/flattened/verify.js","../../../../node_modules/.pnpm/jose@6.1.2/node_modules/jose/dist/webapi/jws/compact/verify.js","../../../../node_modules/.pnpm/jose@6.1.2/node_modules/jose/dist/webapi/lib/jwt_claims_set.js","../../../../node_modules/.pnpm/jose@6.1.2/node_modules/jose/dist/webapi/jwt/verify.js","../../../../node_modules/.pnpm/jose@6.1.2/node_modules/jose/dist/webapi/jwks/local.js","../../../../node_modules/.pnpm/jose@6.1.2/node_modules/jose/dist/webapi/jwks/remote.js","../../src/auth/providers/bearer.ts","../../src/auth/providers/apikey.ts","../../src/auth/providers/cookie.ts","../../src/auth/providers/unkey.ts","../../src/auth/providers/custom.ts","../../src/auth/utils/crypto.ts","../../src/auth/providers/signature.ts","../../src/auth/providers/basic.ts","../../src/auth/trigger-auth.ts","../../src/auth/permissions.ts","../../src/routing/router.ts","../../src/runtime/build-manager.ts","../../src/runtime/cli-manager.ts","../../src/types/plugin.ts","../../src/docs/docs-manager.ts","../../src/docs/loader.ts","../../src/primitives/step.ts","../../src/primitives/flow.ts","../../src/primitives/tool.ts","../../src/primitives/instruction.ts","../../src/primitives/memory.ts","../../src/primitives/reference.ts","../../src/primitives/async.ts","../../src/index.ts"],"sourcesContent":["const ALIAS = Symbol.for('yaml.alias');\nconst DOC = Symbol.for('yaml.document');\nconst MAP = Symbol.for('yaml.map');\nconst PAIR = Symbol.for('yaml.pair');\nconst SCALAR = Symbol.for('yaml.scalar');\nconst SEQ = Symbol.for('yaml.seq');\nconst NODE_TYPE = Symbol.for('yaml.node.type');\nconst isAlias = (node) => !!node && typeof node === 'object' && node[NODE_TYPE] === ALIAS;\nconst isDocument = (node) => !!node && typeof node === 'object' && node[NODE_TYPE] === DOC;\nconst isMap = (node) => !!node && typeof node === 'object' && node[NODE_TYPE] === MAP;\nconst isPair = (node) => !!node && typeof node === 'object' && node[NODE_TYPE] === PAIR;\nconst isScalar = (node) => !!node && typeof node === 'object' && node[NODE_TYPE] === SCALAR;\nconst isSeq = (node) => !!node && typeof node === 'object' && node[NODE_TYPE] === SEQ;\nfunction isCollection(node) {\n    if (node && typeof node === 'object')\n        switch (node[NODE_TYPE]) {\n            case MAP:\n            case SEQ:\n                return true;\n        }\n    return false;\n}\nfunction isNode(node) {\n    if (node && typeof node === 'object')\n        switch (node[NODE_TYPE]) {\n            case ALIAS:\n            case MAP:\n            case SCALAR:\n            case SEQ:\n                return true;\n        }\n    return false;\n}\nconst hasAnchor = (node) => (isScalar(node) || isCollection(node)) && !!node.anchor;\n\nexport { ALIAS, DOC, MAP, NODE_TYPE, PAIR, SCALAR, SEQ, hasAnchor, isAlias, isCollection, isDocument, isMap, isNode, isPair, isScalar, isSeq };\n","import { isDocument, isNode, isPair, isCollection, isMap, isSeq, isScalar, isAlias } from './nodes/identity.js';\n\nconst BREAK = Symbol('break visit');\nconst SKIP = Symbol('skip children');\nconst REMOVE = Symbol('remove node');\n/**\n * Apply a visitor to an AST node or document.\n *\n * Walks through the tree (depth-first) starting from `node`, calling a\n * `visitor` function with three arguments:\n *   - `key`: For sequence values and map `Pair`, the node's index in the\n *     collection. Within a `Pair`, `'key'` or `'value'`, correspondingly.\n *     `null` for the root node.\n *   - `node`: The current node.\n *   - `path`: The ancestry of the current node.\n *\n * The return value of the visitor may be used to control the traversal:\n *   - `undefined` (default): Do nothing and continue\n *   - `visit.SKIP`: Do not visit the children of this node, continue with next\n *     sibling\n *   - `visit.BREAK`: Terminate traversal completely\n *   - `visit.REMOVE`: Remove the current node, then continue with the next one\n *   - `Node`: Replace the current node, then continue by visiting it\n *   - `number`: While iterating the items of a sequence or map, set the index\n *     of the next step. This is useful especially if the index of the current\n *     node has changed.\n *\n * If `visitor` is a single function, it will be called with all values\n * encountered in the tree, including e.g. `null` values. Alternatively,\n * separate visitor functions may be defined for each `Map`, `Pair`, `Seq`,\n * `Alias` and `Scalar` node. To define the same visitor function for more than\n * one node type, use the `Collection` (map and seq), `Value` (map, seq & scalar)\n * and `Node` (alias, map, seq & scalar) targets. Of all these, only the most\n * specific defined one will be used for each node.\n */\nfunction visit(node, visitor) {\n    const visitor_ = initVisitor(visitor);\n    if (isDocument(node)) {\n        const cd = visit_(null, node.contents, visitor_, Object.freeze([node]));\n        if (cd === REMOVE)\n            node.contents = null;\n    }\n    else\n        visit_(null, node, visitor_, Object.freeze([]));\n}\n// Without the `as symbol` casts, TS declares these in the `visit`\n// namespace using `var`, but then complains about that because\n// `unique symbol` must be `const`.\n/** Terminate visit traversal completely */\nvisit.BREAK = BREAK;\n/** Do not visit the children of the current node */\nvisit.SKIP = SKIP;\n/** Remove the current node */\nvisit.REMOVE = REMOVE;\nfunction visit_(key, node, visitor, path) {\n    const ctrl = callVisitor(key, node, visitor, path);\n    if (isNode(ctrl) || isPair(ctrl)) {\n        replaceNode(key, path, ctrl);\n        return visit_(key, ctrl, visitor, path);\n    }\n    if (typeof ctrl !== 'symbol') {\n        if (isCollection(node)) {\n            path = Object.freeze(path.concat(node));\n            for (let i = 0; i < node.items.length; ++i) {\n                const ci = visit_(i, node.items[i], visitor, path);\n                if (typeof ci === 'number')\n                    i = ci - 1;\n                else if (ci === BREAK)\n                    return BREAK;\n                else if (ci === REMOVE) {\n                    node.items.splice(i, 1);\n                    i -= 1;\n                }\n            }\n        }\n        else if (isPair(node)) {\n            path = Object.freeze(path.concat(node));\n            const ck = visit_('key', node.key, visitor, path);\n            if (ck === BREAK)\n                return BREAK;\n            else if (ck === REMOVE)\n                node.key = null;\n            const cv = visit_('value', node.value, visitor, path);\n            if (cv === BREAK)\n                return BREAK;\n            else if (cv === REMOVE)\n                node.value = null;\n        }\n    }\n    return ctrl;\n}\n/**\n * Apply an async visitor to an AST node or document.\n *\n * Walks through the tree (depth-first) starting from `node`, calling a\n * `visitor` function with three arguments:\n *   - `key`: For sequence values and map `Pair`, the node's index in the\n *     collection. Within a `Pair`, `'key'` or `'value'`, correspondingly.\n *     `null` for the root node.\n *   - `node`: The current node.\n *   - `path`: The ancestry of the current node.\n *\n * The return value of the visitor may be used to control the traversal:\n *   - `Promise`: Must resolve to one of the following values\n *   - `undefined` (default): Do nothing and continue\n *   - `visit.SKIP`: Do not visit the children of this node, continue with next\n *     sibling\n *   - `visit.BREAK`: Terminate traversal completely\n *   - `visit.REMOVE`: Remove the current node, then continue with the next one\n *   - `Node`: Replace the current node, then continue by visiting it\n *   - `number`: While iterating the items of a sequence or map, set the index\n *     of the next step. This is useful especially if the index of the current\n *     node has changed.\n *\n * If `visitor` is a single function, it will be called with all values\n * encountered in the tree, including e.g. `null` values. Alternatively,\n * separate visitor functions may be defined for each `Map`, `Pair`, `Seq`,\n * `Alias` and `Scalar` node. To define the same visitor function for more than\n * one node type, use the `Collection` (map and seq), `Value` (map, seq & scalar)\n * and `Node` (alias, map, seq & scalar) targets. Of all these, only the most\n * specific defined one will be used for each node.\n */\nasync function visitAsync(node, visitor) {\n    const visitor_ = initVisitor(visitor);\n    if (isDocument(node)) {\n        const cd = await visitAsync_(null, node.contents, visitor_, Object.freeze([node]));\n        if (cd === REMOVE)\n            node.contents = null;\n    }\n    else\n        await visitAsync_(null, node, visitor_, Object.freeze([]));\n}\n// Without the `as symbol` casts, TS declares these in the `visit`\n// namespace using `var`, but then complains about that because\n// `unique symbol` must be `const`.\n/** Terminate visit traversal completely */\nvisitAsync.BREAK = BREAK;\n/** Do not visit the children of the current node */\nvisitAsync.SKIP = SKIP;\n/** Remove the current node */\nvisitAsync.REMOVE = REMOVE;\nasync function visitAsync_(key, node, visitor, path) {\n    const ctrl = await callVisitor(key, node, visitor, path);\n    if (isNode(ctrl) || isPair(ctrl)) {\n        replaceNode(key, path, ctrl);\n        return visitAsync_(key, ctrl, visitor, path);\n    }\n    if (typeof ctrl !== 'symbol') {\n        if (isCollection(node)) {\n            path = Object.freeze(path.concat(node));\n            for (let i = 0; i < node.items.length; ++i) {\n                const ci = await visitAsync_(i, node.items[i], visitor, path);\n                if (typeof ci === 'number')\n                    i = ci - 1;\n                else if (ci === BREAK)\n                    return BREAK;\n                else if (ci === REMOVE) {\n                    node.items.splice(i, 1);\n                    i -= 1;\n                }\n            }\n        }\n        else if (isPair(node)) {\n            path = Object.freeze(path.concat(node));\n            const ck = await visitAsync_('key', node.key, visitor, path);\n            if (ck === BREAK)\n                return BREAK;\n            else if (ck === REMOVE)\n                node.key = null;\n            const cv = await visitAsync_('value', node.value, visitor, path);\n            if (cv === BREAK)\n                return BREAK;\n            else if (cv === REMOVE)\n                node.value = null;\n        }\n    }\n    return ctrl;\n}\nfunction initVisitor(visitor) {\n    if (typeof visitor === 'object' &&\n        (visitor.Collection || visitor.Node || visitor.Value)) {\n        return Object.assign({\n            Alias: visitor.Node,\n            Map: visitor.Node,\n            Scalar: visitor.Node,\n            Seq: visitor.Node\n        }, visitor.Value && {\n            Map: visitor.Value,\n            Scalar: visitor.Value,\n            Seq: visitor.Value\n        }, visitor.Collection && {\n            Map: visitor.Collection,\n            Seq: visitor.Collection\n        }, visitor);\n    }\n    return visitor;\n}\nfunction callVisitor(key, node, visitor, path) {\n    if (typeof visitor === 'function')\n        return visitor(key, node, path);\n    if (isMap(node))\n        return visitor.Map?.(key, node, path);\n    if (isSeq(node))\n        return visitor.Seq?.(key, node, path);\n    if (isPair(node))\n        return visitor.Pair?.(key, node, path);\n    if (isScalar(node))\n        return visitor.Scalar?.(key, node, path);\n    if (isAlias(node))\n        return visitor.Alias?.(key, node, path);\n    return undefined;\n}\nfunction replaceNode(key, path, node) {\n    const parent = path[path.length - 1];\n    if (isCollection(parent)) {\n        parent.items[key] = node;\n    }\n    else if (isPair(parent)) {\n        if (key === 'key')\n            parent.key = node;\n        else\n            parent.value = node;\n    }\n    else if (isDocument(parent)) {\n        parent.contents = node;\n    }\n    else {\n        const pt = isAlias(parent) ? 'alias' : 'scalar';\n        throw new Error(`Cannot replace node with ${pt} parent`);\n    }\n}\n\nexport { visit, visitAsync };\n","import { isNode } from '../nodes/identity.js';\nimport { visit } from '../visit.js';\n\nconst escapeChars = {\n    '!': '%21',\n    ',': '%2C',\n    '[': '%5B',\n    ']': '%5D',\n    '{': '%7B',\n    '}': '%7D'\n};\nconst escapeTagName = (tn) => tn.replace(/[!,[\\]{}]/g, ch => escapeChars[ch]);\nclass Directives {\n    constructor(yaml, tags) {\n        /**\n         * The directives-end/doc-start marker `---`. If `null`, a marker may still be\n         * included in the document's stringified representation.\n         */\n        this.docStart = null;\n        /** The doc-end marker `...`.  */\n        this.docEnd = false;\n        this.yaml = Object.assign({}, Directives.defaultYaml, yaml);\n        this.tags = Object.assign({}, Directives.defaultTags, tags);\n    }\n    clone() {\n        const copy = new Directives(this.yaml, this.tags);\n        copy.docStart = this.docStart;\n        return copy;\n    }\n    /**\n     * During parsing, get a Directives instance for the current document and\n     * update the stream state according to the current version's spec.\n     */\n    atDocument() {\n        const res = new Directives(this.yaml, this.tags);\n        switch (this.yaml.version) {\n            case '1.1':\n                this.atNextDocument = true;\n                break;\n            case '1.2':\n                this.atNextDocument = false;\n                this.yaml = {\n                    explicit: Directives.defaultYaml.explicit,\n                    version: '1.2'\n                };\n                this.tags = Object.assign({}, Directives.defaultTags);\n                break;\n        }\n        return res;\n    }\n    /**\n     * @param onError - May be called even if the action was successful\n     * @returns `true` on success\n     */\n    add(line, onError) {\n        if (this.atNextDocument) {\n            this.yaml = { explicit: Directives.defaultYaml.explicit, version: '1.1' };\n            this.tags = Object.assign({}, Directives.defaultTags);\n            this.atNextDocument = false;\n        }\n        const parts = line.trim().split(/[ \\t]+/);\n        const name = parts.shift();\n        switch (name) {\n            case '%TAG': {\n                if (parts.length !== 2) {\n                    onError(0, '%TAG directive should contain exactly two parts');\n                    if (parts.length < 2)\n                        return false;\n                }\n                const [handle, prefix] = parts;\n                this.tags[handle] = prefix;\n                return true;\n            }\n            case '%YAML': {\n                this.yaml.explicit = true;\n                if (parts.length !== 1) {\n                    onError(0, '%YAML directive should contain exactly one part');\n                    return false;\n                }\n                const [version] = parts;\n                if (version === '1.1' || version === '1.2') {\n                    this.yaml.version = version;\n                    return true;\n                }\n                else {\n                    const isValid = /^\\d+\\.\\d+$/.test(version);\n                    onError(6, `Unsupported YAML version ${version}`, isValid);\n                    return false;\n                }\n            }\n            default:\n                onError(0, `Unknown directive ${name}`, true);\n                return false;\n        }\n    }\n    /**\n     * Resolves a tag, matching handles to those defined in %TAG directives.\n     *\n     * @returns Resolved tag, which may also be the non-specific tag `'!'` or a\n     *   `'!local'` tag, or `null` if unresolvable.\n     */\n    tagName(source, onError) {\n        if (source === '!')\n            return '!'; // non-specific tag\n        if (source[0] !== '!') {\n            onError(`Not a valid tag: ${source}`);\n            return null;\n        }\n        if (source[1] === '<') {\n            const verbatim = source.slice(2, -1);\n            if (verbatim === '!' || verbatim === '!!') {\n                onError(`Verbatim tags aren't resolved, so ${source} is invalid.`);\n                return null;\n            }\n            if (source[source.length - 1] !== '>')\n                onError('Verbatim tags must end with a >');\n            return verbatim;\n        }\n        const [, handle, suffix] = source.match(/^(.*!)([^!]*)$/s);\n        if (!suffix)\n            onError(`The ${source} tag has no suffix`);\n        const prefix = this.tags[handle];\n        if (prefix) {\n            try {\n                return prefix + decodeURIComponent(suffix);\n            }\n            catch (error) {\n                onError(String(error));\n                return null;\n            }\n        }\n        if (handle === '!')\n            return source; // local tag\n        onError(`Could not resolve tag: ${source}`);\n        return null;\n    }\n    /**\n     * Given a fully resolved tag, returns its printable string form,\n     * taking into account current tag prefixes and defaults.\n     */\n    tagString(tag) {\n        for (const [handle, prefix] of Object.entries(this.tags)) {\n            if (tag.startsWith(prefix))\n                return handle + escapeTagName(tag.substring(prefix.length));\n        }\n        return tag[0] === '!' ? tag : `!<${tag}>`;\n    }\n    toString(doc) {\n        const lines = this.yaml.explicit\n            ? [`%YAML ${this.yaml.version || '1.2'}`]\n            : [];\n        const tagEntries = Object.entries(this.tags);\n        let tagNames;\n        if (doc && tagEntries.length > 0 && isNode(doc.contents)) {\n            const tags = {};\n            visit(doc.contents, (_key, node) => {\n                if (isNode(node) && node.tag)\n                    tags[node.tag] = true;\n            });\n            tagNames = Object.keys(tags);\n        }\n        else\n            tagNames = [];\n        for (const [handle, prefix] of tagEntries) {\n            if (handle === '!!' && prefix === 'tag:yaml.org,2002:')\n                continue;\n            if (!doc || tagNames.some(tn => tn.startsWith(prefix)))\n                lines.push(`%TAG ${handle} ${prefix}`);\n        }\n        return lines.join('\\n');\n    }\n}\nDirectives.defaultYaml = { explicit: false, version: '1.2' };\nDirectives.defaultTags = { '!!': 'tag:yaml.org,2002:' };\n\nexport { Directives };\n","import { isScalar, isCollection } from '../nodes/identity.js';\nimport { visit } from '../visit.js';\n\n/**\n * Verify that the input string is a valid anchor.\n *\n * Will throw on errors.\n */\nfunction anchorIsValid(anchor) {\n    if (/[\\x00-\\x19\\s,[\\]{}]/.test(anchor)) {\n        const sa = JSON.stringify(anchor);\n        const msg = `Anchor must not contain whitespace or control characters: ${sa}`;\n        throw new Error(msg);\n    }\n    return true;\n}\nfunction anchorNames(root) {\n    const anchors = new Set();\n    visit(root, {\n        Value(_key, node) {\n            if (node.anchor)\n                anchors.add(node.anchor);\n        }\n    });\n    return anchors;\n}\n/** Find a new anchor name with the given `prefix` and a one-indexed suffix. */\nfunction findNewAnchor(prefix, exclude) {\n    for (let i = 1; true; ++i) {\n        const name = `${prefix}${i}`;\n        if (!exclude.has(name))\n            return name;\n    }\n}\nfunction createNodeAnchors(doc, prefix) {\n    const aliasObjects = [];\n    const sourceObjects = new Map();\n    let prevAnchors = null;\n    return {\n        onAnchor: (source) => {\n            aliasObjects.push(source);\n            prevAnchors ?? (prevAnchors = anchorNames(doc));\n            const anchor = findNewAnchor(prefix, prevAnchors);\n            prevAnchors.add(anchor);\n            return anchor;\n        },\n        /**\n         * With circular references, the source node is only resolved after all\n         * of its child nodes are. This is why anchors are set only after all of\n         * the nodes have been created.\n         */\n        setAnchors: () => {\n            for (const source of aliasObjects) {\n                const ref = sourceObjects.get(source);\n                if (typeof ref === 'object' &&\n                    ref.anchor &&\n                    (isScalar(ref.node) || isCollection(ref.node))) {\n                    ref.node.anchor = ref.anchor;\n                }\n                else {\n                    const error = new Error('Failed to resolve repeated object (this should not happen)');\n                    error.source = source;\n                    throw error;\n                }\n            }\n        },\n        sourceObjects\n    };\n}\n\nexport { anchorIsValid, anchorNames, createNodeAnchors, findNewAnchor };\n","/**\n * Applies the JSON.parse reviver algorithm as defined in the ECMA-262 spec,\n * in section 24.5.1.1 \"Runtime Semantics: InternalizeJSONProperty\" of the\n * 2021 edition: https://tc39.es/ecma262/#sec-json.parse\n *\n * Includes extensions for handling Map and Set objects.\n */\nfunction applyReviver(reviver, obj, key, val) {\n    if (val && typeof val === 'object') {\n        if (Array.isArray(val)) {\n            for (let i = 0, len = val.length; i < len; ++i) {\n                const v0 = val[i];\n                const v1 = applyReviver(reviver, val, String(i), v0);\n                // eslint-disable-next-line @typescript-eslint/no-array-delete\n                if (v1 === undefined)\n                    delete val[i];\n                else if (v1 !== v0)\n                    val[i] = v1;\n            }\n        }\n        else if (val instanceof Map) {\n            for (const k of Array.from(val.keys())) {\n                const v0 = val.get(k);\n                const v1 = applyReviver(reviver, val, k, v0);\n                if (v1 === undefined)\n                    val.delete(k);\n                else if (v1 !== v0)\n                    val.set(k, v1);\n            }\n        }\n        else if (val instanceof Set) {\n            for (const v0 of Array.from(val)) {\n                const v1 = applyReviver(reviver, val, v0, v0);\n                if (v1 === undefined)\n                    val.delete(v0);\n                else if (v1 !== v0) {\n                    val.delete(v0);\n                    val.add(v1);\n                }\n            }\n        }\n        else {\n            for (const [k, v0] of Object.entries(val)) {\n                const v1 = applyReviver(reviver, val, k, v0);\n                if (v1 === undefined)\n                    delete val[k];\n                else if (v1 !== v0)\n                    val[k] = v1;\n            }\n        }\n    }\n    return reviver.call(obj, key, val);\n}\n\nexport { applyReviver };\n","import { hasAnchor } from './identity.js';\n\n/**\n * Recursively convert any node or its contents to native JavaScript\n *\n * @param value - The input value\n * @param arg - If `value` defines a `toJSON()` method, use this\n *   as its first argument\n * @param ctx - Conversion context, originally set in Document#toJS(). If\n *   `{ keep: true }` is not set, output should be suitable for JSON\n *   stringification.\n */\nfunction toJS(value, arg, ctx) {\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n    if (Array.isArray(value))\n        return value.map((v, i) => toJS(v, String(i), ctx));\n    if (value && typeof value.toJSON === 'function') {\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-call\n        if (!ctx || !hasAnchor(value))\n            return value.toJSON(arg, ctx);\n        const data = { aliasCount: 0, count: 1, res: undefined };\n        ctx.anchors.set(value, data);\n        ctx.onCreate = res => {\n            data.res = res;\n            delete ctx.onCreate;\n        };\n        const res = value.toJSON(arg, ctx);\n        if (ctx.onCreate)\n            ctx.onCreate(res);\n        return res;\n    }\n    if (typeof value === 'bigint' && !ctx?.keep)\n        return Number(value);\n    return value;\n}\n\nexport { toJS };\n","import { applyReviver } from '../doc/applyReviver.js';\nimport { NODE_TYPE, isDocument } from './identity.js';\nimport { toJS } from './toJS.js';\n\nclass NodeBase {\n    constructor(type) {\n        Object.defineProperty(this, NODE_TYPE, { value: type });\n    }\n    /** Create a copy of this node.  */\n    clone() {\n        const copy = Object.create(Object.getPrototypeOf(this), Object.getOwnPropertyDescriptors(this));\n        if (this.range)\n            copy.range = this.range.slice();\n        return copy;\n    }\n    /** A plain JavaScript representation of this node. */\n    toJS(doc, { mapAsMap, maxAliasCount, onAnchor, reviver } = {}) {\n        if (!isDocument(doc))\n            throw new TypeError('A document argument is required');\n        const ctx = {\n            anchors: new Map(),\n            doc,\n            keep: true,\n            mapAsMap: mapAsMap === true,\n            mapKeyWarned: false,\n            maxAliasCount: typeof maxAliasCount === 'number' ? maxAliasCount : 100\n        };\n        const res = toJS(this, '', ctx);\n        if (typeof onAnchor === 'function')\n            for (const { count, res } of ctx.anchors.values())\n                onAnchor(res, count);\n        return typeof reviver === 'function'\n            ? applyReviver(reviver, { '': res }, '', res)\n            : res;\n    }\n}\n\nexport { NodeBase };\n","import { anchorIsValid } from '../doc/anchors.js';\nimport { visit } from '../visit.js';\nimport { ALIAS, isAlias, isCollection, isPair, hasAnchor } from './identity.js';\nimport { NodeBase } from './Node.js';\nimport { toJS } from './toJS.js';\n\nclass Alias extends NodeBase {\n    constructor(source) {\n        super(ALIAS);\n        this.source = source;\n        Object.defineProperty(this, 'tag', {\n            set() {\n                throw new Error('Alias nodes cannot have tags');\n            }\n        });\n    }\n    /**\n     * Resolve the value of this alias within `doc`, finding the last\n     * instance of the `source` anchor before this node.\n     */\n    resolve(doc, ctx) {\n        let nodes;\n        if (ctx?.aliasResolveCache) {\n            nodes = ctx.aliasResolveCache;\n        }\n        else {\n            nodes = [];\n            visit(doc, {\n                Node: (_key, node) => {\n                    if (isAlias(node) || hasAnchor(node))\n                        nodes.push(node);\n                }\n            });\n            if (ctx)\n                ctx.aliasResolveCache = nodes;\n        }\n        let found = undefined;\n        for (const node of nodes) {\n            if (node === this)\n                break;\n            if (node.anchor === this.source)\n                found = node;\n        }\n        return found;\n    }\n    toJSON(_arg, ctx) {\n        if (!ctx)\n            return { source: this.source };\n        const { anchors, doc, maxAliasCount } = ctx;\n        const source = this.resolve(doc, ctx);\n        if (!source) {\n            const msg = `Unresolved alias (the anchor must be set before the alias): ${this.source}`;\n            throw new ReferenceError(msg);\n        }\n        let data = anchors.get(source);\n        if (!data) {\n            // Resolve anchors for Node.prototype.toJS()\n            toJS(source, null, ctx);\n            data = anchors.get(source);\n        }\n        /* istanbul ignore if */\n        if (!data || data.res === undefined) {\n            const msg = 'This should not happen: Alias anchor was not resolved?';\n            throw new ReferenceError(msg);\n        }\n        if (maxAliasCount >= 0) {\n            data.count += 1;\n            if (data.aliasCount === 0)\n                data.aliasCount = getAliasCount(doc, source, anchors);\n            if (data.count * data.aliasCount > maxAliasCount) {\n                const msg = 'Excessive alias count indicates a resource exhaustion attack';\n                throw new ReferenceError(msg);\n            }\n        }\n        return data.res;\n    }\n    toString(ctx, _onComment, _onChompKeep) {\n        const src = `*${this.source}`;\n        if (ctx) {\n            anchorIsValid(this.source);\n            if (ctx.options.verifyAliasOrder && !ctx.anchors.has(this.source)) {\n                const msg = `Unresolved alias (the anchor must be set before the alias): ${this.source}`;\n                throw new Error(msg);\n            }\n            if (ctx.implicitKey)\n                return `${src} `;\n        }\n        return src;\n    }\n}\nfunction getAliasCount(doc, node, anchors) {\n    if (isAlias(node)) {\n        const source = node.resolve(doc);\n        const anchor = anchors && source && anchors.get(source);\n        return anchor ? anchor.count * anchor.aliasCount : 0;\n    }\n    else if (isCollection(node)) {\n        let count = 0;\n        for (const item of node.items) {\n            const c = getAliasCount(doc, item, anchors);\n            if (c > count)\n                count = c;\n        }\n        return count;\n    }\n    else if (isPair(node)) {\n        const kc = getAliasCount(doc, node.key, anchors);\n        const vc = getAliasCount(doc, node.value, anchors);\n        return Math.max(kc, vc);\n    }\n    return 1;\n}\n\nexport { Alias };\n","import { SCALAR } from './identity.js';\nimport { NodeBase } from './Node.js';\nimport { toJS } from './toJS.js';\n\nconst isScalarValue = (value) => !value || (typeof value !== 'function' && typeof value !== 'object');\nclass Scalar extends NodeBase {\n    constructor(value) {\n        super(SCALAR);\n        this.value = value;\n    }\n    toJSON(arg, ctx) {\n        return ctx?.keep ? this.value : toJS(this.value, arg, ctx);\n    }\n    toString() {\n        return String(this.value);\n    }\n}\nScalar.BLOCK_FOLDED = 'BLOCK_FOLDED';\nScalar.BLOCK_LITERAL = 'BLOCK_LITERAL';\nScalar.PLAIN = 'PLAIN';\nScalar.QUOTE_DOUBLE = 'QUOTE_DOUBLE';\nScalar.QUOTE_SINGLE = 'QUOTE_SINGLE';\n\nexport { Scalar, isScalarValue };\n","import { Alias } from '../nodes/Alias.js';\nimport { isNode, isPair, MAP, SEQ, isDocument } from '../nodes/identity.js';\nimport { Scalar } from '../nodes/Scalar.js';\n\nconst defaultTagPrefix = 'tag:yaml.org,2002:';\nfunction findTagObject(value, tagName, tags) {\n    if (tagName) {\n        const match = tags.filter(t => t.tag === tagName);\n        const tagObj = match.find(t => !t.format) ?? match[0];\n        if (!tagObj)\n            throw new Error(`Tag ${tagName} not found`);\n        return tagObj;\n    }\n    return tags.find(t => t.identify?.(value) && !t.format);\n}\nfunction createNode(value, tagName, ctx) {\n    if (isDocument(value))\n        value = value.contents;\n    if (isNode(value))\n        return value;\n    if (isPair(value)) {\n        const map = ctx.schema[MAP].createNode?.(ctx.schema, null, ctx);\n        map.items.push(value);\n        return map;\n    }\n    if (value instanceof String ||\n        value instanceof Number ||\n        value instanceof Boolean ||\n        (typeof BigInt !== 'undefined' && value instanceof BigInt) // not supported everywhere\n    ) {\n        // https://tc39.es/ecma262/#sec-serializejsonproperty\n        value = value.valueOf();\n    }\n    const { aliasDuplicateObjects, onAnchor, onTagObj, schema, sourceObjects } = ctx;\n    // Detect duplicate references to the same object & use Alias nodes for all\n    // after first. The `ref` wrapper allows for circular references to resolve.\n    let ref = undefined;\n    if (aliasDuplicateObjects && value && typeof value === 'object') {\n        ref = sourceObjects.get(value);\n        if (ref) {\n            ref.anchor ?? (ref.anchor = onAnchor(value));\n            return new Alias(ref.anchor);\n        }\n        else {\n            ref = { anchor: null, node: null };\n            sourceObjects.set(value, ref);\n        }\n    }\n    if (tagName?.startsWith('!!'))\n        tagName = defaultTagPrefix + tagName.slice(2);\n    let tagObj = findTagObject(value, tagName, schema.tags);\n    if (!tagObj) {\n        if (value && typeof value.toJSON === 'function') {\n            // eslint-disable-next-line @typescript-eslint/no-unsafe-call\n            value = value.toJSON();\n        }\n        if (!value || typeof value !== 'object') {\n            const node = new Scalar(value);\n            if (ref)\n                ref.node = node;\n            return node;\n        }\n        tagObj =\n            value instanceof Map\n                ? schema[MAP]\n                : Symbol.iterator in Object(value)\n                    ? schema[SEQ]\n                    : schema[MAP];\n    }\n    if (onTagObj) {\n        onTagObj(tagObj);\n        delete ctx.onTagObj;\n    }\n    const node = tagObj?.createNode\n        ? tagObj.createNode(ctx.schema, value, ctx)\n        : typeof tagObj?.nodeClass?.from === 'function'\n            ? tagObj.nodeClass.from(ctx.schema, value, ctx)\n            : new Scalar(value);\n    if (tagName)\n        node.tag = tagName;\n    else if (!tagObj.default)\n        node.tag = tagObj.tag;\n    if (ref)\n        ref.node = node;\n    return node;\n}\n\nexport { createNode };\n","import { createNode } from '../doc/createNode.js';\nimport { isNode, isPair, isCollection, isScalar } from './identity.js';\nimport { NodeBase } from './Node.js';\n\nfunction collectionFromPath(schema, path, value) {\n    let v = value;\n    for (let i = path.length - 1; i >= 0; --i) {\n        const k = path[i];\n        if (typeof k === 'number' && Number.isInteger(k) && k >= 0) {\n            const a = [];\n            a[k] = v;\n            v = a;\n        }\n        else {\n            v = new Map([[k, v]]);\n        }\n    }\n    return createNode(v, undefined, {\n        aliasDuplicateObjects: false,\n        keepUndefined: false,\n        onAnchor: () => {\n            throw new Error('This should not happen, please report a bug.');\n        },\n        schema,\n        sourceObjects: new Map()\n    });\n}\n// Type guard is intentionally a little wrong so as to be more useful,\n// as it does not cover untypable empty non-string iterables (e.g. []).\nconst isEmptyPath = (path) => path == null ||\n    (typeof path === 'object' && !!path[Symbol.iterator]().next().done);\nclass Collection extends NodeBase {\n    constructor(type, schema) {\n        super(type);\n        Object.defineProperty(this, 'schema', {\n            value: schema,\n            configurable: true,\n            enumerable: false,\n            writable: true\n        });\n    }\n    /**\n     * Create a copy of this collection.\n     *\n     * @param schema - If defined, overwrites the original's schema\n     */\n    clone(schema) {\n        const copy = Object.create(Object.getPrototypeOf(this), Object.getOwnPropertyDescriptors(this));\n        if (schema)\n            copy.schema = schema;\n        copy.items = copy.items.map(it => isNode(it) || isPair(it) ? it.clone(schema) : it);\n        if (this.range)\n            copy.range = this.range.slice();\n        return copy;\n    }\n    /**\n     * Adds a value to the collection. For `!!map` and `!!omap` the value must\n     * be a Pair instance or a `{ key, value }` object, which may not have a key\n     * that already exists in the map.\n     */\n    addIn(path, value) {\n        if (isEmptyPath(path))\n            this.add(value);\n        else {\n            const [key, ...rest] = path;\n            const node = this.get(key, true);\n            if (isCollection(node))\n                node.addIn(rest, value);\n            else if (node === undefined && this.schema)\n                this.set(key, collectionFromPath(this.schema, rest, value));\n            else\n                throw new Error(`Expected YAML collection at ${key}. Remaining path: ${rest}`);\n        }\n    }\n    /**\n     * Removes a value from the collection.\n     * @returns `true` if the item was found and removed.\n     */\n    deleteIn(path) {\n        const [key, ...rest] = path;\n        if (rest.length === 0)\n            return this.delete(key);\n        const node = this.get(key, true);\n        if (isCollection(node))\n            return node.deleteIn(rest);\n        else\n            throw new Error(`Expected YAML collection at ${key}. Remaining path: ${rest}`);\n    }\n    /**\n     * Returns item at `key`, or `undefined` if not found. By default unwraps\n     * scalar values from their surrounding node; to disable set `keepScalar` to\n     * `true` (collections are always returned intact).\n     */\n    getIn(path, keepScalar) {\n        const [key, ...rest] = path;\n        const node = this.get(key, true);\n        if (rest.length === 0)\n            return !keepScalar && isScalar(node) ? node.value : node;\n        else\n            return isCollection(node) ? node.getIn(rest, keepScalar) : undefined;\n    }\n    hasAllNullValues(allowScalar) {\n        return this.items.every(node => {\n            if (!isPair(node))\n                return false;\n            const n = node.value;\n            return (n == null ||\n                (allowScalar &&\n                    isScalar(n) &&\n                    n.value == null &&\n                    !n.commentBefore &&\n                    !n.comment &&\n                    !n.tag));\n        });\n    }\n    /**\n     * Checks if the collection includes a value with the key `key`.\n     */\n    hasIn(path) {\n        const [key, ...rest] = path;\n        if (rest.length === 0)\n            return this.has(key);\n        const node = this.get(key, true);\n        return isCollection(node) ? node.hasIn(rest) : false;\n    }\n    /**\n     * Sets a value in this collection. For `!!set`, `value` needs to be a\n     * boolean to add/remove the item from the set.\n     */\n    setIn(path, value) {\n        const [key, ...rest] = path;\n        if (rest.length === 0) {\n            this.set(key, value);\n        }\n        else {\n            const node = this.get(key, true);\n            if (isCollection(node))\n                node.setIn(rest, value);\n            else if (node === undefined && this.schema)\n                this.set(key, collectionFromPath(this.schema, rest, value));\n            else\n                throw new Error(`Expected YAML collection at ${key}. Remaining path: ${rest}`);\n        }\n    }\n}\n\nexport { Collection, collectionFromPath, isEmptyPath };\n","/**\n * Stringifies a comment.\n *\n * Empty comment lines are left empty,\n * lines consisting of a single space are replaced by `#`,\n * and all other lines are prefixed with a `#`.\n */\nconst stringifyComment = (str) => str.replace(/^(?!$)(?: $)?/gm, '#');\nfunction indentComment(comment, indent) {\n    if (/^\\n+$/.test(comment))\n        return comment.substring(1);\n    return indent ? comment.replace(/^(?! *$)/gm, indent) : comment;\n}\nconst lineComment = (str, indent, comment) => str.endsWith('\\n')\n    ? indentComment(comment, indent)\n    : comment.includes('\\n')\n        ? '\\n' + indentComment(comment, indent)\n        : (str.endsWith(' ') ? '' : ' ') + comment;\n\nexport { indentComment, lineComment, stringifyComment };\n","const FOLD_FLOW = 'flow';\nconst FOLD_BLOCK = 'block';\nconst FOLD_QUOTED = 'quoted';\n/**\n * Tries to keep input at up to `lineWidth` characters, splitting only on spaces\n * not followed by newlines or spaces unless `mode` is `'quoted'`. Lines are\n * terminated with `\\n` and started with `indent`.\n */\nfunction foldFlowLines(text, indent, mode = 'flow', { indentAtStart, lineWidth = 80, minContentWidth = 20, onFold, onOverflow } = {}) {\n    if (!lineWidth || lineWidth < 0)\n        return text;\n    if (lineWidth < minContentWidth)\n        minContentWidth = 0;\n    const endStep = Math.max(1 + minContentWidth, 1 + lineWidth - indent.length);\n    if (text.length <= endStep)\n        return text;\n    const folds = [];\n    const escapedFolds = {};\n    let end = lineWidth - indent.length;\n    if (typeof indentAtStart === 'number') {\n        if (indentAtStart > lineWidth - Math.max(2, minContentWidth))\n            folds.push(0);\n        else\n            end = lineWidth - indentAtStart;\n    }\n    let split = undefined;\n    let prev = undefined;\n    let overflow = false;\n    let i = -1;\n    let escStart = -1;\n    let escEnd = -1;\n    if (mode === FOLD_BLOCK) {\n        i = consumeMoreIndentedLines(text, i, indent.length);\n        if (i !== -1)\n            end = i + endStep;\n    }\n    for (let ch; (ch = text[(i += 1)]);) {\n        if (mode === FOLD_QUOTED && ch === '\\\\') {\n            escStart = i;\n            switch (text[i + 1]) {\n                case 'x':\n                    i += 3;\n                    break;\n                case 'u':\n                    i += 5;\n                    break;\n                case 'U':\n                    i += 9;\n                    break;\n                default:\n                    i += 1;\n            }\n            escEnd = i;\n        }\n        if (ch === '\\n') {\n            if (mode === FOLD_BLOCK)\n                i = consumeMoreIndentedLines(text, i, indent.length);\n            end = i + indent.length + endStep;\n            split = undefined;\n        }\n        else {\n            if (ch === ' ' &&\n                prev &&\n                prev !== ' ' &&\n                prev !== '\\n' &&\n                prev !== '\\t') {\n                // space surrounded by non-space can be replaced with newline + indent\n                const next = text[i + 1];\n                if (next && next !== ' ' && next !== '\\n' && next !== '\\t')\n                    split = i;\n            }\n            if (i >= end) {\n                if (split) {\n                    folds.push(split);\n                    end = split + endStep;\n                    split = undefined;\n                }\n                else if (mode === FOLD_QUOTED) {\n                    // white-space collected at end may stretch past lineWidth\n                    while (prev === ' ' || prev === '\\t') {\n                        prev = ch;\n                        ch = text[(i += 1)];\n                        overflow = true;\n                    }\n                    // Account for newline escape, but don't break preceding escape\n                    const j = i > escEnd + 1 ? i - 2 : escStart - 1;\n                    // Bail out if lineWidth & minContentWidth are shorter than an escape string\n                    if (escapedFolds[j])\n                        return text;\n                    folds.push(j);\n                    escapedFolds[j] = true;\n                    end = j + endStep;\n                    split = undefined;\n                }\n                else {\n                    overflow = true;\n                }\n            }\n        }\n        prev = ch;\n    }\n    if (overflow && onOverflow)\n        onOverflow();\n    if (folds.length === 0)\n        return text;\n    if (onFold)\n        onFold();\n    let res = text.slice(0, folds[0]);\n    for (let i = 0; i < folds.length; ++i) {\n        const fold = folds[i];\n        const end = folds[i + 1] || text.length;\n        if (fold === 0)\n            res = `\\n${indent}${text.slice(0, end)}`;\n        else {\n            if (mode === FOLD_QUOTED && escapedFolds[fold])\n                res += `${text[fold]}\\\\`;\n            res += `\\n${indent}${text.slice(fold + 1, end)}`;\n        }\n    }\n    return res;\n}\n/**\n * Presumes `i + 1` is at the start of a line\n * @returns index of last newline in more-indented block\n */\nfunction consumeMoreIndentedLines(text, i, indent) {\n    let end = i;\n    let start = i + 1;\n    let ch = text[start];\n    while (ch === ' ' || ch === '\\t') {\n        if (i < start + indent) {\n            ch = text[++i];\n        }\n        else {\n            do {\n                ch = text[++i];\n            } while (ch && ch !== '\\n');\n            end = i;\n            start = i + 1;\n            ch = text[start];\n        }\n    }\n    return end;\n}\n\nexport { FOLD_BLOCK, FOLD_FLOW, FOLD_QUOTED, foldFlowLines };\n","import { Scalar } from '../nodes/Scalar.js';\nimport { foldFlowLines, FOLD_FLOW, FOLD_QUOTED, FOLD_BLOCK } from './foldFlowLines.js';\n\nconst getFoldOptions = (ctx, isBlock) => ({\n    indentAtStart: isBlock ? ctx.indent.length : ctx.indentAtStart,\n    lineWidth: ctx.options.lineWidth,\n    minContentWidth: ctx.options.minContentWidth\n});\n// Also checks for lines starting with %, as parsing the output as YAML 1.1 will\n// presume that's starting a new document.\nconst containsDocumentMarker = (str) => /^(%|---|\\.\\.\\.)/m.test(str);\nfunction lineLengthOverLimit(str, lineWidth, indentLength) {\n    if (!lineWidth || lineWidth < 0)\n        return false;\n    const limit = lineWidth - indentLength;\n    const strLen = str.length;\n    if (strLen <= limit)\n        return false;\n    for (let i = 0, start = 0; i < strLen; ++i) {\n        if (str[i] === '\\n') {\n            if (i - start > limit)\n                return true;\n            start = i + 1;\n            if (strLen - start <= limit)\n                return false;\n        }\n    }\n    return true;\n}\nfunction doubleQuotedString(value, ctx) {\n    const json = JSON.stringify(value);\n    if (ctx.options.doubleQuotedAsJSON)\n        return json;\n    const { implicitKey } = ctx;\n    const minMultiLineLength = ctx.options.doubleQuotedMinMultiLineLength;\n    const indent = ctx.indent || (containsDocumentMarker(value) ? '  ' : '');\n    let str = '';\n    let start = 0;\n    for (let i = 0, ch = json[i]; ch; ch = json[++i]) {\n        if (ch === ' ' && json[i + 1] === '\\\\' && json[i + 2] === 'n') {\n            // space before newline needs to be escaped to not be folded\n            str += json.slice(start, i) + '\\\\ ';\n            i += 1;\n            start = i;\n            ch = '\\\\';\n        }\n        if (ch === '\\\\')\n            switch (json[i + 1]) {\n                case 'u':\n                    {\n                        str += json.slice(start, i);\n                        const code = json.substr(i + 2, 4);\n                        switch (code) {\n                            case '0000':\n                                str += '\\\\0';\n                                break;\n                            case '0007':\n                                str += '\\\\a';\n                                break;\n                            case '000b':\n                                str += '\\\\v';\n                                break;\n                            case '001b':\n                                str += '\\\\e';\n                                break;\n                            case '0085':\n                                str += '\\\\N';\n                                break;\n                            case '00a0':\n                                str += '\\\\_';\n                                break;\n                            case '2028':\n                                str += '\\\\L';\n                                break;\n                            case '2029':\n                                str += '\\\\P';\n                                break;\n                            default:\n                                if (code.substr(0, 2) === '00')\n                                    str += '\\\\x' + code.substr(2);\n                                else\n                                    str += json.substr(i, 6);\n                        }\n                        i += 5;\n                        start = i + 1;\n                    }\n                    break;\n                case 'n':\n                    if (implicitKey ||\n                        json[i + 2] === '\"' ||\n                        json.length < minMultiLineLength) {\n                        i += 1;\n                    }\n                    else {\n                        // folding will eat first newline\n                        str += json.slice(start, i) + '\\n\\n';\n                        while (json[i + 2] === '\\\\' &&\n                            json[i + 3] === 'n' &&\n                            json[i + 4] !== '\"') {\n                            str += '\\n';\n                            i += 2;\n                        }\n                        str += indent;\n                        // space after newline needs to be escaped to not be folded\n                        if (json[i + 2] === ' ')\n                            str += '\\\\';\n                        i += 1;\n                        start = i + 1;\n                    }\n                    break;\n                default:\n                    i += 1;\n            }\n    }\n    str = start ? str + json.slice(start) : json;\n    return implicitKey\n        ? str\n        : foldFlowLines(str, indent, FOLD_QUOTED, getFoldOptions(ctx, false));\n}\nfunction singleQuotedString(value, ctx) {\n    if (ctx.options.singleQuote === false ||\n        (ctx.implicitKey && value.includes('\\n')) ||\n        /[ \\t]\\n|\\n[ \\t]/.test(value) // single quoted string can't have leading or trailing whitespace around newline\n    )\n        return doubleQuotedString(value, ctx);\n    const indent = ctx.indent || (containsDocumentMarker(value) ? '  ' : '');\n    const res = \"'\" + value.replace(/'/g, \"''\").replace(/\\n+/g, `$&\\n${indent}`) + \"'\";\n    return ctx.implicitKey\n        ? res\n        : foldFlowLines(res, indent, FOLD_FLOW, getFoldOptions(ctx, false));\n}\nfunction quotedString(value, ctx) {\n    const { singleQuote } = ctx.options;\n    let qs;\n    if (singleQuote === false)\n        qs = doubleQuotedString;\n    else {\n        const hasDouble = value.includes('\"');\n        const hasSingle = value.includes(\"'\");\n        if (hasDouble && !hasSingle)\n            qs = singleQuotedString;\n        else if (hasSingle && !hasDouble)\n            qs = doubleQuotedString;\n        else\n            qs = singleQuote ? singleQuotedString : doubleQuotedString;\n    }\n    return qs(value, ctx);\n}\n// The negative lookbehind avoids a polynomial search,\n// but isn't supported yet on Safari: https://caniuse.com/js-regexp-lookbehind\nlet blockEndNewlines;\ntry {\n    blockEndNewlines = new RegExp('(^|(?<!\\n))\\n+(?!\\n|$)', 'g');\n}\ncatch {\n    blockEndNewlines = /\\n+(?!\\n|$)/g;\n}\nfunction blockString({ comment, type, value }, ctx, onComment, onChompKeep) {\n    const { blockQuote, commentString, lineWidth } = ctx.options;\n    // 1. Block can't end in whitespace unless the last line is non-empty.\n    // 2. Strings consisting of only whitespace are best rendered explicitly.\n    if (!blockQuote || /\\n[\\t ]+$/.test(value)) {\n        return quotedString(value, ctx);\n    }\n    const indent = ctx.indent ||\n        (ctx.forceBlockIndent || containsDocumentMarker(value) ? '  ' : '');\n    const literal = blockQuote === 'literal'\n        ? true\n        : blockQuote === 'folded' || type === Scalar.BLOCK_FOLDED\n            ? false\n            : type === Scalar.BLOCK_LITERAL\n                ? true\n                : !lineLengthOverLimit(value, lineWidth, indent.length);\n    if (!value)\n        return literal ? '|\\n' : '>\\n';\n    // determine chomping from whitespace at value end\n    let chomp;\n    let endStart;\n    for (endStart = value.length; endStart > 0; --endStart) {\n        const ch = value[endStart - 1];\n        if (ch !== '\\n' && ch !== '\\t' && ch !== ' ')\n            break;\n    }\n    let end = value.substring(endStart);\n    const endNlPos = end.indexOf('\\n');\n    if (endNlPos === -1) {\n        chomp = '-'; // strip\n    }\n    else if (value === end || endNlPos !== end.length - 1) {\n        chomp = '+'; // keep\n        if (onChompKeep)\n            onChompKeep();\n    }\n    else {\n        chomp = ''; // clip\n    }\n    if (end) {\n        value = value.slice(0, -end.length);\n        if (end[end.length - 1] === '\\n')\n            end = end.slice(0, -1);\n        end = end.replace(blockEndNewlines, `$&${indent}`);\n    }\n    // determine indent indicator from whitespace at value start\n    let startWithSpace = false;\n    let startEnd;\n    let startNlPos = -1;\n    for (startEnd = 0; startEnd < value.length; ++startEnd) {\n        const ch = value[startEnd];\n        if (ch === ' ')\n            startWithSpace = true;\n        else if (ch === '\\n')\n            startNlPos = startEnd;\n        else\n            break;\n    }\n    let start = value.substring(0, startNlPos < startEnd ? startNlPos + 1 : startEnd);\n    if (start) {\n        value = value.substring(start.length);\n        start = start.replace(/\\n+/g, `$&${indent}`);\n    }\n    const indentSize = indent ? '2' : '1'; // root is at -1\n    // Leading | or > is added later\n    let header = (startWithSpace ? indentSize : '') + chomp;\n    if (comment) {\n        header += ' ' + commentString(comment.replace(/ ?[\\r\\n]+/g, ' '));\n        if (onComment)\n            onComment();\n    }\n    if (!literal) {\n        const foldedValue = value\n            .replace(/\\n+/g, '\\n$&')\n            .replace(/(?:^|\\n)([\\t ].*)(?:([\\n\\t ]*)\\n(?![\\n\\t ]))?/g, '$1$2') // more-indented lines aren't folded\n            //                ^ more-ind. ^ empty     ^ capture next empty lines only at end of indent\n            .replace(/\\n+/g, `$&${indent}`);\n        let literalFallback = false;\n        const foldOptions = getFoldOptions(ctx, true);\n        if (blockQuote !== 'folded' && type !== Scalar.BLOCK_FOLDED) {\n            foldOptions.onOverflow = () => {\n                literalFallback = true;\n            };\n        }\n        const body = foldFlowLines(`${start}${foldedValue}${end}`, indent, FOLD_BLOCK, foldOptions);\n        if (!literalFallback)\n            return `>${header}\\n${indent}${body}`;\n    }\n    value = value.replace(/\\n+/g, `$&${indent}`);\n    return `|${header}\\n${indent}${start}${value}${end}`;\n}\nfunction plainString(item, ctx, onComment, onChompKeep) {\n    const { type, value } = item;\n    const { actualString, implicitKey, indent, indentStep, inFlow } = ctx;\n    if ((implicitKey && value.includes('\\n')) ||\n        (inFlow && /[[\\]{},]/.test(value))) {\n        return quotedString(value, ctx);\n    }\n    if (/^[\\n\\t ,[\\]{}#&*!|>'\"%@`]|^[?-]$|^[?-][ \\t]|[\\n:][ \\t]|[ \\t]\\n|[\\n\\t ]#|[\\n\\t :]$/.test(value)) {\n        // not allowed:\n        // - '-' or '?'\n        // - start with an indicator character (except [?:-]) or /[?-] /\n        // - '\\n ', ': ' or ' \\n' anywhere\n        // - '#' not preceded by a non-space char\n        // - end with ' ' or ':'\n        return implicitKey || inFlow || !value.includes('\\n')\n            ? quotedString(value, ctx)\n            : blockString(item, ctx, onComment, onChompKeep);\n    }\n    if (!implicitKey &&\n        !inFlow &&\n        type !== Scalar.PLAIN &&\n        value.includes('\\n')) {\n        // Where allowed & type not set explicitly, prefer block style for multiline strings\n        return blockString(item, ctx, onComment, onChompKeep);\n    }\n    if (containsDocumentMarker(value)) {\n        if (indent === '') {\n            ctx.forceBlockIndent = true;\n            return blockString(item, ctx, onComment, onChompKeep);\n        }\n        else if (implicitKey && indent === indentStep) {\n            return quotedString(value, ctx);\n        }\n    }\n    const str = value.replace(/\\n+/g, `$&\\n${indent}`);\n    // Verify that output will be parsed as a string, as e.g. plain numbers and\n    // booleans get parsed with those types in v1.2 (e.g. '42', 'true' & '0.9e-3'),\n    // and others in v1.1.\n    if (actualString) {\n        const test = (tag) => tag.default && tag.tag !== 'tag:yaml.org,2002:str' && tag.test?.test(str);\n        const { compat, tags } = ctx.doc.schema;\n        if (tags.some(test) || compat?.some(test))\n            return quotedString(value, ctx);\n    }\n    return implicitKey\n        ? str\n        : foldFlowLines(str, indent, FOLD_FLOW, getFoldOptions(ctx, false));\n}\nfunction stringifyString(item, ctx, onComment, onChompKeep) {\n    const { implicitKey, inFlow } = ctx;\n    const ss = typeof item.value === 'string'\n        ? item\n        : Object.assign({}, item, { value: String(item.value) });\n    let { type } = item;\n    if (type !== Scalar.QUOTE_DOUBLE) {\n        // force double quotes on control characters & unpaired surrogates\n        if (/[\\x00-\\x08\\x0b-\\x1f\\x7f-\\x9f\\u{D800}-\\u{DFFF}]/u.test(ss.value))\n            type = Scalar.QUOTE_DOUBLE;\n    }\n    const _stringify = (_type) => {\n        switch (_type) {\n            case Scalar.BLOCK_FOLDED:\n            case Scalar.BLOCK_LITERAL:\n                return implicitKey || inFlow\n                    ? quotedString(ss.value, ctx) // blocks are not valid inside flow containers\n                    : blockString(ss, ctx, onComment, onChompKeep);\n            case Scalar.QUOTE_DOUBLE:\n                return doubleQuotedString(ss.value, ctx);\n            case Scalar.QUOTE_SINGLE:\n                return singleQuotedString(ss.value, ctx);\n            case Scalar.PLAIN:\n                return plainString(ss, ctx, onComment, onChompKeep);\n            default:\n                return null;\n        }\n    };\n    let res = _stringify(type);\n    if (res === null) {\n        const { defaultKeyType, defaultStringType } = ctx.options;\n        const t = (implicitKey && defaultKeyType) || defaultStringType;\n        res = _stringify(t);\n        if (res === null)\n            throw new Error(`Unsupported default string type ${t}`);\n    }\n    return res;\n}\n\nexport { stringifyString };\n","import { anchorIsValid } from '../doc/anchors.js';\nimport { isPair, isAlias, isNode, isScalar, isCollection } from '../nodes/identity.js';\nimport { stringifyComment } from './stringifyComment.js';\nimport { stringifyString } from './stringifyString.js';\n\nfunction createStringifyContext(doc, options) {\n    const opt = Object.assign({\n        blockQuote: true,\n        commentString: stringifyComment,\n        defaultKeyType: null,\n        defaultStringType: 'PLAIN',\n        directives: null,\n        doubleQuotedAsJSON: false,\n        doubleQuotedMinMultiLineLength: 40,\n        falseStr: 'false',\n        flowCollectionPadding: true,\n        indentSeq: true,\n        lineWidth: 80,\n        minContentWidth: 20,\n        nullStr: 'null',\n        simpleKeys: false,\n        singleQuote: null,\n        trueStr: 'true',\n        verifyAliasOrder: true\n    }, doc.schema.toStringOptions, options);\n    let inFlow;\n    switch (opt.collectionStyle) {\n        case 'block':\n            inFlow = false;\n            break;\n        case 'flow':\n            inFlow = true;\n            break;\n        default:\n            inFlow = null;\n    }\n    return {\n        anchors: new Set(),\n        doc,\n        flowCollectionPadding: opt.flowCollectionPadding ? ' ' : '',\n        indent: '',\n        indentStep: typeof opt.indent === 'number' ? ' '.repeat(opt.indent) : '  ',\n        inFlow,\n        options: opt\n    };\n}\nfunction getTagObject(tags, item) {\n    if (item.tag) {\n        const match = tags.filter(t => t.tag === item.tag);\n        if (match.length > 0)\n            return match.find(t => t.format === item.format) ?? match[0];\n    }\n    let tagObj = undefined;\n    let obj;\n    if (isScalar(item)) {\n        obj = item.value;\n        let match = tags.filter(t => t.identify?.(obj));\n        if (match.length > 1) {\n            const testMatch = match.filter(t => t.test);\n            if (testMatch.length > 0)\n                match = testMatch;\n        }\n        tagObj =\n            match.find(t => t.format === item.format) ?? match.find(t => !t.format);\n    }\n    else {\n        obj = item;\n        tagObj = tags.find(t => t.nodeClass && obj instanceof t.nodeClass);\n    }\n    if (!tagObj) {\n        const name = obj?.constructor?.name ?? (obj === null ? 'null' : typeof obj);\n        throw new Error(`Tag not resolved for ${name} value`);\n    }\n    return tagObj;\n}\n// needs to be called before value stringifier to allow for circular anchor refs\nfunction stringifyProps(node, tagObj, { anchors, doc }) {\n    if (!doc.directives)\n        return '';\n    const props = [];\n    const anchor = (isScalar(node) || isCollection(node)) && node.anchor;\n    if (anchor && anchorIsValid(anchor)) {\n        anchors.add(anchor);\n        props.push(`&${anchor}`);\n    }\n    const tag = node.tag ?? (tagObj.default ? null : tagObj.tag);\n    if (tag)\n        props.push(doc.directives.tagString(tag));\n    return props.join(' ');\n}\nfunction stringify(item, ctx, onComment, onChompKeep) {\n    if (isPair(item))\n        return item.toString(ctx, onComment, onChompKeep);\n    if (isAlias(item)) {\n        if (ctx.doc.directives)\n            return item.toString(ctx);\n        if (ctx.resolvedAliases?.has(item)) {\n            throw new TypeError(`Cannot stringify circular structure without alias nodes`);\n        }\n        else {\n            if (ctx.resolvedAliases)\n                ctx.resolvedAliases.add(item);\n            else\n                ctx.resolvedAliases = new Set([item]);\n            item = item.resolve(ctx.doc);\n        }\n    }\n    let tagObj = undefined;\n    const node = isNode(item)\n        ? item\n        : ctx.doc.createNode(item, { onTagObj: o => (tagObj = o) });\n    tagObj ?? (tagObj = getTagObject(ctx.doc.schema.tags, node));\n    const props = stringifyProps(node, tagObj, ctx);\n    if (props.length > 0)\n        ctx.indentAtStart = (ctx.indentAtStart ?? 0) + props.length + 1;\n    const str = typeof tagObj.stringify === 'function'\n        ? tagObj.stringify(node, ctx, onComment, onChompKeep)\n        : isScalar(node)\n            ? stringifyString(node, ctx, onComment, onChompKeep)\n            : node.toString(ctx, onComment, onChompKeep);\n    if (!props)\n        return str;\n    return isScalar(node) || str[0] === '{' || str[0] === '['\n        ? `${props} ${str}`\n        : `${props}\\n${ctx.indent}${str}`;\n}\n\nexport { createStringifyContext, stringify };\n","import { isCollection, isNode, isScalar, isSeq } from '../nodes/identity.js';\nimport { Scalar } from '../nodes/Scalar.js';\nimport { stringify } from './stringify.js';\nimport { lineComment, indentComment } from './stringifyComment.js';\n\nfunction stringifyPair({ key, value }, ctx, onComment, onChompKeep) {\n    const { allNullValues, doc, indent, indentStep, options: { commentString, indentSeq, simpleKeys } } = ctx;\n    let keyComment = (isNode(key) && key.comment) || null;\n    if (simpleKeys) {\n        if (keyComment) {\n            throw new Error('With simple keys, key nodes cannot have comments');\n        }\n        if (isCollection(key) || (!isNode(key) && typeof key === 'object')) {\n            const msg = 'With simple keys, collection cannot be used as a key value';\n            throw new Error(msg);\n        }\n    }\n    let explicitKey = !simpleKeys &&\n        (!key ||\n            (keyComment && value == null && !ctx.inFlow) ||\n            isCollection(key) ||\n            (isScalar(key)\n                ? key.type === Scalar.BLOCK_FOLDED || key.type === Scalar.BLOCK_LITERAL\n                : typeof key === 'object'));\n    ctx = Object.assign({}, ctx, {\n        allNullValues: false,\n        implicitKey: !explicitKey && (simpleKeys || !allNullValues),\n        indent: indent + indentStep\n    });\n    let keyCommentDone = false;\n    let chompKeep = false;\n    let str = stringify(key, ctx, () => (keyCommentDone = true), () => (chompKeep = true));\n    if (!explicitKey && !ctx.inFlow && str.length > 1024) {\n        if (simpleKeys)\n            throw new Error('With simple keys, single line scalar must not span more than 1024 characters');\n        explicitKey = true;\n    }\n    if (ctx.inFlow) {\n        if (allNullValues || value == null) {\n            if (keyCommentDone && onComment)\n                onComment();\n            return str === '' ? '?' : explicitKey ? `? ${str}` : str;\n        }\n    }\n    else if ((allNullValues && !simpleKeys) || (value == null && explicitKey)) {\n        str = `? ${str}`;\n        if (keyComment && !keyCommentDone) {\n            str += lineComment(str, ctx.indent, commentString(keyComment));\n        }\n        else if (chompKeep && onChompKeep)\n            onChompKeep();\n        return str;\n    }\n    if (keyCommentDone)\n        keyComment = null;\n    if (explicitKey) {\n        if (keyComment)\n            str += lineComment(str, ctx.indent, commentString(keyComment));\n        str = `? ${str}\\n${indent}:`;\n    }\n    else {\n        str = `${str}:`;\n        if (keyComment)\n            str += lineComment(str, ctx.indent, commentString(keyComment));\n    }\n    let vsb, vcb, valueComment;\n    if (isNode(value)) {\n        vsb = !!value.spaceBefore;\n        vcb = value.commentBefore;\n        valueComment = value.comment;\n    }\n    else {\n        vsb = false;\n        vcb = null;\n        valueComment = null;\n        if (value && typeof value === 'object')\n            value = doc.createNode(value);\n    }\n    ctx.implicitKey = false;\n    if (!explicitKey && !keyComment && isScalar(value))\n        ctx.indentAtStart = str.length + 1;\n    chompKeep = false;\n    if (!indentSeq &&\n        indentStep.length >= 2 &&\n        !ctx.inFlow &&\n        !explicitKey &&\n        isSeq(value) &&\n        !value.flow &&\n        !value.tag &&\n        !value.anchor) {\n        // If indentSeq === false, consider '- ' as part of indentation where possible\n        ctx.indent = ctx.indent.substring(2);\n    }\n    let valueCommentDone = false;\n    const valueStr = stringify(value, ctx, () => (valueCommentDone = true), () => (chompKeep = true));\n    let ws = ' ';\n    if (keyComment || vsb || vcb) {\n        ws = vsb ? '\\n' : '';\n        if (vcb) {\n            const cs = commentString(vcb);\n            ws += `\\n${indentComment(cs, ctx.indent)}`;\n        }\n        if (valueStr === '' && !ctx.inFlow) {\n            if (ws === '\\n')\n                ws = '\\n\\n';\n        }\n        else {\n            ws += `\\n${ctx.indent}`;\n        }\n    }\n    else if (!explicitKey && isCollection(value)) {\n        const vs0 = valueStr[0];\n        const nl0 = valueStr.indexOf('\\n');\n        const hasNewline = nl0 !== -1;\n        const flow = ctx.inFlow ?? value.flow ?? value.items.length === 0;\n        if (hasNewline || !flow) {\n            let hasPropsLine = false;\n            if (hasNewline && (vs0 === '&' || vs0 === '!')) {\n                let sp0 = valueStr.indexOf(' ');\n                if (vs0 === '&' &&\n                    sp0 !== -1 &&\n                    sp0 < nl0 &&\n                    valueStr[sp0 + 1] === '!') {\n                    sp0 = valueStr.indexOf(' ', sp0 + 1);\n                }\n                if (sp0 === -1 || nl0 < sp0)\n                    hasPropsLine = true;\n            }\n            if (!hasPropsLine)\n                ws = `\\n${ctx.indent}`;\n        }\n    }\n    else if (valueStr === '' || valueStr[0] === '\\n') {\n        ws = '';\n    }\n    str += ws + valueStr;\n    if (ctx.inFlow) {\n        if (valueCommentDone && onComment)\n            onComment();\n    }\n    else if (valueComment && !valueCommentDone) {\n        str += lineComment(str, ctx.indent, commentString(valueComment));\n    }\n    else if (chompKeep && onChompKeep) {\n        onChompKeep();\n    }\n    return str;\n}\n\nexport { stringifyPair };\n","function debug(logLevel, ...messages) {\n    if (logLevel === 'debug')\n        console.log(...messages);\n}\nfunction warn(logLevel, warning) {\n    if (logLevel === 'debug' || logLevel === 'warn') {\n        console.warn(warning);\n    }\n}\n\nexport { debug, warn };\n","import { isScalar, isAlias, isSeq, isMap } from '../../nodes/identity.js';\nimport { Scalar } from '../../nodes/Scalar.js';\n\n// If the value associated with a merge key is a single mapping node, each of\n// its key/value pairs is inserted into the current mapping, unless the key\n// already exists in it. If the value associated with the merge key is a\n// sequence, then this sequence is expected to contain mapping nodes and each\n// of these nodes is merged in turn according to its order in the sequence.\n// Keys in mapping nodes earlier in the sequence override keys specified in\n// later mapping nodes. -- http://yaml.org/type/merge.html\nconst MERGE_KEY = '<<';\nconst merge = {\n    identify: value => value === MERGE_KEY ||\n        (typeof value === 'symbol' && value.description === MERGE_KEY),\n    default: 'key',\n    tag: 'tag:yaml.org,2002:merge',\n    test: /^<<$/,\n    resolve: () => Object.assign(new Scalar(Symbol(MERGE_KEY)), {\n        addToJSMap: addMergeToJSMap\n    }),\n    stringify: () => MERGE_KEY\n};\nconst isMergeKey = (ctx, key) => (merge.identify(key) ||\n    (isScalar(key) &&\n        (!key.type || key.type === Scalar.PLAIN) &&\n        merge.identify(key.value))) &&\n    ctx?.doc.schema.tags.some(tag => tag.tag === merge.tag && tag.default);\nfunction addMergeToJSMap(ctx, map, value) {\n    value = ctx && isAlias(value) ? value.resolve(ctx.doc) : value;\n    if (isSeq(value))\n        for (const it of value.items)\n            mergeValue(ctx, map, it);\n    else if (Array.isArray(value))\n        for (const it of value)\n            mergeValue(ctx, map, it);\n    else\n        mergeValue(ctx, map, value);\n}\nfunction mergeValue(ctx, map, value) {\n    const source = ctx && isAlias(value) ? value.resolve(ctx.doc) : value;\n    if (!isMap(source))\n        throw new Error('Merge sources must be maps or map aliases');\n    const srcMap = source.toJSON(null, ctx, Map);\n    for (const [key, value] of srcMap) {\n        if (map instanceof Map) {\n            if (!map.has(key))\n                map.set(key, value);\n        }\n        else if (map instanceof Set) {\n            map.add(key);\n        }\n        else if (!Object.prototype.hasOwnProperty.call(map, key)) {\n            Object.defineProperty(map, key, {\n                value,\n                writable: true,\n                enumerable: true,\n                configurable: true\n            });\n        }\n    }\n    return map;\n}\n\nexport { addMergeToJSMap, isMergeKey, merge };\n","import { warn } from '../log.js';\nimport { isMergeKey, addMergeToJSMap } from '../schema/yaml-1.1/merge.js';\nimport { createStringifyContext } from '../stringify/stringify.js';\nimport { isNode } from './identity.js';\nimport { toJS } from './toJS.js';\n\nfunction addPairToJSMap(ctx, map, { key, value }) {\n    if (isNode(key) && key.addToJSMap)\n        key.addToJSMap(ctx, map, value);\n    // TODO: Should drop this special case for bare << handling\n    else if (isMergeKey(ctx, key))\n        addMergeToJSMap(ctx, map, value);\n    else {\n        const jsKey = toJS(key, '', ctx);\n        if (map instanceof Map) {\n            map.set(jsKey, toJS(value, jsKey, ctx));\n        }\n        else if (map instanceof Set) {\n            map.add(jsKey);\n        }\n        else {\n            const stringKey = stringifyKey(key, jsKey, ctx);\n            const jsValue = toJS(value, stringKey, ctx);\n            if (stringKey in map)\n                Object.defineProperty(map, stringKey, {\n                    value: jsValue,\n                    writable: true,\n                    enumerable: true,\n                    configurable: true\n                });\n            else\n                map[stringKey] = jsValue;\n        }\n    }\n    return map;\n}\nfunction stringifyKey(key, jsKey, ctx) {\n    if (jsKey === null)\n        return '';\n    // eslint-disable-next-line @typescript-eslint/no-base-to-string\n    if (typeof jsKey !== 'object')\n        return String(jsKey);\n    if (isNode(key) && ctx?.doc) {\n        const strCtx = createStringifyContext(ctx.doc, {});\n        strCtx.anchors = new Set();\n        for (const node of ctx.anchors.keys())\n            strCtx.anchors.add(node.anchor);\n        strCtx.inFlow = true;\n        strCtx.inStringifyKey = true;\n        const strKey = key.toString(strCtx);\n        if (!ctx.mapKeyWarned) {\n            let jsonStr = JSON.stringify(strKey);\n            if (jsonStr.length > 40)\n                jsonStr = jsonStr.substring(0, 36) + '...\"';\n            warn(ctx.doc.options.logLevel, `Keys with collection values will be stringified due to JS Object restrictions: ${jsonStr}. Set mapAsMap: true to use object keys.`);\n            ctx.mapKeyWarned = true;\n        }\n        return strKey;\n    }\n    return JSON.stringify(jsKey);\n}\n\nexport { addPairToJSMap };\n","import { createNode } from '../doc/createNode.js';\nimport { stringifyPair } from '../stringify/stringifyPair.js';\nimport { addPairToJSMap } from './addPairToJSMap.js';\nimport { NODE_TYPE, PAIR, isNode } from './identity.js';\n\nfunction createPair(key, value, ctx) {\n    const k = createNode(key, undefined, ctx);\n    const v = createNode(value, undefined, ctx);\n    return new Pair(k, v);\n}\nclass Pair {\n    constructor(key, value = null) {\n        Object.defineProperty(this, NODE_TYPE, { value: PAIR });\n        this.key = key;\n        this.value = value;\n    }\n    clone(schema) {\n        let { key, value } = this;\n        if (isNode(key))\n            key = key.clone(schema);\n        if (isNode(value))\n            value = value.clone(schema);\n        return new Pair(key, value);\n    }\n    toJSON(_, ctx) {\n        const pair = ctx?.mapAsMap ? new Map() : {};\n        return addPairToJSMap(ctx, pair, this);\n    }\n    toString(ctx, onComment, onChompKeep) {\n        return ctx?.doc\n            ? stringifyPair(this, ctx, onComment, onChompKeep)\n            : JSON.stringify(this);\n    }\n}\n\nexport { Pair, createPair };\n","import { isNode, isPair } from '../nodes/identity.js';\nimport { stringify } from './stringify.js';\nimport { lineComment, indentComment } from './stringifyComment.js';\n\nfunction stringifyCollection(collection, ctx, options) {\n    const flow = ctx.inFlow ?? collection.flow;\n    const stringify = flow ? stringifyFlowCollection : stringifyBlockCollection;\n    return stringify(collection, ctx, options);\n}\nfunction stringifyBlockCollection({ comment, items }, ctx, { blockItemPrefix, flowChars, itemIndent, onChompKeep, onComment }) {\n    const { indent, options: { commentString } } = ctx;\n    const itemCtx = Object.assign({}, ctx, { indent: itemIndent, type: null });\n    let chompKeep = false; // flag for the preceding node's status\n    const lines = [];\n    for (let i = 0; i < items.length; ++i) {\n        const item = items[i];\n        let comment = null;\n        if (isNode(item)) {\n            if (!chompKeep && item.spaceBefore)\n                lines.push('');\n            addCommentBefore(ctx, lines, item.commentBefore, chompKeep);\n            if (item.comment)\n                comment = item.comment;\n        }\n        else if (isPair(item)) {\n            const ik = isNode(item.key) ? item.key : null;\n            if (ik) {\n                if (!chompKeep && ik.spaceBefore)\n                    lines.push('');\n                addCommentBefore(ctx, lines, ik.commentBefore, chompKeep);\n            }\n        }\n        chompKeep = false;\n        let str = stringify(item, itemCtx, () => (comment = null), () => (chompKeep = true));\n        if (comment)\n            str += lineComment(str, itemIndent, commentString(comment));\n        if (chompKeep && comment)\n            chompKeep = false;\n        lines.push(blockItemPrefix + str);\n    }\n    let str;\n    if (lines.length === 0) {\n        str = flowChars.start + flowChars.end;\n    }\n    else {\n        str = lines[0];\n        for (let i = 1; i < lines.length; ++i) {\n            const line = lines[i];\n            str += line ? `\\n${indent}${line}` : '\\n';\n        }\n    }\n    if (comment) {\n        str += '\\n' + indentComment(commentString(comment), indent);\n        if (onComment)\n            onComment();\n    }\n    else if (chompKeep && onChompKeep)\n        onChompKeep();\n    return str;\n}\nfunction stringifyFlowCollection({ items }, ctx, { flowChars, itemIndent }) {\n    const { indent, indentStep, flowCollectionPadding: fcPadding, options: { commentString } } = ctx;\n    itemIndent += indentStep;\n    const itemCtx = Object.assign({}, ctx, {\n        indent: itemIndent,\n        inFlow: true,\n        type: null\n    });\n    let reqNewline = false;\n    let linesAtValue = 0;\n    const lines = [];\n    for (let i = 0; i < items.length; ++i) {\n        const item = items[i];\n        let comment = null;\n        if (isNode(item)) {\n            if (item.spaceBefore)\n                lines.push('');\n            addCommentBefore(ctx, lines, item.commentBefore, false);\n            if (item.comment)\n                comment = item.comment;\n        }\n        else if (isPair(item)) {\n            const ik = isNode(item.key) ? item.key : null;\n            if (ik) {\n                if (ik.spaceBefore)\n                    lines.push('');\n                addCommentBefore(ctx, lines, ik.commentBefore, false);\n                if (ik.comment)\n                    reqNewline = true;\n            }\n            const iv = isNode(item.value) ? item.value : null;\n            if (iv) {\n                if (iv.comment)\n                    comment = iv.comment;\n                if (iv.commentBefore)\n                    reqNewline = true;\n            }\n            else if (item.value == null && ik?.comment) {\n                comment = ik.comment;\n            }\n        }\n        if (comment)\n            reqNewline = true;\n        let str = stringify(item, itemCtx, () => (comment = null));\n        if (i < items.length - 1)\n            str += ',';\n        if (comment)\n            str += lineComment(str, itemIndent, commentString(comment));\n        if (!reqNewline && (lines.length > linesAtValue || str.includes('\\n')))\n            reqNewline = true;\n        lines.push(str);\n        linesAtValue = lines.length;\n    }\n    const { start, end } = flowChars;\n    if (lines.length === 0) {\n        return start + end;\n    }\n    else {\n        if (!reqNewline) {\n            const len = lines.reduce((sum, line) => sum + line.length + 2, 2);\n            reqNewline = ctx.options.lineWidth > 0 && len > ctx.options.lineWidth;\n        }\n        if (reqNewline) {\n            let str = start;\n            for (const line of lines)\n                str += line ? `\\n${indentStep}${indent}${line}` : '\\n';\n            return `${str}\\n${indent}${end}`;\n        }\n        else {\n            return `${start}${fcPadding}${lines.join(' ')}${fcPadding}${end}`;\n        }\n    }\n}\nfunction addCommentBefore({ indent, options: { commentString } }, lines, comment, chompKeep) {\n    if (comment && chompKeep)\n        comment = comment.replace(/^\\n+/, '');\n    if (comment) {\n        const ic = indentComment(commentString(comment), indent);\n        lines.push(ic.trimStart()); // Avoid double indent on first line\n    }\n}\n\nexport { stringifyCollection };\n","import { stringifyCollection } from '../stringify/stringifyCollection.js';\nimport { addPairToJSMap } from './addPairToJSMap.js';\nimport { Collection } from './Collection.js';\nimport { MAP, isPair, isScalar } from './identity.js';\nimport { Pair, createPair } from './Pair.js';\nimport { isScalarValue } from './Scalar.js';\n\nfunction findPair(items, key) {\n    const k = isScalar(key) ? key.value : key;\n    for (const it of items) {\n        if (isPair(it)) {\n            if (it.key === key || it.key === k)\n                return it;\n            if (isScalar(it.key) && it.key.value === k)\n                return it;\n        }\n    }\n    return undefined;\n}\nclass YAMLMap extends Collection {\n    static get tagName() {\n        return 'tag:yaml.org,2002:map';\n    }\n    constructor(schema) {\n        super(MAP, schema);\n        this.items = [];\n    }\n    /**\n     * A generic collection parsing method that can be extended\n     * to other node classes that inherit from YAMLMap\n     */\n    static from(schema, obj, ctx) {\n        const { keepUndefined, replacer } = ctx;\n        const map = new this(schema);\n        const add = (key, value) => {\n            if (typeof replacer === 'function')\n                value = replacer.call(obj, key, value);\n            else if (Array.isArray(replacer) && !replacer.includes(key))\n                return;\n            if (value !== undefined || keepUndefined)\n                map.items.push(createPair(key, value, ctx));\n        };\n        if (obj instanceof Map) {\n            for (const [key, value] of obj)\n                add(key, value);\n        }\n        else if (obj && typeof obj === 'object') {\n            for (const key of Object.keys(obj))\n                add(key, obj[key]);\n        }\n        if (typeof schema.sortMapEntries === 'function') {\n            map.items.sort(schema.sortMapEntries);\n        }\n        return map;\n    }\n    /**\n     * Adds a value to the collection.\n     *\n     * @param overwrite - If not set `true`, using a key that is already in the\n     *   collection will throw. Otherwise, overwrites the previous value.\n     */\n    add(pair, overwrite) {\n        let _pair;\n        if (isPair(pair))\n            _pair = pair;\n        else if (!pair || typeof pair !== 'object' || !('key' in pair)) {\n            // In TypeScript, this never happens.\n            _pair = new Pair(pair, pair?.value);\n        }\n        else\n            _pair = new Pair(pair.key, pair.value);\n        const prev = findPair(this.items, _pair.key);\n        const sortEntries = this.schema?.sortMapEntries;\n        if (prev) {\n            if (!overwrite)\n                throw new Error(`Key ${_pair.key} already set`);\n            // For scalars, keep the old node & its comments and anchors\n            if (isScalar(prev.value) && isScalarValue(_pair.value))\n                prev.value.value = _pair.value;\n            else\n                prev.value = _pair.value;\n        }\n        else if (sortEntries) {\n            const i = this.items.findIndex(item => sortEntries(_pair, item) < 0);\n            if (i === -1)\n                this.items.push(_pair);\n            else\n                this.items.splice(i, 0, _pair);\n        }\n        else {\n            this.items.push(_pair);\n        }\n    }\n    delete(key) {\n        const it = findPair(this.items, key);\n        if (!it)\n            return false;\n        const del = this.items.splice(this.items.indexOf(it), 1);\n        return del.length > 0;\n    }\n    get(key, keepScalar) {\n        const it = findPair(this.items, key);\n        const node = it?.value;\n        return (!keepScalar && isScalar(node) ? node.value : node) ?? undefined;\n    }\n    has(key) {\n        return !!findPair(this.items, key);\n    }\n    set(key, value) {\n        this.add(new Pair(key, value), true);\n    }\n    /**\n     * @param ctx - Conversion context, originally set in Document#toJS()\n     * @param {Class} Type - If set, forces the returned collection type\n     * @returns Instance of Type, Map, or Object\n     */\n    toJSON(_, ctx, Type) {\n        const map = Type ? new Type() : ctx?.mapAsMap ? new Map() : {};\n        if (ctx?.onCreate)\n            ctx.onCreate(map);\n        for (const item of this.items)\n            addPairToJSMap(ctx, map, item);\n        return map;\n    }\n    toString(ctx, onComment, onChompKeep) {\n        if (!ctx)\n            return JSON.stringify(this);\n        for (const item of this.items) {\n            if (!isPair(item))\n                throw new Error(`Map items must all be pairs; found ${JSON.stringify(item)} instead`);\n        }\n        if (!ctx.allNullValues && this.hasAllNullValues(false))\n            ctx = Object.assign({}, ctx, { allNullValues: true });\n        return stringifyCollection(this, ctx, {\n            blockItemPrefix: '',\n            flowChars: { start: '{', end: '}' },\n            itemIndent: ctx.indent || '',\n            onChompKeep,\n            onComment\n        });\n    }\n}\n\nexport { YAMLMap, findPair };\n","import { isMap } from '../../nodes/identity.js';\nimport { YAMLMap } from '../../nodes/YAMLMap.js';\n\nconst map = {\n    collection: 'map',\n    default: true,\n    nodeClass: YAMLMap,\n    tag: 'tag:yaml.org,2002:map',\n    resolve(map, onError) {\n        if (!isMap(map))\n            onError('Expected a mapping for this tag');\n        return map;\n    },\n    createNode: (schema, obj, ctx) => YAMLMap.from(schema, obj, ctx)\n};\n\nexport { map };\n","import { createNode } from '../doc/createNode.js';\nimport { stringifyCollection } from '../stringify/stringifyCollection.js';\nimport { Collection } from './Collection.js';\nimport { SEQ, isScalar } from './identity.js';\nimport { isScalarValue } from './Scalar.js';\nimport { toJS } from './toJS.js';\n\nclass YAMLSeq extends Collection {\n    static get tagName() {\n        return 'tag:yaml.org,2002:seq';\n    }\n    constructor(schema) {\n        super(SEQ, schema);\n        this.items = [];\n    }\n    add(value) {\n        this.items.push(value);\n    }\n    /**\n     * Removes a value from the collection.\n     *\n     * `key` must contain a representation of an integer for this to succeed.\n     * It may be wrapped in a `Scalar`.\n     *\n     * @returns `true` if the item was found and removed.\n     */\n    delete(key) {\n        const idx = asItemIndex(key);\n        if (typeof idx !== 'number')\n            return false;\n        const del = this.items.splice(idx, 1);\n        return del.length > 0;\n    }\n    get(key, keepScalar) {\n        const idx = asItemIndex(key);\n        if (typeof idx !== 'number')\n            return undefined;\n        const it = this.items[idx];\n        return !keepScalar && isScalar(it) ? it.value : it;\n    }\n    /**\n     * Checks if the collection includes a value with the key `key`.\n     *\n     * `key` must contain a representation of an integer for this to succeed.\n     * It may be wrapped in a `Scalar`.\n     */\n    has(key) {\n        const idx = asItemIndex(key);\n        return typeof idx === 'number' && idx < this.items.length;\n    }\n    /**\n     * Sets a value in this collection. For `!!set`, `value` needs to be a\n     * boolean to add/remove the item from the set.\n     *\n     * If `key` does not contain a representation of an integer, this will throw.\n     * It may be wrapped in a `Scalar`.\n     */\n    set(key, value) {\n        const idx = asItemIndex(key);\n        if (typeof idx !== 'number')\n            throw new Error(`Expected a valid index, not ${key}.`);\n        const prev = this.items[idx];\n        if (isScalar(prev) && isScalarValue(value))\n            prev.value = value;\n        else\n            this.items[idx] = value;\n    }\n    toJSON(_, ctx) {\n        const seq = [];\n        if (ctx?.onCreate)\n            ctx.onCreate(seq);\n        let i = 0;\n        for (const item of this.items)\n            seq.push(toJS(item, String(i++), ctx));\n        return seq;\n    }\n    toString(ctx, onComment, onChompKeep) {\n        if (!ctx)\n            return JSON.stringify(this);\n        return stringifyCollection(this, ctx, {\n            blockItemPrefix: '- ',\n            flowChars: { start: '[', end: ']' },\n            itemIndent: (ctx.indent || '') + '  ',\n            onChompKeep,\n            onComment\n        });\n    }\n    static from(schema, obj, ctx) {\n        const { replacer } = ctx;\n        const seq = new this(schema);\n        if (obj && Symbol.iterator in Object(obj)) {\n            let i = 0;\n            for (let it of obj) {\n                if (typeof replacer === 'function') {\n                    const key = obj instanceof Set ? it : String(i++);\n                    it = replacer.call(obj, key, it);\n                }\n                seq.items.push(createNode(it, undefined, ctx));\n            }\n        }\n        return seq;\n    }\n}\nfunction asItemIndex(key) {\n    let idx = isScalar(key) ? key.value : key;\n    if (idx && typeof idx === 'string')\n        idx = Number(idx);\n    return typeof idx === 'number' && Number.isInteger(idx) && idx >= 0\n        ? idx\n        : null;\n}\n\nexport { YAMLSeq };\n","import { isSeq } from '../../nodes/identity.js';\nimport { YAMLSeq } from '../../nodes/YAMLSeq.js';\n\nconst seq = {\n    collection: 'seq',\n    default: true,\n    nodeClass: YAMLSeq,\n    tag: 'tag:yaml.org,2002:seq',\n    resolve(seq, onError) {\n        if (!isSeq(seq))\n            onError('Expected a sequence for this tag');\n        return seq;\n    },\n    createNode: (schema, obj, ctx) => YAMLSeq.from(schema, obj, ctx)\n};\n\nexport { seq };\n","import { stringifyString } from '../../stringify/stringifyString.js';\n\nconst string = {\n    identify: value => typeof value === 'string',\n    default: true,\n    tag: 'tag:yaml.org,2002:str',\n    resolve: str => str,\n    stringify(item, ctx, onComment, onChompKeep) {\n        ctx = Object.assign({ actualString: true }, ctx);\n        return stringifyString(item, ctx, onComment, onChompKeep);\n    }\n};\n\nexport { string };\n","import { Scalar } from '../../nodes/Scalar.js';\n\nconst nullTag = {\n    identify: value => value == null,\n    createNode: () => new Scalar(null),\n    default: true,\n    tag: 'tag:yaml.org,2002:null',\n    test: /^(?:~|[Nn]ull|NULL)?$/,\n    resolve: () => new Scalar(null),\n    stringify: ({ source }, ctx) => typeof source === 'string' && nullTag.test.test(source)\n        ? source\n        : ctx.options.nullStr\n};\n\nexport { nullTag };\n","import { Scalar } from '../../nodes/Scalar.js';\n\nconst boolTag = {\n    identify: value => typeof value === 'boolean',\n    default: true,\n    tag: 'tag:yaml.org,2002:bool',\n    test: /^(?:[Tt]rue|TRUE|[Ff]alse|FALSE)$/,\n    resolve: str => new Scalar(str[0] === 't' || str[0] === 'T'),\n    stringify({ source, value }, ctx) {\n        if (source && boolTag.test.test(source)) {\n            const sv = source[0] === 't' || source[0] === 'T';\n            if (value === sv)\n                return source;\n        }\n        return value ? ctx.options.trueStr : ctx.options.falseStr;\n    }\n};\n\nexport { boolTag };\n","function stringifyNumber({ format, minFractionDigits, tag, value }) {\n    if (typeof value === 'bigint')\n        return String(value);\n    const num = typeof value === 'number' ? value : Number(value);\n    if (!isFinite(num))\n        return isNaN(num) ? '.nan' : num < 0 ? '-.inf' : '.inf';\n    let n = JSON.stringify(value);\n    if (!format &&\n        minFractionDigits &&\n        (!tag || tag === 'tag:yaml.org,2002:float') &&\n        /^\\d/.test(n)) {\n        let i = n.indexOf('.');\n        if (i < 0) {\n            i = n.length;\n            n += '.';\n        }\n        let d = minFractionDigits - (n.length - i - 1);\n        while (d-- > 0)\n            n += '0';\n    }\n    return n;\n}\n\nexport { stringifyNumber };\n","import { Scalar } from '../../nodes/Scalar.js';\nimport { stringifyNumber } from '../../stringify/stringifyNumber.js';\n\nconst floatNaN = {\n    identify: value => typeof value === 'number',\n    default: true,\n    tag: 'tag:yaml.org,2002:float',\n    test: /^(?:[-+]?\\.(?:inf|Inf|INF)|\\.nan|\\.NaN|\\.NAN)$/,\n    resolve: str => str.slice(-3).toLowerCase() === 'nan'\n        ? NaN\n        : str[0] === '-'\n            ? Number.NEGATIVE_INFINITY\n            : Number.POSITIVE_INFINITY,\n    stringify: stringifyNumber\n};\nconst floatExp = {\n    identify: value => typeof value === 'number',\n    default: true,\n    tag: 'tag:yaml.org,2002:float',\n    format: 'EXP',\n    test: /^[-+]?(?:\\.[0-9]+|[0-9]+(?:\\.[0-9]*)?)[eE][-+]?[0-9]+$/,\n    resolve: str => parseFloat(str),\n    stringify(node) {\n        const num = Number(node.value);\n        return isFinite(num) ? num.toExponential() : stringifyNumber(node);\n    }\n};\nconst float = {\n    identify: value => typeof value === 'number',\n    default: true,\n    tag: 'tag:yaml.org,2002:float',\n    test: /^[-+]?(?:\\.[0-9]+|[0-9]+\\.[0-9]*)$/,\n    resolve(str) {\n        const node = new Scalar(parseFloat(str));\n        const dot = str.indexOf('.');\n        if (dot !== -1 && str[str.length - 1] === '0')\n            node.minFractionDigits = str.length - dot - 1;\n        return node;\n    },\n    stringify: stringifyNumber\n};\n\nexport { float, floatExp, floatNaN };\n","import { stringifyNumber } from '../../stringify/stringifyNumber.js';\n\nconst intIdentify = (value) => typeof value === 'bigint' || Number.isInteger(value);\nconst intResolve = (str, offset, radix, { intAsBigInt }) => (intAsBigInt ? BigInt(str) : parseInt(str.substring(offset), radix));\nfunction intStringify(node, radix, prefix) {\n    const { value } = node;\n    if (intIdentify(value) && value >= 0)\n        return prefix + value.toString(radix);\n    return stringifyNumber(node);\n}\nconst intOct = {\n    identify: value => intIdentify(value) && value >= 0,\n    default: true,\n    tag: 'tag:yaml.org,2002:int',\n    format: 'OCT',\n    test: /^0o[0-7]+$/,\n    resolve: (str, _onError, opt) => intResolve(str, 2, 8, opt),\n    stringify: node => intStringify(node, 8, '0o')\n};\nconst int = {\n    identify: intIdentify,\n    default: true,\n    tag: 'tag:yaml.org,2002:int',\n    test: /^[-+]?[0-9]+$/,\n    resolve: (str, _onError, opt) => intResolve(str, 0, 10, opt),\n    stringify: stringifyNumber\n};\nconst intHex = {\n    identify: value => intIdentify(value) && value >= 0,\n    default: true,\n    tag: 'tag:yaml.org,2002:int',\n    format: 'HEX',\n    test: /^0x[0-9a-fA-F]+$/,\n    resolve: (str, _onError, opt) => intResolve(str, 2, 16, opt),\n    stringify: node => intStringify(node, 16, '0x')\n};\n\nexport { int, intHex, intOct };\n","import { map } from '../common/map.js';\nimport { nullTag } from '../common/null.js';\nimport { seq } from '../common/seq.js';\nimport { string } from '../common/string.js';\nimport { boolTag } from './bool.js';\nimport { floatNaN, floatExp, float } from './float.js';\nimport { intOct, int, intHex } from './int.js';\n\nconst schema = [\n    map,\n    seq,\n    string,\n    nullTag,\n    boolTag,\n    intOct,\n    int,\n    intHex,\n    floatNaN,\n    floatExp,\n    float\n];\n\nexport { schema };\n","import { Scalar } from '../../nodes/Scalar.js';\nimport { map } from '../common/map.js';\nimport { seq } from '../common/seq.js';\n\nfunction intIdentify(value) {\n    return typeof value === 'bigint' || Number.isInteger(value);\n}\nconst stringifyJSON = ({ value }) => JSON.stringify(value);\nconst jsonScalars = [\n    {\n        identify: value => typeof value === 'string',\n        default: true,\n        tag: 'tag:yaml.org,2002:str',\n        resolve: str => str,\n        stringify: stringifyJSON\n    },\n    {\n        identify: value => value == null,\n        createNode: () => new Scalar(null),\n        default: true,\n        tag: 'tag:yaml.org,2002:null',\n        test: /^null$/,\n        resolve: () => null,\n        stringify: stringifyJSON\n    },\n    {\n        identify: value => typeof value === 'boolean',\n        default: true,\n        tag: 'tag:yaml.org,2002:bool',\n        test: /^true$|^false$/,\n        resolve: str => str === 'true',\n        stringify: stringifyJSON\n    },\n    {\n        identify: intIdentify,\n        default: true,\n        tag: 'tag:yaml.org,2002:int',\n        test: /^-?(?:0|[1-9][0-9]*)$/,\n        resolve: (str, _onError, { intAsBigInt }) => intAsBigInt ? BigInt(str) : parseInt(str, 10),\n        stringify: ({ value }) => intIdentify(value) ? value.toString() : JSON.stringify(value)\n    },\n    {\n        identify: value => typeof value === 'number',\n        default: true,\n        tag: 'tag:yaml.org,2002:float',\n        test: /^-?(?:0|[1-9][0-9]*)(?:\\.[0-9]*)?(?:[eE][-+]?[0-9]+)?$/,\n        resolve: str => parseFloat(str),\n        stringify: stringifyJSON\n    }\n];\nconst jsonError = {\n    default: true,\n    tag: '',\n    test: /^/,\n    resolve(str, onError) {\n        onError(`Unresolved plain scalar ${JSON.stringify(str)}`);\n        return str;\n    }\n};\nconst schema = [map, seq].concat(jsonScalars, jsonError);\n\nexport { schema };\n","import { Scalar } from '../../nodes/Scalar.js';\nimport { stringifyString } from '../../stringify/stringifyString.js';\n\nconst binary = {\n    identify: value => value instanceof Uint8Array, // Buffer inherits from Uint8Array\n    default: false,\n    tag: 'tag:yaml.org,2002:binary',\n    /**\n     * Returns a Buffer in node and an Uint8Array in browsers\n     *\n     * To use the resulting buffer as an image, you'll want to do something like:\n     *\n     *   const blob = new Blob([buffer], { type: 'image/jpeg' })\n     *   document.querySelector('#photo').src = URL.createObjectURL(blob)\n     */\n    resolve(src, onError) {\n        if (typeof atob === 'function') {\n            // On IE 11, atob() can't handle newlines\n            const str = atob(src.replace(/[\\n\\r]/g, ''));\n            const buffer = new Uint8Array(str.length);\n            for (let i = 0; i < str.length; ++i)\n                buffer[i] = str.charCodeAt(i);\n            return buffer;\n        }\n        else {\n            onError('This environment does not support reading binary tags; either Buffer or atob is required');\n            return src;\n        }\n    },\n    stringify({ comment, type, value }, ctx, onComment, onChompKeep) {\n        if (!value)\n            return '';\n        const buf = value; // checked earlier by binary.identify()\n        let str;\n        if (typeof btoa === 'function') {\n            let s = '';\n            for (let i = 0; i < buf.length; ++i)\n                s += String.fromCharCode(buf[i]);\n            str = btoa(s);\n        }\n        else {\n            throw new Error('This environment does not support writing binary tags; either Buffer or btoa is required');\n        }\n        type ?? (type = Scalar.BLOCK_LITERAL);\n        if (type !== Scalar.QUOTE_DOUBLE) {\n            const lineWidth = Math.max(ctx.options.lineWidth - ctx.indent.length, ctx.options.minContentWidth);\n            const n = Math.ceil(str.length / lineWidth);\n            const lines = new Array(n);\n            for (let i = 0, o = 0; i < n; ++i, o += lineWidth) {\n                lines[i] = str.substr(o, lineWidth);\n            }\n            str = lines.join(type === Scalar.BLOCK_LITERAL ? '\\n' : ' ');\n        }\n        return stringifyString({ comment, type, value: str }, ctx, onComment, onChompKeep);\n    }\n};\n\nexport { binary };\n","import { isSeq, isPair, isMap } from '../../nodes/identity.js';\nimport { createPair, Pair } from '../../nodes/Pair.js';\nimport { Scalar } from '../../nodes/Scalar.js';\nimport { YAMLSeq } from '../../nodes/YAMLSeq.js';\n\nfunction resolvePairs(seq, onError) {\n    if (isSeq(seq)) {\n        for (let i = 0; i < seq.items.length; ++i) {\n            let item = seq.items[i];\n            if (isPair(item))\n                continue;\n            else if (isMap(item)) {\n                if (item.items.length > 1)\n                    onError('Each pair must have its own sequence indicator');\n                const pair = item.items[0] || new Pair(new Scalar(null));\n                if (item.commentBefore)\n                    pair.key.commentBefore = pair.key.commentBefore\n                        ? `${item.commentBefore}\\n${pair.key.commentBefore}`\n                        : item.commentBefore;\n                if (item.comment) {\n                    const cn = pair.value ?? pair.key;\n                    cn.comment = cn.comment\n                        ? `${item.comment}\\n${cn.comment}`\n                        : item.comment;\n                }\n                item = pair;\n            }\n            seq.items[i] = isPair(item) ? item : new Pair(item);\n        }\n    }\n    else\n        onError('Expected a sequence for this tag');\n    return seq;\n}\nfunction createPairs(schema, iterable, ctx) {\n    const { replacer } = ctx;\n    const pairs = new YAMLSeq(schema);\n    pairs.tag = 'tag:yaml.org,2002:pairs';\n    let i = 0;\n    if (iterable && Symbol.iterator in Object(iterable))\n        for (let it of iterable) {\n            if (typeof replacer === 'function')\n                it = replacer.call(iterable, String(i++), it);\n            let key, value;\n            if (Array.isArray(it)) {\n                if (it.length === 2) {\n                    key = it[0];\n                    value = it[1];\n                }\n                else\n                    throw new TypeError(`Expected [key, value] tuple: ${it}`);\n            }\n            else if (it && it instanceof Object) {\n                const keys = Object.keys(it);\n                if (keys.length === 1) {\n                    key = keys[0];\n                    value = it[key];\n                }\n                else {\n                    throw new TypeError(`Expected tuple with one key, not ${keys.length} keys`);\n                }\n            }\n            else {\n                key = it;\n            }\n            pairs.items.push(createPair(key, value, ctx));\n        }\n    return pairs;\n}\nconst pairs = {\n    collection: 'seq',\n    default: false,\n    tag: 'tag:yaml.org,2002:pairs',\n    resolve: resolvePairs,\n    createNode: createPairs\n};\n\nexport { createPairs, pairs, resolvePairs };\n","import { isScalar, isPair } from '../../nodes/identity.js';\nimport { toJS } from '../../nodes/toJS.js';\nimport { YAMLMap } from '../../nodes/YAMLMap.js';\nimport { YAMLSeq } from '../../nodes/YAMLSeq.js';\nimport { resolvePairs, createPairs } from './pairs.js';\n\nclass YAMLOMap extends YAMLSeq {\n    constructor() {\n        super();\n        this.add = YAMLMap.prototype.add.bind(this);\n        this.delete = YAMLMap.prototype.delete.bind(this);\n        this.get = YAMLMap.prototype.get.bind(this);\n        this.has = YAMLMap.prototype.has.bind(this);\n        this.set = YAMLMap.prototype.set.bind(this);\n        this.tag = YAMLOMap.tag;\n    }\n    /**\n     * If `ctx` is given, the return type is actually `Map<unknown, unknown>`,\n     * but TypeScript won't allow widening the signature of a child method.\n     */\n    toJSON(_, ctx) {\n        if (!ctx)\n            return super.toJSON(_);\n        const map = new Map();\n        if (ctx?.onCreate)\n            ctx.onCreate(map);\n        for (const pair of this.items) {\n            let key, value;\n            if (isPair(pair)) {\n                key = toJS(pair.key, '', ctx);\n                value = toJS(pair.value, key, ctx);\n            }\n            else {\n                key = toJS(pair, '', ctx);\n            }\n            if (map.has(key))\n                throw new Error('Ordered maps must not include duplicate keys');\n            map.set(key, value);\n        }\n        return map;\n    }\n    static from(schema, iterable, ctx) {\n        const pairs = createPairs(schema, iterable, ctx);\n        const omap = new this();\n        omap.items = pairs.items;\n        return omap;\n    }\n}\nYAMLOMap.tag = 'tag:yaml.org,2002:omap';\nconst omap = {\n    collection: 'seq',\n    identify: value => value instanceof Map,\n    nodeClass: YAMLOMap,\n    default: false,\n    tag: 'tag:yaml.org,2002:omap',\n    resolve(seq, onError) {\n        const pairs = resolvePairs(seq, onError);\n        const seenKeys = [];\n        for (const { key } of pairs.items) {\n            if (isScalar(key)) {\n                if (seenKeys.includes(key.value)) {\n                    onError(`Ordered maps must not include duplicate keys: ${key.value}`);\n                }\n                else {\n                    seenKeys.push(key.value);\n                }\n            }\n        }\n        return Object.assign(new YAMLOMap(), pairs);\n    },\n    createNode: (schema, iterable, ctx) => YAMLOMap.from(schema, iterable, ctx)\n};\n\nexport { YAMLOMap, omap };\n","import { Scalar } from '../../nodes/Scalar.js';\n\nfunction boolStringify({ value, source }, ctx) {\n    const boolObj = value ? trueTag : falseTag;\n    if (source && boolObj.test.test(source))\n        return source;\n    return value ? ctx.options.trueStr : ctx.options.falseStr;\n}\nconst trueTag = {\n    identify: value => value === true,\n    default: true,\n    tag: 'tag:yaml.org,2002:bool',\n    test: /^(?:Y|y|[Yy]es|YES|[Tt]rue|TRUE|[Oo]n|ON)$/,\n    resolve: () => new Scalar(true),\n    stringify: boolStringify\n};\nconst falseTag = {\n    identify: value => value === false,\n    default: true,\n    tag: 'tag:yaml.org,2002:bool',\n    test: /^(?:N|n|[Nn]o|NO|[Ff]alse|FALSE|[Oo]ff|OFF)$/,\n    resolve: () => new Scalar(false),\n    stringify: boolStringify\n};\n\nexport { falseTag, trueTag };\n","import { Scalar } from '../../nodes/Scalar.js';\nimport { stringifyNumber } from '../../stringify/stringifyNumber.js';\n\nconst floatNaN = {\n    identify: value => typeof value === 'number',\n    default: true,\n    tag: 'tag:yaml.org,2002:float',\n    test: /^(?:[-+]?\\.(?:inf|Inf|INF)|\\.nan|\\.NaN|\\.NAN)$/,\n    resolve: (str) => str.slice(-3).toLowerCase() === 'nan'\n        ? NaN\n        : str[0] === '-'\n            ? Number.NEGATIVE_INFINITY\n            : Number.POSITIVE_INFINITY,\n    stringify: stringifyNumber\n};\nconst floatExp = {\n    identify: value => typeof value === 'number',\n    default: true,\n    tag: 'tag:yaml.org,2002:float',\n    format: 'EXP',\n    test: /^[-+]?(?:[0-9][0-9_]*)?(?:\\.[0-9_]*)?[eE][-+]?[0-9]+$/,\n    resolve: (str) => parseFloat(str.replace(/_/g, '')),\n    stringify(node) {\n        const num = Number(node.value);\n        return isFinite(num) ? num.toExponential() : stringifyNumber(node);\n    }\n};\nconst float = {\n    identify: value => typeof value === 'number',\n    default: true,\n    tag: 'tag:yaml.org,2002:float',\n    test: /^[-+]?(?:[0-9][0-9_]*)?\\.[0-9_]*$/,\n    resolve(str) {\n        const node = new Scalar(parseFloat(str.replace(/_/g, '')));\n        const dot = str.indexOf('.');\n        if (dot !== -1) {\n            const f = str.substring(dot + 1).replace(/_/g, '');\n            if (f[f.length - 1] === '0')\n                node.minFractionDigits = f.length;\n        }\n        return node;\n    },\n    stringify: stringifyNumber\n};\n\nexport { float, floatExp, floatNaN };\n","import { stringifyNumber } from '../../stringify/stringifyNumber.js';\n\nconst intIdentify = (value) => typeof value === 'bigint' || Number.isInteger(value);\nfunction intResolve(str, offset, radix, { intAsBigInt }) {\n    const sign = str[0];\n    if (sign === '-' || sign === '+')\n        offset += 1;\n    str = str.substring(offset).replace(/_/g, '');\n    if (intAsBigInt) {\n        switch (radix) {\n            case 2:\n                str = `0b${str}`;\n                break;\n            case 8:\n                str = `0o${str}`;\n                break;\n            case 16:\n                str = `0x${str}`;\n                break;\n        }\n        const n = BigInt(str);\n        return sign === '-' ? BigInt(-1) * n : n;\n    }\n    const n = parseInt(str, radix);\n    return sign === '-' ? -1 * n : n;\n}\nfunction intStringify(node, radix, prefix) {\n    const { value } = node;\n    if (intIdentify(value)) {\n        const str = value.toString(radix);\n        return value < 0 ? '-' + prefix + str.substr(1) : prefix + str;\n    }\n    return stringifyNumber(node);\n}\nconst intBin = {\n    identify: intIdentify,\n    default: true,\n    tag: 'tag:yaml.org,2002:int',\n    format: 'BIN',\n    test: /^[-+]?0b[0-1_]+$/,\n    resolve: (str, _onError, opt) => intResolve(str, 2, 2, opt),\n    stringify: node => intStringify(node, 2, '0b')\n};\nconst intOct = {\n    identify: intIdentify,\n    default: true,\n    tag: 'tag:yaml.org,2002:int',\n    format: 'OCT',\n    test: /^[-+]?0[0-7_]+$/,\n    resolve: (str, _onError, opt) => intResolve(str, 1, 8, opt),\n    stringify: node => intStringify(node, 8, '0')\n};\nconst int = {\n    identify: intIdentify,\n    default: true,\n    tag: 'tag:yaml.org,2002:int',\n    test: /^[-+]?[0-9][0-9_]*$/,\n    resolve: (str, _onError, opt) => intResolve(str, 0, 10, opt),\n    stringify: stringifyNumber\n};\nconst intHex = {\n    identify: intIdentify,\n    default: true,\n    tag: 'tag:yaml.org,2002:int',\n    format: 'HEX',\n    test: /^[-+]?0x[0-9a-fA-F_]+$/,\n    resolve: (str, _onError, opt) => intResolve(str, 2, 16, opt),\n    stringify: node => intStringify(node, 16, '0x')\n};\n\nexport { int, intBin, intHex, intOct };\n","import { isMap, isPair, isScalar } from '../../nodes/identity.js';\nimport { Pair, createPair } from '../../nodes/Pair.js';\nimport { YAMLMap, findPair } from '../../nodes/YAMLMap.js';\n\nclass YAMLSet extends YAMLMap {\n    constructor(schema) {\n        super(schema);\n        this.tag = YAMLSet.tag;\n    }\n    add(key) {\n        let pair;\n        if (isPair(key))\n            pair = key;\n        else if (key &&\n            typeof key === 'object' &&\n            'key' in key &&\n            'value' in key &&\n            key.value === null)\n            pair = new Pair(key.key, null);\n        else\n            pair = new Pair(key, null);\n        const prev = findPair(this.items, pair.key);\n        if (!prev)\n            this.items.push(pair);\n    }\n    /**\n     * If `keepPair` is `true`, returns the Pair matching `key`.\n     * Otherwise, returns the value of that Pair's key.\n     */\n    get(key, keepPair) {\n        const pair = findPair(this.items, key);\n        return !keepPair && isPair(pair)\n            ? isScalar(pair.key)\n                ? pair.key.value\n                : pair.key\n            : pair;\n    }\n    set(key, value) {\n        if (typeof value !== 'boolean')\n            throw new Error(`Expected boolean value for set(key, value) in a YAML set, not ${typeof value}`);\n        const prev = findPair(this.items, key);\n        if (prev && !value) {\n            this.items.splice(this.items.indexOf(prev), 1);\n        }\n        else if (!prev && value) {\n            this.items.push(new Pair(key));\n        }\n    }\n    toJSON(_, ctx) {\n        return super.toJSON(_, ctx, Set);\n    }\n    toString(ctx, onComment, onChompKeep) {\n        if (!ctx)\n            return JSON.stringify(this);\n        if (this.hasAllNullValues(true))\n            return super.toString(Object.assign({}, ctx, { allNullValues: true }), onComment, onChompKeep);\n        else\n            throw new Error('Set items must all have null values');\n    }\n    static from(schema, iterable, ctx) {\n        const { replacer } = ctx;\n        const set = new this(schema);\n        if (iterable && Symbol.iterator in Object(iterable))\n            for (let value of iterable) {\n                if (typeof replacer === 'function')\n                    value = replacer.call(iterable, value, value);\n                set.items.push(createPair(value, null, ctx));\n            }\n        return set;\n    }\n}\nYAMLSet.tag = 'tag:yaml.org,2002:set';\nconst set = {\n    collection: 'map',\n    identify: value => value instanceof Set,\n    nodeClass: YAMLSet,\n    default: false,\n    tag: 'tag:yaml.org,2002:set',\n    createNode: (schema, iterable, ctx) => YAMLSet.from(schema, iterable, ctx),\n    resolve(map, onError) {\n        if (isMap(map)) {\n            if (map.hasAllNullValues(true))\n                return Object.assign(new YAMLSet(), map);\n            else\n                onError('Set items must all have null values');\n        }\n        else\n            onError('Expected a mapping for this tag');\n        return map;\n    }\n};\n\nexport { YAMLSet, set };\n","import { stringifyNumber } from '../../stringify/stringifyNumber.js';\n\n/** Internal types handle bigint as number, because TS can't figure it out. */\nfunction parseSexagesimal(str, asBigInt) {\n    const sign = str[0];\n    const parts = sign === '-' || sign === '+' ? str.substring(1) : str;\n    const num = (n) => asBigInt ? BigInt(n) : Number(n);\n    const res = parts\n        .replace(/_/g, '')\n        .split(':')\n        .reduce((res, p) => res * num(60) + num(p), num(0));\n    return (sign === '-' ? num(-1) * res : res);\n}\n/**\n * hhhh:mm:ss.sss\n *\n * Internal types handle bigint as number, because TS can't figure it out.\n */\nfunction stringifySexagesimal(node) {\n    let { value } = node;\n    let num = (n) => n;\n    if (typeof value === 'bigint')\n        num = n => BigInt(n);\n    else if (isNaN(value) || !isFinite(value))\n        return stringifyNumber(node);\n    let sign = '';\n    if (value < 0) {\n        sign = '-';\n        value *= num(-1);\n    }\n    const _60 = num(60);\n    const parts = [value % _60]; // seconds, including ms\n    if (value < 60) {\n        parts.unshift(0); // at least one : is required\n    }\n    else {\n        value = (value - parts[0]) / _60;\n        parts.unshift(value % _60); // minutes\n        if (value >= 60) {\n            value = (value - parts[0]) / _60;\n            parts.unshift(value); // hours\n        }\n    }\n    return (sign +\n        parts\n            .map(n => String(n).padStart(2, '0'))\n            .join(':')\n            .replace(/000000\\d*$/, '') // % 60 may introduce error\n    );\n}\nconst intTime = {\n    identify: value => typeof value === 'bigint' || Number.isInteger(value),\n    default: true,\n    tag: 'tag:yaml.org,2002:int',\n    format: 'TIME',\n    test: /^[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+$/,\n    resolve: (str, _onError, { intAsBigInt }) => parseSexagesimal(str, intAsBigInt),\n    stringify: stringifySexagesimal\n};\nconst floatTime = {\n    identify: value => typeof value === 'number',\n    default: true,\n    tag: 'tag:yaml.org,2002:float',\n    format: 'TIME',\n    test: /^[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+\\.[0-9_]*$/,\n    resolve: str => parseSexagesimal(str, false),\n    stringify: stringifySexagesimal\n};\nconst timestamp = {\n    identify: value => value instanceof Date,\n    default: true,\n    tag: 'tag:yaml.org,2002:timestamp',\n    // If the time zone is omitted, the timestamp is assumed to be specified in UTC. The time part\n    // may be omitted altogether, resulting in a date format. In such a case, the time part is\n    // assumed to be 00:00:00Z (start of day, UTC).\n    test: RegExp('^([0-9]{4})-([0-9]{1,2})-([0-9]{1,2})' + // YYYY-Mm-Dd\n        '(?:' + // time is optional\n        '(?:t|T|[ \\\\t]+)' + // t | T | whitespace\n        '([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2}(\\\\.[0-9]+)?)' + // Hh:Mm:Ss(.ss)?\n        '(?:[ \\\\t]*(Z|[-+][012]?[0-9](?::[0-9]{2})?))?' + // Z | +5 | -03:30\n        ')?$'),\n    resolve(str) {\n        const match = str.match(timestamp.test);\n        if (!match)\n            throw new Error('!!timestamp expects a date, starting with yyyy-mm-dd');\n        const [, year, month, day, hour, minute, second] = match.map(Number);\n        const millisec = match[7] ? Number((match[7] + '00').substr(1, 3)) : 0;\n        let date = Date.UTC(year, month - 1, day, hour || 0, minute || 0, second || 0, millisec);\n        const tz = match[8];\n        if (tz && tz !== 'Z') {\n            let d = parseSexagesimal(tz, false);\n            if (Math.abs(d) < 30)\n                d *= 60;\n            date -= 60000 * d;\n        }\n        return new Date(date);\n    },\n    stringify: ({ value }) => value?.toISOString().replace(/(T00:00:00)?\\.000Z$/, '') ?? ''\n};\n\nexport { floatTime, intTime, timestamp };\n","import { map } from '../common/map.js';\nimport { nullTag } from '../common/null.js';\nimport { seq } from '../common/seq.js';\nimport { string } from '../common/string.js';\nimport { binary } from './binary.js';\nimport { trueTag, falseTag } from './bool.js';\nimport { floatNaN, floatExp, float } from './float.js';\nimport { intBin, intOct, int, intHex } from './int.js';\nimport { merge } from './merge.js';\nimport { omap } from './omap.js';\nimport { pairs } from './pairs.js';\nimport { set } from './set.js';\nimport { intTime, floatTime, timestamp } from './timestamp.js';\n\nconst schema = [\n    map,\n    seq,\n    string,\n    nullTag,\n    trueTag,\n    falseTag,\n    intBin,\n    intOct,\n    int,\n    intHex,\n    floatNaN,\n    floatExp,\n    float,\n    binary,\n    merge,\n    omap,\n    pairs,\n    set,\n    intTime,\n    floatTime,\n    timestamp\n];\n\nexport { schema };\n","import { map } from './common/map.js';\nimport { nullTag } from './common/null.js';\nimport { seq } from './common/seq.js';\nimport { string } from './common/string.js';\nimport { boolTag } from './core/bool.js';\nimport { floatNaN, floatExp, float } from './core/float.js';\nimport { intOct, intHex, int } from './core/int.js';\nimport { schema } from './core/schema.js';\nimport { schema as schema$1 } from './json/schema.js';\nimport { binary } from './yaml-1.1/binary.js';\nimport { merge } from './yaml-1.1/merge.js';\nimport { omap } from './yaml-1.1/omap.js';\nimport { pairs } from './yaml-1.1/pairs.js';\nimport { schema as schema$2 } from './yaml-1.1/schema.js';\nimport { set } from './yaml-1.1/set.js';\nimport { timestamp, intTime, floatTime } from './yaml-1.1/timestamp.js';\n\nconst schemas = new Map([\n    ['core', schema],\n    ['failsafe', [map, seq, string]],\n    ['json', schema$1],\n    ['yaml11', schema$2],\n    ['yaml-1.1', schema$2]\n]);\nconst tagsByName = {\n    binary,\n    bool: boolTag,\n    float,\n    floatExp,\n    floatNaN,\n    floatTime,\n    int,\n    intHex,\n    intOct,\n    intTime,\n    map,\n    merge,\n    null: nullTag,\n    omap,\n    pairs,\n    seq,\n    set,\n    timestamp\n};\nconst coreKnownTags = {\n    'tag:yaml.org,2002:binary': binary,\n    'tag:yaml.org,2002:merge': merge,\n    'tag:yaml.org,2002:omap': omap,\n    'tag:yaml.org,2002:pairs': pairs,\n    'tag:yaml.org,2002:set': set,\n    'tag:yaml.org,2002:timestamp': timestamp\n};\nfunction getTags(customTags, schemaName, addMergeTag) {\n    const schemaTags = schemas.get(schemaName);\n    if (schemaTags && !customTags) {\n        return addMergeTag && !schemaTags.includes(merge)\n            ? schemaTags.concat(merge)\n            : schemaTags.slice();\n    }\n    let tags = schemaTags;\n    if (!tags) {\n        if (Array.isArray(customTags))\n            tags = [];\n        else {\n            const keys = Array.from(schemas.keys())\n                .filter(key => key !== 'yaml11')\n                .map(key => JSON.stringify(key))\n                .join(', ');\n            throw new Error(`Unknown schema \"${schemaName}\"; use one of ${keys} or define customTags array`);\n        }\n    }\n    if (Array.isArray(customTags)) {\n        for (const tag of customTags)\n            tags = tags.concat(tag);\n    }\n    else if (typeof customTags === 'function') {\n        tags = customTags(tags.slice());\n    }\n    if (addMergeTag)\n        tags = tags.concat(merge);\n    return tags.reduce((tags, tag) => {\n        const tagObj = typeof tag === 'string' ? tagsByName[tag] : tag;\n        if (!tagObj) {\n            const tagName = JSON.stringify(tag);\n            const keys = Object.keys(tagsByName)\n                .map(key => JSON.stringify(key))\n                .join(', ');\n            throw new Error(`Unknown custom tag ${tagName}; use one of ${keys}`);\n        }\n        if (!tags.includes(tagObj))\n            tags.push(tagObj);\n        return tags;\n    }, []);\n}\n\nexport { coreKnownTags, getTags };\n","import { MAP, SCALAR, SEQ } from '../nodes/identity.js';\nimport { map } from './common/map.js';\nimport { seq } from './common/seq.js';\nimport { string } from './common/string.js';\nimport { getTags, coreKnownTags } from './tags.js';\n\nconst sortMapEntriesByKey = (a, b) => a.key < b.key ? -1 : a.key > b.key ? 1 : 0;\nclass Schema {\n    constructor({ compat, customTags, merge, resolveKnownTags, schema, sortMapEntries, toStringDefaults }) {\n        this.compat = Array.isArray(compat)\n            ? getTags(compat, 'compat')\n            : compat\n                ? getTags(null, compat)\n                : null;\n        this.name = (typeof schema === 'string' && schema) || 'core';\n        this.knownTags = resolveKnownTags ? coreKnownTags : {};\n        this.tags = getTags(customTags, this.name, merge);\n        this.toStringOptions = toStringDefaults ?? null;\n        Object.defineProperty(this, MAP, { value: map });\n        Object.defineProperty(this, SCALAR, { value: string });\n        Object.defineProperty(this, SEQ, { value: seq });\n        // Used by createMap()\n        this.sortMapEntries =\n            typeof sortMapEntries === 'function'\n                ? sortMapEntries\n                : sortMapEntries === true\n                    ? sortMapEntriesByKey\n                    : null;\n    }\n    clone() {\n        const copy = Object.create(Schema.prototype, Object.getOwnPropertyDescriptors(this));\n        copy.tags = this.tags.slice();\n        return copy;\n    }\n}\n\nexport { Schema };\n","import { isNode } from '../nodes/identity.js';\nimport { createStringifyContext, stringify } from './stringify.js';\nimport { indentComment, lineComment } from './stringifyComment.js';\n\nfunction stringifyDocument(doc, options) {\n    const lines = [];\n    let hasDirectives = options.directives === true;\n    if (options.directives !== false && doc.directives) {\n        const dir = doc.directives.toString(doc);\n        if (dir) {\n            lines.push(dir);\n            hasDirectives = true;\n        }\n        else if (doc.directives.docStart)\n            hasDirectives = true;\n    }\n    if (hasDirectives)\n        lines.push('---');\n    const ctx = createStringifyContext(doc, options);\n    const { commentString } = ctx.options;\n    if (doc.commentBefore) {\n        if (lines.length !== 1)\n            lines.unshift('');\n        const cs = commentString(doc.commentBefore);\n        lines.unshift(indentComment(cs, ''));\n    }\n    let chompKeep = false;\n    let contentComment = null;\n    if (doc.contents) {\n        if (isNode(doc.contents)) {\n            if (doc.contents.spaceBefore && hasDirectives)\n                lines.push('');\n            if (doc.contents.commentBefore) {\n                const cs = commentString(doc.contents.commentBefore);\n                lines.push(indentComment(cs, ''));\n            }\n            // top-level block scalars need to be indented if followed by a comment\n            ctx.forceBlockIndent = !!doc.comment;\n            contentComment = doc.contents.comment;\n        }\n        const onChompKeep = contentComment ? undefined : () => (chompKeep = true);\n        let body = stringify(doc.contents, ctx, () => (contentComment = null), onChompKeep);\n        if (contentComment)\n            body += lineComment(body, '', commentString(contentComment));\n        if ((body[0] === '|' || body[0] === '>') &&\n            lines[lines.length - 1] === '---') {\n            // Top-level block scalars with a preceding doc marker ought to use the\n            // same line for their header.\n            lines[lines.length - 1] = `--- ${body}`;\n        }\n        else\n            lines.push(body);\n    }\n    else {\n        lines.push(stringify(doc.contents, ctx));\n    }\n    if (doc.directives?.docEnd) {\n        if (doc.comment) {\n            const cs = commentString(doc.comment);\n            if (cs.includes('\\n')) {\n                lines.push('...');\n                lines.push(indentComment(cs, ''));\n            }\n            else {\n                lines.push(`... ${cs}`);\n            }\n        }\n        else {\n            lines.push('...');\n        }\n    }\n    else {\n        let dc = doc.comment;\n        if (dc && chompKeep)\n            dc = dc.replace(/^\\n+/, '');\n        if (dc) {\n            if ((!chompKeep || contentComment) && lines[lines.length - 1] !== '')\n                lines.push('');\n            lines.push(indentComment(commentString(dc), ''));\n        }\n    }\n    return lines.join('\\n') + '\\n';\n}\n\nexport { stringifyDocument };\n","import { Alias } from '../nodes/Alias.js';\nimport { isEmptyPath, collectionFromPath } from '../nodes/Collection.js';\nimport { NODE_TYPE, DOC, isNode, isCollection, isScalar } from '../nodes/identity.js';\nimport { Pair } from '../nodes/Pair.js';\nimport { toJS } from '../nodes/toJS.js';\nimport { Schema } from '../schema/Schema.js';\nimport { stringifyDocument } from '../stringify/stringifyDocument.js';\nimport { anchorNames, findNewAnchor, createNodeAnchors } from './anchors.js';\nimport { applyReviver } from './applyReviver.js';\nimport { createNode } from './createNode.js';\nimport { Directives } from './directives.js';\n\nclass Document {\n    constructor(value, replacer, options) {\n        /** A comment before this Document */\n        this.commentBefore = null;\n        /** A comment immediately after this Document */\n        this.comment = null;\n        /** Errors encountered during parsing. */\n        this.errors = [];\n        /** Warnings encountered during parsing. */\n        this.warnings = [];\n        Object.defineProperty(this, NODE_TYPE, { value: DOC });\n        let _replacer = null;\n        if (typeof replacer === 'function' || Array.isArray(replacer)) {\n            _replacer = replacer;\n        }\n        else if (options === undefined && replacer) {\n            options = replacer;\n            replacer = undefined;\n        }\n        const opt = Object.assign({\n            intAsBigInt: false,\n            keepSourceTokens: false,\n            logLevel: 'warn',\n            prettyErrors: true,\n            strict: true,\n            stringKeys: false,\n            uniqueKeys: true,\n            version: '1.2'\n        }, options);\n        this.options = opt;\n        let { version } = opt;\n        if (options?._directives) {\n            this.directives = options._directives.atDocument();\n            if (this.directives.yaml.explicit)\n                version = this.directives.yaml.version;\n        }\n        else\n            this.directives = new Directives({ version });\n        this.setSchema(version, options);\n        // @ts-expect-error We can't really know that this matches Contents.\n        this.contents =\n            value === undefined ? null : this.createNode(value, _replacer, options);\n    }\n    /**\n     * Create a deep copy of this Document and its contents.\n     *\n     * Custom Node values that inherit from `Object` still refer to their original instances.\n     */\n    clone() {\n        const copy = Object.create(Document.prototype, {\n            [NODE_TYPE]: { value: DOC }\n        });\n        copy.commentBefore = this.commentBefore;\n        copy.comment = this.comment;\n        copy.errors = this.errors.slice();\n        copy.warnings = this.warnings.slice();\n        copy.options = Object.assign({}, this.options);\n        if (this.directives)\n            copy.directives = this.directives.clone();\n        copy.schema = this.schema.clone();\n        // @ts-expect-error We can't really know that this matches Contents.\n        copy.contents = isNode(this.contents)\n            ? this.contents.clone(copy.schema)\n            : this.contents;\n        if (this.range)\n            copy.range = this.range.slice();\n        return copy;\n    }\n    /** Adds a value to the document. */\n    add(value) {\n        if (assertCollection(this.contents))\n            this.contents.add(value);\n    }\n    /** Adds a value to the document. */\n    addIn(path, value) {\n        if (assertCollection(this.contents))\n            this.contents.addIn(path, value);\n    }\n    /**\n     * Create a new `Alias` node, ensuring that the target `node` has the required anchor.\n     *\n     * If `node` already has an anchor, `name` is ignored.\n     * Otherwise, the `node.anchor` value will be set to `name`,\n     * or if an anchor with that name is already present in the document,\n     * `name` will be used as a prefix for a new unique anchor.\n     * If `name` is undefined, the generated anchor will use 'a' as a prefix.\n     */\n    createAlias(node, name) {\n        if (!node.anchor) {\n            const prev = anchorNames(this);\n            node.anchor =\n                // eslint-disable-next-line @typescript-eslint/prefer-nullish-coalescing\n                !name || prev.has(name) ? findNewAnchor(name || 'a', prev) : name;\n        }\n        return new Alias(node.anchor);\n    }\n    createNode(value, replacer, options) {\n        let _replacer = undefined;\n        if (typeof replacer === 'function') {\n            value = replacer.call({ '': value }, '', value);\n            _replacer = replacer;\n        }\n        else if (Array.isArray(replacer)) {\n            const keyToStr = (v) => typeof v === 'number' || v instanceof String || v instanceof Number;\n            const asStr = replacer.filter(keyToStr).map(String);\n            if (asStr.length > 0)\n                replacer = replacer.concat(asStr);\n            _replacer = replacer;\n        }\n        else if (options === undefined && replacer) {\n            options = replacer;\n            replacer = undefined;\n        }\n        const { aliasDuplicateObjects, anchorPrefix, flow, keepUndefined, onTagObj, tag } = options ?? {};\n        const { onAnchor, setAnchors, sourceObjects } = createNodeAnchors(this, \n        // eslint-disable-next-line @typescript-eslint/prefer-nullish-coalescing\n        anchorPrefix || 'a');\n        const ctx = {\n            aliasDuplicateObjects: aliasDuplicateObjects ?? true,\n            keepUndefined: keepUndefined ?? false,\n            onAnchor,\n            onTagObj,\n            replacer: _replacer,\n            schema: this.schema,\n            sourceObjects\n        };\n        const node = createNode(value, tag, ctx);\n        if (flow && isCollection(node))\n            node.flow = true;\n        setAnchors();\n        return node;\n    }\n    /**\n     * Convert a key and a value into a `Pair` using the current schema,\n     * recursively wrapping all values as `Scalar` or `Collection` nodes.\n     */\n    createPair(key, value, options = {}) {\n        const k = this.createNode(key, null, options);\n        const v = this.createNode(value, null, options);\n        return new Pair(k, v);\n    }\n    /**\n     * Removes a value from the document.\n     * @returns `true` if the item was found and removed.\n     */\n    delete(key) {\n        return assertCollection(this.contents) ? this.contents.delete(key) : false;\n    }\n    /**\n     * Removes a value from the document.\n     * @returns `true` if the item was found and removed.\n     */\n    deleteIn(path) {\n        if (isEmptyPath(path)) {\n            if (this.contents == null)\n                return false;\n            // @ts-expect-error Presumed impossible if Strict extends false\n            this.contents = null;\n            return true;\n        }\n        return assertCollection(this.contents)\n            ? this.contents.deleteIn(path)\n            : false;\n    }\n    /**\n     * Returns item at `key`, or `undefined` if not found. By default unwraps\n     * scalar values from their surrounding node; to disable set `keepScalar` to\n     * `true` (collections are always returned intact).\n     */\n    get(key, keepScalar) {\n        return isCollection(this.contents)\n            ? this.contents.get(key, keepScalar)\n            : undefined;\n    }\n    /**\n     * Returns item at `path`, or `undefined` if not found. By default unwraps\n     * scalar values from their surrounding node; to disable set `keepScalar` to\n     * `true` (collections are always returned intact).\n     */\n    getIn(path, keepScalar) {\n        if (isEmptyPath(path))\n            return !keepScalar && isScalar(this.contents)\n                ? this.contents.value\n                : this.contents;\n        return isCollection(this.contents)\n            ? this.contents.getIn(path, keepScalar)\n            : undefined;\n    }\n    /**\n     * Checks if the document includes a value with the key `key`.\n     */\n    has(key) {\n        return isCollection(this.contents) ? this.contents.has(key) : false;\n    }\n    /**\n     * Checks if the document includes a value at `path`.\n     */\n    hasIn(path) {\n        if (isEmptyPath(path))\n            return this.contents !== undefined;\n        return isCollection(this.contents) ? this.contents.hasIn(path) : false;\n    }\n    /**\n     * Sets a value in this document. For `!!set`, `value` needs to be a\n     * boolean to add/remove the item from the set.\n     */\n    set(key, value) {\n        if (this.contents == null) {\n            // @ts-expect-error We can't really know that this matches Contents.\n            this.contents = collectionFromPath(this.schema, [key], value);\n        }\n        else if (assertCollection(this.contents)) {\n            this.contents.set(key, value);\n        }\n    }\n    /**\n     * Sets a value in this document. For `!!set`, `value` needs to be a\n     * boolean to add/remove the item from the set.\n     */\n    setIn(path, value) {\n        if (isEmptyPath(path)) {\n            // @ts-expect-error We can't really know that this matches Contents.\n            this.contents = value;\n        }\n        else if (this.contents == null) {\n            // @ts-expect-error We can't really know that this matches Contents.\n            this.contents = collectionFromPath(this.schema, Array.from(path), value);\n        }\n        else if (assertCollection(this.contents)) {\n            this.contents.setIn(path, value);\n        }\n    }\n    /**\n     * Change the YAML version and schema used by the document.\n     * A `null` version disables support for directives, explicit tags, anchors, and aliases.\n     * It also requires the `schema` option to be given as a `Schema` instance value.\n     *\n     * Overrides all previously set schema options.\n     */\n    setSchema(version, options = {}) {\n        if (typeof version === 'number')\n            version = String(version);\n        let opt;\n        switch (version) {\n            case '1.1':\n                if (this.directives)\n                    this.directives.yaml.version = '1.1';\n                else\n                    this.directives = new Directives({ version: '1.1' });\n                opt = { resolveKnownTags: false, schema: 'yaml-1.1' };\n                break;\n            case '1.2':\n            case 'next':\n                if (this.directives)\n                    this.directives.yaml.version = version;\n                else\n                    this.directives = new Directives({ version });\n                opt = { resolveKnownTags: true, schema: 'core' };\n                break;\n            case null:\n                if (this.directives)\n                    delete this.directives;\n                opt = null;\n                break;\n            default: {\n                const sv = JSON.stringify(version);\n                throw new Error(`Expected '1.1', '1.2' or null as first argument, but found: ${sv}`);\n            }\n        }\n        // Not using `instanceof Schema` to allow for duck typing\n        if (options.schema instanceof Object)\n            this.schema = options.schema;\n        else if (opt)\n            this.schema = new Schema(Object.assign(opt, options));\n        else\n            throw new Error(`With a null YAML version, the { schema: Schema } option is required`);\n    }\n    // json & jsonArg are only used from toJSON()\n    toJS({ json, jsonArg, mapAsMap, maxAliasCount, onAnchor, reviver } = {}) {\n        const ctx = {\n            anchors: new Map(),\n            doc: this,\n            keep: !json,\n            mapAsMap: mapAsMap === true,\n            mapKeyWarned: false,\n            maxAliasCount: typeof maxAliasCount === 'number' ? maxAliasCount : 100\n        };\n        const res = toJS(this.contents, jsonArg ?? '', ctx);\n        if (typeof onAnchor === 'function')\n            for (const { count, res } of ctx.anchors.values())\n                onAnchor(res, count);\n        return typeof reviver === 'function'\n            ? applyReviver(reviver, { '': res }, '', res)\n            : res;\n    }\n    /**\n     * A JSON representation of the document `contents`.\n     *\n     * @param jsonArg Used by `JSON.stringify` to indicate the array index or\n     *   property name.\n     */\n    toJSON(jsonArg, onAnchor) {\n        return this.toJS({ json: true, jsonArg, mapAsMap: false, onAnchor });\n    }\n    /** A YAML representation of the document. */\n    toString(options = {}) {\n        if (this.errors.length > 0)\n            throw new Error('Document with errors cannot be stringified');\n        if ('indent' in options &&\n            (!Number.isInteger(options.indent) || Number(options.indent) <= 0)) {\n            const s = JSON.stringify(options.indent);\n            throw new Error(`\"indent\" option must be a positive integer, not ${s}`);\n        }\n        return stringifyDocument(this, options);\n    }\n}\nfunction assertCollection(contents) {\n    if (isCollection(contents))\n        return true;\n    throw new Error('Expected a YAML collection as document contents');\n}\n\nexport { Document };\n","class YAMLError extends Error {\n    constructor(name, pos, code, message) {\n        super();\n        this.name = name;\n        this.code = code;\n        this.message = message;\n        this.pos = pos;\n    }\n}\nclass YAMLParseError extends YAMLError {\n    constructor(pos, code, message) {\n        super('YAMLParseError', pos, code, message);\n    }\n}\nclass YAMLWarning extends YAMLError {\n    constructor(pos, code, message) {\n        super('YAMLWarning', pos, code, message);\n    }\n}\nconst prettifyError = (src, lc) => (error) => {\n    if (error.pos[0] === -1)\n        return;\n    error.linePos = error.pos.map(pos => lc.linePos(pos));\n    const { line, col } = error.linePos[0];\n    error.message += ` at line ${line}, column ${col}`;\n    let ci = col - 1;\n    let lineStr = src\n        .substring(lc.lineStarts[line - 1], lc.lineStarts[line])\n        .replace(/[\\n\\r]+$/, '');\n    // Trim to max 80 chars, keeping col position near the middle\n    if (ci >= 60 && lineStr.length > 80) {\n        const trimStart = Math.min(ci - 39, lineStr.length - 79);\n        lineStr = '' + lineStr.substring(trimStart);\n        ci -= trimStart - 1;\n    }\n    if (lineStr.length > 80)\n        lineStr = lineStr.substring(0, 79) + '';\n    // Include previous line in context if pointing at line start\n    if (line > 1 && /^ *$/.test(lineStr.substring(0, ci))) {\n        // Regexp won't match if start is trimmed\n        let prev = src.substring(lc.lineStarts[line - 2], lc.lineStarts[line - 1]);\n        if (prev.length > 80)\n            prev = prev.substring(0, 79) + '\\n';\n        lineStr = prev + lineStr;\n    }\n    if (/[^ ]/.test(lineStr)) {\n        let count = 1;\n        const end = error.linePos[1];\n        if (end && end.line === line && end.col > col) {\n            count = Math.max(1, Math.min(end.col - col, 80 - ci));\n        }\n        const pointer = ' '.repeat(ci) + '^'.repeat(count);\n        error.message += `:\\n\\n${lineStr}\\n${pointer}\\n`;\n    }\n};\n\nexport { YAMLError, YAMLParseError, YAMLWarning, prettifyError };\n","function resolveProps(tokens, { flow, indicator, next, offset, onError, parentIndent, startOnNewline }) {\n    let spaceBefore = false;\n    let atNewline = startOnNewline;\n    let hasSpace = startOnNewline;\n    let comment = '';\n    let commentSep = '';\n    let hasNewline = false;\n    let reqSpace = false;\n    let tab = null;\n    let anchor = null;\n    let tag = null;\n    let newlineAfterProp = null;\n    let comma = null;\n    let found = null;\n    let start = null;\n    for (const token of tokens) {\n        if (reqSpace) {\n            if (token.type !== 'space' &&\n                token.type !== 'newline' &&\n                token.type !== 'comma')\n                onError(token.offset, 'MISSING_CHAR', 'Tags and anchors must be separated from the next token by white space');\n            reqSpace = false;\n        }\n        if (tab) {\n            if (atNewline && token.type !== 'comment' && token.type !== 'newline') {\n                onError(tab, 'TAB_AS_INDENT', 'Tabs are not allowed as indentation');\n            }\n            tab = null;\n        }\n        switch (token.type) {\n            case 'space':\n                // At the doc level, tabs at line start may be parsed\n                // as leading white space rather than indentation.\n                // In a flow collection, only the parser handles indent.\n                if (!flow &&\n                    (indicator !== 'doc-start' || next?.type !== 'flow-collection') &&\n                    token.source.includes('\\t')) {\n                    tab = token;\n                }\n                hasSpace = true;\n                break;\n            case 'comment': {\n                if (!hasSpace)\n                    onError(token, 'MISSING_CHAR', 'Comments must be separated from other tokens by white space characters');\n                const cb = token.source.substring(1) || ' ';\n                if (!comment)\n                    comment = cb;\n                else\n                    comment += commentSep + cb;\n                commentSep = '';\n                atNewline = false;\n                break;\n            }\n            case 'newline':\n                if (atNewline) {\n                    if (comment)\n                        comment += token.source;\n                    else if (!found || indicator !== 'seq-item-ind')\n                        spaceBefore = true;\n                }\n                else\n                    commentSep += token.source;\n                atNewline = true;\n                hasNewline = true;\n                if (anchor || tag)\n                    newlineAfterProp = token;\n                hasSpace = true;\n                break;\n            case 'anchor':\n                if (anchor)\n                    onError(token, 'MULTIPLE_ANCHORS', 'A node can have at most one anchor');\n                if (token.source.endsWith(':'))\n                    onError(token.offset + token.source.length - 1, 'BAD_ALIAS', 'Anchor ending in : is ambiguous', true);\n                anchor = token;\n                start ?? (start = token.offset);\n                atNewline = false;\n                hasSpace = false;\n                reqSpace = true;\n                break;\n            case 'tag': {\n                if (tag)\n                    onError(token, 'MULTIPLE_TAGS', 'A node can have at most one tag');\n                tag = token;\n                start ?? (start = token.offset);\n                atNewline = false;\n                hasSpace = false;\n                reqSpace = true;\n                break;\n            }\n            case indicator:\n                // Could here handle preceding comments differently\n                if (anchor || tag)\n                    onError(token, 'BAD_PROP_ORDER', `Anchors and tags must be after the ${token.source} indicator`);\n                if (found)\n                    onError(token, 'UNEXPECTED_TOKEN', `Unexpected ${token.source} in ${flow ?? 'collection'}`);\n                found = token;\n                atNewline =\n                    indicator === 'seq-item-ind' || indicator === 'explicit-key-ind';\n                hasSpace = false;\n                break;\n            case 'comma':\n                if (flow) {\n                    if (comma)\n                        onError(token, 'UNEXPECTED_TOKEN', `Unexpected , in ${flow}`);\n                    comma = token;\n                    atNewline = false;\n                    hasSpace = false;\n                    break;\n                }\n            // else fallthrough\n            default:\n                onError(token, 'UNEXPECTED_TOKEN', `Unexpected ${token.type} token`);\n                atNewline = false;\n                hasSpace = false;\n        }\n    }\n    const last = tokens[tokens.length - 1];\n    const end = last ? last.offset + last.source.length : offset;\n    if (reqSpace &&\n        next &&\n        next.type !== 'space' &&\n        next.type !== 'newline' &&\n        next.type !== 'comma' &&\n        (next.type !== 'scalar' || next.source !== '')) {\n        onError(next.offset, 'MISSING_CHAR', 'Tags and anchors must be separated from the next token by white space');\n    }\n    if (tab &&\n        ((atNewline && tab.indent <= parentIndent) ||\n            next?.type === 'block-map' ||\n            next?.type === 'block-seq'))\n        onError(tab, 'TAB_AS_INDENT', 'Tabs are not allowed as indentation');\n    return {\n        comma,\n        found,\n        spaceBefore,\n        comment,\n        hasNewline,\n        anchor,\n        tag,\n        newlineAfterProp,\n        end,\n        start: start ?? end\n    };\n}\n\nexport { resolveProps };\n","function containsNewline(key) {\n    if (!key)\n        return null;\n    switch (key.type) {\n        case 'alias':\n        case 'scalar':\n        case 'double-quoted-scalar':\n        case 'single-quoted-scalar':\n            if (key.source.includes('\\n'))\n                return true;\n            if (key.end)\n                for (const st of key.end)\n                    if (st.type === 'newline')\n                        return true;\n            return false;\n        case 'flow-collection':\n            for (const it of key.items) {\n                for (const st of it.start)\n                    if (st.type === 'newline')\n                        return true;\n                if (it.sep)\n                    for (const st of it.sep)\n                        if (st.type === 'newline')\n                            return true;\n                if (containsNewline(it.key) || containsNewline(it.value))\n                    return true;\n            }\n            return false;\n        default:\n            return true;\n    }\n}\n\nexport { containsNewline };\n","import { containsNewline } from './util-contains-newline.js';\n\nfunction flowIndentCheck(indent, fc, onError) {\n    if (fc?.type === 'flow-collection') {\n        const end = fc.end[0];\n        if (end.indent === indent &&\n            (end.source === ']' || end.source === '}') &&\n            containsNewline(fc)) {\n            const msg = 'Flow end indicator should be more indented than parent';\n            onError(end, 'BAD_INDENT', msg, true);\n        }\n    }\n}\n\nexport { flowIndentCheck };\n","import { isScalar } from '../nodes/identity.js';\n\nfunction mapIncludes(ctx, items, search) {\n    const { uniqueKeys } = ctx.options;\n    if (uniqueKeys === false)\n        return false;\n    const isEqual = typeof uniqueKeys === 'function'\n        ? uniqueKeys\n        : (a, b) => a === b || (isScalar(a) && isScalar(b) && a.value === b.value);\n    return items.some(pair => isEqual(pair.key, search));\n}\n\nexport { mapIncludes };\n","import { Pair } from '../nodes/Pair.js';\nimport { YAMLMap } from '../nodes/YAMLMap.js';\nimport { resolveProps } from './resolve-props.js';\nimport { containsNewline } from './util-contains-newline.js';\nimport { flowIndentCheck } from './util-flow-indent-check.js';\nimport { mapIncludes } from './util-map-includes.js';\n\nconst startColMsg = 'All mapping items must start at the same column';\nfunction resolveBlockMap({ composeNode, composeEmptyNode }, ctx, bm, onError, tag) {\n    const NodeClass = tag?.nodeClass ?? YAMLMap;\n    const map = new NodeClass(ctx.schema);\n    if (ctx.atRoot)\n        ctx.atRoot = false;\n    let offset = bm.offset;\n    let commentEnd = null;\n    for (const collItem of bm.items) {\n        const { start, key, sep, value } = collItem;\n        // key properties\n        const keyProps = resolveProps(start, {\n            indicator: 'explicit-key-ind',\n            next: key ?? sep?.[0],\n            offset,\n            onError,\n            parentIndent: bm.indent,\n            startOnNewline: true\n        });\n        const implicitKey = !keyProps.found;\n        if (implicitKey) {\n            if (key) {\n                if (key.type === 'block-seq')\n                    onError(offset, 'BLOCK_AS_IMPLICIT_KEY', 'A block sequence may not be used as an implicit map key');\n                else if ('indent' in key && key.indent !== bm.indent)\n                    onError(offset, 'BAD_INDENT', startColMsg);\n            }\n            if (!keyProps.anchor && !keyProps.tag && !sep) {\n                commentEnd = keyProps.end;\n                if (keyProps.comment) {\n                    if (map.comment)\n                        map.comment += '\\n' + keyProps.comment;\n                    else\n                        map.comment = keyProps.comment;\n                }\n                continue;\n            }\n            if (keyProps.newlineAfterProp || containsNewline(key)) {\n                onError(key ?? start[start.length - 1], 'MULTILINE_IMPLICIT_KEY', 'Implicit keys need to be on a single line');\n            }\n        }\n        else if (keyProps.found?.indent !== bm.indent) {\n            onError(offset, 'BAD_INDENT', startColMsg);\n        }\n        // key value\n        ctx.atKey = true;\n        const keyStart = keyProps.end;\n        const keyNode = key\n            ? composeNode(ctx, key, keyProps, onError)\n            : composeEmptyNode(ctx, keyStart, start, null, keyProps, onError);\n        if (ctx.schema.compat)\n            flowIndentCheck(bm.indent, key, onError);\n        ctx.atKey = false;\n        if (mapIncludes(ctx, map.items, keyNode))\n            onError(keyStart, 'DUPLICATE_KEY', 'Map keys must be unique');\n        // value properties\n        const valueProps = resolveProps(sep ?? [], {\n            indicator: 'map-value-ind',\n            next: value,\n            offset: keyNode.range[2],\n            onError,\n            parentIndent: bm.indent,\n            startOnNewline: !key || key.type === 'block-scalar'\n        });\n        offset = valueProps.end;\n        if (valueProps.found) {\n            if (implicitKey) {\n                if (value?.type === 'block-map' && !valueProps.hasNewline)\n                    onError(offset, 'BLOCK_AS_IMPLICIT_KEY', 'Nested mappings are not allowed in compact mappings');\n                if (ctx.options.strict &&\n                    keyProps.start < valueProps.found.offset - 1024)\n                    onError(keyNode.range, 'KEY_OVER_1024_CHARS', 'The : indicator must be at most 1024 chars after the start of an implicit block mapping key');\n            }\n            // value value\n            const valueNode = value\n                ? composeNode(ctx, value, valueProps, onError)\n                : composeEmptyNode(ctx, offset, sep, null, valueProps, onError);\n            if (ctx.schema.compat)\n                flowIndentCheck(bm.indent, value, onError);\n            offset = valueNode.range[2];\n            const pair = new Pair(keyNode, valueNode);\n            if (ctx.options.keepSourceTokens)\n                pair.srcToken = collItem;\n            map.items.push(pair);\n        }\n        else {\n            // key with no value\n            if (implicitKey)\n                onError(keyNode.range, 'MISSING_CHAR', 'Implicit map keys need to be followed by map values');\n            if (valueProps.comment) {\n                if (keyNode.comment)\n                    keyNode.comment += '\\n' + valueProps.comment;\n                else\n                    keyNode.comment = valueProps.comment;\n            }\n            const pair = new Pair(keyNode);\n            if (ctx.options.keepSourceTokens)\n                pair.srcToken = collItem;\n            map.items.push(pair);\n        }\n    }\n    if (commentEnd && commentEnd < offset)\n        onError(commentEnd, 'IMPOSSIBLE', 'Map comment with trailing content');\n    map.range = [bm.offset, offset, commentEnd ?? offset];\n    return map;\n}\n\nexport { resolveBlockMap };\n","import { YAMLSeq } from '../nodes/YAMLSeq.js';\nimport { resolveProps } from './resolve-props.js';\nimport { flowIndentCheck } from './util-flow-indent-check.js';\n\nfunction resolveBlockSeq({ composeNode, composeEmptyNode }, ctx, bs, onError, tag) {\n    const NodeClass = tag?.nodeClass ?? YAMLSeq;\n    const seq = new NodeClass(ctx.schema);\n    if (ctx.atRoot)\n        ctx.atRoot = false;\n    if (ctx.atKey)\n        ctx.atKey = false;\n    let offset = bs.offset;\n    let commentEnd = null;\n    for (const { start, value } of bs.items) {\n        const props = resolveProps(start, {\n            indicator: 'seq-item-ind',\n            next: value,\n            offset,\n            onError,\n            parentIndent: bs.indent,\n            startOnNewline: true\n        });\n        if (!props.found) {\n            if (props.anchor || props.tag || value) {\n                if (value && value.type === 'block-seq')\n                    onError(props.end, 'BAD_INDENT', 'All sequence items must start at the same column');\n                else\n                    onError(offset, 'MISSING_CHAR', 'Sequence item without - indicator');\n            }\n            else {\n                commentEnd = props.end;\n                if (props.comment)\n                    seq.comment = props.comment;\n                continue;\n            }\n        }\n        const node = value\n            ? composeNode(ctx, value, props, onError)\n            : composeEmptyNode(ctx, props.end, start, null, props, onError);\n        if (ctx.schema.compat)\n            flowIndentCheck(bs.indent, value, onError);\n        offset = node.range[2];\n        seq.items.push(node);\n    }\n    seq.range = [bs.offset, offset, commentEnd ?? offset];\n    return seq;\n}\n\nexport { resolveBlockSeq };\n","function resolveEnd(end, offset, reqSpace, onError) {\n    let comment = '';\n    if (end) {\n        let hasSpace = false;\n        let sep = '';\n        for (const token of end) {\n            const { source, type } = token;\n            switch (type) {\n                case 'space':\n                    hasSpace = true;\n                    break;\n                case 'comment': {\n                    if (reqSpace && !hasSpace)\n                        onError(token, 'MISSING_CHAR', 'Comments must be separated from other tokens by white space characters');\n                    const cb = source.substring(1) || ' ';\n                    if (!comment)\n                        comment = cb;\n                    else\n                        comment += sep + cb;\n                    sep = '';\n                    break;\n                }\n                case 'newline':\n                    if (comment)\n                        sep += source;\n                    hasSpace = true;\n                    break;\n                default:\n                    onError(token, 'UNEXPECTED_TOKEN', `Unexpected ${type} at node end`);\n            }\n            offset += source.length;\n        }\n    }\n    return { comment, offset };\n}\n\nexport { resolveEnd };\n","import { isPair } from '../nodes/identity.js';\nimport { Pair } from '../nodes/Pair.js';\nimport { YAMLMap } from '../nodes/YAMLMap.js';\nimport { YAMLSeq } from '../nodes/YAMLSeq.js';\nimport { resolveEnd } from './resolve-end.js';\nimport { resolveProps } from './resolve-props.js';\nimport { containsNewline } from './util-contains-newline.js';\nimport { mapIncludes } from './util-map-includes.js';\n\nconst blockMsg = 'Block collections are not allowed within flow collections';\nconst isBlock = (token) => token && (token.type === 'block-map' || token.type === 'block-seq');\nfunction resolveFlowCollection({ composeNode, composeEmptyNode }, ctx, fc, onError, tag) {\n    const isMap = fc.start.source === '{';\n    const fcName = isMap ? 'flow map' : 'flow sequence';\n    const NodeClass = (tag?.nodeClass ?? (isMap ? YAMLMap : YAMLSeq));\n    const coll = new NodeClass(ctx.schema);\n    coll.flow = true;\n    const atRoot = ctx.atRoot;\n    if (atRoot)\n        ctx.atRoot = false;\n    if (ctx.atKey)\n        ctx.atKey = false;\n    let offset = fc.offset + fc.start.source.length;\n    for (let i = 0; i < fc.items.length; ++i) {\n        const collItem = fc.items[i];\n        const { start, key, sep, value } = collItem;\n        const props = resolveProps(start, {\n            flow: fcName,\n            indicator: 'explicit-key-ind',\n            next: key ?? sep?.[0],\n            offset,\n            onError,\n            parentIndent: fc.indent,\n            startOnNewline: false\n        });\n        if (!props.found) {\n            if (!props.anchor && !props.tag && !sep && !value) {\n                if (i === 0 && props.comma)\n                    onError(props.comma, 'UNEXPECTED_TOKEN', `Unexpected , in ${fcName}`);\n                else if (i < fc.items.length - 1)\n                    onError(props.start, 'UNEXPECTED_TOKEN', `Unexpected empty item in ${fcName}`);\n                if (props.comment) {\n                    if (coll.comment)\n                        coll.comment += '\\n' + props.comment;\n                    else\n                        coll.comment = props.comment;\n                }\n                offset = props.end;\n                continue;\n            }\n            if (!isMap && ctx.options.strict && containsNewline(key))\n                onError(key, // checked by containsNewline()\n                'MULTILINE_IMPLICIT_KEY', 'Implicit keys of flow sequence pairs need to be on a single line');\n        }\n        if (i === 0) {\n            if (props.comma)\n                onError(props.comma, 'UNEXPECTED_TOKEN', `Unexpected , in ${fcName}`);\n        }\n        else {\n            if (!props.comma)\n                onError(props.start, 'MISSING_CHAR', `Missing , between ${fcName} items`);\n            if (props.comment) {\n                let prevItemComment = '';\n                loop: for (const st of start) {\n                    switch (st.type) {\n                        case 'comma':\n                        case 'space':\n                            break;\n                        case 'comment':\n                            prevItemComment = st.source.substring(1);\n                            break loop;\n                        default:\n                            break loop;\n                    }\n                }\n                if (prevItemComment) {\n                    let prev = coll.items[coll.items.length - 1];\n                    if (isPair(prev))\n                        prev = prev.value ?? prev.key;\n                    if (prev.comment)\n                        prev.comment += '\\n' + prevItemComment;\n                    else\n                        prev.comment = prevItemComment;\n                    props.comment = props.comment.substring(prevItemComment.length + 1);\n                }\n            }\n        }\n        if (!isMap && !sep && !props.found) {\n            // item is a value in a seq\n            //  key & sep are empty, start does not include ? or :\n            const valueNode = value\n                ? composeNode(ctx, value, props, onError)\n                : composeEmptyNode(ctx, props.end, sep, null, props, onError);\n            coll.items.push(valueNode);\n            offset = valueNode.range[2];\n            if (isBlock(value))\n                onError(valueNode.range, 'BLOCK_IN_FLOW', blockMsg);\n        }\n        else {\n            // item is a key+value pair\n            // key value\n            ctx.atKey = true;\n            const keyStart = props.end;\n            const keyNode = key\n                ? composeNode(ctx, key, props, onError)\n                : composeEmptyNode(ctx, keyStart, start, null, props, onError);\n            if (isBlock(key))\n                onError(keyNode.range, 'BLOCK_IN_FLOW', blockMsg);\n            ctx.atKey = false;\n            // value properties\n            const valueProps = resolveProps(sep ?? [], {\n                flow: fcName,\n                indicator: 'map-value-ind',\n                next: value,\n                offset: keyNode.range[2],\n                onError,\n                parentIndent: fc.indent,\n                startOnNewline: false\n            });\n            if (valueProps.found) {\n                if (!isMap && !props.found && ctx.options.strict) {\n                    if (sep)\n                        for (const st of sep) {\n                            if (st === valueProps.found)\n                                break;\n                            if (st.type === 'newline') {\n                                onError(st, 'MULTILINE_IMPLICIT_KEY', 'Implicit keys of flow sequence pairs need to be on a single line');\n                                break;\n                            }\n                        }\n                    if (props.start < valueProps.found.offset - 1024)\n                        onError(valueProps.found, 'KEY_OVER_1024_CHARS', 'The : indicator must be at most 1024 chars after the start of an implicit flow sequence key');\n                }\n            }\n            else if (value) {\n                if ('source' in value && value.source && value.source[0] === ':')\n                    onError(value, 'MISSING_CHAR', `Missing space after : in ${fcName}`);\n                else\n                    onError(valueProps.start, 'MISSING_CHAR', `Missing , or : between ${fcName} items`);\n            }\n            // value value\n            const valueNode = value\n                ? composeNode(ctx, value, valueProps, onError)\n                : valueProps.found\n                    ? composeEmptyNode(ctx, valueProps.end, sep, null, valueProps, onError)\n                    : null;\n            if (valueNode) {\n                if (isBlock(value))\n                    onError(valueNode.range, 'BLOCK_IN_FLOW', blockMsg);\n            }\n            else if (valueProps.comment) {\n                if (keyNode.comment)\n                    keyNode.comment += '\\n' + valueProps.comment;\n                else\n                    keyNode.comment = valueProps.comment;\n            }\n            const pair = new Pair(keyNode, valueNode);\n            if (ctx.options.keepSourceTokens)\n                pair.srcToken = collItem;\n            if (isMap) {\n                const map = coll;\n                if (mapIncludes(ctx, map.items, keyNode))\n                    onError(keyStart, 'DUPLICATE_KEY', 'Map keys must be unique');\n                map.items.push(pair);\n            }\n            else {\n                const map = new YAMLMap(ctx.schema);\n                map.flow = true;\n                map.items.push(pair);\n                const endRange = (valueNode ?? keyNode).range;\n                map.range = [keyNode.range[0], endRange[1], endRange[2]];\n                coll.items.push(map);\n            }\n            offset = valueNode ? valueNode.range[2] : valueProps.end;\n        }\n    }\n    const expectedEnd = isMap ? '}' : ']';\n    const [ce, ...ee] = fc.end;\n    let cePos = offset;\n    if (ce && ce.source === expectedEnd)\n        cePos = ce.offset + ce.source.length;\n    else {\n        const name = fcName[0].toUpperCase() + fcName.substring(1);\n        const msg = atRoot\n            ? `${name} must end with a ${expectedEnd}`\n            : `${name} in block collection must be sufficiently indented and end with a ${expectedEnd}`;\n        onError(offset, atRoot ? 'MISSING_CHAR' : 'BAD_INDENT', msg);\n        if (ce && ce.source.length !== 1)\n            ee.unshift(ce);\n    }\n    if (ee.length > 0) {\n        const end = resolveEnd(ee, cePos, ctx.options.strict, onError);\n        if (end.comment) {\n            if (coll.comment)\n                coll.comment += '\\n' + end.comment;\n            else\n                coll.comment = end.comment;\n        }\n        coll.range = [fc.offset, cePos, end.offset];\n    }\n    else {\n        coll.range = [fc.offset, cePos, cePos];\n    }\n    return coll;\n}\n\nexport { resolveFlowCollection };\n","import { isNode } from '../nodes/identity.js';\nimport { Scalar } from '../nodes/Scalar.js';\nimport { YAMLMap } from '../nodes/YAMLMap.js';\nimport { YAMLSeq } from '../nodes/YAMLSeq.js';\nimport { resolveBlockMap } from './resolve-block-map.js';\nimport { resolveBlockSeq } from './resolve-block-seq.js';\nimport { resolveFlowCollection } from './resolve-flow-collection.js';\n\nfunction resolveCollection(CN, ctx, token, onError, tagName, tag) {\n    const coll = token.type === 'block-map'\n        ? resolveBlockMap(CN, ctx, token, onError, tag)\n        : token.type === 'block-seq'\n            ? resolveBlockSeq(CN, ctx, token, onError, tag)\n            : resolveFlowCollection(CN, ctx, token, onError, tag);\n    const Coll = coll.constructor;\n    // If we got a tagName matching the class, or the tag name is '!',\n    // then use the tagName from the node class used to create it.\n    if (tagName === '!' || tagName === Coll.tagName) {\n        coll.tag = Coll.tagName;\n        return coll;\n    }\n    if (tagName)\n        coll.tag = tagName;\n    return coll;\n}\nfunction composeCollection(CN, ctx, token, props, onError) {\n    const tagToken = props.tag;\n    const tagName = !tagToken\n        ? null\n        : ctx.directives.tagName(tagToken.source, msg => onError(tagToken, 'TAG_RESOLVE_FAILED', msg));\n    if (token.type === 'block-seq') {\n        const { anchor, newlineAfterProp: nl } = props;\n        const lastProp = anchor && tagToken\n            ? anchor.offset > tagToken.offset\n                ? anchor\n                : tagToken\n            : (anchor ?? tagToken);\n        if (lastProp && (!nl || nl.offset < lastProp.offset)) {\n            const message = 'Missing newline after block sequence props';\n            onError(lastProp, 'MISSING_CHAR', message);\n        }\n    }\n    const expType = token.type === 'block-map'\n        ? 'map'\n        : token.type === 'block-seq'\n            ? 'seq'\n            : token.start.source === '{'\n                ? 'map'\n                : 'seq';\n    // shortcut: check if it's a generic YAMLMap or YAMLSeq\n    // before jumping into the custom tag logic.\n    if (!tagToken ||\n        !tagName ||\n        tagName === '!' ||\n        (tagName === YAMLMap.tagName && expType === 'map') ||\n        (tagName === YAMLSeq.tagName && expType === 'seq')) {\n        return resolveCollection(CN, ctx, token, onError, tagName);\n    }\n    let tag = ctx.schema.tags.find(t => t.tag === tagName && t.collection === expType);\n    if (!tag) {\n        const kt = ctx.schema.knownTags[tagName];\n        if (kt && kt.collection === expType) {\n            ctx.schema.tags.push(Object.assign({}, kt, { default: false }));\n            tag = kt;\n        }\n        else {\n            if (kt) {\n                onError(tagToken, 'BAD_COLLECTION_TYPE', `${kt.tag} used for ${expType} collection, but expects ${kt.collection ?? 'scalar'}`, true);\n            }\n            else {\n                onError(tagToken, 'TAG_RESOLVE_FAILED', `Unresolved tag: ${tagName}`, true);\n            }\n            return resolveCollection(CN, ctx, token, onError, tagName);\n        }\n    }\n    const coll = resolveCollection(CN, ctx, token, onError, tagName, tag);\n    const res = tag.resolve?.(coll, msg => onError(tagToken, 'TAG_RESOLVE_FAILED', msg), ctx.options) ?? coll;\n    const node = isNode(res)\n        ? res\n        : new Scalar(res);\n    node.range = coll.range;\n    node.tag = tagName;\n    if (tag?.format)\n        node.format = tag.format;\n    return node;\n}\n\nexport { composeCollection };\n","import { Scalar } from '../nodes/Scalar.js';\n\nfunction resolveBlockScalar(ctx, scalar, onError) {\n    const start = scalar.offset;\n    const header = parseBlockScalarHeader(scalar, ctx.options.strict, onError);\n    if (!header)\n        return { value: '', type: null, comment: '', range: [start, start, start] };\n    const type = header.mode === '>' ? Scalar.BLOCK_FOLDED : Scalar.BLOCK_LITERAL;\n    const lines = scalar.source ? splitLines(scalar.source) : [];\n    // determine the end of content & start of chomping\n    let chompStart = lines.length;\n    for (let i = lines.length - 1; i >= 0; --i) {\n        const content = lines[i][1];\n        if (content === '' || content === '\\r')\n            chompStart = i;\n        else\n            break;\n    }\n    // shortcut for empty contents\n    if (chompStart === 0) {\n        const value = header.chomp === '+' && lines.length > 0\n            ? '\\n'.repeat(Math.max(1, lines.length - 1))\n            : '';\n        let end = start + header.length;\n        if (scalar.source)\n            end += scalar.source.length;\n        return { value, type, comment: header.comment, range: [start, end, end] };\n    }\n    // find the indentation level to trim from start\n    let trimIndent = scalar.indent + header.indent;\n    let offset = scalar.offset + header.length;\n    let contentStart = 0;\n    for (let i = 0; i < chompStart; ++i) {\n        const [indent, content] = lines[i];\n        if (content === '' || content === '\\r') {\n            if (header.indent === 0 && indent.length > trimIndent)\n                trimIndent = indent.length;\n        }\n        else {\n            if (indent.length < trimIndent) {\n                const message = 'Block scalars with more-indented leading empty lines must use an explicit indentation indicator';\n                onError(offset + indent.length, 'MISSING_CHAR', message);\n            }\n            if (header.indent === 0)\n                trimIndent = indent.length;\n            contentStart = i;\n            if (trimIndent === 0 && !ctx.atRoot) {\n                const message = 'Block scalar values in collections must be indented';\n                onError(offset, 'BAD_INDENT', message);\n            }\n            break;\n        }\n        offset += indent.length + content.length + 1;\n    }\n    // include trailing more-indented empty lines in content\n    for (let i = lines.length - 1; i >= chompStart; --i) {\n        if (lines[i][0].length > trimIndent)\n            chompStart = i + 1;\n    }\n    let value = '';\n    let sep = '';\n    let prevMoreIndented = false;\n    // leading whitespace is kept intact\n    for (let i = 0; i < contentStart; ++i)\n        value += lines[i][0].slice(trimIndent) + '\\n';\n    for (let i = contentStart; i < chompStart; ++i) {\n        let [indent, content] = lines[i];\n        offset += indent.length + content.length + 1;\n        const crlf = content[content.length - 1] === '\\r';\n        if (crlf)\n            content = content.slice(0, -1);\n        /* istanbul ignore if already caught in lexer */\n        if (content && indent.length < trimIndent) {\n            const src = header.indent\n                ? 'explicit indentation indicator'\n                : 'first line';\n            const message = `Block scalar lines must not be less indented than their ${src}`;\n            onError(offset - content.length - (crlf ? 2 : 1), 'BAD_INDENT', message);\n            indent = '';\n        }\n        if (type === Scalar.BLOCK_LITERAL) {\n            value += sep + indent.slice(trimIndent) + content;\n            sep = '\\n';\n        }\n        else if (indent.length > trimIndent || content[0] === '\\t') {\n            // more-indented content within a folded block\n            if (sep === ' ')\n                sep = '\\n';\n            else if (!prevMoreIndented && sep === '\\n')\n                sep = '\\n\\n';\n            value += sep + indent.slice(trimIndent) + content;\n            sep = '\\n';\n            prevMoreIndented = true;\n        }\n        else if (content === '') {\n            // empty line\n            if (sep === '\\n')\n                value += '\\n';\n            else\n                sep = '\\n';\n        }\n        else {\n            value += sep + content;\n            sep = ' ';\n            prevMoreIndented = false;\n        }\n    }\n    switch (header.chomp) {\n        case '-':\n            break;\n        case '+':\n            for (let i = chompStart; i < lines.length; ++i)\n                value += '\\n' + lines[i][0].slice(trimIndent);\n            if (value[value.length - 1] !== '\\n')\n                value += '\\n';\n            break;\n        default:\n            value += '\\n';\n    }\n    const end = start + header.length + scalar.source.length;\n    return { value, type, comment: header.comment, range: [start, end, end] };\n}\nfunction parseBlockScalarHeader({ offset, props }, strict, onError) {\n    /* istanbul ignore if should not happen */\n    if (props[0].type !== 'block-scalar-header') {\n        onError(props[0], 'IMPOSSIBLE', 'Block scalar header not found');\n        return null;\n    }\n    const { source } = props[0];\n    const mode = source[0];\n    let indent = 0;\n    let chomp = '';\n    let error = -1;\n    for (let i = 1; i < source.length; ++i) {\n        const ch = source[i];\n        if (!chomp && (ch === '-' || ch === '+'))\n            chomp = ch;\n        else {\n            const n = Number(ch);\n            if (!indent && n)\n                indent = n;\n            else if (error === -1)\n                error = offset + i;\n        }\n    }\n    if (error !== -1)\n        onError(error, 'UNEXPECTED_TOKEN', `Block scalar header includes extra characters: ${source}`);\n    let hasSpace = false;\n    let comment = '';\n    let length = source.length;\n    for (let i = 1; i < props.length; ++i) {\n        const token = props[i];\n        switch (token.type) {\n            case 'space':\n                hasSpace = true;\n            // fallthrough\n            case 'newline':\n                length += token.source.length;\n                break;\n            case 'comment':\n                if (strict && !hasSpace) {\n                    const message = 'Comments must be separated from other tokens by white space characters';\n                    onError(token, 'MISSING_CHAR', message);\n                }\n                length += token.source.length;\n                comment = token.source.substring(1);\n                break;\n            case 'error':\n                onError(token, 'UNEXPECTED_TOKEN', token.message);\n                length += token.source.length;\n                break;\n            /* istanbul ignore next should not happen */\n            default: {\n                const message = `Unexpected token in block scalar header: ${token.type}`;\n                onError(token, 'UNEXPECTED_TOKEN', message);\n                const ts = token.source;\n                if (ts && typeof ts === 'string')\n                    length += ts.length;\n            }\n        }\n    }\n    return { mode, indent, chomp, comment, length };\n}\n/** @returns Array of lines split up as `[indent, content]` */\nfunction splitLines(source) {\n    const split = source.split(/\\n( *)/);\n    const first = split[0];\n    const m = first.match(/^( *)/);\n    const line0 = m?.[1]\n        ? [m[1], first.slice(m[1].length)]\n        : ['', first];\n    const lines = [line0];\n    for (let i = 1; i < split.length; i += 2)\n        lines.push([split[i], split[i + 1]]);\n    return lines;\n}\n\nexport { resolveBlockScalar };\n","import { Scalar } from '../nodes/Scalar.js';\nimport { resolveEnd } from './resolve-end.js';\n\nfunction resolveFlowScalar(scalar, strict, onError) {\n    const { offset, type, source, end } = scalar;\n    let _type;\n    let value;\n    const _onError = (rel, code, msg) => onError(offset + rel, code, msg);\n    switch (type) {\n        case 'scalar':\n            _type = Scalar.PLAIN;\n            value = plainValue(source, _onError);\n            break;\n        case 'single-quoted-scalar':\n            _type = Scalar.QUOTE_SINGLE;\n            value = singleQuotedValue(source, _onError);\n            break;\n        case 'double-quoted-scalar':\n            _type = Scalar.QUOTE_DOUBLE;\n            value = doubleQuotedValue(source, _onError);\n            break;\n        /* istanbul ignore next should not happen */\n        default:\n            onError(scalar, 'UNEXPECTED_TOKEN', `Expected a flow scalar value, but found: ${type}`);\n            return {\n                value: '',\n                type: null,\n                comment: '',\n                range: [offset, offset + source.length, offset + source.length]\n            };\n    }\n    const valueEnd = offset + source.length;\n    const re = resolveEnd(end, valueEnd, strict, onError);\n    return {\n        value,\n        type: _type,\n        comment: re.comment,\n        range: [offset, valueEnd, re.offset]\n    };\n}\nfunction plainValue(source, onError) {\n    let badChar = '';\n    switch (source[0]) {\n        /* istanbul ignore next should not happen */\n        case '\\t':\n            badChar = 'a tab character';\n            break;\n        case ',':\n            badChar = 'flow indicator character ,';\n            break;\n        case '%':\n            badChar = 'directive indicator character %';\n            break;\n        case '|':\n        case '>': {\n            badChar = `block scalar indicator ${source[0]}`;\n            break;\n        }\n        case '@':\n        case '`': {\n            badChar = `reserved character ${source[0]}`;\n            break;\n        }\n    }\n    if (badChar)\n        onError(0, 'BAD_SCALAR_START', `Plain value cannot start with ${badChar}`);\n    return foldLines(source);\n}\nfunction singleQuotedValue(source, onError) {\n    if (source[source.length - 1] !== \"'\" || source.length === 1)\n        onError(source.length, 'MISSING_CHAR', \"Missing closing 'quote\");\n    return foldLines(source.slice(1, -1)).replace(/''/g, \"'\");\n}\nfunction foldLines(source) {\n    /**\n     * The negative lookbehind here and in the `re` RegExp is to\n     * prevent causing a polynomial search time in certain cases.\n     *\n     * The try-catch is for Safari, which doesn't support this yet:\n     * https://caniuse.com/js-regexp-lookbehind\n     */\n    let first, line;\n    try {\n        first = new RegExp('(.*?)(?<![ \\t])[ \\t]*\\r?\\n', 'sy');\n        line = new RegExp('[ \\t]*(.*?)(?:(?<![ \\t])[ \\t]*)?\\r?\\n', 'sy');\n    }\n    catch {\n        first = /(.*?)[ \\t]*\\r?\\n/sy;\n        line = /[ \\t]*(.*?)[ \\t]*\\r?\\n/sy;\n    }\n    let match = first.exec(source);\n    if (!match)\n        return source;\n    let res = match[1];\n    let sep = ' ';\n    let pos = first.lastIndex;\n    line.lastIndex = pos;\n    while ((match = line.exec(source))) {\n        if (match[1] === '') {\n            if (sep === '\\n')\n                res += sep;\n            else\n                sep = '\\n';\n        }\n        else {\n            res += sep + match[1];\n            sep = ' ';\n        }\n        pos = line.lastIndex;\n    }\n    const last = /[ \\t]*(.*)/sy;\n    last.lastIndex = pos;\n    match = last.exec(source);\n    return res + sep + (match?.[1] ?? '');\n}\nfunction doubleQuotedValue(source, onError) {\n    let res = '';\n    for (let i = 1; i < source.length - 1; ++i) {\n        const ch = source[i];\n        if (ch === '\\r' && source[i + 1] === '\\n')\n            continue;\n        if (ch === '\\n') {\n            const { fold, offset } = foldNewline(source, i);\n            res += fold;\n            i = offset;\n        }\n        else if (ch === '\\\\') {\n            let next = source[++i];\n            const cc = escapeCodes[next];\n            if (cc)\n                res += cc;\n            else if (next === '\\n') {\n                // skip escaped newlines, but still trim the following line\n                next = source[i + 1];\n                while (next === ' ' || next === '\\t')\n                    next = source[++i + 1];\n            }\n            else if (next === '\\r' && source[i + 1] === '\\n') {\n                // skip escaped CRLF newlines, but still trim the following line\n                next = source[++i + 1];\n                while (next === ' ' || next === '\\t')\n                    next = source[++i + 1];\n            }\n            else if (next === 'x' || next === 'u' || next === 'U') {\n                const length = { x: 2, u: 4, U: 8 }[next];\n                res += parseCharCode(source, i + 1, length, onError);\n                i += length;\n            }\n            else {\n                const raw = source.substr(i - 1, 2);\n                onError(i - 1, 'BAD_DQ_ESCAPE', `Invalid escape sequence ${raw}`);\n                res += raw;\n            }\n        }\n        else if (ch === ' ' || ch === '\\t') {\n            // trim trailing whitespace\n            const wsStart = i;\n            let next = source[i + 1];\n            while (next === ' ' || next === '\\t')\n                next = source[++i + 1];\n            if (next !== '\\n' && !(next === '\\r' && source[i + 2] === '\\n'))\n                res += i > wsStart ? source.slice(wsStart, i + 1) : ch;\n        }\n        else {\n            res += ch;\n        }\n    }\n    if (source[source.length - 1] !== '\"' || source.length === 1)\n        onError(source.length, 'MISSING_CHAR', 'Missing closing \"quote');\n    return res;\n}\n/**\n * Fold a single newline into a space, multiple newlines to N - 1 newlines.\n * Presumes `source[offset] === '\\n'`\n */\nfunction foldNewline(source, offset) {\n    let fold = '';\n    let ch = source[offset + 1];\n    while (ch === ' ' || ch === '\\t' || ch === '\\n' || ch === '\\r') {\n        if (ch === '\\r' && source[offset + 2] !== '\\n')\n            break;\n        if (ch === '\\n')\n            fold += '\\n';\n        offset += 1;\n        ch = source[offset + 1];\n    }\n    if (!fold)\n        fold = ' ';\n    return { fold, offset };\n}\nconst escapeCodes = {\n    '0': '\\0', // null character\n    a: '\\x07', // bell character\n    b: '\\b', // backspace\n    e: '\\x1b', // escape character\n    f: '\\f', // form feed\n    n: '\\n', // line feed\n    r: '\\r', // carriage return\n    t: '\\t', // horizontal tab\n    v: '\\v', // vertical tab\n    N: '\\u0085', // Unicode next line\n    _: '\\u00a0', // Unicode non-breaking space\n    L: '\\u2028', // Unicode line separator\n    P: '\\u2029', // Unicode paragraph separator\n    ' ': ' ',\n    '\"': '\"',\n    '/': '/',\n    '\\\\': '\\\\',\n    '\\t': '\\t'\n};\nfunction parseCharCode(source, offset, length, onError) {\n    const cc = source.substr(offset, length);\n    const ok = cc.length === length && /^[0-9a-fA-F]+$/.test(cc);\n    const code = ok ? parseInt(cc, 16) : NaN;\n    if (isNaN(code)) {\n        const raw = source.substr(offset - 2, length + 2);\n        onError(offset - 2, 'BAD_DQ_ESCAPE', `Invalid escape sequence ${raw}`);\n        return raw;\n    }\n    return String.fromCodePoint(code);\n}\n\nexport { resolveFlowScalar };\n","import { isScalar, SCALAR } from '../nodes/identity.js';\nimport { Scalar } from '../nodes/Scalar.js';\nimport { resolveBlockScalar } from './resolve-block-scalar.js';\nimport { resolveFlowScalar } from './resolve-flow-scalar.js';\n\nfunction composeScalar(ctx, token, tagToken, onError) {\n    const { value, type, comment, range } = token.type === 'block-scalar'\n        ? resolveBlockScalar(ctx, token, onError)\n        : resolveFlowScalar(token, ctx.options.strict, onError);\n    const tagName = tagToken\n        ? ctx.directives.tagName(tagToken.source, msg => onError(tagToken, 'TAG_RESOLVE_FAILED', msg))\n        : null;\n    let tag;\n    if (ctx.options.stringKeys && ctx.atKey) {\n        tag = ctx.schema[SCALAR];\n    }\n    else if (tagName)\n        tag = findScalarTagByName(ctx.schema, value, tagName, tagToken, onError);\n    else if (token.type === 'scalar')\n        tag = findScalarTagByTest(ctx, value, token, onError);\n    else\n        tag = ctx.schema[SCALAR];\n    let scalar;\n    try {\n        const res = tag.resolve(value, msg => onError(tagToken ?? token, 'TAG_RESOLVE_FAILED', msg), ctx.options);\n        scalar = isScalar(res) ? res : new Scalar(res);\n    }\n    catch (error) {\n        const msg = error instanceof Error ? error.message : String(error);\n        onError(tagToken ?? token, 'TAG_RESOLVE_FAILED', msg);\n        scalar = new Scalar(value);\n    }\n    scalar.range = range;\n    scalar.source = value;\n    if (type)\n        scalar.type = type;\n    if (tagName)\n        scalar.tag = tagName;\n    if (tag.format)\n        scalar.format = tag.format;\n    if (comment)\n        scalar.comment = comment;\n    return scalar;\n}\nfunction findScalarTagByName(schema, value, tagName, tagToken, onError) {\n    if (tagName === '!')\n        return schema[SCALAR]; // non-specific tag\n    const matchWithTest = [];\n    for (const tag of schema.tags) {\n        if (!tag.collection && tag.tag === tagName) {\n            if (tag.default && tag.test)\n                matchWithTest.push(tag);\n            else\n                return tag;\n        }\n    }\n    for (const tag of matchWithTest)\n        if (tag.test?.test(value))\n            return tag;\n    const kt = schema.knownTags[tagName];\n    if (kt && !kt.collection) {\n        // Ensure that the known tag is available for stringifying,\n        // but does not get used by default.\n        schema.tags.push(Object.assign({}, kt, { default: false, test: undefined }));\n        return kt;\n    }\n    onError(tagToken, 'TAG_RESOLVE_FAILED', `Unresolved tag: ${tagName}`, tagName !== 'tag:yaml.org,2002:str');\n    return schema[SCALAR];\n}\nfunction findScalarTagByTest({ atKey, directives, schema }, value, token, onError) {\n    const tag = schema.tags.find(tag => (tag.default === true || (atKey && tag.default === 'key')) &&\n        tag.test?.test(value)) || schema[SCALAR];\n    if (schema.compat) {\n        const compat = schema.compat.find(tag => tag.default && tag.test?.test(value)) ??\n            schema[SCALAR];\n        if (tag.tag !== compat.tag) {\n            const ts = directives.tagString(tag.tag);\n            const cs = directives.tagString(compat.tag);\n            const msg = `Value may be parsed as either ${ts} or ${cs}`;\n            onError(token, 'TAG_RESOLVE_FAILED', msg, true);\n        }\n    }\n    return tag;\n}\n\nexport { composeScalar };\n","function emptyScalarPosition(offset, before, pos) {\n    if (before) {\n        pos ?? (pos = before.length);\n        for (let i = pos - 1; i >= 0; --i) {\n            let st = before[i];\n            switch (st.type) {\n                case 'space':\n                case 'comment':\n                case 'newline':\n                    offset -= st.source.length;\n                    continue;\n            }\n            // Technically, an empty scalar is immediately after the last non-empty\n            // node, but it's more useful to place it after any whitespace.\n            st = before[++i];\n            while (st?.type === 'space') {\n                offset += st.source.length;\n                st = before[++i];\n            }\n            break;\n        }\n    }\n    return offset;\n}\n\nexport { emptyScalarPosition };\n","import { Alias } from '../nodes/Alias.js';\nimport { isScalar } from '../nodes/identity.js';\nimport { composeCollection } from './compose-collection.js';\nimport { composeScalar } from './compose-scalar.js';\nimport { resolveEnd } from './resolve-end.js';\nimport { emptyScalarPosition } from './util-empty-scalar-position.js';\n\nconst CN = { composeNode, composeEmptyNode };\nfunction composeNode(ctx, token, props, onError) {\n    const atKey = ctx.atKey;\n    const { spaceBefore, comment, anchor, tag } = props;\n    let node;\n    let isSrcToken = true;\n    switch (token.type) {\n        case 'alias':\n            node = composeAlias(ctx, token, onError);\n            if (anchor || tag)\n                onError(token, 'ALIAS_PROPS', 'An alias node must not specify any properties');\n            break;\n        case 'scalar':\n        case 'single-quoted-scalar':\n        case 'double-quoted-scalar':\n        case 'block-scalar':\n            node = composeScalar(ctx, token, tag, onError);\n            if (anchor)\n                node.anchor = anchor.source.substring(1);\n            break;\n        case 'block-map':\n        case 'block-seq':\n        case 'flow-collection':\n            node = composeCollection(CN, ctx, token, props, onError);\n            if (anchor)\n                node.anchor = anchor.source.substring(1);\n            break;\n        default: {\n            const message = token.type === 'error'\n                ? token.message\n                : `Unsupported token (type: ${token.type})`;\n            onError(token, 'UNEXPECTED_TOKEN', message);\n            node = composeEmptyNode(ctx, token.offset, undefined, null, props, onError);\n            isSrcToken = false;\n        }\n    }\n    if (anchor && node.anchor === '')\n        onError(anchor, 'BAD_ALIAS', 'Anchor cannot be an empty string');\n    if (atKey &&\n        ctx.options.stringKeys &&\n        (!isScalar(node) ||\n            typeof node.value !== 'string' ||\n            (node.tag && node.tag !== 'tag:yaml.org,2002:str'))) {\n        const msg = 'With stringKeys, all keys must be strings';\n        onError(tag ?? token, 'NON_STRING_KEY', msg);\n    }\n    if (spaceBefore)\n        node.spaceBefore = true;\n    if (comment) {\n        if (token.type === 'scalar' && token.source === '')\n            node.comment = comment;\n        else\n            node.commentBefore = comment;\n    }\n    // @ts-expect-error Type checking misses meaning of isSrcToken\n    if (ctx.options.keepSourceTokens && isSrcToken)\n        node.srcToken = token;\n    return node;\n}\nfunction composeEmptyNode(ctx, offset, before, pos, { spaceBefore, comment, anchor, tag, end }, onError) {\n    const token = {\n        type: 'scalar',\n        offset: emptyScalarPosition(offset, before, pos),\n        indent: -1,\n        source: ''\n    };\n    const node = composeScalar(ctx, token, tag, onError);\n    if (anchor) {\n        node.anchor = anchor.source.substring(1);\n        if (node.anchor === '')\n            onError(anchor, 'BAD_ALIAS', 'Anchor cannot be an empty string');\n    }\n    if (spaceBefore)\n        node.spaceBefore = true;\n    if (comment) {\n        node.comment = comment;\n        node.range[2] = end;\n    }\n    return node;\n}\nfunction composeAlias({ options }, { offset, source, end }, onError) {\n    const alias = new Alias(source.substring(1));\n    if (alias.source === '')\n        onError(offset, 'BAD_ALIAS', 'Alias cannot be an empty string');\n    if (alias.source.endsWith(':'))\n        onError(offset + source.length - 1, 'BAD_ALIAS', 'Alias ending in : is ambiguous', true);\n    const valueEnd = offset + source.length;\n    const re = resolveEnd(end, valueEnd, options.strict, onError);\n    alias.range = [offset, valueEnd, re.offset];\n    if (re.comment)\n        alias.comment = re.comment;\n    return alias;\n}\n\nexport { composeEmptyNode, composeNode };\n","import { Document } from '../doc/Document.js';\nimport { composeNode, composeEmptyNode } from './compose-node.js';\nimport { resolveEnd } from './resolve-end.js';\nimport { resolveProps } from './resolve-props.js';\n\nfunction composeDoc(options, directives, { offset, start, value, end }, onError) {\n    const opts = Object.assign({ _directives: directives }, options);\n    const doc = new Document(undefined, opts);\n    const ctx = {\n        atKey: false,\n        atRoot: true,\n        directives: doc.directives,\n        options: doc.options,\n        schema: doc.schema\n    };\n    const props = resolveProps(start, {\n        indicator: 'doc-start',\n        next: value ?? end?.[0],\n        offset,\n        onError,\n        parentIndent: 0,\n        startOnNewline: true\n    });\n    if (props.found) {\n        doc.directives.docStart = true;\n        if (value &&\n            (value.type === 'block-map' || value.type === 'block-seq') &&\n            !props.hasNewline)\n            onError(props.end, 'MISSING_CHAR', 'Block collection cannot start on same line with directives-end marker');\n    }\n    // @ts-expect-error If Contents is set, let's trust the user\n    doc.contents = value\n        ? composeNode(ctx, value, props, onError)\n        : composeEmptyNode(ctx, props.end, start, null, props, onError);\n    const contentEnd = doc.contents.range[2];\n    const re = resolveEnd(end, contentEnd, false, onError);\n    if (re.comment)\n        doc.comment = re.comment;\n    doc.range = [offset, contentEnd, re.offset];\n    return doc;\n}\n\nexport { composeDoc };\n","import { Directives } from '../doc/directives.js';\nimport { Document } from '../doc/Document.js';\nimport { YAMLWarning, YAMLParseError } from '../errors.js';\nimport { isCollection, isPair } from '../nodes/identity.js';\nimport { composeDoc } from './compose-doc.js';\nimport { resolveEnd } from './resolve-end.js';\n\nfunction getErrorPos(src) {\n    if (typeof src === 'number')\n        return [src, src + 1];\n    if (Array.isArray(src))\n        return src.length === 2 ? src : [src[0], src[1]];\n    const { offset, source } = src;\n    return [offset, offset + (typeof source === 'string' ? source.length : 1)];\n}\nfunction parsePrelude(prelude) {\n    let comment = '';\n    let atComment = false;\n    let afterEmptyLine = false;\n    for (let i = 0; i < prelude.length; ++i) {\n        const source = prelude[i];\n        switch (source[0]) {\n            case '#':\n                comment +=\n                    (comment === '' ? '' : afterEmptyLine ? '\\n\\n' : '\\n') +\n                        (source.substring(1) || ' ');\n                atComment = true;\n                afterEmptyLine = false;\n                break;\n            case '%':\n                if (prelude[i + 1]?.[0] !== '#')\n                    i += 1;\n                atComment = false;\n                break;\n            default:\n                // This may be wrong after doc-end, but in that case it doesn't matter\n                if (!atComment)\n                    afterEmptyLine = true;\n                atComment = false;\n        }\n    }\n    return { comment, afterEmptyLine };\n}\n/**\n * Compose a stream of CST nodes into a stream of YAML Documents.\n *\n * ```ts\n * import { Composer, Parser } from 'yaml'\n *\n * const src: string = ...\n * const tokens = new Parser().parse(src)\n * const docs = new Composer().compose(tokens)\n * ```\n */\nclass Composer {\n    constructor(options = {}) {\n        this.doc = null;\n        this.atDirectives = false;\n        this.prelude = [];\n        this.errors = [];\n        this.warnings = [];\n        this.onError = (source, code, message, warning) => {\n            const pos = getErrorPos(source);\n            if (warning)\n                this.warnings.push(new YAMLWarning(pos, code, message));\n            else\n                this.errors.push(new YAMLParseError(pos, code, message));\n        };\n        // eslint-disable-next-line @typescript-eslint/prefer-nullish-coalescing\n        this.directives = new Directives({ version: options.version || '1.2' });\n        this.options = options;\n    }\n    decorate(doc, afterDoc) {\n        const { comment, afterEmptyLine } = parsePrelude(this.prelude);\n        //console.log({ dc: doc.comment, prelude, comment })\n        if (comment) {\n            const dc = doc.contents;\n            if (afterDoc) {\n                doc.comment = doc.comment ? `${doc.comment}\\n${comment}` : comment;\n            }\n            else if (afterEmptyLine || doc.directives.docStart || !dc) {\n                doc.commentBefore = comment;\n            }\n            else if (isCollection(dc) && !dc.flow && dc.items.length > 0) {\n                let it = dc.items[0];\n                if (isPair(it))\n                    it = it.key;\n                const cb = it.commentBefore;\n                it.commentBefore = cb ? `${comment}\\n${cb}` : comment;\n            }\n            else {\n                const cb = dc.commentBefore;\n                dc.commentBefore = cb ? `${comment}\\n${cb}` : comment;\n            }\n        }\n        if (afterDoc) {\n            Array.prototype.push.apply(doc.errors, this.errors);\n            Array.prototype.push.apply(doc.warnings, this.warnings);\n        }\n        else {\n            doc.errors = this.errors;\n            doc.warnings = this.warnings;\n        }\n        this.prelude = [];\n        this.errors = [];\n        this.warnings = [];\n    }\n    /**\n     * Current stream status information.\n     *\n     * Mostly useful at the end of input for an empty stream.\n     */\n    streamInfo() {\n        return {\n            comment: parsePrelude(this.prelude).comment,\n            directives: this.directives,\n            errors: this.errors,\n            warnings: this.warnings\n        };\n    }\n    /**\n     * Compose tokens into documents.\n     *\n     * @param forceDoc - If the stream contains no document, still emit a final document including any comments and directives that would be applied to a subsequent document.\n     * @param endOffset - Should be set if `forceDoc` is also set, to set the document range end and to indicate errors correctly.\n     */\n    *compose(tokens, forceDoc = false, endOffset = -1) {\n        for (const token of tokens)\n            yield* this.next(token);\n        yield* this.end(forceDoc, endOffset);\n    }\n    /** Advance the composer by one CST token. */\n    *next(token) {\n        switch (token.type) {\n            case 'directive':\n                this.directives.add(token.source, (offset, message, warning) => {\n                    const pos = getErrorPos(token);\n                    pos[0] += offset;\n                    this.onError(pos, 'BAD_DIRECTIVE', message, warning);\n                });\n                this.prelude.push(token.source);\n                this.atDirectives = true;\n                break;\n            case 'document': {\n                const doc = composeDoc(this.options, this.directives, token, this.onError);\n                if (this.atDirectives && !doc.directives.docStart)\n                    this.onError(token, 'MISSING_CHAR', 'Missing directives-end/doc-start indicator line');\n                this.decorate(doc, false);\n                if (this.doc)\n                    yield this.doc;\n                this.doc = doc;\n                this.atDirectives = false;\n                break;\n            }\n            case 'byte-order-mark':\n            case 'space':\n                break;\n            case 'comment':\n            case 'newline':\n                this.prelude.push(token.source);\n                break;\n            case 'error': {\n                const msg = token.source\n                    ? `${token.message}: ${JSON.stringify(token.source)}`\n                    : token.message;\n                const error = new YAMLParseError(getErrorPos(token), 'UNEXPECTED_TOKEN', msg);\n                if (this.atDirectives || !this.doc)\n                    this.errors.push(error);\n                else\n                    this.doc.errors.push(error);\n                break;\n            }\n            case 'doc-end': {\n                if (!this.doc) {\n                    const msg = 'Unexpected doc-end without preceding document';\n                    this.errors.push(new YAMLParseError(getErrorPos(token), 'UNEXPECTED_TOKEN', msg));\n                    break;\n                }\n                this.doc.directives.docEnd = true;\n                const end = resolveEnd(token.end, token.offset + token.source.length, this.doc.options.strict, this.onError);\n                this.decorate(this.doc, true);\n                if (end.comment) {\n                    const dc = this.doc.comment;\n                    this.doc.comment = dc ? `${dc}\\n${end.comment}` : end.comment;\n                }\n                this.doc.range[2] = end.offset;\n                break;\n            }\n            default:\n                this.errors.push(new YAMLParseError(getErrorPos(token), 'UNEXPECTED_TOKEN', `Unsupported token ${token.type}`));\n        }\n    }\n    /**\n     * Call at end of input to yield any remaining document.\n     *\n     * @param forceDoc - If the stream contains no document, still emit a final document including any comments and directives that would be applied to a subsequent document.\n     * @param endOffset - Should be set if `forceDoc` is also set, to set the document range end and to indicate errors correctly.\n     */\n    *end(forceDoc = false, endOffset = -1) {\n        if (this.doc) {\n            this.decorate(this.doc, true);\n            yield this.doc;\n            this.doc = null;\n        }\n        else if (forceDoc) {\n            const opts = Object.assign({ _directives: this.directives }, this.options);\n            const doc = new Document(undefined, opts);\n            if (this.atDirectives)\n                this.onError(endOffset, 'MISSING_CHAR', 'Missing directives-end indicator line');\n            doc.range = [0, endOffset, endOffset];\n            this.decorate(doc, false);\n            yield doc;\n        }\n    }\n}\n\nexport { Composer };\n","export { createScalarToken, resolveAsScalar, setScalarValue } from './cst-scalar.js';\nexport { stringify } from './cst-stringify.js';\nexport { visit } from './cst-visit.js';\n\n/** The byte order mark */\nconst BOM = '\\u{FEFF}';\n/** Start of doc-mode */\nconst DOCUMENT = '\\x02'; // C0: Start of Text\n/** Unexpected end of flow-mode */\nconst FLOW_END = '\\x18'; // C0: Cancel\n/** Next token is a scalar value */\nconst SCALAR = '\\x1f'; // C0: Unit Separator\n/** @returns `true` if `token` is a flow or block collection */\nconst isCollection = (token) => !!token && 'items' in token;\n/** @returns `true` if `token` is a flow or block scalar; not an alias */\nconst isScalar = (token) => !!token &&\n    (token.type === 'scalar' ||\n        token.type === 'single-quoted-scalar' ||\n        token.type === 'double-quoted-scalar' ||\n        token.type === 'block-scalar');\n/* istanbul ignore next */\n/** Get a printable representation of a lexer token */\nfunction prettyToken(token) {\n    switch (token) {\n        case BOM:\n            return '<BOM>';\n        case DOCUMENT:\n            return '<DOC>';\n        case FLOW_END:\n            return '<FLOW_END>';\n        case SCALAR:\n            return '<SCALAR>';\n        default:\n            return JSON.stringify(token);\n    }\n}\n/** Identify the type of a lexer token. May return `null` for unknown tokens. */\nfunction tokenType(source) {\n    switch (source) {\n        case BOM:\n            return 'byte-order-mark';\n        case DOCUMENT:\n            return 'doc-mode';\n        case FLOW_END:\n            return 'flow-error-end';\n        case SCALAR:\n            return 'scalar';\n        case '---':\n            return 'doc-start';\n        case '...':\n            return 'doc-end';\n        case '':\n        case '\\n':\n        case '\\r\\n':\n            return 'newline';\n        case '-':\n            return 'seq-item-ind';\n        case '?':\n            return 'explicit-key-ind';\n        case ':':\n            return 'map-value-ind';\n        case '{':\n            return 'flow-map-start';\n        case '}':\n            return 'flow-map-end';\n        case '[':\n            return 'flow-seq-start';\n        case ']':\n            return 'flow-seq-end';\n        case ',':\n            return 'comma';\n    }\n    switch (source[0]) {\n        case ' ':\n        case '\\t':\n            return 'space';\n        case '#':\n            return 'comment';\n        case '%':\n            return 'directive-line';\n        case '*':\n            return 'alias';\n        case '&':\n            return 'anchor';\n        case '!':\n            return 'tag';\n        case \"'\":\n            return 'single-quoted-scalar';\n        case '\"':\n            return 'double-quoted-scalar';\n        case '|':\n        case '>':\n            return 'block-scalar-header';\n    }\n    return null;\n}\n\nexport { BOM, DOCUMENT, FLOW_END, SCALAR, isCollection, isScalar, prettyToken, tokenType };\n","import { BOM, DOCUMENT, FLOW_END, SCALAR } from './cst.js';\n\n/*\nSTART -> stream\n\nstream\n  directive -> line-end -> stream\n  indent + line-end -> stream\n  [else] -> line-start\n\nline-end\n  comment -> line-end\n  newline -> .\n  input-end -> END\n\nline-start\n  doc-start -> doc\n  doc-end -> stream\n  [else] -> indent -> block-start\n\nblock-start\n  seq-item-start -> block-start\n  explicit-key-start -> block-start\n  map-value-start -> block-start\n  [else] -> doc\n\ndoc\n  line-end -> line-start\n  spaces -> doc\n  anchor -> doc\n  tag -> doc\n  flow-start -> flow -> doc\n  flow-end -> error -> doc\n  seq-item-start -> error -> doc\n  explicit-key-start -> error -> doc\n  map-value-start -> doc\n  alias -> doc\n  quote-start -> quoted-scalar -> doc\n  block-scalar-header -> line-end -> block-scalar(min) -> line-start\n  [else] -> plain-scalar(false, min) -> doc\n\nflow\n  line-end -> flow\n  spaces -> flow\n  anchor -> flow\n  tag -> flow\n  flow-start -> flow -> flow\n  flow-end -> .\n  seq-item-start -> error -> flow\n  explicit-key-start -> flow\n  map-value-start -> flow\n  alias -> flow\n  quote-start -> quoted-scalar -> flow\n  comma -> flow\n  [else] -> plain-scalar(true, 0) -> flow\n\nquoted-scalar\n  quote-end -> .\n  [else] -> quoted-scalar\n\nblock-scalar(min)\n  newline + peek(indent < min) -> .\n  [else] -> block-scalar(min)\n\nplain-scalar(is-flow, min)\n  scalar-end(is-flow) -> .\n  peek(newline + (indent < min)) -> .\n  [else] -> plain-scalar(min)\n*/\nfunction isEmpty(ch) {\n    switch (ch) {\n        case undefined:\n        case ' ':\n        case '\\n':\n        case '\\r':\n        case '\\t':\n            return true;\n        default:\n            return false;\n    }\n}\nconst hexDigits = new Set('0123456789ABCDEFabcdef');\nconst tagChars = new Set(\"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-#;/?:@&=+$_.!~*'()\");\nconst flowIndicatorChars = new Set(',[]{}');\nconst invalidAnchorChars = new Set(' ,[]{}\\n\\r\\t');\nconst isNotAnchorChar = (ch) => !ch || invalidAnchorChars.has(ch);\n/**\n * Splits an input string into lexical tokens, i.e. smaller strings that are\n * easily identifiable by `tokens.tokenType()`.\n *\n * Lexing starts always in a \"stream\" context. Incomplete input may be buffered\n * until a complete token can be emitted.\n *\n * In addition to slices of the original input, the following control characters\n * may also be emitted:\n *\n * - `\\x02` (Start of Text): A document starts with the next token\n * - `\\x18` (Cancel): Unexpected end of flow-mode (indicates an error)\n * - `\\x1f` (Unit Separator): Next token is a scalar value\n * - `\\u{FEFF}` (Byte order mark): Emitted separately outside documents\n */\nclass Lexer {\n    constructor() {\n        /**\n         * Flag indicating whether the end of the current buffer marks the end of\n         * all input\n         */\n        this.atEnd = false;\n        /**\n         * Explicit indent set in block scalar header, as an offset from the current\n         * minimum indent, so e.g. set to 1 from a header `|2+`. Set to -1 if not\n         * explicitly set.\n         */\n        this.blockScalarIndent = -1;\n        /**\n         * Block scalars that include a + (keep) chomping indicator in their header\n         * include trailing empty lines, which are otherwise excluded from the\n         * scalar's contents.\n         */\n        this.blockScalarKeep = false;\n        /** Current input */\n        this.buffer = '';\n        /**\n         * Flag noting whether the map value indicator : can immediately follow this\n         * node within a flow context.\n         */\n        this.flowKey = false;\n        /** Count of surrounding flow collection levels. */\n        this.flowLevel = 0;\n        /**\n         * Minimum level of indentation required for next lines to be parsed as a\n         * part of the current scalar value.\n         */\n        this.indentNext = 0;\n        /** Indentation level of the current line. */\n        this.indentValue = 0;\n        /** Position of the next \\n character. */\n        this.lineEndPos = null;\n        /** Stores the state of the lexer if reaching the end of incpomplete input */\n        this.next = null;\n        /** A pointer to `buffer`; the current position of the lexer. */\n        this.pos = 0;\n    }\n    /**\n     * Generate YAML tokens from the `source` string. If `incomplete`,\n     * a part of the last line may be left as a buffer for the next call.\n     *\n     * @returns A generator of lexical tokens\n     */\n    *lex(source, incomplete = false) {\n        if (source) {\n            if (typeof source !== 'string')\n                throw TypeError('source is not a string');\n            this.buffer = this.buffer ? this.buffer + source : source;\n            this.lineEndPos = null;\n        }\n        this.atEnd = !incomplete;\n        let next = this.next ?? 'stream';\n        while (next && (incomplete || this.hasChars(1)))\n            next = yield* this.parseNext(next);\n    }\n    atLineEnd() {\n        let i = this.pos;\n        let ch = this.buffer[i];\n        while (ch === ' ' || ch === '\\t')\n            ch = this.buffer[++i];\n        if (!ch || ch === '#' || ch === '\\n')\n            return true;\n        if (ch === '\\r')\n            return this.buffer[i + 1] === '\\n';\n        return false;\n    }\n    charAt(n) {\n        return this.buffer[this.pos + n];\n    }\n    continueScalar(offset) {\n        let ch = this.buffer[offset];\n        if (this.indentNext > 0) {\n            let indent = 0;\n            while (ch === ' ')\n                ch = this.buffer[++indent + offset];\n            if (ch === '\\r') {\n                const next = this.buffer[indent + offset + 1];\n                if (next === '\\n' || (!next && !this.atEnd))\n                    return offset + indent + 1;\n            }\n            return ch === '\\n' || indent >= this.indentNext || (!ch && !this.atEnd)\n                ? offset + indent\n                : -1;\n        }\n        if (ch === '-' || ch === '.') {\n            const dt = this.buffer.substr(offset, 3);\n            if ((dt === '---' || dt === '...') && isEmpty(this.buffer[offset + 3]))\n                return -1;\n        }\n        return offset;\n    }\n    getLine() {\n        let end = this.lineEndPos;\n        if (typeof end !== 'number' || (end !== -1 && end < this.pos)) {\n            end = this.buffer.indexOf('\\n', this.pos);\n            this.lineEndPos = end;\n        }\n        if (end === -1)\n            return this.atEnd ? this.buffer.substring(this.pos) : null;\n        if (this.buffer[end - 1] === '\\r')\n            end -= 1;\n        return this.buffer.substring(this.pos, end);\n    }\n    hasChars(n) {\n        return this.pos + n <= this.buffer.length;\n    }\n    setNext(state) {\n        this.buffer = this.buffer.substring(this.pos);\n        this.pos = 0;\n        this.lineEndPos = null;\n        this.next = state;\n        return null;\n    }\n    peek(n) {\n        return this.buffer.substr(this.pos, n);\n    }\n    *parseNext(next) {\n        switch (next) {\n            case 'stream':\n                return yield* this.parseStream();\n            case 'line-start':\n                return yield* this.parseLineStart();\n            case 'block-start':\n                return yield* this.parseBlockStart();\n            case 'doc':\n                return yield* this.parseDocument();\n            case 'flow':\n                return yield* this.parseFlowCollection();\n            case 'quoted-scalar':\n                return yield* this.parseQuotedScalar();\n            case 'block-scalar':\n                return yield* this.parseBlockScalar();\n            case 'plain-scalar':\n                return yield* this.parsePlainScalar();\n        }\n    }\n    *parseStream() {\n        let line = this.getLine();\n        if (line === null)\n            return this.setNext('stream');\n        if (line[0] === BOM) {\n            yield* this.pushCount(1);\n            line = line.substring(1);\n        }\n        if (line[0] === '%') {\n            let dirEnd = line.length;\n            let cs = line.indexOf('#');\n            while (cs !== -1) {\n                const ch = line[cs - 1];\n                if (ch === ' ' || ch === '\\t') {\n                    dirEnd = cs - 1;\n                    break;\n                }\n                else {\n                    cs = line.indexOf('#', cs + 1);\n                }\n            }\n            while (true) {\n                const ch = line[dirEnd - 1];\n                if (ch === ' ' || ch === '\\t')\n                    dirEnd -= 1;\n                else\n                    break;\n            }\n            const n = (yield* this.pushCount(dirEnd)) + (yield* this.pushSpaces(true));\n            yield* this.pushCount(line.length - n); // possible comment\n            this.pushNewline();\n            return 'stream';\n        }\n        if (this.atLineEnd()) {\n            const sp = yield* this.pushSpaces(true);\n            yield* this.pushCount(line.length - sp);\n            yield* this.pushNewline();\n            return 'stream';\n        }\n        yield DOCUMENT;\n        return yield* this.parseLineStart();\n    }\n    *parseLineStart() {\n        const ch = this.charAt(0);\n        if (!ch && !this.atEnd)\n            return this.setNext('line-start');\n        if (ch === '-' || ch === '.') {\n            if (!this.atEnd && !this.hasChars(4))\n                return this.setNext('line-start');\n            const s = this.peek(3);\n            if ((s === '---' || s === '...') && isEmpty(this.charAt(3))) {\n                yield* this.pushCount(3);\n                this.indentValue = 0;\n                this.indentNext = 0;\n                return s === '---' ? 'doc' : 'stream';\n            }\n        }\n        this.indentValue = yield* this.pushSpaces(false);\n        if (this.indentNext > this.indentValue && !isEmpty(this.charAt(1)))\n            this.indentNext = this.indentValue;\n        return yield* this.parseBlockStart();\n    }\n    *parseBlockStart() {\n        const [ch0, ch1] = this.peek(2);\n        if (!ch1 && !this.atEnd)\n            return this.setNext('block-start');\n        if ((ch0 === '-' || ch0 === '?' || ch0 === ':') && isEmpty(ch1)) {\n            const n = (yield* this.pushCount(1)) + (yield* this.pushSpaces(true));\n            this.indentNext = this.indentValue + 1;\n            this.indentValue += n;\n            return yield* this.parseBlockStart();\n        }\n        return 'doc';\n    }\n    *parseDocument() {\n        yield* this.pushSpaces(true);\n        const line = this.getLine();\n        if (line === null)\n            return this.setNext('doc');\n        let n = yield* this.pushIndicators();\n        switch (line[n]) {\n            case '#':\n                yield* this.pushCount(line.length - n);\n            // fallthrough\n            case undefined:\n                yield* this.pushNewline();\n                return yield* this.parseLineStart();\n            case '{':\n            case '[':\n                yield* this.pushCount(1);\n                this.flowKey = false;\n                this.flowLevel = 1;\n                return 'flow';\n            case '}':\n            case ']':\n                // this is an error\n                yield* this.pushCount(1);\n                return 'doc';\n            case '*':\n                yield* this.pushUntil(isNotAnchorChar);\n                return 'doc';\n            case '\"':\n            case \"'\":\n                return yield* this.parseQuotedScalar();\n            case '|':\n            case '>':\n                n += yield* this.parseBlockScalarHeader();\n                n += yield* this.pushSpaces(true);\n                yield* this.pushCount(line.length - n);\n                yield* this.pushNewline();\n                return yield* this.parseBlockScalar();\n            default:\n                return yield* this.parsePlainScalar();\n        }\n    }\n    *parseFlowCollection() {\n        let nl, sp;\n        let indent = -1;\n        do {\n            nl = yield* this.pushNewline();\n            if (nl > 0) {\n                sp = yield* this.pushSpaces(false);\n                this.indentValue = indent = sp;\n            }\n            else {\n                sp = 0;\n            }\n            sp += yield* this.pushSpaces(true);\n        } while (nl + sp > 0);\n        const line = this.getLine();\n        if (line === null)\n            return this.setNext('flow');\n        if ((indent !== -1 && indent < this.indentNext && line[0] !== '#') ||\n            (indent === 0 &&\n                (line.startsWith('---') || line.startsWith('...')) &&\n                isEmpty(line[3]))) {\n            // Allowing for the terminal ] or } at the same (rather than greater)\n            // indent level as the initial [ or { is technically invalid, but\n            // failing here would be surprising to users.\n            const atFlowEndMarker = indent === this.indentNext - 1 &&\n                this.flowLevel === 1 &&\n                (line[0] === ']' || line[0] === '}');\n            if (!atFlowEndMarker) {\n                // this is an error\n                this.flowLevel = 0;\n                yield FLOW_END;\n                return yield* this.parseLineStart();\n            }\n        }\n        let n = 0;\n        while (line[n] === ',') {\n            n += yield* this.pushCount(1);\n            n += yield* this.pushSpaces(true);\n            this.flowKey = false;\n        }\n        n += yield* this.pushIndicators();\n        switch (line[n]) {\n            case undefined:\n                return 'flow';\n            case '#':\n                yield* this.pushCount(line.length - n);\n                return 'flow';\n            case '{':\n            case '[':\n                yield* this.pushCount(1);\n                this.flowKey = false;\n                this.flowLevel += 1;\n                return 'flow';\n            case '}':\n            case ']':\n                yield* this.pushCount(1);\n                this.flowKey = true;\n                this.flowLevel -= 1;\n                return this.flowLevel ? 'flow' : 'doc';\n            case '*':\n                yield* this.pushUntil(isNotAnchorChar);\n                return 'flow';\n            case '\"':\n            case \"'\":\n                this.flowKey = true;\n                return yield* this.parseQuotedScalar();\n            case ':': {\n                const next = this.charAt(1);\n                if (this.flowKey || isEmpty(next) || next === ',') {\n                    this.flowKey = false;\n                    yield* this.pushCount(1);\n                    yield* this.pushSpaces(true);\n                    return 'flow';\n                }\n            }\n            // fallthrough\n            default:\n                this.flowKey = false;\n                return yield* this.parsePlainScalar();\n        }\n    }\n    *parseQuotedScalar() {\n        const quote = this.charAt(0);\n        let end = this.buffer.indexOf(quote, this.pos + 1);\n        if (quote === \"'\") {\n            while (end !== -1 && this.buffer[end + 1] === \"'\")\n                end = this.buffer.indexOf(\"'\", end + 2);\n        }\n        else {\n            // double-quote\n            while (end !== -1) {\n                let n = 0;\n                while (this.buffer[end - 1 - n] === '\\\\')\n                    n += 1;\n                if (n % 2 === 0)\n                    break;\n                end = this.buffer.indexOf('\"', end + 1);\n            }\n        }\n        // Only looking for newlines within the quotes\n        const qb = this.buffer.substring(0, end);\n        let nl = qb.indexOf('\\n', this.pos);\n        if (nl !== -1) {\n            while (nl !== -1) {\n                const cs = this.continueScalar(nl + 1);\n                if (cs === -1)\n                    break;\n                nl = qb.indexOf('\\n', cs);\n            }\n            if (nl !== -1) {\n                // this is an error caused by an unexpected unindent\n                end = nl - (qb[nl - 1] === '\\r' ? 2 : 1);\n            }\n        }\n        if (end === -1) {\n            if (!this.atEnd)\n                return this.setNext('quoted-scalar');\n            end = this.buffer.length;\n        }\n        yield* this.pushToIndex(end + 1, false);\n        return this.flowLevel ? 'flow' : 'doc';\n    }\n    *parseBlockScalarHeader() {\n        this.blockScalarIndent = -1;\n        this.blockScalarKeep = false;\n        let i = this.pos;\n        while (true) {\n            const ch = this.buffer[++i];\n            if (ch === '+')\n                this.blockScalarKeep = true;\n            else if (ch > '0' && ch <= '9')\n                this.blockScalarIndent = Number(ch) - 1;\n            else if (ch !== '-')\n                break;\n        }\n        return yield* this.pushUntil(ch => isEmpty(ch) || ch === '#');\n    }\n    *parseBlockScalar() {\n        let nl = this.pos - 1; // may be -1 if this.pos === 0\n        let indent = 0;\n        let ch;\n        loop: for (let i = this.pos; (ch = this.buffer[i]); ++i) {\n            switch (ch) {\n                case ' ':\n                    indent += 1;\n                    break;\n                case '\\n':\n                    nl = i;\n                    indent = 0;\n                    break;\n                case '\\r': {\n                    const next = this.buffer[i + 1];\n                    if (!next && !this.atEnd)\n                        return this.setNext('block-scalar');\n                    if (next === '\\n')\n                        break;\n                } // fallthrough\n                default:\n                    break loop;\n            }\n        }\n        if (!ch && !this.atEnd)\n            return this.setNext('block-scalar');\n        if (indent >= this.indentNext) {\n            if (this.blockScalarIndent === -1)\n                this.indentNext = indent;\n            else {\n                this.indentNext =\n                    this.blockScalarIndent + (this.indentNext === 0 ? 1 : this.indentNext);\n            }\n            do {\n                const cs = this.continueScalar(nl + 1);\n                if (cs === -1)\n                    break;\n                nl = this.buffer.indexOf('\\n', cs);\n            } while (nl !== -1);\n            if (nl === -1) {\n                if (!this.atEnd)\n                    return this.setNext('block-scalar');\n                nl = this.buffer.length;\n            }\n        }\n        // Trailing insufficiently indented tabs are invalid.\n        // To catch that during parsing, we include them in the block scalar value.\n        let i = nl + 1;\n        ch = this.buffer[i];\n        while (ch === ' ')\n            ch = this.buffer[++i];\n        if (ch === '\\t') {\n            while (ch === '\\t' || ch === ' ' || ch === '\\r' || ch === '\\n')\n                ch = this.buffer[++i];\n            nl = i - 1;\n        }\n        else if (!this.blockScalarKeep) {\n            do {\n                let i = nl - 1;\n                let ch = this.buffer[i];\n                if (ch === '\\r')\n                    ch = this.buffer[--i];\n                const lastChar = i; // Drop the line if last char not more indented\n                while (ch === ' ')\n                    ch = this.buffer[--i];\n                if (ch === '\\n' && i >= this.pos && i + 1 + indent > lastChar)\n                    nl = i;\n                else\n                    break;\n            } while (true);\n        }\n        yield SCALAR;\n        yield* this.pushToIndex(nl + 1, true);\n        return yield* this.parseLineStart();\n    }\n    *parsePlainScalar() {\n        const inFlow = this.flowLevel > 0;\n        let end = this.pos - 1;\n        let i = this.pos - 1;\n        let ch;\n        while ((ch = this.buffer[++i])) {\n            if (ch === ':') {\n                const next = this.buffer[i + 1];\n                if (isEmpty(next) || (inFlow && flowIndicatorChars.has(next)))\n                    break;\n                end = i;\n            }\n            else if (isEmpty(ch)) {\n                let next = this.buffer[i + 1];\n                if (ch === '\\r') {\n                    if (next === '\\n') {\n                        i += 1;\n                        ch = '\\n';\n                        next = this.buffer[i + 1];\n                    }\n                    else\n                        end = i;\n                }\n                if (next === '#' || (inFlow && flowIndicatorChars.has(next)))\n                    break;\n                if (ch === '\\n') {\n                    const cs = this.continueScalar(i + 1);\n                    if (cs === -1)\n                        break;\n                    i = Math.max(i, cs - 2); // to advance, but still account for ' #'\n                }\n            }\n            else {\n                if (inFlow && flowIndicatorChars.has(ch))\n                    break;\n                end = i;\n            }\n        }\n        if (!ch && !this.atEnd)\n            return this.setNext('plain-scalar');\n        yield SCALAR;\n        yield* this.pushToIndex(end + 1, true);\n        return inFlow ? 'flow' : 'doc';\n    }\n    *pushCount(n) {\n        if (n > 0) {\n            yield this.buffer.substr(this.pos, n);\n            this.pos += n;\n            return n;\n        }\n        return 0;\n    }\n    *pushToIndex(i, allowEmpty) {\n        const s = this.buffer.slice(this.pos, i);\n        if (s) {\n            yield s;\n            this.pos += s.length;\n            return s.length;\n        }\n        else if (allowEmpty)\n            yield '';\n        return 0;\n    }\n    *pushIndicators() {\n        switch (this.charAt(0)) {\n            case '!':\n                return ((yield* this.pushTag()) +\n                    (yield* this.pushSpaces(true)) +\n                    (yield* this.pushIndicators()));\n            case '&':\n                return ((yield* this.pushUntil(isNotAnchorChar)) +\n                    (yield* this.pushSpaces(true)) +\n                    (yield* this.pushIndicators()));\n            case '-': // this is an error\n            case '?': // this is an error outside flow collections\n            case ':': {\n                const inFlow = this.flowLevel > 0;\n                const ch1 = this.charAt(1);\n                if (isEmpty(ch1) || (inFlow && flowIndicatorChars.has(ch1))) {\n                    if (!inFlow)\n                        this.indentNext = this.indentValue + 1;\n                    else if (this.flowKey)\n                        this.flowKey = false;\n                    return ((yield* this.pushCount(1)) +\n                        (yield* this.pushSpaces(true)) +\n                        (yield* this.pushIndicators()));\n                }\n            }\n        }\n        return 0;\n    }\n    *pushTag() {\n        if (this.charAt(1) === '<') {\n            let i = this.pos + 2;\n            let ch = this.buffer[i];\n            while (!isEmpty(ch) && ch !== '>')\n                ch = this.buffer[++i];\n            return yield* this.pushToIndex(ch === '>' ? i + 1 : i, false);\n        }\n        else {\n            let i = this.pos + 1;\n            let ch = this.buffer[i];\n            while (ch) {\n                if (tagChars.has(ch))\n                    ch = this.buffer[++i];\n                else if (ch === '%' &&\n                    hexDigits.has(this.buffer[i + 1]) &&\n                    hexDigits.has(this.buffer[i + 2])) {\n                    ch = this.buffer[(i += 3)];\n                }\n                else\n                    break;\n            }\n            return yield* this.pushToIndex(i, false);\n        }\n    }\n    *pushNewline() {\n        const ch = this.buffer[this.pos];\n        if (ch === '\\n')\n            return yield* this.pushCount(1);\n        else if (ch === '\\r' && this.charAt(1) === '\\n')\n            return yield* this.pushCount(2);\n        else\n            return 0;\n    }\n    *pushSpaces(allowTabs) {\n        let i = this.pos - 1;\n        let ch;\n        do {\n            ch = this.buffer[++i];\n        } while (ch === ' ' || (allowTabs && ch === '\\t'));\n        const n = i - this.pos;\n        if (n > 0) {\n            yield this.buffer.substr(this.pos, n);\n            this.pos = i;\n        }\n        return n;\n    }\n    *pushUntil(test) {\n        let i = this.pos;\n        let ch = this.buffer[i];\n        while (!test(ch))\n            ch = this.buffer[++i];\n        return yield* this.pushToIndex(i, false);\n    }\n}\n\nexport { Lexer };\n","/**\n * Tracks newlines during parsing in order to provide an efficient API for\n * determining the one-indexed `{ line, col }` position for any offset\n * within the input.\n */\nclass LineCounter {\n    constructor() {\n        this.lineStarts = [];\n        /**\n         * Should be called in ascending order. Otherwise, call\n         * `lineCounter.lineStarts.sort()` before calling `linePos()`.\n         */\n        this.addNewLine = (offset) => this.lineStarts.push(offset);\n        /**\n         * Performs a binary search and returns the 1-indexed { line, col }\n         * position of `offset`. If `line === 0`, `addNewLine` has never been\n         * called or `offset` is before the first known newline.\n         */\n        this.linePos = (offset) => {\n            let low = 0;\n            let high = this.lineStarts.length;\n            while (low < high) {\n                const mid = (low + high) >> 1; // Math.floor((low + high) / 2)\n                if (this.lineStarts[mid] < offset)\n                    low = mid + 1;\n                else\n                    high = mid;\n            }\n            if (this.lineStarts[low] === offset)\n                return { line: low + 1, col: 1 };\n            if (low === 0)\n                return { line: 0, col: offset };\n            const start = this.lineStarts[low - 1];\n            return { line: low, col: offset - start + 1 };\n        };\n    }\n}\n\nexport { LineCounter };\n","import { tokenType } from './cst.js';\nimport { Lexer } from './lexer.js';\n\nfunction includesToken(list, type) {\n    for (let i = 0; i < list.length; ++i)\n        if (list[i].type === type)\n            return true;\n    return false;\n}\nfunction findNonEmptyIndex(list) {\n    for (let i = 0; i < list.length; ++i) {\n        switch (list[i].type) {\n            case 'space':\n            case 'comment':\n            case 'newline':\n                break;\n            default:\n                return i;\n        }\n    }\n    return -1;\n}\nfunction isFlowToken(token) {\n    switch (token?.type) {\n        case 'alias':\n        case 'scalar':\n        case 'single-quoted-scalar':\n        case 'double-quoted-scalar':\n        case 'flow-collection':\n            return true;\n        default:\n            return false;\n    }\n}\nfunction getPrevProps(parent) {\n    switch (parent.type) {\n        case 'document':\n            return parent.start;\n        case 'block-map': {\n            const it = parent.items[parent.items.length - 1];\n            return it.sep ?? it.start;\n        }\n        case 'block-seq':\n            return parent.items[parent.items.length - 1].start;\n        /* istanbul ignore next should not happen */\n        default:\n            return [];\n    }\n}\n/** Note: May modify input array */\nfunction getFirstKeyStartProps(prev) {\n    if (prev.length === 0)\n        return [];\n    let i = prev.length;\n    loop: while (--i >= 0) {\n        switch (prev[i].type) {\n            case 'doc-start':\n            case 'explicit-key-ind':\n            case 'map-value-ind':\n            case 'seq-item-ind':\n            case 'newline':\n                break loop;\n        }\n    }\n    while (prev[++i]?.type === 'space') {\n        /* loop */\n    }\n    return prev.splice(i, prev.length);\n}\nfunction fixFlowSeqItems(fc) {\n    if (fc.start.type === 'flow-seq-start') {\n        for (const it of fc.items) {\n            if (it.sep &&\n                !it.value &&\n                !includesToken(it.start, 'explicit-key-ind') &&\n                !includesToken(it.sep, 'map-value-ind')) {\n                if (it.key)\n                    it.value = it.key;\n                delete it.key;\n                if (isFlowToken(it.value)) {\n                    if (it.value.end)\n                        Array.prototype.push.apply(it.value.end, it.sep);\n                    else\n                        it.value.end = it.sep;\n                }\n                else\n                    Array.prototype.push.apply(it.start, it.sep);\n                delete it.sep;\n            }\n        }\n    }\n}\n/**\n * A YAML concrete syntax tree (CST) parser\n *\n * ```ts\n * const src: string = ...\n * for (const token of new Parser().parse(src)) {\n *   // token: Token\n * }\n * ```\n *\n * To use the parser with a user-provided lexer:\n *\n * ```ts\n * function* parse(source: string, lexer: Lexer) {\n *   const parser = new Parser()\n *   for (const lexeme of lexer.lex(source))\n *     yield* parser.next(lexeme)\n *   yield* parser.end()\n * }\n *\n * const src: string = ...\n * const lexer = new Lexer()\n * for (const token of parse(src, lexer)) {\n *   // token: Token\n * }\n * ```\n */\nclass Parser {\n    /**\n     * @param onNewLine - If defined, called separately with the start position of\n     *   each new line (in `parse()`, including the start of input).\n     */\n    constructor(onNewLine) {\n        /** If true, space and sequence indicators count as indentation */\n        this.atNewLine = true;\n        /** If true, next token is a scalar value */\n        this.atScalar = false;\n        /** Current indentation level */\n        this.indent = 0;\n        /** Current offset since the start of parsing */\n        this.offset = 0;\n        /** On the same line with a block map key */\n        this.onKeyLine = false;\n        /** Top indicates the node that's currently being built */\n        this.stack = [];\n        /** The source of the current token, set in parse() */\n        this.source = '';\n        /** The type of the current token, set in parse() */\n        this.type = '';\n        // Must be defined after `next()`\n        this.lexer = new Lexer();\n        this.onNewLine = onNewLine;\n    }\n    /**\n     * Parse `source` as a YAML stream.\n     * If `incomplete`, a part of the last line may be left as a buffer for the next call.\n     *\n     * Errors are not thrown, but yielded as `{ type: 'error', message }` tokens.\n     *\n     * @returns A generator of tokens representing each directive, document, and other structure.\n     */\n    *parse(source, incomplete = false) {\n        if (this.onNewLine && this.offset === 0)\n            this.onNewLine(0);\n        for (const lexeme of this.lexer.lex(source, incomplete))\n            yield* this.next(lexeme);\n        if (!incomplete)\n            yield* this.end();\n    }\n    /**\n     * Advance the parser by the `source` of one lexical token.\n     */\n    *next(source) {\n        this.source = source;\n        if (this.atScalar) {\n            this.atScalar = false;\n            yield* this.step();\n            this.offset += source.length;\n            return;\n        }\n        const type = tokenType(source);\n        if (!type) {\n            const message = `Not a YAML token: ${source}`;\n            yield* this.pop({ type: 'error', offset: this.offset, message, source });\n            this.offset += source.length;\n        }\n        else if (type === 'scalar') {\n            this.atNewLine = false;\n            this.atScalar = true;\n            this.type = 'scalar';\n        }\n        else {\n            this.type = type;\n            yield* this.step();\n            switch (type) {\n                case 'newline':\n                    this.atNewLine = true;\n                    this.indent = 0;\n                    if (this.onNewLine)\n                        this.onNewLine(this.offset + source.length);\n                    break;\n                case 'space':\n                    if (this.atNewLine && source[0] === ' ')\n                        this.indent += source.length;\n                    break;\n                case 'explicit-key-ind':\n                case 'map-value-ind':\n                case 'seq-item-ind':\n                    if (this.atNewLine)\n                        this.indent += source.length;\n                    break;\n                case 'doc-mode':\n                case 'flow-error-end':\n                    return;\n                default:\n                    this.atNewLine = false;\n            }\n            this.offset += source.length;\n        }\n    }\n    /** Call at end of input to push out any remaining constructions */\n    *end() {\n        while (this.stack.length > 0)\n            yield* this.pop();\n    }\n    get sourceToken() {\n        const st = {\n            type: this.type,\n            offset: this.offset,\n            indent: this.indent,\n            source: this.source\n        };\n        return st;\n    }\n    *step() {\n        const top = this.peek(1);\n        if (this.type === 'doc-end' && (!top || top.type !== 'doc-end')) {\n            while (this.stack.length > 0)\n                yield* this.pop();\n            this.stack.push({\n                type: 'doc-end',\n                offset: this.offset,\n                source: this.source\n            });\n            return;\n        }\n        if (!top)\n            return yield* this.stream();\n        switch (top.type) {\n            case 'document':\n                return yield* this.document(top);\n            case 'alias':\n            case 'scalar':\n            case 'single-quoted-scalar':\n            case 'double-quoted-scalar':\n                return yield* this.scalar(top);\n            case 'block-scalar':\n                return yield* this.blockScalar(top);\n            case 'block-map':\n                return yield* this.blockMap(top);\n            case 'block-seq':\n                return yield* this.blockSequence(top);\n            case 'flow-collection':\n                return yield* this.flowCollection(top);\n            case 'doc-end':\n                return yield* this.documentEnd(top);\n        }\n        /* istanbul ignore next should not happen */\n        yield* this.pop();\n    }\n    peek(n) {\n        return this.stack[this.stack.length - n];\n    }\n    *pop(error) {\n        const token = error ?? this.stack.pop();\n        /* istanbul ignore if should not happen */\n        if (!token) {\n            const message = 'Tried to pop an empty stack';\n            yield { type: 'error', offset: this.offset, source: '', message };\n        }\n        else if (this.stack.length === 0) {\n            yield token;\n        }\n        else {\n            const top = this.peek(1);\n            if (token.type === 'block-scalar') {\n                // Block scalars use their parent rather than header indent\n                token.indent = 'indent' in top ? top.indent : 0;\n            }\n            else if (token.type === 'flow-collection' && top.type === 'document') {\n                // Ignore all indent for top-level flow collections\n                token.indent = 0;\n            }\n            if (token.type === 'flow-collection')\n                fixFlowSeqItems(token);\n            switch (top.type) {\n                case 'document':\n                    top.value = token;\n                    break;\n                case 'block-scalar':\n                    top.props.push(token); // error\n                    break;\n                case 'block-map': {\n                    const it = top.items[top.items.length - 1];\n                    if (it.value) {\n                        top.items.push({ start: [], key: token, sep: [] });\n                        this.onKeyLine = true;\n                        return;\n                    }\n                    else if (it.sep) {\n                        it.value = token;\n                    }\n                    else {\n                        Object.assign(it, { key: token, sep: [] });\n                        this.onKeyLine = !it.explicitKey;\n                        return;\n                    }\n                    break;\n                }\n                case 'block-seq': {\n                    const it = top.items[top.items.length - 1];\n                    if (it.value)\n                        top.items.push({ start: [], value: token });\n                    else\n                        it.value = token;\n                    break;\n                }\n                case 'flow-collection': {\n                    const it = top.items[top.items.length - 1];\n                    if (!it || it.value)\n                        top.items.push({ start: [], key: token, sep: [] });\n                    else if (it.sep)\n                        it.value = token;\n                    else\n                        Object.assign(it, { key: token, sep: [] });\n                    return;\n                }\n                /* istanbul ignore next should not happen */\n                default:\n                    yield* this.pop();\n                    yield* this.pop(token);\n            }\n            if ((top.type === 'document' ||\n                top.type === 'block-map' ||\n                top.type === 'block-seq') &&\n                (token.type === 'block-map' || token.type === 'block-seq')) {\n                const last = token.items[token.items.length - 1];\n                if (last &&\n                    !last.sep &&\n                    !last.value &&\n                    last.start.length > 0 &&\n                    findNonEmptyIndex(last.start) === -1 &&\n                    (token.indent === 0 ||\n                        last.start.every(st => st.type !== 'comment' || st.indent < token.indent))) {\n                    if (top.type === 'document')\n                        top.end = last.start;\n                    else\n                        top.items.push({ start: last.start });\n                    token.items.splice(-1, 1);\n                }\n            }\n        }\n    }\n    *stream() {\n        switch (this.type) {\n            case 'directive-line':\n                yield { type: 'directive', offset: this.offset, source: this.source };\n                return;\n            case 'byte-order-mark':\n            case 'space':\n            case 'comment':\n            case 'newline':\n                yield this.sourceToken;\n                return;\n            case 'doc-mode':\n            case 'doc-start': {\n                const doc = {\n                    type: 'document',\n                    offset: this.offset,\n                    start: []\n                };\n                if (this.type === 'doc-start')\n                    doc.start.push(this.sourceToken);\n                this.stack.push(doc);\n                return;\n            }\n        }\n        yield {\n            type: 'error',\n            offset: this.offset,\n            message: `Unexpected ${this.type} token in YAML stream`,\n            source: this.source\n        };\n    }\n    *document(doc) {\n        if (doc.value)\n            return yield* this.lineEnd(doc);\n        switch (this.type) {\n            case 'doc-start': {\n                if (findNonEmptyIndex(doc.start) !== -1) {\n                    yield* this.pop();\n                    yield* this.step();\n                }\n                else\n                    doc.start.push(this.sourceToken);\n                return;\n            }\n            case 'anchor':\n            case 'tag':\n            case 'space':\n            case 'comment':\n            case 'newline':\n                doc.start.push(this.sourceToken);\n                return;\n        }\n        const bv = this.startBlockValue(doc);\n        if (bv)\n            this.stack.push(bv);\n        else {\n            yield {\n                type: 'error',\n                offset: this.offset,\n                message: `Unexpected ${this.type} token in YAML document`,\n                source: this.source\n            };\n        }\n    }\n    *scalar(scalar) {\n        if (this.type === 'map-value-ind') {\n            const prev = getPrevProps(this.peek(2));\n            const start = getFirstKeyStartProps(prev);\n            let sep;\n            if (scalar.end) {\n                sep = scalar.end;\n                sep.push(this.sourceToken);\n                delete scalar.end;\n            }\n            else\n                sep = [this.sourceToken];\n            const map = {\n                type: 'block-map',\n                offset: scalar.offset,\n                indent: scalar.indent,\n                items: [{ start, key: scalar, sep }]\n            };\n            this.onKeyLine = true;\n            this.stack[this.stack.length - 1] = map;\n        }\n        else\n            yield* this.lineEnd(scalar);\n    }\n    *blockScalar(scalar) {\n        switch (this.type) {\n            case 'space':\n            case 'comment':\n            case 'newline':\n                scalar.props.push(this.sourceToken);\n                return;\n            case 'scalar':\n                scalar.source = this.source;\n                // block-scalar source includes trailing newline\n                this.atNewLine = true;\n                this.indent = 0;\n                if (this.onNewLine) {\n                    let nl = this.source.indexOf('\\n') + 1;\n                    while (nl !== 0) {\n                        this.onNewLine(this.offset + nl);\n                        nl = this.source.indexOf('\\n', nl) + 1;\n                    }\n                }\n                yield* this.pop();\n                break;\n            /* istanbul ignore next should not happen */\n            default:\n                yield* this.pop();\n                yield* this.step();\n        }\n    }\n    *blockMap(map) {\n        const it = map.items[map.items.length - 1];\n        // it.sep is true-ish if pair already has key or : separator\n        switch (this.type) {\n            case 'newline':\n                this.onKeyLine = false;\n                if (it.value) {\n                    const end = 'end' in it.value ? it.value.end : undefined;\n                    const last = Array.isArray(end) ? end[end.length - 1] : undefined;\n                    if (last?.type === 'comment')\n                        end?.push(this.sourceToken);\n                    else\n                        map.items.push({ start: [this.sourceToken] });\n                }\n                else if (it.sep) {\n                    it.sep.push(this.sourceToken);\n                }\n                else {\n                    it.start.push(this.sourceToken);\n                }\n                return;\n            case 'space':\n            case 'comment':\n                if (it.value) {\n                    map.items.push({ start: [this.sourceToken] });\n                }\n                else if (it.sep) {\n                    it.sep.push(this.sourceToken);\n                }\n                else {\n                    if (this.atIndentedComment(it.start, map.indent)) {\n                        const prev = map.items[map.items.length - 2];\n                        const end = prev?.value?.end;\n                        if (Array.isArray(end)) {\n                            Array.prototype.push.apply(end, it.start);\n                            end.push(this.sourceToken);\n                            map.items.pop();\n                            return;\n                        }\n                    }\n                    it.start.push(this.sourceToken);\n                }\n                return;\n        }\n        if (this.indent >= map.indent) {\n            const atMapIndent = !this.onKeyLine && this.indent === map.indent;\n            const atNextItem = atMapIndent &&\n                (it.sep || it.explicitKey) &&\n                this.type !== 'seq-item-ind';\n            // For empty nodes, assign newline-separated not indented empty tokens to following node\n            let start = [];\n            if (atNextItem && it.sep && !it.value) {\n                const nl = [];\n                for (let i = 0; i < it.sep.length; ++i) {\n                    const st = it.sep[i];\n                    switch (st.type) {\n                        case 'newline':\n                            nl.push(i);\n                            break;\n                        case 'space':\n                            break;\n                        case 'comment':\n                            if (st.indent > map.indent)\n                                nl.length = 0;\n                            break;\n                        default:\n                            nl.length = 0;\n                    }\n                }\n                if (nl.length >= 2)\n                    start = it.sep.splice(nl[1]);\n            }\n            switch (this.type) {\n                case 'anchor':\n                case 'tag':\n                    if (atNextItem || it.value) {\n                        start.push(this.sourceToken);\n                        map.items.push({ start });\n                        this.onKeyLine = true;\n                    }\n                    else if (it.sep) {\n                        it.sep.push(this.sourceToken);\n                    }\n                    else {\n                        it.start.push(this.sourceToken);\n                    }\n                    return;\n                case 'explicit-key-ind':\n                    if (!it.sep && !it.explicitKey) {\n                        it.start.push(this.sourceToken);\n                        it.explicitKey = true;\n                    }\n                    else if (atNextItem || it.value) {\n                        start.push(this.sourceToken);\n                        map.items.push({ start, explicitKey: true });\n                    }\n                    else {\n                        this.stack.push({\n                            type: 'block-map',\n                            offset: this.offset,\n                            indent: this.indent,\n                            items: [{ start: [this.sourceToken], explicitKey: true }]\n                        });\n                    }\n                    this.onKeyLine = true;\n                    return;\n                case 'map-value-ind':\n                    if (it.explicitKey) {\n                        if (!it.sep) {\n                            if (includesToken(it.start, 'newline')) {\n                                Object.assign(it, { key: null, sep: [this.sourceToken] });\n                            }\n                            else {\n                                const start = getFirstKeyStartProps(it.start);\n                                this.stack.push({\n                                    type: 'block-map',\n                                    offset: this.offset,\n                                    indent: this.indent,\n                                    items: [{ start, key: null, sep: [this.sourceToken] }]\n                                });\n                            }\n                        }\n                        else if (it.value) {\n                            map.items.push({ start: [], key: null, sep: [this.sourceToken] });\n                        }\n                        else if (includesToken(it.sep, 'map-value-ind')) {\n                            this.stack.push({\n                                type: 'block-map',\n                                offset: this.offset,\n                                indent: this.indent,\n                                items: [{ start, key: null, sep: [this.sourceToken] }]\n                            });\n                        }\n                        else if (isFlowToken(it.key) &&\n                            !includesToken(it.sep, 'newline')) {\n                            const start = getFirstKeyStartProps(it.start);\n                            const key = it.key;\n                            const sep = it.sep;\n                            sep.push(this.sourceToken);\n                            // @ts-expect-error type guard is wrong here\n                            delete it.key;\n                            // @ts-expect-error type guard is wrong here\n                            delete it.sep;\n                            this.stack.push({\n                                type: 'block-map',\n                                offset: this.offset,\n                                indent: this.indent,\n                                items: [{ start, key, sep }]\n                            });\n                        }\n                        else if (start.length > 0) {\n                            // Not actually at next item\n                            it.sep = it.sep.concat(start, this.sourceToken);\n                        }\n                        else {\n                            it.sep.push(this.sourceToken);\n                        }\n                    }\n                    else {\n                        if (!it.sep) {\n                            Object.assign(it, { key: null, sep: [this.sourceToken] });\n                        }\n                        else if (it.value || atNextItem) {\n                            map.items.push({ start, key: null, sep: [this.sourceToken] });\n                        }\n                        else if (includesToken(it.sep, 'map-value-ind')) {\n                            this.stack.push({\n                                type: 'block-map',\n                                offset: this.offset,\n                                indent: this.indent,\n                                items: [{ start: [], key: null, sep: [this.sourceToken] }]\n                            });\n                        }\n                        else {\n                            it.sep.push(this.sourceToken);\n                        }\n                    }\n                    this.onKeyLine = true;\n                    return;\n                case 'alias':\n                case 'scalar':\n                case 'single-quoted-scalar':\n                case 'double-quoted-scalar': {\n                    const fs = this.flowScalar(this.type);\n                    if (atNextItem || it.value) {\n                        map.items.push({ start, key: fs, sep: [] });\n                        this.onKeyLine = true;\n                    }\n                    else if (it.sep) {\n                        this.stack.push(fs);\n                    }\n                    else {\n                        Object.assign(it, { key: fs, sep: [] });\n                        this.onKeyLine = true;\n                    }\n                    return;\n                }\n                default: {\n                    const bv = this.startBlockValue(map);\n                    if (bv) {\n                        if (bv.type === 'block-seq') {\n                            if (!it.explicitKey &&\n                                it.sep &&\n                                !includesToken(it.sep, 'newline')) {\n                                yield* this.pop({\n                                    type: 'error',\n                                    offset: this.offset,\n                                    message: 'Unexpected block-seq-ind on same line with key',\n                                    source: this.source\n                                });\n                                return;\n                            }\n                        }\n                        else if (atMapIndent) {\n                            map.items.push({ start });\n                        }\n                        this.stack.push(bv);\n                        return;\n                    }\n                }\n            }\n        }\n        yield* this.pop();\n        yield* this.step();\n    }\n    *blockSequence(seq) {\n        const it = seq.items[seq.items.length - 1];\n        switch (this.type) {\n            case 'newline':\n                if (it.value) {\n                    const end = 'end' in it.value ? it.value.end : undefined;\n                    const last = Array.isArray(end) ? end[end.length - 1] : undefined;\n                    if (last?.type === 'comment')\n                        end?.push(this.sourceToken);\n                    else\n                        seq.items.push({ start: [this.sourceToken] });\n                }\n                else\n                    it.start.push(this.sourceToken);\n                return;\n            case 'space':\n            case 'comment':\n                if (it.value)\n                    seq.items.push({ start: [this.sourceToken] });\n                else {\n                    if (this.atIndentedComment(it.start, seq.indent)) {\n                        const prev = seq.items[seq.items.length - 2];\n                        const end = prev?.value?.end;\n                        if (Array.isArray(end)) {\n                            Array.prototype.push.apply(end, it.start);\n                            end.push(this.sourceToken);\n                            seq.items.pop();\n                            return;\n                        }\n                    }\n                    it.start.push(this.sourceToken);\n                }\n                return;\n            case 'anchor':\n            case 'tag':\n                if (it.value || this.indent <= seq.indent)\n                    break;\n                it.start.push(this.sourceToken);\n                return;\n            case 'seq-item-ind':\n                if (this.indent !== seq.indent)\n                    break;\n                if (it.value || includesToken(it.start, 'seq-item-ind'))\n                    seq.items.push({ start: [this.sourceToken] });\n                else\n                    it.start.push(this.sourceToken);\n                return;\n        }\n        if (this.indent > seq.indent) {\n            const bv = this.startBlockValue(seq);\n            if (bv) {\n                this.stack.push(bv);\n                return;\n            }\n        }\n        yield* this.pop();\n        yield* this.step();\n    }\n    *flowCollection(fc) {\n        const it = fc.items[fc.items.length - 1];\n        if (this.type === 'flow-error-end') {\n            let top;\n            do {\n                yield* this.pop();\n                top = this.peek(1);\n            } while (top && top.type === 'flow-collection');\n        }\n        else if (fc.end.length === 0) {\n            switch (this.type) {\n                case 'comma':\n                case 'explicit-key-ind':\n                    if (!it || it.sep)\n                        fc.items.push({ start: [this.sourceToken] });\n                    else\n                        it.start.push(this.sourceToken);\n                    return;\n                case 'map-value-ind':\n                    if (!it || it.value)\n                        fc.items.push({ start: [], key: null, sep: [this.sourceToken] });\n                    else if (it.sep)\n                        it.sep.push(this.sourceToken);\n                    else\n                        Object.assign(it, { key: null, sep: [this.sourceToken] });\n                    return;\n                case 'space':\n                case 'comment':\n                case 'newline':\n                case 'anchor':\n                case 'tag':\n                    if (!it || it.value)\n                        fc.items.push({ start: [this.sourceToken] });\n                    else if (it.sep)\n                        it.sep.push(this.sourceToken);\n                    else\n                        it.start.push(this.sourceToken);\n                    return;\n                case 'alias':\n                case 'scalar':\n                case 'single-quoted-scalar':\n                case 'double-quoted-scalar': {\n                    const fs = this.flowScalar(this.type);\n                    if (!it || it.value)\n                        fc.items.push({ start: [], key: fs, sep: [] });\n                    else if (it.sep)\n                        this.stack.push(fs);\n                    else\n                        Object.assign(it, { key: fs, sep: [] });\n                    return;\n                }\n                case 'flow-map-end':\n                case 'flow-seq-end':\n                    fc.end.push(this.sourceToken);\n                    return;\n            }\n            const bv = this.startBlockValue(fc);\n            /* istanbul ignore else should not happen */\n            if (bv)\n                this.stack.push(bv);\n            else {\n                yield* this.pop();\n                yield* this.step();\n            }\n        }\n        else {\n            const parent = this.peek(2);\n            if (parent.type === 'block-map' &&\n                ((this.type === 'map-value-ind' && parent.indent === fc.indent) ||\n                    (this.type === 'newline' &&\n                        !parent.items[parent.items.length - 1].sep))) {\n                yield* this.pop();\n                yield* this.step();\n            }\n            else if (this.type === 'map-value-ind' &&\n                parent.type !== 'flow-collection') {\n                const prev = getPrevProps(parent);\n                const start = getFirstKeyStartProps(prev);\n                fixFlowSeqItems(fc);\n                const sep = fc.end.splice(1, fc.end.length);\n                sep.push(this.sourceToken);\n                const map = {\n                    type: 'block-map',\n                    offset: fc.offset,\n                    indent: fc.indent,\n                    items: [{ start, key: fc, sep }]\n                };\n                this.onKeyLine = true;\n                this.stack[this.stack.length - 1] = map;\n            }\n            else {\n                yield* this.lineEnd(fc);\n            }\n        }\n    }\n    flowScalar(type) {\n        if (this.onNewLine) {\n            let nl = this.source.indexOf('\\n') + 1;\n            while (nl !== 0) {\n                this.onNewLine(this.offset + nl);\n                nl = this.source.indexOf('\\n', nl) + 1;\n            }\n        }\n        return {\n            type,\n            offset: this.offset,\n            indent: this.indent,\n            source: this.source\n        };\n    }\n    startBlockValue(parent) {\n        switch (this.type) {\n            case 'alias':\n            case 'scalar':\n            case 'single-quoted-scalar':\n            case 'double-quoted-scalar':\n                return this.flowScalar(this.type);\n            case 'block-scalar-header':\n                return {\n                    type: 'block-scalar',\n                    offset: this.offset,\n                    indent: this.indent,\n                    props: [this.sourceToken],\n                    source: ''\n                };\n            case 'flow-map-start':\n            case 'flow-seq-start':\n                return {\n                    type: 'flow-collection',\n                    offset: this.offset,\n                    indent: this.indent,\n                    start: this.sourceToken,\n                    items: [],\n                    end: []\n                };\n            case 'seq-item-ind':\n                return {\n                    type: 'block-seq',\n                    offset: this.offset,\n                    indent: this.indent,\n                    items: [{ start: [this.sourceToken] }]\n                };\n            case 'explicit-key-ind': {\n                this.onKeyLine = true;\n                const prev = getPrevProps(parent);\n                const start = getFirstKeyStartProps(prev);\n                start.push(this.sourceToken);\n                return {\n                    type: 'block-map',\n                    offset: this.offset,\n                    indent: this.indent,\n                    items: [{ start, explicitKey: true }]\n                };\n            }\n            case 'map-value-ind': {\n                this.onKeyLine = true;\n                const prev = getPrevProps(parent);\n                const start = getFirstKeyStartProps(prev);\n                return {\n                    type: 'block-map',\n                    offset: this.offset,\n                    indent: this.indent,\n                    items: [{ start, key: null, sep: [this.sourceToken] }]\n                };\n            }\n        }\n        return null;\n    }\n    atIndentedComment(start, indent) {\n        if (this.type !== 'comment')\n            return false;\n        if (this.indent <= indent)\n            return false;\n        return start.every(st => st.type === 'newline' || st.type === 'space');\n    }\n    *documentEnd(docEnd) {\n        if (this.type !== 'doc-mode') {\n            if (docEnd.end)\n                docEnd.end.push(this.sourceToken);\n            else\n                docEnd.end = [this.sourceToken];\n            if (this.type === 'newline')\n                yield* this.pop();\n        }\n    }\n    *lineEnd(token) {\n        switch (this.type) {\n            case 'comma':\n            case 'doc-start':\n            case 'doc-end':\n            case 'flow-seq-end':\n            case 'flow-map-end':\n            case 'map-value-ind':\n                yield* this.pop();\n                yield* this.step();\n                break;\n            case 'newline':\n                this.onKeyLine = false;\n            // fallthrough\n            case 'space':\n            case 'comment':\n            default:\n                // all other values are errors\n                if (token.end)\n                    token.end.push(this.sourceToken);\n                else\n                    token.end = [this.sourceToken];\n                if (this.type === 'newline')\n                    yield* this.pop();\n        }\n    }\n}\n\nexport { Parser };\n","import { Composer } from './compose/composer.js';\nimport { Document } from './doc/Document.js';\nimport { prettifyError, YAMLParseError } from './errors.js';\nimport { warn } from './log.js';\nimport { isDocument } from './nodes/identity.js';\nimport { LineCounter } from './parse/line-counter.js';\nimport { Parser } from './parse/parser.js';\n\nfunction parseOptions(options) {\n    const prettyErrors = options.prettyErrors !== false;\n    const lineCounter = options.lineCounter || (prettyErrors && new LineCounter()) || null;\n    return { lineCounter, prettyErrors };\n}\n/**\n * Parse the input as a stream of YAML documents.\n *\n * Documents should be separated from each other by `...` or `---` marker lines.\n *\n * @returns If an empty `docs` array is returned, it will be of type\n *   EmptyStream and contain additional stream information. In\n *   TypeScript, you should use `'empty' in docs` as a type guard for it.\n */\nfunction parseAllDocuments(source, options = {}) {\n    const { lineCounter, prettyErrors } = parseOptions(options);\n    const parser = new Parser(lineCounter?.addNewLine);\n    const composer = new Composer(options);\n    const docs = Array.from(composer.compose(parser.parse(source)));\n    if (prettyErrors && lineCounter)\n        for (const doc of docs) {\n            doc.errors.forEach(prettifyError(source, lineCounter));\n            doc.warnings.forEach(prettifyError(source, lineCounter));\n        }\n    if (docs.length > 0)\n        return docs;\n    return Object.assign([], { empty: true }, composer.streamInfo());\n}\n/** Parse an input string into a single YAML.Document */\nfunction parseDocument(source, options = {}) {\n    const { lineCounter, prettyErrors } = parseOptions(options);\n    const parser = new Parser(lineCounter?.addNewLine);\n    const composer = new Composer(options);\n    // `doc` is always set by compose.end(true) at the very latest\n    let doc = null;\n    for (const _doc of composer.compose(parser.parse(source), true, source.length)) {\n        if (!doc)\n            doc = _doc;\n        else if (doc.options.logLevel !== 'silent') {\n            doc.errors.push(new YAMLParseError(_doc.range.slice(0, 2), 'MULTIPLE_DOCS', 'Source contains multiple documents; please use YAML.parseAllDocuments()'));\n            break;\n        }\n    }\n    if (prettyErrors && lineCounter) {\n        doc.errors.forEach(prettifyError(source, lineCounter));\n        doc.warnings.forEach(prettifyError(source, lineCounter));\n    }\n    return doc;\n}\nfunction parse(src, reviver, options) {\n    let _reviver = undefined;\n    if (typeof reviver === 'function') {\n        _reviver = reviver;\n    }\n    else if (options === undefined && reviver && typeof reviver === 'object') {\n        options = reviver;\n    }\n    const doc = parseDocument(src, options);\n    if (!doc)\n        return null;\n    doc.warnings.forEach(warning => warn(doc.options.logLevel, warning));\n    if (doc.errors.length > 0) {\n        if (doc.options.logLevel !== 'silent')\n            throw doc.errors[0];\n        else\n            doc.errors = [];\n    }\n    return doc.toJS(Object.assign({ reviver: _reviver }, options));\n}\nfunction stringify(value, replacer, options) {\n    let _replacer = null;\n    if (typeof replacer === 'function' || Array.isArray(replacer)) {\n        _replacer = replacer;\n    }\n    else if (options === undefined && replacer) {\n        options = replacer;\n    }\n    if (typeof options === 'string')\n        options = options.length;\n    if (typeof options === 'number') {\n        const indent = Math.round(options);\n        options = indent < 1 ? undefined : indent > 8 ? { indent: 8 } : { indent };\n    }\n    if (value === undefined) {\n        const { keepUndefined } = options ?? replacer ?? {};\n        if (!keepUndefined)\n            return undefined;\n    }\n    if (isDocument(value) && !_replacer)\n        return value.toString(options);\n    return new Document(value, _replacer, options).toString(options);\n}\n\nexport { parse, parseAllDocuments, parseDocument, stringify };\n","export var util;\n(function (util) {\n    util.assertEqual = (_) => { };\n    function assertIs(_arg) { }\n    util.assertIs = assertIs;\n    function assertNever(_x) {\n        throw new Error();\n    }\n    util.assertNever = assertNever;\n    util.arrayToEnum = (items) => {\n        const obj = {};\n        for (const item of items) {\n            obj[item] = item;\n        }\n        return obj;\n    };\n    util.getValidEnumValues = (obj) => {\n        const validKeys = util.objectKeys(obj).filter((k) => typeof obj[obj[k]] !== \"number\");\n        const filtered = {};\n        for (const k of validKeys) {\n            filtered[k] = obj[k];\n        }\n        return util.objectValues(filtered);\n    };\n    util.objectValues = (obj) => {\n        return util.objectKeys(obj).map(function (e) {\n            return obj[e];\n        });\n    };\n    util.objectKeys = typeof Object.keys === \"function\" // eslint-disable-line ban/ban\n        ? (obj) => Object.keys(obj) // eslint-disable-line ban/ban\n        : (object) => {\n            const keys = [];\n            for (const key in object) {\n                if (Object.prototype.hasOwnProperty.call(object, key)) {\n                    keys.push(key);\n                }\n            }\n            return keys;\n        };\n    util.find = (arr, checker) => {\n        for (const item of arr) {\n            if (checker(item))\n                return item;\n        }\n        return undefined;\n    };\n    util.isInteger = typeof Number.isInteger === \"function\"\n        ? (val) => Number.isInteger(val) // eslint-disable-line ban/ban\n        : (val) => typeof val === \"number\" && Number.isFinite(val) && Math.floor(val) === val;\n    function joinValues(array, separator = \" | \") {\n        return array.map((val) => (typeof val === \"string\" ? `'${val}'` : val)).join(separator);\n    }\n    util.joinValues = joinValues;\n    util.jsonStringifyReplacer = (_, value) => {\n        if (typeof value === \"bigint\") {\n            return value.toString();\n        }\n        return value;\n    };\n})(util || (util = {}));\nexport var objectUtil;\n(function (objectUtil) {\n    objectUtil.mergeShapes = (first, second) => {\n        return {\n            ...first,\n            ...second, // second overwrites first\n        };\n    };\n})(objectUtil || (objectUtil = {}));\nexport const ZodParsedType = util.arrayToEnum([\n    \"string\",\n    \"nan\",\n    \"number\",\n    \"integer\",\n    \"float\",\n    \"boolean\",\n    \"date\",\n    \"bigint\",\n    \"symbol\",\n    \"function\",\n    \"undefined\",\n    \"null\",\n    \"array\",\n    \"object\",\n    \"unknown\",\n    \"promise\",\n    \"void\",\n    \"never\",\n    \"map\",\n    \"set\",\n]);\nexport const getParsedType = (data) => {\n    const t = typeof data;\n    switch (t) {\n        case \"undefined\":\n            return ZodParsedType.undefined;\n        case \"string\":\n            return ZodParsedType.string;\n        case \"number\":\n            return Number.isNaN(data) ? ZodParsedType.nan : ZodParsedType.number;\n        case \"boolean\":\n            return ZodParsedType.boolean;\n        case \"function\":\n            return ZodParsedType.function;\n        case \"bigint\":\n            return ZodParsedType.bigint;\n        case \"symbol\":\n            return ZodParsedType.symbol;\n        case \"object\":\n            if (Array.isArray(data)) {\n                return ZodParsedType.array;\n            }\n            if (data === null) {\n                return ZodParsedType.null;\n            }\n            if (data.then && typeof data.then === \"function\" && data.catch && typeof data.catch === \"function\") {\n                return ZodParsedType.promise;\n            }\n            if (typeof Map !== \"undefined\" && data instanceof Map) {\n                return ZodParsedType.map;\n            }\n            if (typeof Set !== \"undefined\" && data instanceof Set) {\n                return ZodParsedType.set;\n            }\n            if (typeof Date !== \"undefined\" && data instanceof Date) {\n                return ZodParsedType.date;\n            }\n            return ZodParsedType.object;\n        default:\n            return ZodParsedType.unknown;\n    }\n};\n","import { util } from \"./helpers/util.js\";\nexport const ZodIssueCode = util.arrayToEnum([\n    \"invalid_type\",\n    \"invalid_literal\",\n    \"custom\",\n    \"invalid_union\",\n    \"invalid_union_discriminator\",\n    \"invalid_enum_value\",\n    \"unrecognized_keys\",\n    \"invalid_arguments\",\n    \"invalid_return_type\",\n    \"invalid_date\",\n    \"invalid_string\",\n    \"too_small\",\n    \"too_big\",\n    \"invalid_intersection_types\",\n    \"not_multiple_of\",\n    \"not_finite\",\n]);\nexport const quotelessJson = (obj) => {\n    const json = JSON.stringify(obj, null, 2);\n    return json.replace(/\"([^\"]+)\":/g, \"$1:\");\n};\nexport class ZodError extends Error {\n    get errors() {\n        return this.issues;\n    }\n    constructor(issues) {\n        super();\n        this.issues = [];\n        this.addIssue = (sub) => {\n            this.issues = [...this.issues, sub];\n        };\n        this.addIssues = (subs = []) => {\n            this.issues = [...this.issues, ...subs];\n        };\n        const actualProto = new.target.prototype;\n        if (Object.setPrototypeOf) {\n            // eslint-disable-next-line ban/ban\n            Object.setPrototypeOf(this, actualProto);\n        }\n        else {\n            this.__proto__ = actualProto;\n        }\n        this.name = \"ZodError\";\n        this.issues = issues;\n    }\n    format(_mapper) {\n        const mapper = _mapper ||\n            function (issue) {\n                return issue.message;\n            };\n        const fieldErrors = { _errors: [] };\n        const processError = (error) => {\n            for (const issue of error.issues) {\n                if (issue.code === \"invalid_union\") {\n                    issue.unionErrors.map(processError);\n                }\n                else if (issue.code === \"invalid_return_type\") {\n                    processError(issue.returnTypeError);\n                }\n                else if (issue.code === \"invalid_arguments\") {\n                    processError(issue.argumentsError);\n                }\n                else if (issue.path.length === 0) {\n                    fieldErrors._errors.push(mapper(issue));\n                }\n                else {\n                    let curr = fieldErrors;\n                    let i = 0;\n                    while (i < issue.path.length) {\n                        const el = issue.path[i];\n                        const terminal = i === issue.path.length - 1;\n                        if (!terminal) {\n                            curr[el] = curr[el] || { _errors: [] };\n                            // if (typeof el === \"string\") {\n                            //   curr[el] = curr[el] || { _errors: [] };\n                            // } else if (typeof el === \"number\") {\n                            //   const errorArray: any = [];\n                            //   errorArray._errors = [];\n                            //   curr[el] = curr[el] || errorArray;\n                            // }\n                        }\n                        else {\n                            curr[el] = curr[el] || { _errors: [] };\n                            curr[el]._errors.push(mapper(issue));\n                        }\n                        curr = curr[el];\n                        i++;\n                    }\n                }\n            }\n        };\n        processError(this);\n        return fieldErrors;\n    }\n    static assert(value) {\n        if (!(value instanceof ZodError)) {\n            throw new Error(`Not a ZodError: ${value}`);\n        }\n    }\n    toString() {\n        return this.message;\n    }\n    get message() {\n        return JSON.stringify(this.issues, util.jsonStringifyReplacer, 2);\n    }\n    get isEmpty() {\n        return this.issues.length === 0;\n    }\n    flatten(mapper = (issue) => issue.message) {\n        const fieldErrors = {};\n        const formErrors = [];\n        for (const sub of this.issues) {\n            if (sub.path.length > 0) {\n                const firstEl = sub.path[0];\n                fieldErrors[firstEl] = fieldErrors[firstEl] || [];\n                fieldErrors[firstEl].push(mapper(sub));\n            }\n            else {\n                formErrors.push(mapper(sub));\n            }\n        }\n        return { formErrors, fieldErrors };\n    }\n    get formErrors() {\n        return this.flatten();\n    }\n}\nZodError.create = (issues) => {\n    const error = new ZodError(issues);\n    return error;\n};\n","import { ZodIssueCode } from \"../ZodError.js\";\nimport { util, ZodParsedType } from \"../helpers/util.js\";\nconst errorMap = (issue, _ctx) => {\n    let message;\n    switch (issue.code) {\n        case ZodIssueCode.invalid_type:\n            if (issue.received === ZodParsedType.undefined) {\n                message = \"Required\";\n            }\n            else {\n                message = `Expected ${issue.expected}, received ${issue.received}`;\n            }\n            break;\n        case ZodIssueCode.invalid_literal:\n            message = `Invalid literal value, expected ${JSON.stringify(issue.expected, util.jsonStringifyReplacer)}`;\n            break;\n        case ZodIssueCode.unrecognized_keys:\n            message = `Unrecognized key(s) in object: ${util.joinValues(issue.keys, \", \")}`;\n            break;\n        case ZodIssueCode.invalid_union:\n            message = `Invalid input`;\n            break;\n        case ZodIssueCode.invalid_union_discriminator:\n            message = `Invalid discriminator value. Expected ${util.joinValues(issue.options)}`;\n            break;\n        case ZodIssueCode.invalid_enum_value:\n            message = `Invalid enum value. Expected ${util.joinValues(issue.options)}, received '${issue.received}'`;\n            break;\n        case ZodIssueCode.invalid_arguments:\n            message = `Invalid function arguments`;\n            break;\n        case ZodIssueCode.invalid_return_type:\n            message = `Invalid function return type`;\n            break;\n        case ZodIssueCode.invalid_date:\n            message = `Invalid date`;\n            break;\n        case ZodIssueCode.invalid_string:\n            if (typeof issue.validation === \"object\") {\n                if (\"includes\" in issue.validation) {\n                    message = `Invalid input: must include \"${issue.validation.includes}\"`;\n                    if (typeof issue.validation.position === \"number\") {\n                        message = `${message} at one or more positions greater than or equal to ${issue.validation.position}`;\n                    }\n                }\n                else if (\"startsWith\" in issue.validation) {\n                    message = `Invalid input: must start with \"${issue.validation.startsWith}\"`;\n                }\n                else if (\"endsWith\" in issue.validation) {\n                    message = `Invalid input: must end with \"${issue.validation.endsWith}\"`;\n                }\n                else {\n                    util.assertNever(issue.validation);\n                }\n            }\n            else if (issue.validation !== \"regex\") {\n                message = `Invalid ${issue.validation}`;\n            }\n            else {\n                message = \"Invalid\";\n            }\n            break;\n        case ZodIssueCode.too_small:\n            if (issue.type === \"array\")\n                message = `Array must contain ${issue.exact ? \"exactly\" : issue.inclusive ? `at least` : `more than`} ${issue.minimum} element(s)`;\n            else if (issue.type === \"string\")\n                message = `String must contain ${issue.exact ? \"exactly\" : issue.inclusive ? `at least` : `over`} ${issue.minimum} character(s)`;\n            else if (issue.type === \"number\")\n                message = `Number must be ${issue.exact ? `exactly equal to ` : issue.inclusive ? `greater than or equal to ` : `greater than `}${issue.minimum}`;\n            else if (issue.type === \"bigint\")\n                message = `Number must be ${issue.exact ? `exactly equal to ` : issue.inclusive ? `greater than or equal to ` : `greater than `}${issue.minimum}`;\n            else if (issue.type === \"date\")\n                message = `Date must be ${issue.exact ? `exactly equal to ` : issue.inclusive ? `greater than or equal to ` : `greater than `}${new Date(Number(issue.minimum))}`;\n            else\n                message = \"Invalid input\";\n            break;\n        case ZodIssueCode.too_big:\n            if (issue.type === \"array\")\n                message = `Array must contain ${issue.exact ? `exactly` : issue.inclusive ? `at most` : `less than`} ${issue.maximum} element(s)`;\n            else if (issue.type === \"string\")\n                message = `String must contain ${issue.exact ? `exactly` : issue.inclusive ? `at most` : `under`} ${issue.maximum} character(s)`;\n            else if (issue.type === \"number\")\n                message = `Number must be ${issue.exact ? `exactly` : issue.inclusive ? `less than or equal to` : `less than`} ${issue.maximum}`;\n            else if (issue.type === \"bigint\")\n                message = `BigInt must be ${issue.exact ? `exactly` : issue.inclusive ? `less than or equal to` : `less than`} ${issue.maximum}`;\n            else if (issue.type === \"date\")\n                message = `Date must be ${issue.exact ? `exactly` : issue.inclusive ? `smaller than or equal to` : `smaller than`} ${new Date(Number(issue.maximum))}`;\n            else\n                message = \"Invalid input\";\n            break;\n        case ZodIssueCode.custom:\n            message = `Invalid input`;\n            break;\n        case ZodIssueCode.invalid_intersection_types:\n            message = `Intersection results could not be merged`;\n            break;\n        case ZodIssueCode.not_multiple_of:\n            message = `Number must be a multiple of ${issue.multipleOf}`;\n            break;\n        case ZodIssueCode.not_finite:\n            message = \"Number must be finite\";\n            break;\n        default:\n            message = _ctx.defaultError;\n            util.assertNever(issue);\n    }\n    return { message };\n};\nexport default errorMap;\n","import defaultErrorMap from \"./locales/en.js\";\nlet overrideErrorMap = defaultErrorMap;\nexport { defaultErrorMap };\nexport function setErrorMap(map) {\n    overrideErrorMap = map;\n}\nexport function getErrorMap() {\n    return overrideErrorMap;\n}\n","import { getErrorMap } from \"../errors.js\";\nimport defaultErrorMap from \"../locales/en.js\";\nexport const makeIssue = (params) => {\n    const { data, path, errorMaps, issueData } = params;\n    const fullPath = [...path, ...(issueData.path || [])];\n    const fullIssue = {\n        ...issueData,\n        path: fullPath,\n    };\n    if (issueData.message !== undefined) {\n        return {\n            ...issueData,\n            path: fullPath,\n            message: issueData.message,\n        };\n    }\n    let errorMessage = \"\";\n    const maps = errorMaps\n        .filter((m) => !!m)\n        .slice()\n        .reverse();\n    for (const map of maps) {\n        errorMessage = map(fullIssue, { data, defaultError: errorMessage }).message;\n    }\n    return {\n        ...issueData,\n        path: fullPath,\n        message: errorMessage,\n    };\n};\nexport const EMPTY_PATH = [];\nexport function addIssueToContext(ctx, issueData) {\n    const overrideMap = getErrorMap();\n    const issue = makeIssue({\n        issueData: issueData,\n        data: ctx.data,\n        path: ctx.path,\n        errorMaps: [\n            ctx.common.contextualErrorMap, // contextual error map is first priority\n            ctx.schemaErrorMap, // then schema-bound map if available\n            overrideMap, // then global override map\n            overrideMap === defaultErrorMap ? undefined : defaultErrorMap, // then global default map\n        ].filter((x) => !!x),\n    });\n    ctx.common.issues.push(issue);\n}\nexport class ParseStatus {\n    constructor() {\n        this.value = \"valid\";\n    }\n    dirty() {\n        if (this.value === \"valid\")\n            this.value = \"dirty\";\n    }\n    abort() {\n        if (this.value !== \"aborted\")\n            this.value = \"aborted\";\n    }\n    static mergeArray(status, results) {\n        const arrayValue = [];\n        for (const s of results) {\n            if (s.status === \"aborted\")\n                return INVALID;\n            if (s.status === \"dirty\")\n                status.dirty();\n            arrayValue.push(s.value);\n        }\n        return { status: status.value, value: arrayValue };\n    }\n    static async mergeObjectAsync(status, pairs) {\n        const syncPairs = [];\n        for (const pair of pairs) {\n            const key = await pair.key;\n            const value = await pair.value;\n            syncPairs.push({\n                key,\n                value,\n            });\n        }\n        return ParseStatus.mergeObjectSync(status, syncPairs);\n    }\n    static mergeObjectSync(status, pairs) {\n        const finalObject = {};\n        for (const pair of pairs) {\n            const { key, value } = pair;\n            if (key.status === \"aborted\")\n                return INVALID;\n            if (value.status === \"aborted\")\n                return INVALID;\n            if (key.status === \"dirty\")\n                status.dirty();\n            if (value.status === \"dirty\")\n                status.dirty();\n            if (key.value !== \"__proto__\" && (typeof value.value !== \"undefined\" || pair.alwaysSet)) {\n                finalObject[key.value] = value.value;\n            }\n        }\n        return { status: status.value, value: finalObject };\n    }\n}\nexport const INVALID = Object.freeze({\n    status: \"aborted\",\n});\nexport const DIRTY = (value) => ({ status: \"dirty\", value });\nexport const OK = (value) => ({ status: \"valid\", value });\nexport const isAborted = (x) => x.status === \"aborted\";\nexport const isDirty = (x) => x.status === \"dirty\";\nexport const isValid = (x) => x.status === \"valid\";\nexport const isAsync = (x) => typeof Promise !== \"undefined\" && x instanceof Promise;\n","export var errorUtil;\n(function (errorUtil) {\n    errorUtil.errToObj = (message) => typeof message === \"string\" ? { message } : message || {};\n    // biome-ignore lint:\n    errorUtil.toString = (message) => typeof message === \"string\" ? message : message?.message;\n})(errorUtil || (errorUtil = {}));\n","import { ZodError, ZodIssueCode, } from \"./ZodError.js\";\nimport { defaultErrorMap, getErrorMap } from \"./errors.js\";\nimport { errorUtil } from \"./helpers/errorUtil.js\";\nimport { DIRTY, INVALID, OK, ParseStatus, addIssueToContext, isAborted, isAsync, isDirty, isValid, makeIssue, } from \"./helpers/parseUtil.js\";\nimport { util, ZodParsedType, getParsedType } from \"./helpers/util.js\";\nclass ParseInputLazyPath {\n    constructor(parent, value, path, key) {\n        this._cachedPath = [];\n        this.parent = parent;\n        this.data = value;\n        this._path = path;\n        this._key = key;\n    }\n    get path() {\n        if (!this._cachedPath.length) {\n            if (Array.isArray(this._key)) {\n                this._cachedPath.push(...this._path, ...this._key);\n            }\n            else {\n                this._cachedPath.push(...this._path, this._key);\n            }\n        }\n        return this._cachedPath;\n    }\n}\nconst handleResult = (ctx, result) => {\n    if (isValid(result)) {\n        return { success: true, data: result.value };\n    }\n    else {\n        if (!ctx.common.issues.length) {\n            throw new Error(\"Validation failed but no issues detected.\");\n        }\n        return {\n            success: false,\n            get error() {\n                if (this._error)\n                    return this._error;\n                const error = new ZodError(ctx.common.issues);\n                this._error = error;\n                return this._error;\n            },\n        };\n    }\n};\nfunction processCreateParams(params) {\n    if (!params)\n        return {};\n    const { errorMap, invalid_type_error, required_error, description } = params;\n    if (errorMap && (invalid_type_error || required_error)) {\n        throw new Error(`Can't use \"invalid_type_error\" or \"required_error\" in conjunction with custom error map.`);\n    }\n    if (errorMap)\n        return { errorMap: errorMap, description };\n    const customMap = (iss, ctx) => {\n        const { message } = params;\n        if (iss.code === \"invalid_enum_value\") {\n            return { message: message ?? ctx.defaultError };\n        }\n        if (typeof ctx.data === \"undefined\") {\n            return { message: message ?? required_error ?? ctx.defaultError };\n        }\n        if (iss.code !== \"invalid_type\")\n            return { message: ctx.defaultError };\n        return { message: message ?? invalid_type_error ?? ctx.defaultError };\n    };\n    return { errorMap: customMap, description };\n}\nexport class ZodType {\n    get description() {\n        return this._def.description;\n    }\n    _getType(input) {\n        return getParsedType(input.data);\n    }\n    _getOrReturnCtx(input, ctx) {\n        return (ctx || {\n            common: input.parent.common,\n            data: input.data,\n            parsedType: getParsedType(input.data),\n            schemaErrorMap: this._def.errorMap,\n            path: input.path,\n            parent: input.parent,\n        });\n    }\n    _processInputParams(input) {\n        return {\n            status: new ParseStatus(),\n            ctx: {\n                common: input.parent.common,\n                data: input.data,\n                parsedType: getParsedType(input.data),\n                schemaErrorMap: this._def.errorMap,\n                path: input.path,\n                parent: input.parent,\n            },\n        };\n    }\n    _parseSync(input) {\n        const result = this._parse(input);\n        if (isAsync(result)) {\n            throw new Error(\"Synchronous parse encountered promise.\");\n        }\n        return result;\n    }\n    _parseAsync(input) {\n        const result = this._parse(input);\n        return Promise.resolve(result);\n    }\n    parse(data, params) {\n        const result = this.safeParse(data, params);\n        if (result.success)\n            return result.data;\n        throw result.error;\n    }\n    safeParse(data, params) {\n        const ctx = {\n            common: {\n                issues: [],\n                async: params?.async ?? false,\n                contextualErrorMap: params?.errorMap,\n            },\n            path: params?.path || [],\n            schemaErrorMap: this._def.errorMap,\n            parent: null,\n            data,\n            parsedType: getParsedType(data),\n        };\n        const result = this._parseSync({ data, path: ctx.path, parent: ctx });\n        return handleResult(ctx, result);\n    }\n    \"~validate\"(data) {\n        const ctx = {\n            common: {\n                issues: [],\n                async: !!this[\"~standard\"].async,\n            },\n            path: [],\n            schemaErrorMap: this._def.errorMap,\n            parent: null,\n            data,\n            parsedType: getParsedType(data),\n        };\n        if (!this[\"~standard\"].async) {\n            try {\n                const result = this._parseSync({ data, path: [], parent: ctx });\n                return isValid(result)\n                    ? {\n                        value: result.value,\n                    }\n                    : {\n                        issues: ctx.common.issues,\n                    };\n            }\n            catch (err) {\n                if (err?.message?.toLowerCase()?.includes(\"encountered\")) {\n                    this[\"~standard\"].async = true;\n                }\n                ctx.common = {\n                    issues: [],\n                    async: true,\n                };\n            }\n        }\n        return this._parseAsync({ data, path: [], parent: ctx }).then((result) => isValid(result)\n            ? {\n                value: result.value,\n            }\n            : {\n                issues: ctx.common.issues,\n            });\n    }\n    async parseAsync(data, params) {\n        const result = await this.safeParseAsync(data, params);\n        if (result.success)\n            return result.data;\n        throw result.error;\n    }\n    async safeParseAsync(data, params) {\n        const ctx = {\n            common: {\n                issues: [],\n                contextualErrorMap: params?.errorMap,\n                async: true,\n            },\n            path: params?.path || [],\n            schemaErrorMap: this._def.errorMap,\n            parent: null,\n            data,\n            parsedType: getParsedType(data),\n        };\n        const maybeAsyncResult = this._parse({ data, path: ctx.path, parent: ctx });\n        const result = await (isAsync(maybeAsyncResult) ? maybeAsyncResult : Promise.resolve(maybeAsyncResult));\n        return handleResult(ctx, result);\n    }\n    refine(check, message) {\n        const getIssueProperties = (val) => {\n            if (typeof message === \"string\" || typeof message === \"undefined\") {\n                return { message };\n            }\n            else if (typeof message === \"function\") {\n                return message(val);\n            }\n            else {\n                return message;\n            }\n        };\n        return this._refinement((val, ctx) => {\n            const result = check(val);\n            const setError = () => ctx.addIssue({\n                code: ZodIssueCode.custom,\n                ...getIssueProperties(val),\n            });\n            if (typeof Promise !== \"undefined\" && result instanceof Promise) {\n                return result.then((data) => {\n                    if (!data) {\n                        setError();\n                        return false;\n                    }\n                    else {\n                        return true;\n                    }\n                });\n            }\n            if (!result) {\n                setError();\n                return false;\n            }\n            else {\n                return true;\n            }\n        });\n    }\n    refinement(check, refinementData) {\n        return this._refinement((val, ctx) => {\n            if (!check(val)) {\n                ctx.addIssue(typeof refinementData === \"function\" ? refinementData(val, ctx) : refinementData);\n                return false;\n            }\n            else {\n                return true;\n            }\n        });\n    }\n    _refinement(refinement) {\n        return new ZodEffects({\n            schema: this,\n            typeName: ZodFirstPartyTypeKind.ZodEffects,\n            effect: { type: \"refinement\", refinement },\n        });\n    }\n    superRefine(refinement) {\n        return this._refinement(refinement);\n    }\n    constructor(def) {\n        /** Alias of safeParseAsync */\n        this.spa = this.safeParseAsync;\n        this._def = def;\n        this.parse = this.parse.bind(this);\n        this.safeParse = this.safeParse.bind(this);\n        this.parseAsync = this.parseAsync.bind(this);\n        this.safeParseAsync = this.safeParseAsync.bind(this);\n        this.spa = this.spa.bind(this);\n        this.refine = this.refine.bind(this);\n        this.refinement = this.refinement.bind(this);\n        this.superRefine = this.superRefine.bind(this);\n        this.optional = this.optional.bind(this);\n        this.nullable = this.nullable.bind(this);\n        this.nullish = this.nullish.bind(this);\n        this.array = this.array.bind(this);\n        this.promise = this.promise.bind(this);\n        this.or = this.or.bind(this);\n        this.and = this.and.bind(this);\n        this.transform = this.transform.bind(this);\n        this.brand = this.brand.bind(this);\n        this.default = this.default.bind(this);\n        this.catch = this.catch.bind(this);\n        this.describe = this.describe.bind(this);\n        this.pipe = this.pipe.bind(this);\n        this.readonly = this.readonly.bind(this);\n        this.isNullable = this.isNullable.bind(this);\n        this.isOptional = this.isOptional.bind(this);\n        this[\"~standard\"] = {\n            version: 1,\n            vendor: \"zod\",\n            validate: (data) => this[\"~validate\"](data),\n        };\n    }\n    optional() {\n        return ZodOptional.create(this, this._def);\n    }\n    nullable() {\n        return ZodNullable.create(this, this._def);\n    }\n    nullish() {\n        return this.nullable().optional();\n    }\n    array() {\n        return ZodArray.create(this);\n    }\n    promise() {\n        return ZodPromise.create(this, this._def);\n    }\n    or(option) {\n        return ZodUnion.create([this, option], this._def);\n    }\n    and(incoming) {\n        return ZodIntersection.create(this, incoming, this._def);\n    }\n    transform(transform) {\n        return new ZodEffects({\n            ...processCreateParams(this._def),\n            schema: this,\n            typeName: ZodFirstPartyTypeKind.ZodEffects,\n            effect: { type: \"transform\", transform },\n        });\n    }\n    default(def) {\n        const defaultValueFunc = typeof def === \"function\" ? def : () => def;\n        return new ZodDefault({\n            ...processCreateParams(this._def),\n            innerType: this,\n            defaultValue: defaultValueFunc,\n            typeName: ZodFirstPartyTypeKind.ZodDefault,\n        });\n    }\n    brand() {\n        return new ZodBranded({\n            typeName: ZodFirstPartyTypeKind.ZodBranded,\n            type: this,\n            ...processCreateParams(this._def),\n        });\n    }\n    catch(def) {\n        const catchValueFunc = typeof def === \"function\" ? def : () => def;\n        return new ZodCatch({\n            ...processCreateParams(this._def),\n            innerType: this,\n            catchValue: catchValueFunc,\n            typeName: ZodFirstPartyTypeKind.ZodCatch,\n        });\n    }\n    describe(description) {\n        const This = this.constructor;\n        return new This({\n            ...this._def,\n            description,\n        });\n    }\n    pipe(target) {\n        return ZodPipeline.create(this, target);\n    }\n    readonly() {\n        return ZodReadonly.create(this);\n    }\n    isOptional() {\n        return this.safeParse(undefined).success;\n    }\n    isNullable() {\n        return this.safeParse(null).success;\n    }\n}\nconst cuidRegex = /^c[^\\s-]{8,}$/i;\nconst cuid2Regex = /^[0-9a-z]+$/;\nconst ulidRegex = /^[0-9A-HJKMNP-TV-Z]{26}$/i;\n// const uuidRegex =\n//   /^([a-f0-9]{8}-[a-f0-9]{4}-[1-5][a-f0-9]{3}-[a-f0-9]{4}-[a-f0-9]{12}|00000000-0000-0000-0000-000000000000)$/i;\nconst uuidRegex = /^[0-9a-fA-F]{8}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{12}$/i;\nconst nanoidRegex = /^[a-z0-9_-]{21}$/i;\nconst jwtRegex = /^[A-Za-z0-9-_]+\\.[A-Za-z0-9-_]+\\.[A-Za-z0-9-_]*$/;\nconst durationRegex = /^[-+]?P(?!$)(?:(?:[-+]?\\d+Y)|(?:[-+]?\\d+[.,]\\d+Y$))?(?:(?:[-+]?\\d+M)|(?:[-+]?\\d+[.,]\\d+M$))?(?:(?:[-+]?\\d+W)|(?:[-+]?\\d+[.,]\\d+W$))?(?:(?:[-+]?\\d+D)|(?:[-+]?\\d+[.,]\\d+D$))?(?:T(?=[\\d+-])(?:(?:[-+]?\\d+H)|(?:[-+]?\\d+[.,]\\d+H$))?(?:(?:[-+]?\\d+M)|(?:[-+]?\\d+[.,]\\d+M$))?(?:[-+]?\\d+(?:[.,]\\d+)?S)?)??$/;\n// from https://stackoverflow.com/a/46181/1550155\n// old version: too slow, didn't support unicode\n// const emailRegex = /^((([a-z]|\\d|[!#\\$%&'\\*\\+\\-\\/=\\?\\^_`{\\|}~]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])+(\\.([a-z]|\\d|[!#\\$%&'\\*\\+\\-\\/=\\?\\^_`{\\|}~]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])+)*)|((\\x22)((((\\x20|\\x09)*(\\x0d\\x0a))?(\\x20|\\x09)+)?(([\\x01-\\x08\\x0b\\x0c\\x0e-\\x1f\\x7f]|\\x21|[\\x23-\\x5b]|[\\x5d-\\x7e]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(\\\\([\\x01-\\x09\\x0b\\x0c\\x0d-\\x7f]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]))))*(((\\x20|\\x09)*(\\x0d\\x0a))?(\\x20|\\x09)+)?(\\x22)))@((([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])*([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])))\\.)+(([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])*([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])))$/i;\n//old email regex\n// const emailRegex = /^(([^<>()[\\].,;:\\s@\"]+(\\.[^<>()[\\].,;:\\s@\"]+)*)|(\".+\"))@((?!-)([^<>()[\\].,;:\\s@\"]+\\.)+[^<>()[\\].,;:\\s@\"]{1,})[^-<>()[\\].,;:\\s@\"]$/i;\n// eslint-disable-next-line\n// const emailRegex =\n//   /^(([^<>()[\\]\\\\.,;:\\s@\\\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\\\"]+)*)|(\\\".+\\\"))@((\\[(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\\])|(\\[IPv6:(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))\\])|([A-Za-z0-9]([A-Za-z0-9-]*[A-Za-z0-9])*(\\.[A-Za-z]{2,})+))$/;\n// const emailRegex =\n//   /^[a-zA-Z0-9\\.\\!\\#\\$\\%\\&\\'\\*\\+\\/\\=\\?\\^\\_\\`\\{\\|\\}\\~\\-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;\n// const emailRegex =\n//   /^(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|\"(?:[\\x01-\\x08\\x0b\\x0c\\x0e-\\x1f\\x21\\x23-\\x5b\\x5d-\\x7f]|\\\\[\\x01-\\x09\\x0b\\x0c\\x0e-\\x7f])*\")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\\x01-\\x08\\x0b\\x0c\\x0e-\\x1f\\x21-\\x5a\\x53-\\x7f]|\\\\[\\x01-\\x09\\x0b\\x0c\\x0e-\\x7f])+)\\])$/i;\nconst emailRegex = /^(?!\\.)(?!.*\\.\\.)([A-Z0-9_'+\\-\\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\\-]*\\.)+[A-Z]{2,}$/i;\n// const emailRegex =\n//   /^[a-z0-9.!#$%&*+/=?^_`{|}~-]+@[a-z0-9-]+(?:\\.[a-z0-9\\-]+)*$/i;\n// from https://thekevinscott.com/emojis-in-javascript/#writing-a-regular-expression\nconst _emojiRegex = `^(\\\\p{Extended_Pictographic}|\\\\p{Emoji_Component})+$`;\nlet emojiRegex;\n// faster, simpler, safer\nconst ipv4Regex = /^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/;\nconst ipv4CidrRegex = /^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\\/(3[0-2]|[12]?[0-9])$/;\n// const ipv6Regex =\n// /^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/;\nconst ipv6Regex = /^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/;\nconst ipv6CidrRegex = /^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/;\n// https://stackoverflow.com/questions/7860392/determine-if-string-is-in-base64-using-javascript\nconst base64Regex = /^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/;\n// https://base64.guru/standards/base64url\nconst base64urlRegex = /^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/;\n// simple\n// const dateRegexSource = `\\\\d{4}-\\\\d{2}-\\\\d{2}`;\n// no leap year validation\n// const dateRegexSource = `\\\\d{4}-((0[13578]|10|12)-31|(0[13-9]|1[0-2])-30|(0[1-9]|1[0-2])-(0[1-9]|1\\\\d|2\\\\d))`;\n// with leap year validation\nconst dateRegexSource = `((\\\\d\\\\d[2468][048]|\\\\d\\\\d[13579][26]|\\\\d\\\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\\\d|30)|(02)-(0[1-9]|1\\\\d|2[0-8])))`;\nconst dateRegex = new RegExp(`^${dateRegexSource}$`);\nfunction timeRegexSource(args) {\n    let secondsRegexSource = `[0-5]\\\\d`;\n    if (args.precision) {\n        secondsRegexSource = `${secondsRegexSource}\\\\.\\\\d{${args.precision}}`;\n    }\n    else if (args.precision == null) {\n        secondsRegexSource = `${secondsRegexSource}(\\\\.\\\\d+)?`;\n    }\n    const secondsQuantifier = args.precision ? \"+\" : \"?\"; // require seconds if precision is nonzero\n    return `([01]\\\\d|2[0-3]):[0-5]\\\\d(:${secondsRegexSource})${secondsQuantifier}`;\n}\nfunction timeRegex(args) {\n    return new RegExp(`^${timeRegexSource(args)}$`);\n}\n// Adapted from https://stackoverflow.com/a/3143231\nexport function datetimeRegex(args) {\n    let regex = `${dateRegexSource}T${timeRegexSource(args)}`;\n    const opts = [];\n    opts.push(args.local ? `Z?` : `Z`);\n    if (args.offset)\n        opts.push(`([+-]\\\\d{2}:?\\\\d{2})`);\n    regex = `${regex}(${opts.join(\"|\")})`;\n    return new RegExp(`^${regex}$`);\n}\nfunction isValidIP(ip, version) {\n    if ((version === \"v4\" || !version) && ipv4Regex.test(ip)) {\n        return true;\n    }\n    if ((version === \"v6\" || !version) && ipv6Regex.test(ip)) {\n        return true;\n    }\n    return false;\n}\nfunction isValidJWT(jwt, alg) {\n    if (!jwtRegex.test(jwt))\n        return false;\n    try {\n        const [header] = jwt.split(\".\");\n        if (!header)\n            return false;\n        // Convert base64url to base64\n        const base64 = header\n            .replace(/-/g, \"+\")\n            .replace(/_/g, \"/\")\n            .padEnd(header.length + ((4 - (header.length % 4)) % 4), \"=\");\n        const decoded = JSON.parse(atob(base64));\n        if (typeof decoded !== \"object\" || decoded === null)\n            return false;\n        if (\"typ\" in decoded && decoded?.typ !== \"JWT\")\n            return false;\n        if (!decoded.alg)\n            return false;\n        if (alg && decoded.alg !== alg)\n            return false;\n        return true;\n    }\n    catch {\n        return false;\n    }\n}\nfunction isValidCidr(ip, version) {\n    if ((version === \"v4\" || !version) && ipv4CidrRegex.test(ip)) {\n        return true;\n    }\n    if ((version === \"v6\" || !version) && ipv6CidrRegex.test(ip)) {\n        return true;\n    }\n    return false;\n}\nexport class ZodString extends ZodType {\n    _parse(input) {\n        if (this._def.coerce) {\n            input.data = String(input.data);\n        }\n        const parsedType = this._getType(input);\n        if (parsedType !== ZodParsedType.string) {\n            const ctx = this._getOrReturnCtx(input);\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.string,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        const status = new ParseStatus();\n        let ctx = undefined;\n        for (const check of this._def.checks) {\n            if (check.kind === \"min\") {\n                if (input.data.length < check.value) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.too_small,\n                        minimum: check.value,\n                        type: \"string\",\n                        inclusive: true,\n                        exact: false,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"max\") {\n                if (input.data.length > check.value) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.too_big,\n                        maximum: check.value,\n                        type: \"string\",\n                        inclusive: true,\n                        exact: false,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"length\") {\n                const tooBig = input.data.length > check.value;\n                const tooSmall = input.data.length < check.value;\n                if (tooBig || tooSmall) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    if (tooBig) {\n                        addIssueToContext(ctx, {\n                            code: ZodIssueCode.too_big,\n                            maximum: check.value,\n                            type: \"string\",\n                            inclusive: true,\n                            exact: true,\n                            message: check.message,\n                        });\n                    }\n                    else if (tooSmall) {\n                        addIssueToContext(ctx, {\n                            code: ZodIssueCode.too_small,\n                            minimum: check.value,\n                            type: \"string\",\n                            inclusive: true,\n                            exact: true,\n                            message: check.message,\n                        });\n                    }\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"email\") {\n                if (!emailRegex.test(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        validation: \"email\",\n                        code: ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"emoji\") {\n                if (!emojiRegex) {\n                    emojiRegex = new RegExp(_emojiRegex, \"u\");\n                }\n                if (!emojiRegex.test(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        validation: \"emoji\",\n                        code: ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"uuid\") {\n                if (!uuidRegex.test(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        validation: \"uuid\",\n                        code: ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"nanoid\") {\n                if (!nanoidRegex.test(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        validation: \"nanoid\",\n                        code: ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"cuid\") {\n                if (!cuidRegex.test(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        validation: \"cuid\",\n                        code: ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"cuid2\") {\n                if (!cuid2Regex.test(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        validation: \"cuid2\",\n                        code: ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"ulid\") {\n                if (!ulidRegex.test(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        validation: \"ulid\",\n                        code: ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"url\") {\n                try {\n                    new URL(input.data);\n                }\n                catch {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        validation: \"url\",\n                        code: ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"regex\") {\n                check.regex.lastIndex = 0;\n                const testResult = check.regex.test(input.data);\n                if (!testResult) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        validation: \"regex\",\n                        code: ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"trim\") {\n                input.data = input.data.trim();\n            }\n            else if (check.kind === \"includes\") {\n                if (!input.data.includes(check.value, check.position)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.invalid_string,\n                        validation: { includes: check.value, position: check.position },\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"toLowerCase\") {\n                input.data = input.data.toLowerCase();\n            }\n            else if (check.kind === \"toUpperCase\") {\n                input.data = input.data.toUpperCase();\n            }\n            else if (check.kind === \"startsWith\") {\n                if (!input.data.startsWith(check.value)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.invalid_string,\n                        validation: { startsWith: check.value },\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"endsWith\") {\n                if (!input.data.endsWith(check.value)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.invalid_string,\n                        validation: { endsWith: check.value },\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"datetime\") {\n                const regex = datetimeRegex(check);\n                if (!regex.test(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.invalid_string,\n                        validation: \"datetime\",\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"date\") {\n                const regex = dateRegex;\n                if (!regex.test(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.invalid_string,\n                        validation: \"date\",\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"time\") {\n                const regex = timeRegex(check);\n                if (!regex.test(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.invalid_string,\n                        validation: \"time\",\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"duration\") {\n                if (!durationRegex.test(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        validation: \"duration\",\n                        code: ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"ip\") {\n                if (!isValidIP(input.data, check.version)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        validation: \"ip\",\n                        code: ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"jwt\") {\n                if (!isValidJWT(input.data, check.alg)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        validation: \"jwt\",\n                        code: ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"cidr\") {\n                if (!isValidCidr(input.data, check.version)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        validation: \"cidr\",\n                        code: ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"base64\") {\n                if (!base64Regex.test(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        validation: \"base64\",\n                        code: ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"base64url\") {\n                if (!base64urlRegex.test(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        validation: \"base64url\",\n                        code: ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else {\n                util.assertNever(check);\n            }\n        }\n        return { status: status.value, value: input.data };\n    }\n    _regex(regex, validation, message) {\n        return this.refinement((data) => regex.test(data), {\n            validation,\n            code: ZodIssueCode.invalid_string,\n            ...errorUtil.errToObj(message),\n        });\n    }\n    _addCheck(check) {\n        return new ZodString({\n            ...this._def,\n            checks: [...this._def.checks, check],\n        });\n    }\n    email(message) {\n        return this._addCheck({ kind: \"email\", ...errorUtil.errToObj(message) });\n    }\n    url(message) {\n        return this._addCheck({ kind: \"url\", ...errorUtil.errToObj(message) });\n    }\n    emoji(message) {\n        return this._addCheck({ kind: \"emoji\", ...errorUtil.errToObj(message) });\n    }\n    uuid(message) {\n        return this._addCheck({ kind: \"uuid\", ...errorUtil.errToObj(message) });\n    }\n    nanoid(message) {\n        return this._addCheck({ kind: \"nanoid\", ...errorUtil.errToObj(message) });\n    }\n    cuid(message) {\n        return this._addCheck({ kind: \"cuid\", ...errorUtil.errToObj(message) });\n    }\n    cuid2(message) {\n        return this._addCheck({ kind: \"cuid2\", ...errorUtil.errToObj(message) });\n    }\n    ulid(message) {\n        return this._addCheck({ kind: \"ulid\", ...errorUtil.errToObj(message) });\n    }\n    base64(message) {\n        return this._addCheck({ kind: \"base64\", ...errorUtil.errToObj(message) });\n    }\n    base64url(message) {\n        // base64url encoding is a modification of base64 that can safely be used in URLs and filenames\n        return this._addCheck({\n            kind: \"base64url\",\n            ...errorUtil.errToObj(message),\n        });\n    }\n    jwt(options) {\n        return this._addCheck({ kind: \"jwt\", ...errorUtil.errToObj(options) });\n    }\n    ip(options) {\n        return this._addCheck({ kind: \"ip\", ...errorUtil.errToObj(options) });\n    }\n    cidr(options) {\n        return this._addCheck({ kind: \"cidr\", ...errorUtil.errToObj(options) });\n    }\n    datetime(options) {\n        if (typeof options === \"string\") {\n            return this._addCheck({\n                kind: \"datetime\",\n                precision: null,\n                offset: false,\n                local: false,\n                message: options,\n            });\n        }\n        return this._addCheck({\n            kind: \"datetime\",\n            precision: typeof options?.precision === \"undefined\" ? null : options?.precision,\n            offset: options?.offset ?? false,\n            local: options?.local ?? false,\n            ...errorUtil.errToObj(options?.message),\n        });\n    }\n    date(message) {\n        return this._addCheck({ kind: \"date\", message });\n    }\n    time(options) {\n        if (typeof options === \"string\") {\n            return this._addCheck({\n                kind: \"time\",\n                precision: null,\n                message: options,\n            });\n        }\n        return this._addCheck({\n            kind: \"time\",\n            precision: typeof options?.precision === \"undefined\" ? null : options?.precision,\n            ...errorUtil.errToObj(options?.message),\n        });\n    }\n    duration(message) {\n        return this._addCheck({ kind: \"duration\", ...errorUtil.errToObj(message) });\n    }\n    regex(regex, message) {\n        return this._addCheck({\n            kind: \"regex\",\n            regex: regex,\n            ...errorUtil.errToObj(message),\n        });\n    }\n    includes(value, options) {\n        return this._addCheck({\n            kind: \"includes\",\n            value: value,\n            position: options?.position,\n            ...errorUtil.errToObj(options?.message),\n        });\n    }\n    startsWith(value, message) {\n        return this._addCheck({\n            kind: \"startsWith\",\n            value: value,\n            ...errorUtil.errToObj(message),\n        });\n    }\n    endsWith(value, message) {\n        return this._addCheck({\n            kind: \"endsWith\",\n            value: value,\n            ...errorUtil.errToObj(message),\n        });\n    }\n    min(minLength, message) {\n        return this._addCheck({\n            kind: \"min\",\n            value: minLength,\n            ...errorUtil.errToObj(message),\n        });\n    }\n    max(maxLength, message) {\n        return this._addCheck({\n            kind: \"max\",\n            value: maxLength,\n            ...errorUtil.errToObj(message),\n        });\n    }\n    length(len, message) {\n        return this._addCheck({\n            kind: \"length\",\n            value: len,\n            ...errorUtil.errToObj(message),\n        });\n    }\n    /**\n     * Equivalent to `.min(1)`\n     */\n    nonempty(message) {\n        return this.min(1, errorUtil.errToObj(message));\n    }\n    trim() {\n        return new ZodString({\n            ...this._def,\n            checks: [...this._def.checks, { kind: \"trim\" }],\n        });\n    }\n    toLowerCase() {\n        return new ZodString({\n            ...this._def,\n            checks: [...this._def.checks, { kind: \"toLowerCase\" }],\n        });\n    }\n    toUpperCase() {\n        return new ZodString({\n            ...this._def,\n            checks: [...this._def.checks, { kind: \"toUpperCase\" }],\n        });\n    }\n    get isDatetime() {\n        return !!this._def.checks.find((ch) => ch.kind === \"datetime\");\n    }\n    get isDate() {\n        return !!this._def.checks.find((ch) => ch.kind === \"date\");\n    }\n    get isTime() {\n        return !!this._def.checks.find((ch) => ch.kind === \"time\");\n    }\n    get isDuration() {\n        return !!this._def.checks.find((ch) => ch.kind === \"duration\");\n    }\n    get isEmail() {\n        return !!this._def.checks.find((ch) => ch.kind === \"email\");\n    }\n    get isURL() {\n        return !!this._def.checks.find((ch) => ch.kind === \"url\");\n    }\n    get isEmoji() {\n        return !!this._def.checks.find((ch) => ch.kind === \"emoji\");\n    }\n    get isUUID() {\n        return !!this._def.checks.find((ch) => ch.kind === \"uuid\");\n    }\n    get isNANOID() {\n        return !!this._def.checks.find((ch) => ch.kind === \"nanoid\");\n    }\n    get isCUID() {\n        return !!this._def.checks.find((ch) => ch.kind === \"cuid\");\n    }\n    get isCUID2() {\n        return !!this._def.checks.find((ch) => ch.kind === \"cuid2\");\n    }\n    get isULID() {\n        return !!this._def.checks.find((ch) => ch.kind === \"ulid\");\n    }\n    get isIP() {\n        return !!this._def.checks.find((ch) => ch.kind === \"ip\");\n    }\n    get isCIDR() {\n        return !!this._def.checks.find((ch) => ch.kind === \"cidr\");\n    }\n    get isBase64() {\n        return !!this._def.checks.find((ch) => ch.kind === \"base64\");\n    }\n    get isBase64url() {\n        // base64url encoding is a modification of base64 that can safely be used in URLs and filenames\n        return !!this._def.checks.find((ch) => ch.kind === \"base64url\");\n    }\n    get minLength() {\n        let min = null;\n        for (const ch of this._def.checks) {\n            if (ch.kind === \"min\") {\n                if (min === null || ch.value > min)\n                    min = ch.value;\n            }\n        }\n        return min;\n    }\n    get maxLength() {\n        let max = null;\n        for (const ch of this._def.checks) {\n            if (ch.kind === \"max\") {\n                if (max === null || ch.value < max)\n                    max = ch.value;\n            }\n        }\n        return max;\n    }\n}\nZodString.create = (params) => {\n    return new ZodString({\n        checks: [],\n        typeName: ZodFirstPartyTypeKind.ZodString,\n        coerce: params?.coerce ?? false,\n        ...processCreateParams(params),\n    });\n};\n// https://stackoverflow.com/questions/3966484/why-does-modulus-operator-return-fractional-number-in-javascript/31711034#31711034\nfunction floatSafeRemainder(val, step) {\n    const valDecCount = (val.toString().split(\".\")[1] || \"\").length;\n    const stepDecCount = (step.toString().split(\".\")[1] || \"\").length;\n    const decCount = valDecCount > stepDecCount ? valDecCount : stepDecCount;\n    const valInt = Number.parseInt(val.toFixed(decCount).replace(\".\", \"\"));\n    const stepInt = Number.parseInt(step.toFixed(decCount).replace(\".\", \"\"));\n    return (valInt % stepInt) / 10 ** decCount;\n}\nexport class ZodNumber extends ZodType {\n    constructor() {\n        super(...arguments);\n        this.min = this.gte;\n        this.max = this.lte;\n        this.step = this.multipleOf;\n    }\n    _parse(input) {\n        if (this._def.coerce) {\n            input.data = Number(input.data);\n        }\n        const parsedType = this._getType(input);\n        if (parsedType !== ZodParsedType.number) {\n            const ctx = this._getOrReturnCtx(input);\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.number,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        let ctx = undefined;\n        const status = new ParseStatus();\n        for (const check of this._def.checks) {\n            if (check.kind === \"int\") {\n                if (!util.isInteger(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.invalid_type,\n                        expected: \"integer\",\n                        received: \"float\",\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"min\") {\n                const tooSmall = check.inclusive ? input.data < check.value : input.data <= check.value;\n                if (tooSmall) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.too_small,\n                        minimum: check.value,\n                        type: \"number\",\n                        inclusive: check.inclusive,\n                        exact: false,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"max\") {\n                const tooBig = check.inclusive ? input.data > check.value : input.data >= check.value;\n                if (tooBig) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.too_big,\n                        maximum: check.value,\n                        type: \"number\",\n                        inclusive: check.inclusive,\n                        exact: false,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"multipleOf\") {\n                if (floatSafeRemainder(input.data, check.value) !== 0) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.not_multiple_of,\n                        multipleOf: check.value,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"finite\") {\n                if (!Number.isFinite(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.not_finite,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else {\n                util.assertNever(check);\n            }\n        }\n        return { status: status.value, value: input.data };\n    }\n    gte(value, message) {\n        return this.setLimit(\"min\", value, true, errorUtil.toString(message));\n    }\n    gt(value, message) {\n        return this.setLimit(\"min\", value, false, errorUtil.toString(message));\n    }\n    lte(value, message) {\n        return this.setLimit(\"max\", value, true, errorUtil.toString(message));\n    }\n    lt(value, message) {\n        return this.setLimit(\"max\", value, false, errorUtil.toString(message));\n    }\n    setLimit(kind, value, inclusive, message) {\n        return new ZodNumber({\n            ...this._def,\n            checks: [\n                ...this._def.checks,\n                {\n                    kind,\n                    value,\n                    inclusive,\n                    message: errorUtil.toString(message),\n                },\n            ],\n        });\n    }\n    _addCheck(check) {\n        return new ZodNumber({\n            ...this._def,\n            checks: [...this._def.checks, check],\n        });\n    }\n    int(message) {\n        return this._addCheck({\n            kind: \"int\",\n            message: errorUtil.toString(message),\n        });\n    }\n    positive(message) {\n        return this._addCheck({\n            kind: \"min\",\n            value: 0,\n            inclusive: false,\n            message: errorUtil.toString(message),\n        });\n    }\n    negative(message) {\n        return this._addCheck({\n            kind: \"max\",\n            value: 0,\n            inclusive: false,\n            message: errorUtil.toString(message),\n        });\n    }\n    nonpositive(message) {\n        return this._addCheck({\n            kind: \"max\",\n            value: 0,\n            inclusive: true,\n            message: errorUtil.toString(message),\n        });\n    }\n    nonnegative(message) {\n        return this._addCheck({\n            kind: \"min\",\n            value: 0,\n            inclusive: true,\n            message: errorUtil.toString(message),\n        });\n    }\n    multipleOf(value, message) {\n        return this._addCheck({\n            kind: \"multipleOf\",\n            value: value,\n            message: errorUtil.toString(message),\n        });\n    }\n    finite(message) {\n        return this._addCheck({\n            kind: \"finite\",\n            message: errorUtil.toString(message),\n        });\n    }\n    safe(message) {\n        return this._addCheck({\n            kind: \"min\",\n            inclusive: true,\n            value: Number.MIN_SAFE_INTEGER,\n            message: errorUtil.toString(message),\n        })._addCheck({\n            kind: \"max\",\n            inclusive: true,\n            value: Number.MAX_SAFE_INTEGER,\n            message: errorUtil.toString(message),\n        });\n    }\n    get minValue() {\n        let min = null;\n        for (const ch of this._def.checks) {\n            if (ch.kind === \"min\") {\n                if (min === null || ch.value > min)\n                    min = ch.value;\n            }\n        }\n        return min;\n    }\n    get maxValue() {\n        let max = null;\n        for (const ch of this._def.checks) {\n            if (ch.kind === \"max\") {\n                if (max === null || ch.value < max)\n                    max = ch.value;\n            }\n        }\n        return max;\n    }\n    get isInt() {\n        return !!this._def.checks.find((ch) => ch.kind === \"int\" || (ch.kind === \"multipleOf\" && util.isInteger(ch.value)));\n    }\n    get isFinite() {\n        let max = null;\n        let min = null;\n        for (const ch of this._def.checks) {\n            if (ch.kind === \"finite\" || ch.kind === \"int\" || ch.kind === \"multipleOf\") {\n                return true;\n            }\n            else if (ch.kind === \"min\") {\n                if (min === null || ch.value > min)\n                    min = ch.value;\n            }\n            else if (ch.kind === \"max\") {\n                if (max === null || ch.value < max)\n                    max = ch.value;\n            }\n        }\n        return Number.isFinite(min) && Number.isFinite(max);\n    }\n}\nZodNumber.create = (params) => {\n    return new ZodNumber({\n        checks: [],\n        typeName: ZodFirstPartyTypeKind.ZodNumber,\n        coerce: params?.coerce || false,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodBigInt extends ZodType {\n    constructor() {\n        super(...arguments);\n        this.min = this.gte;\n        this.max = this.lte;\n    }\n    _parse(input) {\n        if (this._def.coerce) {\n            try {\n                input.data = BigInt(input.data);\n            }\n            catch {\n                return this._getInvalidInput(input);\n            }\n        }\n        const parsedType = this._getType(input);\n        if (parsedType !== ZodParsedType.bigint) {\n            return this._getInvalidInput(input);\n        }\n        let ctx = undefined;\n        const status = new ParseStatus();\n        for (const check of this._def.checks) {\n            if (check.kind === \"min\") {\n                const tooSmall = check.inclusive ? input.data < check.value : input.data <= check.value;\n                if (tooSmall) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.too_small,\n                        type: \"bigint\",\n                        minimum: check.value,\n                        inclusive: check.inclusive,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"max\") {\n                const tooBig = check.inclusive ? input.data > check.value : input.data >= check.value;\n                if (tooBig) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.too_big,\n                        type: \"bigint\",\n                        maximum: check.value,\n                        inclusive: check.inclusive,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"multipleOf\") {\n                if (input.data % check.value !== BigInt(0)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.not_multiple_of,\n                        multipleOf: check.value,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else {\n                util.assertNever(check);\n            }\n        }\n        return { status: status.value, value: input.data };\n    }\n    _getInvalidInput(input) {\n        const ctx = this._getOrReturnCtx(input);\n        addIssueToContext(ctx, {\n            code: ZodIssueCode.invalid_type,\n            expected: ZodParsedType.bigint,\n            received: ctx.parsedType,\n        });\n        return INVALID;\n    }\n    gte(value, message) {\n        return this.setLimit(\"min\", value, true, errorUtil.toString(message));\n    }\n    gt(value, message) {\n        return this.setLimit(\"min\", value, false, errorUtil.toString(message));\n    }\n    lte(value, message) {\n        return this.setLimit(\"max\", value, true, errorUtil.toString(message));\n    }\n    lt(value, message) {\n        return this.setLimit(\"max\", value, false, errorUtil.toString(message));\n    }\n    setLimit(kind, value, inclusive, message) {\n        return new ZodBigInt({\n            ...this._def,\n            checks: [\n                ...this._def.checks,\n                {\n                    kind,\n                    value,\n                    inclusive,\n                    message: errorUtil.toString(message),\n                },\n            ],\n        });\n    }\n    _addCheck(check) {\n        return new ZodBigInt({\n            ...this._def,\n            checks: [...this._def.checks, check],\n        });\n    }\n    positive(message) {\n        return this._addCheck({\n            kind: \"min\",\n            value: BigInt(0),\n            inclusive: false,\n            message: errorUtil.toString(message),\n        });\n    }\n    negative(message) {\n        return this._addCheck({\n            kind: \"max\",\n            value: BigInt(0),\n            inclusive: false,\n            message: errorUtil.toString(message),\n        });\n    }\n    nonpositive(message) {\n        return this._addCheck({\n            kind: \"max\",\n            value: BigInt(0),\n            inclusive: true,\n            message: errorUtil.toString(message),\n        });\n    }\n    nonnegative(message) {\n        return this._addCheck({\n            kind: \"min\",\n            value: BigInt(0),\n            inclusive: true,\n            message: errorUtil.toString(message),\n        });\n    }\n    multipleOf(value, message) {\n        return this._addCheck({\n            kind: \"multipleOf\",\n            value,\n            message: errorUtil.toString(message),\n        });\n    }\n    get minValue() {\n        let min = null;\n        for (const ch of this._def.checks) {\n            if (ch.kind === \"min\") {\n                if (min === null || ch.value > min)\n                    min = ch.value;\n            }\n        }\n        return min;\n    }\n    get maxValue() {\n        let max = null;\n        for (const ch of this._def.checks) {\n            if (ch.kind === \"max\") {\n                if (max === null || ch.value < max)\n                    max = ch.value;\n            }\n        }\n        return max;\n    }\n}\nZodBigInt.create = (params) => {\n    return new ZodBigInt({\n        checks: [],\n        typeName: ZodFirstPartyTypeKind.ZodBigInt,\n        coerce: params?.coerce ?? false,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodBoolean extends ZodType {\n    _parse(input) {\n        if (this._def.coerce) {\n            input.data = Boolean(input.data);\n        }\n        const parsedType = this._getType(input);\n        if (parsedType !== ZodParsedType.boolean) {\n            const ctx = this._getOrReturnCtx(input);\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.boolean,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        return OK(input.data);\n    }\n}\nZodBoolean.create = (params) => {\n    return new ZodBoolean({\n        typeName: ZodFirstPartyTypeKind.ZodBoolean,\n        coerce: params?.coerce || false,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodDate extends ZodType {\n    _parse(input) {\n        if (this._def.coerce) {\n            input.data = new Date(input.data);\n        }\n        const parsedType = this._getType(input);\n        if (parsedType !== ZodParsedType.date) {\n            const ctx = this._getOrReturnCtx(input);\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.date,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        if (Number.isNaN(input.data.getTime())) {\n            const ctx = this._getOrReturnCtx(input);\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_date,\n            });\n            return INVALID;\n        }\n        const status = new ParseStatus();\n        let ctx = undefined;\n        for (const check of this._def.checks) {\n            if (check.kind === \"min\") {\n                if (input.data.getTime() < check.value) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.too_small,\n                        message: check.message,\n                        inclusive: true,\n                        exact: false,\n                        minimum: check.value,\n                        type: \"date\",\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"max\") {\n                if (input.data.getTime() > check.value) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.too_big,\n                        message: check.message,\n                        inclusive: true,\n                        exact: false,\n                        maximum: check.value,\n                        type: \"date\",\n                    });\n                    status.dirty();\n                }\n            }\n            else {\n                util.assertNever(check);\n            }\n        }\n        return {\n            status: status.value,\n            value: new Date(input.data.getTime()),\n        };\n    }\n    _addCheck(check) {\n        return new ZodDate({\n            ...this._def,\n            checks: [...this._def.checks, check],\n        });\n    }\n    min(minDate, message) {\n        return this._addCheck({\n            kind: \"min\",\n            value: minDate.getTime(),\n            message: errorUtil.toString(message),\n        });\n    }\n    max(maxDate, message) {\n        return this._addCheck({\n            kind: \"max\",\n            value: maxDate.getTime(),\n            message: errorUtil.toString(message),\n        });\n    }\n    get minDate() {\n        let min = null;\n        for (const ch of this._def.checks) {\n            if (ch.kind === \"min\") {\n                if (min === null || ch.value > min)\n                    min = ch.value;\n            }\n        }\n        return min != null ? new Date(min) : null;\n    }\n    get maxDate() {\n        let max = null;\n        for (const ch of this._def.checks) {\n            if (ch.kind === \"max\") {\n                if (max === null || ch.value < max)\n                    max = ch.value;\n            }\n        }\n        return max != null ? new Date(max) : null;\n    }\n}\nZodDate.create = (params) => {\n    return new ZodDate({\n        checks: [],\n        coerce: params?.coerce || false,\n        typeName: ZodFirstPartyTypeKind.ZodDate,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodSymbol extends ZodType {\n    _parse(input) {\n        const parsedType = this._getType(input);\n        if (parsedType !== ZodParsedType.symbol) {\n            const ctx = this._getOrReturnCtx(input);\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.symbol,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        return OK(input.data);\n    }\n}\nZodSymbol.create = (params) => {\n    return new ZodSymbol({\n        typeName: ZodFirstPartyTypeKind.ZodSymbol,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodUndefined extends ZodType {\n    _parse(input) {\n        const parsedType = this._getType(input);\n        if (parsedType !== ZodParsedType.undefined) {\n            const ctx = this._getOrReturnCtx(input);\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.undefined,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        return OK(input.data);\n    }\n}\nZodUndefined.create = (params) => {\n    return new ZodUndefined({\n        typeName: ZodFirstPartyTypeKind.ZodUndefined,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodNull extends ZodType {\n    _parse(input) {\n        const parsedType = this._getType(input);\n        if (parsedType !== ZodParsedType.null) {\n            const ctx = this._getOrReturnCtx(input);\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.null,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        return OK(input.data);\n    }\n}\nZodNull.create = (params) => {\n    return new ZodNull({\n        typeName: ZodFirstPartyTypeKind.ZodNull,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodAny extends ZodType {\n    constructor() {\n        super(...arguments);\n        // to prevent instances of other classes from extending ZodAny. this causes issues with catchall in ZodObject.\n        this._any = true;\n    }\n    _parse(input) {\n        return OK(input.data);\n    }\n}\nZodAny.create = (params) => {\n    return new ZodAny({\n        typeName: ZodFirstPartyTypeKind.ZodAny,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodUnknown extends ZodType {\n    constructor() {\n        super(...arguments);\n        // required\n        this._unknown = true;\n    }\n    _parse(input) {\n        return OK(input.data);\n    }\n}\nZodUnknown.create = (params) => {\n    return new ZodUnknown({\n        typeName: ZodFirstPartyTypeKind.ZodUnknown,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodNever extends ZodType {\n    _parse(input) {\n        const ctx = this._getOrReturnCtx(input);\n        addIssueToContext(ctx, {\n            code: ZodIssueCode.invalid_type,\n            expected: ZodParsedType.never,\n            received: ctx.parsedType,\n        });\n        return INVALID;\n    }\n}\nZodNever.create = (params) => {\n    return new ZodNever({\n        typeName: ZodFirstPartyTypeKind.ZodNever,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodVoid extends ZodType {\n    _parse(input) {\n        const parsedType = this._getType(input);\n        if (parsedType !== ZodParsedType.undefined) {\n            const ctx = this._getOrReturnCtx(input);\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.void,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        return OK(input.data);\n    }\n}\nZodVoid.create = (params) => {\n    return new ZodVoid({\n        typeName: ZodFirstPartyTypeKind.ZodVoid,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodArray extends ZodType {\n    _parse(input) {\n        const { ctx, status } = this._processInputParams(input);\n        const def = this._def;\n        if (ctx.parsedType !== ZodParsedType.array) {\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.array,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        if (def.exactLength !== null) {\n            const tooBig = ctx.data.length > def.exactLength.value;\n            const tooSmall = ctx.data.length < def.exactLength.value;\n            if (tooBig || tooSmall) {\n                addIssueToContext(ctx, {\n                    code: tooBig ? ZodIssueCode.too_big : ZodIssueCode.too_small,\n                    minimum: (tooSmall ? def.exactLength.value : undefined),\n                    maximum: (tooBig ? def.exactLength.value : undefined),\n                    type: \"array\",\n                    inclusive: true,\n                    exact: true,\n                    message: def.exactLength.message,\n                });\n                status.dirty();\n            }\n        }\n        if (def.minLength !== null) {\n            if (ctx.data.length < def.minLength.value) {\n                addIssueToContext(ctx, {\n                    code: ZodIssueCode.too_small,\n                    minimum: def.minLength.value,\n                    type: \"array\",\n                    inclusive: true,\n                    exact: false,\n                    message: def.minLength.message,\n                });\n                status.dirty();\n            }\n        }\n        if (def.maxLength !== null) {\n            if (ctx.data.length > def.maxLength.value) {\n                addIssueToContext(ctx, {\n                    code: ZodIssueCode.too_big,\n                    maximum: def.maxLength.value,\n                    type: \"array\",\n                    inclusive: true,\n                    exact: false,\n                    message: def.maxLength.message,\n                });\n                status.dirty();\n            }\n        }\n        if (ctx.common.async) {\n            return Promise.all([...ctx.data].map((item, i) => {\n                return def.type._parseAsync(new ParseInputLazyPath(ctx, item, ctx.path, i));\n            })).then((result) => {\n                return ParseStatus.mergeArray(status, result);\n            });\n        }\n        const result = [...ctx.data].map((item, i) => {\n            return def.type._parseSync(new ParseInputLazyPath(ctx, item, ctx.path, i));\n        });\n        return ParseStatus.mergeArray(status, result);\n    }\n    get element() {\n        return this._def.type;\n    }\n    min(minLength, message) {\n        return new ZodArray({\n            ...this._def,\n            minLength: { value: minLength, message: errorUtil.toString(message) },\n        });\n    }\n    max(maxLength, message) {\n        return new ZodArray({\n            ...this._def,\n            maxLength: { value: maxLength, message: errorUtil.toString(message) },\n        });\n    }\n    length(len, message) {\n        return new ZodArray({\n            ...this._def,\n            exactLength: { value: len, message: errorUtil.toString(message) },\n        });\n    }\n    nonempty(message) {\n        return this.min(1, message);\n    }\n}\nZodArray.create = (schema, params) => {\n    return new ZodArray({\n        type: schema,\n        minLength: null,\n        maxLength: null,\n        exactLength: null,\n        typeName: ZodFirstPartyTypeKind.ZodArray,\n        ...processCreateParams(params),\n    });\n};\nfunction deepPartialify(schema) {\n    if (schema instanceof ZodObject) {\n        const newShape = {};\n        for (const key in schema.shape) {\n            const fieldSchema = schema.shape[key];\n            newShape[key] = ZodOptional.create(deepPartialify(fieldSchema));\n        }\n        return new ZodObject({\n            ...schema._def,\n            shape: () => newShape,\n        });\n    }\n    else if (schema instanceof ZodArray) {\n        return new ZodArray({\n            ...schema._def,\n            type: deepPartialify(schema.element),\n        });\n    }\n    else if (schema instanceof ZodOptional) {\n        return ZodOptional.create(deepPartialify(schema.unwrap()));\n    }\n    else if (schema instanceof ZodNullable) {\n        return ZodNullable.create(deepPartialify(schema.unwrap()));\n    }\n    else if (schema instanceof ZodTuple) {\n        return ZodTuple.create(schema.items.map((item) => deepPartialify(item)));\n    }\n    else {\n        return schema;\n    }\n}\nexport class ZodObject extends ZodType {\n    constructor() {\n        super(...arguments);\n        this._cached = null;\n        /**\n         * @deprecated In most cases, this is no longer needed - unknown properties are now silently stripped.\n         * If you want to pass through unknown properties, use `.passthrough()` instead.\n         */\n        this.nonstrict = this.passthrough;\n        // extend<\n        //   Augmentation extends ZodRawShape,\n        //   NewOutput extends util.flatten<{\n        //     [k in keyof Augmentation | keyof Output]: k extends keyof Augmentation\n        //       ? Augmentation[k][\"_output\"]\n        //       : k extends keyof Output\n        //       ? Output[k]\n        //       : never;\n        //   }>,\n        //   NewInput extends util.flatten<{\n        //     [k in keyof Augmentation | keyof Input]: k extends keyof Augmentation\n        //       ? Augmentation[k][\"_input\"]\n        //       : k extends keyof Input\n        //       ? Input[k]\n        //       : never;\n        //   }>\n        // >(\n        //   augmentation: Augmentation\n        // ): ZodObject<\n        //   extendShape<T, Augmentation>,\n        //   UnknownKeys,\n        //   Catchall,\n        //   NewOutput,\n        //   NewInput\n        // > {\n        //   return new ZodObject({\n        //     ...this._def,\n        //     shape: () => ({\n        //       ...this._def.shape(),\n        //       ...augmentation,\n        //     }),\n        //   }) as any;\n        // }\n        /**\n         * @deprecated Use `.extend` instead\n         *  */\n        this.augment = this.extend;\n    }\n    _getCached() {\n        if (this._cached !== null)\n            return this._cached;\n        const shape = this._def.shape();\n        const keys = util.objectKeys(shape);\n        this._cached = { shape, keys };\n        return this._cached;\n    }\n    _parse(input) {\n        const parsedType = this._getType(input);\n        if (parsedType !== ZodParsedType.object) {\n            const ctx = this._getOrReturnCtx(input);\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.object,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        const { status, ctx } = this._processInputParams(input);\n        const { shape, keys: shapeKeys } = this._getCached();\n        const extraKeys = [];\n        if (!(this._def.catchall instanceof ZodNever && this._def.unknownKeys === \"strip\")) {\n            for (const key in ctx.data) {\n                if (!shapeKeys.includes(key)) {\n                    extraKeys.push(key);\n                }\n            }\n        }\n        const pairs = [];\n        for (const key of shapeKeys) {\n            const keyValidator = shape[key];\n            const value = ctx.data[key];\n            pairs.push({\n                key: { status: \"valid\", value: key },\n                value: keyValidator._parse(new ParseInputLazyPath(ctx, value, ctx.path, key)),\n                alwaysSet: key in ctx.data,\n            });\n        }\n        if (this._def.catchall instanceof ZodNever) {\n            const unknownKeys = this._def.unknownKeys;\n            if (unknownKeys === \"passthrough\") {\n                for (const key of extraKeys) {\n                    pairs.push({\n                        key: { status: \"valid\", value: key },\n                        value: { status: \"valid\", value: ctx.data[key] },\n                    });\n                }\n            }\n            else if (unknownKeys === \"strict\") {\n                if (extraKeys.length > 0) {\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.unrecognized_keys,\n                        keys: extraKeys,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (unknownKeys === \"strip\") {\n            }\n            else {\n                throw new Error(`Internal ZodObject error: invalid unknownKeys value.`);\n            }\n        }\n        else {\n            // run catchall validation\n            const catchall = this._def.catchall;\n            for (const key of extraKeys) {\n                const value = ctx.data[key];\n                pairs.push({\n                    key: { status: \"valid\", value: key },\n                    value: catchall._parse(new ParseInputLazyPath(ctx, value, ctx.path, key) //, ctx.child(key), value, getParsedType(value)\n                    ),\n                    alwaysSet: key in ctx.data,\n                });\n            }\n        }\n        if (ctx.common.async) {\n            return Promise.resolve()\n                .then(async () => {\n                const syncPairs = [];\n                for (const pair of pairs) {\n                    const key = await pair.key;\n                    const value = await pair.value;\n                    syncPairs.push({\n                        key,\n                        value,\n                        alwaysSet: pair.alwaysSet,\n                    });\n                }\n                return syncPairs;\n            })\n                .then((syncPairs) => {\n                return ParseStatus.mergeObjectSync(status, syncPairs);\n            });\n        }\n        else {\n            return ParseStatus.mergeObjectSync(status, pairs);\n        }\n    }\n    get shape() {\n        return this._def.shape();\n    }\n    strict(message) {\n        errorUtil.errToObj;\n        return new ZodObject({\n            ...this._def,\n            unknownKeys: \"strict\",\n            ...(message !== undefined\n                ? {\n                    errorMap: (issue, ctx) => {\n                        const defaultError = this._def.errorMap?.(issue, ctx).message ?? ctx.defaultError;\n                        if (issue.code === \"unrecognized_keys\")\n                            return {\n                                message: errorUtil.errToObj(message).message ?? defaultError,\n                            };\n                        return {\n                            message: defaultError,\n                        };\n                    },\n                }\n                : {}),\n        });\n    }\n    strip() {\n        return new ZodObject({\n            ...this._def,\n            unknownKeys: \"strip\",\n        });\n    }\n    passthrough() {\n        return new ZodObject({\n            ...this._def,\n            unknownKeys: \"passthrough\",\n        });\n    }\n    // const AugmentFactory =\n    //   <Def extends ZodObjectDef>(def: Def) =>\n    //   <Augmentation extends ZodRawShape>(\n    //     augmentation: Augmentation\n    //   ): ZodObject<\n    //     extendShape<ReturnType<Def[\"shape\"]>, Augmentation>,\n    //     Def[\"unknownKeys\"],\n    //     Def[\"catchall\"]\n    //   > => {\n    //     return new ZodObject({\n    //       ...def,\n    //       shape: () => ({\n    //         ...def.shape(),\n    //         ...augmentation,\n    //       }),\n    //     }) as any;\n    //   };\n    extend(augmentation) {\n        return new ZodObject({\n            ...this._def,\n            shape: () => ({\n                ...this._def.shape(),\n                ...augmentation,\n            }),\n        });\n    }\n    /**\n     * Prior to zod@1.0.12 there was a bug in the\n     * inferred type of merged objects. Please\n     * upgrade if you are experiencing issues.\n     */\n    merge(merging) {\n        const merged = new ZodObject({\n            unknownKeys: merging._def.unknownKeys,\n            catchall: merging._def.catchall,\n            shape: () => ({\n                ...this._def.shape(),\n                ...merging._def.shape(),\n            }),\n            typeName: ZodFirstPartyTypeKind.ZodObject,\n        });\n        return merged;\n    }\n    // merge<\n    //   Incoming extends AnyZodObject,\n    //   Augmentation extends Incoming[\"shape\"],\n    //   NewOutput extends {\n    //     [k in keyof Augmentation | keyof Output]: k extends keyof Augmentation\n    //       ? Augmentation[k][\"_output\"]\n    //       : k extends keyof Output\n    //       ? Output[k]\n    //       : never;\n    //   },\n    //   NewInput extends {\n    //     [k in keyof Augmentation | keyof Input]: k extends keyof Augmentation\n    //       ? Augmentation[k][\"_input\"]\n    //       : k extends keyof Input\n    //       ? Input[k]\n    //       : never;\n    //   }\n    // >(\n    //   merging: Incoming\n    // ): ZodObject<\n    //   extendShape<T, ReturnType<Incoming[\"_def\"][\"shape\"]>>,\n    //   Incoming[\"_def\"][\"unknownKeys\"],\n    //   Incoming[\"_def\"][\"catchall\"],\n    //   NewOutput,\n    //   NewInput\n    // > {\n    //   const merged: any = new ZodObject({\n    //     unknownKeys: merging._def.unknownKeys,\n    //     catchall: merging._def.catchall,\n    //     shape: () =>\n    //       objectUtil.mergeShapes(this._def.shape(), merging._def.shape()),\n    //     typeName: ZodFirstPartyTypeKind.ZodObject,\n    //   }) as any;\n    //   return merged;\n    // }\n    setKey(key, schema) {\n        return this.augment({ [key]: schema });\n    }\n    // merge<Incoming extends AnyZodObject>(\n    //   merging: Incoming\n    // ): //ZodObject<T & Incoming[\"_shape\"], UnknownKeys, Catchall> = (merging) => {\n    // ZodObject<\n    //   extendShape<T, ReturnType<Incoming[\"_def\"][\"shape\"]>>,\n    //   Incoming[\"_def\"][\"unknownKeys\"],\n    //   Incoming[\"_def\"][\"catchall\"]\n    // > {\n    //   // const mergedShape = objectUtil.mergeShapes(\n    //   //   this._def.shape(),\n    //   //   merging._def.shape()\n    //   // );\n    //   const merged: any = new ZodObject({\n    //     unknownKeys: merging._def.unknownKeys,\n    //     catchall: merging._def.catchall,\n    //     shape: () =>\n    //       objectUtil.mergeShapes(this._def.shape(), merging._def.shape()),\n    //     typeName: ZodFirstPartyTypeKind.ZodObject,\n    //   }) as any;\n    //   return merged;\n    // }\n    catchall(index) {\n        return new ZodObject({\n            ...this._def,\n            catchall: index,\n        });\n    }\n    pick(mask) {\n        const shape = {};\n        for (const key of util.objectKeys(mask)) {\n            if (mask[key] && this.shape[key]) {\n                shape[key] = this.shape[key];\n            }\n        }\n        return new ZodObject({\n            ...this._def,\n            shape: () => shape,\n        });\n    }\n    omit(mask) {\n        const shape = {};\n        for (const key of util.objectKeys(this.shape)) {\n            if (!mask[key]) {\n                shape[key] = this.shape[key];\n            }\n        }\n        return new ZodObject({\n            ...this._def,\n            shape: () => shape,\n        });\n    }\n    /**\n     * @deprecated\n     */\n    deepPartial() {\n        return deepPartialify(this);\n    }\n    partial(mask) {\n        const newShape = {};\n        for (const key of util.objectKeys(this.shape)) {\n            const fieldSchema = this.shape[key];\n            if (mask && !mask[key]) {\n                newShape[key] = fieldSchema;\n            }\n            else {\n                newShape[key] = fieldSchema.optional();\n            }\n        }\n        return new ZodObject({\n            ...this._def,\n            shape: () => newShape,\n        });\n    }\n    required(mask) {\n        const newShape = {};\n        for (const key of util.objectKeys(this.shape)) {\n            if (mask && !mask[key]) {\n                newShape[key] = this.shape[key];\n            }\n            else {\n                const fieldSchema = this.shape[key];\n                let newField = fieldSchema;\n                while (newField instanceof ZodOptional) {\n                    newField = newField._def.innerType;\n                }\n                newShape[key] = newField;\n            }\n        }\n        return new ZodObject({\n            ...this._def,\n            shape: () => newShape,\n        });\n    }\n    keyof() {\n        return createZodEnum(util.objectKeys(this.shape));\n    }\n}\nZodObject.create = (shape, params) => {\n    return new ZodObject({\n        shape: () => shape,\n        unknownKeys: \"strip\",\n        catchall: ZodNever.create(),\n        typeName: ZodFirstPartyTypeKind.ZodObject,\n        ...processCreateParams(params),\n    });\n};\nZodObject.strictCreate = (shape, params) => {\n    return new ZodObject({\n        shape: () => shape,\n        unknownKeys: \"strict\",\n        catchall: ZodNever.create(),\n        typeName: ZodFirstPartyTypeKind.ZodObject,\n        ...processCreateParams(params),\n    });\n};\nZodObject.lazycreate = (shape, params) => {\n    return new ZodObject({\n        shape,\n        unknownKeys: \"strip\",\n        catchall: ZodNever.create(),\n        typeName: ZodFirstPartyTypeKind.ZodObject,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodUnion extends ZodType {\n    _parse(input) {\n        const { ctx } = this._processInputParams(input);\n        const options = this._def.options;\n        function handleResults(results) {\n            // return first issue-free validation if it exists\n            for (const result of results) {\n                if (result.result.status === \"valid\") {\n                    return result.result;\n                }\n            }\n            for (const result of results) {\n                if (result.result.status === \"dirty\") {\n                    // add issues from dirty option\n                    ctx.common.issues.push(...result.ctx.common.issues);\n                    return result.result;\n                }\n            }\n            // return invalid\n            const unionErrors = results.map((result) => new ZodError(result.ctx.common.issues));\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_union,\n                unionErrors,\n            });\n            return INVALID;\n        }\n        if (ctx.common.async) {\n            return Promise.all(options.map(async (option) => {\n                const childCtx = {\n                    ...ctx,\n                    common: {\n                        ...ctx.common,\n                        issues: [],\n                    },\n                    parent: null,\n                };\n                return {\n                    result: await option._parseAsync({\n                        data: ctx.data,\n                        path: ctx.path,\n                        parent: childCtx,\n                    }),\n                    ctx: childCtx,\n                };\n            })).then(handleResults);\n        }\n        else {\n            let dirty = undefined;\n            const issues = [];\n            for (const option of options) {\n                const childCtx = {\n                    ...ctx,\n                    common: {\n                        ...ctx.common,\n                        issues: [],\n                    },\n                    parent: null,\n                };\n                const result = option._parseSync({\n                    data: ctx.data,\n                    path: ctx.path,\n                    parent: childCtx,\n                });\n                if (result.status === \"valid\") {\n                    return result;\n                }\n                else if (result.status === \"dirty\" && !dirty) {\n                    dirty = { result, ctx: childCtx };\n                }\n                if (childCtx.common.issues.length) {\n                    issues.push(childCtx.common.issues);\n                }\n            }\n            if (dirty) {\n                ctx.common.issues.push(...dirty.ctx.common.issues);\n                return dirty.result;\n            }\n            const unionErrors = issues.map((issues) => new ZodError(issues));\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_union,\n                unionErrors,\n            });\n            return INVALID;\n        }\n    }\n    get options() {\n        return this._def.options;\n    }\n}\nZodUnion.create = (types, params) => {\n    return new ZodUnion({\n        options: types,\n        typeName: ZodFirstPartyTypeKind.ZodUnion,\n        ...processCreateParams(params),\n    });\n};\n/////////////////////////////////////////////////////\n/////////////////////////////////////////////////////\n//////////                                 //////////\n//////////      ZodDiscriminatedUnion      //////////\n//////////                                 //////////\n/////////////////////////////////////////////////////\n/////////////////////////////////////////////////////\nconst getDiscriminator = (type) => {\n    if (type instanceof ZodLazy) {\n        return getDiscriminator(type.schema);\n    }\n    else if (type instanceof ZodEffects) {\n        return getDiscriminator(type.innerType());\n    }\n    else if (type instanceof ZodLiteral) {\n        return [type.value];\n    }\n    else if (type instanceof ZodEnum) {\n        return type.options;\n    }\n    else if (type instanceof ZodNativeEnum) {\n        // eslint-disable-next-line ban/ban\n        return util.objectValues(type.enum);\n    }\n    else if (type instanceof ZodDefault) {\n        return getDiscriminator(type._def.innerType);\n    }\n    else if (type instanceof ZodUndefined) {\n        return [undefined];\n    }\n    else if (type instanceof ZodNull) {\n        return [null];\n    }\n    else if (type instanceof ZodOptional) {\n        return [undefined, ...getDiscriminator(type.unwrap())];\n    }\n    else if (type instanceof ZodNullable) {\n        return [null, ...getDiscriminator(type.unwrap())];\n    }\n    else if (type instanceof ZodBranded) {\n        return getDiscriminator(type.unwrap());\n    }\n    else if (type instanceof ZodReadonly) {\n        return getDiscriminator(type.unwrap());\n    }\n    else if (type instanceof ZodCatch) {\n        return getDiscriminator(type._def.innerType);\n    }\n    else {\n        return [];\n    }\n};\nexport class ZodDiscriminatedUnion extends ZodType {\n    _parse(input) {\n        const { ctx } = this._processInputParams(input);\n        if (ctx.parsedType !== ZodParsedType.object) {\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.object,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        const discriminator = this.discriminator;\n        const discriminatorValue = ctx.data[discriminator];\n        const option = this.optionsMap.get(discriminatorValue);\n        if (!option) {\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_union_discriminator,\n                options: Array.from(this.optionsMap.keys()),\n                path: [discriminator],\n            });\n            return INVALID;\n        }\n        if (ctx.common.async) {\n            return option._parseAsync({\n                data: ctx.data,\n                path: ctx.path,\n                parent: ctx,\n            });\n        }\n        else {\n            return option._parseSync({\n                data: ctx.data,\n                path: ctx.path,\n                parent: ctx,\n            });\n        }\n    }\n    get discriminator() {\n        return this._def.discriminator;\n    }\n    get options() {\n        return this._def.options;\n    }\n    get optionsMap() {\n        return this._def.optionsMap;\n    }\n    /**\n     * The constructor of the discriminated union schema. Its behaviour is very similar to that of the normal z.union() constructor.\n     * However, it only allows a union of objects, all of which need to share a discriminator property. This property must\n     * have a different value for each object in the union.\n     * @param discriminator the name of the discriminator property\n     * @param types an array of object schemas\n     * @param params\n     */\n    static create(discriminator, options, params) {\n        // Get all the valid discriminator values\n        const optionsMap = new Map();\n        // try {\n        for (const type of options) {\n            const discriminatorValues = getDiscriminator(type.shape[discriminator]);\n            if (!discriminatorValues.length) {\n                throw new Error(`A discriminator value for key \\`${discriminator}\\` could not be extracted from all schema options`);\n            }\n            for (const value of discriminatorValues) {\n                if (optionsMap.has(value)) {\n                    throw new Error(`Discriminator property ${String(discriminator)} has duplicate value ${String(value)}`);\n                }\n                optionsMap.set(value, type);\n            }\n        }\n        return new ZodDiscriminatedUnion({\n            typeName: ZodFirstPartyTypeKind.ZodDiscriminatedUnion,\n            discriminator,\n            options,\n            optionsMap,\n            ...processCreateParams(params),\n        });\n    }\n}\nfunction mergeValues(a, b) {\n    const aType = getParsedType(a);\n    const bType = getParsedType(b);\n    if (a === b) {\n        return { valid: true, data: a };\n    }\n    else if (aType === ZodParsedType.object && bType === ZodParsedType.object) {\n        const bKeys = util.objectKeys(b);\n        const sharedKeys = util.objectKeys(a).filter((key) => bKeys.indexOf(key) !== -1);\n        const newObj = { ...a, ...b };\n        for (const key of sharedKeys) {\n            const sharedValue = mergeValues(a[key], b[key]);\n            if (!sharedValue.valid) {\n                return { valid: false };\n            }\n            newObj[key] = sharedValue.data;\n        }\n        return { valid: true, data: newObj };\n    }\n    else if (aType === ZodParsedType.array && bType === ZodParsedType.array) {\n        if (a.length !== b.length) {\n            return { valid: false };\n        }\n        const newArray = [];\n        for (let index = 0; index < a.length; index++) {\n            const itemA = a[index];\n            const itemB = b[index];\n            const sharedValue = mergeValues(itemA, itemB);\n            if (!sharedValue.valid) {\n                return { valid: false };\n            }\n            newArray.push(sharedValue.data);\n        }\n        return { valid: true, data: newArray };\n    }\n    else if (aType === ZodParsedType.date && bType === ZodParsedType.date && +a === +b) {\n        return { valid: true, data: a };\n    }\n    else {\n        return { valid: false };\n    }\n}\nexport class ZodIntersection extends ZodType {\n    _parse(input) {\n        const { status, ctx } = this._processInputParams(input);\n        const handleParsed = (parsedLeft, parsedRight) => {\n            if (isAborted(parsedLeft) || isAborted(parsedRight)) {\n                return INVALID;\n            }\n            const merged = mergeValues(parsedLeft.value, parsedRight.value);\n            if (!merged.valid) {\n                addIssueToContext(ctx, {\n                    code: ZodIssueCode.invalid_intersection_types,\n                });\n                return INVALID;\n            }\n            if (isDirty(parsedLeft) || isDirty(parsedRight)) {\n                status.dirty();\n            }\n            return { status: status.value, value: merged.data };\n        };\n        if (ctx.common.async) {\n            return Promise.all([\n                this._def.left._parseAsync({\n                    data: ctx.data,\n                    path: ctx.path,\n                    parent: ctx,\n                }),\n                this._def.right._parseAsync({\n                    data: ctx.data,\n                    path: ctx.path,\n                    parent: ctx,\n                }),\n            ]).then(([left, right]) => handleParsed(left, right));\n        }\n        else {\n            return handleParsed(this._def.left._parseSync({\n                data: ctx.data,\n                path: ctx.path,\n                parent: ctx,\n            }), this._def.right._parseSync({\n                data: ctx.data,\n                path: ctx.path,\n                parent: ctx,\n            }));\n        }\n    }\n}\nZodIntersection.create = (left, right, params) => {\n    return new ZodIntersection({\n        left: left,\n        right: right,\n        typeName: ZodFirstPartyTypeKind.ZodIntersection,\n        ...processCreateParams(params),\n    });\n};\n// type ZodTupleItems = [ZodTypeAny, ...ZodTypeAny[]];\nexport class ZodTuple extends ZodType {\n    _parse(input) {\n        const { status, ctx } = this._processInputParams(input);\n        if (ctx.parsedType !== ZodParsedType.array) {\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.array,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        if (ctx.data.length < this._def.items.length) {\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.too_small,\n                minimum: this._def.items.length,\n                inclusive: true,\n                exact: false,\n                type: \"array\",\n            });\n            return INVALID;\n        }\n        const rest = this._def.rest;\n        if (!rest && ctx.data.length > this._def.items.length) {\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.too_big,\n                maximum: this._def.items.length,\n                inclusive: true,\n                exact: false,\n                type: \"array\",\n            });\n            status.dirty();\n        }\n        const items = [...ctx.data]\n            .map((item, itemIndex) => {\n            const schema = this._def.items[itemIndex] || this._def.rest;\n            if (!schema)\n                return null;\n            return schema._parse(new ParseInputLazyPath(ctx, item, ctx.path, itemIndex));\n        })\n            .filter((x) => !!x); // filter nulls\n        if (ctx.common.async) {\n            return Promise.all(items).then((results) => {\n                return ParseStatus.mergeArray(status, results);\n            });\n        }\n        else {\n            return ParseStatus.mergeArray(status, items);\n        }\n    }\n    get items() {\n        return this._def.items;\n    }\n    rest(rest) {\n        return new ZodTuple({\n            ...this._def,\n            rest,\n        });\n    }\n}\nZodTuple.create = (schemas, params) => {\n    if (!Array.isArray(schemas)) {\n        throw new Error(\"You must pass an array of schemas to z.tuple([ ... ])\");\n    }\n    return new ZodTuple({\n        items: schemas,\n        typeName: ZodFirstPartyTypeKind.ZodTuple,\n        rest: null,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodRecord extends ZodType {\n    get keySchema() {\n        return this._def.keyType;\n    }\n    get valueSchema() {\n        return this._def.valueType;\n    }\n    _parse(input) {\n        const { status, ctx } = this._processInputParams(input);\n        if (ctx.parsedType !== ZodParsedType.object) {\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.object,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        const pairs = [];\n        const keyType = this._def.keyType;\n        const valueType = this._def.valueType;\n        for (const key in ctx.data) {\n            pairs.push({\n                key: keyType._parse(new ParseInputLazyPath(ctx, key, ctx.path, key)),\n                value: valueType._parse(new ParseInputLazyPath(ctx, ctx.data[key], ctx.path, key)),\n                alwaysSet: key in ctx.data,\n            });\n        }\n        if (ctx.common.async) {\n            return ParseStatus.mergeObjectAsync(status, pairs);\n        }\n        else {\n            return ParseStatus.mergeObjectSync(status, pairs);\n        }\n    }\n    get element() {\n        return this._def.valueType;\n    }\n    static create(first, second, third) {\n        if (second instanceof ZodType) {\n            return new ZodRecord({\n                keyType: first,\n                valueType: second,\n                typeName: ZodFirstPartyTypeKind.ZodRecord,\n                ...processCreateParams(third),\n            });\n        }\n        return new ZodRecord({\n            keyType: ZodString.create(),\n            valueType: first,\n            typeName: ZodFirstPartyTypeKind.ZodRecord,\n            ...processCreateParams(second),\n        });\n    }\n}\nexport class ZodMap extends ZodType {\n    get keySchema() {\n        return this._def.keyType;\n    }\n    get valueSchema() {\n        return this._def.valueType;\n    }\n    _parse(input) {\n        const { status, ctx } = this._processInputParams(input);\n        if (ctx.parsedType !== ZodParsedType.map) {\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.map,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        const keyType = this._def.keyType;\n        const valueType = this._def.valueType;\n        const pairs = [...ctx.data.entries()].map(([key, value], index) => {\n            return {\n                key: keyType._parse(new ParseInputLazyPath(ctx, key, ctx.path, [index, \"key\"])),\n                value: valueType._parse(new ParseInputLazyPath(ctx, value, ctx.path, [index, \"value\"])),\n            };\n        });\n        if (ctx.common.async) {\n            const finalMap = new Map();\n            return Promise.resolve().then(async () => {\n                for (const pair of pairs) {\n                    const key = await pair.key;\n                    const value = await pair.value;\n                    if (key.status === \"aborted\" || value.status === \"aborted\") {\n                        return INVALID;\n                    }\n                    if (key.status === \"dirty\" || value.status === \"dirty\") {\n                        status.dirty();\n                    }\n                    finalMap.set(key.value, value.value);\n                }\n                return { status: status.value, value: finalMap };\n            });\n        }\n        else {\n            const finalMap = new Map();\n            for (const pair of pairs) {\n                const key = pair.key;\n                const value = pair.value;\n                if (key.status === \"aborted\" || value.status === \"aborted\") {\n                    return INVALID;\n                }\n                if (key.status === \"dirty\" || value.status === \"dirty\") {\n                    status.dirty();\n                }\n                finalMap.set(key.value, value.value);\n            }\n            return { status: status.value, value: finalMap };\n        }\n    }\n}\nZodMap.create = (keyType, valueType, params) => {\n    return new ZodMap({\n        valueType,\n        keyType,\n        typeName: ZodFirstPartyTypeKind.ZodMap,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodSet extends ZodType {\n    _parse(input) {\n        const { status, ctx } = this._processInputParams(input);\n        if (ctx.parsedType !== ZodParsedType.set) {\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.set,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        const def = this._def;\n        if (def.minSize !== null) {\n            if (ctx.data.size < def.minSize.value) {\n                addIssueToContext(ctx, {\n                    code: ZodIssueCode.too_small,\n                    minimum: def.minSize.value,\n                    type: \"set\",\n                    inclusive: true,\n                    exact: false,\n                    message: def.minSize.message,\n                });\n                status.dirty();\n            }\n        }\n        if (def.maxSize !== null) {\n            if (ctx.data.size > def.maxSize.value) {\n                addIssueToContext(ctx, {\n                    code: ZodIssueCode.too_big,\n                    maximum: def.maxSize.value,\n                    type: \"set\",\n                    inclusive: true,\n                    exact: false,\n                    message: def.maxSize.message,\n                });\n                status.dirty();\n            }\n        }\n        const valueType = this._def.valueType;\n        function finalizeSet(elements) {\n            const parsedSet = new Set();\n            for (const element of elements) {\n                if (element.status === \"aborted\")\n                    return INVALID;\n                if (element.status === \"dirty\")\n                    status.dirty();\n                parsedSet.add(element.value);\n            }\n            return { status: status.value, value: parsedSet };\n        }\n        const elements = [...ctx.data.values()].map((item, i) => valueType._parse(new ParseInputLazyPath(ctx, item, ctx.path, i)));\n        if (ctx.common.async) {\n            return Promise.all(elements).then((elements) => finalizeSet(elements));\n        }\n        else {\n            return finalizeSet(elements);\n        }\n    }\n    min(minSize, message) {\n        return new ZodSet({\n            ...this._def,\n            minSize: { value: minSize, message: errorUtil.toString(message) },\n        });\n    }\n    max(maxSize, message) {\n        return new ZodSet({\n            ...this._def,\n            maxSize: { value: maxSize, message: errorUtil.toString(message) },\n        });\n    }\n    size(size, message) {\n        return this.min(size, message).max(size, message);\n    }\n    nonempty(message) {\n        return this.min(1, message);\n    }\n}\nZodSet.create = (valueType, params) => {\n    return new ZodSet({\n        valueType,\n        minSize: null,\n        maxSize: null,\n        typeName: ZodFirstPartyTypeKind.ZodSet,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodFunction extends ZodType {\n    constructor() {\n        super(...arguments);\n        this.validate = this.implement;\n    }\n    _parse(input) {\n        const { ctx } = this._processInputParams(input);\n        if (ctx.parsedType !== ZodParsedType.function) {\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.function,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        function makeArgsIssue(args, error) {\n            return makeIssue({\n                data: args,\n                path: ctx.path,\n                errorMaps: [ctx.common.contextualErrorMap, ctx.schemaErrorMap, getErrorMap(), defaultErrorMap].filter((x) => !!x),\n                issueData: {\n                    code: ZodIssueCode.invalid_arguments,\n                    argumentsError: error,\n                },\n            });\n        }\n        function makeReturnsIssue(returns, error) {\n            return makeIssue({\n                data: returns,\n                path: ctx.path,\n                errorMaps: [ctx.common.contextualErrorMap, ctx.schemaErrorMap, getErrorMap(), defaultErrorMap].filter((x) => !!x),\n                issueData: {\n                    code: ZodIssueCode.invalid_return_type,\n                    returnTypeError: error,\n                },\n            });\n        }\n        const params = { errorMap: ctx.common.contextualErrorMap };\n        const fn = ctx.data;\n        if (this._def.returns instanceof ZodPromise) {\n            // Would love a way to avoid disabling this rule, but we need\n            // an alias (using an arrow function was what caused 2651).\n            // eslint-disable-next-line @typescript-eslint/no-this-alias\n            const me = this;\n            return OK(async function (...args) {\n                const error = new ZodError([]);\n                const parsedArgs = await me._def.args.parseAsync(args, params).catch((e) => {\n                    error.addIssue(makeArgsIssue(args, e));\n                    throw error;\n                });\n                const result = await Reflect.apply(fn, this, parsedArgs);\n                const parsedReturns = await me._def.returns._def.type\n                    .parseAsync(result, params)\n                    .catch((e) => {\n                    error.addIssue(makeReturnsIssue(result, e));\n                    throw error;\n                });\n                return parsedReturns;\n            });\n        }\n        else {\n            // Would love a way to avoid disabling this rule, but we need\n            // an alias (using an arrow function was what caused 2651).\n            // eslint-disable-next-line @typescript-eslint/no-this-alias\n            const me = this;\n            return OK(function (...args) {\n                const parsedArgs = me._def.args.safeParse(args, params);\n                if (!parsedArgs.success) {\n                    throw new ZodError([makeArgsIssue(args, parsedArgs.error)]);\n                }\n                const result = Reflect.apply(fn, this, parsedArgs.data);\n                const parsedReturns = me._def.returns.safeParse(result, params);\n                if (!parsedReturns.success) {\n                    throw new ZodError([makeReturnsIssue(result, parsedReturns.error)]);\n                }\n                return parsedReturns.data;\n            });\n        }\n    }\n    parameters() {\n        return this._def.args;\n    }\n    returnType() {\n        return this._def.returns;\n    }\n    args(...items) {\n        return new ZodFunction({\n            ...this._def,\n            args: ZodTuple.create(items).rest(ZodUnknown.create()),\n        });\n    }\n    returns(returnType) {\n        return new ZodFunction({\n            ...this._def,\n            returns: returnType,\n        });\n    }\n    implement(func) {\n        const validatedFunc = this.parse(func);\n        return validatedFunc;\n    }\n    strictImplement(func) {\n        const validatedFunc = this.parse(func);\n        return validatedFunc;\n    }\n    static create(args, returns, params) {\n        return new ZodFunction({\n            args: (args ? args : ZodTuple.create([]).rest(ZodUnknown.create())),\n            returns: returns || ZodUnknown.create(),\n            typeName: ZodFirstPartyTypeKind.ZodFunction,\n            ...processCreateParams(params),\n        });\n    }\n}\nexport class ZodLazy extends ZodType {\n    get schema() {\n        return this._def.getter();\n    }\n    _parse(input) {\n        const { ctx } = this._processInputParams(input);\n        const lazySchema = this._def.getter();\n        return lazySchema._parse({ data: ctx.data, path: ctx.path, parent: ctx });\n    }\n}\nZodLazy.create = (getter, params) => {\n    return new ZodLazy({\n        getter: getter,\n        typeName: ZodFirstPartyTypeKind.ZodLazy,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodLiteral extends ZodType {\n    _parse(input) {\n        if (input.data !== this._def.value) {\n            const ctx = this._getOrReturnCtx(input);\n            addIssueToContext(ctx, {\n                received: ctx.data,\n                code: ZodIssueCode.invalid_literal,\n                expected: this._def.value,\n            });\n            return INVALID;\n        }\n        return { status: \"valid\", value: input.data };\n    }\n    get value() {\n        return this._def.value;\n    }\n}\nZodLiteral.create = (value, params) => {\n    return new ZodLiteral({\n        value: value,\n        typeName: ZodFirstPartyTypeKind.ZodLiteral,\n        ...processCreateParams(params),\n    });\n};\nfunction createZodEnum(values, params) {\n    return new ZodEnum({\n        values,\n        typeName: ZodFirstPartyTypeKind.ZodEnum,\n        ...processCreateParams(params),\n    });\n}\nexport class ZodEnum extends ZodType {\n    _parse(input) {\n        if (typeof input.data !== \"string\") {\n            const ctx = this._getOrReturnCtx(input);\n            const expectedValues = this._def.values;\n            addIssueToContext(ctx, {\n                expected: util.joinValues(expectedValues),\n                received: ctx.parsedType,\n                code: ZodIssueCode.invalid_type,\n            });\n            return INVALID;\n        }\n        if (!this._cache) {\n            this._cache = new Set(this._def.values);\n        }\n        if (!this._cache.has(input.data)) {\n            const ctx = this._getOrReturnCtx(input);\n            const expectedValues = this._def.values;\n            addIssueToContext(ctx, {\n                received: ctx.data,\n                code: ZodIssueCode.invalid_enum_value,\n                options: expectedValues,\n            });\n            return INVALID;\n        }\n        return OK(input.data);\n    }\n    get options() {\n        return this._def.values;\n    }\n    get enum() {\n        const enumValues = {};\n        for (const val of this._def.values) {\n            enumValues[val] = val;\n        }\n        return enumValues;\n    }\n    get Values() {\n        const enumValues = {};\n        for (const val of this._def.values) {\n            enumValues[val] = val;\n        }\n        return enumValues;\n    }\n    get Enum() {\n        const enumValues = {};\n        for (const val of this._def.values) {\n            enumValues[val] = val;\n        }\n        return enumValues;\n    }\n    extract(values, newDef = this._def) {\n        return ZodEnum.create(values, {\n            ...this._def,\n            ...newDef,\n        });\n    }\n    exclude(values, newDef = this._def) {\n        return ZodEnum.create(this.options.filter((opt) => !values.includes(opt)), {\n            ...this._def,\n            ...newDef,\n        });\n    }\n}\nZodEnum.create = createZodEnum;\nexport class ZodNativeEnum extends ZodType {\n    _parse(input) {\n        const nativeEnumValues = util.getValidEnumValues(this._def.values);\n        const ctx = this._getOrReturnCtx(input);\n        if (ctx.parsedType !== ZodParsedType.string && ctx.parsedType !== ZodParsedType.number) {\n            const expectedValues = util.objectValues(nativeEnumValues);\n            addIssueToContext(ctx, {\n                expected: util.joinValues(expectedValues),\n                received: ctx.parsedType,\n                code: ZodIssueCode.invalid_type,\n            });\n            return INVALID;\n        }\n        if (!this._cache) {\n            this._cache = new Set(util.getValidEnumValues(this._def.values));\n        }\n        if (!this._cache.has(input.data)) {\n            const expectedValues = util.objectValues(nativeEnumValues);\n            addIssueToContext(ctx, {\n                received: ctx.data,\n                code: ZodIssueCode.invalid_enum_value,\n                options: expectedValues,\n            });\n            return INVALID;\n        }\n        return OK(input.data);\n    }\n    get enum() {\n        return this._def.values;\n    }\n}\nZodNativeEnum.create = (values, params) => {\n    return new ZodNativeEnum({\n        values: values,\n        typeName: ZodFirstPartyTypeKind.ZodNativeEnum,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodPromise extends ZodType {\n    unwrap() {\n        return this._def.type;\n    }\n    _parse(input) {\n        const { ctx } = this._processInputParams(input);\n        if (ctx.parsedType !== ZodParsedType.promise && ctx.common.async === false) {\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.promise,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        const promisified = ctx.parsedType === ZodParsedType.promise ? ctx.data : Promise.resolve(ctx.data);\n        return OK(promisified.then((data) => {\n            return this._def.type.parseAsync(data, {\n                path: ctx.path,\n                errorMap: ctx.common.contextualErrorMap,\n            });\n        }));\n    }\n}\nZodPromise.create = (schema, params) => {\n    return new ZodPromise({\n        type: schema,\n        typeName: ZodFirstPartyTypeKind.ZodPromise,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodEffects extends ZodType {\n    innerType() {\n        return this._def.schema;\n    }\n    sourceType() {\n        return this._def.schema._def.typeName === ZodFirstPartyTypeKind.ZodEffects\n            ? this._def.schema.sourceType()\n            : this._def.schema;\n    }\n    _parse(input) {\n        const { status, ctx } = this._processInputParams(input);\n        const effect = this._def.effect || null;\n        const checkCtx = {\n            addIssue: (arg) => {\n                addIssueToContext(ctx, arg);\n                if (arg.fatal) {\n                    status.abort();\n                }\n                else {\n                    status.dirty();\n                }\n            },\n            get path() {\n                return ctx.path;\n            },\n        };\n        checkCtx.addIssue = checkCtx.addIssue.bind(checkCtx);\n        if (effect.type === \"preprocess\") {\n            const processed = effect.transform(ctx.data, checkCtx);\n            if (ctx.common.async) {\n                return Promise.resolve(processed).then(async (processed) => {\n                    if (status.value === \"aborted\")\n                        return INVALID;\n                    const result = await this._def.schema._parseAsync({\n                        data: processed,\n                        path: ctx.path,\n                        parent: ctx,\n                    });\n                    if (result.status === \"aborted\")\n                        return INVALID;\n                    if (result.status === \"dirty\")\n                        return DIRTY(result.value);\n                    if (status.value === \"dirty\")\n                        return DIRTY(result.value);\n                    return result;\n                });\n            }\n            else {\n                if (status.value === \"aborted\")\n                    return INVALID;\n                const result = this._def.schema._parseSync({\n                    data: processed,\n                    path: ctx.path,\n                    parent: ctx,\n                });\n                if (result.status === \"aborted\")\n                    return INVALID;\n                if (result.status === \"dirty\")\n                    return DIRTY(result.value);\n                if (status.value === \"dirty\")\n                    return DIRTY(result.value);\n                return result;\n            }\n        }\n        if (effect.type === \"refinement\") {\n            const executeRefinement = (acc) => {\n                const result = effect.refinement(acc, checkCtx);\n                if (ctx.common.async) {\n                    return Promise.resolve(result);\n                }\n                if (result instanceof Promise) {\n                    throw new Error(\"Async refinement encountered during synchronous parse operation. Use .parseAsync instead.\");\n                }\n                return acc;\n            };\n            if (ctx.common.async === false) {\n                const inner = this._def.schema._parseSync({\n                    data: ctx.data,\n                    path: ctx.path,\n                    parent: ctx,\n                });\n                if (inner.status === \"aborted\")\n                    return INVALID;\n                if (inner.status === \"dirty\")\n                    status.dirty();\n                // return value is ignored\n                executeRefinement(inner.value);\n                return { status: status.value, value: inner.value };\n            }\n            else {\n                return this._def.schema._parseAsync({ data: ctx.data, path: ctx.path, parent: ctx }).then((inner) => {\n                    if (inner.status === \"aborted\")\n                        return INVALID;\n                    if (inner.status === \"dirty\")\n                        status.dirty();\n                    return executeRefinement(inner.value).then(() => {\n                        return { status: status.value, value: inner.value };\n                    });\n                });\n            }\n        }\n        if (effect.type === \"transform\") {\n            if (ctx.common.async === false) {\n                const base = this._def.schema._parseSync({\n                    data: ctx.data,\n                    path: ctx.path,\n                    parent: ctx,\n                });\n                if (!isValid(base))\n                    return INVALID;\n                const result = effect.transform(base.value, checkCtx);\n                if (result instanceof Promise) {\n                    throw new Error(`Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.`);\n                }\n                return { status: status.value, value: result };\n            }\n            else {\n                return this._def.schema._parseAsync({ data: ctx.data, path: ctx.path, parent: ctx }).then((base) => {\n                    if (!isValid(base))\n                        return INVALID;\n                    return Promise.resolve(effect.transform(base.value, checkCtx)).then((result) => ({\n                        status: status.value,\n                        value: result,\n                    }));\n                });\n            }\n        }\n        util.assertNever(effect);\n    }\n}\nZodEffects.create = (schema, effect, params) => {\n    return new ZodEffects({\n        schema,\n        typeName: ZodFirstPartyTypeKind.ZodEffects,\n        effect,\n        ...processCreateParams(params),\n    });\n};\nZodEffects.createWithPreprocess = (preprocess, schema, params) => {\n    return new ZodEffects({\n        schema,\n        effect: { type: \"preprocess\", transform: preprocess },\n        typeName: ZodFirstPartyTypeKind.ZodEffects,\n        ...processCreateParams(params),\n    });\n};\nexport { ZodEffects as ZodTransformer };\nexport class ZodOptional extends ZodType {\n    _parse(input) {\n        const parsedType = this._getType(input);\n        if (parsedType === ZodParsedType.undefined) {\n            return OK(undefined);\n        }\n        return this._def.innerType._parse(input);\n    }\n    unwrap() {\n        return this._def.innerType;\n    }\n}\nZodOptional.create = (type, params) => {\n    return new ZodOptional({\n        innerType: type,\n        typeName: ZodFirstPartyTypeKind.ZodOptional,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodNullable extends ZodType {\n    _parse(input) {\n        const parsedType = this._getType(input);\n        if (parsedType === ZodParsedType.null) {\n            return OK(null);\n        }\n        return this._def.innerType._parse(input);\n    }\n    unwrap() {\n        return this._def.innerType;\n    }\n}\nZodNullable.create = (type, params) => {\n    return new ZodNullable({\n        innerType: type,\n        typeName: ZodFirstPartyTypeKind.ZodNullable,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodDefault extends ZodType {\n    _parse(input) {\n        const { ctx } = this._processInputParams(input);\n        let data = ctx.data;\n        if (ctx.parsedType === ZodParsedType.undefined) {\n            data = this._def.defaultValue();\n        }\n        return this._def.innerType._parse({\n            data,\n            path: ctx.path,\n            parent: ctx,\n        });\n    }\n    removeDefault() {\n        return this._def.innerType;\n    }\n}\nZodDefault.create = (type, params) => {\n    return new ZodDefault({\n        innerType: type,\n        typeName: ZodFirstPartyTypeKind.ZodDefault,\n        defaultValue: typeof params.default === \"function\" ? params.default : () => params.default,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodCatch extends ZodType {\n    _parse(input) {\n        const { ctx } = this._processInputParams(input);\n        // newCtx is used to not collect issues from inner types in ctx\n        const newCtx = {\n            ...ctx,\n            common: {\n                ...ctx.common,\n                issues: [],\n            },\n        };\n        const result = this._def.innerType._parse({\n            data: newCtx.data,\n            path: newCtx.path,\n            parent: {\n                ...newCtx,\n            },\n        });\n        if (isAsync(result)) {\n            return result.then((result) => {\n                return {\n                    status: \"valid\",\n                    value: result.status === \"valid\"\n                        ? result.value\n                        : this._def.catchValue({\n                            get error() {\n                                return new ZodError(newCtx.common.issues);\n                            },\n                            input: newCtx.data,\n                        }),\n                };\n            });\n        }\n        else {\n            return {\n                status: \"valid\",\n                value: result.status === \"valid\"\n                    ? result.value\n                    : this._def.catchValue({\n                        get error() {\n                            return new ZodError(newCtx.common.issues);\n                        },\n                        input: newCtx.data,\n                    }),\n            };\n        }\n    }\n    removeCatch() {\n        return this._def.innerType;\n    }\n}\nZodCatch.create = (type, params) => {\n    return new ZodCatch({\n        innerType: type,\n        typeName: ZodFirstPartyTypeKind.ZodCatch,\n        catchValue: typeof params.catch === \"function\" ? params.catch : () => params.catch,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodNaN extends ZodType {\n    _parse(input) {\n        const parsedType = this._getType(input);\n        if (parsedType !== ZodParsedType.nan) {\n            const ctx = this._getOrReturnCtx(input);\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.nan,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        return { status: \"valid\", value: input.data };\n    }\n}\nZodNaN.create = (params) => {\n    return new ZodNaN({\n        typeName: ZodFirstPartyTypeKind.ZodNaN,\n        ...processCreateParams(params),\n    });\n};\nexport const BRAND = Symbol(\"zod_brand\");\nexport class ZodBranded extends ZodType {\n    _parse(input) {\n        const { ctx } = this._processInputParams(input);\n        const data = ctx.data;\n        return this._def.type._parse({\n            data,\n            path: ctx.path,\n            parent: ctx,\n        });\n    }\n    unwrap() {\n        return this._def.type;\n    }\n}\nexport class ZodPipeline extends ZodType {\n    _parse(input) {\n        const { status, ctx } = this._processInputParams(input);\n        if (ctx.common.async) {\n            const handleAsync = async () => {\n                const inResult = await this._def.in._parseAsync({\n                    data: ctx.data,\n                    path: ctx.path,\n                    parent: ctx,\n                });\n                if (inResult.status === \"aborted\")\n                    return INVALID;\n                if (inResult.status === \"dirty\") {\n                    status.dirty();\n                    return DIRTY(inResult.value);\n                }\n                else {\n                    return this._def.out._parseAsync({\n                        data: inResult.value,\n                        path: ctx.path,\n                        parent: ctx,\n                    });\n                }\n            };\n            return handleAsync();\n        }\n        else {\n            const inResult = this._def.in._parseSync({\n                data: ctx.data,\n                path: ctx.path,\n                parent: ctx,\n            });\n            if (inResult.status === \"aborted\")\n                return INVALID;\n            if (inResult.status === \"dirty\") {\n                status.dirty();\n                return {\n                    status: \"dirty\",\n                    value: inResult.value,\n                };\n            }\n            else {\n                return this._def.out._parseSync({\n                    data: inResult.value,\n                    path: ctx.path,\n                    parent: ctx,\n                });\n            }\n        }\n    }\n    static create(a, b) {\n        return new ZodPipeline({\n            in: a,\n            out: b,\n            typeName: ZodFirstPartyTypeKind.ZodPipeline,\n        });\n    }\n}\nexport class ZodReadonly extends ZodType {\n    _parse(input) {\n        const result = this._def.innerType._parse(input);\n        const freeze = (data) => {\n            if (isValid(data)) {\n                data.value = Object.freeze(data.value);\n            }\n            return data;\n        };\n        return isAsync(result) ? result.then((data) => freeze(data)) : freeze(result);\n    }\n    unwrap() {\n        return this._def.innerType;\n    }\n}\nZodReadonly.create = (type, params) => {\n    return new ZodReadonly({\n        innerType: type,\n        typeName: ZodFirstPartyTypeKind.ZodReadonly,\n        ...processCreateParams(params),\n    });\n};\n////////////////////////////////////////\n////////////////////////////////////////\n//////////                    //////////\n//////////      z.custom      //////////\n//////////                    //////////\n////////////////////////////////////////\n////////////////////////////////////////\nfunction cleanParams(params, data) {\n    const p = typeof params === \"function\" ? params(data) : typeof params === \"string\" ? { message: params } : params;\n    const p2 = typeof p === \"string\" ? { message: p } : p;\n    return p2;\n}\nexport function custom(check, _params = {}, \n/**\n * @deprecated\n *\n * Pass `fatal` into the params object instead:\n *\n * ```ts\n * z.string().custom((val) => val.length > 5, { fatal: false })\n * ```\n *\n */\nfatal) {\n    if (check)\n        return ZodAny.create().superRefine((data, ctx) => {\n            const r = check(data);\n            if (r instanceof Promise) {\n                return r.then((r) => {\n                    if (!r) {\n                        const params = cleanParams(_params, data);\n                        const _fatal = params.fatal ?? fatal ?? true;\n                        ctx.addIssue({ code: \"custom\", ...params, fatal: _fatal });\n                    }\n                });\n            }\n            if (!r) {\n                const params = cleanParams(_params, data);\n                const _fatal = params.fatal ?? fatal ?? true;\n                ctx.addIssue({ code: \"custom\", ...params, fatal: _fatal });\n            }\n            return;\n        });\n    return ZodAny.create();\n}\nexport { ZodType as Schema, ZodType as ZodSchema };\nexport const late = {\n    object: ZodObject.lazycreate,\n};\nexport var ZodFirstPartyTypeKind;\n(function (ZodFirstPartyTypeKind) {\n    ZodFirstPartyTypeKind[\"ZodString\"] = \"ZodString\";\n    ZodFirstPartyTypeKind[\"ZodNumber\"] = \"ZodNumber\";\n    ZodFirstPartyTypeKind[\"ZodNaN\"] = \"ZodNaN\";\n    ZodFirstPartyTypeKind[\"ZodBigInt\"] = \"ZodBigInt\";\n    ZodFirstPartyTypeKind[\"ZodBoolean\"] = \"ZodBoolean\";\n    ZodFirstPartyTypeKind[\"ZodDate\"] = \"ZodDate\";\n    ZodFirstPartyTypeKind[\"ZodSymbol\"] = \"ZodSymbol\";\n    ZodFirstPartyTypeKind[\"ZodUndefined\"] = \"ZodUndefined\";\n    ZodFirstPartyTypeKind[\"ZodNull\"] = \"ZodNull\";\n    ZodFirstPartyTypeKind[\"ZodAny\"] = \"ZodAny\";\n    ZodFirstPartyTypeKind[\"ZodUnknown\"] = \"ZodUnknown\";\n    ZodFirstPartyTypeKind[\"ZodNever\"] = \"ZodNever\";\n    ZodFirstPartyTypeKind[\"ZodVoid\"] = \"ZodVoid\";\n    ZodFirstPartyTypeKind[\"ZodArray\"] = \"ZodArray\";\n    ZodFirstPartyTypeKind[\"ZodObject\"] = \"ZodObject\";\n    ZodFirstPartyTypeKind[\"ZodUnion\"] = \"ZodUnion\";\n    ZodFirstPartyTypeKind[\"ZodDiscriminatedUnion\"] = \"ZodDiscriminatedUnion\";\n    ZodFirstPartyTypeKind[\"ZodIntersection\"] = \"ZodIntersection\";\n    ZodFirstPartyTypeKind[\"ZodTuple\"] = \"ZodTuple\";\n    ZodFirstPartyTypeKind[\"ZodRecord\"] = \"ZodRecord\";\n    ZodFirstPartyTypeKind[\"ZodMap\"] = \"ZodMap\";\n    ZodFirstPartyTypeKind[\"ZodSet\"] = \"ZodSet\";\n    ZodFirstPartyTypeKind[\"ZodFunction\"] = \"ZodFunction\";\n    ZodFirstPartyTypeKind[\"ZodLazy\"] = \"ZodLazy\";\n    ZodFirstPartyTypeKind[\"ZodLiteral\"] = \"ZodLiteral\";\n    ZodFirstPartyTypeKind[\"ZodEnum\"] = \"ZodEnum\";\n    ZodFirstPartyTypeKind[\"ZodEffects\"] = \"ZodEffects\";\n    ZodFirstPartyTypeKind[\"ZodNativeEnum\"] = \"ZodNativeEnum\";\n    ZodFirstPartyTypeKind[\"ZodOptional\"] = \"ZodOptional\";\n    ZodFirstPartyTypeKind[\"ZodNullable\"] = \"ZodNullable\";\n    ZodFirstPartyTypeKind[\"ZodDefault\"] = \"ZodDefault\";\n    ZodFirstPartyTypeKind[\"ZodCatch\"] = \"ZodCatch\";\n    ZodFirstPartyTypeKind[\"ZodPromise\"] = \"ZodPromise\";\n    ZodFirstPartyTypeKind[\"ZodBranded\"] = \"ZodBranded\";\n    ZodFirstPartyTypeKind[\"ZodPipeline\"] = \"ZodPipeline\";\n    ZodFirstPartyTypeKind[\"ZodReadonly\"] = \"ZodReadonly\";\n})(ZodFirstPartyTypeKind || (ZodFirstPartyTypeKind = {}));\n// requires TS 4.4+\nclass Class {\n    constructor(..._) { }\n}\nconst instanceOfType = (\n// const instanceOfType = <T extends new (...args: any[]) => any>(\ncls, params = {\n    message: `Input not instance of ${cls.name}`,\n}) => custom((data) => data instanceof cls, params);\nconst stringType = ZodString.create;\nconst numberType = ZodNumber.create;\nconst nanType = ZodNaN.create;\nconst bigIntType = ZodBigInt.create;\nconst booleanType = ZodBoolean.create;\nconst dateType = ZodDate.create;\nconst symbolType = ZodSymbol.create;\nconst undefinedType = ZodUndefined.create;\nconst nullType = ZodNull.create;\nconst anyType = ZodAny.create;\nconst unknownType = ZodUnknown.create;\nconst neverType = ZodNever.create;\nconst voidType = ZodVoid.create;\nconst arrayType = ZodArray.create;\nconst objectType = ZodObject.create;\nconst strictObjectType = ZodObject.strictCreate;\nconst unionType = ZodUnion.create;\nconst discriminatedUnionType = ZodDiscriminatedUnion.create;\nconst intersectionType = ZodIntersection.create;\nconst tupleType = ZodTuple.create;\nconst recordType = ZodRecord.create;\nconst mapType = ZodMap.create;\nconst setType = ZodSet.create;\nconst functionType = ZodFunction.create;\nconst lazyType = ZodLazy.create;\nconst literalType = ZodLiteral.create;\nconst enumType = ZodEnum.create;\nconst nativeEnumType = ZodNativeEnum.create;\nconst promiseType = ZodPromise.create;\nconst effectsType = ZodEffects.create;\nconst optionalType = ZodOptional.create;\nconst nullableType = ZodNullable.create;\nconst preprocessType = ZodEffects.createWithPreprocess;\nconst pipelineType = ZodPipeline.create;\nconst ostring = () => stringType().optional();\nconst onumber = () => numberType().optional();\nconst oboolean = () => booleanType().optional();\nexport const coerce = {\n    string: ((arg) => ZodString.create({ ...arg, coerce: true })),\n    number: ((arg) => ZodNumber.create({ ...arg, coerce: true })),\n    boolean: ((arg) => ZodBoolean.create({\n        ...arg,\n        coerce: true,\n    })),\n    bigint: ((arg) => ZodBigInt.create({ ...arg, coerce: true })),\n    date: ((arg) => ZodDate.create({ ...arg, coerce: true })),\n};\nexport { anyType as any, arrayType as array, bigIntType as bigint, booleanType as boolean, dateType as date, discriminatedUnionType as discriminatedUnion, effectsType as effect, enumType as enum, functionType as function, instanceOfType as instanceof, intersectionType as intersection, lazyType as lazy, literalType as literal, mapType as map, nanType as nan, nativeEnumType as nativeEnum, neverType as never, nullType as null, nullableType as nullable, numberType as number, objectType as object, oboolean, onumber, optionalType as optional, ostring, pipelineType as pipeline, preprocessType as preprocess, promiseType as promise, recordType as record, setType as set, strictObjectType as strictObject, stringType as string, symbolType as symbol, effectsType as transformer, tupleType as tuple, undefinedType as undefined, unionType as union, unknownType as unknown, voidType as void, };\nexport const NEVER = INVALID;\n","/**\n * Template Filters\n *\n * Provides safe, predefined transformations for template interpolations.\n * Inspired by Liquid/Jinja2/Handlebars filter syntax.\n *\n * Syntax: ${input.text | filter1 | filter2}\n */\n\nexport type FilterFunction = (value: any, ...args: any[]) => any\n\n/**\n * Built-in filters registry\n */\nexport const filters: Record<string, FilterFunction> = {\n  // String filters\n  uppercase: (str: string) => String(str).toUpperCase(),\n  lowercase: (str: string) => String(str).toLowerCase(),\n  capitalize: (str: string) => {\n    const s = String(str)\n    return s.charAt(0).toUpperCase() + s.slice(1).toLowerCase()\n  },\n  trim: (str: string) => String(str).trim(),\n\n  // Array/String filters\n  split: (str: string, delimiter: string = ' ') => String(str).split(delimiter),\n  join: (arr: any[], delimiter: string = ', ') => arr.join(delimiter),\n  length: (value: string | any[]) => {\n    if (typeof value === 'string') return value.length\n    if (Array.isArray(value)) return value.length\n    return 0\n  },\n\n  // Array filters\n  first: (arr: any[]) => (Array.isArray(arr) && arr.length > 0 ? arr[0] : undefined),\n  last: (arr: any[]) => (Array.isArray(arr) && arr.length > 0 ? arr[arr.length - 1] : undefined),\n  slice: (arr: any[], start: number, end?: number) =>\n    Array.isArray(arr) ? arr.slice(start, end) : [],\n  reverse: (arr: any[]) => (Array.isArray(arr) ? [...arr].reverse() : []),\n  sort: (arr: any[]) => (Array.isArray(arr) ? [...arr].sort() : []),\n\n  // Number filters\n  abs: (num: number) => Math.abs(Number(num)),\n  round: (num: number) => Math.round(Number(num)),\n  floor: (num: number) => Math.floor(Number(num)),\n  ceil: (num: number) => Math.ceil(Number(num)),\n\n  // Type conversion\n  string: (value: any) => String(value),\n  number: (value: any) => Number(value),\n  boolean: (value: any) => Boolean(value),\n\n  // Object filters\n  keys: (obj: any) => (typeof obj === 'object' && obj !== null ? Object.keys(obj) : []),\n  values: (obj: any) => (typeof obj === 'object' && obj !== null ? Object.values(obj) : []),\n\n  // Utility filters\n  default: (value: any, defaultValue: any) =>\n    value !== undefined && value !== null ? value : defaultValue,\n  json: (value: any) => JSON.stringify(value),\n}\n\n/**\n * Apply a chain of filters to a value\n *\n * @param value - Initial value\n * @param filterChain - Array of filter expressions (e.g., ['split(\" \")', 'length'])\n * @returns Transformed value\n */\nexport function applyFilters(value: any, filterChain: string[]): any {\n  let result = value\n\n  for (const filterExpr of filterChain) {\n    // Parse filter name and arguments\n    // Support: \"filterName\" or \"filterName(arg1, arg2)\"\n    const match = filterExpr.match(/^(\\w+)(?:\\((.*)\\))?$/)\n\n    if (!match) {\n      throw new Error(`Invalid filter syntax: ${filterExpr}`)\n    }\n\n    const [, filterName, argsStr] = match\n    const filter = filters[filterName]\n\n    if (!filter) {\n      throw new Error(`Unknown filter: ${filterName}`)\n    }\n\n    // Parse arguments if present\n    const args: any[] = []\n    if (argsStr) {\n      // Simple argument parsing (handles strings, numbers, booleans)\n      // Match: quoted strings (with quotes) OR non-comma/non-whitespace sequences\n      const argMatches = argsStr.match(/\"[^\"]*\"|'[^']*'|[^,\\s]+/g) || []\n      for (const arg of argMatches) {\n        const trimmed = arg.trim()\n\n        // String literal\n        if (\n          (trimmed.startsWith('\"') && trimmed.endsWith('\"')) ||\n          (trimmed.startsWith(\"'\") && trimmed.endsWith(\"'\"))\n        ) {\n          args.push(trimmed.slice(1, -1))\n        }\n        // Number\n        else if (!isNaN(Number(trimmed))) {\n          args.push(Number(trimmed))\n        }\n        // Boolean\n        else if (trimmed === 'true' || trimmed === 'false') {\n          args.push(trimmed === 'true')\n        }\n        // Keep as string\n        else {\n          args.push(trimmed)\n        }\n      }\n    }\n\n    // Apply filter\n    result = filter(result, ...args)\n  }\n\n  return result\n}\n\n/**\n * Register a custom filter\n */\nexport function registerFilter(name: string, fn: FilterFunction): void {\n  filters[name] = fn\n}\n","/**\n * Interpolation Resolver System\n *\n * Chain of responsibility pattern for resolving template values.\n * Each resolver handles a specific type of interpolation.\n */\n\n/**\n * Path segment representation for optional chaining support\n */\ninterface PathSegment {\n  name: string\n  optional: boolean\n  arrayIndex?: number\n}\n\n/**\n * Resolution context containing available values\n */\nexport interface ResolutionContext {\n  [key: string]: unknown\n}\n\n/**\n * Interpolation Resolver interface\n * Each resolver decides if it can handle the template, then resolves it\n */\nexport interface InterpolationResolver {\n  /**\n   * Check if this resolver can handle the template\n   */\n  canResolve(template: unknown): boolean\n\n  /**\n   * Resolve the template to its final value\n   */\n  resolve(\n    template: unknown,\n    context: ResolutionContext,\n    interpolate: (t: unknown, c: ResolutionContext) => unknown\n  ): unknown\n}\n\nimport { applyFilters } from './filters.js'\n\n/**\n * Resolves string interpolations supporting two syntaxes:\n * - YAML syntax: ${input.x}, ${state.y} - used in YAML configuration files\n * - Template syntax: {{input.x}}, {{state.y}} - used in Handlebars/Liquid templates\n *\n * Supports both full replacement and partial interpolation:\n * - Full: '${input.name}' or '{{input.name}}'  returns value as-is (any type)\n * - Partial: 'Hello ${input.name}!' or 'Hello {{input.name}}!'  returns interpolated string\n *\n * Supports optional chaining (?.):\n * - ${input.user?.name}  returns undefined if user is null/undefined, else name\n * - ${input.data?.items?.[0]}  safe navigation through nested optional paths\n *\n * Supports nullish coalescing (??):\n * - ${input.name ?? \"default\"}  returns input.name if not null/undefined, else \"default\"\n * - ${input.query.name ?? input.body.name ?? \"World\"}  chain of fallbacks\n *\n * Supports falsy coalescing (||):\n * - ${input.name || \"default\"}  returns input.name if truthy, else \"default\"\n * - Catches \"\", 0, false, null, undefined (unlike ?? which only catches null/undefined)\n *\n * Supports ternary conditionals with comparison operators:\n * - ${input.enabled ? \"yes\" : \"no\"}  returns \"yes\" if truthy, \"no\" otherwise\n * - ${input.path == '/docs' ? \"landing\" : \"other\"}  equality comparison in condition\n * - ${input.count > 10 ? \"many\" : \"few\"}  numeric comparison in condition\n * - ${input.name != null && input.age >= 18 ? \"valid\" : \"invalid\"}  logical AND with comparisons\n *\n * Supports comparison operators in ternary conditions:\n * - == and != (loose equality)\n * - === and !== (strict equality)\n * - >, <, >=, <= (numeric comparison)\n * - && and || (logical AND/OR)\n *\n * Supports string method calls in conditions:\n * - ${input.path.includes('/api/') ? \"api\" : \"other\"}  string includes check\n * - ${input.url.startsWith('https') ? \"secure\" : \"insecure\"}  string prefix check\n * - ${input.file.endsWith('.json') ? \"json\" : \"other\"}  string suffix check\n *\n * Supports boolean negation (!):\n * - ${!input.disabled}  returns true if input.disabled is falsy\n *\n * Supports array indexing:\n * - ${input.items[0]}  returns first element\n * - ${input.items[2].name}  returns name property of third element\n * - ${input.items?.[0]}  optional array access (returns undefined if items is null/undefined)\n *\n * Supports filter chains:\n * - ${input.text | uppercase}\n * - ${input.text | split(\" \") | length}\n * - ${input.items | first | default(\"none\")}\n */\nexport class StringResolver implements InterpolationResolver {\n  private readonly fullPatternDollar = /^\\$\\{([^}]*)\\}$/ // YAML: ${...}\n  private readonly fullPatternHandlebar = /^\\{\\{([^}]*)\\}\\}$/ // Templates: {{...}}\n  private readonly hasInterpolationPattern = /(\\$\\{[^}]*\\}|\\{\\{[^}]*\\}\\})/ // Either syntax\n\n  canResolve(template: unknown): boolean {\n    if (typeof template !== 'string') return false\n    return (\n      this.fullPatternDollar.test(template) ||\n      this.fullPatternHandlebar.test(template) ||\n      this.hasInterpolationPattern.test(template)\n    )\n  }\n\n  resolve(\n    template: string,\n    context: ResolutionContext,\n    interpolate: (t: unknown, c: ResolutionContext) => unknown\n  ): unknown {\n    // Case 1: Full replacement - entire string is ${...} or {{...}}\n    // Returns the value as-is (could be any type)\n    const dollarMatch = template.match(this.fullPatternDollar)\n    const handlebarMatch = template.match(this.fullPatternHandlebar)\n    const fullMatch = dollarMatch || handlebarMatch\n\n    if (fullMatch) {\n      const path = fullMatch[1].trim()\n\n      // Handle empty path\n      if (!path) {\n        return undefined\n      }\n\n      return this.traversePath(path, context)\n    }\n\n    // Case 2: Partial interpolation - string contains ${...} or {{...}}\n    // Returns a string with all interpolations replaced\n    const result = template.replace(\n      /(\\$\\{([^}]*)\\}|\\{\\{([^}]*)\\}\\})/g,\n      (match, _full, dollarPath, handlebarPath) => {\n        const path = dollarPath !== undefined ? dollarPath : handlebarPath\n        const trimmedPath = path.trim()\n\n        // Empty path becomes empty string\n        if (!trimmedPath) {\n          return ''\n        }\n\n        const value = this.traversePath(trimmedPath, context)\n\n        // If value is undefined, keep original ${...} or {{...}} in string\n        // Otherwise convert value to string\n        return value !== undefined ? String(value) : match\n      }\n    )\n\n    return result\n  }\n\n  /**\n   * Traverse context using dot-separated path with optional operators and filter chain\n   * Supports (in order of precedence):\n   * - input.enabled ? \"yes\" : \"no\" (ternary conditional)\n   * - input.path == '/docs' ? \"landing\" : \"other\" (ternary with equality comparison)\n   * - input.name ?? \"default\" (nullish coalescing - null/undefined only)\n   * - input.name || \"default\" (falsy coalescing - catches \"\", 0, false too)\n   * - input.text | split(' ') | length (filters)\n   * Note: We check for single pipe (filter) vs double pipe (|| logical OR)\n   */\n  private traversePath(path: string, context: ResolutionContext): unknown {\n    // First, handle ternary conditional (? :)\n    // Match: condition ? trueValue : falseValue\n    // Use negative lookbehind to NOT match ?. (optional chaining)\n    // The ? must be followed by a space or non-dot character to be a ternary operator\n    const ternaryMatch = path.match(/^(.+?)\\s*\\?(?!\\.)\\s*(.+?)\\s*:\\s*(.+)$/)\n    if (ternaryMatch) {\n      const [, conditionExpr, trueExpr, falseExpr] = ternaryMatch\n      // Evaluate the condition - may include comparison operators\n      const condition = this.evaluateCondition(conditionExpr.trim(), context)\n\n      // Evaluate the appropriate branch\n      const selectedExpr = condition ? trueExpr.trim() : falseExpr.trim()\n      return this.resolveLiteralOrPath(selectedExpr, context)\n    }\n\n    // Handle nullish coalescing (??) - split and try each alternative\n    if (path.includes('??')) {\n      const alternatives = path.split('??').map((alt) => alt.trim())\n\n      for (const alt of alternatives) {\n        const value = this.resolveLiteralOrPath(alt, context)\n\n        // Return first non-null/undefined value (nullish coalescing behavior)\n        if (value !== null && value !== undefined) {\n          return value\n        }\n      }\n\n      // All alternatives were null/undefined\n      return undefined\n    }\n\n    // Handle falsy coalescing (||) - similar to ?? but catches all falsy values\n    // Must check this AFTER ?? to avoid conflicts, and ensure we don't confuse with filter |\n    // Only treat as || if not part of a comparison expression\n    if (/\\|\\|/.test(path) && !this.hasComparisonOperator(path)) {\n      const alternatives = path.split('||').map((alt) => alt.trim())\n\n      for (const alt of alternatives) {\n        const value = this.resolveLiteralOrPath(alt, context)\n\n        // Return first truthy value (falsy coalescing behavior)\n        if (value) {\n          return value\n        }\n      }\n\n      // All alternatives were falsy, return last one\n      const lastAlt = alternatives[alternatives.length - 1]\n      return this.resolveLiteralOrPath(lastAlt, context)\n    }\n\n    // Handle standalone comparison expressions (not in a ternary)\n    // This allows ${input.path == '/docs'} to return true/false\n    if (this.hasComparisonOperator(path)) {\n      return this.evaluateCondition(path, context)\n    }\n\n    // No coalescing or comparison operators, check for filters\n    return this.resolvePathWithFilters(path, context)\n  }\n\n  /**\n   * Check if an expression contains comparison operators\n   * Used to detect expressions like \"input.path == '/docs'\" that should be evaluated as conditions\n   */\n  private hasComparisonOperator(expr: string): boolean {\n    // Check for comparison operators (must be careful about string literals)\n    // Look for patterns like: value == 'string', value != other, value > 10\n    // Using word boundary-like patterns to avoid false positives\n    return (\n      /\\s*(===|!==|==|!=|>=|<=|>|<|&&)\\s*/.test(expr) ||\n      // Also check for string method calls that return boolean\n      /\\.includes\\(/.test(expr) ||\n      /\\.startsWith\\(/.test(expr) ||\n      /\\.endsWith\\(/.test(expr)\n    )\n  }\n\n  /**\n   * Evaluate a condition expression which may include comparison operators\n   * Supports: ==, !=, ===, !==, >, <, >=, <=, &&, ||\n   * Also supports string method calls like includes()\n   */\n  private evaluateCondition(expr: string, context: ResolutionContext): boolean {\n    // Check for && (logical AND) - lowest precedence, evaluate left to right\n    if (expr.includes('&&')) {\n      const parts = expr.split('&&').map((p) => p.trim())\n      return parts.every((part) => this.evaluateCondition(part, context))\n    }\n\n    // Check for logical || in condition (not to be confused with falsy coalescing)\n    // This pattern looks for || that's part of a boolean expression\n    if (/\\s*\\|\\|\\s*/.test(expr) && !expr.includes('?')) {\n      const parts = expr.split(/\\s*\\|\\|\\s*/).map((p) => p.trim())\n      return parts.some((part) => this.evaluateCondition(part, context))\n    }\n\n    // Handle string method calls like input.path.includes('/agents/')\n    const includesMatch = expr.match(/^(.+?)\\.includes\\(\\s*(['\"])(.+?)\\2\\s*\\)$/)\n    if (includesMatch) {\n      const [, pathExpr, , searchStr] = includesMatch\n      const value = this.resolvePathWithFilters(pathExpr.trim(), context)\n      if (typeof value === 'string') {\n        return value.includes(searchStr)\n      }\n      return false\n    }\n\n    // Handle string method startsWith\n    const startsWithMatch = expr.match(/^(.+?)\\.startsWith\\(\\s*(['\"])(.+?)\\2\\s*\\)$/)\n    if (startsWithMatch) {\n      const [, pathExpr, , prefix] = startsWithMatch\n      const value = this.resolvePathWithFilters(pathExpr.trim(), context)\n      if (typeof value === 'string') {\n        return value.startsWith(prefix)\n      }\n      return false\n    }\n\n    // Handle string method endsWith\n    const endsWithMatch = expr.match(/^(.+?)\\.endsWith\\(\\s*(['\"])(.+?)\\2\\s*\\)$/)\n    if (endsWithMatch) {\n      const [, pathExpr, , suffix] = endsWithMatch\n      const value = this.resolvePathWithFilters(pathExpr.trim(), context)\n      if (typeof value === 'string') {\n        return value.endsWith(suffix)\n      }\n      return false\n    }\n\n    // Check for comparison operators (in order of specificity)\n    // === and !== (strict equality)\n    const strictEqMatch = expr.match(/^(.+?)\\s*(===|!==)\\s*(.+)$/)\n    if (strictEqMatch) {\n      const [, leftExpr, op, rightExpr] = strictEqMatch\n      const leftValue = this.resolveLiteralOrPath(leftExpr.trim(), context)\n      const rightValue = this.resolveLiteralOrPath(rightExpr.trim(), context)\n      return op === '===' ? leftValue === rightValue : leftValue !== rightValue\n    }\n\n    // == and != (loose equality)\n    const eqMatch = expr.match(/^(.+?)\\s*(==|!=)\\s*(.+)$/)\n    if (eqMatch) {\n      const [, leftExpr, op, rightExpr] = eqMatch\n      const leftValue = this.resolveLiteralOrPath(leftExpr.trim(), context)\n      const rightValue = this.resolveLiteralOrPath(rightExpr.trim(), context)\n      // eslint-disable-next-line eqeqeq\n      return op === '==' ? leftValue == rightValue : leftValue != rightValue\n    }\n\n    // >= and <= (comparison)\n    const compEqMatch = expr.match(/^(.+?)\\s*(>=|<=)\\s*(.+)$/)\n    if (compEqMatch) {\n      const [, leftExpr, op, rightExpr] = compEqMatch\n      const leftValue = this.resolveLiteralOrPath(leftExpr.trim(), context) as number\n      const rightValue = this.resolveLiteralOrPath(rightExpr.trim(), context) as number\n      return op === '>=' ? leftValue >= rightValue : leftValue <= rightValue\n    }\n\n    // > and < (comparison)\n    const compMatch = expr.match(/^(.+?)\\s*([><])\\s*(.+)$/)\n    if (compMatch) {\n      const [, leftExpr, op, rightExpr] = compMatch\n      const leftValue = this.resolveLiteralOrPath(leftExpr.trim(), context) as number\n      const rightValue = this.resolveLiteralOrPath(rightExpr.trim(), context) as number\n      return op === '>' ? leftValue > rightValue : leftValue < rightValue\n    }\n\n    // No comparison operator found - resolve as truthy/falsy value\n    const value = this.resolvePathWithFilters(expr, context)\n    return Boolean(value)\n  }\n\n  /**\n   * Resolve a value that could be a literal or a path expression\n   */\n  private resolveLiteralOrPath(expr: string, context: ResolutionContext): unknown {\n    // Check if this is a string literal (quoted)\n    const stringLiteralMatch = expr.match(/^[\"'](.*)[\"']$/)\n    if (stringLiteralMatch) {\n      return stringLiteralMatch[1]\n    }\n\n    // Check if this is a numeric literal\n    const numericMatch = expr.match(/^-?\\d+(\\.\\d+)?$/)\n    if (numericMatch) {\n      return parseFloat(expr)\n    }\n\n    // Check if this is a boolean literal\n    if (expr === 'true') return true\n    if (expr === 'false') return false\n\n    // Check if this is null literal\n    if (expr === 'null') return null\n\n    // Use traversePath to handle nested ternaries, comparisons, and filters\n    return this.traversePath(expr, context)\n  }\n\n  /**\n   * Resolve a path that may include filter chains\n   */\n  private resolvePathWithFilters(path: string, context: ResolutionContext): unknown {\n    // Check if path contains filter syntax (single pipe character, not ||)\n    // Use a regex to find single pipes that aren't part of ||\n    const hasSinglePipe = /(?<!\\|)\\|(?!\\|)/.test(path)\n\n    if (hasSinglePipe) {\n      // Split by single pipes only (not ||)\n      const parts = path.split(/(?<!\\|)\\|(?!\\|)/)\n      const propertyPath = parts[0].trim()\n\n      // Get the initial value\n      let value = this.resolvePropertyPath(propertyPath, context)\n\n      // Apply filter chain if present\n      if (parts.length > 1) {\n        const filterChain = parts\n          .slice(1)\n          .map((f) => f.trim())\n          .filter((f) => f.length > 0)\n        if (filterChain.length > 0) {\n          value = applyFilters(value, filterChain)\n        }\n      }\n\n      return value\n    }\n\n    // No filters, just resolve property path\n    return this.resolvePropertyPath(path, context)\n  }\n\n  /**\n   * Resolve a simple dot-separated property path with support for:\n   * - Array indexing: items[0], items[2].name\n   * - Boolean negation: !input.disabled\n   * - Optional chaining: input.user?.name, input.items?.[0]\n   */\n  private resolvePropertyPath(path: string, context: ResolutionContext): unknown {\n    // Handle boolean negation prefix\n    let negate = false\n    let actualPath = path\n    if (path.startsWith('!')) {\n      negate = true\n      actualPath = path.slice(1).trim()\n    }\n\n    // Parse path into segments with optional chaining support\n    const segments = this.parsePathSegments(actualPath)\n\n    let value: unknown = context\n    for (const segment of segments) {\n      // If value is null/undefined and this access is optional, return undefined\n      if (value === null || value === undefined) {\n        if (segment.optional) {\n          return negate ? true : undefined\n        }\n        // Non-optional access on null/undefined\n        return negate ? true : undefined\n      }\n\n      // Handle array indexing: segment has arrayIndex\n      if (segment.arrayIndex !== undefined) {\n        // If there's a property name before the bracket, access it first\n        if (segment.name) {\n          if (typeof value === 'object' && segment.name in value) {\n            value = (value as Record<string, unknown>)[segment.name]\n          } else {\n            return negate ? true : undefined\n          }\n\n          // Check if value became null/undefined after property access\n          if (value === null || value === undefined) {\n            return negate ? true : undefined\n          }\n        }\n\n        // Now access the array index\n        if (Array.isArray(value) && segment.arrayIndex >= 0 && segment.arrayIndex < value.length) {\n          value = value[segment.arrayIndex]\n        } else {\n          return negate ? true : undefined\n        }\n      } else {\n        // Regular property access\n        if (typeof value === 'object' && segment.name in value) {\n          value = (value as Record<string, unknown>)[segment.name]\n        } else {\n          return negate ? true : undefined\n        }\n      }\n    }\n\n    return negate ? !value : value\n  }\n\n  /**\n   * Parse a path string into segments, handling optional chaining (?.)\n   *\n   * Examples:\n   * - \"input.name\"  [{name: \"input\", optional: false}, {name: \"name\", optional: false}]\n   * - \"input?.name\"  [{name: \"input\", optional: false}, {name: \"name\", optional: true}]\n   * - \"items[0]\"  [{name: \"items\", optional: false, arrayIndex: 0}]\n   * - \"items?.[0]\"  [{name: \"items\", optional: false}, {name: \"\", optional: true, arrayIndex: 0}]\n   */\n  private parsePathSegments(path: string): PathSegment[] {\n    const segments: PathSegment[] = []\n\n    // Split by both . and ?. while preserving the optional marker\n    // We need to handle: a.b, a?.b, a[0], a?.[0]\n    let remaining = path.trim()\n\n    while (remaining.length > 0) {\n      let optional = false\n\n      // Check if this segment starts with ?. (optional chaining from previous)\n      if (remaining.startsWith('?.')) {\n        optional = true\n        remaining = remaining.slice(2)\n      } else if (remaining.startsWith('.') && segments.length > 0) {\n        // Regular dot separator (skip if first segment)\n        remaining = remaining.slice(1)\n      }\n\n      // Check for standalone array access: [0] or ?.[0]\n      const standaloneArrayMatch = remaining.match(/^\\[(\\d+)\\]/)\n      if (standaloneArrayMatch) {\n        segments.push({\n          name: '',\n          optional,\n          arrayIndex: parseInt(standaloneArrayMatch[1], 10),\n        })\n        remaining = remaining.slice(standaloneArrayMatch[0].length)\n        continue\n      }\n\n      // Match property name with optional array index: \"items[0]\" or \"items\"\n      // Property names can include letters, digits, underscores, and hyphens (e.g., \"scrape-primary\")\n      const propMatch = remaining.match(/^([\\w-]+)(?:\\[(\\d+)\\])?/)\n      if (propMatch) {\n        const [fullMatch, propName, indexStr] = propMatch\n        segments.push({\n          name: propName,\n          optional,\n          arrayIndex: indexStr !== undefined ? parseInt(indexStr, 10) : undefined,\n        })\n        remaining = remaining.slice(fullMatch.length)\n      } else {\n        // Couldn't parse - break to avoid infinite loop\n        break\n      }\n    }\n\n    return segments\n  }\n}\n\n/**\n * Resolves arrays by recursively resolving each item\n */\nexport class ArrayResolver implements InterpolationResolver {\n  canResolve(template: unknown): boolean {\n    return Array.isArray(template)\n  }\n\n  resolve(\n    template: unknown[],\n    context: ResolutionContext,\n    interpolate: (t: unknown, c: ResolutionContext) => unknown\n  ): unknown {\n    return template.map((item) => interpolate(item, context))\n  }\n}\n\n/**\n * Resolves objects by recursively resolving each property\n */\nexport class ObjectResolver implements InterpolationResolver {\n  canResolve(template: unknown): boolean {\n    return typeof template === 'object' && template !== null && !Array.isArray(template)\n  }\n\n  resolve(\n    template: Record<string, unknown>,\n    context: ResolutionContext,\n    interpolate: (t: unknown, c: ResolutionContext) => unknown\n  ): unknown {\n    const resolved: Record<string, unknown> = {}\n    for (const [key, value] of Object.entries(template)) {\n      resolved[key] = interpolate(value, context)\n    }\n    return resolved\n  }\n}\n\n/**\n * Passthrough resolver for primitives (numbers, booleans, null)\n */\nexport class PassthroughResolver implements InterpolationResolver {\n  canResolve(template: unknown): boolean {\n    return true // Handles everything else\n  }\n\n  resolve(\n    template: unknown,\n    context: ResolutionContext,\n    interpolate: (t: unknown, c: ResolutionContext) => unknown\n  ): unknown {\n    return template\n  }\n}\n","/**\n * Interpolator\n *\n * Orchestrates chain of resolvers for template interpolation.\n * Reduced from 42 lines of nested if/else to clean chain pattern.\n */\n\nimport type { InterpolationResolver, ResolutionContext } from './resolver.js'\nimport { StringResolver, ArrayResolver, ObjectResolver, PassthroughResolver } from './resolver.js'\n\n/**\n * Interpolator with chain of resolvers\n */\nexport class Interpolator {\n  private resolvers: InterpolationResolver[]\n\n  constructor(resolvers?: InterpolationResolver[]) {\n    this.resolvers = resolvers || [\n      new StringResolver(),\n      new ArrayResolver(),\n      new ObjectResolver(),\n      new PassthroughResolver(), // Must be last (catches all)\n    ]\n  }\n\n  /**\n   * Resolve template with context\n   * Delegates to first resolver that can handle the template\n   */\n  resolve(template: any, context: ResolutionContext): any {\n    for (const resolver of this.resolvers) {\n      if (resolver.canResolve(template)) {\n        return resolver.resolve(template, context, (t, c) => this.resolve(t, c))\n      }\n    }\n\n    // Should never reach here due to PassthroughResolver\n    return template\n  }\n}\n\n/**\n * Singleton instance for global use\n */\nlet globalInterpolator: Interpolator | null = null\n\n/**\n * Get global interpolator\n */\nexport function getInterpolator(): Interpolator {\n  if (!globalInterpolator) {\n    globalInterpolator = new Interpolator()\n  }\n  return globalInterpolator\n}\n\n/**\n * Reset global interpolator (useful for testing)\n */\nexport function resetInterpolator(): void {\n  globalInterpolator = null\n}\n","/**\n * Operation Types\n *\n * Defines the different types of operations available in the Conductor framework.\n * Operations represent the various capabilities and behaviors that agents can perform.\n */\n\n/**\n * Operation types in Conductor framework\n *\n * Each operation type represents a distinct capability:\n * - think: AI-powered reasoning and language generation (LLMs, embeddings, classifiers)\n * - code: JavaScript/TypeScript execution for custom business logic\n * - storage: Key-value and object storage (KV, R2, Cache API)\n * - data: SQL databases and structured data stores (D1, Hyperdrive, Supabase, Neon)\n * - http: External API integration and HTTP calls\n * - tools: Model Context Protocol (MCP) and skill integration\n * - scoring: Evaluation and scoring operations\n * - email: Email sending and management\n * - sms: SMS messaging\n * - form: Form rendering and handling\n * - html: HTML content generation\n * - pdf: PDF document generation\n * - queue: Cloudflare Queues message processing and batch operations\n * - autorag: Cloudflare AutoRAG for automatic retrieval-augmented generation\n *\n * Note: Documentation is now handled via the first-class `docs/` directory,\n * not as an operation. See src/docs/ for the docs module.\n */\nexport enum Operation {\n  think = 'think',\n  code = 'code',\n  storage = 'storage',\n  data = 'data',\n  http = 'http',\n  tools = 'tools',\n  scoring = 'scoring',\n  email = 'email',\n  sms = 'sms',\n  form = 'form',\n  html = 'html',\n  pdf = 'pdf',\n  queue = 'queue',\n  autorag = 'autorag',\n}\n\n/**\n * String union type for operations\n */\nexport type OperationType =\n  | 'think'\n  | 'code'\n  | 'storage'\n  | 'data'\n  | 'http'\n  | 'tools'\n  | 'scoring'\n  | 'email'\n  | 'sms'\n  | 'form'\n  | 'html'\n  | 'pdf'\n  | 'queue'\n  | 'autorag'\n\n/**\n * Type guard to check if a value is a valid Operation\n */\nexport const isOperation = (value: string): value is Operation => {\n  return Object.values(Operation).includes(value as Operation)\n}\n\n/**\n * Get all available operations\n */\nexport const getAllOperations = (): Operation[] => {\n  return Object.values(Operation)\n}\n\n/**\n * Get operation display name\n */\nexport const getOperationDisplayName = (operation: Operation): string => {\n  const names: Record<Operation, string> = {\n    [Operation.think]: 'Think Agent',\n    [Operation.code]: 'Code Agent',\n    [Operation.storage]: 'Storage Agent',\n    [Operation.data]: 'Data Agent',\n    [Operation.http]: 'HTTP Agent',\n    [Operation.tools]: 'Tools Agent',\n    [Operation.scoring]: 'Scoring Agent',\n    [Operation.email]: 'Email Agent',\n    [Operation.sms]: 'SMS Agent',\n    [Operation.form]: 'Form Agent',\n    [Operation.html]: 'HTML Agent',\n    [Operation.pdf]: 'PDF Agent',\n    [Operation.queue]: 'Queue Agent',\n    [Operation.autorag]: 'AutoRAG Agent',\n  }\n  return names[operation]\n}\n\n/**\n * Get operation description\n */\nexport const getOperationDescription = (operation: Operation): string => {\n  const descriptions: Record<Operation, string> = {\n    [Operation.think]: 'AI-powered reasoning and language generation',\n    [Operation.code]: 'Custom code execution and business logic',\n    [Operation.storage]: 'Key-value and object storage (KV, R2, Cache)',\n    [Operation.data]: 'SQL databases and structured data (D1, Hyperdrive)',\n    [Operation.http]: 'External API integration and calls',\n    [Operation.tools]: 'Model Context Protocol integration',\n    [Operation.scoring]: 'Evaluation, scoring, and quality assessment',\n    [Operation.email]: 'Email sending and management',\n    [Operation.sms]: 'SMS messaging and notifications',\n    [Operation.form]: 'Form rendering and submission handling',\n    [Operation.html]: 'HTML content generation',\n    [Operation.pdf]: 'PDF document generation and processing',\n    [Operation.queue]: 'Message queue processing and batch operations',\n    [Operation.autorag]: 'Automatic retrieval-augmented generation with Cloudflare AutoRAG',\n  }\n  return descriptions[operation]\n}\n\n/**\n * Check if an operation requires AI capabilities\n */\nexport const requiresAI = (operation: Operation): boolean => {\n  return operation === Operation.think\n}\n\n/**\n * Check if an operation involves external communication\n */\nexport const isExternalOperation = (operation: Operation): boolean => {\n  return [Operation.http, Operation.email, Operation.sms].includes(operation)\n}\n\n/**\n * Check if an operation generates content\n */\nexport const isContentGenerationOperation = (operation: Operation): boolean => {\n  return [Operation.think, Operation.html, Operation.pdf, Operation.form].includes(operation)\n}\n\n/**\n * Check if an operation involves data storage\n */\nexport const isDataOperation = (operation: Operation): boolean => {\n  return [Operation.storage, Operation.data].includes(operation)\n}\n\n/**\n * Validate operation configuration based on operation type\n */\nexport interface OperationValidationResult {\n  valid: boolean\n  errors: string[]\n  warnings: string[]\n}\n\n/**\n * Operation metadata\n */\nexport interface OperationMetadata {\n  operation: Operation\n  displayName: string\n  description: string\n  requiresAI: boolean\n  isExternal: boolean\n  isContentGeneration: boolean\n  isData: boolean\n}\n\n/**\n * Get complete metadata for an operation\n */\nexport const getOperationMetadata = (operation: Operation): OperationMetadata => {\n  return {\n    operation,\n    displayName: getOperationDisplayName(operation),\n    description: getOperationDescription(operation),\n    requiresAI: requiresAI(operation),\n    isExternal: isExternalOperation(operation),\n    isContentGeneration: isContentGenerationOperation(operation),\n    isData: isDataOperation(operation),\n  }\n}\n","/**\n * Constants and Enums - Eliminating Magic Strings\n *\n * Centralized constants for operation types, providers, and storage types.\n * Eliminates magic strings and provides compile-time safety.\n */\n\n// Re-export Operation from operation.ts for backward compatibility with imports\nexport { Operation, type OperationType, isOperation } from './operation.js'\n\n/**\n * AI Provider types supported by Think agents\n */\nexport enum AIProvider {\n  OpenAI = 'openai',\n  Anthropic = 'anthropic',\n  Cloudflare = 'cloudflare',\n  Custom = 'custom',\n}\n\n/**\n * Storage backend types for Storage agents (key-value and object storage)\n */\nexport enum StorageType {\n  KV = 'kv',\n  R2 = 'r2',\n  Cache = 'cache',\n}\n\n/**\n * Database backend types for Data agents (SQL and structured databases)\n */\nexport enum DatabaseType {\n  D1 = 'd1',\n  Hyperdrive = 'hyperdrive',\n  Vectorize = 'vectorize',\n  Supabase = 'supabase',\n  Neon = 'neon',\n  PlanetScale = 'planetscale',\n}\n\n/**\n * Type guards for runtime validation\n */\nexport const isAIProvider = (value: string): value is AIProvider => {\n  return Object.values(AIProvider).includes(value as AIProvider)\n}\n\nexport const isStorageType = (value: string): value is StorageType => {\n  return Object.values(StorageType).includes(value as StorageType)\n}\n\nexport const isDatabaseType = (value: string): value is DatabaseType => {\n  return Object.values(DatabaseType).includes(value as DatabaseType)\n}\n\n/**\n * Type aliases for string unions\n */\nexport type AIProviderType = 'openai' | 'anthropic' | 'cloudflare' | 'custom'\nexport type StorageTypeString = 'kv' | 'r2' | 'cache'\nexport type DatabaseTypeString =\n  | 'd1'\n  | 'hyperdrive'\n  | 'vectorize'\n  | 'supabase'\n  | 'neon'\n  | 'planetscale'\n","/**\n * Output Types for Ensemble Response Handling\n *\n * Defines types for conditional outputs, custom status codes,\n * redirects, custom headers, raw body responses, and output formats.\n *\n * @module runtime/output-types\n */\n\nimport { z } from 'zod'\n\n// ============================================================================\n// Output Format Types\n// ============================================================================\n\n/**\n * Supported output format types with their default Content-Type mappings\n */\nexport const FORMAT_CONTENT_TYPES: Record<string, string> = {\n  json: 'application/json',\n  text: 'text/plain',\n  html: 'text/html',\n  xml: 'application/xml',\n  csv: 'text/csv',\n  markdown: 'text/markdown',\n  yaml: 'application/x-yaml',\n  ics: 'text/calendar',\n  rss: 'application/rss+xml',\n  atom: 'application/atom+xml',\n}\n\n/**\n * Valid format type strings\n */\nexport type FormatType = keyof typeof FORMAT_CONTENT_TYPES\n\n/**\n * Extended format configuration object\n */\nexport interface FormatConfig {\n  /** Format type (determines default Content-Type) */\n  type: FormatType\n  /** Field to extract from body (for multi-field bodies) */\n  extract?: string\n  /** Override default Content-Type */\n  contentType?: string\n}\n\n/**\n * Output format - either a string shorthand or full config object\n */\nexport type OutputFormat = FormatType | FormatConfig\n\n/**\n * Get Content-Type for a format specification\n */\nexport function getFormatContentType(format: OutputFormat): string {\n  if (typeof format === 'string') {\n    return FORMAT_CONTENT_TYPES[format] ?? 'application/octet-stream'\n  }\n  return format.contentType ?? FORMAT_CONTENT_TYPES[format.type] ?? 'application/octet-stream'\n}\n\n/**\n * Get the format type from a format specification\n */\nexport function getFormatType(format: OutputFormat): FormatType {\n  if (typeof format === 'string') {\n    return format as FormatType\n  }\n  return format.type as FormatType\n}\n\n/**\n * Get the extract field from a format specification\n */\nexport function getFormatExtract(format: OutputFormat): string | undefined {\n  if (typeof format === 'string') {\n    return undefined\n  }\n  return format.extract\n}\n\n// ============================================================================\n// Output Format Schemas\n// ============================================================================\n\n/**\n * Zod schema for format type strings\n */\nexport const FormatTypeSchema = z.enum([\n  'json',\n  'text',\n  'html',\n  'xml',\n  'csv',\n  'markdown',\n  'yaml',\n  'ics',\n  'rss',\n  'atom',\n])\n\n/**\n * Zod schema for format config object\n */\nexport const FormatConfigSchema = z.object({\n  type: FormatTypeSchema,\n  extract: z.string().optional(),\n  contentType: z.string().optional(),\n})\n\n/**\n * Zod schema for output format (string or object)\n */\nexport const OutputFormatSchema = z.union([FormatTypeSchema, FormatConfigSchema])\n\n// ============================================================================\n// Redirect Types\n// ============================================================================\n\n/**\n * HTTP redirect configuration\n */\nexport interface RedirectOutput {\n  /** Target URL to redirect to */\n  url: string\n  /** HTTP status code (301, 302, 307, 308) or template string that evaluates to one */\n  status?: 301 | 302 | 307 | 308 | string\n}\n\n/**\n * Single output block with optional condition\n */\nexport interface OutputBlock {\n  /** Condition expression - if omitted, block always matches (default case) */\n  when?: string\n\n  /** HTTP status code (default: 200) */\n  status?: number\n\n  /** Response headers */\n  headers?: Record<string, string>\n\n  /** JSON body (will be serialized) */\n  body?: unknown\n\n  /** Raw string body (bypasses JSON serialization) */\n  rawBody?: string\n\n  /** HTTP redirect (mutually exclusive with body/rawBody) */\n  redirect?: RedirectOutput\n\n  /**\n   * Output format for triggers (determines Content-Type and serialization)\n   *\n   * String shorthand: 'text', 'html', 'xml', 'json', etc.\n   * Object form: { type: 'html', extract: 'content' } for field extraction\n   *\n   * Note: format is ONLY used by triggers. Execute API always returns JSON.\n   */\n  format?: OutputFormat\n}\n\n/**\n * Resolved redirect configuration (after interpolation)\n */\nexport interface ResolvedRedirectOutput {\n  /** Target URL to redirect to */\n  url: string\n  /** HTTP status code (301, 302, 307, 308) - resolved from template */\n  status?: 301 | 302 | 307 | 308\n}\n\n/**\n * Resolved output after condition evaluation\n */\nexport interface ResolvedOutput {\n  /** HTTP status code */\n  status: number\n\n  /** Response headers */\n  headers?: Record<string, string>\n\n  /** JSON body */\n  body?: unknown\n\n  /** Raw string body */\n  rawBody?: string\n\n  /** Redirect configuration (after interpolation) */\n  redirect?: ResolvedRedirectOutput\n\n  /** Output format for triggers (passed through from OutputBlock) */\n  format?: OutputFormat\n}\n\n/**\n * Schema for redirect output\n *\n * Note: `status` can be a literal number OR a template string that evaluates to a number.\n * Template strings (e.g., \"${{ agent.output.statusCode }}\") are interpolated at runtime.\n */\nexport const RedirectOutputSchema = z.object({\n  url: z.string(),\n  status: z\n    .union([\n      // Literal redirect status codes\n      z.literal(301),\n      z.literal(302),\n      z.literal(307),\n      z.literal(308),\n      // Template string that evaluates to a status code at runtime\n      z.string(),\n    ])\n    .optional(),\n})\n\n/**\n * Schema for a single output block\n */\nexport const OutputBlockSchema = z.object({\n  when: z.string().optional(),\n  status: z.number().int().min(100).max(599).optional(),\n  headers: z.record(z.string()).optional(),\n  body: z.unknown().optional(),\n  rawBody: z.string().optional(),\n  redirect: RedirectOutputSchema.optional(),\n  format: OutputFormatSchema.optional(),\n})\n\n/**\n * Schema for the output field - supports both legacy object and new array format\n *\n * Legacy format (still supported):\n * ```yaml\n * output:\n *   result: ${agent.output}\n * ```\n *\n * New conditional format:\n * ```yaml\n * output:\n *   - when: ${found}\n *     status: 200\n *     body: { data: ${result} }\n *   - status: 404\n *     body: { error: \"not_found\" }\n * ```\n */\nexport const EnsembleOutputSchema = z.union([\n  // New: Array of conditional output blocks\n  z.array(OutputBlockSchema),\n  // Legacy: Simple object output (will be wrapped as body)\n  z.record(z.unknown()),\n])\n\n/**\n * Type for ensemble output (union of array and legacy object)\n */\nexport type EnsembleOutput = OutputBlock[] | Record<string, unknown>\n\n/**\n * Check if output is in the new conditional format (array of blocks)\n */\nexport function isConditionalOutput(output: EnsembleOutput): output is OutputBlock[] {\n  return Array.isArray(output)\n}\n\n/**\n * Known OutputBlock keys - used to detect if an object is an OutputBlock\n */\nconst OUTPUT_BLOCK_KEYS = new Set(['when', 'status', 'headers', 'body', 'rawBody', 'redirect', 'format'])\n\n/**\n * Check if an object looks like an OutputBlock (has OutputBlock-specific keys)\n *\n * Returns true if the object has at least one key that is specific to OutputBlock\n * and no keys that aren't valid OutputBlock keys.\n */\nfunction isOutputBlockLike(obj: Record<string, unknown>): boolean {\n  const keys = Object.keys(obj)\n  if (keys.length === 0) return false\n\n  // Must have at least one OutputBlock-specific key\n  const hasOutputBlockKey = keys.some((k) => OUTPUT_BLOCK_KEYS.has(k))\n  if (!hasOutputBlockKey) return false\n\n  // All keys must be valid OutputBlock keys\n  return keys.every((k) => OUTPUT_BLOCK_KEYS.has(k))\n}\n\n/**\n * Normalize legacy output format to conditional format\n *\n * Supports three formats:\n * 1. Array format: [{ status: 200, body: {...} }] - returned as-is\n * 2. Single OutputBlock format: { status: 200, body: {...} } - wrapped in array\n * 3. Legacy format: { result: ${foo} } - wrapped as body in a single block\n *\n * @example\n * // Array format (returned as-is)\n * normalizeOutput([{ status: 200, body: { ok: true } }])\n * // => [{ status: 200, body: { ok: true } }]\n *\n * @example\n * // Single OutputBlock format (wrapped in array)\n * normalizeOutput({ status: 200, body: { pong: true } })\n * // => [{ status: 200, body: { pong: true } }]\n *\n * @example\n * // Legacy format (wrapped as body)\n * normalizeOutput({ result: '${foo}' })\n * // => [{ body: { result: '${foo}' } }]\n */\nexport function normalizeOutput(output: EnsembleOutput): OutputBlock[] {\n  if (isConditionalOutput(output)) {\n    return output\n  }\n\n  // Check if this looks like a single OutputBlock (has body, status, headers, etc.)\n  if (isOutputBlockLike(output)) {\n    return [output as OutputBlock]\n  }\n\n  // Legacy format - wrap as body in a single block\n  return [{ body: output }]\n}\n","/**\n * Observability Types\n *\n * Type definitions for logging, tracing, and metrics following\n * Cloudflare Workers Observability best practices (2025).\n */\n\n/**\n * Log levels following standard severity hierarchy\n */\nexport enum LogLevel {\n  DEBUG = 'debug',\n  INFO = 'info',\n  WARN = 'warn',\n  ERROR = 'error',\n}\n\n/**\n * Log context - structured data attached to log entries\n *\n * Cloudflare Workers Logs automatically indexes JSON fields,\n * so rich context enables powerful queries in the dashboard.\n */\nexport interface LogContext {\n  // Request tracking\n  requestId?: string\n  executionId?: string\n\n  // Execution context\n  ensembleName?: string\n  agentName?: string\n  stepIndex?: number\n  attemptNumber?: number\n\n  // Performance\n  durationMs?: number\n\n  // User/session\n  userId?: string\n  sessionId?: string\n\n  // Additional metadata\n  [key: string]: unknown\n}\n\n/**\n * Structured log entry format\n *\n * This format is automatically parsed and indexed by Cloudflare Workers Logs\n */\nexport interface LogEntry {\n  timestamp: string\n  level: LogLevel\n  message: string\n  context?: LogContext\n  error?: {\n    name: string\n    message: string\n    stack?: string\n    code?: string\n    details?: unknown\n  }\n}\n\n/**\n * Logger configuration\n */\nexport interface LoggerConfig {\n  /**\n   * Minimum log level to output\n   * @default LogLevel.INFO in production, LogLevel.DEBUG in development\n   */\n  level?: LogLevel\n\n  /**\n   * Service name for log identification\n   * @default 'conductor'\n   */\n  serviceName?: string\n\n  /**\n   * Environment name\n   * @default 'production'\n   */\n  environment?: string\n\n  /**\n   * Enable debug mode (outputs all logs including DEBUG level)\n   * Can be controlled via DEBUG env variable\n   * @default false\n   */\n  debug?: boolean\n\n  /**\n   * Enable Analytics Engine integration for metrics\n   * @default true\n   */\n  enableAnalytics?: boolean\n\n  /**\n   * Base context to include in all logs\n   */\n  baseContext?: LogContext\n}\n\n/**\n * Analytics Engine data point\n *\n * High-cardinality metrics for querying with SQL API\n */\nexport interface MetricDataPoint {\n  /**\n   * String values (up to 20)\n   */\n  blobs?: string[]\n\n  /**\n   * Numeric values (up to 20)\n   */\n  doubles?: number[]\n\n  /**\n   * Index keys for querying (up to 20)\n   */\n  indexes?: string[]\n}\n\n/**\n * Trace span for distributed tracing\n */\nexport interface TraceSpan {\n  name: string\n  startTime: number\n  endTime?: number\n  attributes: Record<string, unknown>\n  events: TraceEvent[]\n  status: 'ok' | 'error'\n  error?: Error\n}\n\n/**\n * Trace event within a span\n */\nexport interface TraceEvent {\n  timestamp: number\n  name: string\n  attributes: Record<string, unknown>\n}\n\n/**\n * Logger interface\n *\n * All logging should go through this interface to ensure\n * consistent structure and integration with Cloudflare observability.\n */\nexport interface Logger {\n  /**\n   * Log debug information (development/troubleshooting)\n   */\n  debug(message: string, context?: LogContext): void\n\n  /**\n   * Log informational message\n   */\n  info(message: string, context?: LogContext): void\n\n  /**\n   * Log warning\n   */\n  warn(message: string, context?: LogContext): void\n\n  /**\n   * Log error\n   */\n  error(message: string, error?: Error, context?: LogContext): void\n\n  /**\n   * Create child logger with additional context\n   */\n  child(context: LogContext): Logger\n\n  /**\n   * Record metric to Analytics Engine\n   */\n  metric(name: string, data: MetricDataPoint): void\n}\n\n/**\n * Observability provider interface for extensibility\n */\nexport interface ObservabilityProvider {\n  /**\n   * Log a message\n   */\n  log(entry: LogEntry): void\n\n  /**\n   * Record a metric\n   */\n  recordMetric(name: string, data: MetricDataPoint): void\n\n  /**\n   * Start a trace span\n   */\n  startSpan(name: string, attributes: Record<string, unknown>): TraceSpan\n\n  /**\n   * End a trace span\n   */\n  endSpan(span: TraceSpan): void\n}\n","/**\n * Structured Logger for Cloudflare Workers\n *\n * Follows Cloudflare Workers Observability best practices (2025):\n * - Uses console.log() for automatic capture by Workers Logs\n * - Outputs structured JSON for automatic field extraction/indexing\n * - Integrates with Analytics Engine for metrics\n * - Supports debug mode via DEBUG environment variable\n * - Thread-safe and immutable context management\n *\n * @see https://developers.cloudflare.com/workers/observability/\n */\n\nimport type {\n  Logger,\n  LoggerConfig,\n  LogLevel,\n  LogContext,\n  LogEntry,\n  MetricDataPoint,\n} from './types.js'\nimport { LogLevel as LogLevelEnum } from './types.js'\nimport type { ConductorError } from '../errors/error-types.js'\n\n/**\n * Log level hierarchy for comparison\n */\nconst LOG_LEVEL_PRIORITY: Record<LogLevel, number> = {\n  [LogLevelEnum.DEBUG]: 0,\n  [LogLevelEnum.INFO]: 1,\n  [LogLevelEnum.WARN]: 2,\n  [LogLevelEnum.ERROR]: 3,\n}\n\n/**\n * Structured logger implementation\n *\n * Uses console.log() which is automatically captured by Cloudflare Workers Logs.\n * Outputs JSON for automatic field extraction and indexing in the dashboard.\n */\nexport class ConductorLogger implements Logger {\n  private readonly config: Required<LoggerConfig>\n  private readonly baseContext: Readonly<LogContext>\n  private readonly analyticsEngine?: AnalyticsEngineDataset\n\n  constructor(\n    config: LoggerConfig = {},\n    analyticsEngine?: AnalyticsEngineDataset,\n    baseContext: LogContext = {}\n  ) {\n    // Detect debug mode from environment or config\n    // Use type-safe access to globalThis DEBUG flag\n    const globalDebug =\n      typeof globalThis !== 'undefined' && 'DEBUG' in globalThis\n        ? (globalThis as { DEBUG?: boolean }).DEBUG === true\n        : false\n    const isDebug =\n      config.debug ??\n      ((typeof process !== 'undefined' && process.env?.DEBUG === 'true') || globalDebug)\n\n    this.config = {\n      level: config.level ?? (isDebug ? LogLevelEnum.DEBUG : LogLevelEnum.INFO),\n      serviceName: config.serviceName ?? 'conductor',\n      environment: config.environment ?? 'production',\n      debug: isDebug,\n      enableAnalytics: config.enableAnalytics ?? true,\n      baseContext: config.baseContext ?? {},\n    }\n\n    this.baseContext = Object.freeze({ ...this.config.baseContext, ...baseContext })\n    this.analyticsEngine = analyticsEngine\n  }\n\n  /**\n   * Check if a log level should be output\n   */\n  private shouldLog(level: LogLevel): boolean {\n    return LOG_LEVEL_PRIORITY[level] >= LOG_LEVEL_PRIORITY[this.config.level]\n  }\n\n  /**\n   * Create structured log entry\n   */\n  private createLogEntry(\n    level: LogLevel,\n    message: string,\n    context?: LogContext,\n    error?: Error\n  ): LogEntry {\n    const entry: LogEntry = {\n      timestamp: new Date().toISOString(),\n      level,\n      message,\n      ...(Object.keys({ ...this.baseContext, ...context }).length > 0 && {\n        context: { ...this.baseContext, ...context },\n      }),\n    }\n\n    // Add error details if present\n    if (error) {\n      entry.error = {\n        name: error.name,\n        message: error.message,\n        stack: error.stack,\n        // Include ConductorError specific fields\n        ...(this.isConductorError(error) && {\n          code: error.code,\n          details: error.details,\n        }),\n      }\n    }\n\n    return entry\n  }\n\n  /**\n   * Type guard for ConductorError\n   */\n  private isConductorError(error: Error): error is ConductorError {\n    return 'code' in error && 'toJSON' in error\n  }\n\n  /**\n   * Output log entry via console\n   *\n   * Cloudflare Workers Logs automatically captures console output\n   * and indexes JSON fields for querying in the dashboard.\n   */\n  private log(entry: LogEntry): void {\n    if (!this.shouldLog(entry.level)) {\n      return\n    }\n\n    // Output as structured JSON\n    // Cloudflare Workers Logs will automatically parse and index this\n    const logOutput = JSON.stringify(entry)\n\n    // Use appropriate console method for severity\n    switch (entry.level) {\n      case LogLevelEnum.DEBUG:\n        console.debug(logOutput)\n        break\n      case LogLevelEnum.INFO:\n        console.info(logOutput)\n        break\n      case LogLevelEnum.WARN:\n        console.warn(logOutput)\n        break\n      case LogLevelEnum.ERROR:\n        console.error(logOutput)\n        break\n    }\n  }\n\n  /**\n   * Log debug information\n   *\n   * Only output when DEBUG=true or log level is DEBUG.\n   * Useful for development and troubleshooting.\n   */\n  debug(message: string, context?: LogContext): void {\n    const entry = this.createLogEntry(LogLevelEnum.DEBUG, message, context)\n    this.log(entry)\n  }\n\n  /**\n   * Log informational message\n   *\n   * Use for normal operational events worth tracking.\n   */\n  info(message: string, context?: LogContext): void {\n    const entry = this.createLogEntry(LogLevelEnum.INFO, message, context)\n    this.log(entry)\n  }\n\n  /**\n   * Log warning\n   *\n   * Use for concerning but non-critical issues.\n   */\n  warn(message: string, context?: LogContext): void {\n    const entry = this.createLogEntry(LogLevelEnum.WARN, message, context)\n    this.log(entry)\n  }\n\n  /**\n   * Log error\n   *\n   * Use for errors that need attention.\n   * Includes full error details and stack trace.\n   */\n  error(message: string, error?: Error, context?: LogContext): void {\n    const entry = this.createLogEntry(LogLevelEnum.ERROR, message, context, error)\n    this.log(entry)\n  }\n\n  /**\n   * Create child logger with additional context\n   *\n   * Useful for adding request-specific or execution-specific context\n   * that applies to all logs within a scope.\n   *\n   * @example\n   * const requestLogger = logger.child({ requestId: '123', userId: 'alice' });\n   * requestLogger.info('Processing request'); // Includes requestId and userId\n   */\n  child(context: LogContext): Logger {\n    return new ConductorLogger(this.config, this.analyticsEngine, {\n      ...this.baseContext,\n      ...context,\n    })\n  }\n\n  /**\n   * Record metric to Analytics Engine\n   *\n   * Analytics Engine provides unlimited-cardinality analytics at scale.\n   * Use for high-volume metrics that need SQL querying.\n   *\n   * @example\n   * logger.metric('ensemble.execution', {\n   *   blobs: ['user-workflow', 'completed'],\n   *   doubles: [1234], // duration in ms\n   *   indexes: ['ensemble.execution']\n   * });\n   */\n  metric(name: string, data: MetricDataPoint): void {\n    if (!this.config.enableAnalytics || !this.analyticsEngine) {\n      return\n    }\n\n    try {\n      this.analyticsEngine.writeDataPoint({\n        blobs: data.blobs ?? [],\n        doubles: data.doubles ?? [],\n        indexes: data.indexes ?? [name],\n      })\n    } catch (error) {\n      // Don't let metrics failures crash the application\n      // Log the error but continue\n      this.warn('Failed to write metric', {\n        metricName: name,\n        error: error instanceof Error ? error.message : 'Unknown error',\n      })\n    }\n  }\n}\n\n/**\n * Create a logger instance\n *\n * @example\n * // Basic usage\n * const logger = createLogger();\n *\n * // With config\n * const logger = createLogger({\n *   level: LogLevel.DEBUG,\n *   serviceName: 'my-service',\n *   environment: 'development'\n * });\n *\n * // With Analytics Engine\n * const logger = createLogger({ ... }, env.ANALYTICS);\n */\nexport function createLogger(\n  config: LoggerConfig = {},\n  analyticsEngine?: AnalyticsEngineDataset\n): Logger {\n  return new ConductorLogger(config, analyticsEngine)\n}\n\n/**\n * Global logger instance\n *\n * Can be used for simple logging without passing logger around.\n * For most use cases, prefer dependency injection of Logger.\n */\nlet globalLogger: Logger | null = null\n\n/**\n * Set global logger instance\n */\nexport function setGlobalLogger(logger: Logger): void {\n  globalLogger = logger\n}\n\n/**\n * Get global logger instance\n *\n * Creates a default logger if none exists.\n */\nexport function getGlobalLogger(): Logger {\n  if (!globalLogger) {\n    globalLogger = createLogger()\n  }\n  return globalLogger\n}\n","/**\n * Branded Types for Domain Concepts\n *\n * Branded types provide compile-time type safety for domain concepts,\n * preventing accidental misuse of primitive types.\n *\n * @example\n * ```typescript\n * const modelId = ModelId.create('@cf/meta/llama-3.1-8b-instruct');\n * const agentId = AgentName.create('analyze-company');\n *\n * // Type error! Can't pass AgentName where ModelId is expected\n * platform.validateModel(agentId); //  Compile error\n * platform.validateModel(modelId);  //  Works\n * ```\n */\n\ndeclare const brand: unique symbol\n\n/**\n * Brand a primitive type with a unique identifier\n */\nexport type Brand<T, TBrand extends string> = T & {\n  readonly [brand]: TBrand\n}\n\n/**\n * Model ID - uniquely identifies an AI model\n * Examples: '@cf/meta/llama-3.1-8b-instruct', 'gpt-4o', 'claude-3-5-sonnet-20241022'\n */\nexport type ModelId = Brand<string, 'ModelId'>\n\n/**\n * Agent name - identifies an agent in the system\n * Format: lowercase alphanumeric with hyphens\n * Examples: 'analyze-company', 'fetch-data', 'greet-user'\n */\nexport type AgentName = Brand<string, 'AgentName'>\n\n/**\n * Ensemble name - identifies an ensemble workflow\n * Format: lowercase alphanumeric with hyphens\n * Examples: 'company-intelligence', 'user-onboarding', 'data-pipeline'\n */\nexport type EnsembleName = Brand<string, 'EnsembleName'>\n\n/**\n * Provider ID - identifies an AI provider\n * Examples: 'openai', 'anthropic', 'workers-ai', 'groq'\n */\nexport type ProviderId = Brand<string, 'ProviderId'>\n\n/**\n * Platform name - identifies a cloud platform\n * Examples: 'cloudflare', 'vercel', 'aws'\n */\nexport type PlatformName = Brand<string, 'PlatformName'>\n\n/**\n * Binding name - identifies a Cloudflare binding\n * Examples: 'AI', 'CACHE', 'DB', 'STORAGE'\n */\nexport type BindingName = Brand<string, 'BindingName'>\n\n/**\n * Version string - semantic version or tag\n * Examples: 'v1.0.0', 'production', 'latest'\n */\nexport type VersionString = Brand<string, 'VersionString'>\n\n/**\n * Execution ID - uniquely identifies an execution\n * Format: exec_<uuid>\n * Examples: 'exec_550e8400-e29b-41d4-a716-446655440000'\n */\nexport type ExecutionId = Brand<string, 'ExecutionId'>\n\n/**\n * Request ID - uniquely identifies an API request\n * Format: req_<uuid>\n * Examples: 'req_550e8400-e29b-41d4-a716-446655440000'\n */\nexport type RequestId = Brand<string, 'RequestId'>\n\n/**\n * Resume Token - uniquely identifies a suspended execution\n * Format: resume_<uuid>\n * Examples: 'resume_550e8400-e29b-41d4-a716-446655440000'\n */\nexport type ResumeToken = Brand<string, 'ResumeToken'>\n\n/**\n * Cache Key - identifies a cached value\n * Examples: 'agent:analyze:a1b2c3', 'query:d4e5f6'\n */\nexport type CacheKey = Brand<string, 'CacheKey'>\n\n/**\n * Model ID validation and creation\n */\nexport const ModelId = {\n  /**\n   * Create a ModelId from a string\n   * @throws {Error} if the model ID is invalid\n   */\n  create(value: string): ModelId {\n    if (!value || value.trim().length === 0) {\n      throw new Error('Model ID cannot be empty')\n    }\n\n    // Model IDs should not contain spaces\n    if (value.includes(' ')) {\n      throw new Error(`Invalid model ID format: \"${value}\" (contains spaces)`)\n    }\n\n    return value.trim() as ModelId\n  },\n\n  /**\n   * Check if a string is a valid ModelId\n   */\n  isValid(value: string): boolean {\n    return !!value && value.trim().length > 0 && !value.includes(' ')\n  },\n\n  /**\n   * Safely create a ModelId, returning null if invalid\n   */\n  tryCreate(value: string): ModelId | null {\n    try {\n      return ModelId.create(value)\n    } catch {\n      return null\n    }\n  },\n\n  /**\n   * Unwrap a ModelId back to a string\n   */\n  unwrap(modelId: ModelId): string {\n    return modelId as string\n  },\n}\n\n/**\n * Agent name validation and creation\n */\nexport const AgentName = {\n  /**\n   * Create an AgentName from a string\n   * @throws {Error} if the agent name is invalid\n   */\n  create(value: string): AgentName {\n    if (!value || value.trim().length === 0) {\n      throw new Error('Agent name cannot be empty')\n    }\n\n    // Agent names must be lowercase alphanumeric with hyphens\n    const normalized = value.trim()\n    if (!/^[a-z0-9-]+$/.test(normalized)) {\n      throw new Error(\n        `Invalid agent name format: \"${value}\" ` + `(must be lowercase alphanumeric with hyphens)`\n      )\n    }\n\n    return normalized as AgentName\n  },\n\n  /**\n   * Check if a string is a valid AgentName\n   */\n  isValid(value: string): boolean {\n    return !!value && /^[a-z0-9-]+$/.test(value.trim())\n  },\n\n  /**\n   * Safely create an AgentName, returning null if invalid\n   */\n  tryCreate(value: string): AgentName | null {\n    try {\n      return AgentName.create(value)\n    } catch {\n      return null\n    }\n  },\n\n  /**\n   * Unwrap an AgentName back to a string\n   */\n  unwrap(agentName: AgentName): string {\n    return agentName as string\n  },\n}\n\n/**\n * Ensemble name validation and creation\n */\nexport const EnsembleName = {\n  /**\n   * Create an EnsembleName from a string\n   * @throws {Error} if the ensemble name is invalid\n   */\n  create(value: string): EnsembleName {\n    if (!value || value.trim().length === 0) {\n      throw new Error('Ensemble name cannot be empty')\n    }\n\n    // Ensemble names must be lowercase alphanumeric with hyphens\n    const normalized = value.trim()\n    if (!/^[a-z0-9-]+$/.test(normalized)) {\n      throw new Error(\n        `Invalid ensemble name format: \"${value}\" ` +\n          `(must be lowercase alphanumeric with hyphens)`\n      )\n    }\n\n    return normalized as EnsembleName\n  },\n\n  /**\n   * Check if a string is a valid EnsembleName\n   */\n  isValid(value: string): boolean {\n    return !!value && /^[a-z0-9-]+$/.test(value.trim())\n  },\n\n  /**\n   * Safely create an EnsembleName, returning null if invalid\n   */\n  tryCreate(value: string): EnsembleName | null {\n    try {\n      return EnsembleName.create(value)\n    } catch {\n      return null\n    }\n  },\n\n  /**\n   * Unwrap an EnsembleName back to a string\n   */\n  unwrap(ensembleName: EnsembleName): string {\n    return ensembleName as string\n  },\n}\n\n/**\n * Provider ID validation and creation\n */\nexport const ProviderId = {\n  /**\n   * Create a ProviderId from a string\n   * @throws {Error} if the provider ID is invalid\n   */\n  create(value: string): ProviderId {\n    if (!value || value.trim().length === 0) {\n      throw new Error('Provider ID cannot be empty')\n    }\n\n    // Provider IDs must be lowercase alphanumeric with hyphens\n    const normalized = value.trim().toLowerCase()\n    if (!/^[a-z0-9-]+$/.test(normalized)) {\n      throw new Error(\n        `Invalid provider ID format: \"${value}\" ` + `(must be lowercase alphanumeric with hyphens)`\n      )\n    }\n\n    return normalized as ProviderId\n  },\n\n  /**\n   * Check if a string is a valid ProviderId\n   */\n  isValid(value: string): boolean {\n    return !!value && /^[a-z0-9-]+$/.test(value.trim().toLowerCase())\n  },\n\n  /**\n   * Safely create a ProviderId, returning null if invalid\n   */\n  tryCreate(value: string): ProviderId | null {\n    try {\n      return ProviderId.create(value)\n    } catch {\n      return null\n    }\n  },\n\n  /**\n   * Unwrap a ProviderId back to a string\n   */\n  unwrap(providerId: ProviderId): string {\n    return providerId as string\n  },\n}\n\n/**\n * Platform name validation and creation\n */\nexport const PlatformName = {\n  /**\n   * Create a PlatformName from a string\n   * @throws {Error} if the platform name is invalid\n   */\n  create(value: string): PlatformName {\n    if (!value || value.trim().length === 0) {\n      throw new Error('Platform name cannot be empty')\n    }\n\n    const normalized = value.trim().toLowerCase()\n    return normalized as PlatformName\n  },\n\n  /**\n   * Check if a string is a valid PlatformName\n   */\n  isValid(value: string): boolean {\n    return !!value && value.trim().length > 0\n  },\n\n  /**\n   * Safely create a PlatformName, returning null if invalid\n   */\n  tryCreate(value: string): PlatformName | null {\n    try {\n      return PlatformName.create(value)\n    } catch {\n      return null\n    }\n  },\n\n  /**\n   * Unwrap a PlatformName back to a string\n   */\n  unwrap(platformName: PlatformName): string {\n    return platformName as string\n  },\n}\n\n/**\n * Binding name validation and creation\n */\nexport const BindingName = {\n  /**\n   * Create a BindingName from a string\n   * @throws {Error} if the binding name is invalid\n   */\n  create(value: string): BindingName {\n    if (!value || value.trim().length === 0) {\n      throw new Error('Binding name cannot be empty')\n    }\n\n    // Binding names are typically UPPER_CASE\n    const normalized = value.trim()\n    if (!/^[A-Z_][A-Z0-9_]*$/.test(normalized)) {\n      throw new Error(\n        `Invalid binding name format: \"${value}\" ` + `(must be UPPER_CASE with underscores)`\n      )\n    }\n\n    return normalized as BindingName\n  },\n\n  /**\n   * Check if a string is a valid BindingName\n   */\n  isValid(value: string): boolean {\n    return !!value && /^[A-Z_][A-Z0-9_]*$/.test(value.trim())\n  },\n\n  /**\n   * Safely create a BindingName, returning null if invalid\n   */\n  tryCreate(value: string): BindingName | null {\n    try {\n      return BindingName.create(value)\n    } catch {\n      return null\n    }\n  },\n\n  /**\n   * Unwrap a BindingName back to a string\n   */\n  unwrap(bindingName: BindingName): string {\n    return bindingName as string\n  },\n}\n\n/**\n * Version string validation and creation\n */\nexport const VersionString = {\n  /**\n   * Create a VersionString from a string\n   * @throws {Error} if the version string is invalid\n   */\n  create(value: string): VersionString {\n    if (!value || value.trim().length === 0) {\n      throw new Error('Version string cannot be empty')\n    }\n\n    return value.trim() as VersionString\n  },\n\n  /**\n   * Check if a string is a valid VersionString\n   */\n  isValid(value: string): boolean {\n    return !!value && value.trim().length > 0\n  },\n\n  /**\n   * Safely create a VersionString, returning null if invalid\n   */\n  tryCreate(value: string): VersionString | null {\n    try {\n      return VersionString.create(value)\n    } catch {\n      return null\n    }\n  },\n\n  /**\n   * Unwrap a VersionString back to a string\n   */\n  unwrap(versionString: VersionString): string {\n    return versionString as string\n  },\n}\n\n/**\n * Execution ID validation and creation\n */\nexport const ExecutionId = {\n  /**\n   * Create an ExecutionId from a string\n   * @throws {Error} if the execution ID is invalid\n   */\n  create(value: string): ExecutionId {\n    if (!value || value.trim().length === 0) {\n      throw new Error('Execution ID cannot be empty')\n    }\n\n    const normalized = value.trim()\n    if (!normalized.startsWith('exec_')) {\n      throw new Error(`Invalid execution ID format: \"${value}\" (must start with 'exec_')`)\n    }\n\n    return normalized as ExecutionId\n  },\n\n  /**\n   * Generate a new unique execution ID\n   */\n  generate(): ExecutionId {\n    return `exec_${crypto.randomUUID()}` as ExecutionId\n  },\n\n  /**\n   * Check if a string is a valid ExecutionId\n   */\n  isValid(value: string): boolean {\n    return !!value && value.trim().startsWith('exec_')\n  },\n\n  /**\n   * Safely create an ExecutionId, returning null if invalid\n   */\n  tryCreate(value: string): ExecutionId | null {\n    try {\n      return ExecutionId.create(value)\n    } catch {\n      return null\n    }\n  },\n\n  /**\n   * Unwrap an ExecutionId back to a string\n   */\n  unwrap(executionId: ExecutionId): string {\n    return executionId as string\n  },\n}\n\n/**\n * Request ID validation and creation\n */\nexport const RequestId = {\n  /**\n   * Create a RequestId from a string\n   * @throws {Error} if the request ID is invalid\n   */\n  create(value: string): RequestId {\n    if (!value || value.trim().length === 0) {\n      throw new Error('Request ID cannot be empty')\n    }\n\n    const normalized = value.trim()\n    if (!normalized.startsWith('req_')) {\n      throw new Error(`Invalid request ID format: \"${value}\" (must start with 'req_')`)\n    }\n\n    return normalized as RequestId\n  },\n\n  /**\n   * Generate a new unique request ID\n   */\n  generate(): RequestId {\n    return `req_${crypto.randomUUID()}` as RequestId\n  },\n\n  /**\n   * Check if a string is a valid RequestId\n   */\n  isValid(value: string): boolean {\n    return !!value && value.trim().startsWith('req_')\n  },\n\n  /**\n   * Safely create a RequestId, returning null if invalid\n   */\n  tryCreate(value: string): RequestId | null {\n    try {\n      return RequestId.create(value)\n    } catch {\n      return null\n    }\n  },\n\n  /**\n   * Unwrap a RequestId back to a string\n   */\n  unwrap(requestId: RequestId): string {\n    return requestId as string\n  },\n}\n\n/**\n * Resume Token validation and creation\n */\nexport const ResumeToken = {\n  /**\n   * Create a ResumeToken from a string\n   * @throws {Error} if the resume token is invalid\n   */\n  create(value: string): ResumeToken {\n    if (!value || value.trim().length === 0) {\n      throw new Error('Resume token cannot be empty')\n    }\n\n    const normalized = value.trim()\n    if (!normalized.startsWith('resume_')) {\n      throw new Error(`Invalid resume token format: \"${value}\" (must start with 'resume_')`)\n    }\n\n    return normalized as ResumeToken\n  },\n\n  /**\n   * Generate a new unique resume token\n   */\n  generate(): ResumeToken {\n    return `resume_${crypto.randomUUID()}` as ResumeToken\n  },\n\n  /**\n   * Check if a string is a valid ResumeToken\n   */\n  isValid(value: string): boolean {\n    return !!value && value.trim().startsWith('resume_')\n  },\n\n  /**\n   * Safely create a ResumeToken, returning null if invalid\n   */\n  tryCreate(value: string): ResumeToken | null {\n    try {\n      return ResumeToken.create(value)\n    } catch {\n      return null\n    }\n  },\n\n  /**\n   * Unwrap a ResumeToken back to a string\n   */\n  unwrap(resumeToken: ResumeToken): string {\n    return resumeToken as string\n  },\n}\n\n/**\n * Cache Key validation and creation\n */\nexport const CacheKey = {\n  /**\n   * Create a CacheKey from a string\n   * @throws {Error} if the cache key is invalid\n   */\n  create(value: string): CacheKey {\n    if (!value || value.trim().length === 0) {\n      throw new Error('Cache key cannot be empty')\n    }\n\n    return value.trim() as CacheKey\n  },\n\n  /**\n   * Generate a cache key from components\n   */\n  generate(prefix: string, ...parts: string[]): CacheKey {\n    const key = [prefix, ...parts].join(':')\n    return key as CacheKey\n  },\n\n  /**\n   * Check if a string is a valid CacheKey\n   */\n  isValid(value: string): boolean {\n    return !!value && value.trim().length > 0\n  },\n\n  /**\n   * Safely create a CacheKey, returning null if invalid\n   */\n  tryCreate(value: string): CacheKey | null {\n    try {\n      return CacheKey.create(value)\n    } catch {\n      return null\n    }\n  },\n\n  /**\n   * Unwrap a CacheKey back to a string\n   */\n  unwrap(cacheKey: CacheKey): string {\n    return cacheKey as string\n  },\n}\n","/**\n * Observability Context Management\n *\n * Handles execution context propagation for logging and metrics.\n * Provides scoped loggers and metrics recorders that automatically\n * include request/execution context.\n */\n\nimport type { Logger, LogContext, MetricDataPoint } from './types.js'\nimport { ConductorLogger, createLogger } from './logger.js'\nimport type {\n  ObservabilityConfig,\n  LoggingConfig,\n  MetricsConfig,\n  LogEventType,\n  MetricType,\n} from '../config/types.js'\nimport { LogLevel } from './types.js'\nimport {\n  ExecutionId,\n  RequestId,\n  type ExecutionId as ExecutionIdType,\n  type RequestId as RequestIdType,\n} from '../types/branded.js'\n\n/**\n * Default redaction patterns\n */\nexport const DEFAULT_REDACT_PATTERNS = [\n  'password',\n  'apiKey',\n  'api_key',\n  'token',\n  'authorization',\n  'secret',\n  'creditCard',\n  'credit_card',\n  'ssn',\n  'socialSecurityNumber',\n]\n\n/**\n * Default log events to track\n */\nexport const DEFAULT_LOG_EVENTS: LogEventType[] = [\n  'request',\n  'response',\n  'agent:start',\n  'agent:complete',\n  'agent:error',\n]\n\n/**\n * Normalize URL path to reduce cardinality in metrics\n *\n * Replaces dynamic segments (IDs, UUIDs, numbers) with placeholders\n * to prevent metrics explosion from unique paths.\n *\n * @example\n * '/api/users/123' -> '/api/users/:id'\n * '/api/orders/abc-123-def' -> '/api/orders/:id'\n * '/api/v1/products/42/reviews' -> '/api/v1/products/:id/reviews'\n */\nexport function normalizePathForMetrics(path: string): string {\n  // Remove query string and hash\n  const pathOnly = path.split('?')[0].split('#')[0]\n\n  // Split into segments and normalize each\n  return pathOnly\n    .split('/')\n    .map((segment) => {\n      if (!segment) return segment\n\n      // UUID pattern (8-4-4-4-12)\n      if (/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(segment)) {\n        return ':uuid'\n      }\n\n      // Numeric ID\n      if (/^\\d+$/.test(segment)) {\n        return ':id'\n      }\n\n      // Alphanumeric ID with hyphens/underscores (common slug patterns)\n      // Only normalize if it looks like an ID (contains numbers and is reasonably short)\n      if (/^[a-zA-Z0-9_-]+$/.test(segment) && /\\d/.test(segment) && segment.length <= 36) {\n        return ':id'\n      }\n\n      return segment\n    })\n    .join('/')\n}\n\n/**\n * Default metric types to track\n */\nexport const DEFAULT_METRIC_TYPES: MetricType[] = [\n  'ensemble:execution',\n  'agent:execution',\n  'http:request',\n  'error',\n]\n\n/**\n * Resolved observability configuration with defaults applied\n */\nexport interface ResolvedObservabilityConfig {\n  logging: {\n    enabled: boolean\n    level: LogLevel\n    format: 'json' | 'pretty'\n    context: string[]\n    redact: string[]\n    events: Set<LogEventType>\n  }\n  metrics: {\n    enabled: boolean\n    binding: string\n    track: Set<MetricType>\n    dimensions: string[]\n  }\n  opentelemetry: {\n    enabled: boolean\n    endpoint?: string\n    headers?: Record<string, string>\n    samplingRate: number\n  }\n  trackTokenUsage: boolean\n}\n\n/**\n * Resolve observability config with defaults\n */\nexport function resolveObservabilityConfig(\n  config?: ObservabilityConfig\n): ResolvedObservabilityConfig {\n  // Handle logging config\n  let loggingConfig: LoggingConfig\n  if (config?.logging === false) {\n    loggingConfig = { enabled: false }\n  } else if (config?.logging === true || config?.logging === undefined) {\n    loggingConfig = { enabled: true }\n  } else {\n    loggingConfig = config.logging\n  }\n\n  // Handle metrics config\n  let metricsConfig: MetricsConfig\n  if (config?.metrics === false) {\n    metricsConfig = { enabled: false }\n  } else if (config?.metrics === true || config?.metrics === undefined) {\n    metricsConfig = { enabled: true }\n  } else {\n    metricsConfig = config.metrics\n  }\n\n  return {\n    logging: {\n      enabled: loggingConfig.enabled !== false,\n      level: stringToLogLevel(loggingConfig.level ?? 'info'),\n      format: loggingConfig.format ?? 'json',\n      context: loggingConfig.context ?? ['requestId', 'executionId', 'ensembleName', 'agentName'],\n      redact: loggingConfig.redact ?? DEFAULT_REDACT_PATTERNS,\n      events: new Set(loggingConfig.events ?? DEFAULT_LOG_EVENTS),\n    },\n    metrics: {\n      enabled: metricsConfig.enabled !== false,\n      binding: metricsConfig.binding ?? 'ANALYTICS',\n      track: new Set(metricsConfig.track ?? DEFAULT_METRIC_TYPES),\n      dimensions: metricsConfig.dimensions ?? [],\n    },\n    opentelemetry: {\n      enabled: config?.opentelemetry?.enabled ?? false,\n      endpoint: config?.opentelemetry?.endpoint,\n      headers: config?.opentelemetry?.headers,\n      samplingRate: config?.opentelemetry?.samplingRate ?? 1.0,\n    },\n    trackTokenUsage: config?.trackTokenUsage ?? true,\n  }\n}\n\n/**\n * Convert string log level to LogLevel enum\n */\nfunction stringToLogLevel(level: string): LogLevel {\n  switch (level.toLowerCase()) {\n    case 'debug':\n      return LogLevel.DEBUG\n    case 'info':\n      return LogLevel.INFO\n    case 'warn':\n      return LogLevel.WARN\n    case 'error':\n      return LogLevel.ERROR\n    default:\n      return LogLevel.INFO\n  }\n}\n\n/**\n * Generate a unique execution ID\n * Returns a branded ExecutionId type for type safety\n */\nexport function generateExecutionId(): ExecutionIdType {\n  return ExecutionId.generate()\n}\n\n/**\n * Generate a unique request ID\n * Returns a branded RequestId type for type safety\n */\nexport function generateRequestId(): RequestIdType {\n  return RequestId.generate()\n}\n\n/**\n * Execution context for observability\n * Contains all context needed for logging and metrics\n */\nexport interface ExecutionObservabilityContext {\n  /** Unique request ID (from HTTP request) - branded type for safety */\n  requestId: RequestIdType\n  /** Unique execution ID (for ensemble execution) - branded type for safety */\n  executionId: ExecutionIdType\n  /** Ensemble name being executed */\n  ensembleName?: string\n  /** Current agent name */\n  agentName?: string\n  /** Current step index in the flow */\n  stepIndex?: number\n  /** User ID (if authenticated) */\n  userId?: string\n  /** Session ID */\n  sessionId?: string\n  /** Environment name */\n  environment?: string\n  /** Custom dimensions */\n  [key: string]: unknown\n}\n\n/**\n * Metrics recorder for Analytics Engine\n */\nexport interface MetricsRecorder {\n  /**\n   * Record a metric to Analytics Engine\n   */\n  record(name: string, value: number, dimensions?: Record<string, string>): void\n\n  /**\n   * Record ensemble execution metric\n   */\n  recordEnsembleExecution(ensembleName: string, durationMs: number, success: boolean): void\n\n  /**\n   * Record agent execution metric\n   */\n  recordAgentExecution(\n    agentName: string,\n    durationMs: number,\n    success: boolean,\n    cached?: boolean\n  ): void\n\n  /**\n   * Record HTTP request metric\n   */\n  recordHttpRequest(method: string, path: string, statusCode: number, durationMs: number): void\n\n  /**\n   * Record error metric\n   */\n  recordError(errorType: string, errorCode?: string): void\n\n  /**\n   * Record cache performance metric\n   */\n  recordCachePerformance(hit: boolean, agentName?: string): void\n}\n\n/**\n * Create a metrics recorder that writes to Analytics Engine\n */\nexport function createMetricsRecorder(\n  analyticsEngine: AnalyticsEngineDataset | undefined,\n  config: ResolvedObservabilityConfig,\n  baseContext: ExecutionObservabilityContext\n): MetricsRecorder {\n  const shouldTrack = (type: MetricType): boolean => {\n    return config.metrics.enabled && config.metrics.track.has(type)\n  }\n\n  const writeMetric = (data: MetricDataPoint): void => {\n    if (!analyticsEngine || !config.metrics.enabled) return\n\n    try {\n      analyticsEngine.writeDataPoint({\n        blobs: data.blobs ?? [],\n        doubles: data.doubles ?? [],\n        indexes: data.indexes ?? [],\n      })\n    } catch {\n      // Silently ignore metrics failures - don't crash the app\n    }\n  }\n\n  return {\n    record(name: string, value: number, dimensions?: Record<string, string>): void {\n      writeMetric({\n        blobs: [name, ...(dimensions ? Object.values(dimensions) : [])],\n        doubles: [value],\n        indexes: [name],\n      })\n    },\n\n    recordEnsembleExecution(ensembleName: string, durationMs: number, success: boolean): void {\n      if (!shouldTrack('ensemble:execution')) return\n\n      writeMetric({\n        blobs: [\n          ensembleName,\n          success ? 'success' : 'failure',\n          baseContext.environment ?? 'unknown',\n        ],\n        doubles: [durationMs, success ? 1 : 0],\n        indexes: ['ensemble.execution'],\n      })\n    },\n\n    recordAgentExecution(\n      agentName: string,\n      durationMs: number,\n      success: boolean,\n      cached = false\n    ): void {\n      if (!shouldTrack('agent:execution')) return\n\n      writeMetric({\n        blobs: [\n          agentName,\n          success ? 'success' : 'failure',\n          cached ? 'cached' : 'executed',\n          baseContext.ensembleName ?? 'unknown',\n        ],\n        doubles: [durationMs, success ? 1 : 0, cached ? 1 : 0],\n        indexes: ['agent.execution'],\n      })\n    },\n\n    recordHttpRequest(method: string, path: string, statusCode: number, durationMs: number): void {\n      if (!shouldTrack('http:request')) return\n\n      const statusCategory =\n        statusCode < 400 ? 'success' : statusCode < 500 ? 'client_error' : 'server_error'\n\n      // Normalize path to reduce cardinality (replace IDs with placeholders)\n      const normalizedPath = normalizePathForMetrics(path)\n\n      writeMetric({\n        blobs: [method, normalizedPath, statusCategory, String(statusCode)],\n        doubles: [durationMs, 1],\n        indexes: ['http.request'],\n      })\n    },\n\n    recordError(errorType: string, errorCode?: string): void {\n      if (!shouldTrack('error')) return\n\n      writeMetric({\n        blobs: [\n          errorType,\n          errorCode ?? 'unknown',\n          baseContext.ensembleName ?? 'unknown',\n          baseContext.agentName ?? 'unknown',\n        ],\n        doubles: [1],\n        indexes: ['error'],\n      })\n    },\n\n    recordCachePerformance(hit: boolean, agentName?: string): void {\n      if (!shouldTrack('cache:performance')) return\n\n      writeMetric({\n        blobs: [\n          hit ? 'hit' : 'miss',\n          agentName ?? 'unknown',\n          baseContext.ensembleName ?? 'unknown',\n        ],\n        doubles: [1],\n        indexes: ['cache.performance'],\n      })\n    },\n  }\n}\n\n/**\n * Redact sensitive fields from an object\n */\nexport function redactSensitiveFields(\n  obj: Record<string, unknown>,\n  patterns: string[]\n): Record<string, unknown> {\n  const result: Record<string, unknown> = {}\n\n  for (const [key, value] of Object.entries(obj)) {\n    // Check if this key matches any redaction pattern\n    const shouldRedact = patterns.some((pattern) => {\n      const lowerKey = key.toLowerCase()\n      const lowerPattern = pattern.toLowerCase()\n      return lowerKey.includes(lowerPattern) || lowerKey === lowerPattern\n    })\n\n    if (shouldRedact) {\n      result[key] = '[REDACTED]'\n    } else if (typeof value === 'object' && value !== null && !Array.isArray(value)) {\n      // Recursively redact nested objects\n      result[key] = redactSensitiveFields(value as Record<string, unknown>, patterns)\n    } else {\n      result[key] = value\n    }\n  }\n\n  return result\n}\n\n/**\n * Create a scoped logger for execution context\n */\nexport function createScopedLogger(\n  config: ResolvedObservabilityConfig,\n  context: ExecutionObservabilityContext,\n  analyticsEngine?: AnalyticsEngineDataset\n): Logger {\n  if (!config.logging.enabled) {\n    // Return a no-op logger\n    return {\n      debug: () => {},\n      info: () => {},\n      warn: () => {},\n      error: () => {},\n      child: () => createScopedLogger(config, context, analyticsEngine),\n      metric: () => {},\n    }\n  }\n\n  // Build base context from execution context\n  const baseContext: LogContext = {}\n  for (const field of config.logging.context) {\n    if (field in context && context[field] !== undefined) {\n      baseContext[field] = context[field]\n    }\n  }\n\n  return new ConductorLogger(\n    {\n      level: config.logging.level,\n      serviceName: 'conductor',\n      enableAnalytics: config.metrics.enabled,\n      baseContext,\n    },\n    analyticsEngine,\n    baseContext\n  )\n}\n\n/**\n * Observability manager for a single request/execution\n */\nexport class ObservabilityManager {\n  private config: ResolvedObservabilityConfig\n  private context: ExecutionObservabilityContext\n  private logger: Logger\n  private metrics: MetricsRecorder\n  private analyticsEngine?: AnalyticsEngineDataset\n\n  constructor(\n    config: ObservabilityConfig | undefined,\n    initialContext: Partial<ExecutionObservabilityContext>,\n    analyticsEngine?: AnalyticsEngineDataset\n  ) {\n    this.config = resolveObservabilityConfig(config)\n    this.analyticsEngine = analyticsEngine\n    this.context = {\n      requestId: initialContext.requestId ?? generateRequestId(),\n      executionId: initialContext.executionId ?? generateExecutionId(),\n      ...initialContext,\n    }\n\n    this.logger = createScopedLogger(this.config, this.context, analyticsEngine)\n    this.metrics = createMetricsRecorder(analyticsEngine, this.config, this.context)\n  }\n\n  /**\n   * Internal method to set resolved config (used by child managers)\n   */\n  private setResolvedConfig(resolvedConfig: ResolvedObservabilityConfig): void {\n    this.config = resolvedConfig\n  }\n\n  /**\n   * Create a child manager with inherited config\n   */\n  private static createChild(\n    resolvedConfig: ResolvedObservabilityConfig,\n    context: Partial<ExecutionObservabilityContext>,\n    analyticsEngine?: AnalyticsEngineDataset\n  ): ObservabilityManager {\n    const manager = new ObservabilityManager(undefined, context, analyticsEngine)\n    manager.setResolvedConfig(resolvedConfig)\n    return manager\n  }\n\n  /**\n   * Get the current logger\n   */\n  getLogger(): Logger {\n    return this.logger\n  }\n\n  /**\n   * Get the metrics recorder\n   */\n  getMetrics(): MetricsRecorder {\n    return this.metrics\n  }\n\n  /**\n   * Get the current execution context\n   */\n  getContext(): ExecutionObservabilityContext {\n    return { ...this.context }\n  }\n\n  /**\n   * Get the resolved config\n   */\n  getConfig(): ResolvedObservabilityConfig {\n    return this.config\n  }\n\n  /**\n   * Check if a log event should be logged\n   */\n  shouldLogEvent(event: LogEventType): boolean {\n    return this.config.logging.enabled && this.config.logging.events.has(event)\n  }\n\n  /**\n   * Check if a metric type should be tracked\n   */\n  shouldTrackMetric(type: MetricType): boolean {\n    return this.config.metrics.enabled && this.config.metrics.track.has(type)\n  }\n\n  /**\n   * Create a child manager with additional context (e.g., for an agent)\n   */\n  forAgent(agentName: string, stepIndex?: number): ObservabilityManager {\n    const childContext = {\n      ...this.context,\n      agentName,\n      stepIndex,\n    }\n\n    return ObservabilityManager.createChild(this.config, childContext, this.analyticsEngine)\n  }\n\n  /**\n   * Create a child manager for an ensemble\n   */\n  forEnsemble(ensembleName: string, executionId?: ExecutionIdType): ObservabilityManager {\n    const childContext = {\n      ...this.context,\n      ensembleName,\n      executionId: executionId ?? generateExecutionId(),\n    }\n\n    return ObservabilityManager.createChild(this.config, childContext, this.analyticsEngine)\n  }\n\n  /**\n   * Redact sensitive fields from data\n   */\n  redact(data: Record<string, unknown>): Record<string, unknown> {\n    return redactSensitiveFields(data, this.config.logging.redact)\n  }\n}\n\n/**\n * Create an observability manager\n */\nexport function createObservabilityManager(\n  config?: ObservabilityConfig,\n  initialContext?: Partial<ExecutionObservabilityContext>,\n  analyticsEngine?: AnalyticsEngineDataset\n): ObservabilityManager {\n  return new ObservabilityManager(config, initialContext ?? {}, analyticsEngine)\n}\n","/**\n * Ensemble Primitive\n *\n * The core primitive for creating ensembles programmatically.\n * Produces the same structure as YAML parsing.\n */\n\nimport type {\n  FlowStepType,\n  StateConfig,\n  EnsembleHooks,\n  Context,\n  AgentSchemaConfig,\n} from './types.js'\n\n/**\n * Trigger configuration types\n */\nexport interface WebhookTrigger {\n  type: 'webhook'\n  path?: string\n  methods?: ('POST' | 'GET' | 'PUT' | 'PATCH' | 'DELETE')[]\n  auth?: {\n    type: 'bearer' | 'signature' | 'basic'\n    secret: string\n  }\n  public?: boolean\n  mode?: 'trigger' | 'resume'\n  async?: boolean\n  timeout?: number\n}\n\nexport interface HttpTrigger {\n  type: 'http'\n  path?: string\n  methods?: ('GET' | 'POST' | 'PUT' | 'PATCH' | 'DELETE' | 'HEAD' | 'OPTIONS')[]\n  auth?: {\n    type: 'bearer' | 'signature' | 'basic'\n    secret: string\n  }\n  public?: boolean\n  mode?: 'trigger' | 'resume'\n  async?: boolean\n  timeout?: number\n  rateLimit?: {\n    requests: number\n    window: number\n    key?: 'ip' | 'user'\n  }\n  cors?: {\n    origin?: string | string[]\n    methods?: string[]\n    allowHeaders?: string[]\n    exposeHeaders?: string[]\n    credentials?: boolean\n  }\n  /**\n   * Internal agent cache configuration\n   * @deprecated Use agent-level cache config instead\n   */\n  cache?: {\n    enabled: boolean\n    ttl: number\n    vary?: string[]\n    tags?: string[]\n  }\n\n  /**\n   * HTTP Cache-Control headers for CDN/browser caching\n   *\n   * NOTE: This is separate from agent `cache:` config which controls\n   * internal computation caching. This controls HTTP response headers.\n   *\n   * @example\n   * ```yaml\n   * httpCache:\n   *   public: true\n   *   maxAge: 300\n   *   staleWhileRevalidate: 60\n   * ```\n   */\n  httpCache?: {\n    /** Cache-Control: max-age=N (seconds) */\n    maxAge?: number\n    /** Cache-Control: public (CDN can cache) */\n    public?: boolean\n    /** Cache-Control: private (browser only, not CDN) */\n    private?: boolean\n    /** Cache-Control: no-cache (must revalidate) */\n    noCache?: boolean\n    /** Cache-Control: no-store (don't cache at all) */\n    noStore?: boolean\n    /** stale-while-revalidate=N (seconds) */\n    staleWhileRevalidate?: number\n    /** stale-if-error=N (seconds) */\n    staleIfError?: number\n    /** Vary header values (merged with auth-added values) */\n    vary?: string[]\n    /** Custom Cache-Control directives */\n    custom?: string\n  }\n\n  middleware?: string[]\n  responses?: {\n    html?: { enabled: boolean }\n    json?: { enabled: boolean }\n    stream?: { enabled: boolean; chunkSize?: number }\n  }\n  templateEngine?: 'handlebars' | 'liquid' | 'simple'\n}\n\nexport interface McpTrigger {\n  type: 'mcp'\n  auth?: {\n    type: 'bearer' | 'oauth'\n    secret?: string\n  }\n  public?: boolean\n}\n\nexport interface EmailTrigger {\n  type: 'email'\n  addresses: string[]\n  auth?: {\n    from: string[]\n  }\n  public?: boolean\n  reply_with_output?: boolean\n}\n\nexport interface QueueTrigger {\n  type: 'queue'\n  queue: string\n  batch_size?: number\n  max_retries?: number\n  max_wait_time?: number\n}\n\nexport interface CronTrigger {\n  type: 'cron'\n  cron: string\n  timezone?: string\n  enabled?: boolean\n  input?: Record<string, unknown>\n  metadata?: Record<string, unknown>\n}\n\nexport type TriggerConfig =\n  | WebhookTrigger\n  | HttpTrigger\n  | McpTrigger\n  | EmailTrigger\n  | QueueTrigger\n  | CronTrigger\n\n/**\n * Notification configuration types\n */\nexport interface WebhookNotification {\n  type: 'webhook'\n  url: string\n  events: (\n    | 'execution.started'\n    | 'execution.completed'\n    | 'execution.failed'\n    | 'execution.timeout'\n    | 'agent.completed'\n    | 'state.updated'\n  )[]\n  secret?: string\n  retries?: number\n  timeout?: number\n}\n\nexport interface EmailNotification {\n  type: 'email'\n  to: string[]\n  events: (\n    | 'execution.started'\n    | 'execution.completed'\n    | 'execution.failed'\n    | 'execution.timeout'\n    | 'agent.completed'\n    | 'state.updated'\n  )[]\n  subject?: string\n  from?: string\n}\n\nexport type NotificationConfig = WebhookNotification | EmailNotification\n\n/**\n * Scoring configuration\n */\nexport interface ScoringConfig {\n  enabled: boolean\n  defaultThresholds: {\n    minimum: number\n    target?: number\n    excellent?: number\n  }\n  maxRetries?: number\n  backoffStrategy?: 'linear' | 'exponential' | 'fixed'\n  initialBackoff?: number\n  trackInState?: boolean\n  criteria?: Record<string, string> | unknown[]\n  aggregation?: 'weighted_average' | 'minimum' | 'geometric_mean'\n}\n\n/**\n * Inline agent configuration (for agents defined within ensemble)\n */\nexport interface InlineAgentConfig {\n  name: string\n  operation: string\n  description?: string\n  config?: Record<string, unknown>\n  schema?: AgentSchemaConfig\n}\n\n/**\n * Ensemble configuration options\n */\nexport interface EnsembleOptions {\n  /** Unique ensemble name */\n  name: string\n\n  /** Version string */\n  version?: string\n\n  /** Human-readable description */\n  description?: string\n\n  /**\n   * Execution steps - can be static array or dynamic function\n   *\n   * Static: steps are defined at creation time\n   * Dynamic: steps are generated at runtime based on context\n   */\n  steps: FlowStepType[] | ((context: Context) => FlowStepType[] | Promise<FlowStepType[]>)\n\n  /** Inline agent definitions */\n  agents?: InlineAgentConfig[]\n\n  /** State management configuration */\n  state?: StateConfig\n\n  /** Scoring configuration */\n  scoring?: ScoringConfig\n\n  /** Trigger configurations (how the ensemble is invoked) */\n  trigger?: TriggerConfig[]\n\n  /** Notification configurations (outbound events) */\n  notifications?: NotificationConfig[]\n\n  /** Input schema definition */\n  inputs?: Record<string, unknown>\n\n  /** Output mapping */\n  output?: Record<string, unknown>\n\n  /**\n   * Control whether this ensemble can be executed via the Execute API\n   * (/api/v1/execute/ensemble/:name)\n   *\n   * When api.execution.ensembles.requireExplicit is false (default):\n   *   - Ensembles are executable unless apiExecutable: false\n   * When api.execution.ensembles.requireExplicit is true:\n   *   - Ensembles need apiExecutable: true to be executable\n   */\n  apiExecutable?: boolean\n\n  // =========================================================================\n  // Lifecycle Hooks (TypeScript-only feature)\n  // =========================================================================\n\n  /**\n   * Called before execution starts\n   *\n   * @example\n   * ```typescript\n   * beforeExecute: async (context) => {\n   *   console.log(`Starting ensemble with input:`, context.input);\n   *   await analytics.track('ensemble_started');\n   * }\n   * ```\n   */\n  beforeExecute?: (context: Context) => void | Promise<void>\n\n  /**\n   * Called after execution completes successfully\n   *\n   * @example\n   * ```typescript\n   * afterExecute: async (result, context) => {\n   *   await analytics.track('ensemble_completed', {\n   *     duration: result.metrics.totalDuration\n   *   });\n   * }\n   * ```\n   */\n  afterExecute?: (result: unknown, context: Context) => void | Promise<void>\n\n  /**\n   * Called when an error occurs in a step\n   *\n   * @returns Action to take: 'retry', 'skip', or 'fail'\n   *\n   * @example\n   * ```typescript\n   * onError: (error, step, context) => {\n   *   if (error.code === 'NETWORK_ERROR') {\n   *     return 'retry';\n   *   }\n   *   return 'fail';\n   * }\n   * ```\n   */\n  onError?: (error: Error, step: FlowStepType, context: Context) => 'retry' | 'skip' | 'fail'\n}\n\n/**\n * Ensemble class - runtime representation of an ensemble\n *\n * This class is the canonical runtime object for both YAML and TS ensembles.\n */\nexport class Ensemble {\n  /** Ensemble name */\n  public readonly name: string\n\n  /** Version string */\n  public readonly version?: string\n\n  /** Description */\n  public readonly description?: string\n\n  /** Static steps (if not dynamic) */\n  public readonly staticSteps?: FlowStepType[]\n\n  /** Inline agent definitions */\n  public readonly agents?: InlineAgentConfig[]\n\n  /** State configuration */\n  public readonly state?: StateConfig\n\n  /** Scoring configuration */\n  public readonly scoring?: ScoringConfig\n\n  /** Triggers */\n  public readonly trigger?: TriggerConfig[]\n\n  /** Notifications */\n  public readonly notifications?: NotificationConfig[]\n\n  /** Input schema */\n  public readonly inputs?: Record<string, unknown>\n\n  /** Output mapping */\n  public readonly output?: Record<string, unknown>\n\n  /** Lifecycle hooks */\n  public readonly hooks?: EnsembleHooks\n\n  /** Whether steps are dynamically generated */\n  public readonly isDynamic: boolean\n\n  /** Control Execute API access */\n  public readonly apiExecutable?: boolean\n\n  constructor(options: EnsembleOptions) {\n    this.name = options.name\n    this.version = options.version\n    this.description = options.description\n    this.agents = options.agents\n    this.state = options.state\n    this.scoring = options.scoring\n    this.trigger = options.trigger\n    this.notifications = options.notifications\n    this.inputs = options.inputs\n    this.output = options.output\n    this.apiExecutable = options.apiExecutable\n\n    // Determine if steps are static or dynamic\n    if (typeof options.steps === 'function') {\n      this.isDynamic = true\n      this.hooks = {\n        dynamicSteps: options.steps,\n        beforeExecute: options.beforeExecute,\n        afterExecute: options.afterExecute,\n        onError: options.onError,\n      }\n    } else {\n      this.isDynamic = false\n      this.staticSteps = options.steps\n      this.hooks = {\n        beforeExecute: options.beforeExecute,\n        afterExecute: options.afterExecute,\n        onError: options.onError,\n      }\n    }\n  }\n\n  /**\n   * Resolve steps for execution\n   *\n   * For static ensembles, returns the static steps.\n   * For dynamic ensembles, calls the step generator function.\n   */\n  async resolveSteps(context: Context): Promise<FlowStepType[]> {\n    if (this.isDynamic && this.hooks?.dynamicSteps) {\n      return await this.hooks.dynamicSteps(context)\n    }\n    return this.staticSteps ?? []\n  }\n\n  /**\n   * Get the flow steps (for backward compatibility)\n   *\n   * Note: For dynamic ensembles, this returns an empty array.\n   * Use resolveSteps() for runtime step resolution.\n   */\n  get flow(): FlowStepType[] {\n    return this.staticSteps ?? []\n  }\n\n  /**\n   * Convert to plain config object (for serialization/YAML export)\n   */\n  toConfig(): EnsembleConfig {\n    return {\n      name: this.name,\n      description: this.description,\n      state: this.state,\n      scoring: this.scoring,\n      trigger: this.trigger,\n      notifications: this.notifications,\n      agents: this.agents as unknown as Record<string, unknown>[] | undefined,\n      flow: this.staticSteps,\n      inputs: this.inputs,\n      output: this.output,\n    }\n  }\n}\n\n/**\n * Type alias for serializable ensemble config\n */\nexport interface EnsembleConfig {\n  name: string\n  description?: string\n  state?: StateConfig\n  scoring?: ScoringConfig\n  trigger?: TriggerConfig[]\n  notifications?: NotificationConfig[]\n  agents?: Record<string, unknown>[]\n  flow?: FlowStepType[]\n  inputs?: Record<string, unknown>\n  output?: Record<string, unknown>\n}\n\n/**\n * Create an ensemble programmatically\n *\n * @param options - Ensemble configuration\n * @returns Ensemble instance\n *\n * @example\n * ```typescript\n * // Simple static ensemble\n * const pipeline = createEnsemble({\n *   name: 'data-pipeline',\n *   steps: [\n *     step('fetch', { operation: 'http', config: { url: '...' } }),\n *     step('transform', { script: 'scripts/transform' }),\n *     step('store', { operation: 'storage', config: { ... } })\n *   ]\n * });\n *\n * // Dynamic ensemble with runtime step generation\n * const adaptive = createEnsemble({\n *   name: 'adaptive-pipeline',\n *   steps: (context) => {\n *     const sources = context.input.sources as string[];\n *     return [\n *       parallel(sources.map(url =>\n *         step(`fetch-${url}`, { operation: 'http', config: { url } })\n *       )),\n *       step('merge', { script: 'scripts/merge' })\n *     ];\n *   }\n * });\n *\n * // Ensemble with triggers and hooks\n * const service = createEnsemble({\n *   name: 'user-service',\n *   steps: [\n *     step('validate'),\n *     step('process'),\n *     step('respond')\n *   ],\n *   trigger: [{\n *     type: 'http',\n *     path: '/users',\n *     methods: ['POST'],\n *     public: false,\n *     auth: { type: 'bearer', secret: '${env.API_SECRET}' }\n *   }],\n *   beforeExecute: async (ctx) => {\n *     console.log('Request received');\n *   },\n *   afterExecute: async (result, ctx) => {\n *     console.log('Request completed');\n *   }\n * });\n * ```\n */\nexport function createEnsemble(options: EnsembleOptions): Ensemble {\n  // Validate required fields\n  if (!options.name || typeof options.name !== 'string') {\n    throw new Error('Ensemble name is required and must be a string')\n  }\n\n  if (!options.steps) {\n    throw new Error('Ensemble steps are required')\n  }\n\n  return new Ensemble(options)\n}\n\n/**\n * Check if a value is an Ensemble instance\n */\nexport function isEnsemble(value: unknown): value is Ensemble {\n  return value instanceof Ensemble\n}\n\n/**\n * Create an ensemble from a plain config object (for YAML parsing)\n *\n * This is used internally by the parser to convert parsed YAML to an Ensemble.\n */\nexport function ensembleFromConfig(config: EnsembleConfig): Ensemble {\n  return new Ensemble({\n    name: config.name,\n    description: config.description,\n    steps: config.flow ?? [],\n    agents: config.agents as unknown as InlineAgentConfig[] | undefined,\n    state: config.state,\n    scoring: config.scoring,\n    trigger: config.trigger,\n    notifications: config.notifications,\n    inputs: config.inputs,\n    output: config.output,\n  })\n}\n","/**\n * YAML Parser - Refactored with Interpolation System\n *\n * Uses composition-based interpolation resolvers.\n * Reduced resolveInterpolation from 42 lines to 1 line via chain of responsibility.\n *\n * The parser converts YAML to validated config objects, which can then be\n * converted to Ensemble instances using ensembleFromConfig().\n *\n * Architecture:\n * - YAML  Parser  EnsembleConfig  ensembleFromConfig()  Ensemble\n * - TypeScript  createEnsemble()  Ensemble\n * - Both paths produce identical Ensemble instances\n *\n * Type Unification:\n * - Zod schemas are the SINGLE SOURCE OF TRUTH for all type definitions\n * - TypeScript types are derived using z.infer<typeof Schema>\n * - This ensures runtime validation and TypeScript types are always in sync\n */\n\nimport * as YAML from 'yaml'\nimport { z } from 'zod'\nimport { getInterpolator } from './interpolation/index.js'\nimport type { ResolutionContext } from './interpolation/index.js'\nimport { Operation } from '../types/constants.js'\nimport { EnsembleOutputSchema } from './output-types.js'\nimport { createLogger } from '../observability/index.js'\n\nconst logger = createLogger({ serviceName: 'parser' })\n\n// Import ensemble factory for creating Ensemble instances from parsed config\nimport { ensembleFromConfig, Ensemble, isEnsemble } from '../primitives/ensemble.js'\n\n// Re-export for convenience\nexport { ensembleFromConfig, Ensemble, isEnsemble }\n\n// ============================================================================\n// Flow Step Schemas (Source of Truth)\n// ============================================================================\n\n/**\n * Base schema for agent flow steps (the most common type)\n */\nexport const AgentFlowStepSchema = z.object({\n  agent: z.string().min(1, 'Agent name is required'),\n  id: z.string().optional(),\n  name: z.string().optional(), // Alias for id - used for output references like ${name.output}\n  input: z.record(z.unknown()).optional(),\n  state: z\n    .object({\n      use: z.array(z.string()).optional(),\n      set: z.array(z.string()).optional(),\n    })\n    .optional(),\n  cache: z\n    .object({\n      ttl: z.number().positive().optional(),\n      bypass: z.boolean().optional(),\n    })\n    .optional(),\n  scoring: z\n    .object({\n      evaluator: z.string().min(1),\n      thresholds: z\n        .object({\n          minimum: z.number().min(0).max(1).optional(),\n          target: z.number().min(0).max(1).optional(),\n          excellent: z.number().min(0).max(1).optional(),\n        })\n        .optional(),\n      criteria: z.union([z.record(z.string()), z.array(z.unknown())]).optional(),\n      onFailure: z.enum(['retry', 'continue', 'abort']).optional(),\n      retryLimit: z.number().positive().optional(),\n      requireImprovement: z.boolean().optional(),\n      minImprovement: z.number().min(0).max(1).optional(),\n    })\n    .optional(),\n  condition: z.unknown().optional(),\n  when: z.unknown().optional(), // Alias for condition\n  depends_on: z.array(z.string()).optional(),\n  retry: z\n    .object({\n      attempts: z.number().positive().optional(),\n      backoff: z.enum(['linear', 'exponential', 'fixed']).optional(),\n      initialDelay: z.number().positive().optional(),\n      maxDelay: z.number().positive().optional(),\n      retryOn: z.array(z.string()).optional(),\n    })\n    .optional(),\n  timeout: z.number().positive().optional(),\n  onTimeout: z\n    .object({\n      fallback: z.unknown().optional(),\n      error: z.boolean().optional(),\n    })\n    .optional(),\n})\n\n/**\n * Parallel execution step - runs multiple steps concurrently\n */\nexport const ParallelFlowStepSchema = z.object({\n  type: z.literal('parallel'),\n  steps: z.array(z.lazy(() => FlowStepSchema)),\n  waitFor: z.enum(['all', 'any', 'first']).optional(), // Default: 'all'\n})\n\n/**\n * Branch step - conditional branching with then/else\n */\nexport const BranchFlowStepSchema = z.object({\n  type: z.literal('branch'),\n  condition: z.unknown(),\n  then: z.array(z.lazy(() => FlowStepSchema)),\n  else: z.array(z.lazy(() => FlowStepSchema)).optional(),\n})\n\n/**\n * Foreach step - iterate over items\n */\nexport const ForeachFlowStepSchema = z.object({\n  type: z.literal('foreach'),\n  items: z.unknown(), // Expression like ${input.items}\n  maxConcurrency: z.number().positive().optional(),\n  breakWhen: z.unknown().optional(), // Early exit condition\n  step: z.lazy(() => FlowStepSchema),\n})\n\n/**\n * Try/catch step - error handling\n */\nexport const TryFlowStepSchema = z.object({\n  type: z.literal('try'),\n  steps: z.array(z.lazy(() => FlowStepSchema)),\n  catch: z.array(z.lazy(() => FlowStepSchema)).optional(),\n  finally: z.array(z.lazy(() => FlowStepSchema)).optional(),\n})\n\n/**\n * Switch/case step - multi-way branching\n */\nexport const SwitchFlowStepSchema = z.object({\n  type: z.literal('switch'),\n  value: z.unknown(), // Expression to evaluate\n  cases: z.record(z.array(z.lazy(() => FlowStepSchema))),\n  default: z.array(z.lazy(() => FlowStepSchema)).optional(),\n})\n\n/**\n * While loop step - repeat while condition is true\n */\nexport const WhileFlowStepSchema = z.object({\n  type: z.literal('while'),\n  condition: z.unknown(),\n  maxIterations: z.number().positive().optional(), // Safety limit\n  steps: z.array(z.lazy(() => FlowStepSchema)),\n})\n\n/**\n * Map-reduce step - parallel processing with aggregation\n */\nexport const MapReduceFlowStepSchema = z.object({\n  type: z.literal('map-reduce'),\n  items: z.unknown(),\n  maxConcurrency: z.number().positive().optional(),\n  map: z.lazy(() => FlowStepSchema),\n  reduce: z.lazy(() => FlowStepSchema),\n})\n\n// ============================================================================\n// Flow Step Types\n// ============================================================================\n// Note: These types MUST be defined explicitly (not derived via z.infer)\n// because Zod's z.lazy() creates circular references that TypeScript cannot\n// resolve when using z.infer. The Zod schemas are annotated with these types\n// via z.ZodType<FlowStepType> to ensure runtime validation matches.\n\n/**\n * Agent flow step - calls a named agent\n */\nexport interface AgentFlowStep {\n  agent: string\n  id?: string\n  name?: string // Alias for id - used for output references like ${name.output}\n  input?: Record<string, unknown>\n  state?: { use?: string[]; set?: string[] }\n  cache?: { ttl?: number; bypass?: boolean }\n  scoring?: {\n    evaluator: string\n    thresholds?: { minimum?: number; target?: number; excellent?: number }\n    criteria?: Record<string, string> | unknown[]\n    onFailure?: 'retry' | 'continue' | 'abort'\n    retryLimit?: number\n    requireImprovement?: boolean\n    minImprovement?: number\n  }\n  condition?: unknown\n  when?: unknown\n  depends_on?: string[]\n  retry?: {\n    attempts?: number\n    backoff?: 'linear' | 'exponential' | 'fixed'\n    initialDelay?: number\n    maxDelay?: number\n    retryOn?: string[]\n  }\n  timeout?: number\n  onTimeout?: { fallback?: unknown; error?: boolean }\n}\n\n/**\n * Parallel flow step - executes multiple steps concurrently\n */\nexport interface ParallelFlowStep {\n  type: 'parallel'\n  steps: FlowStepType[]\n  waitFor?: 'all' | 'any' | 'first'\n}\n\n/**\n * Branch flow step - conditional branching with then/else\n */\nexport interface BranchFlowStep {\n  type: 'branch'\n  condition: unknown\n  then: FlowStepType[]\n  else?: FlowStepType[]\n}\n\n/**\n * Foreach flow step - iterate over items\n */\nexport interface ForeachFlowStep {\n  type: 'foreach'\n  items: unknown\n  maxConcurrency?: number\n  breakWhen?: unknown\n  step: FlowStepType\n}\n\n/**\n * Try flow step - error handling with try/catch/finally\n */\nexport interface TryFlowStep {\n  type: 'try'\n  steps: FlowStepType[]\n  catch?: FlowStepType[]\n  finally?: FlowStepType[]\n}\n\n/**\n * Switch flow step - multi-way branching\n */\nexport interface SwitchFlowStep {\n  type: 'switch'\n  value: unknown\n  cases: Record<string, FlowStepType[]>\n  default?: FlowStepType[]\n}\n\n/**\n * While flow step - repeat while condition is true\n */\nexport interface WhileFlowStep {\n  type: 'while'\n  condition: unknown\n  maxIterations?: number\n  steps: FlowStepType[]\n}\n\n/**\n * Map-reduce flow step - parallel processing with aggregation\n */\nexport interface MapReduceFlowStep {\n  type: 'map-reduce'\n  items: unknown\n  maxConcurrency?: number\n  map: FlowStepType\n  reduce: FlowStepType\n}\n\n/**\n * Union of all flow step types\n * Agent steps don't have a 'type' field, control flow steps do\n */\nexport type FlowStepType =\n  | AgentFlowStep\n  | ParallelFlowStep\n  | BranchFlowStep\n  | ForeachFlowStep\n  | TryFlowStep\n  | SwitchFlowStep\n  | WhileFlowStep\n  | MapReduceFlowStep\n\n/**\n * Union schema for all flow step types\n * Used for runtime validation of both YAML and TypeScript ensembles\n */\nexport const FlowStepSchema: z.ZodType<FlowStepType> = z.union([\n  // Control flow steps (identified by 'type' field)\n  ParallelFlowStepSchema,\n  BranchFlowStepSchema,\n  ForeachFlowStepSchema,\n  TryFlowStepSchema,\n  SwitchFlowStepSchema,\n  WhileFlowStepSchema,\n  MapReduceFlowStepSchema,\n  // Agent steps (no 'type' field, has 'agent' field)\n  AgentFlowStepSchema,\n]) as z.ZodType<FlowStepType>\n\n// ============================================================================\n// Ensemble and Agent Schemas (Source of Truth)\n// ============================================================================\n\n/**\n * Schema for validating ensemble configuration\n */\nexport const EnsembleSchema = z.object({\n  name: z.string().min(1, 'Ensemble name is required'),\n  description: z.string().optional(),\n  /**\n   * Controls whether this ensemble can be executed via the Execute API\n   * (/api/v1/execute/ensemble/:name)\n   *\n   * When api.execution.ensembles.requireExplicit is false (default):\n   *   - Ensembles are executable unless apiExecutable: false\n   * When api.execution.ensembles.requireExplicit is true:\n   *   - Ensembles need apiExecutable: true to be executable\n   */\n  apiExecutable: z.boolean().optional(),\n  state: z\n    .object({\n      schema: z.record(z.unknown()).optional(),\n      initial: z.record(z.unknown()).optional(),\n    })\n    .optional(),\n  scoring: z\n    .object({\n      enabled: z.boolean(),\n      defaultThresholds: z.object({\n        minimum: z.number().min(0).max(1),\n        target: z.number().min(0).max(1).optional(),\n        excellent: z.number().min(0).max(1).optional(),\n      }),\n      maxRetries: z.number().positive().optional(),\n      backoffStrategy: z.enum(['linear', 'exponential', 'fixed']).optional(),\n      initialBackoff: z.number().positive().optional(),\n      trackInState: z.boolean().optional(),\n      criteria: z.union([z.record(z.string()), z.array(z.unknown())]).optional(),\n      aggregation: z.enum(['weighted_average', 'minimum', 'geometric_mean']).optional(),\n    })\n    .optional(),\n  trigger: z\n    .array(\n      z.discriminatedUnion('type', [\n        // Webhook endpoint (inbound HTTP triggers)\n        z.object({\n          type: z.literal('webhook'),\n          path: z.string().min(1).optional(), // Defaults to /{ensemble-name}\n          methods: z.array(z.enum(['POST', 'GET', 'PUT', 'PATCH', 'DELETE'])).optional(),\n          auth: z\n            .union([\n              // Legacy format: type + secret\n              z.object({\n                type: z.enum(['bearer', 'signature', 'basic']),\n                secret: z.string(),\n              }),\n              // New format: requirement + methods (declarative auth config)\n              z.object({\n                requirement: z.enum(['public', 'optional', 'required']),\n                methods: z.array(z.enum(['bearer', 'apiKey', 'cookie', 'custom'])).optional(),\n                customValidator: z.string().optional(),\n                roles: z.array(z.string()).optional(),\n                permissions: z.array(z.string()).optional(),\n              }),\n            ])\n            .optional(),\n          public: z.boolean().optional(), // If true, no auth required\n          mode: z.enum(['trigger', 'resume']).optional(),\n          async: z.boolean().optional(),\n          timeout: z.number().positive().optional(),\n        }),\n        // MCP tool endpoint (expose ensemble as MCP tool)\n        z.object({\n          type: z.literal('mcp'),\n          toolName: z.string().optional(), // Custom tool name (defaults to ensemble name)\n          auth: z\n            .object({\n              type: z.enum(['bearer', 'oauth']),\n              secret: z.string().optional(),\n            })\n            .optional(),\n          public: z.boolean().optional(),\n        }),\n        // Email invocation (trigger via email)\n        z.object({\n          type: z.literal('email'),\n          addresses: z.array(z.string().email()).min(1),\n          auth: z\n            .object({\n              from: z.array(z.string()).min(1), // Whitelist of sender patterns\n            })\n            .optional(),\n          public: z.boolean().optional(),\n          reply_with_output: z.boolean().optional(), // Send results back via email\n        }),\n        // Queue message trigger\n        z.object({\n          type: z.literal('queue'),\n          queue: z.string().min(1), // Queue binding name\n          batch_size: z.number().positive().optional(),\n          max_retries: z.number().nonnegative().optional(),\n          max_wait_time: z.number().positive().optional(), // Max seconds to wait for batch\n        }),\n        // Cron schedule trigger\n        z.object({\n          type: z.literal('cron'),\n          cron: z.string().min(1, 'Cron expression is required'),\n          timezone: z.string().optional(),\n          enabled: z.boolean().optional(),\n          input: z.record(z.unknown()).optional(),\n          metadata: z.record(z.unknown()).optional(),\n        }),\n        // HTTP trigger (full web routing with Hono features)\n        z.object({\n          type: z.literal('http'),\n          // Core HTTP config - single path (like webhook)\n          path: z.string().min(1).optional(), // Defaults to /{ensemble-name}\n          methods: z\n            .array(z.enum(['GET', 'POST', 'PUT', 'PATCH', 'DELETE', 'HEAD', 'OPTIONS']))\n            .optional(),\n          // Multi-path support - array of path/methods combinations\n          paths: z\n            .array(\n              z.object({\n                path: z.string().min(1),\n                methods: z\n                  .array(z.enum(['GET', 'POST', 'PUT', 'PATCH', 'DELETE', 'HEAD', 'OPTIONS']))\n                  .optional(),\n              })\n            )\n            .optional(),\n          auth: z\n            .union([\n              // Legacy format: type + secret\n              z.object({\n                type: z.enum(['bearer', 'signature', 'basic']),\n                secret: z.string(),\n              }),\n              // New format: requirement + methods (declarative auth config)\n              z.object({\n                requirement: z.enum(['public', 'optional', 'required']),\n                methods: z.array(z.enum(['bearer', 'apiKey', 'cookie', 'custom'])).optional(),\n                customValidator: z.string().optional(),\n                roles: z.array(z.string()).optional(),\n                permissions: z.array(z.string()).optional(),\n              }),\n            ])\n            .optional(),\n          public: z.boolean().optional(),\n          mode: z.enum(['trigger', 'resume']).optional(),\n          async: z.boolean().optional(),\n          timeout: z.number().positive().optional(),\n          // Hono-specific features\n          rateLimit: z\n            .object({\n              requests: z.number().positive(),\n              window: z.number().positive(), // seconds\n              key: z.union([z.enum(['ip', 'user']), z.function()]).optional(),\n            })\n            .optional(),\n          cors: z\n            .object({\n              origin: z.union([z.string(), z.array(z.string())]).optional(),\n              methods: z.array(z.string()).optional(),\n              allowHeaders: z.array(z.string()).optional(),\n              exposeHeaders: z.array(z.string()).optional(),\n              credentials: z.boolean().optional(),\n            })\n            .optional(),\n          cache: z\n            .object({\n              enabled: z.boolean(),\n              ttl: z.number().positive(),\n              vary: z.array(z.string()).optional(),\n              tags: z.array(z.string()).optional(),\n              keyGenerator: z.function().optional(),\n            })\n            .optional(),\n          middleware: z.array(z.union([z.string(), z.function()])).optional(), // Middleware names or functions\n          responses: z\n            .object({\n              html: z.object({ enabled: z.boolean() }).optional(),\n              json: z\n                .object({\n                  enabled: z.boolean(),\n                  transform: z.function().optional(),\n                })\n                .optional(),\n              stream: z\n                .object({\n                  enabled: z.boolean(),\n                  chunkSize: z.number().optional(),\n                })\n                .optional(),\n            })\n            .optional(),\n          templateEngine: z.enum(['handlebars', 'liquid', 'simple']).optional(),\n        }),\n        // Build trigger - run at build/deploy time\n        z.object({\n          type: z.literal('build'),\n          enabled: z.boolean().optional(),\n          output: z.string().optional(), // Output directory (e.g., './dist/docs')\n          input: z.record(z.unknown()).optional(), // Static input for build\n          metadata: z.record(z.unknown()).optional(),\n        }),\n        // CLI trigger - run from command line\n        z.object({\n          type: z.literal('cli'),\n          command: z.string().min(1), // Command name (e.g., 'docs-generate')\n          description: z.string().optional(), // Description for help text\n          options: z\n            .array(\n              z.object({\n                name: z.string().min(1),\n                type: z.enum(['string', 'number', 'boolean']).optional(),\n                default: z.union([z.string(), z.number(), z.boolean()]).optional(),\n                description: z.string().optional(),\n                required: z.boolean().optional(),\n              })\n            )\n            .optional(),\n          enabled: z.boolean().optional(),\n        }),\n      ])\n    )\n    .optional()\n    .refine(\n      (trigger) => {\n        // Validate that all trigger entries have either auth or public: true\n        // (except queue, cron, build, cli which are internally triggered)\n        if (!trigger) return true\n        return trigger.every((t) => {\n          if (t.type === 'queue' || t.type === 'cron' || t.type === 'build' || t.type === 'cli')\n            return true\n          return t.auth || t.public === true\n        })\n      },\n      {\n        message:\n          'All webhook, MCP, email, and HTTP triggers must have auth configuration or explicit public: true',\n      }\n    ),\n  notifications: z\n    .array(\n      z.discriminatedUnion('type', [\n        // Outbound webhook notifications\n        z.object({\n          type: z.literal('webhook'),\n          url: z.string().url(),\n          events: z\n            .array(\n              z.enum([\n                'execution.started',\n                'execution.completed',\n                'execution.failed',\n                'execution.timeout',\n                'agent.completed',\n                'state.updated',\n              ])\n            )\n            .min(1),\n          secret: z.string().optional(),\n          retries: z.number().positive().optional(),\n          timeout: z.number().positive().optional(),\n        }),\n        // Outbound email notifications\n        z.object({\n          type: z.literal('email'),\n          // Allow either valid email or env variable placeholder (${env.VAR})\n          to: z\n            .array(\n              z\n                .string()\n                .refine(\n                  (val) => /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(val) || /^\\$\\{env\\.[^}]+\\}$/.test(val),\n                  { message: 'Must be a valid email or environment variable (${env.VAR})' }\n                )\n            )\n            .min(1),\n          events: z\n            .array(\n              z.enum([\n                'execution.started',\n                'execution.completed',\n                'execution.failed',\n                'execution.timeout',\n                'agent.completed',\n                'state.updated',\n              ])\n            )\n            .min(1),\n          subject: z.string().optional(),\n          // Allow either valid email or env variable placeholder\n          from: z\n            .string()\n            .refine(\n              (val) => /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(val) || /^\\$\\{env\\.[^}]+\\}$/.test(val),\n              { message: 'Must be a valid email or environment variable (${env.VAR})' }\n            )\n            .optional(),\n        }),\n      ])\n    )\n    .optional(),\n  agents: z.array(z.record(z.unknown())).optional(), // Inline agent definitions (legacy/optional)\n  flow: z.array(z.lazy(() => FlowStepSchema)).optional(),\n  inputs: z.record(z.unknown()).optional(), // Input schema definition\n  output: EnsembleOutputSchema.optional(), // Conditional outputs with status, headers, redirect, rawBody\n  /** Memory configuration for persistent conversation and context */\n  memory: z\n    .object({\n      /** Enable memory system (default: true if memory block is present) */\n      enabled: z.boolean().optional(),\n      /** Session memory configuration (KV-based conversation history) */\n      session: z\n        .object({\n          enabled: z.boolean().optional(),\n          /** Time-to-live in seconds (default: 3600 = 1 hour) */\n          ttl: z.number().positive().optional(),\n          /** Maximum messages to keep (default: 50) */\n          maxMessages: z.number().positive().optional(),\n          /** Maximum age of individual messages in hours (default: 24) */\n          messageMaxAgeHours: z.number().positive().optional(),\n        })\n        .optional(),\n      /** Long-term memory configuration (D1-based persistent storage) */\n      longTerm: z\n        .object({\n          enabled: z.boolean().optional(),\n          /** User ID expression for scoping long-term memory (e.g., {{ auth.userId }}) */\n          userId: z.string().optional(),\n        })\n        .optional(),\n      /** Semantic memory configuration (Vectorize-based RAG) */\n      semantic: z\n        .object({\n          enabled: z.boolean().optional(),\n          /** Embedding model (default: @cf/baai/bge-base-en-v1.5) */\n          model: z.string().optional(),\n          /** Number of results to return from search (default: 5) */\n          topK: z.number().positive().optional(),\n          /** Minimum similarity score (0-1) */\n          minScore: z.number().min(0).max(1).optional(),\n        })\n        .optional(),\n      /** Analytical memory configuration (Hyperdrive SQL databases) */\n      analytical: z\n        .object({\n          enabled: z.boolean().optional(),\n          /** Default database alias */\n          defaultDatabase: z.string().optional(),\n        })\n        .optional(),\n    })\n    .optional(),\n  /** Ensemble-level logging configuration */\n  logging: z\n    .object({\n      /** Override log level for this ensemble */\n      level: z.enum(['debug', 'info', 'warn', 'error']).optional(),\n      /** Execution trace logging */\n      trace: z\n        .object({\n          enabled: z.boolean().optional(),\n          includeInputs: z.boolean().optional(),\n          includeOutputs: z.boolean().optional(),\n          redactInputs: z.array(z.string()).optional(),\n          redactOutputs: z.array(z.string()).optional(),\n        })\n        .optional(),\n      /** Per-step logging overrides (keyed by step agent name or ID) */\n      steps: z.record(z.record(z.unknown())).optional(),\n    })\n    .optional(),\n  /** Ensemble-level metrics configuration */\n  metrics: z\n    .object({\n      enabled: z.boolean().optional(),\n      /** Custom business metrics to track */\n      custom: z\n        .array(\n          z.object({\n            name: z.string(),\n            condition: z.string().optional(), // e.g., 'success' or expression\n            value: z.string().optional(), // Expression like '_executionTime'\n            type: z.enum(['counter', 'histogram', 'gauge']).optional(),\n          })\n        )\n        .optional(),\n    })\n    .optional(),\n  /** Ensemble-level tracing configuration */\n  tracing: z\n    .object({\n      enabled: z.boolean().optional(),\n      samplingRate: z.number().min(0).max(1).optional(),\n    })\n    .optional(),\n})\n\n/**\n * Agent-level logging configuration schema\n * Can override global logging settings for specific agents\n */\nexport const AgentLoggingSchema = z\n  .object({\n    /** Override log level for this agent */\n    level: z.enum(['debug', 'info', 'warn', 'error']).optional(),\n    /** Additional context fields to include in logs */\n    context: z.array(z.string()).optional(),\n    /** Fields to redact from logs (merged with global) */\n    redact: z.array(z.string()).optional(),\n    /** Events to log for this agent */\n    events: z\n      .object({\n        onStart: z.boolean().optional(),\n        onComplete: z.boolean().optional(),\n        onError: z.boolean().optional(),\n        onCacheHit: z.boolean().optional(),\n      })\n      .optional(),\n  })\n  .optional()\n\n/**\n * Agent-level metrics configuration schema\n */\nexport const AgentMetricsSchema = z\n  .object({\n    /** Enable/disable metrics for this agent */\n    enabled: z.boolean().optional(),\n    /** Custom metrics to record */\n    custom: z\n      .array(\n        z.object({\n          name: z.string(),\n          value: z.string(), // Expression to extract value (e.g., 'output.count')\n          type: z.enum(['counter', 'histogram', 'gauge']).optional(),\n        })\n      )\n      .optional(),\n  })\n  .optional()\n\n/**\n * Security settings for agents\n * Controls automatic security features like SSRF protection\n */\nexport const AgentSecuritySchema = z\n  .object({\n    /**\n     * Enable SSRF protection for fetch requests\n     * When true (default), requests to private IPs, localhost, and metadata services are blocked\n     * @default true\n     */\n    ssrf: z.boolean().optional(),\n    // Future security features can be added here:\n    // inputSanitization: z.boolean().optional(),\n    // rateLimiting: z.boolean().optional(),\n  })\n  .optional()\n\nexport const AgentSchema = z.object({\n  name: z.string().min(1, 'Agent name is required'),\n  operation: z.enum([\n    Operation.think,\n    Operation.code,\n    Operation.storage,\n    Operation.data,\n    Operation.http,\n    Operation.tools,\n    Operation.scoring,\n    Operation.email,\n    Operation.sms,\n    Operation.form,\n    Operation.html,\n    Operation.pdf,\n    Operation.queue,\n    Operation.autorag,\n  ]),\n  description: z.string().optional(),\n  config: z.record(z.unknown()).optional(),\n  schema: z\n    .object({\n      input: z.record(z.unknown()).optional(),\n      output: z.record(z.unknown()).optional(),\n    })\n    .optional(),\n  /**\n   * Controls whether this agent can be executed via the Execute API\n   * (/api/v1/execute/agent/:name)\n   *\n   * When api.execution.agents.requireExplicit is false (default):\n   *   - Agents are executable unless apiExecutable: false\n   * When api.execution.agents.requireExplicit is true:\n   *   - Agents need apiExecutable: true to be executable\n   */\n  apiExecutable: z.boolean().optional(),\n  /** Agent-level logging configuration */\n  logging: AgentLoggingSchema,\n  /** Agent-level metrics configuration */\n  metrics: AgentMetricsSchema,\n  /** Security settings for the agent */\n  security: AgentSecuritySchema,\n})\n\nexport type EnsembleConfig = z.infer<typeof EnsembleSchema>\nexport type AgentConfig = z.infer<typeof AgentSchema>\n// FlowStep is the union of all flow step types (for backwards compatibility)\nexport type FlowStep = FlowStepType\nexport type TriggerConfig = NonNullable<EnsembleConfig['trigger']>[number]\nexport type NotificationConfig = NonNullable<EnsembleConfig['notifications']>[number]\nexport type MemoryConfigParsed = NonNullable<EnsembleConfig['memory']>\n\n// Legacy type aliases (deprecated - use TriggerConfig with type guards)\nexport type ExposeConfig = TriggerConfig\nexport type ScheduleConfig = Extract<TriggerConfig, { type: 'cron' }>\n\n// Specific trigger type exports\nexport type HTTPTriggerConfig = Extract<TriggerConfig, { type: 'http' }>\nexport type WebhookTriggerConfig = Extract<TriggerConfig, { type: 'webhook' }>\nexport type MCPTriggerConfig = Extract<TriggerConfig, { type: 'mcp' }>\nexport type EmailTriggerConfig = Extract<TriggerConfig, { type: 'email' }>\nexport type QueueTriggerConfig = Extract<TriggerConfig, { type: 'queue' }>\nexport type CronTriggerConfig = Extract<TriggerConfig, { type: 'cron' }>\nexport type BuildTriggerConfig = Extract<TriggerConfig, { type: 'build' }>\nexport type CLITriggerConfig = Extract<TriggerConfig, { type: 'cli' }>\n\nexport class Parser {\n  private static interpolator = getInterpolator()\n\n  /**\n   * Parse and validate an ensemble YAML file\n   */\n  static parseEnsemble(yamlContent: string): EnsembleConfig {\n    try {\n      // Use customTags to handle Handlebars-style templates without warnings\n      const parsed = YAML.parse(yamlContent, { mapAsMap: false, logLevel: 'silent' })\n\n      if (!parsed) {\n        throw new Error('Empty or invalid YAML content')\n      }\n\n      const validated = EnsembleSchema.parse(parsed)\n\n      // Auto-generate flow if missing but agents are present\n      if (!validated.flow && validated.agents && validated.agents.length > 0) {\n        validated.flow = validated.agents\n          .map((agent) => {\n            // Extract agent name from the agent definition\n            const name =\n              typeof agent === 'object' && agent !== null && 'name' in agent\n                ? String(agent.name)\n                : undefined\n\n            if (!name) {\n              logger.warn(`Skipping agent without name in ensemble \"${validated.name}\"`, {\n                ensembleName: validated.name,\n              })\n              return null\n            }\n\n            return { agent: name }\n          })\n          .filter((step): step is { agent: string } => step !== null)\n\n        logger.debug(`Auto-generated sequential flow for ensemble`, {\n          ensembleName: validated.name,\n          agentCount: validated.flow.length,\n        })\n      }\n\n      return validated\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        // Provide helpful error messages for common mistakes\n        const enhancedErrors = error.errors.map((e) => {\n          const path = e.path.join('.')\n          const baseMessage = `${path}: ${e.message}`\n\n          // Common mistake: output: $agent-name instead of output: { field: ${agent.output.field} }\n          if (path === 'output' && e.code === 'invalid_type' && e.expected === 'object') {\n            return `${baseMessage}\\n     Hint: Use object syntax with field mappings:\\n      output:\\n        result: \\${agent-name.output.fieldName}`\n          }\n\n          // Common mistake: using 'agents' with 'name' key instead of 'flow' with 'agent' key\n          if (path.startsWith('flow') && e.message.includes('agent')) {\n            return `${baseMessage}\\n     Hint: Flow steps should use 'agent' key:\\n      flow:\\n        - agent: my-agent\\n          input:\\n            field: \\${input.value}`\n          }\n\n          return baseMessage\n        })\n\n        throw new Error(`Ensemble validation failed:\\n  ${enhancedErrors.join('\\n  ')}`)\n      }\n      throw new Error(\n        `Failed to parse ensemble YAML: ${error instanceof Error ? error.message : 'Unknown error'}`\n      )\n    }\n  }\n\n  /**\n   * Parse YAML and return an Ensemble instance\n   *\n   * This is the preferred method for loading ensembles, as it returns\n   * the canonical Ensemble primitive used by both YAML and TypeScript authoring.\n   *\n   * @param yamlContent - Raw YAML string\n   * @returns Ensemble instance\n   *\n   * @example\n   * ```typescript\n   * const yaml = fs.readFileSync('ensemble.yaml', 'utf-8');\n   * const ensemble = Parser.parseEnsembleToInstance(yaml);\n   *\n   * // Ensemble is now identical to one created via createEnsemble()\n   * const steps = await ensemble.resolveSteps(context);\n   * ```\n   */\n  static parseEnsembleToInstance(yamlContent: string): Ensemble {\n    const config = this.parseEnsemble(yamlContent)\n    // Cast to primitive EnsembleConfig - Zod schema is source of truth for runtime validation\n    // The primitive type is simpler (doesn't include function types like rateLimit.key function)\n    return ensembleFromConfig(config as import('../primitives/ensemble.js').EnsembleConfig)\n  }\n\n  /**\n   * Parse and validate an agent YAML file\n   */\n  static parseAgent(yamlContent: string): AgentConfig {\n    try {\n      // Use mapAsMap: false to avoid warnings about complex YAML keys\n      const parsed = YAML.parse(yamlContent, { mapAsMap: false, logLevel: 'silent' })\n\n      if (!parsed) {\n        throw new Error('Empty or invalid YAML content')\n      }\n\n      const validated = AgentSchema.parse(parsed)\n      return validated\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        throw new Error(\n          `Agent validation failed: ${error.errors.map((e) => `${e.path.join('.')}: ${e.message}`).join(', ')}`\n        )\n      }\n      throw new Error(\n        `Failed to parse agent YAML: ${error instanceof Error ? error.message : 'Unknown error'}`\n      )\n    }\n  }\n\n  /**\n   * Resolve input interpolations using composition-based resolver chain\n   *\n   * Supports: ${input.x}, ${state.y}, ${agent.output.z}\n   *\n   * Reduced from 42 lines of nested if/else to 1 line via chain of responsibility\n   */\n  static resolveInterpolation(template: unknown, context: ResolutionContext): unknown {\n    return this.interpolator.resolve(template, context)\n  }\n\n  /**\n   * Parse an agent reference that may include version\n   * Supports formats:\n   * - \"agent-name\" (no version)\n   * - \"agent-name@v1.0.0\" (semver version)\n   * - \"agent-name@production\" (deployment tag)\n   * - \"agent-name@latest\" (latest tag)\n   */\n  static parseAgentReference(agentRef: string): { name: string; version?: string } {\n    const parts = agentRef.split('@')\n\n    if (parts.length === 1) {\n      return { name: parts[0] }\n    }\n\n    if (parts.length === 2) {\n      return {\n        name: parts[0],\n        version: parts[1],\n      }\n    }\n\n    throw new Error(\n      `Invalid agent reference format: ${agentRef}. Expected \"name\" or \"name@version\"`\n    )\n  }\n\n  /**\n   * Validate that all required agents exist\n   */\n  static validateAgentReferences(ensemble: EnsembleConfig, availableAgents: Set<string>): void {\n    // Skip validation if no flow is defined\n    if (!ensemble.flow || ensemble.flow.length === 0) {\n      return\n    }\n\n    const missingAgents: string[] = []\n\n    // Recursively collect agent references from flow steps\n    const collectAgentRefs = (steps: unknown[]): void => {\n      for (const step of steps) {\n        if (typeof step !== 'object' || step === null) continue\n\n        const stepObj = step as Record<string, unknown>\n\n        // Agent step - has 'agent' field\n        if ('agent' in stepObj && typeof stepObj.agent === 'string') {\n          const { name } = this.parseAgentReference(stepObj.agent)\n          if (!availableAgents.has(name)) {\n            missingAgents.push(stepObj.agent)\n          }\n        }\n\n        // Control flow steps - recursively check nested steps\n        if ('type' in stepObj) {\n          // Parallel: check steps array\n          if (stepObj.type === 'parallel' && Array.isArray(stepObj.steps)) {\n            collectAgentRefs(stepObj.steps)\n          }\n          // Branch: check then/else arrays\n          if (stepObj.type === 'branch') {\n            if (Array.isArray(stepObj.then)) collectAgentRefs(stepObj.then)\n            if (Array.isArray(stepObj.else)) collectAgentRefs(stepObj.else)\n          }\n          // Foreach: check step\n          if (stepObj.type === 'foreach' && stepObj.step) {\n            collectAgentRefs([stepObj.step])\n          }\n          // Try: check steps/catch/finally\n          if (stepObj.type === 'try') {\n            if (Array.isArray(stepObj.steps)) collectAgentRefs(stepObj.steps)\n            if (Array.isArray(stepObj.catch)) collectAgentRefs(stepObj.catch)\n            if (Array.isArray(stepObj.finally)) collectAgentRefs(stepObj.finally)\n          }\n          // Switch: check cases and default\n          if (stepObj.type === 'switch') {\n            if (typeof stepObj.cases === 'object' && stepObj.cases !== null) {\n              for (const caseSteps of Object.values(stepObj.cases as Record<string, unknown[]>)) {\n                if (Array.isArray(caseSteps)) collectAgentRefs(caseSteps)\n              }\n            }\n            if (Array.isArray(stepObj.default)) collectAgentRefs(stepObj.default)\n          }\n          // While: check steps\n          if (stepObj.type === 'while' && Array.isArray(stepObj.steps)) {\n            collectAgentRefs(stepObj.steps)\n          }\n          // Map-reduce: check map and reduce steps\n          if (stepObj.type === 'map-reduce') {\n            if (stepObj.map) collectAgentRefs([stepObj.map])\n            if (stepObj.reduce) collectAgentRefs([stepObj.reduce])\n          }\n        }\n      }\n    }\n\n    collectAgentRefs(ensemble.flow)\n\n    if (missingAgents.length > 0) {\n      throw new Error(\n        `Ensemble \"${ensemble.name}\" references missing agents: ${missingAgents.join(', ')}`\n      )\n    }\n  }\n}\n","/**\n * Flow Step Types\n *\n * This file defines the canonical flow step types used throughout Conductor.\n * These types MUST be defined explicitly (not derived via z.infer) because\n * Zod's z.lazy() creates circular references that TypeScript cannot resolve.\n *\n * This file is deliberately kept separate from parser.ts to avoid circular\n * dependencies, as it's imported by both primitives and runtime modules.\n */\n\n// ============================================================================\n// Flow Step Types\n// ============================================================================\n\n/**\n * Agent flow step - calls a named agent\n */\nexport interface AgentFlowStep {\n  agent: string\n  id?: string\n  name?: string // Alias for id - used for output references like ${name.output}\n  input?: Record<string, unknown>\n  state?: { use?: string[]; set?: string[] }\n  cache?: { ttl?: number; bypass?: boolean }\n  scoring?: {\n    evaluator: string\n    thresholds?: { minimum?: number; target?: number; excellent?: number }\n    criteria?: Record<string, string> | unknown[]\n    onFailure?: 'retry' | 'continue' | 'abort'\n    retryLimit?: number\n    requireImprovement?: boolean\n    minImprovement?: number\n  }\n  condition?: unknown\n  when?: unknown\n  depends_on?: string[]\n  retry?: {\n    attempts?: number\n    backoff?: 'linear' | 'exponential' | 'fixed'\n    initialDelay?: number\n    maxDelay?: number\n    retryOn?: string[]\n  }\n  timeout?: number\n  onTimeout?: { fallback?: unknown; error?: boolean }\n}\n\n/**\n * Parallel flow step - executes multiple steps concurrently\n */\nexport interface ParallelFlowStep {\n  type: 'parallel'\n  steps: FlowStepType[]\n  waitFor?: 'all' | 'any' | 'first'\n}\n\n/**\n * Branch flow step - conditional branching with then/else\n */\nexport interface BranchFlowStep {\n  type: 'branch'\n  condition: unknown\n  then: FlowStepType[]\n  else?: FlowStepType[]\n}\n\n/**\n * Foreach flow step - iterate over items\n */\nexport interface ForeachFlowStep {\n  type: 'foreach'\n  items: unknown\n  maxConcurrency?: number\n  breakWhen?: unknown\n  step: FlowStepType\n}\n\n/**\n * Try flow step - error handling with try/catch/finally\n */\nexport interface TryFlowStep {\n  type: 'try'\n  steps: FlowStepType[]\n  catch?: FlowStepType[]\n  finally?: FlowStepType[]\n}\n\n/**\n * Switch flow step - multi-way branching\n */\nexport interface SwitchFlowStep {\n  type: 'switch'\n  value: unknown\n  cases: Record<string, FlowStepType[]>\n  default?: FlowStepType[]\n}\n\n/**\n * While flow step - repeat while condition is true\n */\nexport interface WhileFlowStep {\n  type: 'while'\n  condition: unknown\n  maxIterations?: number\n  steps: FlowStepType[]\n}\n\n/**\n * Map-reduce flow step - parallel processing with aggregation\n */\nexport interface MapReduceFlowStep {\n  type: 'map-reduce'\n  items: unknown\n  maxConcurrency?: number\n  map: FlowStepType\n  reduce: FlowStepType\n}\n\n/**\n * Union of all flow step types\n * Agent steps don't have a 'type' field, control flow steps do\n */\nexport type FlowStepType =\n  | AgentFlowStep\n  | ParallelFlowStep\n  | BranchFlowStep\n  | ForeachFlowStep\n  | TryFlowStep\n  | SwitchFlowStep\n  | WhileFlowStep\n  | MapReduceFlowStep\n\n// ============================================================================\n// Type Guards\n// ============================================================================\n\n/**\n * Check if a step is a parallel step\n */\nexport function isParallelStep(step: FlowStepType): step is ParallelFlowStep {\n  return 'type' in step && step.type === 'parallel'\n}\n\n/**\n * Check if a step is a branch step\n */\nexport function isBranchStep(step: FlowStepType): step is BranchFlowStep {\n  return 'type' in step && step.type === 'branch'\n}\n\n/**\n * Check if a step is a foreach step\n */\nexport function isForeachStep(step: FlowStepType): step is ForeachFlowStep {\n  return 'type' in step && step.type === 'foreach'\n}\n\n/**\n * Check if a step is a try step\n */\nexport function isTryStep(step: FlowStepType): step is TryFlowStep {\n  return 'type' in step && step.type === 'try'\n}\n\n/**\n * Check if a step is a switch step\n */\nexport function isSwitchStep(step: FlowStepType): step is SwitchFlowStep {\n  return 'type' in step && step.type === 'switch'\n}\n\n/**\n * Check if a step is a while step\n */\nexport function isWhileStep(step: FlowStepType): step is WhileFlowStep {\n  return 'type' in step && step.type === 'while'\n}\n\n/**\n * Check if a step is a map-reduce step\n */\nexport function isMapReduceStep(step: FlowStepType): step is MapReduceFlowStep {\n  return 'type' in step && step.type === 'map-reduce'\n}\n\n/**\n * Check if a step is an agent step (no 'type' field)\n */\nexport function isAgentStep(step: FlowStepType): step is AgentFlowStep {\n  return 'agent' in step && !('type' in step)\n}\n\n/**\n * Check if a step is a control flow step (has 'type' field)\n */\nexport function isControlFlowStep(\n  step: FlowStepType\n): step is Exclude<FlowStepType, AgentFlowStep> {\n  return 'type' in step\n}\n\n/**\n * Check if a step is any flow control step\n */\nexport function isFlowControlStep(step: FlowStepType): boolean {\n  return (\n    isParallelStep(step) ||\n    isBranchStep(step) ||\n    isForeachStep(step) ||\n    isTryStep(step) ||\n    isSwitchStep(step) ||\n    isWhileStep(step) ||\n    isMapReduceStep(step)\n  )\n}\n","/**\n * Result Type for Explicit Error Handling\n *\n * A Result type represents the outcome of an operation that may fail.\n * It forces explicit error handling at compile time, making it impossible\n * to forget to handle errors.\n *\n * @example\n * ```typescript\n * // Function that may fail\n * function findUser(id: string): Result<User, UserNotFoundError> {\n *   const user = database.find(id);\n *   if (!user) {\n *     return Result.err(new UserNotFoundError(id));\n *   }\n *   return Result.ok(user);\n * }\n *\n * // Error handling is explicit and checked\n * const result = findUser('123');\n * if (!result.success) {\n *   console.error('Error:', result.error.message);\n *   return;\n * }\n * const user = result.value; // Type-safe access\n * ```\n */\n\n/**\n * Result type - either success with a value or failure with an error\n */\nexport type Result<T, E = Error> = { success: true; value: T } | { success: false; error: E }\n\n/**\n * Result utilities and constructors\n */\nexport const Result = {\n  /**\n   * Create a successful Result\n   */\n  ok<T>(value: T): Result<T, never> {\n    return { success: true, value }\n  },\n\n  /**\n   * Create a failed Result\n   */\n  err<E>(error: E): Result<never, E> {\n    return { success: false, error }\n  },\n\n  /**\n   * Wrap a Promise to catch errors and return a Result\n   * @example\n   * ```typescript\n   * const result = await Result.fromPromise(\n   *   fetch('https://api.example.com/data')\n   * );\n   * ```\n   */\n  async fromPromise<T>(promise: Promise<T>): Promise<Result<T, Error>> {\n    try {\n      const value = await promise\n      return Result.ok(value)\n    } catch (error) {\n      return Result.err(error instanceof Error ? error : new Error(String(error)))\n    }\n  },\n\n  /**\n   * Wrap a synchronous function to catch errors and return a Result\n   * @example\n   * ```typescript\n   * const result = Result.fromThrowable(() => JSON.parse(input));\n   * ```\n   */\n  fromThrowable<T>(fn: () => T): Result<T, Error> {\n    try {\n      return Result.ok(fn())\n    } catch (error) {\n      return Result.err(error instanceof Error ? error : new Error(String(error)))\n    }\n  },\n\n  /**\n   * Transform the value inside a successful Result\n   * Leaves error Results unchanged\n   * @example\n   * ```typescript\n   * const result = Result.ok(5);\n   * const doubled = Result.map(result, x => x * 2);\n   * // doubled = { success: true, value: 10 }\n   * ```\n   */\n  map<T, U, E>(result: Result<T, E>, fn: (value: T) => U): Result<U, E> {\n    if (result.success) {\n      return Result.ok(fn(result.value))\n    }\n    return result\n  },\n\n  /**\n   * Async version of map\n   */\n  async mapAsync<T, U, E>(\n    result: Result<T, E>,\n    fn: (value: T) => Promise<U>\n  ): Promise<Result<U, E>> {\n    if (result.success) {\n      return Result.ok(await fn(result.value))\n    }\n    return result\n  },\n\n  /**\n   * Transform the error inside a failed Result\n   * Leaves success Results unchanged\n   * @example\n   * ```typescript\n   * const result = Result.err(new Error('failed'));\n   * const wrapped = Result.mapErr(result, e => new CustomError(e));\n   * ```\n   */\n  mapErr<T, E, F>(result: Result<T, E>, fn: (error: E) => F): Result<T, F> {\n    if (result.success) {\n      return result\n    }\n    return Result.err(fn(result.error))\n  },\n\n  /**\n   * Chain Results together (flatMap/bind)\n   * If the first Result is an error, returns it without calling fn\n   * If the first Result is success, calls fn with the value\n   * @example\n   * ```typescript\n   * const result = Result.ok(5);\n   * const chained = Result.flatMap(result, x => {\n   *   if (x > 10) return Result.ok(x);\n   *   return Result.err(new Error('too small'));\n   * });\n   * ```\n   */\n  flatMap<T, U, E>(result: Result<T, E>, fn: (value: T) => Result<U, E>): Result<U, E> {\n    if (result.success) {\n      return fn(result.value)\n    }\n    return result\n  },\n\n  /**\n   * Async version of flatMap\n   */\n  async flatMapAsync<T, U, E>(\n    result: Result<T, E>,\n    fn: (value: T) => Promise<Result<U, E>>\n  ): Promise<Result<U, E>> {\n    if (result.success) {\n      return await fn(result.value)\n    }\n    return result\n  },\n\n  /**\n   * Unwrap a Result, throwing if it's an error\n   * Use sparingly - prefer explicit error handling\n   * @throws The error if Result is failed\n   * @example\n   * ```typescript\n   * const value = Result.unwrap(result); // Throws if error\n   * ```\n   */\n  unwrap<T, E>(result: Result<T, E>): T {\n    if (result.success) {\n      return result.value\n    }\n    throw result.error\n  },\n\n  /**\n   * Unwrap a Result, returning a default value if it's an error\n   * @example\n   * ```typescript\n   * const value = Result.unwrapOr(result, 'default');\n   * ```\n   */\n  unwrapOr<T, E>(result: Result<T, E>, defaultValue: T): T {\n    return result.success ? result.value : defaultValue\n  },\n\n  /**\n   * Unwrap a Result, computing a default value from the error\n   * @example\n   * ```typescript\n   * const value = Result.unwrapOrElse(result, error => {\n   *   console.error('Failed:', error);\n   *   return 'fallback';\n   * });\n   * ```\n   */\n  unwrapOrElse<T, E>(result: Result<T, E>, fn: (error: E) => T): T {\n    return result.success ? result.value : fn(result.error)\n  },\n\n  /**\n   * Check if Result is success\n   */\n  isOk<T, E>(result: Result<T, E>): result is { success: true; value: T } {\n    return result.success === true\n  },\n\n  /**\n   * Check if Result is error\n   */\n  isErr<T, E>(result: Result<T, E>): result is { success: false; error: E } {\n    return result.success === false\n  },\n\n  /**\n   * Combine multiple Results into one\n   * Returns first error, or all values if all succeed\n   * @example\n   * ```typescript\n   * const results = [Result.ok(1), Result.ok(2), Result.ok(3)];\n   * const combined = Result.all(results);\n   * // combined = { success: true, value: [1, 2, 3] }\n   * ```\n   */\n  all<T, E>(results: Result<T, E>[]): Result<T[], E> {\n    const values: T[] = []\n\n    for (const result of results) {\n      if (!result.success) {\n        return result\n      }\n      values.push(result.value)\n    }\n\n    return Result.ok(values)\n  },\n\n  /**\n   * Combine multiple Results, collecting all errors or all values\n   * Unlike `all`, this doesn't short-circuit on first error\n   * @example\n   * ```typescript\n   * const results = [\n   *   Result.ok(1),\n   *   Result.err(new Error('e1')),\n   *   Result.err(new Error('e2'))\n   * ];\n   * const combined = Result.partition(results);\n   * // combined = { success: false, error: [Error('e1'), Error('e2')] }\n   * ```\n   */\n  partition<T, E>(results: Result<T, E>[]): Result<T[], E[]> {\n    const values: T[] = []\n    const errors: E[] = []\n\n    for (const result of results) {\n      if (result.success) {\n        values.push(result.value)\n      } else {\n        errors.push(result.error)\n      }\n    }\n\n    if (errors.length > 0) {\n      return Result.err(errors)\n    }\n\n    return Result.ok(values)\n  },\n\n  /**\n   * Sequence async operations, short-circuiting on first error\n   * @example\n   * ```typescript\n   * const result = await Result.sequence([\n   *   () => validateInput(data),\n   *   () => fetchUser(data.userId),\n   *   () => updateUser(user)\n   * ]);\n   * ```\n   */\n  async sequence<T, E>(operations: Array<() => Promise<Result<T, E>>>): Promise<Result<T[], E>> {\n    const values: T[] = []\n\n    for (const operation of operations) {\n      const result = await operation()\n      if (!result.success) {\n        return result\n      }\n      values.push(result.value)\n    }\n\n    return Result.ok(values)\n  },\n\n  /**\n   * Match on a Result, providing handlers for both cases\n   * @example\n   * ```typescript\n   * const message = Result.match(result, {\n   *   ok: user => `Welcome ${user.name}`,\n   *   err: error => `Error: ${error.message}`\n   * });\n   * ```\n   */\n  match<T, E, R>(\n    result: Result<T, E>,\n    handlers: {\n      ok: (value: T) => R\n      err: (error: E) => R\n    }\n  ): R {\n    if (result.success) {\n      return handlers.ok(result.value)\n    }\n    return handlers.err(result.error)\n  },\n\n  /**\n   * Perform a side effect on success, returning the original Result\n   * @example\n   * ```typescript\n   * const result = Result.ok(user)\n   *   .pipe(Result.tap(u => console.log('Found user:', u.name)));\n   * ```\n   */\n  tap<T, E>(result: Result<T, E>, fn: (value: T) => void): Result<T, E> {\n    if (result.success) {\n      fn(result.value)\n    }\n    return result\n  },\n\n  /**\n   * Perform a side effect on error, returning the original Result\n   * @example\n   * ```typescript\n   * const result = operation()\n   *   .pipe(Result.tapErr(e => console.error('Operation failed:', e)));\n   * ```\n   */\n  tapErr<T, E>(result: Result<T, E>, fn: (error: E) => void): Result<T, E> {\n    if (!result.success) {\n      fn(result.error)\n    }\n    return result\n  },\n}\n\n/**\n * Async Result for operations that return promises\n */\nexport type AsyncResult<T, E = Error> = Promise<Result<T, E>>\n\n/**\n * Helper for creating async results\n */\nexport const AsyncResult = {\n  /**\n   * Create a successful async Result\n   */\n  ok<T>(value: T): AsyncResult<T, never> {\n    return Promise.resolve(Result.ok(value))\n  },\n\n  /**\n   * Create a failed async Result\n   */\n  err<E>(error: E): AsyncResult<never, E> {\n    return Promise.resolve(Result.err(error))\n  },\n\n  /**\n   * Chain async operations\n   */\n  async flatMap<T, U, E>(\n    result: AsyncResult<T, E>,\n    fn: (value: T) => AsyncResult<U, E>\n  ): AsyncResult<U, E> {\n    const resolved = await result\n    return Result.flatMapAsync(resolved, fn)\n  },\n}\n","/**\n * Error Type Hierarchy\n *\n * Strongly-typed errors for the Conductor framework.\n * All errors extend ConductorError for consistent handling.\n */\n\nimport type { AgentName, ModelId, ProviderId, EnsembleName } from '../types/branded.js'\n\n/**\n * Error codes for categorizing errors\n */\nexport enum ErrorCode {\n  // Agent errors (1xxx)\n  MEMBER_NOT_FOUND = 'MEMBER_NOT_FOUND',\n  MEMBER_INVALID_CONFIG = 'MEMBER_INVALID_CONFIG',\n  MEMBER_EXECUTION_FAILED = 'MEMBER_EXECUTION_FAILED',\n  MEMBER_VALIDATION_FAILED = 'MEMBER_VALIDATION_FAILED',\n\n  // Provider errors (2xxx)\n  PROVIDER_NOT_FOUND = 'PROVIDER_NOT_FOUND',\n  PROVIDER_AUTH_FAILED = 'PROVIDER_AUTH_FAILED',\n  PROVIDER_API_ERROR = 'PROVIDER_API_ERROR',\n  PROVIDER_TIMEOUT = 'PROVIDER_TIMEOUT',\n  PROVIDER_RATE_LIMIT = 'PROVIDER_RATE_LIMIT',\n\n  // Platform errors (3xxx)\n  PLATFORM_UNSUPPORTED = 'PLATFORM_UNSUPPORTED',\n  PLATFORM_BINDING_MISSING = 'PLATFORM_BINDING_MISSING',\n  PLATFORM_VALIDATION_FAILED = 'PLATFORM_VALIDATION_FAILED',\n\n  // Model errors (4xxx)\n  MODEL_NOT_FOUND = 'MODEL_NOT_FOUND',\n  MODEL_DEPRECATED = 'MODEL_DEPRECATED',\n  MODEL_EOL = 'MODEL_EOL',\n\n  // Ensemble errors (5xxx)\n  ENSEMBLE_NOT_FOUND = 'ENSEMBLE_NOT_FOUND',\n  ENSEMBLE_PARSE_FAILED = 'ENSEMBLE_PARSE_FAILED',\n  ENSEMBLE_VALIDATION_FAILED = 'ENSEMBLE_VALIDATION_FAILED',\n  ENSEMBLE_EXECUTION_FAILED = 'ENSEMBLE_EXECUTION_FAILED',\n\n  // State errors (6xxx)\n  STATE_ACCESS_DENIED = 'STATE_ACCESS_DENIED',\n  STATE_INVALID_KEY = 'STATE_INVALID_KEY',\n\n  // Storage errors (7xxx)\n  STORAGE_NOT_FOUND = 'STORAGE_NOT_FOUND',\n  STORAGE_ACCESS_DENIED = 'STORAGE_ACCESS_DENIED',\n  STORAGE_OPERATION_FAILED = 'STORAGE_OPERATION_FAILED',\n\n  // Generic errors (9xxx)\n  VALIDATION_FAILED = 'VALIDATION_FAILED',\n  CONFIGURATION_ERROR = 'CONFIGURATION_ERROR',\n  INTERNAL_ERROR = 'INTERNAL_ERROR',\n}\n\n/**\n * Base error class for all Conductor errors\n */\nexport abstract class ConductorError extends Error {\n  abstract readonly code: ErrorCode\n  abstract readonly isOperational: boolean\n  readonly details?: Record<string, unknown>\n\n  constructor(message: string, details?: Record<string, unknown>) {\n    super(message)\n    this.name = this.constructor.name\n    this.details = details\n\n    // Maintains proper stack trace for where our error was thrown (only available on V8)\n    // Use type guard to safely check for V8-specific captureStackTrace\n    if ('captureStackTrace' in Error && typeof Error.captureStackTrace === 'function') {\n      Error.captureStackTrace(this, this.constructor)\n    }\n  }\n\n  /**\n   * Convert error to JSON for logging/serialization\n   */\n  toJSON(): ErrorJSON {\n    return {\n      name: this.name,\n      code: this.code,\n      message: this.message,\n      isOperational: this.isOperational,\n      ...(this.details && { details: this.details }),\n      stack: this.stack,\n    }\n  }\n\n  /**\n   * Convert error to user-friendly message\n   */\n  abstract toUserMessage(): string\n}\n\n/**\n * Error JSON representation\n */\nexport interface ErrorJSON {\n  name: string\n  code: ErrorCode\n  message: string\n  isOperational: boolean\n  details?: Record<string, unknown>\n  stack?: string\n}\n\n// ============================================================================\n// Agent Errors\n// ============================================================================\n\n/**\n * Agent not found in registry\n */\nexport class MemberNotFoundError extends ConductorError {\n  readonly code = ErrorCode.MEMBER_NOT_FOUND\n  readonly isOperational = true\n\n  constructor(public readonly agentName: string) {\n    super(`Agent \"${agentName}\" not found in registry`)\n  }\n\n  toUserMessage(): string {\n    return `The agent \"${this.agentName}\" does not exist. Check your ensemble configuration.`\n  }\n}\n\n/**\n * Agent configuration is invalid\n */\nexport class MemberConfigurationError extends ConductorError {\n  readonly code = ErrorCode.MEMBER_INVALID_CONFIG\n  readonly isOperational = true\n\n  constructor(\n    public readonly agentName: string,\n    public readonly reason: string\n  ) {\n    super(`Invalid configuration for agent \"${agentName}\": ${reason}`)\n  }\n\n  toUserMessage(): string {\n    return `Configuration error in agent \"${this.agentName}\": ${this.reason}`\n  }\n}\n\n/**\n * Agent execution failed\n */\nexport class AgentExecutionError extends ConductorError {\n  readonly code = ErrorCode.MEMBER_EXECUTION_FAILED\n  readonly isOperational = true\n\n  constructor(\n    public readonly agentName: string,\n    public readonly reason: string,\n    public readonly cause?: Error\n  ) {\n    super(`Agent \"${agentName}\" execution failed: ${reason}`)\n  }\n\n  toUserMessage(): string {\n    return `Execution failed for agent \"${this.agentName}\": ${this.reason}`\n  }\n}\n\n/**\n * Agent validation failed\n */\nexport class MemberValidationError extends ConductorError {\n  readonly code = ErrorCode.MEMBER_VALIDATION_FAILED\n  readonly isOperational = true\n\n  constructor(\n    public readonly agentName: string,\n    public readonly errors: string[]\n  ) {\n    super(`Validation failed for agent \"${agentName}\": ${errors.join(', ')}`)\n  }\n\n  toUserMessage(): string {\n    return `Agent \"${this.agentName}\" has validation errors:\\n${this.errors.map((e) => `  - ${e}`).join('\\n')}`\n  }\n}\n\n// ============================================================================\n// Provider Errors\n// ============================================================================\n\n/**\n * AI provider not found\n */\nexport class ProviderNotFoundError extends ConductorError {\n  readonly code = ErrorCode.PROVIDER_NOT_FOUND\n  readonly isOperational = true\n\n  constructor(public readonly providerId: string) {\n    super(`AI provider \"${providerId}\" not found`)\n  }\n\n  toUserMessage(): string {\n    return `The AI provider \"${this.providerId}\" is not available. Check your provider configuration.`\n  }\n}\n\n/**\n * Provider authentication failed\n */\nexport class ProviderAuthError extends ConductorError {\n  readonly code = ErrorCode.PROVIDER_AUTH_FAILED\n  readonly isOperational = true\n\n  constructor(\n    public readonly providerId: string,\n    public readonly reason: string\n  ) {\n    super(`Authentication failed for provider \"${providerId}\": ${reason}`)\n  }\n\n  toUserMessage(): string {\n    return `Authentication error with \"${this.providerId}\": ${this.reason}. Check your API keys.`\n  }\n}\n\n/**\n * Provider API error\n */\nexport class ProviderAPIError extends ConductorError {\n  readonly code = ErrorCode.PROVIDER_API_ERROR\n  readonly isOperational = true\n\n  constructor(\n    public readonly providerId: string,\n    public readonly statusCode: number,\n    public readonly response: string\n  ) {\n    super(`API error from provider \"${providerId}\": ${statusCode} - ${response}`)\n  }\n\n  toUserMessage(): string {\n    return `API error from \"${this.providerId}\" (HTTP ${this.statusCode}): ${this.response}`\n  }\n}\n\n/**\n * Provider request timeout\n */\nexport class ProviderTimeoutError extends ConductorError {\n  readonly code = ErrorCode.PROVIDER_TIMEOUT\n  readonly isOperational = true\n\n  constructor(\n    public readonly providerId: string,\n    public readonly timeoutMs: number\n  ) {\n    super(`Request to provider \"${providerId}\" timed out after ${timeoutMs}ms`)\n  }\n\n  toUserMessage(): string {\n    return `Request to \"${this.providerId}\" timed out. The service may be slow or unavailable.`\n  }\n}\n\n/**\n * Provider rate limit exceeded\n */\nexport class ProviderRateLimitError extends ConductorError {\n  readonly code = ErrorCode.PROVIDER_RATE_LIMIT\n  readonly isOperational = true\n\n  constructor(\n    public readonly providerId: string,\n    public readonly retryAfter?: number\n  ) {\n    super(\n      `Rate limit exceeded for provider \"${providerId}\"` +\n        (retryAfter ? ` (retry after ${retryAfter}s)` : '')\n    )\n  }\n\n  toUserMessage(): string {\n    const retryMsg = this.retryAfter ? ` Please retry after ${this.retryAfter} seconds.` : ''\n    return `Rate limit exceeded for \"${this.providerId}\".${retryMsg}`\n  }\n}\n\n// ============================================================================\n// Platform Errors\n// ============================================================================\n\n/**\n * Platform not supported\n */\nexport class PlatformUnsupportedError extends ConductorError {\n  readonly code = ErrorCode.PLATFORM_UNSUPPORTED\n  readonly isOperational = true\n\n  constructor(public readonly platformName: string) {\n    super(`Platform \"${platformName}\" is not supported`)\n  }\n\n  toUserMessage(): string {\n    return `The platform \"${this.platformName}\" is not supported.`\n  }\n}\n\n/**\n * Platform binding missing\n */\nexport class PlatformBindingMissingError extends ConductorError {\n  readonly code = ErrorCode.PLATFORM_BINDING_MISSING\n  readonly isOperational = true\n\n  constructor(\n    public readonly bindingName: string,\n    public readonly hint?: string\n  ) {\n    super(`Binding \"${bindingName}\" not found` + (hint ? `: ${hint}` : ''))\n  }\n\n  toUserMessage(): string {\n    return `Required binding \"${this.bindingName}\" is not configured. ${this.hint || 'Add it to wrangler.toml'}`\n  }\n}\n\n// ============================================================================\n// Model Errors\n// ============================================================================\n\n/**\n * Model not found\n */\nexport class ModelNotFoundError extends ConductorError {\n  readonly code = ErrorCode.MODEL_NOT_FOUND\n  readonly isOperational = true\n\n  constructor(public readonly modelId: string) {\n    super(`Model \"${modelId}\" not found in platform data`)\n  }\n\n  toUserMessage(): string {\n    return `The model \"${this.modelId}\" is not available. Check the model ID or use a different model.`\n  }\n}\n\n/**\n * Model is deprecated\n */\nexport class ModelDeprecatedError extends ConductorError {\n  readonly code = ErrorCode.MODEL_DEPRECATED\n  readonly isOperational = true\n\n  constructor(\n    public readonly modelId: string,\n    public readonly reason?: string,\n    public readonly replacement?: string\n  ) {\n    super(\n      `Model \"${modelId}\" is deprecated` +\n        (reason ? `: ${reason}` : '') +\n        (replacement ? `. Use \"${replacement}\" instead` : '')\n    )\n  }\n\n  toUserMessage(): string {\n    let msg = `The model \"${this.modelId}\" is deprecated`\n    if (this.reason) msg += `: ${this.reason}`\n    if (this.replacement) msg += `. Please migrate to \"${this.replacement}\"`\n    return msg\n  }\n}\n\n/**\n * Model has reached end of life\n */\nexport class ModelEOLError extends ConductorError {\n  readonly code = ErrorCode.MODEL_EOL\n  readonly isOperational = true\n\n  constructor(\n    public readonly modelId: string,\n    public readonly eolDate: string,\n    public readonly replacement?: string\n  ) {\n    super(\n      `Model \"${modelId}\" reached end of life on ${eolDate}` +\n        (replacement ? `. Use \"${replacement}\" instead` : '')\n    )\n  }\n\n  toUserMessage(): string {\n    let msg = `The model \"${this.modelId}\" is no longer available (EOL: ${this.eolDate})`\n    if (this.replacement) msg += `. Please use \"${this.replacement}\" instead`\n    return msg\n  }\n}\n\n// ============================================================================\n// Ensemble Errors\n// ============================================================================\n\n/**\n * Ensemble not found\n */\nexport class EnsembleNotFoundError extends ConductorError {\n  readonly code = ErrorCode.ENSEMBLE_NOT_FOUND\n  readonly isOperational = true\n\n  constructor(public readonly ensembleName: string) {\n    super(`Ensemble \"${ensembleName}\" not found`)\n  }\n\n  toUserMessage(): string {\n    return `The ensemble \"${this.ensembleName}\" does not exist.`\n  }\n}\n\n/**\n * Ensemble parse error\n */\nexport class EnsembleParseError extends ConductorError {\n  readonly code = ErrorCode.ENSEMBLE_PARSE_FAILED\n  readonly isOperational = true\n\n  constructor(\n    public readonly ensembleName: string,\n    public readonly reason: string\n  ) {\n    super(`Failed to parse ensemble \"${ensembleName}\": ${reason}`)\n  }\n\n  toUserMessage(): string {\n    return `Syntax error in ensemble \"${this.ensembleName}\": ${this.reason}`\n  }\n}\n\n/**\n * Ensemble validation error\n */\nexport class EnsembleValidationError extends ConductorError {\n  readonly code = ErrorCode.ENSEMBLE_VALIDATION_FAILED\n  readonly isOperational = true\n\n  constructor(\n    public readonly ensembleName: string,\n    public readonly errors: string[]\n  ) {\n    super(`Validation failed for ensemble \"${ensembleName}\": ${errors.join(', ')}`)\n  }\n\n  toUserMessage(): string {\n    return `Ensemble \"${this.ensembleName}\" has validation errors:\\n${this.errors.map((e) => `  - ${e}`).join('\\n')}`\n  }\n}\n\n/**\n * Ensemble execution error\n */\nexport class EnsembleExecutionError extends ConductorError {\n  readonly code = ErrorCode.ENSEMBLE_EXECUTION_FAILED\n  readonly isOperational = true\n\n  constructor(\n    public readonly ensembleName: string,\n    public readonly step: string,\n    public readonly cause: Error\n  ) {\n    super(`Ensemble \"${ensembleName}\" failed at step \"${step}\": ${cause.message}`)\n  }\n\n  toUserMessage(): string {\n    return `Execution failed in ensemble \"${this.ensembleName}\" at step \"${this.step}\": ${this.cause.message}`\n  }\n}\n\n// ============================================================================\n// Storage Errors\n// ============================================================================\n\n/**\n * Storage key not found\n */\nexport class StorageKeyNotFoundError extends ConductorError {\n  readonly code = ErrorCode.STORAGE_NOT_FOUND\n  readonly isOperational = true\n\n  constructor(\n    public readonly key: string,\n    public readonly storageType: string\n  ) {\n    super(`Key \"${key}\" not found in ${storageType}`)\n  }\n\n  toUserMessage(): string {\n    return `The key \"${this.key}\" does not exist in ${this.storageType} storage.`\n  }\n}\n\n/**\n * Storage operation failed\n */\nexport class StorageOperationError extends ConductorError {\n  readonly code = ErrorCode.STORAGE_OPERATION_FAILED\n  readonly isOperational = true\n\n  constructor(\n    public readonly operation: string,\n    public readonly key: string,\n    public readonly cause: Error\n  ) {\n    super(`Storage operation \"${operation}\" failed for key \"${key}\": ${cause.message}`)\n  }\n\n  toUserMessage(): string {\n    return `Storage operation failed: ${this.operation} on \"${this.key}\"`\n  }\n}\n\n// ============================================================================\n// Generic Errors\n// ============================================================================\n\n/**\n * Configuration error\n */\nexport class ConfigurationError extends ConductorError {\n  readonly code = ErrorCode.CONFIGURATION_ERROR\n  readonly isOperational = true\n\n  constructor(public readonly reason: string) {\n    super(`Configuration error: ${reason}`)\n  }\n\n  toUserMessage(): string {\n    return `Configuration error: ${this.reason}`\n  }\n}\n\n/**\n * Internal error (should not happen in production)\n */\nexport class InternalError extends ConductorError {\n  readonly code = ErrorCode.INTERNAL_ERROR\n  readonly isOperational = false // Non-operational - indicates a bug\n\n  constructor(\n    public readonly reason: string,\n    public readonly cause?: Error\n  ) {\n    super(`Internal error: ${reason}`)\n  }\n\n  toUserMessage(): string {\n    return `An unexpected error occurred. Please contact support.`\n  }\n}\n\n/**\n * Error factory for common error scenarios\n */\nexport const Errors = {\n  /** @deprecated Use agentNotFound instead */\n  memberNotFound: (name: string) => new MemberNotFoundError(name),\n  agentNotFound: (name: string) => new MemberNotFoundError(name),\n  agentConfig: (name: string, reason: string) => new MemberConfigurationError(name, reason),\n  memberExecution: (name: string, reason: string, cause?: Error) =>\n    new AgentExecutionError(name, reason, cause),\n\n  providerNotFound: (id: string) => new ProviderNotFoundError(id),\n  providerAuth: (id: string, reason: string) => new ProviderAuthError(id, reason),\n  providerAPI: (id: string, status: number, response: string) =>\n    new ProviderAPIError(id, status, response),\n  providerTimeout: (id: string, timeout: number) => new ProviderTimeoutError(id, timeout),\n\n  modelNotFound: (id: string) => new ModelNotFoundError(id),\n  modelDeprecated: (id: string, reason?: string, replacement?: string) =>\n    new ModelDeprecatedError(id, reason, replacement),\n  modelEOL: (id: string, eolDate: string, replacement?: string) =>\n    new ModelEOLError(id, eolDate, replacement),\n\n  ensembleNotFound: (name: string) => new EnsembleNotFoundError(name),\n  ensembleParse: (name: string, reason: string) => new EnsembleParseError(name, reason),\n  ensembleExecution: (name: string, step: string, cause: Error) =>\n    new EnsembleExecutionError(name, step, cause),\n\n  bindingMissing: (name: string, hint?: string) => new PlatformBindingMissingError(name, hint),\n\n  storageNotFound: (key: string, storageType: string) =>\n    new StorageKeyNotFoundError(key, storageType),\n\n  config: (reason: string) => new ConfigurationError(reason),\n  internal: (reason: string, cause?: Error) => new InternalError(reason, cause),\n}\n","/**\n * Graph-based Workflow Executor\n *\n * Executes sophisticated workflows with control flow constructs:\n * - Parallel execution (run multiple steps concurrently)\n * - Conditional branching (if/else, switch/case)\n * - Iteration (foreach, while loops)\n * - Error handling (try/catch/finally)\n * - Map-reduce pattern (parallel map + reduce)\n *\n * The GraphExecutor delegates actual agent execution back to the main Executor\n * via a callback function. This maintains separation of concerns:\n * - GraphExecutor handles control flow logic\n * - Executor handles agent lifecycle, observability, scoring, etc.\n *\n * Integration pattern:\n * ```typescript\n * const graphExecutor = new GraphExecutor(agentExecutorFn)\n * const result = await graphExecutor.execute(ensemble.flow, context)\n * ```\n */\n\nimport type {\n  FlowStepType,\n  AgentFlowStep,\n  ParallelFlowStep,\n  BranchFlowStep,\n  ForeachFlowStep,\n  TryFlowStep,\n  SwitchFlowStep,\n  WhileFlowStep,\n  MapReduceFlowStep,\n} from '../primitives/types.js'\nimport {\n  isAgentStep,\n  isParallelStep,\n  isBranchStep,\n  isForeachStep,\n  isTryStep,\n  isSwitchStep,\n  isWhileStep,\n  isMapReduceStep,\n} from '../primitives/types.js'\nimport { Parser } from './parser.js'\nimport { Result, type AsyncResult } from '../types/result.js'\nimport type { ConductorError } from '../errors/error-types.js'\nimport { EnsembleExecutionError } from '../errors/error-types.js'\n\n/**\n * Callback function type for executing agents\n * The main Executor provides this callback to handle agent execution\n *\n * @param step - The agent step to execute\n * @param context - Current execution context with all previous outputs\n * @returns Promise resolving to the agent's output\n */\nexport type AgentExecutorFn = (\n  step: AgentFlowStep,\n  context: GraphExecutionContext\n) => Promise<unknown>\n\n/**\n * Execution context passed through the graph\n * Contains input, state, and all previous step outputs\n */\nexport interface GraphExecutionContext {\n  /** Original input to the ensemble */\n  input: unknown\n  /** Current state (if state management enabled) */\n  state?: Record<string, unknown>\n  /** Outputs from all completed steps, keyed by step id or agent name */\n  results: Map<string, unknown>\n  /** Flattened context for expression resolution */\n  [key: string]: unknown\n}\n\n/**\n * Result of graph execution\n */\nexport interface GraphExecutionResult {\n  /** Final outputs from all steps */\n  outputs: Record<string, unknown>\n  /** Whether execution completed successfully */\n  success: boolean\n  /** Error if execution failed */\n  error?: Error\n}\n\n/**\n * Execution node in the dependency graph\n */\ninterface ExecutionNode {\n  id: string\n  type: 'agent' | 'parallel' | 'branch' | 'foreach' | 'try' | 'switch' | 'while' | 'map-reduce'\n  step: FlowStepType\n  dependencies: string[]\n  status: 'pending' | 'running' | 'completed' | 'failed' | 'skipped'\n  result?: unknown\n  error?: Error\n  startTime?: number\n  endTime?: number\n}\n\n/**\n * Type guard to check if a flow contains any control flow steps\n */\nexport function hasControlFlowSteps(flow: FlowStepType[]): boolean {\n  return flow.some(\n    (step) =>\n      isParallelStep(step) ||\n      isBranchStep(step) ||\n      isForeachStep(step) ||\n      isTryStep(step) ||\n      isSwitchStep(step) ||\n      isWhileStep(step) ||\n      isMapReduceStep(step)\n  )\n}\n\n/**\n * Graph-based workflow executor for control flow constructs\n */\nexport class GraphExecutor {\n  private agentExecutor: AgentExecutorFn\n  private ensembleName: string\n\n  /**\n   * Create a new GraphExecutor\n   *\n   * @param agentExecutor - Callback function to execute agent steps\n   * @param ensembleName - Name of the ensemble (for error messages)\n   */\n  constructor(agentExecutor: AgentExecutorFn, ensembleName: string = 'unknown') {\n    this.agentExecutor = agentExecutor\n    this.ensembleName = ensembleName\n  }\n\n  /**\n   * Execute a graph-based flow\n   *\n   * @param flow - Array of flow steps to execute\n   * @param initialContext - Initial execution context (input, state)\n   * @returns Result containing all step outputs or an error\n   */\n  async execute(\n    flow: FlowStepType[],\n    initialContext: { input: unknown; state?: Record<string, unknown> }\n  ): AsyncResult<Record<string, unknown>, ConductorError> {\n    const context: GraphExecutionContext = {\n      input: initialContext.input,\n      state: initialContext.state,\n      results: new Map(),\n    }\n\n    // Add input and state to context for expression resolution\n    ;(context as Record<string, unknown>).input = initialContext.input\n    if (initialContext.state) {\n      ;(context as Record<string, unknown>).state = initialContext.state\n    }\n\n    try {\n      // Execute steps sequentially, but handle control flow internally\n      for (let i = 0; i < flow.length; i++) {\n        const step = flow[i]\n        const result = await this.executeStep(step, context)\n\n        // Store result with appropriate key\n        const stepKey = this.getStepKey(step, i)\n        context.results.set(stepKey, result)\n\n        // Also add to flat context for expression resolution\n        ;(context as Record<string, unknown>)[stepKey] = { output: result }\n      }\n\n      return Result.ok(Object.fromEntries(context.results))\n    } catch (error) {\n      return Result.err(\n        new EnsembleExecutionError(\n          this.ensembleName,\n          'graph-execution',\n          error instanceof Error ? error : new Error(String(error))\n        )\n      )\n    }\n  }\n\n  /**\n   * Execute a single step (dispatches to appropriate handler based on type)\n   */\n  private async executeStep(step: FlowStepType, context: GraphExecutionContext): Promise<unknown> {\n    // Agent step - delegate to executor callback\n    if (isAgentStep(step)) {\n      return this.executeAgentStep(step, context)\n    }\n\n    // Control flow steps\n    if (isParallelStep(step)) {\n      return this.executeParallel(step, context)\n    }\n\n    if (isBranchStep(step)) {\n      return this.executeBranch(step, context)\n    }\n\n    if (isForeachStep(step)) {\n      return this.executeForeach(step, context)\n    }\n\n    if (isTryStep(step)) {\n      return this.executeTry(step, context)\n    }\n\n    if (isSwitchStep(step)) {\n      return this.executeSwitch(step, context)\n    }\n\n    if (isWhileStep(step)) {\n      return this.executeWhile(step, context)\n    }\n\n    if (isMapReduceStep(step)) {\n      return this.executeMapReduce(step, context)\n    }\n\n    throw new Error(`Unknown step type: ${JSON.stringify(step)}`)\n  }\n\n  /**\n   * Execute an agent step by delegating to the executor callback\n   */\n  private async executeAgentStep(\n    step: AgentFlowStep,\n    context: GraphExecutionContext\n  ): Promise<unknown> {\n    // Check conditional execution (when/condition)\n    if (step.when !== undefined || step.condition !== undefined) {\n      const condition = step.when ?? step.condition\n      const shouldExecute = this.evaluateCondition(condition, context)\n      if (!shouldExecute) {\n        return { skipped: true, reason: 'condition evaluated to false' }\n      }\n    }\n\n    // Resolve input interpolations\n    const resolvedInput = step.input\n      ? Parser.resolveInterpolation(step.input, this.buildResolutionContext(context))\n      : undefined\n\n    // Create step with resolved input\n    const resolvedStep: AgentFlowStep = {\n      ...step,\n      input: resolvedInput as Record<string, unknown> | undefined,\n    }\n\n    // Delegate to executor callback for actual agent execution\n    return this.agentExecutor(resolvedStep, context)\n  }\n\n  /**\n   * Execute parallel steps concurrently\n   */\n  private async executeParallel(\n    step: ParallelFlowStep,\n    context: GraphExecutionContext\n  ): Promise<unknown[]> {\n    const executions = step.steps.map((subStep) => this.executeStep(subStep, context))\n\n    switch (step.waitFor) {\n      case 'any':\n        // Return first completed result\n        return [await Promise.race(executions)]\n\n      case 'first':\n        // Return first successful result (ignores failures)\n        return [\n          await Promise.any(executions).catch(() => {\n            throw new Error('All parallel steps failed')\n          }),\n        ]\n\n      case 'all':\n      default:\n        // Wait for all to complete\n        return Promise.all(executions)\n    }\n  }\n\n  /**\n   * Execute conditional branch\n   */\n  private async executeBranch(\n    step: BranchFlowStep,\n    context: GraphExecutionContext\n  ): Promise<unknown> {\n    const conditionResult = this.evaluateCondition(step.condition, context)\n\n    // Select branch based on condition\n    const branchSteps = conditionResult ? step.then : step.else || []\n\n    // Execute selected branch sequentially\n    const branchResults: unknown[] = []\n    for (const subStep of branchSteps) {\n      const result = await this.executeStep(subStep, context)\n      branchResults.push(result)\n    }\n\n    return branchResults\n  }\n\n  /**\n   * Execute foreach loop over items\n   */\n  private async executeForeach(\n    step: ForeachFlowStep,\n    context: GraphExecutionContext\n  ): Promise<unknown[]> {\n    // Resolve items expression\n    const items = this.resolveExpression(step.items, context)\n\n    if (!Array.isArray(items)) {\n      throw new Error(`Foreach items must be an array, got: ${typeof items}`)\n    }\n\n    const maxConcurrency = step.maxConcurrency || items.length\n    const results: unknown[] = []\n\n    // Process items in batches based on maxConcurrency\n    for (let i = 0; i < items.length; i += maxConcurrency) {\n      const batch = items.slice(i, i + maxConcurrency)\n\n      const batchResults = await Promise.all(\n        batch.map((item, index) => {\n          // Create context with current item and index\n          const itemContext: GraphExecutionContext = {\n            ...context,\n            results: new Map(context.results),\n          }\n          ;(itemContext as Record<string, unknown>).item = item\n          ;(itemContext as Record<string, unknown>).index = i + index\n\n          return this.executeStep(step.step, itemContext)\n        })\n      )\n\n      results.push(...batchResults)\n\n      // Check break condition after each batch\n      if (step.breakWhen) {\n        const shouldBreak = this.evaluateCondition(step.breakWhen, {\n          ...context,\n          results: new Map([...context.results, ['lastBatchResults', batchResults]]),\n        } as GraphExecutionContext)\n        if (shouldBreak) {\n          break\n        }\n      }\n    }\n\n    return results\n  }\n\n  /**\n   * Execute try/catch/finally block\n   */\n  private async executeTry(step: TryFlowStep, context: GraphExecutionContext): Promise<unknown> {\n    let tryResult: unknown\n    let caughtError: Error | null = null\n\n    try {\n      // Execute try block\n      const tryResults: unknown[] = []\n      for (const subStep of step.steps) {\n        const result = await this.executeStep(subStep, context)\n        tryResults.push(result)\n      }\n      tryResult = tryResults\n    } catch (error) {\n      caughtError = error instanceof Error ? error : new Error(String(error))\n\n      // Execute catch block if present\n      if (step.catch && step.catch.length > 0) {\n        const errorContext: GraphExecutionContext = {\n          ...context,\n          results: new Map(context.results),\n        }\n        ;(errorContext as Record<string, unknown>).error = {\n          message: caughtError.message,\n          name: caughtError.name,\n          stack: caughtError.stack,\n        }\n\n        const catchResults: unknown[] = []\n        for (const subStep of step.catch) {\n          const result = await this.executeStep(subStep, errorContext)\n          catchResults.push(result)\n        }\n        tryResult = catchResults\n      } else {\n        // No catch block - rethrow\n        throw caughtError\n      }\n    } finally {\n      // Execute finally block if present\n      if (step.finally && step.finally.length > 0) {\n        for (const subStep of step.finally) {\n          await this.executeStep(subStep, context)\n        }\n      }\n    }\n\n    return tryResult\n  }\n\n  /**\n   * Execute switch/case branching\n   */\n  private async executeSwitch(\n    step: SwitchFlowStep,\n    context: GraphExecutionContext\n  ): Promise<unknown> {\n    // Resolve the switch value\n    const value = this.resolveExpression(step.value, context)\n    const valueStr = String(value)\n\n    // Find matching case\n    let caseSteps = step.cases[valueStr]\n    if (!caseSteps && step.default) {\n      caseSteps = step.default\n    }\n\n    if (!caseSteps) {\n      return null // No matching case and no default\n    }\n\n    // Execute case steps sequentially\n    const caseResults: unknown[] = []\n    for (const subStep of caseSteps) {\n      const result = await this.executeStep(subStep, context)\n      caseResults.push(result)\n    }\n\n    return caseResults\n  }\n\n  /**\n   * Execute while loop\n   */\n  private async executeWhile(\n    step: WhileFlowStep,\n    context: GraphExecutionContext\n  ): Promise<unknown[]> {\n    const maxIterations = step.maxIterations || 1000 // Safety limit\n    const results: unknown[] = []\n    let iterations = 0\n\n    // Create mutable context for loop\n    const loopContext: GraphExecutionContext = {\n      ...context,\n      results: new Map(context.results),\n    }\n\n    while (iterations < maxIterations) {\n      // Check condition before each iteration\n      const shouldContinue = this.evaluateCondition(step.condition, loopContext)\n      if (!shouldContinue) {\n        break\n      }\n\n      // Execute loop body\n      const iterationResults: unknown[] = []\n      for (const subStep of step.steps) {\n        const result = await this.executeStep(subStep, loopContext)\n        iterationResults.push(result)\n      }\n\n      results.push(iterationResults)\n      ;(loopContext as Record<string, unknown>).iteration = iterations\n      ;(loopContext as Record<string, unknown>).lastIterationResults = iterationResults\n\n      iterations++\n    }\n\n    if (iterations >= maxIterations) {\n      throw new Error(`While loop exceeded maximum iterations (${maxIterations})`)\n    }\n\n    return results\n  }\n\n  /**\n   * Execute map-reduce pattern\n   */\n  private async executeMapReduce(\n    step: MapReduceFlowStep,\n    context: GraphExecutionContext\n  ): Promise<unknown> {\n    // Resolve items expression\n    const items = this.resolveExpression(step.items, context)\n\n    if (!Array.isArray(items)) {\n      throw new Error(`Map-reduce items must be an array, got: ${typeof items}`)\n    }\n\n    const maxConcurrency = step.maxConcurrency || items.length\n    const mapResults: unknown[] = []\n\n    // Map phase: process items with concurrency control\n    for (let i = 0; i < items.length; i += maxConcurrency) {\n      const batch = items.slice(i, i + maxConcurrency)\n\n      const batchResults = await Promise.all(\n        batch.map((item, index) => {\n          const itemContext: GraphExecutionContext = {\n            ...context,\n            results: new Map(context.results),\n          }\n          ;(itemContext as Record<string, unknown>).item = item\n          ;(itemContext as Record<string, unknown>).index = i + index\n\n          return this.executeStep(step.map, itemContext)\n        })\n      )\n\n      mapResults.push(...batchResults)\n    }\n\n    // Reduce phase: aggregate results\n    const reduceContext: GraphExecutionContext = {\n      ...context,\n      results: new Map(context.results),\n    }\n    ;(reduceContext as Record<string, unknown>).mapResults = mapResults\n    ;(reduceContext as Record<string, unknown>).results = mapResults // Alias\n\n    return this.executeStep(step.reduce, reduceContext)\n  }\n\n  /**\n   * Get a unique key for storing step results\n   */\n  private getStepKey(step: FlowStepType, index: number): string {\n    if (isAgentStep(step)) {\n      return step.id || step.agent\n    }\n\n    // For control flow steps, use type and index\n    if ('type' in step) {\n      return `${step.type}_${index}`\n    }\n\n    return `step_${index}`\n  }\n\n  /**\n   * Evaluate a condition expression\n   * Supports both interpolation expressions and JavaScript expressions\n   */\n  private evaluateCondition(condition: unknown, context: GraphExecutionContext): boolean {\n    if (typeof condition === 'boolean') {\n      return condition\n    }\n\n    if (typeof condition === 'string') {\n      // First try to resolve interpolation (${...} or {{...}})\n      const resolved = this.resolveExpression(condition, context)\n\n      if (typeof resolved === 'boolean') {\n        return resolved\n      }\n\n      // If still a string, try to evaluate as expression\n      if (typeof resolved === 'string') {\n        return this.evaluateJsExpression(resolved, context)\n      }\n\n      // Truthy check\n      return Boolean(resolved)\n    }\n\n    // For objects/arrays, check truthiness\n    return Boolean(condition)\n  }\n\n  /**\n   * Resolve an expression using Parser's interpolation system\n   */\n  private resolveExpression(expression: unknown, context: GraphExecutionContext): unknown {\n    if (expression === null || expression === undefined) {\n      return expression\n    }\n\n    return Parser.resolveInterpolation(expression, this.buildResolutionContext(context))\n  }\n\n  /**\n   * Build resolution context for Parser.resolveInterpolation\n   */\n  private buildResolutionContext(context: GraphExecutionContext): Record<string, unknown> {\n    const resolutionContext: Record<string, unknown> = {\n      input: context.input,\n      state: context.state || {},\n    }\n\n    // Add all step results to context\n    for (const [key, value] of context.results) {\n      resolutionContext[key] = { output: value }\n    }\n\n    // Add any additional context properties\n    for (const [key, value] of Object.entries(context)) {\n      if (key !== 'input' && key !== 'state' && key !== 'results') {\n        resolutionContext[key] = value\n      }\n    }\n\n    return resolutionContext\n  }\n\n  /**\n   * Evaluate a JavaScript expression in the context\n   * Used as fallback for complex condition expressions\n   */\n  private evaluateJsExpression(expression: string, context: GraphExecutionContext): boolean {\n    try {\n      // Build evaluation context\n      const evalContext = this.buildResolutionContext(context)\n\n      // Create function with context variables\n      const func = new Function('context', 'input', 'state', 'results', `return ${expression}`)\n\n      return Boolean(\n        func(evalContext, context.input, context.state || {}, Object.fromEntries(context.results))\n      )\n    } catch (error) {\n      // If evaluation fails, return false (safe default)\n      console.warn(`Failed to evaluate condition \"${expression}\":`, error)\n      return false\n    }\n  }\n}\n","/**\n * State Manager V2 - Refactored for Immutability\n *\n * Returns new instances instead of mutating internal state.\n * Follows functional programming principles for predictability.\n */\n\nimport { createLogger, type Logger } from '../observability/index.js'\n\nexport interface StateConfig {\n  schema?: Record<string, unknown>\n  initial?: Record<string, unknown>\n  logger?: Logger\n}\n\nexport interface MemberStateConfig {\n  use?: string[]\n  set?: string[]\n}\n\nexport interface StateContext {\n  state: Readonly<Record<string, unknown>>\n  setState: (updates: Record<string, unknown>) => void\n}\n\nexport interface AccessLogEntry {\n  agent: string\n  key: string\n  operation: 'read' | 'write'\n  timestamp: number\n}\n\nexport interface AccessReport {\n  unusedKeys: string[]\n  accessPatterns: Record<string, AccessLogEntry[]>\n}\n\n/**\n * Immutable StateManager - returns new instances for all mutations\n */\nexport class StateManager {\n  private readonly schema: Readonly<Record<string, unknown>>\n  private readonly state: Readonly<Record<string, unknown>>\n  private readonly accessLog: ReadonlyArray<AccessLogEntry>\n  private readonly logger: Logger\n\n  constructor(\n    config: StateConfig,\n    existingState?: Readonly<Record<string, unknown>>,\n    existingLog?: ReadonlyArray<AccessLogEntry>\n  ) {\n    this.schema = Object.freeze(config.schema || {})\n    this.state = Object.freeze(existingState || { ...(config.initial || {}) })\n    this.accessLog = existingLog || []\n    this.logger = config.logger || createLogger({ serviceName: 'state-manager' })\n  }\n\n  /**\n   * Create a state context for a specific agent\n   * Returns both the context and a function to retrieve accumulated updates\n   */\n  getStateForAgent(\n    agentName: string,\n    config: MemberStateConfig\n  ): {\n    context: StateContext\n    getPendingUpdates: () => { updates: Record<string, unknown>; newLog: AccessLogEntry[] }\n  } {\n    const { use = [], set = [] } = config\n\n    // Create read-only state view (only includes declared 'use' keys)\n    const viewState: Record<string, unknown> = {}\n    const newLog: AccessLogEntry[] = [...this.accessLog]\n\n    for (const key of use) {\n      if (this.state && key in this.state) {\n        viewState[key] = this.state[key]\n        newLog.push({\n          agent: agentName,\n          key,\n          operation: 'read',\n          timestamp: Date.now(),\n        })\n      }\n    }\n\n    // Track pending updates in closure\n    const pendingUpdates: Record<string, unknown> = {}\n\n    // Create setState function that accumulates updates\n    const setState = (updates: Record<string, unknown>) => {\n      for (const [key, value] of Object.entries(updates)) {\n        if (set.includes(key)) {\n          pendingUpdates[key] = value\n          newLog.push({\n            agent: agentName,\n            key,\n            operation: 'write',\n            timestamp: Date.now(),\n          })\n        } else {\n          this.logger.warn('Agent attempted to set undeclared state key', {\n            agentName,\n            key,\n            declaredKeys: set,\n          })\n        }\n      }\n    }\n\n    return {\n      context: {\n        state: Object.freeze(viewState),\n        setState,\n      },\n      getPendingUpdates: () => ({ updates: pendingUpdates, newLog }),\n    }\n  }\n\n  /**\n   * Apply pending updates from a agent execution (returns new StateManager instance)\n   * This is the preferred method when using getStateForAgent with getPendingUpdates\n   */\n  applyPendingUpdates(updates: Record<string, unknown>, newLog: AccessLogEntry[]): StateManager {\n    // If no updates, return this instance (optimization)\n    if (Object.keys(updates).length === 0 && newLog.length === this.accessLog.length) {\n      return this\n    }\n\n    // Create new state with updates\n    const newState: Record<string, unknown> = { ...this.state, ...updates }\n\n    // Return new StateManager with updated state and log\n    return new StateManager(\n      { schema: this.schema, initial: {}, logger: this.logger },\n      newState,\n      newLog\n    )\n  }\n\n  /**\n   * Update state from a agent (returns new StateManager instance)\n   * Use applyPendingUpdates for better performance when using getStateForAgent\n   */\n  setStateFromMember(\n    agentName: string,\n    updates: Record<string, unknown>,\n    config: MemberStateConfig\n  ): StateManager {\n    const { set = [] } = config\n\n    // Create new state object\n    const newState: Record<string, unknown> = { ...this.state }\n    const newLog: AccessLogEntry[] = [...this.accessLog]\n\n    for (const [key, value] of Object.entries(updates)) {\n      if (set.includes(key)) {\n        newState[key] = value\n        newLog.push({\n          agent: agentName,\n          key,\n          operation: 'write',\n          timestamp: Date.now(),\n        })\n      } else {\n        this.logger.warn('Agent attempted to set undeclared state key', {\n          agentName,\n          key,\n          declaredKeys: set,\n        })\n      }\n    }\n\n    // Return new StateManager with updated state\n    return new StateManager(\n      { schema: this.schema, initial: {}, logger: this.logger },\n      newState,\n      newLog\n    )\n  }\n\n  /**\n   * Get the full current state snapshot\n   */\n  getState(): Readonly<Record<string, unknown>> {\n    return this.state\n  }\n\n  /**\n   * Generate an access report showing state usage patterns\n   */\n  getAccessReport(): AccessReport {\n    const allKeys = Object.keys(this.state)\n    const usedKeys = new Set<string>()\n\n    // Collect all keys that were accessed\n    for (const access of this.accessLog) {\n      usedKeys.add(access.key)\n    }\n\n    // Find unused keys\n    const unusedKeys = allKeys.filter((key) => !usedKeys.has(key))\n\n    // Group access log by agent\n    const accessPatterns: Record<string, AccessLogEntry[]> = {}\n    for (const access of this.accessLog) {\n      if (!accessPatterns[access.agent]) {\n        accessPatterns[access.agent] = []\n      }\n      accessPatterns[access.agent].push(access)\n    }\n\n    return {\n      unusedKeys,\n      accessPatterns,\n    }\n  }\n\n  /**\n   * Clear access logs (returns new instance)\n   */\n  clearAccessLog(): StateManager {\n    return new StateManager(\n      { schema: this.schema, initial: {}, logger: this.logger },\n      this.state,\n      []\n    )\n  }\n\n  /**\n   * Reset state to initial values (returns new instance)\n   */\n  reset(initialState?: Record<string, unknown>): StateManager {\n    return new StateManager(\n      { schema: this.schema, initial: initialState || {}, logger: this.logger },\n      undefined,\n      []\n    )\n  }\n\n  /**\n   * Create a new StateManager with merged state\n   */\n  merge(updates: Record<string, unknown>): StateManager {\n    const newState = { ...this.state, ...updates }\n    return new StateManager(\n      { schema: this.schema, initial: {}, logger: this.logger },\n      newState,\n      this.accessLog\n    )\n  }\n}\n","/**\n * Safe Fetch - SSRF-Protected HTTP Client\n *\n * A wrapper around the native `fetch()` that provides protection against\n * Server-Side Request Forgery (SSRF) attacks.\n *\n * Use this for any fetch where the URL comes from user input or external sources.\n * For hardcoded API endpoints (like Twilio, Resend, etc.), regular fetch() is fine.\n *\n * @example\n * ```ts\n * // User-provided URL - use safeFetch\n * const response = await safeFetch(userInput.url)\n *\n * // Hardcoded API - regular fetch is fine\n * const response = await fetch('https://api.twilio.com/...')\n * ```\n */\n\nexport interface SafeFetchOptions extends RequestInit {\n  /**\n   * Allow requests to private/internal IP addresses\n   *\n   * WARNING: Enabling this bypasses SSRF protection and allows requests to\n   * internal network resources, cloud metadata services, and localhost.\n   * Only enable if you trust the input URLs completely.\n   *\n   * @default false\n   */\n  allowInternalRequests?: boolean\n}\n\n/**\n * Check if a hostname resolves to a private/internal IP address\n *\n * Blocked ranges:\n * - 127.0.0.0/8 (localhost)\n * - 10.0.0.0/8 (private class A)\n * - 172.16.0.0/12 (private class B)\n * - 192.168.0.0/16 (private class C)\n * - 169.254.0.0/16 (link-local, including AWS/GCP/Azure metadata)\n * - 0.0.0.0/8 (current network)\n * - ::1 (IPv6 localhost)\n * - fc00::/7 (IPv6 unique local)\n * - fe80::/10 (IPv6 link-local)\n */\nfunction isPrivateOrInternalIP(hostname: string): boolean {\n  // Handle IPv6 in brackets\n  const cleanHostname = hostname.replace(/^\\[|\\]$/g, '')\n\n  // Check for obvious internal hostnames\n  if (\n    cleanHostname === 'localhost' ||\n    cleanHostname.endsWith('.local') ||\n    cleanHostname.endsWith('.internal') ||\n    cleanHostname.endsWith('.localhost')\n  ) {\n    return true\n  }\n\n  // Parse as IP address\n  const ipv4Parts = cleanHostname.split('.').map(Number)\n\n  if (ipv4Parts.length === 4 && ipv4Parts.every((n) => !isNaN(n) && n >= 0 && n <= 255)) {\n    const [a, b, c] = ipv4Parts\n\n    // 127.0.0.0/8 - Loopback\n    if (a === 127) return true\n\n    // 10.0.0.0/8 - Private Class A\n    if (a === 10) return true\n\n    // 172.16.0.0/12 - Private Class B\n    if (a === 172 && b >= 16 && b <= 31) return true\n\n    // 192.168.0.0/16 - Private Class C\n    if (a === 192 && b === 168) return true\n\n    // 169.254.0.0/16 - Link-local (AWS/GCP/Azure metadata service)\n    if (a === 169 && b === 254) return true\n\n    // 0.0.0.0/8 - Current network\n    if (a === 0) return true\n\n    // 100.64.0.0/10 - Carrier-grade NAT\n    if (a === 100 && b >= 64 && b <= 127) return true\n\n    // 192.0.0.0/24 - IETF protocol assignments\n    if (a === 192 && b === 0 && c === 0) return true\n\n    // 192.0.2.0/24, 198.51.100.0/24, 203.0.113.0/24 - Documentation\n    if (\n      (a === 192 && b === 0 && c === 2) ||\n      (a === 198 && b === 51 && c === 100) ||\n      (a === 203 && b === 0 && c === 113)\n    )\n      return true\n\n    // 224.0.0.0/4 - Multicast\n    if (a >= 224 && a <= 239) return true\n\n    // 240.0.0.0/4 - Reserved for future use\n    if (a >= 240) return true\n  }\n\n  // IPv6 checks\n  const lowerHostname = cleanHostname.toLowerCase()\n\n  // ::1 - Loopback\n  if (lowerHostname === '::1' || lowerHostname === '0:0:0:0:0:0:0:1') return true\n\n  // fc00::/7 - Unique local address\n  if (lowerHostname.startsWith('fc') || lowerHostname.startsWith('fd')) return true\n\n  // fe80::/10 - Link-local\n  if (\n    lowerHostname.startsWith('fe8') ||\n    lowerHostname.startsWith('fe9') ||\n    lowerHostname.startsWith('fea') ||\n    lowerHostname.startsWith('feb')\n  )\n    return true\n\n  // :: - Unspecified address\n  if (lowerHostname === '::' || lowerHostname === '0:0:0:0:0:0:0:0') return true\n\n  return false\n}\n\n/**\n * Validate a URL for SSRF attacks\n *\n * @throws Error if URL is invalid or targets a private/internal address\n */\nexport function validateURL(urlString: string, allowInternal: boolean = false): URL {\n  let url: URL\n  try {\n    url = new URL(urlString)\n  } catch {\n    throw new Error(`Invalid URL: ${urlString}`)\n  }\n\n  // Only allow http/https protocols\n  if (!['http:', 'https:'].includes(url.protocol)) {\n    throw new Error(`Unsupported protocol: ${url.protocol}. Only HTTP(S) is allowed.`)\n  }\n\n  // Check for private IPs unless explicitly allowed\n  if (!allowInternal && isPrivateOrInternalIP(url.hostname)) {\n    throw new Error(\n      `SSRF protection: Blocked request to private/internal address: ${url.hostname}. ` +\n        `Use { allowInternalRequests: true } to bypass (not recommended).`\n    )\n  }\n\n  return url\n}\n\n/**\n * SSRF-protected fetch wrapper\n *\n * Use this instead of `fetch()` when the URL comes from user input or external sources.\n *\n * @param input - URL string or Request object\n * @param init - Fetch options with optional `allowInternalRequests` flag\n * @returns Promise<Response>\n * @throws Error if URL is invalid or targets a private/internal address\n *\n * @example\n * ```ts\n * // Basic usage\n * const response = await safeFetch('https://api.example.com/data')\n *\n * // With options\n * const response = await safeFetch(url, {\n *   method: 'POST',\n *   headers: { 'Content-Type': 'application/json' },\n *   body: JSON.stringify(data),\n * })\n *\n * // Bypass SSRF protection (use with caution!)\n * const response = await safeFetch(internalUrl, {\n *   allowInternalRequests: true,\n * })\n * ```\n */\nexport async function safeFetch(\n  input: string | URL | Request,\n  init?: SafeFetchOptions\n): Promise<Response> {\n  const { allowInternalRequests = false, ...fetchInit } = init ?? {}\n\n  // Extract URL string from input\n  let urlString: string\n  if (typeof input === 'string') {\n    urlString = input\n  } else if (input instanceof URL) {\n    urlString = input.href\n  } else if (input instanceof Request) {\n    urlString = input.url\n  } else {\n    throw new Error('Invalid fetch input: expected string, URL, or Request')\n  }\n\n  // Validate URL for SSRF\n  const validatedUrl = validateURL(urlString, allowInternalRequests)\n\n  // Make the request with validated URL\n  return fetch(validatedUrl.href, fetchInit)\n}\n\n/**\n * Check if a URL is safe (would not be blocked by SSRF protection)\n *\n * Useful for pre-validation or user feedback.\n *\n * @param urlString - URL to check\n * @returns true if URL is safe, false otherwise\n */\nexport function isURLSafe(urlString: string): boolean {\n  try {\n    validateURL(urlString, false)\n    return true\n  } catch {\n    return false\n  }\n}\n","/**\n * Base Agent class\n *\n * Foundation for all agent types (Think, Function, Data, API, etc.)\n * Provides standard interface, response wrapping, error handling, and cache key generation\n */\n\nimport type { AgentConfig } from '../runtime/parser.js'\nimport type { StateContext } from '../runtime/state-manager.js'\nimport type { ConductorEnv } from '../types/env.js'\nimport type { Logger } from '../observability/types.js'\nimport type { MetricsRecorder } from '../observability/context.js'\nimport type { AuthContext } from '../auth/types.js'\nimport type { SchemaRegistry } from '../components/schemas.js'\nimport type { PromptRegistry } from '../components/prompts.js'\nimport type { ConfigRegistry } from '../components/configs.js'\nimport type { QueryRegistry } from '../components/queries.js'\nimport type { ScriptRegistry } from '../components/scripts.js'\nimport type { TemplateRegistry } from '../components/templates.js'\nimport type { AgentRegistry, EnsembleRegistry, DocsRegistry } from '../components/discovery.js'\nimport type { SafeFetchOptions } from '../utils/safe-fetch.js'\nimport { safeFetch } from '../utils/safe-fetch.js'\nimport type { ExecutionId, RequestId } from '../types/branded.js'\nimport type { MemoryManager } from '../runtime/memory/memory-manager.js'\n\n/**\n * Execution context passed to agents\n *\n * Contains everything an agent needs to execute:\n * - Input data\n * - State management\n * - Environment bindings\n * - Observability (logger + metrics)\n */\nexport interface AgentExecutionContext {\n  /** Input data for the agent */\n  input: Record<string, any>\n\n  /** Shared state (if ensemble has state config) */\n  state?: Record<string, any>\n\n  /** Function to update shared state */\n  setState?: (updates: Record<string, any>) => void\n\n  /** Cloudflare environment bindings */\n  env: ConductorEnv\n\n  /** Cloudflare execution context */\n  ctx: ExecutionContext\n\n  /** Outputs from previous agents in the flow */\n  previousOutputs?: Record<string, any>\n\n  /**\n   * Scoped logger for this agent\n   * Pre-configured with agent name, ensemble name, and execution IDs\n   *\n   * @example\n   * ```typescript\n   * export default async function(context: AgentExecutionContext) {\n   *   const { logger } = context\n   *   logger.info('Processing started', { itemCount: items.length })\n   *   // ... do work ...\n   *   logger.debug('Processing complete', { result })\n   *   return result\n   * }\n   * ```\n   */\n  logger?: Logger\n\n  /**\n   * Metrics recorder for Analytics Engine\n   * Pre-configured with agent context\n   *\n   * @example\n   * ```typescript\n   * export default async function(context: AgentExecutionContext) {\n   *   const { metrics } = context\n   *   const startTime = Date.now()\n   *   // ... do work ...\n   *   metrics.record('items.processed', items.length)\n   *   return result\n   * }\n   * ```\n   */\n  metrics?: MetricsRecorder\n\n  /**\n   * Unique execution ID for tracing\n   * Same across all agents in an ensemble execution\n   * Branded type ensures type safety - use ExecutionId.unwrap() to get string\n   */\n  executionId?: ExecutionId\n\n  /**\n   * Unique request ID\n   * Same across the entire HTTP request lifecycle\n   * Branded type ensures type safety - use RequestId.unwrap() to get string\n   */\n  requestId?: RequestId\n\n  /**\n   * Authentication context from the request\n   * Available when request was authenticated via trigger auth or API middleware\n   *\n   * @example\n   * ```typescript\n   * export default async function(context: AgentExecutionContext) {\n   *   const { auth } = context\n   *   if (auth?.authenticated) {\n   *     logger.info('Request from user', { userId: auth.user?.id })\n   *   }\n   *   return { userAuthenticated: auth?.authenticated ?? false }\n   * }\n   * ```\n   */\n  auth?: AuthContext\n\n  /**\n   * Schema registry for validating data against JSON schemas\n   * Schemas are loaded from KV storage with versioning support\n   *\n   * @example\n   * ```typescript\n   * export default async function(context: AgentExecutionContext) {\n   *   const { schemas, input } = context\n   *\n   *   // Validate input against a schema\n   *   const result = await schemas.validate('order@v1.0.0', input)\n   *   if (!result.valid) {\n   *     throw new Error(`Validation failed: ${result.errors[0].message}`)\n   *   }\n   *\n   *   // Quick boolean check\n   *   if (await schemas.isValid('order', input)) {\n   *     // process valid order\n   *   }\n   *\n   *   return { validated: true }\n   * }\n   * ```\n   */\n  schemas?: SchemaRegistry\n\n  /**\n   * Prompt registry for accessing and rendering prompt templates\n   * Prompts are loaded from KV storage with Handlebars rendering\n   *\n   * @example\n   * ```typescript\n   * export default async function(context: AgentExecutionContext) {\n   *   const { prompts, input } = context\n   *\n   *   // Get raw prompt template\n   *   const template = await prompts.get('extraction@v1.0.0')\n   *\n   *   // Render with variables\n   *   const rendered = await prompts.render('docs-writer', {\n   *     page: input.page,\n   *     projectName: 'MyApp'\n   *   })\n   *\n   *   return { prompt: rendered }\n   * }\n   * ```\n   */\n  prompts?: PromptRegistry\n\n  /**\n   * Config registry for accessing shared configuration components\n   * Configs are loaded from KV storage with versioning and merging support\n   *\n   * @example\n   * ```typescript\n   * export default async function(context: AgentExecutionContext) {\n   *   const { configs } = context\n   *\n   *   // Get full config\n   *   const settings = await configs.get('docs-settings')\n   *\n   *   // Get nested value with default\n   *   const theme = await configs.getValueOrDefault(\n   *     'docs-settings',\n   *     'theme.primaryColor',\n   *     '#3B82F6'\n   *   )\n   *\n   *   // Merge with overrides\n   *   const customSettings = await configs.merge('docs-settings', {\n   *     theme: { primaryColor: '#FF0000' }\n   *   })\n   *\n   *   return { theme }\n   * }\n   * ```\n   */\n  configs?: ConfigRegistry\n\n  /**\n   * Query registry for accessing SQL query templates\n   * Queries are loaded from KV storage with versioning support\n   *\n   * @example\n   * ```typescript\n   * export default async function(context: AgentExecutionContext) {\n   *   const { queries, env } = context\n   *\n   *   // Get a query template\n   *   const sql = await queries.getSql('find-users@v1.0.0')\n   *\n   *   // Execute with D1\n   *   const stmt = env.DB.prepare(sql)\n   *   const results = await stmt.bind(userId).all()\n   *\n   *   return { users: results.results }\n   * }\n   * ```\n   */\n  queries?: QueryRegistry\n\n  /**\n   * Script registry for accessing JavaScript/TypeScript scripts\n   * Scripts are loaded from KV storage with versioning support\n   *\n   * @example\n   * ```typescript\n   * export default async function(context: AgentExecutionContext) {\n   *   const { scripts } = context\n   *\n   *   // Get a script's source code\n   *   const script = await scripts.get('transform-data@v1.0.0')\n   *\n   *   // Check if a script exists\n   *   if (await scripts.exists('custom-validator')) {\n   *     const validator = await scripts.get('custom-validator')\n   *   }\n   *\n   *   return { processed: true }\n   * }\n   * ```\n   */\n  scripts?: ScriptRegistry\n\n  /**\n   * Template registry for accessing HTML/Handlebars templates\n   * Templates are loaded from KV storage with versioning and rendering support\n   *\n   * @example\n   * ```typescript\n   * export default async function(context: AgentExecutionContext) {\n   *   const { templates } = context\n   *\n   *   // Get a template\n   *   const template = await templates.get('email-header@v1.0.0')\n   *\n   *   // Render with variables\n   *   const html = await templates.render('page-layout', {\n   *     title: 'Welcome',\n   *     content: 'Hello World',\n   *   })\n   *\n   *   return { html }\n   * }\n   * ```\n   */\n  templates?: TemplateRegistry\n\n  /**\n   * Agent-specific configuration from the ensemble definition\n   * This is the `config` block defined for this agent in the YAML\n   *\n   * @example\n   * ```yaml\n   * # In ensemble YAML:\n   * agents:\n   *   - name: my-agent\n   *     operation: code\n   *     config:\n   *       apiKey: ${env.API_KEY}\n   *       maxRetries: 3\n   *       options:\n   *         verbose: true\n   * ```\n   *\n   * ```typescript\n   * export default async function(context: AgentExecutionContext) {\n   *   const { config } = context\n   *\n   *   const apiKey = config?.apiKey as string\n   *   const maxRetries = config?.maxRetries ?? 1\n   *   const verbose = config?.options?.verbose ?? false\n   *\n   *   return { configured: true }\n   * }\n   * ```\n   */\n  config?: Record<string, any>\n\n  /**\n   * Agent registry for discovering available agents\n   * Useful for introspection and dynamic orchestration\n   *\n   * @example\n   * ```typescript\n   * export default async function(ctx: AgentExecutionContext) {\n   *   const { agentRegistry } = ctx\n   *\n   *   // List all available agents\n   *   const agents = agentRegistry?.list() || []\n   *\n   *   // Find agents by type\n   *   const dataAgents = agents.filter(a => a.operation === 'data')\n   *\n   *   // Check if a specific agent exists\n   *   if (agentRegistry?.has('my-custom-agent')) {\n   *     const meta = agentRegistry.get('my-custom-agent')\n   *     // Use agent metadata...\n   *   }\n   *\n   *   return { availableAgents: agents.map(a => a.name) }\n   * }\n   * ```\n   */\n  agentRegistry?: AgentRegistry\n\n  /**\n   * Ensemble registry for discovering available ensembles\n   * Useful for generating API docs (OpenAPI) or building orchestration UIs\n   *\n   * @example\n   * ```typescript\n   * export default async function(ctx: AgentExecutionContext) {\n   *   const { ensembleRegistry } = ctx\n   *\n   *   // List all ensembles\n   *   const ensembles = ensembleRegistry?.list() || []\n   *\n   *   // Find HTTP-triggered ensembles for OpenAPI generation\n   *   const httpEnsembles = ensembles.filter(e =>\n   *     e.triggers.some(t => t.type === 'http')\n   *   )\n   *\n   *   // Generate paths for OpenAPI spec\n   *   const paths = {}\n   *   for (const ensemble of httpEnsembles) {\n   *     for (const trigger of ensemble.triggers) {\n   *       if (trigger.type === 'http' && trigger.path) {\n   *         paths[trigger.path] = {\n   *           [trigger.methods?.[0]?.toLowerCase() || 'get']: {\n   *             summary: ensemble.description,\n   *             operationId: ensemble.name,\n   *           }\n   *         }\n   *       }\n   *     }\n   *   }\n   *\n   *   return { openapi: { paths } }\n   * }\n   * ```\n   */\n  ensembleRegistry?: EnsembleRegistry\n\n  /**\n   * Docs registry for discovering documentation pages\n   * Useful for rendering markdown pages in documentation agents\n   *\n   * @example\n   * ```typescript\n   * export default async function(ctx: AgentExecutionContext) {\n   *   const { docsRegistry, input } = ctx\n   *\n   *   // List all available docs pages\n   *   const pages = docsRegistry?.list() || []\n   *\n   *   // Get a specific page by slug\n   *   const page = docsRegistry?.get(input.slug)\n   *   if (!page) {\n   *     return { error: 'not_found', message: `Page not found: ${input.slug}` }\n   *   }\n   *\n   *   return { page }\n   * }\n   * ```\n   */\n  docsRegistry?: DocsRegistry\n\n  /**\n   * Memory manager for persistent conversation and context\n   *\n   * Provides access to 5 memory tiers:\n   * - **Working**: In-memory storage for current execution\n   * - **Session**: KV-based conversation history with TTL\n   * - **Long-Term**: D1-based persistent user data\n   * - **Semantic**: Vectorize-based semantic search (RAG)\n   * - **Analytical**: Hyperdrive SQL database access\n   *\n   * @example\n   * ```typescript\n   * export default async function(context: AgentExecutionContext) {\n   *   const { memory, input } = context\n   *\n   *   // Get conversation history\n   *   const history = await memory?.getConversationHistory() ?? []\n   *\n   *   // Add a new message\n   *   await memory?.addMessage({\n   *     role: 'user',\n   *     content: input.message,\n   *     timestamp: Date.now()\n   *   })\n   *\n   *   // Search semantic memory (RAG)\n   *   const relevant = await memory?.searchSemantic(input.query, { topK: 5 }) ?? []\n   *\n   *   // Store in long-term memory\n   *   await memory?.setLongTerm('user.preferences', { theme: 'dark' })\n   *\n   *   return { history, relevant }\n   * }\n   * ```\n   */\n  memory?: MemoryManager\n\n  /**\n   * SSRF-protected fetch function for making HTTP requests\n   *\n   * **ALWAYS use this instead of the global `fetch()`** when making requests\n   * to URLs that come from user input or external sources.\n   *\n   * By default, this blocks requests to:\n   * - Private IP ranges (10.x, 172.16.x, 192.168.x)\n   * - Localhost (127.0.0.1, ::1)\n   * - Cloud metadata services (169.254.169.254)\n   * - Internal hostnames (.local, .internal)\n   *\n   * @example\n   * ```typescript\n   * export default async function(context: AgentExecutionContext) {\n   *   const { fetch, input } = context\n   *\n   *   // Safe - SSRF protection is automatic\n   *   const response = await fetch(input.url)\n   *   const data = await response.json()\n   *\n   *   return { data }\n   * }\n   * ```\n   *\n   * @example\n   * ```typescript\n   * // If you MUST access internal URLs (use with extreme caution!)\n   * const response = await fetch(internalUrl, {\n   *   allowInternalRequests: true\n   * })\n   * ```\n   */\n  fetch?: (input: string | URL | Request, init?: SafeFetchOptions) => Promise<Response>\n}\n\nexport interface AgentResponse {\n  success: boolean\n  data?: unknown\n  output?: any // Alias for data, used by some agents\n  error?: string\n  timestamp: string\n  cached: boolean\n  executionTime: number\n  metadata?: Record<string, unknown>\n}\n\n/**\n * Security settings for agents\n * Read from AgentConfig.security and used to control automatic security features\n */\nexport interface AgentSecuritySettings {\n  /**\n   * Enable SSRF protection for fetch requests\n   * When true (default), requests to private IPs, localhost, and metadata services are blocked\n   * @default true\n   */\n  ssrf: boolean\n  // Future security features:\n  // inputSanitization: boolean\n  // rateLimiting: boolean\n}\n\n/**\n * Default security settings - secure by default\n */\nconst DEFAULT_SECURITY_SETTINGS: AgentSecuritySettings = {\n  ssrf: true,\n}\n\n/**\n * Base class for all agent types\n */\nexport abstract class BaseAgent {\n  protected config: AgentConfig\n  protected name: string\n  protected type: string\n  protected security: AgentSecuritySettings\n\n  constructor(config: AgentConfig) {\n    this.config = config\n    this.name = config.name\n    this.type = config.operation\n\n    // Initialize security settings from config, with secure defaults\n    this.security = {\n      ...DEFAULT_SECURITY_SETTINGS,\n      ...config.security,\n    }\n  }\n\n  /**\n   * Execute the agent with given input and context\n   * @param context - Execution context\n   * @returns Agent response\n   */\n  async execute(context: AgentExecutionContext): Promise<AgentResponse> {\n    const startTime = Date.now()\n\n    // Enrich context with security features before passing to run()\n    const enrichedContext = this.enrichContext(context)\n\n    try {\n      // Perform the actual work (implemented by subclasses)\n      const result = await this.run(enrichedContext)\n\n      const executionTime = Date.now() - startTime\n\n      return this.wrapSuccess(result, executionTime, false)\n    } catch (error) {\n      const executionTime = Date.now() - startTime\n      return this.wrapError(error, executionTime)\n    }\n  }\n\n  /**\n   * Enrich the execution context with automatic security features\n   *\n   * This method injects security utilities into the context based on\n   * the agent's security settings. Developers don't need to remember\n   * to add these - they're automatic.\n   *\n   * @param context - Original execution context\n   * @returns Enriched context with security features\n   */\n  protected enrichContext(context: AgentExecutionContext): AgentExecutionContext {\n    // Start with the original context\n    const enriched: AgentExecutionContext = { ...context }\n\n    // SSRF-protected fetch (if enabled and not already set)\n    if (this.security.ssrf && !context.fetch) {\n      enriched.fetch = safeFetch\n    } else if (!this.security.ssrf && !context.fetch) {\n      // SSRF disabled - use global fetch\n      enriched.fetch = fetch\n    }\n    // If context.fetch is already set, preserve it (allows override)\n\n    // Future security features would be added here:\n    // if (this.security.inputSanitization) { ... }\n    // if (this.security.rateLimiting) { ... }\n\n    return enriched\n  }\n\n  /**\n   * Abstract method to be implemented by each agent type\n   * @param context - Execution context\n   * @returns Execution result\n   */\n  protected abstract run(context: AgentExecutionContext): Promise<any>\n\n  /**\n   * Wrap successful execution result\n   * @param data - Result data\n   * @param executionTime - Time taken in milliseconds\n   * @param cached - Whether result was cached\n   * @returns Wrapped response\n   */\n  protected wrapSuccess(\n    data: unknown,\n    executionTime: number,\n    cached: boolean = false\n  ): AgentResponse {\n    return {\n      success: true,\n      data,\n      timestamp: new Date().toISOString(),\n      cached,\n      executionTime,\n      metadata: {\n        agent: this.name,\n        type: this.type,\n      },\n    }\n  }\n\n  /**\n   * Wrap error response\n   * @param error - Error object\n   * @param executionTime - Time taken in milliseconds\n   * @returns Wrapped error response\n   */\n  protected wrapError(error: unknown, executionTime: number): AgentResponse {\n    const errorMessage = error instanceof Error ? error.message : 'Unknown error occurred'\n\n    return {\n      success: false,\n      error: errorMessage,\n      timestamp: new Date().toISOString(),\n      cached: false,\n      executionTime,\n      metadata: {\n        agent: this.name,\n        type: this.type,\n      },\n    }\n  }\n\n  /**\n   * Generate cache key for this agent's execution\n   * @param input - Input data\n   * @returns Cache key string\n   */\n  async generateCacheKey(input: Record<string, any>): Promise<string> {\n    // Create a stable string representation of input\n    const inputString = JSON.stringify(this.sortObjectKeys(input))\n\n    // SHA-256 hash for cache key\n    const hash = await this.hashString(inputString)\n    return `agent:${this.name}:${hash}`\n  }\n\n  /**\n   * Sort object keys recursively for stable stringification\n   * @param obj - Object to sort\n   * @returns Sorted object\n   */\n  private sortObjectKeys(obj: unknown): unknown {\n    if (typeof obj !== 'object' || obj === null) {\n      return obj\n    }\n\n    if (Array.isArray(obj)) {\n      return obj.map((item) => this.sortObjectKeys(item))\n    }\n\n    const sorted: Record<string, unknown> = {}\n    const keys = Object.keys(obj).sort()\n\n    for (const key of keys) {\n      sorted[key] = this.sortObjectKeys((obj as Record<string, unknown>)[key])\n    }\n\n    return sorted\n  }\n\n  /**\n   * Cryptographically secure SHA-256 hash function\n   * @param str - String to hash\n   * @returns Hash value (hex string)\n   */\n  private async hashString(str: string): Promise<string> {\n    // Encode string to Uint8Array\n    const encoder = new TextEncoder()\n    const data = encoder.encode(str)\n\n    // Calculate SHA-256 hash\n    const hashBuffer = await crypto.subtle.digest('SHA-256', data)\n\n    // Convert to hex string\n    const hashArray = Array.from(new Uint8Array(hashBuffer))\n    const hashHex = hashArray.map((b) => b.toString(16).padStart(2, '0')).join('')\n\n    // Return first 16 chars for reasonable key length\n    return hashHex.substring(0, 16)\n  }\n\n  /**\n   * Get agent configuration\n   * @returns Agent configuration\n   */\n  getConfig(): AgentConfig {\n    return this.config\n  }\n\n  /**\n   * Get agent name\n   * @returns Agent name\n   */\n  getName(): string {\n    return this.name\n  }\n\n  /**\n   * Get agent type\n   * @returns Agent type\n   */\n  getType(): string {\n    return this.type\n  }\n}\n","/**\n * Function Agent Engine\n *\n * Executes user-defined JavaScript/TypeScript functions\n * The simplest agent type - just runs the provided function\n */\n\nimport { BaseAgent, type AgentExecutionContext } from './base-agent.js'\nimport type { AgentConfig } from '../runtime/parser.js'\n\nexport type FunctionImplementation = (context: AgentExecutionContext) => Promise<unknown> | unknown\n\n/**\n * Function Agent executes user-provided JavaScript functions\n *\n * @example User's agent definition:\n * ```yaml\n * # agents/greet/agent.yaml\n * name: greet\n * type: Function\n * description: Greet a user\n * schema:\n *   input:\n *     name: string\n *   output:\n *     message: string\n * ```\n *\n * ```typescript\n * // agents/greet/index.ts\n * export default async function greet({ input }) {\n *   return {\n *     message: `Hello, ${input.name}! Welcome to Conductor.`\n *   };\n * }\n * ```\n */\nexport class FunctionAgent extends BaseAgent {\n  private implementation: FunctionImplementation\n\n  constructor(config: AgentConfig, implementation: FunctionImplementation) {\n    super(config)\n\n    if (typeof implementation !== 'function') {\n      throw new Error(`Function agent \"${config.name}\" requires a function implementation`)\n    }\n\n    this.implementation = implementation\n  }\n\n  /**\n   * Execute the user-provided function\n   *\n   * Supports two calling conventions:\n   * - Modern single-param: handler(context) where context.input contains the input\n   * - Legacy two-param: handler(input, context) for backward compatibility\n   *\n   * Detection uses Function.length to check declared parameter count.\n   */\n  protected async run(context: AgentExecutionContext): Promise<unknown> {\n    try {\n      let result: unknown\n\n      // Detect calling convention based on function signature\n      // Function.length returns the number of declared parameters\n      if (this.implementation.length >= 2) {\n        // Legacy two-parameter style: handler(input, context)\n        // Cast to any to call with two arguments\n        result = await (this.implementation as any)(context.input, context)\n      } else {\n        // Modern single-parameter style: handler(context)\n        result = await this.implementation(context)\n      }\n\n      return result\n    } catch (error) {\n      // Wrap errors with context\n      throw new Error(\n        `Function agent \"${this.name}\" execution failed: ${\n          error instanceof Error ? error.message : 'Unknown error'\n        }`\n      )\n    }\n  }\n\n  /**\n   * Get the function implementation (for testing/inspection)\n   */\n  getImplementation(): FunctionImplementation {\n    return this.implementation\n  }\n\n  /**\n   * Create a FunctionAgent from a config with inline handler\n   * Supports test-style handlers: (input, context?) => result\n   */\n  static fromConfig(config: AgentConfig): FunctionAgent | null {\n    // Check if config has an inline handler function\n    // Handler signature: (input: unknown, context?: AgentExecutionContext) => Promise<unknown> | unknown\n    type InlineHandler = (\n      input: unknown,\n      context?: AgentExecutionContext\n    ) => Promise<unknown> | unknown\n    const agentConfig = config.config as { handler?: InlineHandler } | undefined\n    const handler = agentConfig?.handler\n\n    if (typeof handler === 'function') {\n      // Wrap the handler to match FunctionImplementation signature\n      const implementation: FunctionImplementation = async (context: AgentExecutionContext) => {\n        return await handler(context.input, context)\n      }\n\n      return new FunctionAgent(config, implementation)\n    }\n\n    return null\n  }\n}\n","/**\n * Script Loader Utility\n *\n * Resolves script URIs to pre-bundled handler functions.\n * This approach avoids `new Function()` which is blocked in Cloudflare Workers.\n *\n * Supports two URI formats (consistent with other component protocols):\n * - Full URI: \"script://transforms/csv\" or \"script://transforms/csv@v1.0.0\"\n * - Shorthand: \"script/transforms/csv\" or \"script/transforms/csv@v1.0.0\"\n *\n * Scripts are discovered at build time by vite-plugin-script-discovery and\n * bundled into a scriptsMap that can be passed to this loader.\n *\n * @example\n * ```typescript\n * import { scriptsMap } from 'virtual:conductor-scripts'\n * import { createScriptLoader } from './utils/script-loader'\n *\n * const loader = createScriptLoader(scriptsMap)\n * const handler = loader.resolve('script://transforms/csv')\n * // or: loader.resolve('script/transforms/csv')\n * const result = await handler(context)\n * ```\n */\n\nimport type { AgentExecutionContext } from '../agents/base-agent.js'\n\n/**\n * Script handler function signature\n * Same as agent handlers - receives full execution context\n */\nexport type ScriptHandler = (context: AgentExecutionContext) => Promise<unknown> | unknown\n\n/**\n * Script loader for resolving script:// URIs to bundled handlers\n */\nexport interface ScriptLoader {\n  /**\n   * Resolve a script:// URI to its handler function\n   * @param uri - Script URI (e.g., \"script://transforms/csv\")\n   * @returns The handler function\n   * @throws Error if script not found in bundle\n   */\n  resolve(uri: string): ScriptHandler\n\n  /**\n   * Check if a script exists in the bundle\n   * @param uri - Script URI\n   * @returns true if script is bundled\n   */\n  has(uri: string): boolean\n\n  /**\n   * Get all available script names\n   * @returns Array of script names (without script:// prefix)\n   */\n  list(): string[]\n}\n\n/**\n * Parse a script reference to extract the script name\n *\n * Supports multiple formats (consistent with other component protocols):\n * - Full URI: \"script://transforms/csv\" or \"script://transforms/csv@v1.0.0\"\n * - Shorthand: \"scripts/transforms/csv\" or \"scripts/transforms/csv@v1.0.0\"\n *\n * @example\n * parseScriptURI('script://transforms/csv') // returns 'transforms/csv'\n * parseScriptURI('scripts/transforms/csv') // returns 'transforms/csv'\n * parseScriptURI('scripts/health-check@v1.0.0') // returns 'health-check'\n */\nexport function parseScriptURI(uri: string): string {\n  let pathWithVersion: string\n\n  // Handle full URI format: script://path[@version]\n  if (uri.startsWith('script://')) {\n    pathWithVersion = uri.slice('script://'.length)\n  }\n  // Handle shorthand format: scripts/path[@version]\n  else if (uri.startsWith('scripts/')) {\n    pathWithVersion = uri.slice('scripts/'.length)\n  }\n  // Invalid format\n  else {\n    throw new Error(\n      `Invalid script reference: ${uri}\\n` +\n        `Expected formats:\\n` +\n        `  - script://transforms/csv (full URI)\\n` +\n        `  - scripts/transforms/csv (shorthand)\\n` +\n        `  - scripts/transforms/csv@v1.0.0 (with version)\\n` +\n        `Examples:\\n` +\n        `  - script://validators/email\\n` +\n        `  - scripts/health-check\\n` +\n        `  - scripts/auth/verify-token@v1.0.0`\n    )\n  }\n\n  // Remove version suffix if present (versioning handled by edgit, not at runtime)\n  const [path] = pathWithVersion.split('@')\n\n  if (!path) {\n    throw new Error(`Script reference has empty path: ${uri}`)\n  }\n\n  return path\n}\n\n/**\n * Check if a string is a script reference\n * @param value - The value to check\n * @returns true if it's a script reference (script:// or scripts/)\n */\nexport function isScriptReference(value: unknown): value is string {\n  return (\n    typeof value === 'string' && (value.startsWith('script://') || value.startsWith('scripts/'))\n  )\n}\n\n/**\n * Create a script loader from a Map of bundled scripts\n *\n * @param scriptsMap - Map from script name to handler function\n *                     (typically from virtual:conductor-scripts)\n * @returns ScriptLoader instance\n */\nexport function createScriptLoader(scriptsMap: Map<string, ScriptHandler>): ScriptLoader {\n  return {\n    resolve(uri: string): ScriptHandler {\n      const scriptName = parseScriptURI(uri)\n      const handler = scriptsMap.get(scriptName)\n\n      if (!handler) {\n        const available = Array.from(scriptsMap.keys())\n        const suggestions =\n          available.length > 0 ? `\\nAvailable scripts:\\n  - ${available.join('\\n  - ')}` : ''\n\n        throw new Error(\n          `Script not found: ${uri}\\n` +\n            `Script \"${scriptName}\" is not in the bundle.\\n` +\n            `Make sure you have a file at scripts/${scriptName}.ts with a default export.` +\n            suggestions\n        )\n      }\n\n      return handler\n    },\n\n    has(uri: string): boolean {\n      try {\n        const scriptName = parseScriptURI(uri)\n        return scriptsMap.has(scriptName)\n      } catch {\n        return false\n      }\n    },\n\n    list(): string[] {\n      return Array.from(scriptsMap.keys())\n    },\n  }\n}\n\n/**\n * Global script loader instance\n * Set this during application initialization with bundled scripts\n */\nlet globalScriptLoader: ScriptLoader | null = null\n\n/**\n * Set the global script loader\n * Call this during app initialization with the bundled scriptsMap\n *\n * @example\n * ```typescript\n * import { scriptsMap } from 'virtual:conductor-scripts'\n * import { setGlobalScriptLoader, createScriptLoader } from '@ensemble-edge/conductor'\n *\n * setGlobalScriptLoader(createScriptLoader(scriptsMap))\n * ```\n */\nexport function setGlobalScriptLoader(loader: ScriptLoader): void {\n  globalScriptLoader = loader\n}\n\n/**\n * Get the global script loader\n * @throws Error if not initialized\n */\nexport function getGlobalScriptLoader(): ScriptLoader {\n  if (!globalScriptLoader) {\n    throw new Error(\n      'Script loader not initialized.\\n' +\n        'Call setGlobalScriptLoader() during app initialization:\\n' +\n        '\\n' +\n        \"  import { scriptsMap } from 'virtual:conductor-scripts'\\n\" +\n        \"  import { setGlobalScriptLoader, createScriptLoader } from '@ensemble-edge/conductor'\\n\" +\n        '\\n' +\n        '  setGlobalScriptLoader(createScriptLoader(scriptsMap))'\n    )\n  }\n  return globalScriptLoader\n}\n\n/**\n * Check if a global script loader is available\n */\nexport function hasGlobalScriptLoader(): boolean {\n  return globalScriptLoader !== null\n}\n","/**\n * Code Agent\n *\n * Executes JavaScript/TypeScript code from bundled scripts or inline handlers.\n *\n * Script Resolution Priority:\n * 1. Pre-bundled scripts (via script:// URI and global ScriptLoader) - Works in Workers!\n * 2. Inline handler function (passed in config.handler)\n * 3. KV-based dynamic loading (DEPRECATED - uses new Function(), blocked in Workers)\n *\n * For Cloudflare Workers compatibility, always use bundled scripts:\n * - Create script files in scripts/ directory\n * - Reference via script:// URI in ensembles\n * - Vite plugin bundles them at build time\n */\n\nimport { BaseAgent, type AgentExecutionContext } from './base-agent.js'\nimport type { AgentConfig } from '../runtime/parser.js'\nimport { hasGlobalScriptLoader, getGlobalScriptLoader } from '../utils/script-loader.js'\n\n/**\n * Function implementation type - supports two calling conventions:\n * 1. Modern (1 param): handler(context: AgentExecutionContext)\n * 2. Legacy (2 params): handler(input: unknown, context: AgentExecutionContext)\n *\n * The CodeAgent detects which convention to use via Function.length\n */\nexport type FunctionImplementation =\n  | ((context: AgentExecutionContext) => Promise<unknown> | unknown)\n  | ((input: unknown, context: AgentExecutionContext) => Promise<unknown> | unknown)\n\ninterface CodeAgentConfig {\n  script?: string // script:// URI to load from bundled scripts\n  handler?: FunctionImplementation // Pre-compiled handler function\n  cache?: {\n    ttl?: number\n    bypass?: boolean\n  }\n}\n\n/**\n * Code Agent executes JavaScript/TypeScript from bundled scripts or handlers\n *\n * @example With script URI (RECOMMENDED for Workers):\n * ```yaml\n * agents:\n *   - name: transform\n *     operation: code\n *     config:\n *       script: \"script://transforms/csv\"\n * ```\n *\n * @example With pre-compiled handler (from agent index.ts):\n * ```typescript\n * // agents/my-agent/index.ts\n * export default async function(context) {\n *   return { result: context.input.value * 2 }\n * }\n * ```\n */\nexport class CodeAgent extends BaseAgent {\n  private codeConfig: CodeAgentConfig\n  private compiledFunction?: FunctionImplementation\n\n  constructor(config: AgentConfig) {\n    super(config)\n    this.codeConfig = (config.config || {}) as CodeAgentConfig\n\n    // Validate config\n    if (!this.codeConfig.script && !this.codeConfig.handler) {\n      throw new Error(`Code agent \"${config.name}\" requires either a script URI or inline handler`)\n    }\n\n    // If inline handler provided, use it directly\n    if (this.codeConfig.handler) {\n      this.compiledFunction = this.codeConfig.handler\n    }\n  }\n\n  /**\n   * Execute the code\n   */\n  protected async run(context: AgentExecutionContext): Promise<unknown> {\n    try {\n      // Resolve script from bundle if needed\n      if (!this.compiledFunction && this.codeConfig.script) {\n        this.compiledFunction = this.loadScript(context)\n      }\n\n      if (!this.compiledFunction) {\n        throw new Error('No code implementation available')\n      }\n\n      // Execute the function - detect calling convention by parameter count\n      // Function.length returns the number of declared parameters\n      // - length === 1: Modern style handler(context)\n      // - length >= 2: Legacy style handler(input, context)\n      let result: unknown\n      if (this.compiledFunction.length >= 2) {\n        // Legacy two-parameter style: handler(input, context)\n        result = await (this.compiledFunction as (input: unknown, ctx: AgentExecutionContext) => Promise<unknown>)(\n          context.input,\n          context\n        )\n      } else {\n        // Modern single-parameter style: handler(context)\n        result = await (this.compiledFunction as (ctx: AgentExecutionContext) => Promise<unknown>)(context)\n      }\n\n      return result\n    } catch (error) {\n      throw new Error(\n        `Code agent \"${this.name}\" execution failed: ${\n          error instanceof Error ? error.message : 'Unknown error'\n        }`\n      )\n    }\n  }\n\n  /**\n   * Load script from bundled scripts\n   *\n   * Uses the global ScriptLoader which contains pre-bundled scripts\n   * discovered at build time by vite-plugin-script-discovery.\n   *\n   * This approach works in Cloudflare Workers because it doesn't\n   * use new Function() or eval() - scripts are statically imported.\n   */\n  private loadScript(context: AgentExecutionContext): FunctionImplementation {\n    const scriptUri = this.codeConfig.script\n    if (!scriptUri) {\n      throw new Error('No script URI provided')\n    }\n\n    // Check if global script loader is available\n    if (!hasGlobalScriptLoader()) {\n      throw new Error(\n        `Cannot load script \"${scriptUri}\": Script loader not initialized.\\n\\n` +\n          `For Cloudflare Workers, scripts must be bundled at build time:\\n` +\n          `1. Create your script in scripts/${scriptUri.replace('script://', '')}.ts\\n` +\n          `2. Export a default function: export default async function(context) { ... }\\n` +\n          `3. Initialize the script loader in your worker entry point:\\n\\n` +\n          `   import { scriptsMap } from 'virtual:conductor-scripts'\\n` +\n          `   import { setGlobalScriptLoader, createScriptLoader } from '@ensemble-edge/conductor'\\n` +\n          `   setGlobalScriptLoader(createScriptLoader(scriptsMap))\\n\\n` +\n          `Note: Dynamic script loading via KV is not supported in Workers due to\\n` +\n          `security restrictions (new Function() is blocked).`\n      )\n    }\n\n    const scriptLoader = getGlobalScriptLoader()\n    context.logger?.debug('Loading script from bundle', { uri: scriptUri })\n\n    try {\n      return scriptLoader.resolve(scriptUri)\n    } catch (error) {\n      context.logger?.error('Script resolution failed', error as Error, { uri: scriptUri })\n      throw error\n    }\n  }\n\n  /**\n   * Create a CodeAgent from a config with script URI or handler\n   */\n  static fromConfig(config: AgentConfig): CodeAgent | null {\n    const codeConfig = config.config as CodeAgentConfig\n\n    // Check if has script URI or handler\n    if (codeConfig?.script || codeConfig?.handler) {\n      return new CodeAgent(config)\n    }\n\n    return null\n  }\n}\n","/**\n * AI Provider System\n *\n * Base interfaces and types for AI provider implementations.\n * Follows composition over inheritance for flexible provider management.\n */\n\nimport type { ProviderId } from '../../types/branded.js'\nimport type { ConductorEnv } from '../../types/env.js'\n\n/**\n * Message format for AI conversations\n */\nexport interface AIMessage {\n  role: 'system' | 'user' | 'assistant'\n  content: string\n}\n\n/**\n * Configuration for AI provider execution\n */\nexport interface AIProviderConfig {\n  model: string\n  temperature?: number\n  maxTokens?: number\n  apiKey?: string\n  apiEndpoint?: string\n  systemPrompt?: string\n  /** JSON Schema for structured output (reference to schema component or inline schema) */\n  schema?: string | Record<string, unknown>\n}\n\n/**\n * Request to AI provider\n */\nexport interface AIProviderRequest {\n  messages: AIMessage[]\n  config: AIProviderConfig\n  env: ConductorEnv\n}\n\n/**\n * Response from AI provider\n */\nexport interface AIProviderResponse {\n  content: string\n  model: string\n  tokensUsed?: number\n  provider: string\n  metadata?: Record<string, unknown>\n}\n\n/**\n * AI Provider interface - contract for all provider implementations\n */\nexport interface AIProvider {\n  /**\n   * Provider identifier\n   */\n  readonly id: ProviderId\n\n  /**\n   * Provider display name\n   */\n  readonly name: string\n\n  /**\n   * Execute AI request\n   */\n  execute(request: AIProviderRequest): Promise<AIProviderResponse>\n\n  /**\n   * Validate provider configuration\n   */\n  validateConfig(config: AIProviderConfig, env: ConductorEnv): boolean\n\n  /**\n   * Get error message for missing configuration\n   */\n  getConfigError(config: AIProviderConfig, env: ConductorEnv): string | null\n}\n\n/**\n * Base AI provider with common functionality\n */\nexport abstract class BaseAIProvider implements AIProvider {\n  abstract readonly id: ProviderId\n  abstract readonly name: string\n\n  abstract execute(request: AIProviderRequest): Promise<AIProviderResponse>\n\n  /**\n   * Default validation checks for API key\n   */\n  validateConfig(config: AIProviderConfig, env: ConductorEnv): boolean {\n    return this.getConfigError(config, env) === null\n  }\n\n  /**\n   * Override this to provide specific validation\n   */\n  abstract getConfigError(config: AIProviderConfig, env: ConductorEnv): string | null\n\n  /**\n   * Helper to get API key from config or env\n   */\n  protected getApiKey(\n    config: AIProviderConfig,\n    env: ConductorEnv,\n    envVarName: string\n  ): string | null {\n    // Access env as Record for dynamic key lookup\n    const envRecord = env as Record<string, unknown>\n    return config.apiKey || (envRecord[envVarName] as string | undefined) || null\n  }\n\n  /**\n   * Helper to make HTTP request\n   */\n  protected async makeRequest(\n    endpoint: string,\n    headers: Record<string, string>,\n    body: unknown\n  ): Promise<unknown> {\n    const response = await fetch(endpoint, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        ...headers,\n      },\n      body: JSON.stringify(body),\n    })\n\n    if (!response.ok) {\n      const errorText = await response.text()\n      throw new Error(`API request failed: ${response.status} ${response.statusText}\\n${errorText}`)\n    }\n\n    return await response.json()\n  }\n}\n","/**\n * OpenAI Provider\n *\n * Handles OpenAI API calls with proper error handling and validation.\n */\n\nimport { BaseAIProvider } from './base-provider.js'\nimport type { AIProviderConfig, AIProviderRequest, AIProviderResponse } from './base-provider.js'\nimport type { ProviderId } from '../../types/branded.js'\nimport type { ConductorEnv } from '../../types/env.js'\n\nexport class OpenAIProvider extends BaseAIProvider {\n  readonly id = 'openai' as ProviderId\n  readonly name = 'OpenAI'\n\n  private readonly defaultEndpoint = 'https://api.openai.com/v1/chat/completions'\n\n  async execute(request: AIProviderRequest): Promise<AIProviderResponse> {\n    const { messages, config, env } = request\n\n    const apiKey = this.getApiKey(config, env, 'OPENAI_API_KEY')\n    if (!apiKey) {\n      throw new Error('OpenAI API key not found. Set OPENAI_API_KEY in env or config')\n    }\n\n    const endpoint = config.apiEndpoint || this.defaultEndpoint\n\n    const data = (await this.makeRequest(\n      endpoint,\n      { Authorization: `Bearer ${apiKey}` },\n      {\n        model: config.model,\n        messages,\n        temperature: config.temperature,\n        max_tokens: config.maxTokens,\n      }\n    )) as {\n      choices: Array<{ message?: { content?: string }; finish_reason?: string }>\n      usage?: { total_tokens?: number; prompt_tokens?: number; completion_tokens?: number }\n    }\n\n    return {\n      content: data.choices[0]?.message?.content || '',\n      model: config.model,\n      tokensUsed: data.usage?.total_tokens,\n      provider: this.id,\n      metadata: {\n        finishReason: data.choices[0]?.finish_reason,\n        promptTokens: data.usage?.prompt_tokens,\n        completionTokens: data.usage?.completion_tokens,\n      },\n    }\n  }\n\n  getConfigError(config: AIProviderConfig, env: ConductorEnv): string | null {\n    const apiKey = this.getApiKey(config, env, 'OPENAI_API_KEY')\n    if (!apiKey) {\n      return 'OpenAI API key not found. Set OPENAI_API_KEY in env or config.apiKey'\n    }\n    return null\n  }\n}\n","/**\n * Anthropic Provider\n *\n * Handles Anthropic API calls with proper message formatting.\n */\n\nimport { BaseAIProvider } from './base-provider.js'\nimport type { AIProviderConfig, AIProviderRequest, AIProviderResponse } from './base-provider.js'\nimport type { ProviderId } from '../../types/branded.js'\nimport type { ConductorEnv } from '../../types/env.js'\n\nexport class AnthropicProvider extends BaseAIProvider {\n  readonly id = 'anthropic' as ProviderId\n  readonly name = 'Anthropic'\n\n  private readonly defaultEndpoint = 'https://api.anthropic.com/v1/messages'\n  private readonly defaultModel = 'claude-3-sonnet-20240229'\n\n  async execute(request: AIProviderRequest): Promise<AIProviderResponse> {\n    const { messages, config, env } = request\n\n    const apiKey = this.getApiKey(config, env, 'ANTHROPIC_API_KEY')\n    if (!apiKey) {\n      throw new Error('Anthropic API key not found. Set ANTHROPIC_API_KEY in env or config')\n    }\n\n    const endpoint = config.apiEndpoint || this.defaultEndpoint\n\n    // Anthropic format: system is separate, only user/assistant in messages\n    const anthropicMessages = messages.filter((m) => m.role !== 'system')\n    const systemMessage = messages.find((m) => m.role === 'system')?.content || config.systemPrompt\n\n    // Build request body\n    const requestBody: Record<string, unknown> = {\n      model: config.model || this.defaultModel,\n      messages: anthropicMessages,\n      system: systemMessage,\n      temperature: config.temperature,\n      max_tokens: config.maxTokens,\n    }\n\n    // Add schema for structured outputs if configured\n    if (config.schema) {\n      const schema = typeof config.schema === 'string' ? JSON.parse(config.schema) : config.schema\n\n      // Use Anthropic's native JSON schema support\n      requestBody.response_format = {\n        type: 'json_schema',\n        json_schema: schema,\n      }\n    }\n\n    const data = (await this.makeRequest(\n      endpoint,\n      {\n        'x-api-key': apiKey,\n        'anthropic-version': '2023-06-01',\n      },\n      requestBody\n    )) as {\n      content: Array<{ text?: string }>\n      usage?: { input_tokens?: number; output_tokens?: number }\n      stop_reason?: string\n    }\n\n    return {\n      content: data.content[0]?.text || '',\n      model: config.model || this.defaultModel,\n      tokensUsed: (data.usage?.input_tokens || 0) + (data.usage?.output_tokens || 0),\n      provider: this.id,\n      metadata: {\n        stopReason: data.stop_reason,\n        inputTokens: data.usage?.input_tokens,\n        outputTokens: data.usage?.output_tokens,\n        schema: config.schema\n          ? typeof config.schema === 'string'\n            ? config.schema\n            : JSON.stringify(config.schema)\n          : undefined,\n      },\n    }\n  }\n\n  getConfigError(config: AIProviderConfig, env: ConductorEnv): string | null {\n    const apiKey = this.getApiKey(config, env, 'ANTHROPIC_API_KEY')\n    if (!apiKey) {\n      return 'Anthropic API key not found. Set ANTHROPIC_API_KEY in env or config.apiKey'\n    }\n    return null\n  }\n}\n","/**\n * Cloudflare Provider\n *\n * Handles Cloudflare Workers AI binding calls.\n */\n\nimport { BaseAIProvider } from './base-provider.js'\nimport type { AIProviderConfig, AIProviderRequest, AIProviderResponse } from './base-provider.js'\nimport type { ProviderId } from '../../types/branded.js'\nimport type { ConductorEnv } from '../../types/env.js'\n\n/** Cloudflare AI response structure */\ninterface CloudflareAIResponse {\n  response?: string\n  result?: { response?: string }\n  tokens_used?: number\n}\n\nexport class CloudflareProvider extends BaseAIProvider {\n  readonly id = 'workers-ai' as ProviderId\n  readonly name = 'Cloudflare Workers AI'\n\n  private readonly defaultModel = '@cf/meta/llama-2-7b-chat-int8'\n\n  async execute(request: AIProviderRequest): Promise<AIProviderResponse> {\n    const { messages, config, env } = request\n\n    if (!env.AI) {\n      throw new Error(\n        'Cloudflare AI binding not available. Add [ai] binding = \"AI\" to wrangler.toml'\n      )\n    }\n\n    const model = config.model || this.defaultModel\n\n    // Call Cloudflare AI binding\n    // AI.run uses model string and options, returns CloudflareAIResponse\n    const response = (await env.AI.run(model, {\n      messages,\n      temperature: config.temperature,\n      max_tokens: config.maxTokens,\n    })) as CloudflareAIResponse\n\n    return {\n      content: response.response || response.result?.response || String(response),\n      model,\n      tokensUsed: response.tokens_used,\n      provider: this.id,\n      metadata: {\n        raw: response,\n      },\n    }\n  }\n\n  getConfigError(_config: AIProviderConfig, env: ConductorEnv): string | null {\n    if (!env.AI) {\n      return 'Cloudflare AI binding not found. Add [ai] binding = \"AI\" to wrangler.toml'\n    }\n    return null\n  }\n}\n","/**\n * Custom Provider\n *\n * Handles custom API endpoints with OpenAI-compatible format.\n */\n\nimport { BaseAIProvider } from './base-provider.js'\nimport type { AIProviderConfig, AIProviderRequest, AIProviderResponse } from './base-provider.js'\nimport type { ProviderId } from '../../types/branded.js'\nimport type { ConductorEnv } from '../../types/env.js'\n\nexport class CustomProvider extends BaseAIProvider {\n  readonly id = 'custom' as ProviderId\n  readonly name = 'Custom API'\n\n  async execute(request: AIProviderRequest): Promise<AIProviderResponse> {\n    const { messages, config, env } = request\n\n    if (!config.apiEndpoint) {\n      throw new Error('Custom provider requires apiEndpoint in config')\n    }\n\n    const apiKey = this.getApiKey(config, env, 'AI_API_KEY')\n    const headers: Record<string, string> = {}\n\n    if (apiKey) {\n      headers['Authorization'] = `Bearer ${apiKey}`\n    }\n\n    const data = (await this.makeRequest(config.apiEndpoint, headers, {\n      model: config.model,\n      messages,\n      temperature: config.temperature,\n      max_tokens: config.maxTokens,\n    })) as {\n      choices?: Array<{ message?: { content?: string } }>\n      response?: string\n      content?: string\n      usage?: { total_tokens?: number }\n      [key: string]: unknown\n    }\n\n    // Try multiple response formats\n    const content = data.choices?.[0]?.message?.content || data.response || data.content || ''\n\n    return {\n      content,\n      model: config.model,\n      tokensUsed: data.usage?.total_tokens,\n      provider: this.id,\n      metadata: data as Record<string, unknown>,\n    }\n  }\n\n  getConfigError(config: AIProviderConfig, _env: ConductorEnv): string | null {\n    if (!config.apiEndpoint) {\n      return 'Custom provider requires apiEndpoint in config'\n    }\n    return null\n  }\n}\n","/**\n * Provider Registry\n *\n * Manages AI provider instances with singleton pattern.\n * Makes it trivial to add new providers without modifying existing code.\n */\n\nimport type { AIProvider } from './base-provider.js'\nimport type { ProviderId } from '../../types/branded.js'\nimport { OpenAIProvider } from './openai-provider.js'\nimport { AnthropicProvider } from './anthropic-provider.js'\nimport { CloudflareProvider } from './cloudflare-provider.js'\nimport { CustomProvider } from './custom-provider.js'\n\n/**\n * Provider Registry - manages all AI providers\n */\nexport class ProviderRegistry {\n  private providers = new Map<string, AIProvider>()\n\n  constructor() {\n    this.registerDefaultProviders()\n  }\n\n  /**\n   * Register default providers\n   */\n  private registerDefaultProviders(): void {\n    this.register(new OpenAIProvider())\n    this.register(new AnthropicProvider())\n    this.register(new CloudflareProvider())\n    this.register(new CustomProvider())\n  }\n\n  /**\n   * Register a provider\n   */\n  register(provider: AIProvider): void {\n    this.providers.set(provider.id, provider)\n  }\n\n  /**\n   * Get provider by ID\n   */\n  get(providerId: string): AIProvider | null {\n    return this.providers.get(providerId) || null\n  }\n\n  /**\n   * Check if provider exists\n   */\n  has(providerId: string): boolean {\n    return this.providers.has(providerId)\n  }\n\n  /**\n   * Get all registered provider IDs\n   */\n  getProviderIds(): string[] {\n    return Array.from(this.providers.keys())\n  }\n\n  /**\n   * Get all registered providers\n   */\n  getAllProviders(): AIProvider[] {\n    return Array.from(this.providers.values())\n  }\n}\n\n/**\n * Singleton instance for global use\n */\nlet globalRegistry: ProviderRegistry | null = null\n\n/**\n * Get global provider registry\n */\nexport function getProviderRegistry(): ProviderRegistry {\n  if (!globalRegistry) {\n    globalRegistry = new ProviderRegistry()\n  }\n  return globalRegistry\n}\n\n/**\n * Reset global registry (useful for testing)\n */\nexport function resetProviderRegistry(): void {\n  globalRegistry = null\n}\n","/**\n * Component Resolution Utility\n *\n * Implements Alternative 1: Smart String Parsing\n *\n * Resolves values to their actual content:\n * - Inline values (strings, objects, arrays)\n * - Component references (type/name@version) - via KV in Workers\n *\n * Note: File system access is NOT available in Cloudflare Workers.\n * Use component references with KV storage (EDGIT or COMPONENTS namespace) instead.\n * File path references (./path/to/file) will throw an error in Workers runtime.\n *\n * @module component-resolver\n */\n\nimport { createLogger } from '../observability/index.js'\n\nconst logger = createLogger({ serviceName: 'component-resolver' })\n\n/**\n * Context for component resolution\n */\nexport interface ComponentResolutionContext {\n  /** Cloudflare environment bindings */\n  env?: {\n    /** Edgit KV store for component versioning */\n    EDGIT?: KVNamespace\n    /** Components KV store for scripts/templates */\n    COMPONENTS?: KVNamespace\n    [key: string]: any\n  }\n  /** Base directory for relative file paths (not used in Workers) */\n  baseDir?: string\n}\n\n/**\n * Result of component resolution\n */\nexport interface ResolvedComponent {\n  /** The resolved content */\n  content: any\n  /** How it was resolved */\n  source: 'inline' | 'file' | 'component'\n  /** Original reference (for debugging) */\n  originalRef: any\n  /** Component metadata (if from Edgit) */\n  metadata?: {\n    path: string\n    version: string\n    fromEdgit: boolean\n  }\n}\n\n/**\n * Checks if a string matches the component reference pattern\n *\n * Component references follow: path/to/component@version\n *\n * @param value - String to check\n * @returns True if it's a component reference\n *\n * @example\n * isComponentReference(\"prompts/extraction@v1.0.0\") // true\n * isComponentReference(\"hello@example.com\") // false (no path)\n * isComponentReference(\"user@server\") // false (no path)\n */\nfunction isComponentReference(value: string): boolean {\n  // Component pattern: word/word@version or word/word/word@version\n  // Must have at least one / before the @\n  const componentPattern = /^[a-z0-9-_]+\\/[a-z0-9-_/]+@[a-z0-9.-]+$/i\n  return componentPattern.test(value)\n}\n\n/**\n * Checks if a string is an unversioned component path\n *\n * @param value - String to check\n * @returns True if it's a component path without version\n *\n * @example\n * isUnversionedComponent(\"prompts/extraction\") // true\n * isUnversionedComponent(\"prompts/extraction@v1.0.0\") // false (has version)\n */\nfunction isUnversionedComponent(value: string): boolean {\n  // Must have path structure but no @\n  const pathPattern = /^[a-z0-9-_]+\\/[a-z0-9-_/]+$/i\n  return pathPattern.test(value) && !value.includes('@')\n}\n\n/**\n * Checks if a string looks like a file path\n *\n * @param value - String to check\n * @returns True if it looks like a file path\n */\nfunction isFilePath(value: string): boolean {\n  return /^\\.{0,2}\\//.test(value)\n}\n\n/**\n * Simple path utilities that work in both Node.js and Workers\n */\nconst pathUtils = {\n  /**\n   * Check if a path is absolute (starts with /)\n   */\n  isAbsolute(filePath: string): boolean {\n    return filePath.startsWith('/')\n  },\n\n  /**\n   * Join path segments\n   */\n  join(...segments: string[]): string {\n    return segments.join('/').replace(/\\/+/g, '/').replace(/\\/$/, '')\n  },\n\n  /**\n   * Get the basename of a path\n   */\n  basename(filePath: string): string {\n    const parts = filePath.split('/')\n    return parts[parts.length - 1] || ''\n  },\n\n  /**\n   * Normalize a path (resolve . and ..)\n   */\n  normalize(filePath: string): string {\n    const parts = filePath.split('/')\n    const result: string[] = []\n\n    for (const part of parts) {\n      if (part === '..') {\n        result.pop()\n      } else if (part !== '.' && part !== '') {\n        result.push(part)\n      }\n    }\n\n    const normalized = result.join('/')\n    return filePath.startsWith('/') ? '/' + normalized : normalized\n  },\n}\n\n/**\n * Loads content from KV storage (Workers-compatible file loading)\n *\n * In Cloudflare Workers, we can't use the filesystem directly.\n * Instead, files should be stored in KV and loaded from there.\n *\n * @param filePath - Path to file (used as KV key)\n * @param context - Resolution context with KV bindings\n * @returns File content as string\n */\nasync function loadFromKV(filePath: string, context: ComponentResolutionContext): Promise<string> {\n  // Normalize the path for KV lookup\n  const normalizedPath = pathUtils.normalize(filePath).replace(/^\\.\\//, '')\n\n  // Try COMPONENTS KV first, then EDGIT\n  const kv = context.env?.COMPONENTS || context.env?.EDGIT\n\n  if (!kv) {\n    throw new Error(\n      `Cannot load file \"${filePath}\" in Workers runtime without KV storage.\\n` +\n        `Configure COMPONENTS or EDGIT KV namespace, or use inline content instead.`\n    )\n  }\n\n  try {\n    const content = await kv.get(`files/${normalizedPath}`)\n    if (content) {\n      return content\n    }\n\n    // Try without prefix\n    const contentAlt = await kv.get(normalizedPath)\n    if (contentAlt) {\n      return contentAlt\n    }\n\n    throw new Error(`File not found in KV: ${normalizedPath}`)\n  } catch (error) {\n    throw new Error(\n      `Failed to load file from KV: ${filePath}\\n` +\n        `Looked for keys: files/${normalizedPath}, ${normalizedPath}\\n` +\n        `Error: ${error instanceof Error ? error.message : String(error)}`\n    )\n  }\n}\n\n/**\n * Resolves a component reference from Edgit KV\n *\n * @param ref - Component reference (e.g., \"prompts/extraction@v1.0.0\")\n * @param context - Resolution context\n * @returns Resolved component content\n */\nasync function resolveComponentRef(ref: string, context: ComponentResolutionContext): Promise<any> {\n  const [pathPart, version] = ref.split('@')\n\n  // Try Edgit KV (if available)\n  if (context.env?.EDGIT) {\n    const edgitPath = `components/${pathPart}/${version}`\n\n    try {\n      const content = await context.env.EDGIT.get(edgitPath)\n      if (content) {\n        // Parse if it's YAML/JSON, otherwise return as string\n        try {\n          return JSON.parse(content)\n        } catch {\n          return content\n        }\n      }\n    } catch (error) {\n      logger.warn(`Failed to fetch from Edgit: ${edgitPath}`, { error: String(error) })\n      // Fall through to COMPONENTS KV\n    }\n  }\n\n  // Try COMPONENTS KV as fallback\n  if (context.env?.COMPONENTS) {\n    const componentPath = `${pathPart}/${version}`\n\n    try {\n      const content = await context.env.COMPONENTS.get(componentPath)\n      if (content) {\n        try {\n          return JSON.parse(content)\n        } catch {\n          return content\n        }\n      }\n    } catch (error) {\n      logger.warn(`Failed to fetch from COMPONENTS: ${componentPath}`, { error: String(error) })\n    }\n  }\n\n  throw new Error(\n    `Component not found: ${ref}\\n` +\n      `Tried EDGIT: components/${pathPart}/${version}\\n` +\n      `Tried COMPONENTS: ${pathPart}/${version}\\n` +\n      `Make sure the component is stored in KV storage.`\n  )\n}\n\n/**\n * Resolves any value to its actual content\n *\n * This is the main entry point for Alternative 1: Smart String Parsing\n *\n * Resolution logic:\n * 1. Non-string  inline value\n * 2. Multi-line string  inline content\n * 3. Starts with ./ or /  file reference (loads from KV in Workers)\n * 4. Matches path/name@version  component reference\n * 5. Matches path/name  unversioned component (adds @latest)\n * 6. Everything else  inline string\n *\n * @param value - Value to resolve\n * @param context - Resolution context\n * @returns Resolved component with metadata\n *\n * @example\n * // Inline value\n * await resolveValue({ foo: \"bar\" }, ctx)\n * //  { content: { foo: \"bar\" }, source: \"inline\", ... }\n *\n * // File path (loaded from KV in Workers)\n * await resolveValue(\"./prompts/my-prompt.md\", ctx)\n * //  { content: \"<file content from KV>\", source: \"file\", ... }\n *\n * // Component reference\n * await resolveValue(\"prompts/extraction@v1.0.0\", ctx)\n * //  { content: \"<component content>\", source: \"component\", ... }\n *\n * // Inline string (email)\n * await resolveValue(\"hello@example.com\", ctx)\n * //  { content: \"hello@example.com\", source: \"inline\", ... }\n */\nexport async function resolveValue(\n  value: any,\n  context: ComponentResolutionContext\n): Promise<ResolvedComponent> {\n  // CASE 1: Non-string (object, array, number, boolean, null)\n  //  Use as-is (inline value)\n  if (typeof value !== 'string') {\n    return {\n      content: value,\n      source: 'inline',\n      originalRef: value,\n    }\n  }\n\n  // CASE 2: Multi-line string\n  //  Inline content (prompt text, markdown, etc.)\n  if (value.includes('\\n')) {\n    return {\n      content: value,\n      source: 'inline',\n      originalRef: value,\n    }\n  }\n\n  // CASE 3: File path (starts with ./ or ../ or /)\n  //  Load from KV storage (Workers don't have filesystem access)\n  if (isFilePath(value)) {\n    const content = await loadFromKV(value, context)\n    return {\n      content,\n      source: 'file',\n      originalRef: value,\n    }\n  }\n\n  // CASE 4: Component reference (path/name@version)\n  //  Resolve from Edgit or COMPONENTS KV\n  if (isComponentReference(value)) {\n    const content = await resolveComponentRef(value, context)\n    const [pathPart, version] = value.split('@')\n    return {\n      content,\n      source: 'component',\n      originalRef: value,\n      metadata: {\n        path: pathPart,\n        version,\n        fromEdgit: !!context.env?.EDGIT,\n      },\n    }\n  }\n\n  // CASE 5: Unversioned component (path/name without @)\n  //  Resolve with @latest\n  if (isUnversionedComponent(value)) {\n    const versionedRef = `${value}@latest`\n    const content = await resolveComponentRef(versionedRef, context)\n    return {\n      content,\n      source: 'component',\n      originalRef: value,\n      metadata: {\n        path: value,\n        version: 'latest',\n        fromEdgit: !!context.env?.EDGIT,\n      },\n    }\n  }\n\n  // CASE 6: Everything else\n  //  Inline string value\n  return {\n    content: value,\n    source: 'inline',\n    originalRef: value,\n  }\n}\n\n/**\n * Helper to check if a value needs resolution\n * (i.e., it's a file path or component reference)\n *\n * @param value - Value to check\n * @returns True if value needs async resolution\n */\nexport function needsResolution(value: any): boolean {\n  if (typeof value !== 'string') {\n    return false\n  }\n\n  // File path\n  if (isFilePath(value)) {\n    return true\n  }\n\n  // Component reference\n  if (isComponentReference(value) || isUnversionedComponent(value)) {\n    return true\n  }\n\n  return false\n}\n\n// Export path utilities for testing\nexport { pathUtils }\n","/**\n * Base Template Engine\n *\n * Abstract base class for all template rendering engines.\n */\n\nimport type { TemplateContext } from '../types.js'\n\nexport abstract class BaseTemplateEngine {\n  abstract name: string\n\n  /**\n   * Render a template with the given context\n   */\n  abstract render(template: string, context: TemplateContext): Promise<string>\n\n  /**\n   * Validate template syntax\n   */\n  abstract validate(template: string): Promise<{ valid: boolean; errors?: string[] }>\n\n  /**\n   * Compile a template for repeated use (optional optimization)\n   */\n  async compile(template: string): Promise<unknown> {\n    // Default: no compilation\n    return template\n  }\n\n  /**\n   * Register a helper function\n   */\n  registerHelper(name: string, fn: (...args: unknown[]) => unknown): void {\n    // Default: no-op (engines can override)\n  }\n\n  /**\n   * Register a partial template\n   */\n  registerPartial(name: string, template: string): void {\n    // Default: no-op (engines can override)\n  }\n}\n","/**\n * Simple Template Engine\n *\n * Lightweight template engine with {{variable}} syntax.\n * No external dependencies, perfect for basic interpolation.\n *\n * Supports:\n * - Variables: {{name}}\n * - Nested paths: {{user.name}}\n * - Conditionals: {{#if condition}}...{{/if}}\n * - Loops: {{#each items}}...{{/each}}\n * - Partials: {{> componentName}} or {{> uri://path@version}}\n * - Helpers: {{uppercase name}}\n */\n\nimport { BaseTemplateEngine } from './base.js'\nimport type { TemplateContext } from '../types.js'\nimport type { ComponentLoader } from '../../../runtime/component-loader.js'\n\nexport class SimpleTemplateEngine extends BaseTemplateEngine {\n  name = 'simple'\n  private componentLoader?: ComponentLoader\n  private partials: Map<string, string> = new Map()\n\n  /**\n   * Set the component loader for partial support\n   */\n  setComponentLoader(loader: ComponentLoader): void {\n    this.componentLoader = loader\n  }\n\n  /**\n   * Register a partial template\n   */\n  registerPartial(name: string, content: string): void {\n    this.partials.set(name, content)\n  }\n\n  /**\n   * Render template with simple {{variable}} replacement\n   */\n  async render(template: string, context: TemplateContext): Promise<string> {\n    let result = template\n\n    // Handle both structured context {data: {...}} and flat context {...}\n    // Type guard for structured context detection\n    const hasDataProperty = 'data' in context && context.data !== undefined\n    const data = hasDataProperty ? (context.data as TemplateContext) : context\n    const helpers =\n      'helpers' in context\n        ? (context.helpers as Record<string, (...args: unknown[]) => unknown> | undefined)\n        : undefined\n\n    // Process conditionals FIRST (recursively processes content)\n    result = await this.processConditionalsRecursive(result, data, context)\n\n    // Process loops SECOND (recursively processes content)\n    result = await this.processLoopsRecursive(result, data, context)\n\n    // Process partials THIRD (partials may contain variables)\n    result = await this.processPartials(result, { ...context, data })\n\n    // Replace {{variable}} with context data FOURTH\n    result = result.replace(/\\{\\{(\\s*[\\w.]+\\s*)\\}\\}/g, (match, key) => {\n      const trimmedKey = key.trim()\n      const value = this.resolveValue(data, trimmedKey)\n\n      if (value === undefined) {\n        return '' // undefined -> empty string\n      }\n\n      if (value === null) {\n        return 'null' // null -> string \"null\"\n      }\n\n      return String(value)\n    })\n\n    // Call helpers if available\n    if (helpers) {\n      result = this.processHelpers(result, helpers)\n    }\n\n    return result\n  }\n\n  /**\n   * Validate template syntax\n   */\n  async validate(template: string): Promise<{ valid: boolean; errors?: string[] }> {\n    const errors: string[] = []\n\n    // Check for balanced braces\n    const openBraces = (template.match(/\\{\\{/g) || []).length\n    const closeBraces = (template.match(/\\}\\}/g) || []).length\n\n    if (openBraces !== closeBraces) {\n      errors.push(`Unbalanced braces: ${openBraces} opening {{ but ${closeBraces} closing }}`)\n    }\n\n    // Check for balanced conditionals\n    const ifBlocks = (template.match(/\\{\\{#if\\s+\\w+\\}\\}/g) || []).length\n    const endifBlocks = (template.match(/\\{\\{\\/if\\}\\}/g) || []).length\n\n    if (ifBlocks !== endifBlocks) {\n      errors.push(`Unbalanced conditionals: ${ifBlocks} {{#if}} but ${endifBlocks} {{/if}}`)\n    }\n\n    // Check for balanced loops\n    const eachBlocks = (template.match(/\\{\\{#each\\s+\\w+\\}\\}/g) || []).length\n    const endEachBlocks = (template.match(/\\{\\{\\/each\\}\\}/g) || []).length\n\n    if (eachBlocks !== endEachBlocks) {\n      errors.push(`Unbalanced loops: ${eachBlocks} {{#each}} but ${endEachBlocks} {{/each}}`)\n    }\n\n    return {\n      valid: errors.length === 0,\n      errors: errors.length > 0 ? errors : undefined,\n    }\n  }\n\n  /**\n   * Resolve nested object path (e.g., \"user.name\" -> context.user.name)\n   */\n  private resolveValue(data: Record<string, unknown>, path: string): unknown {\n    const keys = path.split('.')\n    let value: unknown = data\n\n    for (const key of keys) {\n      if (value && typeof value === 'object' && key in value) {\n        value = (value as Record<string, unknown>)[key]\n      } else {\n        return undefined\n      }\n    }\n\n    return value\n  }\n\n  /**\n   * Process {{#if condition}}...{{else}}...{{/if}} blocks recursively\n   * This allows conditionals to contain partials and other templates\n   */\n  private async processConditionalsRecursive(\n    template: string,\n    data: Record<string, unknown>,\n    context: TemplateContext\n  ): Promise<string> {\n    // Use a manual loop to process all conditionals\n    const conditionalRegex = /\\{\\{#if\\s+(\\w+)\\}\\}([\\s\\S]*?)\\{\\{\\/if\\}\\}/\n    let result = template\n    let match\n\n    while ((match = conditionalRegex.exec(result)) !== null) {\n      const [fullMatch, key, content] = match\n      const value = this.resolveValue(data, key)\n\n      // Check if there's an {{else}} block\n      const elseMatch = content.match(/^([\\s\\S]*?)\\{\\{else\\}\\}([\\s\\S]*)$/)\n\n      let selectedContent: string\n      if (elseMatch) {\n        const [, ifContent, elseContent] = elseMatch\n        selectedContent = value ? ifContent : elseContent\n      } else {\n        selectedContent = value ? content : ''\n      }\n\n      // Recursively render the selected content with same context\n      const rendered = await this.render(selectedContent, { ...context, data })\n      result = result.replace(fullMatch, rendered)\n    }\n\n    return result\n  }\n\n  /**\n   * Process {{#each array}}...{{/each}} blocks recursively\n   * This allows loops to contain partials with access to loop item data\n   */\n  private async processLoopsRecursive(\n    template: string,\n    data: Record<string, unknown>,\n    context: TemplateContext\n  ): Promise<string> {\n    // Use a manual loop to process all loops\n    const loopRegex = /\\{\\{#each\\s+(\\w+)\\}\\}([\\s\\S]*?)\\{\\{\\/each\\}\\}/\n    let result = template\n    let match\n\n    while ((match = loopRegex.exec(result)) !== null) {\n      const [fullMatch, key, content] = match\n      const array = this.resolveValue(data, key)\n\n      if (!Array.isArray(array)) {\n        result = result.replace(fullMatch, '')\n        continue\n      }\n\n      // Render each item with its own context\n      const renderedItems = await Promise.all(\n        array.map(async (item, index) => {\n          // Build item context\n          const itemData =\n            typeof item === 'object' && item !== null\n              ? {\n                  ...data,\n                  ...item,\n                  '@index': index,\n                  '@first': index === 0,\n                  '@last': index === array.length - 1,\n                }\n              : {\n                  ...data,\n                  this: item,\n                  '@index': index,\n                  '@first': index === 0,\n                  '@last': index === array.length - 1,\n                }\n\n          // Recursively render content with item context\n          return await this.render(content, { ...context, data: itemData })\n        })\n      )\n\n      result = result.replace(fullMatch, renderedItems.join(''))\n    }\n\n    return result\n  }\n\n  /**\n   * Process {{#if condition}}...{{else}}...{{/if}} blocks (non-recursive, legacy)\n   * @deprecated Use processConditionalsRecursive instead\n   */\n  private processConditionals(template: string, data: Record<string, unknown>): string {\n    return template.replace(/\\{\\{#if\\s+(\\w+)\\}\\}([\\s\\S]*?)\\{\\{\\/if\\}\\}/g, (match, key, content) => {\n      const value = this.resolveValue(data, key)\n\n      // Check if there's an {{else}} block\n      const elseMatch = content.match(/^([\\s\\S]*?)\\{\\{else\\}\\}([\\s\\S]*)$/)\n\n      if (elseMatch) {\n        const [, ifContent, elseContent] = elseMatch\n        return value ? ifContent : elseContent\n      }\n\n      return value ? content : ''\n    })\n  }\n\n  /**\n   * Process {{#each array}}...{{/each}} blocks\n   */\n  private processLoops(template: string, data: Record<string, unknown>): string {\n    return template.replace(\n      /\\{\\{#each\\s+(\\w+)\\}\\}([\\s\\S]*?)\\{\\{\\/each\\}\\}/g,\n      (match, key, content) => {\n        const array = this.resolveValue(data, key)\n\n        if (!Array.isArray(array)) {\n          return ''\n        }\n\n        return array\n          .map((item, index) => {\n            let itemContent = content\n\n            // Replace {{this}} with item value\n            itemContent = itemContent.replace(/\\{\\{this\\}\\}/g, String(item))\n\n            // Replace {{@index}} with index\n            itemContent = itemContent.replace(/\\{\\{@index\\}\\}/g, String(index))\n\n            // Replace {{@first}} with boolean\n            itemContent = itemContent.replace(/\\{\\{@first\\}\\}/g, String(index === 0))\n\n            // Replace {{@last}} with boolean\n            itemContent = itemContent.replace(/\\{\\{@last\\}\\}/g, String(index === array.length - 1))\n\n            // If item is an object, replace {{key}} with item[key]\n            if (typeof item === 'object' && item !== null) {\n              itemContent = itemContent.replace(/\\{\\{(\\w+)\\}\\}/g, (m: string, k: string) => {\n                const val = (item as Record<string, unknown>)[k]\n                return val !== undefined ? String(val) : m\n              })\n            }\n\n            return itemContent\n          })\n          .join('')\n      }\n    )\n  }\n\n  /**\n   * Process {{> partialName}} or {{> uri://path@version}} includes\n   */\n  private async processPartials(template: string, context: TemplateContext): Promise<string> {\n    // Match {{> partialName}} or {{> uri://path@version}}\n    const partialRegex = /\\{\\{>\\s*([^}\\s]+)(?:\\s+([^}]+))?\\s*\\}\\}/g\n    const matches = Array.from(template.matchAll(partialRegex))\n\n    if (matches.length === 0) {\n      return template\n    }\n\n    let result = template\n\n    // Process each partial\n    for (const match of matches) {\n      const [fullMatch, partialRef, argsStr] = match\n\n      // Parse arguments if provided (e.g., {{> header title=\"My Site\"}})\n      // Type guard: context.data is Record<string, unknown> when passed from render()\n      const contextData =\n        'data' in context && typeof context.data === 'object' && context.data !== null\n          ? (context.data as Record<string, unknown>)\n          : {}\n      const partialData = argsStr ? this.parsePartialArgs(argsStr, contextData) : contextData\n\n      try {\n        let partialContent: string\n\n        // Check if it's a URI (contains ://)\n        if (partialRef.includes('://')) {\n          // Load from ComponentLoader\n          if (!this.componentLoader) {\n            throw new Error(\n              `Component loader not configured. ` + `Cannot load component: ${partialRef}`\n            )\n          }\n\n          partialContent = await this.componentLoader.load(partialRef)\n        } else {\n          // Look up registered partial\n          partialContent = this.partials.get(partialRef) || ''\n\n          if (!partialContent) {\n            throw new Error(`Partial not found: ${partialRef}`)\n          }\n        }\n\n        // Recursively render the partial with its data\n        const rendered = await this.render(partialContent, {\n          ...context,\n          data: partialData,\n        })\n\n        result = result.replace(fullMatch, rendered)\n      } catch (error) {\n        // Include error in output for debugging\n        const errorMsg = error instanceof Error ? error.message : String(error)\n        result = result.replace(fullMatch, `<!-- Partial error: ${errorMsg} -->`)\n      }\n    }\n\n    return result\n  }\n\n  /**\n   * Parse partial arguments\n   * Example: title=\"My Site\" count=5 -> { title: \"My Site\", count: 5 }\n   */\n  private parsePartialArgs(\n    argsStr: string,\n    contextData: Record<string, unknown>\n  ): Record<string, unknown> {\n    const args: Record<string, unknown> = { ...contextData }\n\n    // Match key=value or key=\"value\"\n    const argRegex = /(\\w+)=(?:\"([^\"]*)\"|'([^']*)'|(\\S+))/g\n    let match\n\n    while ((match = argRegex.exec(argsStr)) !== null) {\n      const [, key, quotedVal1, quotedVal2, unquotedVal] = match\n      const value = quotedVal1 || quotedVal2 || unquotedVal\n\n      // Try to resolve from context if it looks like a variable\n      if (value && !value.startsWith('\"') && !value.startsWith(\"'\")) {\n        const contextValue = this.resolveValue(contextData, value)\n        args[key] = contextValue !== undefined ? contextValue : value\n      } else {\n        args[key] = value\n      }\n    }\n\n    return args\n  }\n\n  /**\n   * Process helper functions {{helper arg1 arg2}}\n   */\n  private processHelpers(\n    template: string,\n    helpers: Record<string, (...args: unknown[]) => unknown>\n  ): string {\n    return template.replace(/\\{\\{(\\w+)\\s+([^}]+)\\}\\}/g, (match, helperName, args) => {\n      const helper = helpers[helperName]\n\n      if (!helper) {\n        return match // Keep original if helper not found\n      }\n\n      // Parse arguments (simple space-separated)\n      const parsedArgs = args.split(/\\s+/)\n\n      try {\n        const result = helper(...parsedArgs)\n        return String(result)\n      } catch {\n        return match // Keep original on error\n      }\n    })\n  }\n}\n","/*\n * liquidjs@10.24.0, https://github.com/harttle/liquidjs\n * (c) 2016-2025 harttle\n * Released under the MIT License.\n */\nclass Token {\r\n    constructor(kind, input, begin, end, file) {\r\n        this.kind = kind;\r\n        this.input = input;\r\n        this.begin = begin;\r\n        this.end = end;\r\n        this.file = file;\r\n    }\r\n    getText() {\r\n        return this.input.slice(this.begin, this.end);\r\n    }\r\n    getPosition() {\r\n        let [row, col] = [1, 1];\r\n        for (let i = 0; i < this.begin; i++) {\r\n            if (this.input[i] === '\\n') {\r\n                row++;\r\n                col = 1;\r\n            }\r\n            else\r\n                col++;\r\n        }\r\n        return [row, col];\r\n    }\r\n    size() {\r\n        return this.end - this.begin;\r\n    }\r\n}\n\nclass Drop {\r\n    liquidMethodMissing(key, context) {\r\n        return undefined;\r\n    }\r\n}\n\nconst toString$1 = Object.prototype.toString;\r\nconst toLowerCase = String.prototype.toLowerCase;\r\nconst hasOwnProperty = Object.hasOwnProperty;\r\nfunction isString(value) {\r\n    return typeof value === 'string';\r\n}\r\n// eslint-disable-next-line @typescript-eslint/ban-types\r\nfunction isFunction(value) {\r\n    return typeof value === 'function';\r\n}\r\nfunction isPromise(val) {\r\n    return val && isFunction(val.then);\r\n}\r\nfunction isIterator(val) {\r\n    return val && isFunction(val.next) && isFunction(val.throw) && isFunction(val.return);\r\n}\r\nfunction escapeRegex(str) {\r\n    return str.replace(/[-/\\\\^$*+?.()|[\\]{}]/g, '\\\\$&');\r\n}\r\nfunction stringify(value) {\r\n    value = toValue(value);\r\n    if (isString(value))\r\n        return value;\r\n    if (isNil(value))\r\n        return '';\r\n    if (isArray(value))\r\n        return value.map(x => stringify(x)).join('');\r\n    return String(value);\r\n}\r\nfunction toEnumerable(val) {\r\n    val = toValue(val);\r\n    if (isArray(val))\r\n        return val;\r\n    if (isString(val) && val.length > 0)\r\n        return [val];\r\n    if (isIterable(val))\r\n        return Array.from(val);\r\n    if (isObject(val))\r\n        return Object.keys(val).map((key) => [key, val[key]]);\r\n    return [];\r\n}\r\nfunction toArray(val) {\r\n    val = toValue(val);\r\n    if (isNil(val))\r\n        return [];\r\n    if (isArray(val))\r\n        return val;\r\n    return [val];\r\n}\r\nfunction toValue(value) {\r\n    return (value instanceof Drop && isFunction(value.valueOf)) ? value.valueOf() : value;\r\n}\r\nfunction toNumber(value) {\r\n    return +toValue(value) || 0;\r\n}\r\nfunction isNumber(value) {\r\n    return typeof value === 'number';\r\n}\r\nfunction toLiquid(value) {\r\n    if (value && isFunction(value.toLiquid))\r\n        return toLiquid(value.toLiquid());\r\n    return value;\r\n}\r\nfunction isNil(value) {\r\n    return value == null;\r\n}\r\nfunction isUndefined(value) {\r\n    return value === undefined;\r\n}\r\nfunction isArray(value) {\r\n    // be compatible with IE 8\r\n    return toString$1.call(value) === '[object Array]';\r\n}\r\nfunction isArrayLike(value) {\r\n    return value && isNumber(value.length);\r\n}\r\nfunction isIterable(value) {\r\n    return isObject(value) && Symbol.iterator in value;\r\n}\r\n/*\r\n * Iterates over own enumerable string keyed properties of an object and invokes iteratee for each property.\r\n * The iteratee is invoked with three arguments: (value, key, object).\r\n * Iteratee functions may exit iteration early by explicitly returning false.\r\n * @param {Object} object The object to iterate over.\r\n * @param {Function} iteratee The function invoked per iteration.\r\n * @return {Object} Returns object.\r\n */\r\nfunction forOwn(obj, iteratee) {\r\n    obj = obj || {};\r\n    for (const k in obj) {\r\n        if (hasOwnProperty.call(obj, k)) {\r\n            if (iteratee(obj[k], k, obj) === false)\r\n                break;\r\n        }\r\n    }\r\n    return obj;\r\n}\r\nfunction last(arr) {\r\n    return arr[arr.length - 1];\r\n}\r\n/*\r\n * Checks if value is the language type of Object.\r\n * (e.g. arrays, functions, objects, regexes, new Number(0), and new String(''))\r\n * @param {any} value The value to check.\r\n * @return {Boolean} Returns true if value is an object, else false.\r\n */\r\nfunction isObject(value) {\r\n    const type = typeof value;\r\n    return value !== null && (type === 'object' || type === 'function');\r\n}\r\nfunction range(start, stop, step = 1) {\r\n    const arr = [];\r\n    for (let i = start; i < stop; i += step) {\r\n        arr.push(i);\r\n    }\r\n    return arr;\r\n}\r\nfunction padStart(str, length, ch = ' ') {\r\n    return pad(str, length, ch, (str, ch) => ch + str);\r\n}\r\nfunction padEnd(str, length, ch = ' ') {\r\n    return pad(str, length, ch, (str, ch) => str + ch);\r\n}\r\nfunction pad(str, length, ch, add) {\r\n    str = String(str);\r\n    let n = length - str.length;\r\n    while (n-- > 0)\r\n        str = add(str, ch);\r\n    return str;\r\n}\r\nfunction identify(val) {\r\n    return val;\r\n}\r\nfunction changeCase(str) {\r\n    const hasLowerCase = [...str].some(ch => ch >= 'a' && ch <= 'z');\r\n    return hasLowerCase ? str.toUpperCase() : str.toLowerCase();\r\n}\r\nfunction ellipsis(str, N) {\r\n    return str.length > N ? str.slice(0, N - 3) + '...' : str;\r\n}\r\n// compare string in case-insensitive way, undefined values to the tail\r\nfunction caseInsensitiveCompare(a, b) {\r\n    if (a == null && b == null)\r\n        return 0;\r\n    if (a == null)\r\n        return 1;\r\n    if (b == null)\r\n        return -1;\r\n    a = toLowerCase.call(a);\r\n    b = toLowerCase.call(b);\r\n    if (a < b)\r\n        return -1;\r\n    if (a > b)\r\n        return 1;\r\n    return 0;\r\n}\r\nfunction argumentsToValue(fn) {\r\n    return function (...args) { return fn.call(this, ...args.map(toValue)); };\r\n}\r\nfunction argumentsToNumber(fn) {\r\n    return function (...args) { return fn.call(this, ...args.map(toNumber)); };\r\n}\r\nfunction escapeRegExp(text) {\r\n    return text.replace(/[-[\\]{}()*+?.,\\\\^$|#\\s]/g, '\\\\$&');\r\n}\r\n/** Return an array containing unique elements from _array_. Works with nested arrays and objects. */\r\nfunction* strictUniq(array) {\r\n    const seen = new Set();\r\n    for (const element of array) {\r\n        const key = JSON.stringify(element);\r\n        if (!seen.has(key)) {\r\n            seen.add(key);\r\n            yield element;\r\n        }\r\n    }\r\n}\n\n/**\r\n * targeting ES5, extends Error won't create a proper prototype chain, need a trait to keep track of classes\r\n */\r\nconst TRAIT = '__liquidClass__';\r\nclass LiquidError extends Error {\r\n    constructor(err, token) {\r\n        /**\r\n         * note: for ES5 targeting, `this` will be replaced by return value of Error(),\r\n         * thus everything on `this` will be lost, avoid calling `LiquidError` methods here\r\n         */\r\n        super(typeof err === 'string' ? err : err.message);\r\n        this.context = '';\r\n        if (typeof err !== 'string')\r\n            Object.defineProperty(this, 'originalError', { value: err, enumerable: false });\r\n        Object.defineProperty(this, 'token', { value: token, enumerable: false });\r\n        Object.defineProperty(this, TRAIT, { value: 'LiquidError', enumerable: false });\r\n    }\r\n    update() {\r\n        Object.defineProperty(this, 'context', { value: mkContext(this.token), enumerable: false });\r\n        this.message = mkMessage(this.message, this.token);\r\n        this.stack = this.message + '\\n' + this.context +\r\n            '\\n' + this.stack;\r\n        if (this.originalError)\r\n            this.stack += '\\nFrom ' + this.originalError.stack;\r\n    }\r\n    static is(obj) {\r\n        return (obj === null || obj === void 0 ? void 0 : obj[TRAIT]) === 'LiquidError';\r\n    }\r\n}\r\nclass TokenizationError extends LiquidError {\r\n    constructor(message, token) {\r\n        super(message, token);\r\n        this.name = 'TokenizationError';\r\n        super.update();\r\n    }\r\n}\r\nclass ParseError extends LiquidError {\r\n    constructor(err, token) {\r\n        super(err, token);\r\n        this.name = 'ParseError';\r\n        this.message = err.message;\r\n        super.update();\r\n    }\r\n}\r\nclass RenderError extends LiquidError {\r\n    constructor(err, tpl) {\r\n        super(err, tpl.token);\r\n        this.name = 'RenderError';\r\n        this.message = err.message;\r\n        super.update();\r\n    }\r\n    static is(obj) {\r\n        return obj.name === 'RenderError';\r\n    }\r\n}\r\nclass LiquidErrors extends LiquidError {\r\n    constructor(errors) {\r\n        super(errors[0], errors[0].token);\r\n        this.errors = errors;\r\n        this.name = 'LiquidErrors';\r\n        const s = errors.length > 1 ? 's' : '';\r\n        this.message = `${errors.length} error${s} found`;\r\n        super.update();\r\n    }\r\n    static is(obj) {\r\n        return obj.name === 'LiquidErrors';\r\n    }\r\n}\r\nclass UndefinedVariableError extends LiquidError {\r\n    constructor(err, token) {\r\n        super(err, token);\r\n        this.name = 'UndefinedVariableError';\r\n        this.message = err.message;\r\n        super.update();\r\n    }\r\n}\r\n// only used internally; raised where we don't have token information,\r\n// so it can't be an UndefinedVariableError.\r\nclass InternalUndefinedVariableError extends Error {\r\n    constructor(variableName) {\r\n        super(`undefined variable: ${variableName}`);\r\n        this.name = 'InternalUndefinedVariableError';\r\n        this.variableName = variableName;\r\n    }\r\n}\r\nclass AssertionError extends Error {\r\n    constructor(message) {\r\n        super(message);\r\n        this.name = 'AssertionError';\r\n        this.message = message + '';\r\n    }\r\n}\r\nfunction mkContext(token) {\r\n    const [line, col] = token.getPosition();\r\n    const lines = token.input.split('\\n');\r\n    const begin = Math.max(line - 2, 1);\r\n    const end = Math.min(line + 3, lines.length);\r\n    const context = range(begin, end + 1)\r\n        .map(lineNumber => {\r\n        const rowIndicator = (lineNumber === line) ? '>> ' : '   ';\r\n        const num = padStart(String(lineNumber), String(end).length);\r\n        let text = `${rowIndicator}${num}| `;\r\n        const colIndicator = lineNumber === line\r\n            ? '\\n' + padStart('^', col + text.length)\r\n            : '';\r\n        text += lines[lineNumber - 1];\r\n        text += colIndicator;\r\n        return text;\r\n    })\r\n        .join('\\n');\r\n    return context;\r\n}\r\nfunction mkMessage(msg, token) {\r\n    if (token.file)\r\n        msg += `, file:${token.file}`;\r\n    const [line, col] = token.getPosition();\r\n    msg += `, line:${line}, col:${col}`;\r\n    return msg;\r\n}\n\n// **DO NOT CHANGE THIS FILE**\r\n//\r\n// This file is generated by bin/character-gen.js\r\n// bitmask character types to boost performance\r\nconst TYPES = [0, 0, 0, 0, 0, 0, 0, 0, 0, 20, 4, 4, 4, 20, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 20, 2, 8, 0, 0, 0, 0, 8, 0, 0, 0, 64, 0, 65, 0, 0, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 0, 0, 2, 2, 2, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0];\r\nconst WORD = 1;\r\nconst BLANK = 4;\r\nconst QUOTE = 8;\r\nconst INLINE_BLANK = 16;\r\nconst NUMBER = 32;\r\nconst SIGN = 64;\r\nconst PUNCTUATION = 128;\r\nfunction isWord(char) {\r\n    const code = char.charCodeAt(0);\r\n    return code >= 128 ? !TYPES[code] : !!(TYPES[code] & WORD);\r\n}\r\nTYPES[160] = TYPES[5760] = TYPES[6158] = TYPES[8192] = TYPES[8193] = TYPES[8194] = TYPES[8195] = TYPES[8196] = TYPES[8197] = TYPES[8198] = TYPES[8199] = TYPES[8200] = TYPES[8201] = TYPES[8202] = TYPES[8232] = TYPES[8233] = TYPES[8239] = TYPES[8287] = TYPES[12288] = BLANK;\r\nTYPES[8220] = TYPES[8221] = PUNCTUATION;\n\nfunction assert(predicate, message) {\r\n    if (!predicate) {\r\n        const msg = typeof message === 'function'\r\n            ? message()\r\n            : (message || `expect ${predicate} to be true`);\r\n        throw new AssertionError(msg);\r\n    }\r\n}\r\nfunction assertEmpty(predicate, message = `unexpected ${JSON.stringify(predicate)}`) {\r\n    assert(!predicate, message);\r\n}\n\nclass NullDrop extends Drop {\r\n    equals(value) {\r\n        return isNil(toValue(value));\r\n    }\r\n    gt() {\r\n        return false;\r\n    }\r\n    geq() {\r\n        return false;\r\n    }\r\n    lt() {\r\n        return false;\r\n    }\r\n    leq() {\r\n        return false;\r\n    }\r\n    valueOf() {\r\n        return null;\r\n    }\r\n}\n\nclass EmptyDrop extends Drop {\r\n    equals(value) {\r\n        if (value instanceof EmptyDrop)\r\n            return false;\r\n        value = toValue(value);\r\n        if (isString(value) || isArray(value))\r\n            return value.length === 0;\r\n        if (isObject(value))\r\n            return Object.keys(value).length === 0;\r\n        return false;\r\n    }\r\n    gt() {\r\n        return false;\r\n    }\r\n    geq() {\r\n        return false;\r\n    }\r\n    lt() {\r\n        return false;\r\n    }\r\n    leq() {\r\n        return false;\r\n    }\r\n    valueOf() {\r\n        return '';\r\n    }\r\n    static is(value) {\r\n        return value instanceof EmptyDrop;\r\n    }\r\n}\n\nclass BlankDrop extends EmptyDrop {\r\n    equals(value) {\r\n        if (value === false)\r\n            return true;\r\n        if (isNil(toValue(value)))\r\n            return true;\r\n        if (isString(value))\r\n            return /^\\s*$/.test(value);\r\n        return super.equals(value);\r\n    }\r\n    static is(value) {\r\n        return value instanceof BlankDrop;\r\n    }\r\n}\n\nclass ForloopDrop extends Drop {\r\n    constructor(length, collection, variable) {\r\n        super();\r\n        this.i = 0;\r\n        this.length = length;\r\n        this.name = `${variable}-${collection}`;\r\n    }\r\n    next() {\r\n        this.i++;\r\n    }\r\n    index0() {\r\n        return this.i;\r\n    }\r\n    index() {\r\n        return this.i + 1;\r\n    }\r\n    first() {\r\n        return this.i === 0;\r\n    }\r\n    last() {\r\n        return this.i === this.length - 1;\r\n    }\r\n    rindex() {\r\n        return this.length - this.i;\r\n    }\r\n    rindex0() {\r\n        return this.length - this.i - 1;\r\n    }\r\n    valueOf() {\r\n        return JSON.stringify(this);\r\n    }\r\n}\n\nclass SimpleEmitter {\r\n    constructor() {\r\n        this.buffer = '';\r\n    }\r\n    write(html) {\r\n        this.buffer += stringify(html);\r\n    }\r\n}\n\nclass StreamedEmitter {\r\n    constructor() {\r\n        this.buffer = '';\r\n        this.stream = null;\r\n        throw new Error('streaming not supported in browser');\r\n    }\r\n}\n\nclass KeepingTypeEmitter {\r\n    constructor() {\r\n        this.buffer = '';\r\n    }\r\n    write(html) {\r\n        html = toValue(html);\r\n        // This will only preserve the type if the value is isolated.\r\n        // I.E:\r\n        // {{ my-port }} -> 42\r\n        // {{ my-host }}:{{ my-port }} -> 'host:42'\r\n        if (typeof html !== 'string' && this.buffer === '') {\r\n            this.buffer = html;\r\n        }\r\n        else {\r\n            this.buffer = stringify(this.buffer) + stringify(html);\r\n        }\r\n    }\r\n}\n\nclass BlockDrop extends Drop {\r\n    constructor(\r\n    // the block render from layout template\r\n    superBlockRender = () => '') {\r\n        super();\r\n        this.superBlockRender = superBlockRender;\r\n    }\r\n    /**\r\n     * Provide parent access in child block by\r\n     * {{ block.super }}\r\n     */\r\n    *super() {\r\n        const emitter = new SimpleEmitter();\r\n        yield this.superBlockRender(emitter);\r\n        return emitter.buffer;\r\n    }\r\n}\n\nfunction isComparable(arg) {\r\n    return (arg &&\r\n        isFunction(arg.equals) &&\r\n        isFunction(arg.gt) &&\r\n        isFunction(arg.geq) &&\r\n        isFunction(arg.lt) &&\r\n        isFunction(arg.leq));\r\n}\n\nconst nil = new NullDrop();\r\nconst literalValues = {\r\n    'true': true,\r\n    'false': false,\r\n    'nil': nil,\r\n    'null': nil,\r\n    'empty': new EmptyDrop(),\r\n    'blank': new BlankDrop()\r\n};\n\nfunction createTrie(input) {\r\n    const trie = {};\r\n    for (const [name, data] of Object.entries(input)) {\r\n        let node = trie;\r\n        for (let i = 0; i < name.length; i++) {\r\n            const c = name[i];\r\n            node[c] = node[c] || {};\r\n            if (i === name.length - 1 && isWord(name[i])) {\r\n                node[c].needBoundary = true;\r\n            }\r\n            node = node[c];\r\n        }\r\n        node.data = data;\r\n        node.end = true;\r\n    }\r\n    return trie;\r\n}\n\n/******************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n\r\nvar __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\n\r\nfunction __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\n\n// convert an async iterator to a Promise\r\nfunction toPromise(val) {\r\n    return __awaiter(this, void 0, void 0, function* () {\r\n        if (!isIterator(val))\r\n            return val;\r\n        let value;\r\n        let done = false;\r\n        let next = 'next';\r\n        do {\r\n            const state = val[next](value);\r\n            done = state.done;\r\n            value = state.value;\r\n            next = 'next';\r\n            try {\r\n                if (isIterator(value))\r\n                    value = toPromise(value);\r\n                if (isPromise(value))\r\n                    value = yield value;\r\n            }\r\n            catch (err) {\r\n                next = 'throw';\r\n                value = err;\r\n            }\r\n        } while (!done);\r\n        return value;\r\n    });\r\n}\r\n// convert an async iterator to a value in a synchronous manner\r\nfunction toValueSync(val) {\r\n    if (!isIterator(val))\r\n        return val;\r\n    let value;\r\n    let done = false;\r\n    let next = 'next';\r\n    do {\r\n        const state = val[next](value);\r\n        done = state.done;\r\n        value = state.value;\r\n        next = 'next';\r\n        if (isIterator(value)) {\r\n            try {\r\n                value = toValueSync(value);\r\n            }\r\n            catch (err) {\r\n                next = 'throw';\r\n                value = err;\r\n            }\r\n        }\r\n    } while (!done);\r\n    return value;\r\n}\n\nconst rFormat = /%([-_0^#:]+)?(\\d+)?([EO])?(.)/;\r\n// prototype extensions\r\nfunction daysInMonth(d) {\r\n    const feb = isLeapYear(d) ? 29 : 28;\r\n    return [31, feb, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];\r\n}\r\nfunction getDayOfYear(d) {\r\n    let num = 0;\r\n    for (let i = 0; i < d.getMonth(); ++i) {\r\n        num += daysInMonth(d)[i];\r\n    }\r\n    return num + d.getDate();\r\n}\r\nfunction getWeekOfYear(d, startDay) {\r\n    // Skip to startDay of this week\r\n    const now = getDayOfYear(d) + (startDay - d.getDay());\r\n    // Find the first startDay of the year\r\n    const jan1 = new Date(d.getFullYear(), 0, 1);\r\n    const then = (7 - jan1.getDay() + startDay);\r\n    return String(Math.floor((now - then) / 7) + 1);\r\n}\r\nfunction isLeapYear(d) {\r\n    const year = d.getFullYear();\r\n    return !!((year & 3) === 0 && (year % 100 || (year % 400 === 0 && year)));\r\n}\r\nfunction ordinal(d) {\r\n    const date = d.getDate();\r\n    if ([11, 12, 13].includes(date))\r\n        return 'th';\r\n    switch (date % 10) {\r\n        case 1: return 'st';\r\n        case 2: return 'nd';\r\n        case 3: return 'rd';\r\n        default: return 'th';\r\n    }\r\n}\r\nfunction century(d) {\r\n    return parseInt(d.getFullYear().toString().substring(0, 2), 10);\r\n}\r\n// default to 0\r\nconst padWidths = {\r\n    d: 2,\r\n    e: 2,\r\n    H: 2,\r\n    I: 2,\r\n    j: 3,\r\n    k: 2,\r\n    l: 2,\r\n    L: 3,\r\n    m: 2,\r\n    M: 2,\r\n    S: 2,\r\n    U: 2,\r\n    W: 2\r\n};\r\nconst padSpaceChars = new Set('aAbBceklpP');\r\nfunction getTimezoneOffset(d, opts) {\r\n    const nOffset = Math.abs(d.getTimezoneOffset());\r\n    const h = Math.floor(nOffset / 60);\r\n    const m = nOffset % 60;\r\n    return (d.getTimezoneOffset() > 0 ? '-' : '+') +\r\n        padStart(h, 2, '0') +\r\n        (opts.flags[':'] ? ':' : '') +\r\n        padStart(m, 2, '0');\r\n}\r\nconst formatCodes = {\r\n    a: (d) => d.getShortWeekdayName(),\r\n    A: (d) => d.getLongWeekdayName(),\r\n    b: (d) => d.getShortMonthName(),\r\n    B: (d) => d.getLongMonthName(),\r\n    c: (d) => d.toLocaleString(),\r\n    C: (d) => century(d),\r\n    d: (d) => d.getDate(),\r\n    e: (d) => d.getDate(),\r\n    H: (d) => d.getHours(),\r\n    I: (d) => String(d.getHours() % 12 || 12),\r\n    j: (d) => getDayOfYear(d),\r\n    k: (d) => d.getHours(),\r\n    l: (d) => String(d.getHours() % 12 || 12),\r\n    L: (d) => d.getMilliseconds(),\r\n    m: (d) => d.getMonth() + 1,\r\n    M: (d) => d.getMinutes(),\r\n    N: (d, opts) => {\r\n        const width = Number(opts.width) || 9;\r\n        const str = String(d.getMilliseconds()).slice(0, width);\r\n        return padEnd(str, width, '0');\r\n    },\r\n    p: (d) => (d.getHours() < 12 ? 'AM' : 'PM'),\r\n    P: (d) => (d.getHours() < 12 ? 'am' : 'pm'),\r\n    q: (d) => ordinal(d),\r\n    s: (d) => Math.round(d.getTime() / 1000),\r\n    S: (d) => d.getSeconds(),\r\n    u: (d) => d.getDay() || 7,\r\n    U: (d) => getWeekOfYear(d, 0),\r\n    w: (d) => d.getDay(),\r\n    W: (d) => getWeekOfYear(d, 1),\r\n    x: (d) => d.toLocaleDateString(),\r\n    X: (d) => d.toLocaleTimeString(),\r\n    y: (d) => d.getFullYear().toString().slice(2, 4),\r\n    Y: (d) => d.getFullYear(),\r\n    z: getTimezoneOffset,\r\n    Z: (d, opts) => d.getTimeZoneName() || getTimezoneOffset(d, opts),\r\n    't': () => '\\t',\r\n    'n': () => '\\n',\r\n    '%': () => '%'\r\n};\r\nformatCodes.h = formatCodes.b;\r\nfunction strftime(d, formatStr) {\r\n    let output = '';\r\n    let remaining = formatStr;\r\n    let match;\r\n    while ((match = rFormat.exec(remaining))) {\r\n        output += remaining.slice(0, match.index);\r\n        remaining = remaining.slice(match.index + match[0].length);\r\n        output += format(d, match);\r\n    }\r\n    return output + remaining;\r\n}\r\nfunction format(d, match) {\r\n    const [input, flagStr = '', width, modifier, conversion] = match;\r\n    const convert = formatCodes[conversion];\r\n    if (!convert)\r\n        return input;\r\n    const flags = {};\r\n    for (const flag of flagStr)\r\n        flags[flag] = true;\r\n    let ret = String(convert(d, { flags, width, modifier }));\r\n    let padChar = padSpaceChars.has(conversion) ? ' ' : '0';\r\n    let padWidth = width || padWidths[conversion] || 0;\r\n    if (flags['^'])\r\n        ret = ret.toUpperCase();\r\n    else if (flags['#'])\r\n        ret = changeCase(ret);\r\n    if (flags['_'])\r\n        padChar = ' ';\r\n    else if (flags['0'])\r\n        padChar = '0';\r\n    if (flags['-'])\r\n        padWidth = 0;\r\n    return padStart(ret, padWidth, padChar);\r\n}\n\nfunction getDateTimeFormat() {\r\n    return (typeof Intl !== 'undefined' ? Intl.DateTimeFormat : undefined);\r\n}\n\n// one minute in milliseconds\r\nconst OneMinute = 60000;\r\n/**\r\n * Need support both ISO8601 and RFC2822 as in major browsers & NodeJS\r\n * RFC2822: https://datatracker.ietf.org/doc/html/rfc2822#section-3.3\r\n */\r\nconst TIMEZONE_PATTERN = /([zZ]|([+-])(\\d{2}):?(\\d{2}))$/;\r\nconst monthNames = [\r\n    'January', 'February', 'March', 'April', 'May', 'June', 'July', 'August',\r\n    'September', 'October', 'November', 'December'\r\n];\r\nconst monthNamesShort = monthNames.map(name => name.slice(0, 3));\r\nconst dayNames = [\r\n    'Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'\r\n];\r\nconst dayNamesShort = dayNames.map(name => name.slice(0, 3));\r\n/**\r\n * A date implementation with timezone info, just like Ruby date\r\n *\r\n * Implementation:\r\n * - create a Date offset by it's timezone difference, avoiding overriding a bunch of methods\r\n * - rewrite getTimezoneOffset() to trick strftime\r\n */\r\nclass LiquidDate {\r\n    constructor(init, locale, timezone) {\r\n        this.locale = locale;\r\n        this.DateTimeFormat = getDateTimeFormat();\r\n        this.date = new Date(init);\r\n        this.timezoneFixed = timezone !== undefined;\r\n        if (timezone === undefined) {\r\n            timezone = this.date.getTimezoneOffset();\r\n        }\r\n        this.timezoneOffset = isString(timezone) ? LiquidDate.getTimezoneOffset(timezone, this.date) : timezone;\r\n        this.timezoneName = isString(timezone) ? timezone : '';\r\n        const diff = (this.date.getTimezoneOffset() - this.timezoneOffset) * OneMinute;\r\n        const time = this.date.getTime() + diff;\r\n        this.displayDate = new Date(time);\r\n    }\r\n    getTime() {\r\n        return this.displayDate.getTime();\r\n    }\r\n    getMilliseconds() {\r\n        return this.displayDate.getMilliseconds();\r\n    }\r\n    getSeconds() {\r\n        return this.displayDate.getSeconds();\r\n    }\r\n    getMinutes() {\r\n        return this.displayDate.getMinutes();\r\n    }\r\n    getHours() {\r\n        return this.displayDate.getHours();\r\n    }\r\n    getDay() {\r\n        return this.displayDate.getDay();\r\n    }\r\n    getDate() {\r\n        return this.displayDate.getDate();\r\n    }\r\n    getMonth() {\r\n        return this.displayDate.getMonth();\r\n    }\r\n    getFullYear() {\r\n        return this.displayDate.getFullYear();\r\n    }\r\n    toLocaleString(locale, init) {\r\n        if (init === null || init === void 0 ? void 0 : init.timeZone) {\r\n            return this.date.toLocaleString(locale, init);\r\n        }\r\n        return this.displayDate.toLocaleString(locale, init);\r\n    }\r\n    toLocaleTimeString(locale) {\r\n        return this.displayDate.toLocaleTimeString(locale);\r\n    }\r\n    toLocaleDateString(locale) {\r\n        return this.displayDate.toLocaleDateString(locale);\r\n    }\r\n    getTimezoneOffset() {\r\n        return this.timezoneOffset;\r\n    }\r\n    getTimeZoneName() {\r\n        if (this.timezoneFixed)\r\n            return this.timezoneName;\r\n        if (!this.DateTimeFormat)\r\n            return;\r\n        return this.DateTimeFormat().resolvedOptions().timeZone;\r\n    }\r\n    getLongMonthName() {\r\n        var _a;\r\n        return (_a = this.format({ month: 'long' })) !== null && _a !== void 0 ? _a : monthNames[this.getMonth()];\r\n    }\r\n    getShortMonthName() {\r\n        var _a;\r\n        return (_a = this.format({ month: 'short' })) !== null && _a !== void 0 ? _a : monthNamesShort[this.getMonth()];\r\n    }\r\n    getLongWeekdayName() {\r\n        var _a;\r\n        return (_a = this.format({ weekday: 'long' })) !== null && _a !== void 0 ? _a : dayNames[this.displayDate.getDay()];\r\n    }\r\n    getShortWeekdayName() {\r\n        var _a;\r\n        return (_a = this.format({ weekday: 'short' })) !== null && _a !== void 0 ? _a : dayNamesShort[this.displayDate.getDay()];\r\n    }\r\n    valid() {\r\n        return !isNaN(this.getTime());\r\n    }\r\n    format(options) {\r\n        return this.DateTimeFormat && this.DateTimeFormat(this.locale, options).format(this.displayDate);\r\n    }\r\n    /**\r\n     * Create a Date object fixed to it's declared Timezone. Both\r\n     * - 2021-08-06T02:29:00.000Z and\r\n     * - 2021-08-06T02:29:00.000+08:00\r\n     * will always be displayed as\r\n     * - 2021-08-06 02:29:00\r\n     * regardless timezoneOffset in JavaScript realm\r\n     *\r\n     * The implementation hack:\r\n     * Instead of calling `.getMonth()`/`.getUTCMonth()` respect to `preserveTimezones`,\r\n     * we create a different Date to trick strftime, it's both simpler and more performant.\r\n     * Given that a template is expected to be parsed fewer times than rendered.\r\n     */\r\n    static createDateFixedToTimezone(dateString, locale) {\r\n        const m = dateString.match(TIMEZONE_PATTERN);\r\n        // representing a UTC timestamp\r\n        if (m && m[1] === 'Z') {\r\n            return new LiquidDate(+new Date(dateString), locale, 0);\r\n        }\r\n        // has a timezone specified\r\n        if (m && m[2] && m[3] && m[4]) {\r\n            const [, , sign, hours, minutes] = m;\r\n            const offset = (sign === '+' ? -1 : 1) * (parseInt(hours, 10) * 60 + parseInt(minutes, 10));\r\n            return new LiquidDate(+new Date(dateString), locale, offset);\r\n        }\r\n        return new LiquidDate(dateString, locale);\r\n    }\r\n    static getTimezoneOffset(timezoneName, date) {\r\n        const localDateString = date.toLocaleString('en-US', { timeZone: timezoneName });\r\n        const utcDateString = date.toLocaleString('en-US', { timeZone: 'UTC' });\r\n        const localDate = new Date(localDateString);\r\n        const utcDate = new Date(utcDateString);\r\n        return (+utcDate - +localDate) / (60 * 1000);\r\n    }\r\n}\n\nclass Limiter {\r\n    constructor(resource, limit) {\r\n        this.base = 0;\r\n        this.message = `${resource} limit exceeded`;\r\n        this.limit = limit;\r\n    }\r\n    use(count) {\r\n        count = +count || 0;\r\n        assert(this.base + count <= this.limit, this.message);\r\n        this.base += count;\r\n    }\r\n    check(count) {\r\n        count = +count || 0;\r\n        assert(count <= this.limit, this.message);\r\n    }\r\n}\n\nclass DelimitedToken extends Token {\r\n    constructor(kind, [contentBegin, contentEnd], input, begin, end, trimLeft, trimRight, file) {\r\n        super(kind, input, begin, end, file);\r\n        this.trimLeft = false;\r\n        this.trimRight = false;\r\n        const tl = input[contentBegin] === '-';\r\n        const tr = input[contentEnd - 1] === '-';\r\n        let l = tl ? contentBegin + 1 : contentBegin;\r\n        let r = tr ? contentEnd - 1 : contentEnd;\r\n        while (l < r && (TYPES[input.charCodeAt(l)] & BLANK))\r\n            l++;\r\n        while (r > l && (TYPES[input.charCodeAt(r - 1)] & BLANK))\r\n            r--;\r\n        this.contentRange = [l, r];\r\n        this.trimLeft = tl || trimLeft;\r\n        this.trimRight = tr || trimRight;\r\n    }\r\n    get content() {\r\n        return this.input.slice(this.contentRange[0], this.contentRange[1]);\r\n    }\r\n}\n\nclass TagToken extends DelimitedToken {\r\n    constructor(input, begin, end, options, file) {\r\n        const { trimTagLeft, trimTagRight, tagDelimiterLeft, tagDelimiterRight } = options;\r\n        const [valueBegin, valueEnd] = [begin + tagDelimiterLeft.length, end - tagDelimiterRight.length];\r\n        super(TokenKind.Tag, [valueBegin, valueEnd], input, begin, end, trimTagLeft, trimTagRight, file);\r\n        this.tokenizer = new Tokenizer(input, options.operators, file, this.contentRange);\r\n        this.name = this.tokenizer.readTagName();\r\n        this.tokenizer.assert(this.name, `illegal tag syntax, tag name expected`);\r\n        this.tokenizer.skipBlank();\r\n        this.args = this.tokenizer.input.slice(this.tokenizer.p, this.contentRange[1]);\r\n    }\r\n}\n\nclass OutputToken extends DelimitedToken {\r\n    constructor(input, begin, end, options, file) {\r\n        const { trimOutputLeft, trimOutputRight, outputDelimiterLeft, outputDelimiterRight } = options;\r\n        const valueRange = [begin + outputDelimiterLeft.length, end - outputDelimiterRight.length];\r\n        super(TokenKind.Output, valueRange, input, begin, end, trimOutputLeft, trimOutputRight, file);\r\n    }\r\n}\n\nclass HTMLToken extends Token {\r\n    constructor(input, begin, end, file) {\r\n        super(TokenKind.HTML, input, begin, end, file);\r\n        this.input = input;\r\n        this.begin = begin;\r\n        this.end = end;\r\n        this.file = file;\r\n        this.trimLeft = 0;\r\n        this.trimRight = 0;\r\n    }\r\n    getContent() {\r\n        return this.input.slice(this.begin + this.trimLeft, this.end - this.trimRight);\r\n    }\r\n}\n\nclass NumberToken extends Token {\r\n    constructor(input, begin, end, file) {\r\n        super(TokenKind.Number, input, begin, end, file);\r\n        this.input = input;\r\n        this.begin = begin;\r\n        this.end = end;\r\n        this.file = file;\r\n        this.content = Number(this.getText());\r\n    }\r\n}\n\nclass IdentifierToken extends Token {\r\n    constructor(input, begin, end, file) {\r\n        super(TokenKind.Word, input, begin, end, file);\r\n        this.input = input;\r\n        this.begin = begin;\r\n        this.end = end;\r\n        this.file = file;\r\n        this.content = this.getText();\r\n    }\r\n}\n\nclass LiteralToken extends Token {\r\n    constructor(input, begin, end, file) {\r\n        super(TokenKind.Literal, input, begin, end, file);\r\n        this.input = input;\r\n        this.begin = begin;\r\n        this.end = end;\r\n        this.file = file;\r\n        this.literal = this.getText();\r\n        this.content = literalValues[this.literal];\r\n    }\r\n}\n\nconst operatorPrecedences = {\r\n    '==': 2,\r\n    '!=': 2,\r\n    '>': 2,\r\n    '<': 2,\r\n    '>=': 2,\r\n    '<=': 2,\r\n    'contains': 2,\r\n    'not': 1,\r\n    'and': 0,\r\n    'or': 0\r\n};\r\nconst operatorTypes = {\r\n    '==': 0 /* OperatorType.Binary */,\r\n    '!=': 0 /* OperatorType.Binary */,\r\n    '>': 0 /* OperatorType.Binary */,\r\n    '<': 0 /* OperatorType.Binary */,\r\n    '>=': 0 /* OperatorType.Binary */,\r\n    '<=': 0 /* OperatorType.Binary */,\r\n    'contains': 0 /* OperatorType.Binary */,\r\n    'not': 1 /* OperatorType.Unary */,\r\n    'and': 0 /* OperatorType.Binary */,\r\n    'or': 0 /* OperatorType.Binary */\r\n};\r\nclass OperatorToken extends Token {\r\n    constructor(input, begin, end, file) {\r\n        super(TokenKind.Operator, input, begin, end, file);\r\n        this.input = input;\r\n        this.begin = begin;\r\n        this.end = end;\r\n        this.file = file;\r\n        this.operator = this.getText();\r\n    }\r\n    getPrecedence() {\r\n        const key = this.getText();\r\n        return key in operatorPrecedences ? operatorPrecedences[key] : 1;\r\n    }\r\n}\n\nclass PropertyAccessToken extends Token {\r\n    constructor(variable, props, input, begin, end, file) {\r\n        super(TokenKind.PropertyAccess, input, begin, end, file);\r\n        this.variable = variable;\r\n        this.props = props;\r\n    }\r\n}\n\nclass FilterToken extends Token {\r\n    constructor(name, args, input, begin, end, file) {\r\n        super(TokenKind.Filter, input, begin, end, file);\r\n        this.name = name;\r\n        this.args = args;\r\n    }\r\n}\n\nclass HashToken extends Token {\r\n    constructor(input, begin, end, name, value, file) {\r\n        super(TokenKind.Hash, input, begin, end, file);\r\n        this.input = input;\r\n        this.begin = begin;\r\n        this.end = end;\r\n        this.name = name;\r\n        this.value = value;\r\n        this.file = file;\r\n    }\r\n}\n\nconst rHex = /[\\da-fA-F]/;\r\nconst rOct = /[0-7]/;\r\nconst escapeChar = {\r\n    b: '\\b',\r\n    f: '\\f',\r\n    n: '\\n',\r\n    r: '\\r',\r\n    t: '\\t',\r\n    v: '\\x0B'\r\n};\r\nfunction hexVal(c) {\r\n    const code = c.charCodeAt(0);\r\n    if (code >= 97)\r\n        return code - 87;\r\n    if (code >= 65)\r\n        return code - 55;\r\n    return code - 48;\r\n}\r\nfunction parseStringLiteral(str) {\r\n    let ret = '';\r\n    for (let i = 1; i < str.length - 1; i++) {\r\n        if (str[i] !== '\\\\') {\r\n            ret += str[i];\r\n            continue;\r\n        }\r\n        if (escapeChar[str[i + 1]] !== undefined) {\r\n            ret += escapeChar[str[++i]];\r\n        }\r\n        else if (str[i + 1] === 'u') {\r\n            let val = 0;\r\n            let j = i + 2;\r\n            while (j <= i + 5 && rHex.test(str[j])) {\r\n                val = val * 16 + hexVal(str[j++]);\r\n            }\r\n            i = j - 1;\r\n            ret += String.fromCharCode(val);\r\n        }\r\n        else if (!rOct.test(str[i + 1])) {\r\n            ret += str[++i];\r\n        }\r\n        else {\r\n            let j = i + 1;\r\n            let val = 0;\r\n            while (j <= i + 3 && rOct.test(str[j])) {\r\n                val = val * 8 + hexVal(str[j++]);\r\n            }\r\n            i = j - 1;\r\n            ret += String.fromCharCode(val);\r\n        }\r\n    }\r\n    return ret;\r\n}\n\nclass QuotedToken extends Token {\r\n    constructor(input, begin, end, file) {\r\n        super(TokenKind.Quoted, input, begin, end, file);\r\n        this.input = input;\r\n        this.begin = begin;\r\n        this.end = end;\r\n        this.file = file;\r\n        this.content = parseStringLiteral(this.getText());\r\n    }\r\n}\n\nclass RangeToken extends Token {\r\n    constructor(input, begin, end, lhs, rhs, file) {\r\n        super(TokenKind.Range, input, begin, end, file);\r\n        this.input = input;\r\n        this.begin = begin;\r\n        this.end = end;\r\n        this.lhs = lhs;\r\n        this.rhs = rhs;\r\n        this.file = file;\r\n    }\r\n}\n\n/**\r\n * LiquidTagToken is different from TagToken by not having delimiters `{%` or `%}`\r\n */\r\nclass LiquidTagToken extends DelimitedToken {\r\n    constructor(input, begin, end, options, file) {\r\n        super(TokenKind.Tag, [begin, end], input, begin, end, false, false, file);\r\n        this.tokenizer = new Tokenizer(input, options.operators, file, this.contentRange);\r\n        this.name = this.tokenizer.readTagName();\r\n        this.tokenizer.assert(this.name, 'illegal liquid tag syntax');\r\n        this.tokenizer.skipBlank();\r\n    }\r\n    get args() {\r\n        return this.tokenizer.input.slice(this.tokenizer.p, this.contentRange[1]);\r\n    }\r\n}\n\n/**\r\n * value expression with optional filters\r\n * e.g.\r\n * {% assign foo=\"bar\" | append: \"coo\" %}\r\n */\r\nclass FilteredValueToken extends Token {\r\n    constructor(initial, filters, input, begin, end, file) {\r\n        super(TokenKind.FilteredValue, input, begin, end, file);\r\n        this.initial = initial;\r\n        this.filters = filters;\r\n        this.input = input;\r\n        this.begin = begin;\r\n        this.end = end;\r\n        this.file = file;\r\n    }\r\n}\n\nconst polyfill = {\r\n    now: () => Date.now()\r\n};\r\nfunction getPerformance() {\r\n    return (typeof global === 'object' && global.performance) ||\r\n        (typeof window === 'object' && window.performance) ||\r\n        polyfill;\r\n}\n\nclass Render {\r\n    renderTemplatesToNodeStream(templates, ctx) {\r\n        const emitter = new StreamedEmitter();\r\n        Promise.resolve().then(() => toPromise(this.renderTemplates(templates, ctx, emitter)))\r\n            .then(() => emitter.end(), err => emitter.error(err));\r\n        return emitter.stream;\r\n    }\r\n    *renderTemplates(templates, ctx, emitter) {\r\n        if (!emitter) {\r\n            emitter = ctx.opts.keepOutputType ? new KeepingTypeEmitter() : new SimpleEmitter();\r\n        }\r\n        const errors = [];\r\n        for (const tpl of templates) {\r\n            ctx.renderLimit.check(getPerformance().now());\r\n            try {\r\n                // if tpl.render supports emitter, it'll return empty `html`\r\n                const html = yield tpl.render(ctx, emitter);\r\n                // if not, it'll return an `html`, write to the emitter for it\r\n                html && emitter.write(html);\r\n                if (ctx.breakCalled || ctx.continueCalled)\r\n                    break;\r\n            }\r\n            catch (e) {\r\n                const err = LiquidError.is(e) ? e : new RenderError(e, tpl);\r\n                if (ctx.opts.catchAllErrors)\r\n                    errors.push(err);\r\n                else\r\n                    throw err;\r\n            }\r\n        }\r\n        if (errors.length) {\r\n            throw new LiquidErrors(errors);\r\n        }\r\n        return emitter.buffer;\r\n    }\r\n}\n\nclass Expression {\r\n    constructor(tokens) {\r\n        this.postfix = [...toPostfix(tokens)];\r\n    }\r\n    *evaluate(ctx, lenient) {\r\n        assert(ctx, 'unable to evaluate: context not defined');\r\n        const operands = [];\r\n        for (const token of this.postfix) {\r\n            if (isOperatorToken(token)) {\r\n                const r = operands.pop();\r\n                let result;\r\n                if (operatorTypes[token.operator] === 1 /* OperatorType.Unary */) {\r\n                    result = yield ctx.opts.operators[token.operator](r, ctx);\r\n                }\r\n                else {\r\n                    const l = operands.pop();\r\n                    result = yield ctx.opts.operators[token.operator](l, r, ctx);\r\n                }\r\n                operands.push(result);\r\n            }\r\n            else {\r\n                operands.push(yield evalToken(token, ctx, lenient));\r\n            }\r\n        }\r\n        return operands[0];\r\n    }\r\n    valid() {\r\n        return !!this.postfix.length;\r\n    }\r\n}\r\nfunction* evalToken(token, ctx, lenient = false) {\r\n    if (!token)\r\n        return;\r\n    if ('content' in token)\r\n        return token.content;\r\n    if (isPropertyAccessToken(token))\r\n        return yield evalPropertyAccessToken(token, ctx, lenient);\r\n    if (isRangeToken(token))\r\n        return yield evalRangeToken(token, ctx);\r\n}\r\nfunction* evalPropertyAccessToken(token, ctx, lenient) {\r\n    const props = [];\r\n    for (const prop of token.props) {\r\n        props.push((yield evalToken(prop, ctx, false)));\r\n    }\r\n    try {\r\n        if (token.variable) {\r\n            const variable = yield evalToken(token.variable, ctx, lenient);\r\n            return yield ctx._getFromScope(variable, props);\r\n        }\r\n        else {\r\n            return yield ctx._get(props);\r\n        }\r\n    }\r\n    catch (e) {\r\n        if (lenient && e.name === 'InternalUndefinedVariableError')\r\n            return null;\r\n        throw (new UndefinedVariableError(e, token));\r\n    }\r\n}\r\nfunction evalQuotedToken(token) {\r\n    return token.content;\r\n}\r\nfunction* evalRangeToken(token, ctx) {\r\n    const low = yield evalToken(token.lhs, ctx);\r\n    const high = yield evalToken(token.rhs, ctx);\r\n    ctx.memoryLimit.use(high - low + 1);\r\n    return range(+low, +high + 1);\r\n}\r\nfunction* toPostfix(tokens) {\r\n    const ops = [];\r\n    for (const token of tokens) {\r\n        if (isOperatorToken(token)) {\r\n            while (ops.length && ops[ops.length - 1].getPrecedence() > token.getPrecedence()) {\r\n                yield ops.pop();\r\n            }\r\n            ops.push(token);\r\n        }\r\n        else\r\n            yield token;\r\n    }\r\n    while (ops.length) {\r\n        yield ops.pop();\r\n    }\r\n}\n\nfunction isTruthy(val, ctx) {\r\n    return !isFalsy(val, ctx);\r\n}\r\nfunction isFalsy(val, ctx) {\r\n    val = toValue(val);\r\n    if (ctx.opts.jsTruthy) {\r\n        return !val;\r\n    }\r\n    else {\r\n        return val === false || undefined === val || val === null;\r\n    }\r\n}\n\nconst defaultOperators = {\r\n    '==': equals,\r\n    '!=': (l, r) => !equals(l, r),\r\n    '>': (l, r) => {\r\n        if (isComparable(l))\r\n            return l.gt(r);\r\n        if (isComparable(r))\r\n            return r.lt(l);\r\n        return toValue(l) > toValue(r);\r\n    },\r\n    '<': (l, r) => {\r\n        if (isComparable(l))\r\n            return l.lt(r);\r\n        if (isComparable(r))\r\n            return r.gt(l);\r\n        return toValue(l) < toValue(r);\r\n    },\r\n    '>=': (l, r) => {\r\n        if (isComparable(l))\r\n            return l.geq(r);\r\n        if (isComparable(r))\r\n            return r.leq(l);\r\n        return toValue(l) >= toValue(r);\r\n    },\r\n    '<=': (l, r) => {\r\n        if (isComparable(l))\r\n            return l.leq(r);\r\n        if (isComparable(r))\r\n            return r.geq(l);\r\n        return toValue(l) <= toValue(r);\r\n    },\r\n    'contains': (l, r) => {\r\n        l = toValue(l);\r\n        if (isArray(l))\r\n            return l.some((i) => equals(i, r));\r\n        if (isFunction(l === null || l === void 0 ? void 0 : l.indexOf))\r\n            return l.indexOf(toValue(r)) > -1;\r\n        return false;\r\n    },\r\n    'not': (v, ctx) => isFalsy(toValue(v), ctx),\r\n    'and': (l, r, ctx) => isTruthy(toValue(l), ctx) && isTruthy(toValue(r), ctx),\r\n    'or': (l, r, ctx) => isTruthy(toValue(l), ctx) || isTruthy(toValue(r), ctx)\r\n};\r\nfunction equals(lhs, rhs) {\r\n    if (isComparable(lhs))\r\n        return lhs.equals(rhs);\r\n    if (isComparable(rhs))\r\n        return rhs.equals(lhs);\r\n    lhs = toValue(lhs);\r\n    rhs = toValue(rhs);\r\n    if (isArray(lhs)) {\r\n        return isArray(rhs) && arrayEquals(lhs, rhs);\r\n    }\r\n    return lhs === rhs;\r\n}\r\nfunction arrayEquals(lhs, rhs) {\r\n    if (lhs.length !== rhs.length)\r\n        return false;\r\n    return !lhs.some((value, i) => !equals(value, rhs[i]));\r\n}\r\nfunction arrayIncludes(arr, item) {\r\n    return arr.some(value => equals(value, item));\r\n}\n\nclass Node {\r\n    constructor(key, value, next, prev) {\r\n        this.key = key;\r\n        this.value = value;\r\n        this.next = next;\r\n        this.prev = prev;\r\n    }\r\n}\r\nclass LRU {\r\n    constructor(limit, size = 0) {\r\n        this.limit = limit;\r\n        this.size = size;\r\n        this.cache = {};\r\n        this.head = new Node('HEAD', null, null, null);\r\n        this.tail = new Node('TAIL', null, null, null);\r\n        this.head.next = this.tail;\r\n        this.tail.prev = this.head;\r\n    }\r\n    write(key, value) {\r\n        if (this.cache[key]) {\r\n            this.cache[key].value = value;\r\n        }\r\n        else {\r\n            const node = new Node(key, value, this.head.next, this.head);\r\n            this.head.next.prev = node;\r\n            this.head.next = node;\r\n            this.cache[key] = node;\r\n            this.size++;\r\n            this.ensureLimit();\r\n        }\r\n    }\r\n    read(key) {\r\n        if (!this.cache[key])\r\n            return;\r\n        const { value } = this.cache[key];\r\n        this.remove(key);\r\n        this.write(key, value);\r\n        return value;\r\n    }\r\n    remove(key) {\r\n        const node = this.cache[key];\r\n        node.prev.next = node.next;\r\n        node.next.prev = node.prev;\r\n        delete this.cache[key];\r\n        this.size--;\r\n    }\r\n    clear() {\r\n        this.head.next = this.tail;\r\n        this.tail.prev = this.head;\r\n        this.size = 0;\r\n        this.cache = {};\r\n    }\r\n    ensureLimit() {\r\n        if (this.size > this.limit)\r\n            this.remove(this.tail.prev.key);\r\n    }\r\n}\n\nfunction domResolve(root, path) {\r\n    const base = document.createElement('base');\r\n    base.href = root;\r\n    const head = document.getElementsByTagName('head')[0];\r\n    head.insertBefore(base, head.firstChild);\r\n    const a = document.createElement('a');\r\n    a.href = path;\r\n    const resolved = a.href;\r\n    head.removeChild(base);\r\n    return resolved;\r\n}\r\nfunction resolve(root, filepath, ext) {\r\n    if (root.length && last(root) !== '/')\r\n        root += '/';\r\n    const url = domResolve(root, filepath);\r\n    return url.replace(/^(\\w+:\\/\\/[^/]+)(\\/[^?]+)/, (str, origin, path) => {\r\n        const last = path.split('/').pop();\r\n        if (/\\.\\w+$/.test(last))\r\n            return str;\r\n        return origin + path + ext;\r\n    });\r\n}\r\nfunction readFile(url) {\r\n    return __awaiter(this, void 0, void 0, function* () {\r\n        return new Promise((resolve, reject) => {\r\n            const xhr = new XMLHttpRequest();\r\n            xhr.onload = () => {\r\n                if (xhr.status >= 200 && xhr.status < 300) {\r\n                    resolve(xhr.responseText);\r\n                }\r\n                else {\r\n                    reject(new Error(xhr.statusText));\r\n                }\r\n            };\r\n            xhr.onerror = () => {\r\n                reject(new Error('An error occurred whilst receiving the response.'));\r\n            };\r\n            xhr.open('GET', url);\r\n            xhr.send();\r\n        });\r\n    });\r\n}\r\nfunction readFileSync(url) {\r\n    const xhr = new XMLHttpRequest();\r\n    xhr.open('GET', url, false);\r\n    xhr.send();\r\n    if (xhr.status < 200 || xhr.status >= 300) {\r\n        throw new Error(xhr.statusText);\r\n    }\r\n    return xhr.responseText;\r\n}\r\nfunction exists(filepath) {\r\n    return __awaiter(this, void 0, void 0, function* () {\r\n        return true;\r\n    });\r\n}\r\nfunction existsSync(filepath) {\r\n    return true;\r\n}\r\nfunction dirname(filepath) {\r\n    return domResolve(filepath, '.');\r\n}\r\nconst sep = '/';\n\nvar fs = /*#__PURE__*/Object.freeze({\n  __proto__: null,\n  resolve: resolve,\n  readFile: readFile,\n  readFileSync: readFileSync,\n  exists: exists,\n  existsSync: existsSync,\n  dirname: dirname,\n  sep: sep\n});\n\nfunction defaultFilter(value, defaultValue, ...args) {\r\n    value = toValue(value);\r\n    if (isArray(value) || isString(value))\r\n        return value.length ? value : defaultValue;\r\n    if (value === false && (new Map(args)).get('allow_false'))\r\n        return false;\r\n    return isFalsy(value, this.context) ? defaultValue : value;\r\n}\r\nfunction json(value, space = 0) {\r\n    return JSON.stringify(value, null, space);\r\n}\r\nfunction inspect(value, space = 0) {\r\n    const ancestors = [];\r\n    return JSON.stringify(value, function (_key, value) {\r\n        if (typeof value !== 'object' || value === null)\r\n            return value;\r\n        // `this` is the object that value is contained in, i.e., its direct parent.\r\n        while (ancestors.length > 0 && ancestors[ancestors.length - 1] !== this)\r\n            ancestors.pop();\r\n        if (ancestors.includes(value))\r\n            return '[Circular]';\r\n        ancestors.push(value);\r\n        return value;\r\n    }, space);\r\n}\r\nfunction to_integer(value) {\r\n    return Number(value);\r\n}\r\nconst raw = {\r\n    raw: true,\r\n    handler: identify\r\n};\r\nvar misc = {\r\n    default: defaultFilter,\r\n    raw,\r\n    jsonify: json,\r\n    to_integer,\r\n    json,\r\n    inspect\r\n};\n\nconst escapeMap = {\r\n    '&': '&amp;',\r\n    '<': '&lt;',\r\n    '>': '&gt;',\r\n    '\"': '&#34;',\r\n    \"'\": '&#39;'\r\n};\r\nconst unescapeMap = {\r\n    '&amp;': '&',\r\n    '&lt;': '<',\r\n    '&gt;': '>',\r\n    '&#34;': '\"',\r\n    '&#39;': \"'\"\r\n};\r\nfunction escape(str) {\r\n    str = stringify(str);\r\n    this.context.memoryLimit.use(str.length);\r\n    return str.replace(/&|<|>|\"|'/g, m => escapeMap[m]);\r\n}\r\nfunction xml_escape(str) {\r\n    return escape.call(this, str);\r\n}\r\nfunction unescape(str) {\r\n    str = stringify(str);\r\n    this.context.memoryLimit.use(str.length);\r\n    return str.replace(/&(amp|lt|gt|#34|#39);/g, m => unescapeMap[m]);\r\n}\r\nfunction escape_once(str) {\r\n    return escape.call(this, unescape.call(this, str));\r\n}\r\nfunction newline_to_br(v) {\r\n    const str = stringify(v);\r\n    this.context.memoryLimit.use(str.length);\r\n    return str.replace(/\\r?\\n/gm, '<br />\\n');\r\n}\r\nfunction strip_html(v) {\r\n    const str = stringify(v);\r\n    this.context.memoryLimit.use(str.length);\r\n    return str.replace(/<script[\\s\\S]*?<\\/script>|<style[\\s\\S]*?<\\/style>|<.*?>|<!--[\\s\\S]*?-->/g, '');\r\n}\n\nvar htmlFilters = /*#__PURE__*/Object.freeze({\n  __proto__: null,\n  escape: escape,\n  xml_escape: xml_escape,\n  escape_once: escape_once,\n  newline_to_br: newline_to_br,\n  strip_html: strip_html\n});\n\nclass MapFS {\r\n    constructor(mapping) {\r\n        this.mapping = mapping;\r\n        this.sep = '/';\r\n    }\r\n    exists(filepath) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            return this.existsSync(filepath);\r\n        });\r\n    }\r\n    existsSync(filepath) {\r\n        return !isNil(this.mapping[filepath]);\r\n    }\r\n    readFile(filepath) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            return this.readFileSync(filepath);\r\n        });\r\n    }\r\n    readFileSync(filepath) {\r\n        const content = this.mapping[filepath];\r\n        if (isNil(content))\r\n            throw new Error(`ENOENT: ${filepath}`);\r\n        return content;\r\n    }\r\n    dirname(filepath) {\r\n        const segments = filepath.split(this.sep);\r\n        segments.pop();\r\n        return segments.join(this.sep);\r\n    }\r\n    resolve(dir, file, ext) {\r\n        file += ext;\r\n        if (dir === '.')\r\n            return file;\r\n        const segments = dir.split(/\\/+/);\r\n        for (const segment of file.split(this.sep)) {\r\n            if (segment === '.' || segment === '')\r\n                continue;\r\n            else if (segment === '..') {\r\n                if (segments.length > 1 || segments[0] !== '')\r\n                    segments.pop();\r\n            }\r\n            else\r\n                segments.push(segment);\r\n        }\r\n        return segments.join(this.sep);\r\n    }\r\n}\n\nconst defaultOptions = {\r\n    root: ['.'],\r\n    layouts: ['.'],\r\n    partials: ['.'],\r\n    relativeReference: true,\r\n    jekyllInclude: false,\r\n    keyValueSeparator: ':',\r\n    cache: undefined,\r\n    extname: '',\r\n    fs: fs,\r\n    dynamicPartials: true,\r\n    jsTruthy: false,\r\n    dateFormat: '%A, %B %-e, %Y at %-l:%M %P %z',\r\n    locale: '',\r\n    trimTagRight: false,\r\n    trimTagLeft: false,\r\n    trimOutputRight: false,\r\n    trimOutputLeft: false,\r\n    greedy: true,\r\n    tagDelimiterLeft: '{%',\r\n    tagDelimiterRight: '%}',\r\n    outputDelimiterLeft: '{{',\r\n    outputDelimiterRight: '}}',\r\n    preserveTimezones: false,\r\n    strictFilters: false,\r\n    strictVariables: false,\r\n    ownPropertyOnly: true,\r\n    lenientIf: false,\r\n    globals: {},\r\n    keepOutputType: false,\r\n    operators: defaultOperators,\r\n    memoryLimit: Infinity,\r\n    parseLimit: Infinity,\r\n    renderLimit: Infinity\r\n};\r\nfunction normalize(options) {\r\n    var _a, _b;\r\n    if (options.hasOwnProperty('root')) {\r\n        if (!options.hasOwnProperty('partials'))\r\n            options.partials = options.root;\r\n        if (!options.hasOwnProperty('layouts'))\r\n            options.layouts = options.root;\r\n    }\r\n    if (options.hasOwnProperty('cache')) {\r\n        let cache;\r\n        if (typeof options.cache === 'number')\r\n            cache = options.cache > 0 ? new LRU(options.cache) : undefined;\r\n        else if (typeof options.cache === 'object')\r\n            cache = options.cache;\r\n        else\r\n            cache = options.cache ? new LRU(1024) : undefined;\r\n        options.cache = cache;\r\n    }\r\n    options = Object.assign(Object.assign(Object.assign({}, defaultOptions), (options.jekyllInclude ? { dynamicPartials: false } : {})), options);\r\n    if ((!options.fs.dirname || !options.fs.sep) && options.relativeReference) {\r\n        console.warn('[LiquidJS] `fs.dirname` and `fs.sep` are required for relativeReference, set relativeReference to `false` to suppress this warning');\r\n        options.relativeReference = false;\r\n    }\r\n    options.root = normalizeDirectoryList(options.root);\r\n    options.partials = normalizeDirectoryList(options.partials);\r\n    options.layouts = normalizeDirectoryList(options.layouts);\r\n    options.outputEscape = options.outputEscape && getOutputEscapeFunction(options.outputEscape);\r\n    if (!options.locale) {\r\n        options.locale = (_b = (_a = getDateTimeFormat()) === null || _a === void 0 ? void 0 : _a().resolvedOptions().locale) !== null && _b !== void 0 ? _b : 'en-US';\r\n    }\r\n    if (options.templates) {\r\n        options.fs = new MapFS(options.templates);\r\n        options.relativeReference = true;\r\n        options.root = options.partials = options.layouts = '.';\r\n    }\r\n    return options;\r\n}\r\nfunction getOutputEscapeFunction(nameOrFunction) {\r\n    if (nameOrFunction === 'escape')\r\n        return escape;\r\n    if (nameOrFunction === 'json')\r\n        return misc.json;\r\n    assert(isFunction(nameOrFunction), '`outputEscape` need to be of type string or function');\r\n    return nameOrFunction;\r\n}\r\nfunction normalizeDirectoryList(value) {\r\n    let list = [];\r\n    if (isArray(value))\r\n        list = value;\r\n    if (isString(value))\r\n        list = [value];\r\n    return list;\r\n}\n\nfunction whiteSpaceCtrl(tokens, options) {\r\n    let inRaw = false;\r\n    for (let i = 0; i < tokens.length; i++) {\r\n        const token = tokens[i];\r\n        if (!isDelimitedToken(token))\r\n            continue;\r\n        if (!inRaw && token.trimLeft) {\r\n            trimLeft(tokens[i - 1], options.greedy);\r\n        }\r\n        if (isTagToken(token)) {\r\n            if (token.name === 'raw')\r\n                inRaw = true;\r\n            else if (token.name === 'endraw')\r\n                inRaw = false;\r\n        }\r\n        if (!inRaw && token.trimRight) {\r\n            trimRight(tokens[i + 1], options.greedy);\r\n        }\r\n    }\r\n}\r\nfunction trimLeft(token, greedy) {\r\n    if (!token || !isHTMLToken(token))\r\n        return;\r\n    const mask = greedy ? BLANK : INLINE_BLANK;\r\n    while (TYPES[token.input.charCodeAt(token.end - 1 - token.trimRight)] & mask)\r\n        token.trimRight++;\r\n}\r\nfunction trimRight(token, greedy) {\r\n    if (!token || !isHTMLToken(token))\r\n        return;\r\n    const mask = greedy ? BLANK : INLINE_BLANK;\r\n    while (TYPES[token.input.charCodeAt(token.begin + token.trimLeft)] & mask)\r\n        token.trimLeft++;\r\n    if (token.input.charAt(token.begin + token.trimLeft) === '\\n')\r\n        token.trimLeft++;\r\n}\n\nclass Tokenizer {\r\n    constructor(input, operators = defaultOptions.operators, file, range) {\r\n        this.input = input;\r\n        this.file = file;\r\n        this.rawBeginAt = -1;\r\n        this.p = range ? range[0] : 0;\r\n        this.N = range ? range[1] : input.length;\r\n        this.opTrie = createTrie(operators);\r\n        this.literalTrie = createTrie(literalValues);\r\n    }\r\n    readExpression() {\r\n        return new Expression(this.readExpressionTokens());\r\n    }\r\n    *readExpressionTokens() {\r\n        while (this.p < this.N) {\r\n            const operator = this.readOperator();\r\n            if (operator) {\r\n                yield operator;\r\n                continue;\r\n            }\r\n            const operand = this.readValue();\r\n            if (operand) {\r\n                yield operand;\r\n                continue;\r\n            }\r\n            return;\r\n        }\r\n    }\r\n    readOperator() {\r\n        this.skipBlank();\r\n        const end = this.matchTrie(this.opTrie);\r\n        if (end === -1)\r\n            return;\r\n        return new OperatorToken(this.input, this.p, (this.p = end), this.file);\r\n    }\r\n    matchTrie(trie) {\r\n        let node = trie;\r\n        let i = this.p;\r\n        let info;\r\n        while (node[this.input[i]] && i < this.N) {\r\n            node = node[this.input[i++]];\r\n            if (node['end'])\r\n                info = node;\r\n        }\r\n        if (!info)\r\n            return -1;\r\n        if (info['needBoundary'] && isWord(this.peek(i - this.p)))\r\n            return -1;\r\n        return i;\r\n    }\r\n    readFilteredValue() {\r\n        const begin = this.p;\r\n        const initial = this.readExpression();\r\n        this.assert(initial.valid(), `invalid value expression: ${this.snapshot()}`);\r\n        const filters = this.readFilters();\r\n        return new FilteredValueToken(initial, filters, this.input, begin, this.p, this.file);\r\n    }\r\n    readFilters() {\r\n        const filters = [];\r\n        while (true) {\r\n            const filter = this.readFilter();\r\n            if (!filter)\r\n                return filters;\r\n            filters.push(filter);\r\n        }\r\n    }\r\n    readFilter() {\r\n        this.skipBlank();\r\n        if (this.end())\r\n            return null;\r\n        this.assert(this.read() === '|', `expected \"|\" before filter`);\r\n        const name = this.readIdentifier();\r\n        if (!name.size()) {\r\n            this.assert(this.end(), `expected filter name`);\r\n            return null;\r\n        }\r\n        const args = [];\r\n        this.skipBlank();\r\n        if (this.peek() === ':') {\r\n            do {\r\n                ++this.p;\r\n                const arg = this.readFilterArg();\r\n                arg && args.push(arg);\r\n                this.skipBlank();\r\n                this.assert(this.end() || this.peek() === ',' || this.peek() === '|', () => `unexpected character ${this.snapshot()}`);\r\n            } while (this.peek() === ',');\r\n        }\r\n        else if (this.peek() === '|' || this.end()) ;\r\n        else {\r\n            throw this.error('expected \":\" after filter name');\r\n        }\r\n        return new FilterToken(name.getText(), args, this.input, name.begin, this.p, this.file);\r\n    }\r\n    readFilterArg() {\r\n        const key = this.readValue();\r\n        if (!key)\r\n            return;\r\n        this.skipBlank();\r\n        if (this.peek() !== ':')\r\n            return key;\r\n        ++this.p;\r\n        const value = this.readValue();\r\n        return [key.getText(), value];\r\n    }\r\n    readTopLevelTokens(options = defaultOptions) {\r\n        const tokens = [];\r\n        while (this.p < this.N) {\r\n            const token = this.readTopLevelToken(options);\r\n            tokens.push(token);\r\n        }\r\n        whiteSpaceCtrl(tokens, options);\r\n        return tokens;\r\n    }\r\n    readTopLevelToken(options) {\r\n        const { tagDelimiterLeft, outputDelimiterLeft } = options;\r\n        if (this.rawBeginAt > -1)\r\n            return this.readEndrawOrRawContent(options);\r\n        if (this.match(tagDelimiterLeft))\r\n            return this.readTagToken(options);\r\n        if (this.match(outputDelimiterLeft))\r\n            return this.readOutputToken(options);\r\n        return this.readHTMLToken([tagDelimiterLeft, outputDelimiterLeft]);\r\n    }\r\n    readHTMLToken(stopStrings) {\r\n        const begin = this.p;\r\n        while (this.p < this.N) {\r\n            if (stopStrings.some(str => this.match(str)))\r\n                break;\r\n            ++this.p;\r\n        }\r\n        return new HTMLToken(this.input, begin, this.p, this.file);\r\n    }\r\n    readTagToken(options) {\r\n        const { file, input } = this;\r\n        const begin = this.p;\r\n        if (this.readToDelimiter(options.tagDelimiterRight) === -1) {\r\n            throw this.error(`tag ${this.snapshot(begin)} not closed`, begin);\r\n        }\r\n        const token = new TagToken(input, begin, this.p, options, file);\r\n        if (token.name === 'raw')\r\n            this.rawBeginAt = begin;\r\n        return token;\r\n    }\r\n    readToDelimiter(delimiter, respectQuoted = false) {\r\n        this.skipBlank();\r\n        while (this.p < this.N) {\r\n            if (respectQuoted && (this.peekType() & QUOTE)) {\r\n                this.readQuoted();\r\n                continue;\r\n            }\r\n            ++this.p;\r\n            if (this.rmatch(delimiter))\r\n                return this.p;\r\n        }\r\n        return -1;\r\n    }\r\n    readOutputToken(options = defaultOptions) {\r\n        const { file, input } = this;\r\n        const { outputDelimiterRight } = options;\r\n        const begin = this.p;\r\n        if (this.readToDelimiter(outputDelimiterRight, true) === -1) {\r\n            throw this.error(`output ${this.snapshot(begin)} not closed`, begin);\r\n        }\r\n        return new OutputToken(input, begin, this.p, options, file);\r\n    }\r\n    readEndrawOrRawContent(options) {\r\n        const { tagDelimiterLeft, tagDelimiterRight } = options;\r\n        const begin = this.p;\r\n        let leftPos = this.readTo(tagDelimiterLeft) - tagDelimiterLeft.length;\r\n        while (this.p < this.N) {\r\n            if (this.readIdentifier().getText() !== 'endraw') {\r\n                leftPos = this.readTo(tagDelimiterLeft) - tagDelimiterLeft.length;\r\n                continue;\r\n            }\r\n            while (this.p <= this.N) {\r\n                if (this.rmatch(tagDelimiterRight)) {\r\n                    const end = this.p;\r\n                    if (begin === leftPos) {\r\n                        this.rawBeginAt = -1;\r\n                        return new TagToken(this.input, begin, end, options, this.file);\r\n                    }\r\n                    else {\r\n                        this.p = leftPos;\r\n                        return new HTMLToken(this.input, begin, leftPos, this.file);\r\n                    }\r\n                }\r\n                if (this.rmatch(tagDelimiterLeft))\r\n                    break;\r\n                this.p++;\r\n            }\r\n        }\r\n        throw this.error(`raw ${this.snapshot(this.rawBeginAt)} not closed`, begin);\r\n    }\r\n    readLiquidTagTokens(options = defaultOptions) {\r\n        const tokens = [];\r\n        while (this.p < this.N) {\r\n            const token = this.readLiquidTagToken(options);\r\n            token && tokens.push(token);\r\n        }\r\n        return tokens;\r\n    }\r\n    readLiquidTagToken(options) {\r\n        this.skipBlank();\r\n        if (this.end())\r\n            return;\r\n        const begin = this.p;\r\n        this.readToDelimiter('\\n');\r\n        const end = this.p;\r\n        return new LiquidTagToken(this.input, begin, end, options, this.file);\r\n    }\r\n    error(msg, pos = this.p) {\r\n        return new TokenizationError(msg, new IdentifierToken(this.input, pos, this.N, this.file));\r\n    }\r\n    assert(pred, msg, pos) {\r\n        if (!pred)\r\n            throw this.error(typeof msg === 'function' ? msg() : msg, pos);\r\n    }\r\n    snapshot(begin = this.p) {\r\n        return JSON.stringify(ellipsis(this.input.slice(begin, this.N), 32));\r\n    }\r\n    /**\r\n     * @deprecated use #readIdentifier instead\r\n     */\r\n    readWord() {\r\n        return this.readIdentifier();\r\n    }\r\n    readIdentifier() {\r\n        this.skipBlank();\r\n        const begin = this.p;\r\n        while (!this.end() && isWord(this.peek()))\r\n            ++this.p;\r\n        return new IdentifierToken(this.input, begin, this.p, this.file);\r\n    }\r\n    readNonEmptyIdentifier() {\r\n        const id = this.readIdentifier();\r\n        return id.size() ? id : undefined;\r\n    }\r\n    readTagName() {\r\n        this.skipBlank();\r\n        // Handle inline comment tags\r\n        if (this.input[this.p] === '#')\r\n            return this.input.slice(this.p, ++this.p);\r\n        return this.readIdentifier().getText();\r\n    }\r\n    readHashes(jekyllStyle) {\r\n        const hashes = [];\r\n        while (true) {\r\n            const hash = this.readHash(jekyllStyle);\r\n            if (!hash)\r\n                return hashes;\r\n            hashes.push(hash);\r\n        }\r\n    }\r\n    readHash(jekyllStyle) {\r\n        this.skipBlank();\r\n        if (this.peek() === ',')\r\n            ++this.p;\r\n        const begin = this.p;\r\n        const name = this.readNonEmptyIdentifier();\r\n        if (!name)\r\n            return;\r\n        let value;\r\n        this.skipBlank();\r\n        const sep = isString(jekyllStyle) ? jekyllStyle : (jekyllStyle ? '=' : ':');\r\n        if (this.peek() === sep) {\r\n            ++this.p;\r\n            value = this.readValue();\r\n        }\r\n        return new HashToken(this.input, begin, this.p, name, value, this.file);\r\n    }\r\n    remaining() {\r\n        return this.input.slice(this.p, this.N);\r\n    }\r\n    advance(step = 1) {\r\n        this.p += step;\r\n    }\r\n    end() {\r\n        return this.p >= this.N;\r\n    }\r\n    read() {\r\n        return this.input[this.p++];\r\n    }\r\n    readTo(end) {\r\n        while (this.p < this.N) {\r\n            ++this.p;\r\n            if (this.rmatch(end))\r\n                return this.p;\r\n        }\r\n        return -1;\r\n    }\r\n    readValue() {\r\n        this.skipBlank();\r\n        const begin = this.p;\r\n        const variable = this.readLiteral() || this.readQuoted() || this.readRange() || this.readNumber();\r\n        const props = this.readProperties(!variable);\r\n        if (!props.length)\r\n            return variable;\r\n        return new PropertyAccessToken(variable, props, this.input, begin, this.p);\r\n    }\r\n    readScopeValue() {\r\n        this.skipBlank();\r\n        const begin = this.p;\r\n        const props = this.readProperties();\r\n        if (!props.length)\r\n            return undefined;\r\n        return new PropertyAccessToken(undefined, props, this.input, begin, this.p);\r\n    }\r\n    readProperties(isBegin = true) {\r\n        const props = [];\r\n        while (true) {\r\n            if (this.peek() === '[') {\r\n                this.p++;\r\n                const prop = this.readValue() || new IdentifierToken(this.input, this.p, this.p, this.file);\r\n                this.assert(this.readTo(']') !== -1, '[ not closed');\r\n                props.push(prop);\r\n                continue;\r\n            }\r\n            if (isBegin && !props.length) {\r\n                const prop = this.readNonEmptyIdentifier();\r\n                if (prop) {\r\n                    props.push(prop);\r\n                    continue;\r\n                }\r\n            }\r\n            if (this.peek() === '.' && this.peek(1) !== '.') { // skip range syntax\r\n                this.p++;\r\n                const prop = this.readNonEmptyIdentifier();\r\n                if (!prop)\r\n                    break;\r\n                props.push(prop);\r\n                continue;\r\n            }\r\n            break;\r\n        }\r\n        return props;\r\n    }\r\n    readNumber() {\r\n        this.skipBlank();\r\n        let decimalFound = false;\r\n        let digitFound = false;\r\n        let n = 0;\r\n        if (this.peekType() & SIGN)\r\n            n++;\r\n        while (this.p + n <= this.N) {\r\n            if (this.peekType(n) & NUMBER) {\r\n                digitFound = true;\r\n                n++;\r\n            }\r\n            else if (this.peek(n) === '.' && this.peek(n + 1) !== '.') {\r\n                if (decimalFound || !digitFound)\r\n                    return;\r\n                decimalFound = true;\r\n                n++;\r\n            }\r\n            else\r\n                break;\r\n        }\r\n        if (digitFound && !isWord(this.peek(n))) {\r\n            const num = new NumberToken(this.input, this.p, this.p + n, this.file);\r\n            this.advance(n);\r\n            return num;\r\n        }\r\n    }\r\n    readLiteral() {\r\n        this.skipBlank();\r\n        const end = this.matchTrie(this.literalTrie);\r\n        if (end === -1)\r\n            return;\r\n        const literal = new LiteralToken(this.input, this.p, end, this.file);\r\n        this.p = end;\r\n        return literal;\r\n    }\r\n    readRange() {\r\n        this.skipBlank();\r\n        const begin = this.p;\r\n        if (this.peek() !== '(')\r\n            return;\r\n        ++this.p;\r\n        const lhs = this.readValueOrThrow();\r\n        this.skipBlank();\r\n        this.assert(this.read() === '.' && this.read() === '.', 'invalid range syntax');\r\n        const rhs = this.readValueOrThrow();\r\n        this.skipBlank();\r\n        this.assert(this.read() === ')', 'invalid range syntax');\r\n        return new RangeToken(this.input, begin, this.p, lhs, rhs, this.file);\r\n    }\r\n    readValueOrThrow() {\r\n        const value = this.readValue();\r\n        this.assert(value, () => `unexpected token ${this.snapshot()}, value expected`);\r\n        return value;\r\n    }\r\n    readQuoted() {\r\n        this.skipBlank();\r\n        const begin = this.p;\r\n        if (!(this.peekType() & QUOTE))\r\n            return;\r\n        ++this.p;\r\n        let escaped = false;\r\n        while (this.p < this.N) {\r\n            ++this.p;\r\n            if (this.input[this.p - 1] === this.input[begin] && !escaped)\r\n                break;\r\n            if (escaped)\r\n                escaped = false;\r\n            else if (this.input[this.p - 1] === '\\\\')\r\n                escaped = true;\r\n        }\r\n        return new QuotedToken(this.input, begin, this.p, this.file);\r\n    }\r\n    *readFileNameTemplate(options) {\r\n        const { outputDelimiterLeft } = options;\r\n        const htmlStopStrings = [',', ' ', outputDelimiterLeft];\r\n        const htmlStopStringSet = new Set(htmlStopStrings);\r\n        // break on ',' and ' ', outputDelimiterLeft only stops HTML token\r\n        while (this.p < this.N && !htmlStopStringSet.has(this.peek())) {\r\n            yield this.match(outputDelimiterLeft)\r\n                ? this.readOutputToken(options)\r\n                : this.readHTMLToken(htmlStopStrings);\r\n        }\r\n    }\r\n    match(word) {\r\n        for (let i = 0; i < word.length; i++) {\r\n            if (word[i] !== this.input[this.p + i])\r\n                return false;\r\n        }\r\n        return true;\r\n    }\r\n    rmatch(pattern) {\r\n        for (let i = 0; i < pattern.length; i++) {\r\n            if (pattern[pattern.length - 1 - i] !== this.input[this.p - 1 - i])\r\n                return false;\r\n        }\r\n        return true;\r\n    }\r\n    peekType(n = 0) {\r\n        return this.p + n >= this.N ? 0 : TYPES[this.input.charCodeAt(this.p + n)];\r\n    }\r\n    peek(n = 0) {\r\n        return this.p + n >= this.N ? '' : this.input[this.p + n];\r\n    }\r\n    skipBlank() {\r\n        while (this.peekType() & BLANK)\r\n            ++this.p;\r\n    }\r\n}\n\nclass ParseStream {\r\n    constructor(tokens, parseToken) {\r\n        this.handlers = {};\r\n        this.stopRequested = false;\r\n        this.tokens = tokens;\r\n        this.parseToken = parseToken;\r\n    }\r\n    on(name, cb) {\r\n        this.handlers[name] = cb;\r\n        return this;\r\n    }\r\n    trigger(event, arg) {\r\n        const h = this.handlers[event];\r\n        return h ? (h.call(this, arg), true) : false;\r\n    }\r\n    start() {\r\n        this.trigger('start');\r\n        let token;\r\n        while (!this.stopRequested && (token = this.tokens.shift())) {\r\n            if (this.trigger('token', token))\r\n                continue;\r\n            if (isTagToken(token) && this.trigger(`tag:${token.name}`, token)) {\r\n                continue;\r\n            }\r\n            const template = this.parseToken(token, this.tokens);\r\n            this.trigger('template', template);\r\n        }\r\n        if (!this.stopRequested)\r\n            this.trigger('end');\r\n        return this;\r\n    }\r\n    stop() {\r\n        this.stopRequested = true;\r\n        return this;\r\n    }\r\n}\n\nclass TemplateImpl {\r\n    constructor(token) {\r\n        this.token = token;\r\n    }\r\n}\n\nclass Tag extends TemplateImpl {\r\n    constructor(token, remainTokens, liquid) {\r\n        super(token);\r\n        this.name = token.name;\r\n        this.liquid = liquid;\r\n        this.tokenizer = token.tokenizer;\r\n    }\r\n}\n\n/**\r\n * Key-Value Pairs Representing Tag Arguments\r\n * Example:\r\n *    For the markup `, foo:'bar', coo:2 reversed %}`,\r\n *    hash['foo'] === 'bar'\r\n *    hash['coo'] === 2\r\n *    hash['reversed'] === undefined\r\n */\r\nclass Hash {\r\n    constructor(input, jekyllStyle) {\r\n        this.hash = {};\r\n        const tokenizer = input instanceof Tokenizer ? input : new Tokenizer(input, {});\r\n        for (const hash of tokenizer.readHashes(jekyllStyle)) {\r\n            this.hash[hash.name.content] = hash.value;\r\n        }\r\n    }\r\n    *render(ctx) {\r\n        const hash = {};\r\n        for (const key of Object.keys(this.hash)) {\r\n            hash[key] = this.hash[key] === undefined ? true : yield evalToken(this.hash[key], ctx);\r\n        }\r\n        return hash;\r\n    }\r\n}\n\nfunction createTagClass(options) {\r\n    return class extends Tag {\r\n        constructor(token, tokens, liquid) {\r\n            super(token, tokens, liquid);\r\n            if (isFunction(options.parse)) {\r\n                options.parse.call(this, token, tokens);\r\n            }\r\n        }\r\n        *render(ctx, emitter) {\r\n            const hash = (yield new Hash(this.token.args, ctx.opts.keyValueSeparator).render(ctx));\r\n            return yield options.render.call(this, ctx, emitter, hash);\r\n        }\r\n    };\r\n}\n\nfunction isKeyValuePair(arr) {\r\n    return isArray(arr);\r\n}\n\nclass Filter {\r\n    constructor(token, options, liquid) {\r\n        this.token = token;\r\n        this.name = token.name;\r\n        this.handler = isFunction(options)\r\n            ? options\r\n            : (isFunction(options === null || options === void 0 ? void 0 : options.handler) ? options.handler : identify);\r\n        this.raw = !isFunction(options) && !!(options === null || options === void 0 ? void 0 : options.raw);\r\n        this.args = token.args;\r\n        this.liquid = liquid;\r\n    }\r\n    *render(value, context) {\r\n        const argv = [];\r\n        for (const arg of this.args) {\r\n            if (isKeyValuePair(arg))\r\n                argv.push([arg[0], yield evalToken(arg[1], context)]);\r\n            else\r\n                argv.push(yield evalToken(arg, context));\r\n        }\r\n        return yield this.handler.apply({ context, token: this.token, liquid: this.liquid }, [value, ...argv]);\r\n    }\r\n}\n\nclass Value {\r\n    /**\r\n     * @param str the value to be valuated, eg.: \"foobar\" | truncate: 3\r\n     */\r\n    constructor(input, liquid) {\r\n        this.filters = [];\r\n        const token = typeof input === 'string'\r\n            ? new Tokenizer(input, liquid.options.operators).readFilteredValue()\r\n            : input;\r\n        this.initial = token.initial;\r\n        this.filters = token.filters.map(token => new Filter(token, this.getFilter(liquid, token.name), liquid));\r\n    }\r\n    *value(ctx, lenient) {\r\n        lenient = lenient || (ctx.opts.lenientIf && this.filters.length > 0 && this.filters[0].name === 'default');\r\n        let val = yield this.initial.evaluate(ctx, lenient);\r\n        for (const filter of this.filters) {\r\n            val = yield filter.render(val, ctx);\r\n        }\r\n        return val;\r\n    }\r\n    getFilter(liquid, name) {\r\n        const impl = liquid.filters[name];\r\n        assert(impl || !liquid.options.strictFilters, () => `undefined filter: ${name}`);\r\n        return impl;\r\n    }\r\n}\n\nclass Output extends TemplateImpl {\r\n    constructor(token, liquid) {\r\n        var _a;\r\n        super(token);\r\n        const tokenizer = new Tokenizer(token.input, liquid.options.operators, token.file, token.contentRange);\r\n        this.value = new Value(tokenizer.readFilteredValue(), liquid);\r\n        const filters = this.value.filters;\r\n        const outputEscape = liquid.options.outputEscape;\r\n        if (!((_a = filters[filters.length - 1]) === null || _a === void 0 ? void 0 : _a.raw) && outputEscape) {\r\n            const token = new FilterToken(toString.call(outputEscape), [], '', 0, 0);\r\n            filters.push(new Filter(token, outputEscape, liquid));\r\n        }\r\n    }\r\n    *render(ctx, emitter) {\r\n        const val = yield this.value.value(ctx, false);\r\n        emitter.write(val);\r\n    }\r\n    *arguments() {\r\n        yield this.value;\r\n    }\r\n}\n\nclass HTML extends TemplateImpl {\r\n    constructor(token) {\r\n        super(token);\r\n        this.str = token.getContent();\r\n    }\r\n    *render(ctx, emitter) {\r\n        emitter.write(this.str);\r\n    }\r\n}\n\n/**\r\n * A variable's segments and location, which can be coerced to a string.\r\n */\r\nclass Variable {\r\n    constructor(segments, location) {\r\n        this.segments = segments;\r\n        this.location = location;\r\n    }\r\n    toString() {\r\n        return segmentsString(this.segments, true);\r\n    }\r\n    /** Return this variable's segments as an array, possibly with nested arrays for nested paths. */\r\n    toArray() {\r\n        function* _visit(...segments) {\r\n            for (const segment of segments) {\r\n                if (segment instanceof Variable) {\r\n                    yield Array.from(_visit(...segment.segments));\r\n                }\r\n                else {\r\n                    yield segment;\r\n                }\r\n            }\r\n        }\r\n        return Array.from(_visit(...this.segments));\r\n    }\r\n}\r\n/**\r\n * Group variables by the string representation of their root segment.\r\n */\r\nclass VariableMap {\r\n    constructor() {\r\n        this.map = new Map();\r\n    }\r\n    get(key) {\r\n        const k = segmentsString([key.segments[0]]);\r\n        if (!this.map.has(k)) {\r\n            this.map.set(k, []);\r\n        }\r\n        return this.map.get(k);\r\n    }\r\n    has(key) {\r\n        return this.map.has(segmentsString([key.segments[0]]));\r\n    }\r\n    push(variable) {\r\n        this.get(variable).push(variable);\r\n    }\r\n    asObject() {\r\n        return Object.fromEntries(this.map);\r\n    }\r\n}\r\nconst defaultStaticAnalysisOptions = {\r\n    partials: true\r\n};\r\nfunction* _analyze(templates, partials, sync) {\r\n    const variables = new VariableMap();\r\n    const globals = new VariableMap();\r\n    const locals = new VariableMap();\r\n    const rootScope = new DummyScope(new Set());\r\n    // Names of partial templates that we've already analyzed.\r\n    const seen = new Set();\r\n    function updateVariables(variable, scope) {\r\n        variables.push(variable);\r\n        const aliased = scope.alias(variable);\r\n        if (aliased !== undefined) {\r\n            const root = aliased.segments[0];\r\n            // TODO: What if a a template renders a rendered template? Do we need scope.parent?\r\n            if (isString(root) && !rootScope.has(root)) {\r\n                globals.push(aliased);\r\n            }\r\n        }\r\n        else {\r\n            const root = variable.segments[0];\r\n            if (isString(root) && !scope.has(root)) {\r\n                globals.push(variable);\r\n            }\r\n        }\r\n        // Recurse for nested Variables\r\n        for (const segment of variable.segments) {\r\n            if (segment instanceof Variable) {\r\n                updateVariables(segment, scope);\r\n            }\r\n        }\r\n    }\r\n    function* visit(template, scope) {\r\n        if (template.arguments) {\r\n            for (const arg of template.arguments()) {\r\n                for (const variable of extractVariables(arg)) {\r\n                    updateVariables(variable, scope);\r\n                }\r\n            }\r\n        }\r\n        if (template.localScope) {\r\n            for (const ident of template.localScope()) {\r\n                scope.add(ident.content);\r\n                scope.deleteAlias(ident.content);\r\n                const [row, col] = ident.getPosition();\r\n                locals.push(new Variable([ident.content], { row, col, file: ident.file }));\r\n            }\r\n        }\r\n        if (template.children) {\r\n            if (template.partialScope) {\r\n                const partial = template.partialScope();\r\n                if (partial === undefined) {\r\n                    // Layouts, for example, can have children that are not partials.\r\n                    for (const child of (yield template.children(partials, sync))) {\r\n                        yield visit(child, scope);\r\n                    }\r\n                    return;\r\n                }\r\n                if (seen.has(partial.name))\r\n                    return;\r\n                const partialScopeNames = new Set();\r\n                const partialScope = partial.isolated\r\n                    ? new DummyScope(partialScopeNames)\r\n                    : scope.push(partialScopeNames);\r\n                for (const name of partial.scope) {\r\n                    if (isString(name)) {\r\n                        partialScopeNames.add(name);\r\n                    }\r\n                    else {\r\n                        const [alias, argument] = name;\r\n                        partialScopeNames.add(alias);\r\n                        const variables = Array.from(extractVariables(argument));\r\n                        if (variables.length) {\r\n                            partialScope.setAlias(alias, variables[0].segments);\r\n                        }\r\n                    }\r\n                }\r\n                for (const child of (yield template.children(partials, sync))) {\r\n                    yield visit(child, partialScope);\r\n                    seen.add(partial.name);\r\n                }\r\n                partialScope.pop();\r\n            }\r\n            else {\r\n                if (template.blockScope) {\r\n                    scope.push(new Set(template.blockScope()));\r\n                }\r\n                for (const child of (yield template.children(partials, sync))) {\r\n                    yield visit(child, scope);\r\n                }\r\n                if (template.blockScope) {\r\n                    scope.pop();\r\n                }\r\n            }\r\n        }\r\n    }\r\n    for (const template of templates) {\r\n        yield visit(template, rootScope);\r\n    }\r\n    return {\r\n        variables: variables.asObject(),\r\n        globals: globals.asObject(),\r\n        locals: locals.asObject()\r\n    };\r\n}\r\n/**\r\n * Statically analyze a template and report variable usage.\r\n */\r\nfunction analyze(template, options = {}) {\r\n    const opts = Object.assign(Object.assign({}, defaultStaticAnalysisOptions), options);\r\n    return toPromise(_analyze(template, opts.partials, false));\r\n}\r\n/**\r\n * Statically analyze a template and report variable usage.\r\n */\r\nfunction analyzeSync(template, options = {}) {\r\n    const opts = Object.assign(Object.assign({}, defaultStaticAnalysisOptions), options);\r\n    return toValueSync(_analyze(template, opts.partials, true));\r\n}\r\n/**\r\n * A stack to manage scopes while traversing templates during static analysis.\r\n */\r\nclass DummyScope {\r\n    constructor(globals) {\r\n        this.stack = [{ names: globals, aliases: new Map() }];\r\n    }\r\n    /** Return true if `name` is in scope.  */\r\n    has(name) {\r\n        for (const scope of this.stack) {\r\n            if (scope.names.has(name)) {\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n    push(scope) {\r\n        this.stack.push({ names: scope, aliases: new Map() });\r\n        return this;\r\n    }\r\n    pop() {\r\n        var _a;\r\n        return (_a = this.stack.pop()) === null || _a === void 0 ? void 0 : _a.names;\r\n    }\r\n    // Add a name to the template scope.\r\n    add(name) {\r\n        this.stack[0].names.add(name);\r\n    }\r\n    /** Return the variable that `variable` aliases, or `variable` if it doesn't alias anything. */\r\n    alias(variable) {\r\n        const root = variable.segments[0];\r\n        if (!isString(root))\r\n            return undefined;\r\n        const alias = this.getAlias(root);\r\n        if (alias === undefined)\r\n            return undefined;\r\n        return new Variable([...alias, ...variable.segments.slice(1)], variable.location);\r\n    }\r\n    // TODO: `from` could be a path with multiple segments, like `include.x`.\r\n    setAlias(from, to) {\r\n        this.stack[this.stack.length - 1].aliases.set(from, to);\r\n    }\r\n    deleteAlias(name) {\r\n        this.stack[this.stack.length - 1].aliases.delete(name);\r\n    }\r\n    getAlias(name) {\r\n        for (const scope of this.stack) {\r\n            if (scope.aliases.has(name)) {\r\n                return scope.aliases.get(name);\r\n            }\r\n            // If a scope has defined `name`, then it masks aliases in parent scopes.\r\n            if (scope.names.has(name)) {\r\n                return undefined;\r\n            }\r\n        }\r\n        return undefined;\r\n    }\r\n}\r\nfunction* extractVariables(value) {\r\n    if (isValueToken(value)) {\r\n        yield* extractValueTokenVariables(value);\r\n    }\r\n    else if (value instanceof Value) {\r\n        yield* extractFilteredValueVariables(value);\r\n    }\r\n}\r\nfunction* extractFilteredValueVariables(value) {\r\n    for (const token of value.initial.postfix) {\r\n        if (isValueToken(token)) {\r\n            yield* extractValueTokenVariables(token);\r\n        }\r\n    }\r\n    for (const filter of value.filters) {\r\n        for (const arg of filter.args) {\r\n            if (isKeyValuePair(arg) && arg[1]) {\r\n                yield* extractValueTokenVariables(arg[1]);\r\n            }\r\n            else if (isValueToken(arg)) {\r\n                yield* extractValueTokenVariables(arg);\r\n            }\r\n        }\r\n    }\r\n}\r\nfunction* extractValueTokenVariables(token) {\r\n    if (isRangeToken(token)) {\r\n        yield* extractValueTokenVariables(token.lhs);\r\n        yield* extractValueTokenVariables(token.rhs);\r\n    }\r\n    else if (isPropertyAccessToken(token)) {\r\n        yield extractPropertyAccessVariable(token);\r\n    }\r\n}\r\nfunction extractPropertyAccessVariable(token) {\r\n    const segments = [];\r\n    // token is not guaranteed to have `file` set. We'll try to get it from a prop if not.\r\n    let file = token.file;\r\n    // Here we're flattening the first segment of a path if it is a nested path.\r\n    const root = token.props[0];\r\n    file = file || root.file;\r\n    if (isQuotedToken(root) || isNumberToken(root) || isWordToken(root)) {\r\n        segments.push(root.content);\r\n    }\r\n    else if (isPropertyAccessToken(root)) {\r\n        // Flatten paths that start with a nested path.\r\n        segments.push(...extractPropertyAccessVariable(root).segments);\r\n    }\r\n    for (const prop of token.props.slice(1)) {\r\n        file = file || prop.file;\r\n        if (isQuotedToken(prop) || isNumberToken(prop) || isWordToken(prop)) {\r\n            segments.push(prop.content);\r\n        }\r\n        else if (isPropertyAccessToken(prop)) {\r\n            segments.push(extractPropertyAccessVariable(prop));\r\n        }\r\n    }\r\n    const [row, col] = token.getPosition();\r\n    return new Variable(segments, {\r\n        row,\r\n        col,\r\n        file\r\n    });\r\n}\r\n// This is used to detect segments that can be represented with dot notation\r\n// when creating a string representation of VariableSegments.\r\nconst RE_PROPERTY = /^[\\u0080-\\uFFFFa-zA-Z_][\\u0080-\\uFFFFa-zA-Z0-9_-]*$/;\r\n/**\r\n * Return a string representation of segments using dot notation where possible.\r\n * @param segments - The property names and array indices that make up a path to a variable.\r\n * @param bracketedRoot - If false (the default), don't surround the root segment with square brackets.\r\n */\r\nfunction segmentsString(segments, bracketedRoot = false) {\r\n    const buf = [];\r\n    const root = segments[0];\r\n    if (isString(root)) {\r\n        if (!bracketedRoot || root.match(RE_PROPERTY)) {\r\n            buf.push(`${root}`);\r\n        }\r\n        else {\r\n            buf.push(`['${root}']`);\r\n        }\r\n    }\r\n    for (const segment of segments.slice(1)) {\r\n        if (segment instanceof Variable) {\r\n            buf.push(`[${segmentsString(segment.segments)}]`);\r\n        }\r\n        else if (isString(segment)) {\r\n            if (segment.match(RE_PROPERTY)) {\r\n                buf.push(`.${segment}`);\r\n            }\r\n            else {\r\n                buf.push(`['${segment}']`);\r\n            }\r\n        }\r\n        else {\r\n            buf.push(`[${segment}]`);\r\n        }\r\n    }\r\n    return buf.join('');\r\n}\n\nvar LookupType;\r\n(function (LookupType) {\r\n    LookupType[\"Partials\"] = \"partials\";\r\n    LookupType[\"Layouts\"] = \"layouts\";\r\n    LookupType[\"Root\"] = \"root\";\r\n})(LookupType || (LookupType = {}));\r\nclass Loader {\r\n    constructor(options) {\r\n        this.options = options;\r\n        if (options.relativeReference) {\r\n            const sep = options.fs.sep;\r\n            assert(sep, '`fs.sep` is required for relative reference');\r\n            const rRelativePath = new RegExp(['.' + sep, '..' + sep, './', '../'].map(prefix => escapeRegex(prefix)).join('|'));\r\n            this.shouldLoadRelative = (referencedFile) => rRelativePath.test(referencedFile);\r\n        }\r\n        else {\r\n            this.shouldLoadRelative = (_referencedFile) => false;\r\n        }\r\n        this.contains = this.options.fs.contains || (() => true);\r\n    }\r\n    *lookup(file, type, sync, currentFile) {\r\n        const { fs } = this.options;\r\n        const dirs = this.options[type];\r\n        for (const filepath of this.candidates(file, dirs, currentFile, type !== LookupType.Root)) {\r\n            if (sync ? fs.existsSync(filepath) : yield fs.exists(filepath))\r\n                return filepath;\r\n        }\r\n        throw this.lookupError(file, dirs);\r\n    }\r\n    *candidates(file, dirs, currentFile, enforceRoot) {\r\n        const { fs, extname } = this.options;\r\n        if (this.shouldLoadRelative(file) && currentFile) {\r\n            const referenced = fs.resolve(this.dirname(currentFile), file, extname);\r\n            for (const dir of dirs) {\r\n                if (!enforceRoot || this.contains(dir, referenced)) {\r\n                    // the relatively referenced file is within one of root dirs\r\n                    yield referenced;\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        for (const dir of dirs) {\r\n            const referenced = fs.resolve(dir, file, extname);\r\n            if (!enforceRoot || this.contains(dir, referenced)) {\r\n                yield referenced;\r\n            }\r\n        }\r\n        if (fs.fallback !== undefined) {\r\n            const filepath = fs.fallback(file);\r\n            if (filepath !== undefined)\r\n                yield filepath;\r\n        }\r\n    }\r\n    dirname(path) {\r\n        const fs = this.options.fs;\r\n        assert(fs.dirname, '`fs.dirname` is required for relative reference');\r\n        return fs.dirname(path);\r\n    }\r\n    lookupError(file, roots) {\r\n        const err = new Error('ENOENT');\r\n        err.message = `ENOENT: Failed to lookup \"${file}\" in \"${roots}\"`;\r\n        err.code = 'ENOENT';\r\n        return err;\r\n    }\r\n}\n\nclass Parser {\r\n    constructor(liquid) {\r\n        this.liquid = liquid;\r\n        this.cache = this.liquid.options.cache;\r\n        this.fs = this.liquid.options.fs;\r\n        this.parseFile = this.cache ? this._parseFileCached : this._parseFile;\r\n        this.loader = new Loader(this.liquid.options);\r\n        this.parseLimit = new Limiter('parse length', liquid.options.parseLimit);\r\n    }\r\n    parse(html, filepath) {\r\n        html = String(html);\r\n        this.parseLimit.use(html.length);\r\n        const tokenizer = new Tokenizer(html, this.liquid.options.operators, filepath);\r\n        const tokens = tokenizer.readTopLevelTokens(this.liquid.options);\r\n        return this.parseTokens(tokens);\r\n    }\r\n    parseTokens(tokens) {\r\n        let token;\r\n        const templates = [];\r\n        const errors = [];\r\n        while ((token = tokens.shift())) {\r\n            try {\r\n                templates.push(this.parseToken(token, tokens));\r\n            }\r\n            catch (err) {\r\n                if (this.liquid.options.catchAllErrors)\r\n                    errors.push(err);\r\n                else\r\n                    throw err;\r\n            }\r\n        }\r\n        if (errors.length)\r\n            throw new LiquidErrors(errors);\r\n        return templates;\r\n    }\r\n    parseToken(token, remainTokens) {\r\n        try {\r\n            if (isTagToken(token)) {\r\n                const TagClass = this.liquid.tags[token.name];\r\n                assert(TagClass, `tag \"${token.name}\" not found`);\r\n                return new TagClass(token, remainTokens, this.liquid, this);\r\n            }\r\n            if (isOutputToken(token)) {\r\n                return new Output(token, this.liquid);\r\n            }\r\n            return new HTML(token);\r\n        }\r\n        catch (e) {\r\n            if (LiquidError.is(e))\r\n                throw e;\r\n            throw new ParseError(e, token);\r\n        }\r\n    }\r\n    parseStream(tokens) {\r\n        return new ParseStream(tokens, (token, tokens) => this.parseToken(token, tokens));\r\n    }\r\n    *_parseFileCached(file, sync, type = LookupType.Root, currentFile) {\r\n        const cache = this.cache;\r\n        const key = this.loader.shouldLoadRelative(file) ? currentFile + ',' + file : type + ':' + file;\r\n        const tpls = yield cache.read(key);\r\n        if (tpls)\r\n            return tpls;\r\n        const task = this._parseFile(file, sync, type, currentFile);\r\n        // sync mode: exec the task and cache the result\r\n        // async mode: cache the task before exec\r\n        const taskOrTpl = sync ? yield task : toPromise(task);\r\n        cache.write(key, taskOrTpl);\r\n        // note: concurrent tasks will be reused, cache for failed task is removed until its end\r\n        try {\r\n            return yield taskOrTpl;\r\n        }\r\n        catch (err) {\r\n            cache.remove(key);\r\n            throw err;\r\n        }\r\n    }\r\n    *_parseFile(file, sync, type = LookupType.Root, currentFile) {\r\n        const filepath = yield this.loader.lookup(file, type, sync, currentFile);\r\n        return this.parse(sync ? this.fs.readFileSync(filepath) : yield this.fs.readFile(filepath), filepath);\r\n    }\r\n}\n\nvar TokenKind;\r\n(function (TokenKind) {\r\n    TokenKind[TokenKind[\"Number\"] = 1] = \"Number\";\r\n    TokenKind[TokenKind[\"Literal\"] = 2] = \"Literal\";\r\n    TokenKind[TokenKind[\"Tag\"] = 4] = \"Tag\";\r\n    TokenKind[TokenKind[\"Output\"] = 8] = \"Output\";\r\n    TokenKind[TokenKind[\"HTML\"] = 16] = \"HTML\";\r\n    TokenKind[TokenKind[\"Filter\"] = 32] = \"Filter\";\r\n    TokenKind[TokenKind[\"Hash\"] = 64] = \"Hash\";\r\n    TokenKind[TokenKind[\"PropertyAccess\"] = 128] = \"PropertyAccess\";\r\n    TokenKind[TokenKind[\"Word\"] = 256] = \"Word\";\r\n    TokenKind[TokenKind[\"Range\"] = 512] = \"Range\";\r\n    TokenKind[TokenKind[\"Quoted\"] = 1024] = \"Quoted\";\r\n    TokenKind[TokenKind[\"Operator\"] = 2048] = \"Operator\";\r\n    TokenKind[TokenKind[\"FilteredValue\"] = 4096] = \"FilteredValue\";\r\n    TokenKind[TokenKind[\"Delimited\"] = 12] = \"Delimited\";\r\n})(TokenKind || (TokenKind = {}));\n\nfunction isDelimitedToken(val) {\r\n    return !!(getKind(val) & TokenKind.Delimited);\r\n}\r\nfunction isOperatorToken(val) {\r\n    return getKind(val) === TokenKind.Operator;\r\n}\r\nfunction isHTMLToken(val) {\r\n    return getKind(val) === TokenKind.HTML;\r\n}\r\nfunction isOutputToken(val) {\r\n    return getKind(val) === TokenKind.Output;\r\n}\r\nfunction isTagToken(val) {\r\n    return getKind(val) === TokenKind.Tag;\r\n}\r\nfunction isQuotedToken(val) {\r\n    return getKind(val) === TokenKind.Quoted;\r\n}\r\nfunction isLiteralToken(val) {\r\n    return getKind(val) === TokenKind.Literal;\r\n}\r\nfunction isNumberToken(val) {\r\n    return getKind(val) === TokenKind.Number;\r\n}\r\nfunction isPropertyAccessToken(val) {\r\n    return getKind(val) === TokenKind.PropertyAccess;\r\n}\r\nfunction isWordToken(val) {\r\n    return getKind(val) === TokenKind.Word;\r\n}\r\nfunction isRangeToken(val) {\r\n    return getKind(val) === TokenKind.Range;\r\n}\r\nfunction isValueToken(val) {\r\n    // valueTokenBitMask = TokenKind.Number | TokenKind.Literal | TokenKind.Quoted | TokenKind.PropertyAccess | TokenKind.Range\r\n    return (getKind(val) & 1667) > 0;\r\n}\r\nfunction getKind(val) {\r\n    return val ? val.kind : -1;\r\n}\n\nvar typeGuards = /*#__PURE__*/Object.freeze({\n  __proto__: null,\n  isDelimitedToken: isDelimitedToken,\n  isOperatorToken: isOperatorToken,\n  isHTMLToken: isHTMLToken,\n  isOutputToken: isOutputToken,\n  isTagToken: isTagToken,\n  isQuotedToken: isQuotedToken,\n  isLiteralToken: isLiteralToken,\n  isNumberToken: isNumberToken,\n  isPropertyAccessToken: isPropertyAccessToken,\n  isWordToken: isWordToken,\n  isRangeToken: isRangeToken,\n  isValueToken: isValueToken\n});\n\nclass Context {\r\n    constructor(env = {}, opts = defaultOptions, renderOptions = {}, { memoryLimit, renderLimit } = {}) {\r\n        var _a, _b, _c, _d, _e;\r\n        /**\r\n         * insert a Context-level empty scope,\r\n         * for tags like `{% capture %}` `{% assign %}` to operate\r\n         */\r\n        this.scopes = [{}];\r\n        this.registers = {};\r\n        this.breakCalled = false;\r\n        this.continueCalled = false;\r\n        this.sync = !!renderOptions.sync;\r\n        this.opts = opts;\r\n        this.globals = (_a = renderOptions.globals) !== null && _a !== void 0 ? _a : opts.globals;\r\n        this.environments = isObject(env) ? env : Object(env);\r\n        this.strictVariables = (_b = renderOptions.strictVariables) !== null && _b !== void 0 ? _b : this.opts.strictVariables;\r\n        this.ownPropertyOnly = (_c = renderOptions.ownPropertyOnly) !== null && _c !== void 0 ? _c : opts.ownPropertyOnly;\r\n        this.memoryLimit = memoryLimit !== null && memoryLimit !== void 0 ? memoryLimit : new Limiter('memory alloc', (_d = renderOptions.memoryLimit) !== null && _d !== void 0 ? _d : opts.memoryLimit);\r\n        this.renderLimit = renderLimit !== null && renderLimit !== void 0 ? renderLimit : new Limiter('template render', getPerformance().now() + ((_e = renderOptions.renderLimit) !== null && _e !== void 0 ? _e : opts.renderLimit));\r\n    }\r\n    getRegister(key) {\r\n        return (this.registers[key] = this.registers[key] || {});\r\n    }\r\n    setRegister(key, value) {\r\n        return (this.registers[key] = value);\r\n    }\r\n    saveRegister(...keys) {\r\n        return keys.map(key => [key, this.getRegister(key)]);\r\n    }\r\n    restoreRegister(keyValues) {\r\n        return keyValues.forEach(([key, value]) => this.setRegister(key, value));\r\n    }\r\n    getAll() {\r\n        return [this.globals, this.environments, ...this.scopes]\r\n            .reduce((ctx, val) => __assign(ctx, val), {});\r\n    }\r\n    /**\r\n     * @deprecated use `_get()` or `getSync()` instead\r\n     */\r\n    get(paths) {\r\n        return this.getSync(paths);\r\n    }\r\n    getSync(paths) {\r\n        return toValueSync(this._get(paths));\r\n    }\r\n    *_get(paths) {\r\n        const scope = this.findScope(paths[0]); // first prop should always be a string\r\n        return yield this._getFromScope(scope, paths);\r\n    }\r\n    /**\r\n     * @deprecated use `_get()` instead\r\n     */\r\n    getFromScope(scope, paths) {\r\n        return toValueSync(this._getFromScope(scope, paths));\r\n    }\r\n    *_getFromScope(scope, paths, strictVariables = this.strictVariables) {\r\n        if (isString(paths))\r\n            paths = paths.split('.');\r\n        for (let i = 0; i < paths.length; i++) {\r\n            scope = yield this.readProperty(scope, paths[i]);\r\n            if (strictVariables && isUndefined(scope)) {\r\n                throw new InternalUndefinedVariableError(paths.slice(0, i + 1).join('.'));\r\n            }\r\n        }\r\n        return scope;\r\n    }\r\n    push(ctx) {\r\n        return this.scopes.push(ctx);\r\n    }\r\n    pop() {\r\n        return this.scopes.pop();\r\n    }\r\n    bottom() {\r\n        return this.scopes[0];\r\n    }\r\n    spawn(scope = {}) {\r\n        return new Context(scope, this.opts, {\r\n            sync: this.sync,\r\n            globals: this.globals,\r\n            strictVariables: this.strictVariables\r\n        }, {\r\n            renderLimit: this.renderLimit,\r\n            memoryLimit: this.memoryLimit\r\n        });\r\n    }\r\n    findScope(key) {\r\n        for (let i = this.scopes.length - 1; i >= 0; i--) {\r\n            const candidate = this.scopes[i];\r\n            if (key in candidate)\r\n                return candidate;\r\n        }\r\n        if (key in this.environments)\r\n            return this.environments;\r\n        return this.globals;\r\n    }\r\n    readProperty(obj, key) {\r\n        obj = toLiquid(obj);\r\n        key = toValue(key);\r\n        if (isNil(obj))\r\n            return obj;\r\n        if (isArray(obj) && key < 0)\r\n            return obj[obj.length + +key];\r\n        const value = readJSProperty(obj, key, this.ownPropertyOnly);\r\n        if (value === undefined && obj instanceof Drop)\r\n            return obj.liquidMethodMissing(key, this);\r\n        if (isFunction(value))\r\n            return value.call(obj);\r\n        if (key === 'size')\r\n            return readSize(obj);\r\n        else if (key === 'first')\r\n            return readFirst(obj);\r\n        else if (key === 'last')\r\n            return readLast(obj);\r\n        return value;\r\n    }\r\n}\r\nfunction readJSProperty(obj, key, ownPropertyOnly) {\r\n    if (ownPropertyOnly && !hasOwnProperty.call(obj, key) && !(obj instanceof Drop))\r\n        return undefined;\r\n    return obj[key];\r\n}\r\nfunction readFirst(obj) {\r\n    if (isArray(obj))\r\n        return obj[0];\r\n    return obj['first'];\r\n}\r\nfunction readLast(obj) {\r\n    if (isArray(obj))\r\n        return obj[obj.length - 1];\r\n    return obj['last'];\r\n}\r\nfunction readSize(obj) {\r\n    if (hasOwnProperty.call(obj, 'size') || obj['size'] !== undefined)\r\n        return obj['size'];\r\n    if (isArray(obj) || isString(obj))\r\n        return obj.length;\r\n    if (typeof obj === 'object')\r\n        return Object.keys(obj).length;\r\n}\n\nvar BlockMode;\r\n(function (BlockMode) {\r\n    /* store rendered html into blocks */\r\n    BlockMode[BlockMode[\"OUTPUT\"] = 0] = \"OUTPUT\";\r\n    /* output rendered html directly */\r\n    BlockMode[BlockMode[\"STORE\"] = 1] = \"STORE\";\r\n})(BlockMode || (BlockMode = {}));\n\nconst abs = argumentsToNumber(Math.abs);\r\nconst at_least = argumentsToNumber(Math.max);\r\nconst at_most = argumentsToNumber(Math.min);\r\nconst ceil = argumentsToNumber(Math.ceil);\r\nconst divided_by = argumentsToNumber((dividend, divisor, integerArithmetic = false) => integerArithmetic ? Math.floor(dividend / divisor) : dividend / divisor);\r\nconst floor = argumentsToNumber(Math.floor);\r\nconst minus = argumentsToNumber((v, arg) => v - arg);\r\nconst plus = argumentsToNumber((lhs, rhs) => lhs + rhs);\r\nconst modulo = argumentsToNumber((v, arg) => v % arg);\r\nconst times = argumentsToNumber((v, arg) => v * arg);\r\nfunction round(v, arg = 0) {\r\n    v = toNumber(v);\r\n    arg = toNumber(arg);\r\n    const amp = Math.pow(10, arg);\r\n    return Math.round(v * amp) / amp;\r\n}\n\nvar mathFilters = /*#__PURE__*/Object.freeze({\n  __proto__: null,\n  abs: abs,\n  at_least: at_least,\n  at_most: at_most,\n  ceil: ceil,\n  divided_by: divided_by,\n  floor: floor,\n  minus: minus,\n  plus: plus,\n  modulo: modulo,\n  times: times,\n  round: round\n});\n\nconst url_decode = (x) => decodeURIComponent(stringify(x)).replace(/\\+/g, ' ');\r\nconst url_encode = (x) => encodeURIComponent(stringify(x)).replace(/%20/g, '+');\r\nconst cgi_escape = (x) => encodeURIComponent(stringify(x))\r\n    .replace(/%20/g, '+')\r\n    .replace(/[!'()*]/g, c => '%' + c.charCodeAt(0).toString(16).toUpperCase());\r\nconst uri_escape = (x) => encodeURI(stringify(x))\r\n    .replace(/%5B/g, '[')\r\n    .replace(/%5D/g, ']');\r\nconst rSlugifyDefault = /[^\\p{M}\\p{L}\\p{Nd}]+/ug;\r\nconst rSlugifyReplacers = {\r\n    'raw': /\\s+/g,\r\n    'default': rSlugifyDefault,\r\n    'pretty': /[^\\p{M}\\p{L}\\p{Nd}._~!$&'()+,;=@]+/ug,\r\n    'ascii': /[^A-Za-z0-9]+/g,\r\n    'latin': rSlugifyDefault,\r\n    'none': null\r\n};\r\nfunction slugify(str, mode = 'default', cased = false) {\r\n    str = stringify(str);\r\n    const replacer = rSlugifyReplacers[mode];\r\n    if (replacer) {\r\n        if (mode === 'latin')\r\n            str = removeAccents(str);\r\n        str = str.replace(replacer, '-').replace(/^-|-$/g, '');\r\n    }\r\n    return cased ? str : str.toLowerCase();\r\n}\r\nfunction removeAccents(str) {\r\n    return str.replace(/[]/g, 'a')\r\n        .replace(/[]/g, 'ae')\r\n        .replace(/[]/g, 'c')\r\n        .replace(/[]/g, 'e')\r\n        .replace(/[]/g, 'i')\r\n        .replace(/[]/g, 'd')\r\n        .replace(/[]/g, 'n')\r\n        .replace(/[]/g, 'o')\r\n        .replace(/[]/g, 'u')\r\n        .replace(/[]/g, 'y')\r\n        .replace(/[]/g, 'ss')\r\n        .replace(/[]/g, 'oe')\r\n        .replace(/[]/g, 'th')\r\n        .replace(/[]/g, 'SS')\r\n        .replace(/[]/g, 'OE')\r\n        .replace(/[]/g, 'TH');\r\n}\n\nvar urlFilters = /*#__PURE__*/Object.freeze({\n  __proto__: null,\n  url_decode: url_decode,\n  url_encode: url_encode,\n  cgi_escape: cgi_escape,\n  uri_escape: uri_escape,\n  slugify: slugify\n});\n\nconst join = argumentsToValue(function (v, arg) {\r\n    const array = toArray(v);\r\n    const sep = isNil(arg) ? ' ' : stringify(arg);\r\n    const complexity = array.length * (1 + sep.length);\r\n    this.context.memoryLimit.use(complexity);\r\n    return array.join(sep);\r\n});\r\nconst last$1 = argumentsToValue((v) => isArrayLike(v) ? last(v) : '');\r\nconst first = argumentsToValue((v) => isArrayLike(v) ? v[0] : '');\r\nconst reverse = argumentsToValue(function (v) {\r\n    const array = toArray(v);\r\n    this.context.memoryLimit.use(array.length);\r\n    return [...array].reverse();\r\n});\r\nfunction* sort(arr, property) {\r\n    const values = [];\r\n    const array = toArray(arr);\r\n    this.context.memoryLimit.use(array.length);\r\n    for (const item of array) {\r\n        values.push([\r\n            item,\r\n            property ? yield this.context._getFromScope(item, stringify(property).split('.'), false) : item\r\n        ]);\r\n    }\r\n    return values.sort((lhs, rhs) => {\r\n        const lvalue = lhs[1];\r\n        const rvalue = rhs[1];\r\n        return lvalue < rvalue ? -1 : (lvalue > rvalue ? 1 : 0);\r\n    }).map(tuple => tuple[0]);\r\n}\r\nfunction sort_natural(input, property) {\r\n    const propertyString = stringify(property);\r\n    const compare = property === undefined\r\n        ? caseInsensitiveCompare\r\n        : (lhs, rhs) => caseInsensitiveCompare(lhs[propertyString], rhs[propertyString]);\r\n    const array = toArray(input);\r\n    this.context.memoryLimit.use(array.length);\r\n    return [...array].sort(compare);\r\n}\r\nconst size = (v) => (v && v.length) || 0;\r\nfunction* map(arr, property) {\r\n    const results = [];\r\n    const array = toArray(arr);\r\n    this.context.memoryLimit.use(array.length);\r\n    for (const item of array) {\r\n        results.push(yield this.context._getFromScope(item, stringify(property), false));\r\n    }\r\n    return results;\r\n}\r\nfunction* sum(arr, property) {\r\n    let sum = 0;\r\n    const array = toArray(arr);\r\n    for (const item of array) {\r\n        const data = Number(property ? yield this.context._getFromScope(item, stringify(property), false) : item);\r\n        sum += Number.isNaN(data) ? 0 : data;\r\n    }\r\n    return sum;\r\n}\r\nfunction compact(arr) {\r\n    const array = toArray(arr);\r\n    this.context.memoryLimit.use(array.length);\r\n    return array.filter(x => !isNil(toValue(x)));\r\n}\r\nfunction concat(v, arg = []) {\r\n    const lhs = toArray(v);\r\n    const rhs = toArray(arg);\r\n    this.context.memoryLimit.use(lhs.length + rhs.length);\r\n    return lhs.concat(rhs);\r\n}\r\nfunction push(v, arg) {\r\n    return concat.call(this, v, [arg]);\r\n}\r\nfunction unshift(v, arg) {\r\n    const array = toArray(v);\r\n    this.context.memoryLimit.use(array.length);\r\n    const clone = [...array];\r\n    clone.unshift(arg);\r\n    return clone;\r\n}\r\nfunction pop(v) {\r\n    const clone = [...toArray(v)];\r\n    clone.pop();\r\n    return clone;\r\n}\r\nfunction shift(v) {\r\n    const array = toArray(v);\r\n    this.context.memoryLimit.use(array.length);\r\n    const clone = [...array];\r\n    clone.shift();\r\n    return clone;\r\n}\r\nfunction slice(v, begin, length = 1) {\r\n    v = toValue(v);\r\n    if (isNil(v))\r\n        return [];\r\n    if (!isArray(v))\r\n        v = stringify(v);\r\n    begin = begin < 0 ? v.length + begin : begin;\r\n    this.context.memoryLimit.use(length);\r\n    return v.slice(begin, begin + length);\r\n}\r\nfunction expectedMatcher(expected) {\r\n    if (this.context.opts.jekyllWhere) {\r\n        return (v) => EmptyDrop.is(expected) ? equals(v, expected) : (isArray(v) ? arrayIncludes(v, expected) : equals(v, expected));\r\n    }\r\n    else if (expected === undefined) {\r\n        return (v) => isTruthy(v, this.context);\r\n    }\r\n    else {\r\n        return (v) => equals(v, expected);\r\n    }\r\n}\r\nfunction* filter(include, arr, property, expected) {\r\n    const values = [];\r\n    arr = toArray(arr);\r\n    this.context.memoryLimit.use(arr.length);\r\n    const token = new Tokenizer(stringify(property)).readScopeValue();\r\n    for (const item of arr) {\r\n        values.push(yield evalToken(token, this.context.spawn(item)));\r\n    }\r\n    const matcher = expectedMatcher.call(this, expected);\r\n    return arr.filter((_, i) => matcher(values[i]) === include);\r\n}\r\nfunction* filter_exp(include, arr, itemName, exp) {\r\n    const filtered = [];\r\n    const keyTemplate = new Value(stringify(exp), this.liquid);\r\n    const array = toArray(arr);\r\n    this.context.memoryLimit.use(array.length);\r\n    for (const item of array) {\r\n        this.context.push({ [itemName]: item });\r\n        const value = yield keyTemplate.value(this.context);\r\n        this.context.pop();\r\n        if (value === include)\r\n            filtered.push(item);\r\n    }\r\n    return filtered;\r\n}\r\nfunction* where(arr, property, expected) {\r\n    return yield* filter.call(this, true, arr, property, expected);\r\n}\r\nfunction* reject(arr, property, expected) {\r\n    return yield* filter.call(this, false, arr, property, expected);\r\n}\r\nfunction* where_exp(arr, itemName, exp) {\r\n    return yield* filter_exp.call(this, true, arr, itemName, exp);\r\n}\r\nfunction* reject_exp(arr, itemName, exp) {\r\n    return yield* filter_exp.call(this, false, arr, itemName, exp);\r\n}\r\nfunction* group_by(arr, property) {\r\n    const map = new Map();\r\n    arr = toEnumerable(arr);\r\n    const token = new Tokenizer(stringify(property)).readScopeValue();\r\n    this.context.memoryLimit.use(arr.length);\r\n    for (const item of arr) {\r\n        const key = yield evalToken(token, this.context.spawn(item));\r\n        if (!map.has(key))\r\n            map.set(key, []);\r\n        map.get(key).push(item);\r\n    }\r\n    return [...map.entries()].map(([name, items]) => ({ name, items }));\r\n}\r\nfunction* group_by_exp(arr, itemName, exp) {\r\n    const map = new Map();\r\n    const keyTemplate = new Value(stringify(exp), this.liquid);\r\n    arr = toEnumerable(arr);\r\n    this.context.memoryLimit.use(arr.length);\r\n    for (const item of arr) {\r\n        this.context.push({ [itemName]: item });\r\n        const key = yield keyTemplate.value(this.context);\r\n        this.context.pop();\r\n        if (!map.has(key))\r\n            map.set(key, []);\r\n        map.get(key).push(item);\r\n    }\r\n    return [...map.entries()].map(([name, items]) => ({ name, items }));\r\n}\r\nfunction* search(arr, property, expected) {\r\n    const token = new Tokenizer(stringify(property)).readScopeValue();\r\n    const array = toArray(arr);\r\n    const matcher = expectedMatcher.call(this, expected);\r\n    for (let index = 0; index < array.length; index++) {\r\n        const value = yield evalToken(token, this.context.spawn(array[index]));\r\n        if (matcher(value))\r\n            return [index, array[index]];\r\n    }\r\n}\r\nfunction* search_exp(arr, itemName, exp) {\r\n    const predicate = new Value(stringify(exp), this.liquid);\r\n    const array = toArray(arr);\r\n    for (let index = 0; index < array.length; index++) {\r\n        this.context.push({ [itemName]: array[index] });\r\n        const value = yield predicate.value(this.context);\r\n        this.context.pop();\r\n        if (value)\r\n            return [index, array[index]];\r\n    }\r\n}\r\nfunction* has(arr, property, expected) {\r\n    const result = yield* search.call(this, arr, property, expected);\r\n    return !!result;\r\n}\r\nfunction* has_exp(arr, itemName, exp) {\r\n    const result = yield* search_exp.call(this, arr, itemName, exp);\r\n    return !!result;\r\n}\r\nfunction* find_index(arr, property, expected) {\r\n    const result = yield* search.call(this, arr, property, expected);\r\n    return result ? result[0] : undefined;\r\n}\r\nfunction* find_index_exp(arr, itemName, exp) {\r\n    const result = yield* search_exp.call(this, arr, itemName, exp);\r\n    return result ? result[0] : undefined;\r\n}\r\nfunction* find(arr, property, expected) {\r\n    const result = yield* search.call(this, arr, property, expected);\r\n    return result ? result[1] : undefined;\r\n}\r\nfunction* find_exp(arr, itemName, exp) {\r\n    const result = yield* search_exp.call(this, arr, itemName, exp);\r\n    return result ? result[1] : undefined;\r\n}\r\nfunction uniq(arr) {\r\n    arr = toArray(arr);\r\n    this.context.memoryLimit.use(arr.length);\r\n    return [...new Set(arr)];\r\n}\r\nfunction sample(v, count = 1) {\r\n    v = toValue(v);\r\n    if (isNil(v))\r\n        return [];\r\n    if (!isArray(v))\r\n        v = stringify(v);\r\n    this.context.memoryLimit.use(count);\r\n    const shuffled = [...v].sort(() => Math.random() - 0.5);\r\n    if (count === 1)\r\n        return shuffled[0];\r\n    return shuffled.slice(0, count);\r\n}\n\nvar arrayFilters = /*#__PURE__*/Object.freeze({\n  __proto__: null,\n  join: join,\n  last: last$1,\n  first: first,\n  reverse: reverse,\n  sort: sort,\n  sort_natural: sort_natural,\n  size: size,\n  map: map,\n  sum: sum,\n  compact: compact,\n  concat: concat,\n  push: push,\n  unshift: unshift,\n  pop: pop,\n  shift: shift,\n  slice: slice,\n  where: where,\n  reject: reject,\n  where_exp: where_exp,\n  reject_exp: reject_exp,\n  group_by: group_by,\n  group_by_exp: group_by_exp,\n  has: has,\n  has_exp: has_exp,\n  find_index: find_index,\n  find_index_exp: find_index_exp,\n  find: find,\n  find_exp: find_exp,\n  uniq: uniq,\n  sample: sample\n});\n\nfunction date(v, format, timezoneOffset) {\r\n    var _a, _b, _c;\r\n    const size = ((_a = v === null || v === void 0 ? void 0 : v.length) !== null && _a !== void 0 ? _a : 0) + ((_b = format === null || format === void 0 ? void 0 : format.length) !== null && _b !== void 0 ? _b : 0) + ((_c = timezoneOffset === null || timezoneOffset === void 0 ? void 0 : timezoneOffset.length) !== null && _c !== void 0 ? _c : 0);\r\n    this.context.memoryLimit.use(size);\r\n    const date = parseDate(v, this.context.opts, timezoneOffset);\r\n    if (!date)\r\n        return v;\r\n    format = toValue(format);\r\n    format = isNil(format) ? this.context.opts.dateFormat : stringify(format);\r\n    return strftime(date, format);\r\n}\r\nfunction date_to_xmlschema(v) {\r\n    return date.call(this, v, '%Y-%m-%dT%H:%M:%S%:z');\r\n}\r\nfunction date_to_rfc822(v) {\r\n    return date.call(this, v, '%a, %d %b %Y %H:%M:%S %z');\r\n}\r\nfunction date_to_string(v, type, style) {\r\n    return stringify_date.call(this, v, '%b', type, style);\r\n}\r\nfunction date_to_long_string(v, type, style) {\r\n    return stringify_date.call(this, v, '%B', type, style);\r\n}\r\nfunction stringify_date(v, month_type, type, style) {\r\n    const date = parseDate(v, this.context.opts);\r\n    if (!date)\r\n        return v;\r\n    if (type === 'ordinal') {\r\n        const d = date.getDate();\r\n        return style === 'US'\r\n            ? strftime(date, `${month_type} ${d}%q, %Y`)\r\n            : strftime(date, `${d}%q ${month_type} %Y`);\r\n    }\r\n    return strftime(date, `%d ${month_type} %Y`);\r\n}\r\nfunction parseDate(v, opts, timezoneOffset) {\r\n    let date;\r\n    const defaultTimezoneOffset = timezoneOffset !== null && timezoneOffset !== void 0 ? timezoneOffset : opts.timezoneOffset;\r\n    const locale = opts.locale;\r\n    v = toValue(v);\r\n    if (v === 'now' || v === 'today') {\r\n        date = new LiquidDate(Date.now(), locale, defaultTimezoneOffset);\r\n    }\r\n    else if (isNumber(v)) {\r\n        date = new LiquidDate(v * 1000, locale, defaultTimezoneOffset);\r\n    }\r\n    else if (isString(v)) {\r\n        if (/^\\d+$/.test(v)) {\r\n            date = new LiquidDate(+v * 1000, locale, defaultTimezoneOffset);\r\n        }\r\n        else if (opts.preserveTimezones && timezoneOffset === undefined) {\r\n            date = LiquidDate.createDateFixedToTimezone(v, locale);\r\n        }\r\n        else {\r\n            date = new LiquidDate(v, locale, defaultTimezoneOffset);\r\n        }\r\n    }\r\n    else {\r\n        date = new LiquidDate(v, locale, defaultTimezoneOffset);\r\n    }\r\n    return date.valid() ? date : undefined;\r\n}\n\nvar dateFilters = /*#__PURE__*/Object.freeze({\n  __proto__: null,\n  date: date,\n  date_to_xmlschema: date_to_xmlschema,\n  date_to_rfc822: date_to_rfc822,\n  date_to_string: date_to_string,\n  date_to_long_string: date_to_long_string\n});\n\n/**\r\n * String related filters\r\n *\r\n * * prefer stringify() to String() since `undefined`, `null` should eval ''\r\n */\r\nconst rCJKWord = /[\\u4E00-\\u9FFF\\uF900-\\uFAFF\\u3400-\\u4DBF\\u3040-\\u309F\\u30A0-\\u30FF\\uAC00-\\uD7AF]/gu;\r\n// Word boundary followed by word characters (for detecting words)\r\nconst rNonCJKWord = /[^\\u4E00-\\u9FFF\\uF900-\\uFAFF\\u3400-\\u4DBF\\u3040-\\u309F\\u30A0-\\u30FF\\uAC00-\\uD7AF\\s]+/gu;\r\nfunction append(v, arg) {\r\n    assert(arguments.length === 2, 'append expect 2 arguments');\r\n    const lhs = stringify(v);\r\n    const rhs = stringify(arg);\r\n    this.context.memoryLimit.use(lhs.length + rhs.length);\r\n    return lhs + rhs;\r\n}\r\nfunction prepend(v, arg) {\r\n    assert(arguments.length === 2, 'prepend expect 2 arguments');\r\n    const lhs = stringify(v);\r\n    const rhs = stringify(arg);\r\n    this.context.memoryLimit.use(lhs.length + rhs.length);\r\n    return rhs + lhs;\r\n}\r\nfunction lstrip(v, chars) {\r\n    const str = stringify(v);\r\n    this.context.memoryLimit.use(str.length);\r\n    if (chars) {\r\n        chars = escapeRegExp(stringify(chars));\r\n        return str.replace(new RegExp(`^[${chars}]+`, 'g'), '');\r\n    }\r\n    return str.replace(/^\\s+/, '');\r\n}\r\nfunction downcase(v) {\r\n    const str = stringify(v);\r\n    this.context.memoryLimit.use(str.length);\r\n    return str.toLowerCase();\r\n}\r\nfunction upcase(v) {\r\n    const str = stringify(v);\r\n    this.context.memoryLimit.use(str.length);\r\n    return stringify(str).toUpperCase();\r\n}\r\nfunction remove(v, arg) {\r\n    const str = stringify(v);\r\n    this.context.memoryLimit.use(str.length);\r\n    return str.split(stringify(arg)).join('');\r\n}\r\nfunction remove_first(v, l) {\r\n    const str = stringify(v);\r\n    this.context.memoryLimit.use(str.length);\r\n    return str.replace(stringify(l), '');\r\n}\r\nfunction remove_last(v, l) {\r\n    const str = stringify(v);\r\n    this.context.memoryLimit.use(str.length);\r\n    const pattern = stringify(l);\r\n    const index = str.lastIndexOf(pattern);\r\n    if (index === -1)\r\n        return str;\r\n    return str.substring(0, index) + str.substring(index + pattern.length);\r\n}\r\nfunction rstrip(str, chars) {\r\n    str = stringify(str);\r\n    this.context.memoryLimit.use(str.length);\r\n    if (chars) {\r\n        chars = escapeRegExp(stringify(chars));\r\n        return str.replace(new RegExp(`[${chars}]+$`, 'g'), '');\r\n    }\r\n    return str.replace(/\\s+$/, '');\r\n}\r\nfunction split(v, arg) {\r\n    const str = stringify(v);\r\n    this.context.memoryLimit.use(str.length);\r\n    const arr = str.split(stringify(arg));\r\n    // align to ruby split, which is the behavior of shopify/liquid\r\n    // see: https://ruby-doc.org/core-2.4.0/String.html#method-i-split\r\n    while (arr.length && arr[arr.length - 1] === '')\r\n        arr.pop();\r\n    return arr;\r\n}\r\nfunction strip(v, chars) {\r\n    const str = stringify(v);\r\n    this.context.memoryLimit.use(str.length);\r\n    if (chars) {\r\n        chars = escapeRegExp(stringify(chars));\r\n        return str\r\n            .replace(new RegExp(`^[${chars}]+`, 'g'), '')\r\n            .replace(new RegExp(`[${chars}]+$`, 'g'), '');\r\n    }\r\n    return str.trim();\r\n}\r\nfunction strip_newlines(v) {\r\n    const str = stringify(v);\r\n    this.context.memoryLimit.use(str.length);\r\n    return str.replace(/\\r?\\n/gm, '');\r\n}\r\nfunction capitalize(str) {\r\n    str = stringify(str);\r\n    this.context.memoryLimit.use(str.length);\r\n    return str.charAt(0).toUpperCase() + str.slice(1).toLowerCase();\r\n}\r\nfunction replace(v, pattern, replacement) {\r\n    const str = stringify(v);\r\n    this.context.memoryLimit.use(str.length);\r\n    return str.split(stringify(pattern)).join(replacement);\r\n}\r\nfunction replace_first(v, arg1, arg2) {\r\n    const str = stringify(v);\r\n    this.context.memoryLimit.use(str.length);\r\n    return str.replace(stringify(arg1), arg2);\r\n}\r\nfunction replace_last(v, arg1, arg2) {\r\n    const str = stringify(v);\r\n    this.context.memoryLimit.use(str.length);\r\n    const pattern = stringify(arg1);\r\n    const index = str.lastIndexOf(pattern);\r\n    if (index === -1)\r\n        return str;\r\n    const replacement = stringify(arg2);\r\n    return str.substring(0, index) + replacement + str.substring(index + pattern.length);\r\n}\r\nfunction truncate(v, l = 50, o = '...') {\r\n    const str = stringify(v);\r\n    this.context.memoryLimit.use(str.length);\r\n    if (str.length <= l)\r\n        return v;\r\n    return str.substring(0, l - o.length) + o;\r\n}\r\nfunction truncatewords(v, words = 15, o = '...') {\r\n    const str = stringify(v);\r\n    this.context.memoryLimit.use(str.length);\r\n    const arr = str.split(/\\s+/);\r\n    if (words <= 0)\r\n        words = 1;\r\n    let ret = arr.slice(0, words).join(' ');\r\n    if (arr.length >= words)\r\n        ret += o;\r\n    return ret;\r\n}\r\nfunction normalize_whitespace(v) {\r\n    const str = stringify(v);\r\n    this.context.memoryLimit.use(str.length);\r\n    return str.replace(/\\s+/g, ' ');\r\n}\r\nfunction number_of_words(input, mode) {\r\n    const str = stringify(input);\r\n    this.context.memoryLimit.use(str.length);\r\n    input = str.trim();\r\n    if (!input)\r\n        return 0;\r\n    switch (mode) {\r\n        case 'cjk':\r\n            // Count CJK characters and words\r\n            return (input.match(rCJKWord) || []).length + (input.match(rNonCJKWord) || []).length;\r\n        case 'auto':\r\n            // Count CJK characters, if none, count words\r\n            return rCJKWord.test(input)\r\n                ? input.match(rCJKWord).length + (input.match(rNonCJKWord) || []).length\r\n                : input.split(/\\s+/).length;\r\n        default:\r\n            // Count words only\r\n            return input.split(/\\s+/).length;\r\n    }\r\n}\r\nfunction array_to_sentence_string(array, connector = 'and') {\r\n    this.context.memoryLimit.use(array.length);\r\n    switch (array.length) {\r\n        case 0:\r\n            return '';\r\n        case 1:\r\n            return array[0];\r\n        case 2:\r\n            return `${array[0]} ${connector} ${array[1]}`;\r\n        default:\r\n            return `${array.slice(0, -1).join(', ')}, ${connector} ${array[array.length - 1]}`;\r\n    }\r\n}\n\nvar stringFilters = /*#__PURE__*/Object.freeze({\n  __proto__: null,\n  append: append,\n  prepend: prepend,\n  lstrip: lstrip,\n  downcase: downcase,\n  upcase: upcase,\n  remove: remove,\n  remove_first: remove_first,\n  remove_last: remove_last,\n  rstrip: rstrip,\n  split: split,\n  strip: strip,\n  strip_newlines: strip_newlines,\n  capitalize: capitalize,\n  replace: replace,\n  replace_first: replace_first,\n  replace_last: replace_last,\n  truncate: truncate,\n  truncatewords: truncatewords,\n  normalize_whitespace: normalize_whitespace,\n  number_of_words: number_of_words,\n  array_to_sentence_string: array_to_sentence_string\n});\n\nfunction base64Encode(str) {\r\n    return btoa(String.fromCharCode(...new TextEncoder().encode(str)));\r\n}\r\nfunction base64Decode(str) {\r\n    return new TextDecoder().decode(Uint8Array.from(atob(str), c => c.charCodeAt(0)));\r\n}\n\n/**\r\n * Base64 related filters\r\n *\r\n * Implements base64_encode and base64_decode filters for Shopify compatibility\r\n */\r\nfunction base64_encode(value) {\r\n    const str = stringify(value);\r\n    this.context.memoryLimit.use(str.length);\r\n    return base64Encode(str);\r\n}\r\nfunction base64_decode(value) {\r\n    const str = stringify(value);\r\n    this.context.memoryLimit.use(str.length);\r\n    return base64Decode(str);\r\n}\n\nvar base64Filters = /*#__PURE__*/Object.freeze({\n  __proto__: null,\n  base64_encode: base64_encode,\n  base64_decode: base64_decode\n});\n\nconst filters = Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({}, htmlFilters), mathFilters), urlFilters), arrayFilters), dateFilters), stringFilters), base64Filters), misc);\n\nclass AssignTag extends Tag {\r\n    constructor(token, remainTokens, liquid) {\r\n        super(token, remainTokens, liquid);\r\n        this.identifier = this.tokenizer.readIdentifier();\r\n        this.key = this.identifier.content;\r\n        this.tokenizer.assert(this.key, 'expected variable name');\r\n        this.tokenizer.skipBlank();\r\n        this.tokenizer.assert(this.tokenizer.peek() === '=', 'expected \"=\"');\r\n        this.tokenizer.advance();\r\n        this.value = new Value(this.tokenizer.readFilteredValue(), this.liquid);\r\n    }\r\n    *render(ctx) {\r\n        ctx.bottom()[this.key] = yield this.value.value(ctx, this.liquid.options.lenientIf);\r\n    }\r\n    *arguments() {\r\n        yield this.value;\r\n    }\r\n    *localScope() {\r\n        yield this.identifier;\r\n    }\r\n}\n\nconst MODIFIERS = ['offset', 'limit', 'reversed'];\r\nclass ForTag extends Tag {\r\n    constructor(token, remainTokens, liquid, parser) {\r\n        super(token, remainTokens, liquid);\r\n        const variable = this.tokenizer.readIdentifier();\r\n        const inStr = this.tokenizer.readIdentifier();\r\n        const collection = this.tokenizer.readValue();\r\n        if (!variable.size() || inStr.content !== 'in' || !collection) {\r\n            throw new Error(`illegal tag: ${token.getText()}`);\r\n        }\r\n        this.variable = variable.content;\r\n        this.collection = collection;\r\n        this.hash = new Hash(this.tokenizer, liquid.options.keyValueSeparator);\r\n        this.templates = [];\r\n        this.elseTemplates = [];\r\n        let p;\r\n        const stream = parser.parseStream(remainTokens)\r\n            .on('start', () => (p = this.templates))\r\n            .on('tag:else', tag => { assertEmpty(tag.args); p = this.elseTemplates; })\r\n            .on('tag:endfor', tag => { assertEmpty(tag.args); stream.stop(); })\r\n            .on('template', (tpl) => p.push(tpl))\r\n            .on('end', () => { throw new Error(`tag ${token.getText()} not closed`); });\r\n        stream.start();\r\n    }\r\n    *render(ctx, emitter) {\r\n        const r = this.liquid.renderer;\r\n        let collection = toEnumerable(yield evalToken(this.collection, ctx));\r\n        if (!collection.length) {\r\n            yield r.renderTemplates(this.elseTemplates, ctx, emitter);\r\n            return;\r\n        }\r\n        const continueKey = 'continue-' + this.variable + '-' + this.collection.getText();\r\n        ctx.push({ continue: ctx.getRegister(continueKey) });\r\n        const hash = yield this.hash.render(ctx);\r\n        ctx.pop();\r\n        const modifiers = this.liquid.options.orderedFilterParameters\r\n            ? Object.keys(hash).filter(x => MODIFIERS.includes(x))\r\n            : MODIFIERS.filter(x => hash[x] !== undefined);\r\n        collection = modifiers.reduce((collection, modifier) => {\r\n            if (modifier === 'offset')\r\n                return offset(collection, hash['offset']);\r\n            if (modifier === 'limit')\r\n                return limit(collection, hash['limit']);\r\n            return reversed(collection);\r\n        }, collection);\r\n        ctx.setRegister(continueKey, (hash['offset'] || 0) + collection.length);\r\n        const scope = { forloop: new ForloopDrop(collection.length, this.collection.getText(), this.variable) };\r\n        ctx.push(scope);\r\n        for (const item of collection) {\r\n            scope[this.variable] = item;\r\n            ctx.continueCalled = ctx.breakCalled = false;\r\n            yield r.renderTemplates(this.templates, ctx, emitter);\r\n            if (ctx.breakCalled)\r\n                break;\r\n            scope.forloop.next();\r\n        }\r\n        ctx.continueCalled = ctx.breakCalled = false;\r\n        ctx.pop();\r\n    }\r\n    *children() {\r\n        const templates = this.templates.slice();\r\n        if (this.elseTemplates) {\r\n            templates.push(...this.elseTemplates);\r\n        }\r\n        return templates;\r\n    }\r\n    *arguments() {\r\n        yield this.collection;\r\n        for (const v of Object.values(this.hash.hash)) {\r\n            if (isValueToken(v)) {\r\n                yield v;\r\n            }\r\n        }\r\n    }\r\n    blockScope() {\r\n        return [this.variable, 'forloop'];\r\n    }\r\n}\r\nfunction reversed(arr) {\r\n    return [...arr].reverse();\r\n}\r\nfunction offset(arr, count) {\r\n    return arr.slice(count);\r\n}\r\nfunction limit(arr, count) {\r\n    return arr.slice(0, count);\r\n}\n\nclass CaptureTag extends Tag {\r\n    constructor(tagToken, remainTokens, liquid, parser) {\r\n        super(tagToken, remainTokens, liquid);\r\n        this.templates = [];\r\n        this.identifier = this.readVariable();\r\n        this.variable = this.identifier.content;\r\n        while (remainTokens.length) {\r\n            const token = remainTokens.shift();\r\n            if (isTagToken(token) && token.name === 'endcapture')\r\n                return;\r\n            this.templates.push(parser.parseToken(token, remainTokens));\r\n        }\r\n        throw new Error(`tag ${tagToken.getText()} not closed`);\r\n    }\r\n    readVariable() {\r\n        let ident = this.tokenizer.readIdentifier();\r\n        if (ident.content)\r\n            return ident;\r\n        ident = this.tokenizer.readQuoted();\r\n        if (ident)\r\n            return ident;\r\n        throw this.tokenizer.error('invalid capture name');\r\n    }\r\n    *render(ctx) {\r\n        const r = this.liquid.renderer;\r\n        const html = yield r.renderTemplates(this.templates, ctx);\r\n        ctx.bottom()[this.variable] = html;\r\n    }\r\n    *children() {\r\n        return this.templates;\r\n    }\r\n    *localScope() {\r\n        yield this.identifier;\r\n    }\r\n}\n\nclass CaseTag extends Tag {\r\n    constructor(tagToken, remainTokens, liquid, parser) {\r\n        super(tagToken, remainTokens, liquid);\r\n        this.branches = [];\r\n        this.elseTemplates = [];\r\n        this.value = new Value(this.tokenizer.readFilteredValue(), this.liquid);\r\n        this.elseTemplates = [];\r\n        let p = [];\r\n        let elseCount = 0;\r\n        const stream = parser.parseStream(remainTokens)\r\n            .on('tag:when', (token) => {\r\n            if (elseCount > 0) {\r\n                return;\r\n            }\r\n            p = [];\r\n            const values = [];\r\n            while (!token.tokenizer.end()) {\r\n                values.push(token.tokenizer.readValueOrThrow());\r\n                token.tokenizer.skipBlank();\r\n                if (token.tokenizer.peek() === ',') {\r\n                    token.tokenizer.readTo(',');\r\n                }\r\n                else {\r\n                    token.tokenizer.readTo('or');\r\n                }\r\n            }\r\n            this.branches.push({\r\n                values,\r\n                templates: p\r\n            });\r\n        })\r\n            .on('tag:else', () => {\r\n            elseCount++;\r\n            p = this.elseTemplates;\r\n        })\r\n            .on('tag:endcase', () => stream.stop())\r\n            .on('template', (tpl) => {\r\n            if (p !== this.elseTemplates || elseCount === 1) {\r\n                p.push(tpl);\r\n            }\r\n        })\r\n            .on('end', () => {\r\n            throw new Error(`tag ${tagToken.getText()} not closed`);\r\n        });\r\n        stream.start();\r\n    }\r\n    *render(ctx, emitter) {\r\n        const r = this.liquid.renderer;\r\n        const target = toValue(yield this.value.value(ctx, ctx.opts.lenientIf));\r\n        let branchHit = false;\r\n        for (const branch of this.branches) {\r\n            for (const valueToken of branch.values) {\r\n                const value = yield evalToken(valueToken, ctx, ctx.opts.lenientIf);\r\n                if (equals(target, value)) {\r\n                    yield r.renderTemplates(branch.templates, ctx, emitter);\r\n                    branchHit = true;\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        if (!branchHit) {\r\n            yield r.renderTemplates(this.elseTemplates, ctx, emitter);\r\n        }\r\n    }\r\n    *arguments() {\r\n        yield this.value;\r\n        yield* this.branches.flatMap(b => b.values);\r\n    }\r\n    *children() {\r\n        const templates = this.branches.flatMap(b => b.templates);\r\n        if (this.elseTemplates) {\r\n            templates.push(...this.elseTemplates);\r\n        }\r\n        return templates;\r\n    }\r\n}\n\nclass CommentTag extends Tag {\r\n    constructor(tagToken, remainTokens, liquid) {\r\n        super(tagToken, remainTokens, liquid);\r\n        while (remainTokens.length) {\r\n            const token = remainTokens.shift();\r\n            if (isTagToken(token) && token.name === 'endcomment')\r\n                return;\r\n        }\r\n        throw new Error(`tag ${tagToken.getText()} not closed`);\r\n    }\r\n    render() { }\r\n}\n\nclass RenderTag extends Tag {\r\n    constructor(token, remainTokens, liquid, parser) {\r\n        super(token, remainTokens, liquid);\r\n        const tokenizer = this.tokenizer;\r\n        this.file = parseFilePath(tokenizer, this.liquid, parser);\r\n        this.currentFile = token.file;\r\n        while (!tokenizer.end()) {\r\n            tokenizer.skipBlank();\r\n            const begin = tokenizer.p;\r\n            const keyword = tokenizer.readIdentifier();\r\n            if (keyword.content === 'with' || keyword.content === 'for') {\r\n                tokenizer.skipBlank();\r\n                // can be normal key/value pair, like \"with: true\"\r\n                if (tokenizer.peek() !== ':') {\r\n                    const value = tokenizer.readValue();\r\n                    // can be normal key, like \"with,\"\r\n                    if (value) {\r\n                        const beforeAs = tokenizer.p;\r\n                        const asStr = tokenizer.readIdentifier();\r\n                        let alias;\r\n                        if (asStr.content === 'as')\r\n                            alias = tokenizer.readIdentifier();\r\n                        else\r\n                            tokenizer.p = beforeAs;\r\n                        this[keyword.content] = { value, alias: alias && alias.content };\r\n                        tokenizer.skipBlank();\r\n                        if (tokenizer.peek() === ',')\r\n                            tokenizer.advance();\r\n                        continue; // matched!\r\n                    }\r\n                }\r\n            }\r\n            /**\r\n             * restore cursor if with/for not matched\r\n             */\r\n            tokenizer.p = begin;\r\n            break;\r\n        }\r\n        this.hash = new Hash(tokenizer, liquid.options.keyValueSeparator);\r\n    }\r\n    *render(ctx, emitter) {\r\n        const { liquid, hash } = this;\r\n        const filepath = (yield renderFilePath(this['file'], ctx, liquid));\r\n        assert(filepath, () => `illegal file path \"${filepath}\"`);\r\n        const childCtx = ctx.spawn();\r\n        const scope = childCtx.bottom();\r\n        __assign(scope, yield hash.render(ctx));\r\n        if (this['with']) {\r\n            const { value, alias } = this['with'];\r\n            scope[alias || filepath] = yield evalToken(value, ctx);\r\n        }\r\n        if (this['for']) {\r\n            const { value, alias } = this['for'];\r\n            const collection = toEnumerable(yield evalToken(value, ctx));\r\n            scope['forloop'] = new ForloopDrop(collection.length, value.getText(), alias);\r\n            for (const item of collection) {\r\n                scope[alias] = item;\r\n                const templates = (yield liquid._parsePartialFile(filepath, childCtx.sync, this['currentFile']));\r\n                yield liquid.renderer.renderTemplates(templates, childCtx, emitter);\r\n                scope['forloop'].next();\r\n            }\r\n        }\r\n        else {\r\n            const templates = (yield liquid._parsePartialFile(filepath, childCtx.sync, this['currentFile']));\r\n            yield liquid.renderer.renderTemplates(templates, childCtx, emitter);\r\n        }\r\n    }\r\n    *children(partials, sync) {\r\n        if (partials && isString(this['file'])) {\r\n            return (yield this.liquid._parsePartialFile(this['file'], sync, this['currentFile']));\r\n        }\r\n        return [];\r\n    }\r\n    partialScope() {\r\n        if (isString(this['file'])) {\r\n            const names = Object.keys(this.hash.hash);\r\n            if (this['with']) {\r\n                const { value, alias } = this['with'];\r\n                if (isString(alias)) {\r\n                    names.push([alias, value]);\r\n                }\r\n                else if (isString(this.file)) {\r\n                    names.push([this.file, value]);\r\n                }\r\n            }\r\n            if (this['for']) {\r\n                const { value, alias } = this['for'];\r\n                if (isString(alias)) {\r\n                    names.push([alias, value]);\r\n                }\r\n                else if (isString(this.file)) {\r\n                    names.push([this.file, value]);\r\n                }\r\n            }\r\n            return { name: this['file'], isolated: true, scope: names };\r\n        }\r\n    }\r\n    *arguments() {\r\n        for (const v of Object.values(this.hash.hash)) {\r\n            if (isValueToken(v)) {\r\n                yield v;\r\n            }\r\n        }\r\n        if (this['with']) {\r\n            const { value } = this['with'];\r\n            if (isValueToken(value)) {\r\n                yield value;\r\n            }\r\n        }\r\n        if (this['for']) {\r\n            const { value } = this['for'];\r\n            if (isValueToken(value)) {\r\n                yield value;\r\n            }\r\n        }\r\n    }\r\n}\r\n/**\r\n * @return null for \"none\",\r\n * @return Template[] for quoted with tags and/or filters\r\n * @return Token for expression (not quoted)\r\n * @throws TypeError if cannot read next token\r\n */\r\nfunction parseFilePath(tokenizer, liquid, parser) {\r\n    if (liquid.options.dynamicPartials) {\r\n        const file = tokenizer.readValue();\r\n        tokenizer.assert(file, 'illegal file path');\r\n        if (file.getText() === 'none')\r\n            return;\r\n        if (isQuotedToken(file)) {\r\n            // for filenames like \"files/{{file}}\", eval as liquid template\r\n            const templates = parser.parse(evalQuotedToken(file));\r\n            return optimize(templates);\r\n        }\r\n        return file;\r\n    }\r\n    const tokens = [...tokenizer.readFileNameTemplate(liquid.options)];\r\n    const templates = optimize(parser.parseTokens(tokens));\r\n    return templates === 'none' ? undefined : templates;\r\n}\r\nfunction optimize(templates) {\r\n    // for filenames like \"files/file.liquid\", extract the string directly\r\n    if (templates.length === 1 && isHTMLToken(templates[0].token))\r\n        return templates[0].token.getContent();\r\n    return templates;\r\n}\r\nfunction* renderFilePath(file, ctx, liquid) {\r\n    if (typeof file === 'string')\r\n        return file;\r\n    if (Array.isArray(file))\r\n        return liquid.renderer.renderTemplates(file, ctx);\r\n    return yield evalToken(file, ctx);\r\n}\n\nclass IncludeTag extends Tag {\r\n    constructor(token, remainTokens, liquid, parser) {\r\n        super(token, remainTokens, liquid);\r\n        const { tokenizer } = token;\r\n        this['file'] = parseFilePath(tokenizer, this.liquid, parser);\r\n        this['currentFile'] = token.file;\r\n        const begin = tokenizer.p;\r\n        const withStr = tokenizer.readIdentifier();\r\n        if (withStr.content === 'with') {\r\n            tokenizer.skipBlank();\r\n            if (tokenizer.peek() !== ':') {\r\n                this.withVar = tokenizer.readValue();\r\n            }\r\n            else\r\n                tokenizer.p = begin;\r\n        }\r\n        else\r\n            tokenizer.p = begin;\r\n        this.hash = new Hash(tokenizer, liquid.options.jekyllInclude || liquid.options.keyValueSeparator);\r\n    }\r\n    *render(ctx, emitter) {\r\n        const { liquid, hash, withVar } = this;\r\n        const { renderer } = liquid;\r\n        const filepath = (yield renderFilePath(this['file'], ctx, liquid));\r\n        assert(filepath, () => `illegal file path \"${filepath}\"`);\r\n        const saved = ctx.saveRegister('blocks', 'blockMode');\r\n        ctx.setRegister('blocks', {});\r\n        ctx.setRegister('blockMode', BlockMode.OUTPUT);\r\n        const scope = (yield hash.render(ctx));\r\n        if (withVar)\r\n            scope[filepath] = yield evalToken(withVar, ctx);\r\n        const templates = (yield liquid._parsePartialFile(filepath, ctx.sync, this['currentFile']));\r\n        ctx.push(ctx.opts.jekyllInclude ? { include: scope } : scope);\r\n        yield renderer.renderTemplates(templates, ctx, emitter);\r\n        ctx.pop();\r\n        ctx.restoreRegister(saved);\r\n    }\r\n    *children(partials, sync) {\r\n        if (partials && isString(this['file'])) {\r\n            return (yield this.liquid._parsePartialFile(this['file'], sync, this['currentFile']));\r\n        }\r\n        return [];\r\n    }\r\n    partialScope() {\r\n        if (isString(this['file'])) {\r\n            let names;\r\n            if (this.liquid.options.jekyllInclude) {\r\n                names = ['include'];\r\n            }\r\n            else {\r\n                names = Object.keys(this.hash.hash);\r\n                if (this.withVar) {\r\n                    names.push([this['file'], this.withVar]);\r\n                }\r\n            }\r\n            return { name: this['file'], isolated: false, scope: names };\r\n        }\r\n    }\r\n    *arguments() {\r\n        yield* Object.values(this.hash.hash).filter(isValueToken);\r\n        if (isValueToken(this['file'])) {\r\n            yield this['file'];\r\n        }\r\n        if (isValueToken(this.withVar)) {\r\n            yield this.withVar;\r\n        }\r\n    }\r\n}\n\nclass DecrementTag extends Tag {\r\n    constructor(token, remainTokens, liquid) {\r\n        super(token, remainTokens, liquid);\r\n        this.identifier = this.tokenizer.readIdentifier();\r\n        this.variable = this.identifier.content;\r\n    }\r\n    render(context, emitter) {\r\n        const scope = context.environments;\r\n        if (!isNumber(scope[this.variable])) {\r\n            scope[this.variable] = 0;\r\n        }\r\n        emitter.write(stringify(--scope[this.variable]));\r\n    }\r\n    *localScope() {\r\n        yield this.identifier;\r\n    }\r\n}\n\nclass CycleTag extends Tag {\r\n    constructor(token, remainTokens, liquid) {\r\n        super(token, remainTokens, liquid);\r\n        this.candidates = [];\r\n        const group = this.tokenizer.readValue();\r\n        this.tokenizer.skipBlank();\r\n        if (group) {\r\n            if (this.tokenizer.peek() === ':') {\r\n                this.group = group;\r\n                this.tokenizer.advance();\r\n            }\r\n            else\r\n                this.candidates.push(group);\r\n        }\r\n        while (!this.tokenizer.end()) {\r\n            const value = this.tokenizer.readValue();\r\n            if (value)\r\n                this.candidates.push(value);\r\n            this.tokenizer.readTo(',');\r\n        }\r\n        this.tokenizer.assert(this.candidates.length, () => `empty candidates: \"${token.getText()}\"`);\r\n    }\r\n    *render(ctx, emitter) {\r\n        const group = (yield evalToken(this.group, ctx));\r\n        const fingerprint = `cycle:${group}:` + this.candidates.join(',');\r\n        const groups = ctx.getRegister('cycle');\r\n        let idx = groups[fingerprint];\r\n        if (idx === undefined) {\r\n            idx = groups[fingerprint] = 0;\r\n        }\r\n        const candidate = this.candidates[idx];\r\n        idx = (idx + 1) % this.candidates.length;\r\n        groups[fingerprint] = idx;\r\n        return yield evalToken(candidate, ctx);\r\n    }\r\n    *arguments() {\r\n        yield* this.candidates;\r\n        if (this.group) {\r\n            yield this.group;\r\n        }\r\n    }\r\n}\n\nclass IfTag extends Tag {\r\n    constructor(tagToken, remainTokens, liquid, parser) {\r\n        super(tagToken, remainTokens, liquid);\r\n        this.branches = [];\r\n        let p = [];\r\n        parser.parseStream(remainTokens)\r\n            .on('start', () => this.branches.push({\r\n            value: new Value(tagToken.tokenizer.readFilteredValue(), this.liquid),\r\n            templates: (p = [])\r\n        }))\r\n            .on('tag:elsif', (token) => {\r\n            assert(!this.elseTemplates, 'unexpected elsif after else');\r\n            this.branches.push({\r\n                value: new Value(token.tokenizer.readFilteredValue(), this.liquid),\r\n                templates: (p = [])\r\n            });\r\n        })\r\n            .on('tag:else', tag => {\r\n            assertEmpty(tag.args);\r\n            assert(!this.elseTemplates, 'duplicated else');\r\n            p = this.elseTemplates = [];\r\n        })\r\n            .on('tag:endif', function (tag) { assertEmpty(tag.args); this.stop(); })\r\n            .on('template', (tpl) => p.push(tpl))\r\n            .on('end', () => { throw new Error(`tag ${tagToken.getText()} not closed`); })\r\n            .start();\r\n    }\r\n    *render(ctx, emitter) {\r\n        const r = this.liquid.renderer;\r\n        for (const { value, templates } of this.branches) {\r\n            const v = yield value.value(ctx, ctx.opts.lenientIf);\r\n            if (isTruthy(v, ctx)) {\r\n                yield r.renderTemplates(templates, ctx, emitter);\r\n                return;\r\n            }\r\n        }\r\n        yield r.renderTemplates(this.elseTemplates || [], ctx, emitter);\r\n    }\r\n    *children() {\r\n        const templates = this.branches.flatMap(b => b.templates);\r\n        if (this.elseTemplates) {\r\n            templates.push(...this.elseTemplates);\r\n        }\r\n        return templates;\r\n    }\r\n    arguments() {\r\n        return this.branches.map(b => b.value);\r\n    }\r\n}\n\nclass IncrementTag extends Tag {\r\n    constructor(token, remainTokens, liquid) {\r\n        super(token, remainTokens, liquid);\r\n        this.identifier = this.tokenizer.readIdentifier();\r\n        this.variable = this.identifier.content;\r\n    }\r\n    render(context, emitter) {\r\n        const scope = context.environments;\r\n        if (!isNumber(scope[this.variable])) {\r\n            scope[this.variable] = 0;\r\n        }\r\n        const val = scope[this.variable];\r\n        scope[this.variable]++;\r\n        emitter.write(stringify(val));\r\n    }\r\n    *localScope() {\r\n        yield this.identifier;\r\n    }\r\n}\n\nclass LayoutTag extends Tag {\r\n    constructor(token, remainTokens, liquid, parser) {\r\n        super(token, remainTokens, liquid);\r\n        this.file = parseFilePath(this.tokenizer, this.liquid, parser);\r\n        this['currentFile'] = token.file;\r\n        this.args = new Hash(this.tokenizer, liquid.options.keyValueSeparator);\r\n        this.templates = parser.parseTokens(remainTokens);\r\n    }\r\n    *render(ctx, emitter) {\r\n        const { liquid, args, file } = this;\r\n        const { renderer } = liquid;\r\n        if (file === undefined) {\r\n            ctx.setRegister('blockMode', BlockMode.OUTPUT);\r\n            yield renderer.renderTemplates(this.templates, ctx, emitter);\r\n            return;\r\n        }\r\n        const filepath = (yield renderFilePath(this.file, ctx, liquid));\r\n        assert(filepath, () => `illegal file path \"${filepath}\"`);\r\n        const templates = (yield liquid._parseLayoutFile(filepath, ctx.sync, this['currentFile']));\r\n        // render remaining contents and store rendered results\r\n        ctx.setRegister('blockMode', BlockMode.STORE);\r\n        const html = yield renderer.renderTemplates(this.templates, ctx);\r\n        const blocks = ctx.getRegister('blocks');\r\n        // set whole content to anonymous block if anonymous doesn't specified\r\n        if (blocks[''] === undefined)\r\n            blocks[''] = (parent, emitter) => emitter.write(html);\r\n        ctx.setRegister('blockMode', BlockMode.OUTPUT);\r\n        // render the layout file use stored blocks\r\n        ctx.push((yield args.render(ctx)));\r\n        yield renderer.renderTemplates(templates, ctx, emitter);\r\n        ctx.pop();\r\n    }\r\n    *children(partials) {\r\n        const templates = this.templates.slice();\r\n        if (partials && isString(this.file)) {\r\n            templates.push(...(yield this.liquid._parsePartialFile(this.file, true, this['currentFile'])));\r\n        }\r\n        return templates;\r\n    }\r\n    *arguments() {\r\n        for (const v of Object.values(this.args.hash)) {\r\n            if (isValueToken(v)) {\r\n                yield v;\r\n            }\r\n        }\r\n        if (isValueToken(this.file)) {\r\n            yield this.file;\r\n        }\r\n    }\r\n    partialScope() {\r\n        if (isString(this.file)) {\r\n            return { name: this.file, isolated: false, scope: Object.keys(this.args.hash) };\r\n        }\r\n    }\r\n}\n\nclass BlockTag extends Tag {\r\n    constructor(token, remainTokens, liquid, parser) {\r\n        super(token, remainTokens, liquid);\r\n        this.templates = [];\r\n        const match = /\\w+/.exec(token.args);\r\n        this.block = match ? match[0] : '';\r\n        while (remainTokens.length) {\r\n            const token = remainTokens.shift();\r\n            if (isTagToken(token) && token.name === 'endblock')\r\n                return;\r\n            const template = parser.parseToken(token, remainTokens);\r\n            this.templates.push(template);\r\n        }\r\n        throw new Error(`tag ${token.getText()} not closed`);\r\n    }\r\n    *render(ctx, emitter) {\r\n        const blockRender = this.getBlockRender(ctx);\r\n        if (ctx.getRegister('blockMode') === BlockMode.STORE) {\r\n            ctx.getRegister('blocks')[this.block] = blockRender;\r\n        }\r\n        else {\r\n            yield blockRender(new BlockDrop(), emitter);\r\n        }\r\n    }\r\n    getBlockRender(ctx) {\r\n        const { liquid, templates } = this;\r\n        const renderChild = ctx.getRegister('blocks')[this.block];\r\n        const renderCurrent = function* (superBlock, emitter) {\r\n            // add {{ block.super }} support when rendering\r\n            ctx.push({ block: superBlock });\r\n            yield liquid.renderer.renderTemplates(templates, ctx, emitter);\r\n            ctx.pop();\r\n        };\r\n        return renderChild\r\n            ? (superBlock, emitter) => renderChild(new BlockDrop((emitter) => renderCurrent(superBlock, emitter)), emitter)\r\n            : renderCurrent;\r\n    }\r\n    *children() {\r\n        return this.templates;\r\n    }\r\n    blockScope() {\r\n        return ['block'];\r\n    }\r\n}\n\nclass RawTag extends Tag {\r\n    constructor(tagToken, remainTokens, liquid) {\r\n        super(tagToken, remainTokens, liquid);\r\n        this.tokens = [];\r\n        while (remainTokens.length) {\r\n            const token = remainTokens.shift();\r\n            if (isTagToken(token) && token.name === 'endraw')\r\n                return;\r\n            this.tokens.push(token);\r\n        }\r\n        throw new Error(`tag ${tagToken.getText()} not closed`);\r\n    }\r\n    render() {\r\n        return this.tokens.map((token) => token.getText()).join('');\r\n    }\r\n}\n\nclass TablerowloopDrop extends ForloopDrop {\r\n    constructor(length, cols, collection, variable) {\r\n        super(length, collection, variable);\r\n        this.length = length;\r\n        this.cols = cols;\r\n    }\r\n    row() {\r\n        return Math.floor(this.i / this.cols) + 1;\r\n    }\r\n    col0() {\r\n        return (this.i % this.cols);\r\n    }\r\n    col() {\r\n        return this.col0() + 1;\r\n    }\r\n    col_first() {\r\n        return this.col0() === 0;\r\n    }\r\n    col_last() {\r\n        return this.col() === this.cols;\r\n    }\r\n}\n\nclass TablerowTag extends Tag {\r\n    constructor(tagToken, remainTokens, liquid, parser) {\r\n        super(tagToken, remainTokens, liquid);\r\n        const variable = this.tokenizer.readIdentifier();\r\n        this.tokenizer.skipBlank();\r\n        const predicate = this.tokenizer.readIdentifier();\r\n        const collectionToken = this.tokenizer.readValue();\r\n        if (predicate.content !== 'in' || !collectionToken) {\r\n            throw new Error(`illegal tag: ${tagToken.getText()}`);\r\n        }\r\n        this.variable = variable.content;\r\n        this.collection = collectionToken;\r\n        this.args = new Hash(this.tokenizer, liquid.options.keyValueSeparator);\r\n        this.templates = [];\r\n        let p;\r\n        const stream = parser.parseStream(remainTokens)\r\n            .on('start', () => (p = this.templates))\r\n            .on('tag:endtablerow', () => stream.stop())\r\n            .on('template', (tpl) => p.push(tpl))\r\n            .on('end', () => {\r\n            throw new Error(`tag ${tagToken.getText()} not closed`);\r\n        });\r\n        stream.start();\r\n    }\r\n    *render(ctx, emitter) {\r\n        let collection = toEnumerable(yield evalToken(this.collection, ctx));\r\n        const args = (yield this.args.render(ctx));\r\n        const offset = args.offset || 0;\r\n        const limit = (args.limit === undefined) ? collection.length : args.limit;\r\n        collection = collection.slice(offset, offset + limit);\r\n        const cols = args.cols || collection.length;\r\n        const r = this.liquid.renderer;\r\n        const tablerowloop = new TablerowloopDrop(collection.length, cols, this.collection.getText(), this.variable);\r\n        const scope = { tablerowloop };\r\n        ctx.push(scope);\r\n        for (let idx = 0; idx < collection.length; idx++, tablerowloop.next()) {\r\n            scope[this.variable] = collection[idx];\r\n            if (tablerowloop.col0() === 0) {\r\n                if (tablerowloop.row() !== 1)\r\n                    emitter.write('</tr>');\r\n                emitter.write(`<tr class=\"row${tablerowloop.row()}\">`);\r\n            }\r\n            emitter.write(`<td class=\"col${tablerowloop.col()}\">`);\r\n            yield r.renderTemplates(this.templates, ctx, emitter);\r\n            emitter.write('</td>');\r\n        }\r\n        if (collection.length)\r\n            emitter.write('</tr>');\r\n        ctx.pop();\r\n    }\r\n    *children() {\r\n        return this.templates;\r\n    }\r\n    *arguments() {\r\n        yield this.collection;\r\n        for (const v of Object.values(this.args.hash)) {\r\n            if (isValueToken(v)) {\r\n                yield v;\r\n            }\r\n        }\r\n    }\r\n    blockScope() {\r\n        return [this.variable, 'tablerowloop'];\r\n    }\r\n}\n\nclass UnlessTag extends Tag {\r\n    constructor(tagToken, remainTokens, liquid, parser) {\r\n        super(tagToken, remainTokens, liquid);\r\n        this.branches = [];\r\n        this.elseTemplates = [];\r\n        let p = [];\r\n        let elseCount = 0;\r\n        parser.parseStream(remainTokens)\r\n            .on('start', () => this.branches.push({\r\n            value: new Value(tagToken.tokenizer.readFilteredValue(), this.liquid),\r\n            test: isFalsy,\r\n            templates: (p = [])\r\n        }))\r\n            .on('tag:elsif', (token) => {\r\n            if (elseCount > 0) {\r\n                p = [];\r\n                return;\r\n            }\r\n            this.branches.push({\r\n                value: new Value(token.tokenizer.readFilteredValue(), this.liquid),\r\n                test: isTruthy,\r\n                templates: (p = [])\r\n            });\r\n        })\r\n            .on('tag:else', () => {\r\n            elseCount++;\r\n            p = this.elseTemplates;\r\n        })\r\n            .on('tag:endunless', function () { this.stop(); })\r\n            .on('template', (tpl) => {\r\n            if (p !== this.elseTemplates || elseCount === 1) {\r\n                p.push(tpl);\r\n            }\r\n        })\r\n            .on('end', () => { throw new Error(`tag ${tagToken.getText()} not closed`); })\r\n            .start();\r\n    }\r\n    *render(ctx, emitter) {\r\n        const r = this.liquid.renderer;\r\n        for (const { value, test, templates } of this.branches) {\r\n            const v = yield value.value(ctx, ctx.opts.lenientIf);\r\n            if (test(v, ctx)) {\r\n                yield r.renderTemplates(templates, ctx, emitter);\r\n                return;\r\n            }\r\n        }\r\n        yield r.renderTemplates(this.elseTemplates, ctx, emitter);\r\n    }\r\n    *children() {\r\n        const children = this.branches.flatMap(b => b.templates);\r\n        if (this.elseTemplates) {\r\n            children.push(...this.elseTemplates);\r\n        }\r\n        return children;\r\n    }\r\n    arguments() {\r\n        return this.branches.map(b => b.value);\r\n    }\r\n}\n\nclass BreakTag extends Tag {\r\n    render(ctx, _emitter) {\r\n        ctx.breakCalled = true;\r\n    }\r\n}\n\nclass ContinueTag extends Tag {\r\n    render(ctx, _emitter) {\r\n        ctx.continueCalled = true;\r\n    }\r\n}\n\nclass EchoTag extends Tag {\r\n    constructor(token, remainTokens, liquid) {\r\n        super(token, remainTokens, liquid);\r\n        this.tokenizer.skipBlank();\r\n        if (!this.tokenizer.end()) {\r\n            this.value = new Value(this.tokenizer.readFilteredValue(), this.liquid);\r\n        }\r\n    }\r\n    *render(ctx, emitter) {\r\n        if (!this.value)\r\n            return;\r\n        const val = yield this.value.value(ctx, false);\r\n        emitter.write(val);\r\n    }\r\n    *arguments() {\r\n        if (this.value) {\r\n            yield this.value;\r\n        }\r\n    }\r\n}\n\nclass LiquidTag extends Tag {\r\n    constructor(token, remainTokens, liquid, parser) {\r\n        super(token, remainTokens, liquid);\r\n        const tokens = this.tokenizer.readLiquidTagTokens(this.liquid.options);\r\n        this.templates = parser.parseTokens(tokens);\r\n    }\r\n    *render(ctx, emitter) {\r\n        yield this.liquid.renderer.renderTemplates(this.templates, ctx, emitter);\r\n    }\r\n    *children() {\r\n        return this.templates;\r\n    }\r\n}\n\nclass InlineCommentTag extends Tag {\r\n    constructor(tagToken, remainTokens, liquid) {\r\n        super(tagToken, remainTokens, liquid);\r\n        if (tagToken.args.search(/\\n\\s*[^#\\s]/g) !== -1) {\r\n            throw new Error('every line of an inline comment must start with a \\'#\\' character');\r\n        }\r\n    }\r\n    render() { }\r\n}\n\nconst tags = {\r\n    assign: AssignTag,\r\n    'for': ForTag,\r\n    capture: CaptureTag,\r\n    'case': CaseTag,\r\n    comment: CommentTag,\r\n    include: IncludeTag,\r\n    render: RenderTag,\r\n    decrement: DecrementTag,\r\n    increment: IncrementTag,\r\n    cycle: CycleTag,\r\n    'if': IfTag,\r\n    layout: LayoutTag,\r\n    block: BlockTag,\r\n    raw: RawTag,\r\n    tablerow: TablerowTag,\r\n    unless: UnlessTag,\r\n    'break': BreakTag,\r\n    'continue': ContinueTag,\r\n    echo: EchoTag,\r\n    liquid: LiquidTag,\r\n    '#': InlineCommentTag\r\n};\n\nclass Liquid {\r\n    constructor(opts = {}) {\r\n        this.renderer = new Render();\r\n        this.filters = {};\r\n        this.tags = {};\r\n        this.options = normalize(opts);\r\n        // eslint-disable-next-line deprecation/deprecation\r\n        this.parser = new Parser(this);\r\n        forOwn(tags, (conf, name) => this.registerTag(name, conf));\r\n        forOwn(filters, (handler, name) => this.registerFilter(name, handler));\r\n    }\r\n    parse(html, filepath) {\r\n        const parser = new Parser(this);\r\n        return parser.parse(html, filepath);\r\n    }\r\n    _render(tpl, scope, renderOptions) {\r\n        const ctx = scope instanceof Context ? scope : new Context(scope, this.options, renderOptions);\r\n        return this.renderer.renderTemplates(tpl, ctx);\r\n    }\r\n    render(tpl, scope, renderOptions) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            return toPromise(this._render(tpl, scope, Object.assign(Object.assign({}, renderOptions), { sync: false })));\r\n        });\r\n    }\r\n    renderSync(tpl, scope, renderOptions) {\r\n        return toValueSync(this._render(tpl, scope, Object.assign(Object.assign({}, renderOptions), { sync: true })));\r\n    }\r\n    renderToNodeStream(tpl, scope, renderOptions = {}) {\r\n        const ctx = new Context(scope, this.options, renderOptions);\r\n        return this.renderer.renderTemplatesToNodeStream(tpl, ctx);\r\n    }\r\n    _parseAndRender(html, scope, renderOptions) {\r\n        const tpl = this.parse(html);\r\n        return this._render(tpl, scope, renderOptions);\r\n    }\r\n    parseAndRender(html, scope, renderOptions) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            return toPromise(this._parseAndRender(html, scope, Object.assign(Object.assign({}, renderOptions), { sync: false })));\r\n        });\r\n    }\r\n    parseAndRenderSync(html, scope, renderOptions) {\r\n        return toValueSync(this._parseAndRender(html, scope, Object.assign(Object.assign({}, renderOptions), { sync: true })));\r\n    }\r\n    _parsePartialFile(file, sync, currentFile) {\r\n        return new Parser(this).parseFile(file, sync, LookupType.Partials, currentFile);\r\n    }\r\n    _parseLayoutFile(file, sync, currentFile) {\r\n        return new Parser(this).parseFile(file, sync, LookupType.Layouts, currentFile);\r\n    }\r\n    _parseFile(file, sync, lookupType, currentFile) {\r\n        return new Parser(this).parseFile(file, sync, lookupType, currentFile);\r\n    }\r\n    parseFile(file, lookupType) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            return toPromise(new Parser(this).parseFile(file, false, lookupType));\r\n        });\r\n    }\r\n    parseFileSync(file, lookupType) {\r\n        return toValueSync(new Parser(this).parseFile(file, true, lookupType));\r\n    }\r\n    *_renderFile(file, ctx, renderFileOptions) {\r\n        const templates = (yield this._parseFile(file, renderFileOptions.sync, renderFileOptions.lookupType));\r\n        return yield this._render(templates, ctx, renderFileOptions);\r\n    }\r\n    renderFile(file, ctx, renderFileOptions) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            return toPromise(this._renderFile(file, ctx, Object.assign(Object.assign({}, renderFileOptions), { sync: false })));\r\n        });\r\n    }\r\n    renderFileSync(file, ctx, renderFileOptions) {\r\n        return toValueSync(this._renderFile(file, ctx, Object.assign(Object.assign({}, renderFileOptions), { sync: true })));\r\n    }\r\n    renderFileToNodeStream(file, scope, renderOptions) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            const templates = yield this.parseFile(file);\r\n            return this.renderToNodeStream(templates, scope, renderOptions);\r\n        });\r\n    }\r\n    _evalValue(str, scope) {\r\n        const value = new Value(str, this);\r\n        const ctx = scope instanceof Context ? scope : new Context(scope, this.options);\r\n        return value.value(ctx);\r\n    }\r\n    evalValue(str, scope) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            return toPromise(this._evalValue(str, scope));\r\n        });\r\n    }\r\n    evalValueSync(str, scope) {\r\n        return toValueSync(this._evalValue(str, scope));\r\n    }\r\n    registerFilter(name, filter) {\r\n        this.filters[name] = filter;\r\n    }\r\n    registerTag(name, tag) {\r\n        this.tags[name] = isFunction(tag) ? tag : createTagClass(tag);\r\n    }\r\n    plugin(plugin) {\r\n        return plugin.call(this, Liquid);\r\n    }\r\n    express() {\r\n        const self = this; // eslint-disable-line\r\n        let firstCall = true;\r\n        return function (filePath, ctx, callback) {\r\n            if (firstCall) {\r\n                firstCall = false;\r\n                const dirs = normalizeDirectoryList(this.root);\r\n                self.options.root.unshift(...dirs);\r\n                self.options.layouts.unshift(...dirs);\r\n                self.options.partials.unshift(...dirs);\r\n            }\r\n            self.renderFile(filePath, ctx).then(html => callback(null, html), callback);\r\n        };\r\n    }\r\n    analyze(template, options = {}) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            return analyze(template, options);\r\n        });\r\n    }\r\n    analyzeSync(template, options = {}) {\r\n        return analyzeSync(template, options);\r\n    }\r\n    parseAndAnalyze(html, filename, options = {}) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            return analyze(this.parse(html, filename), options);\r\n        });\r\n    }\r\n    parseAndAnalyzeSync(html, filename, options = {}) {\r\n        return analyzeSync(this.parse(html, filename), options);\r\n    }\r\n    /** Return an array of all variables without their properties. */\r\n    variables(template, options = {}) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            const analysis = yield analyze(isString(template) ? this.parse(template) : template, options);\r\n            return Object.keys(analysis.variables);\r\n        });\r\n    }\r\n    /** Return an array of all variables without their properties. */\r\n    variablesSync(template, options = {}) {\r\n        const analysis = analyzeSync(isString(template) ? this.parse(template) : template, options);\r\n        return Object.keys(analysis.variables);\r\n    }\r\n    /** Return an array of all variables including their properties/paths. */\r\n    fullVariables(template, options = {}) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            const analysis = yield analyze(isString(template) ? this.parse(template) : template, options);\r\n            return Array.from(new Set(Object.values(analysis.variables).flatMap((a) => a.map((v) => String(v)))));\r\n        });\r\n    }\r\n    /** Return an array of all variables including their properties/paths. */\r\n    fullVariablesSync(template, options = {}) {\r\n        const analysis = analyzeSync(isString(template) ? this.parse(template) : template, options);\r\n        return Array.from(new Set(Object.values(analysis.variables).flatMap((a) => a.map((v) => String(v)))));\r\n    }\r\n    /** Return an array of all variables, each as an array of properties/segments. */\r\n    variableSegments(template, options = {}) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            const analysis = yield analyze(isString(template) ? this.parse(template) : template, options);\r\n            return Array.from(strictUniq(Object.values(analysis.variables).flatMap((a) => a.map((v) => v.toArray()))));\r\n        });\r\n    }\r\n    /** Return an array of all variables, each as an array of properties/segments. */\r\n    variableSegmentsSync(template, options = {}) {\r\n        const analysis = analyzeSync(isString(template) ? this.parse(template) : template, options);\r\n        return Array.from(strictUniq(Object.values(analysis.variables).flatMap((a) => a.map((v) => v.toArray()))));\r\n    }\r\n    /** Return an array of all expected context variables without their properties. */\r\n    globalVariables(template, options = {}) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            const analysis = yield analyze(isString(template) ? this.parse(template) : template, options);\r\n            return Object.keys(analysis.globals);\r\n        });\r\n    }\r\n    /** Return an array of all expected context variables without their properties. */\r\n    globalVariablesSync(template, options = {}) {\r\n        const analysis = analyzeSync(isString(template) ? this.parse(template) : template, options);\r\n        return Object.keys(analysis.globals);\r\n    }\r\n    /** Return an array of all expected context variables including their properties/paths. */\r\n    globalFullVariables(template, options = {}) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            const analysis = yield analyze(isString(template) ? this.parse(template) : template, options);\r\n            return Array.from(new Set(Object.values(analysis.globals).flatMap((a) => a.map((v) => String(v)))));\r\n        });\r\n    }\r\n    /** Return an array of all expected context variables including their properties/paths. */\r\n    globalFullVariablesSync(template, options = {}) {\r\n        const analysis = analyzeSync(isString(template) ? this.parse(template) : template, options);\r\n        return Array.from(new Set(Object.values(analysis.globals).flatMap((a) => a.map((v) => String(v)))));\r\n    }\r\n    /** Return an array of all expected context variables, each as an array of properties/segments. */\r\n    globalVariableSegments(template, options = {}) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            const analysis = yield analyze(isString(template) ? this.parse(template) : template, options);\r\n            return Array.from(strictUniq(Object.values(analysis.globals).flatMap((a) => a.map((v) => v.toArray()))));\r\n        });\r\n    }\r\n    /** Return an array of all expected context variables, each as an array of properties/segments. */\r\n    globalVariableSegmentsSync(template, options = {}) {\r\n        const analysis = analyzeSync(isString(template) ? this.parse(template) : template, options);\r\n        return Array.from(strictUniq(Object.values(analysis.globals).flatMap((a) => a.map((v) => v.toArray()))));\r\n    }\r\n}\n\n/* istanbul ignore file */\r\nconst version = '[VI]{version}[/VI]';\n\nexport { AssertionError, AssignTag, BlockTag, BreakTag, CaptureTag, CaseTag, CommentTag, Context, ContinueTag, CycleTag, DecrementTag, Drop, EchoTag, Expression, Filter, ForTag, Hash, IfTag, IncludeTag, IncrementTag, InlineCommentTag, LayoutTag, Liquid, LiquidError, LiquidTag, Output, ParseError, ParseStream, Parser, RawTag, RenderError, RenderTag, TablerowTag, Tag, TagToken, Token, TokenKind, TokenizationError, Tokenizer, typeGuards as TypeGuards, UndefinedVariableError, UnlessTag, Value, Variable, analyze, analyzeSync, assert, createTrie, defaultOperators, defaultOptions, evalQuotedToken, evalToken, filters, isFalsy, isTruthy, tags, toPromise, toValue, toValueSync, version };\n","/**\n * Liquid Template Engine\n *\n * Shopify's Liquid templating with powerful filters and safe execution\n */\n\nimport { Liquid } from 'liquidjs'\nimport type { TemplateContext } from '../types.js'\nimport { BaseTemplateEngine } from './base.js'\n\n/**\n * Liquid template engine\n */\nexport class LiquidTemplateEngine extends BaseTemplateEngine {\n  name = 'liquid'\n  private liquid: Liquid\n  private compiledTemplates: Map<string, any> = new Map()\n\n  constructor() {\n    super()\n    this.liquid = new Liquid({\n      cache: true,\n      strictFilters: false, // Allow undefined filters to fail gracefully\n      strictVariables: false, // Allow undefined variables\n      trimTagLeft: false,\n      trimTagRight: false,\n      trimOutputLeft: false,\n      trimOutputRight: false,\n    })\n\n    // Register custom filters\n    this.registerDefaultFilters()\n  }\n\n  /**\n   * Render a template with Liquid\n   */\n  async render(template: string, context: TemplateContext): Promise<string> {\n    try {\n      // Check if we have a compiled version\n      let compiledTemplate = this.compiledTemplates.get(template)\n\n      if (!compiledTemplate) {\n        compiledTemplate = this.liquid.parse(template)\n        // Cache compiled template for reuse\n        this.compiledTemplates.set(template, compiledTemplate)\n      }\n\n      // Handle both structured context {data: {...}} and flat context {...}\n      // This ensures compatibility with how the HTML agent passes context\n      const hasDataProperty = 'data' in context && context.data !== undefined\n      const data = hasDataProperty ? (context.data as TemplateContext) : context\n\n      return await this.liquid.render(compiledTemplate, data)\n    } catch (error) {\n      throw new Error(\n        `Liquid render error: ${error instanceof Error ? error.message : String(error)}`\n      )\n    }\n  }\n\n  /**\n   * Validate template syntax\n   */\n  async validate(template: string): Promise<{ valid: boolean; errors?: string[] }> {\n    try {\n      this.liquid.parse(template)\n      return { valid: true }\n    } catch (error) {\n      return {\n        valid: false,\n        errors: [error instanceof Error ? error.message : String(error)],\n      }\n    }\n  }\n\n  /**\n   * Compile a template for repeated use\n   */\n  async compile(template: string): Promise<any> {\n    const compiled = this.liquid.parse(template)\n    this.compiledTemplates.set(template, compiled)\n    return compiled\n  }\n\n  /**\n   * Register a helper function (Liquid calls them filters)\n   */\n  registerHelper(name: string, fn: (...args: unknown[]) => unknown): void {\n    this.liquid.registerFilter(name, fn)\n  }\n\n  /**\n   * Register default filters\n   */\n  private registerDefaultFilters(): void {\n    // Money filter - format as currency\n    this.liquid.registerFilter('money', (value: any) => {\n      const num = parseFloat(value)\n      if (isNaN(num)) return value\n      return `$${num.toFixed(2)}`\n    })\n\n    // Money with currency\n    this.liquid.registerFilter('money_with_currency', (value: any, currency = 'USD') => {\n      const num = parseFloat(value)\n      if (isNaN(num)) return value\n      return new Intl.NumberFormat('en-US', {\n        style: 'currency',\n        currency: currency,\n      }).format(num)\n    })\n\n    // Phone filter - format phone number\n    this.liquid.registerFilter('phone', (value: string) => {\n      const cleaned = value.replace(/\\D/g, '')\n      if (cleaned.length === 10) {\n        return `(${cleaned.slice(0, 3)}) ${cleaned.slice(3, 6)}-${cleaned.slice(6)}`\n      }\n      return value\n    })\n\n    // Pluralize filter\n    this.liquid.registerFilter('pluralize', (count: number, singular: string, plural?: string) => {\n      if (count === 1) return singular\n      return plural || `${singular}s`\n    })\n\n    // Default filter (like Handlebars default helper)\n    this.liquid.registerFilter('default', (value: any, defaultValue: any) => {\n      return value ?? defaultValue\n    })\n\n    // JSON filter\n    this.liquid.registerFilter('json', (obj: any) => {\n      try {\n        return JSON.stringify(obj, null, 2)\n      } catch {\n        return String(obj)\n      }\n    })\n\n    // Excerpt filter - truncate with ellipsis\n    this.liquid.registerFilter('excerpt', (text: string, length = 200) => {\n      if (typeof text !== 'string') return text\n      if (text.length <= length) return text\n      return text.substring(0, length).trim() + '...'\n    })\n\n    // Strip HTML tags\n    this.liquid.registerFilter('strip_html', (text: string) => {\n      if (typeof text !== 'string') return text\n      return text.replace(/<[^>]*>/g, '')\n    })\n\n    // Highlight filter - wrap search term in mark tags\n    this.liquid.registerFilter('highlight', (text: string, term: string) => {\n      if (!text || !term) return text\n      const regex = new RegExp(`(${term})`, 'gi')\n      return text.replace(regex, '<mark>$1</mark>')\n    })\n\n    // File size filter\n    this.liquid.registerFilter('file_size', (bytes: number) => {\n      if (bytes === 0) return '0 Bytes'\n      const k = 1024\n      const sizes = ['Bytes', 'KB', 'MB', 'GB']\n      const i = Math.floor(Math.log(bytes) / Math.log(k))\n      return Math.round((bytes / Math.pow(k, i)) * 100) / 100 + ' ' + sizes[i]\n    })\n\n    // Time ago filter\n    this.liquid.registerFilter('time_ago', (date: Date | string) => {\n      const d = date instanceof Date ? date : new Date(date)\n      const now = new Date()\n      const seconds = Math.floor((now.getTime() - d.getTime()) / 1000)\n\n      const intervals = [\n        { label: 'year', seconds: 31536000 },\n        { label: 'month', seconds: 2592000 },\n        { label: 'week', seconds: 604800 },\n        { label: 'day', seconds: 86400 },\n        { label: 'hour', seconds: 3600 },\n        { label: 'minute', seconds: 60 },\n        { label: 'second', seconds: 1 },\n      ]\n\n      for (const interval of intervals) {\n        const count = Math.floor(seconds / interval.seconds)\n        if (count >= 1) {\n          return `${count} ${interval.label}${count > 1 ? 's' : ''} ago`\n        }\n      }\n\n      return 'just now'\n    })\n  }\n\n  /**\n   * Clear the template cache\n   */\n  clearCache(): void {\n    this.compiledTemplates.clear()\n  }\n}\n","/**\n * Think Agent - Refactored with Provider System\n *\n * Handles AI reasoning using composition-based provider system.\n * Reduced from 355 lines to ~160 lines through proper abstraction.\n *\n * Auto-detection: Provider is automatically detected from model name:\n * - Models starting with @cf/  Cloudflare Workers AI\n * - Models starting with gpt- or o1-  OpenAI\n * - Models starting with claude-  Anthropic\n *\n * Default model: claude-3-5-haiku-20241022 (Anthropic Haiku 3.5)\n * Default provider: anthropic (when model doesn't match auto-detection patterns)\n */\n\nimport { BaseAgent, type AgentExecutionContext } from './base-agent.js'\nimport type { AgentConfig } from '../runtime/parser.js'\nimport { getProviderRegistry, type ProviderRegistry } from './think-providers/index.js'\nimport type { AIMessage, AIProviderConfig, AIProviderResponse } from './think-providers/index.js'\nimport { AIProvider } from '../types/constants.js'\nimport type { ConductorEnv } from '../types/env.js'\nimport { resolveValue, type ComponentResolutionContext } from '../utils/component-resolver.js'\nimport { SimpleTemplateEngine } from '../utils/templates/engines/simple.js'\nimport { LiquidTemplateEngine } from '../utils/templates/engines/liquid.js'\nimport type { BaseTemplateEngine } from '../utils/templates/engines/base.js'\n\nexport interface ThinkConfig {\n  model?: string\n  provider?: AIProvider\n  temperature?: number\n  maxTokens?: number\n  apiKey?: string\n  apiEndpoint?: string\n  systemPrompt?: string\n  prompt?: string // Reference to versioned prompt (e.g., \"company-analysis-prompt@v1.0.0\")\n  schema?: string | Record<string, unknown> // Reference to versioned schema (e.g., \"schemas/invoice@v1\") or inline schema\n  templateEngine?: 'simple' | 'liquid' // Template engine for systemPrompt rendering (default: 'simple', Cloudflare Workers compatible)\n}\n\nexport interface ThinkInput {\n  prompt?: string\n  messages?: Array<{ role: string; content: string }>\n  [key: string]: unknown\n}\n\n/**\n * Think Agent - Executes AI reasoning via provider system\n */\nexport class ThinkAgent extends BaseAgent {\n  private thinkConfig: ThinkConfig\n  private providerRegistry: ProviderRegistry\n  private templateEngine: BaseTemplateEngine\n\n  constructor(config: AgentConfig, providerRegistry?: ProviderRegistry) {\n    super(config)\n\n    // Use injected registry for testing, or global registry for production\n    this.providerRegistry = providerRegistry || getProviderRegistry()\n\n    const cfg = config.config as ThinkConfig | undefined\n\n    // Initialize template engine based on config (default: simple - Workers compatible)\n    const engineType = cfg?.templateEngine || 'simple'\n    switch (engineType) {\n      case 'simple':\n        this.templateEngine = new SimpleTemplateEngine()\n        break\n      case 'liquid':\n        this.templateEngine = new LiquidTemplateEngine()\n        break\n      default:\n        this.templateEngine = new SimpleTemplateEngine()\n        break\n    }\n\n    const model = cfg?.model || 'claude-3-5-haiku-20241022'\n\n    // Auto-detect provider from model name if not explicitly set\n    const provider = cfg?.provider || this.detectProvider(model)\n\n    this.thinkConfig = {\n      model,\n      provider,\n      temperature: cfg?.temperature || 0.7,\n      maxTokens: cfg?.maxTokens || 1000,\n      apiKey: cfg?.apiKey,\n      apiEndpoint: cfg?.apiEndpoint,\n      systemPrompt: cfg?.systemPrompt,\n      prompt: cfg?.prompt,\n      schema: cfg?.schema,\n    }\n  }\n\n  /**\n   * Auto-detect AI provider from model name\n   */\n  private detectProvider(model: string): AIProvider {\n    // Cloudflare Workers AI models start with @cf/\n    if (model.startsWith('@cf/')) {\n      return AIProvider.Cloudflare\n    }\n\n    // OpenAI models (gpt-*, o1-*, etc.)\n    if (model.startsWith('gpt-') || model.startsWith('o1-') || model.startsWith('text-')) {\n      return AIProvider.OpenAI\n    }\n\n    // Anthropic models (claude-*)\n    if (model.startsWith('claude-')) {\n      return AIProvider.Anthropic\n    }\n\n    // Default to Anthropic for unknown models\n    return AIProvider.Anthropic\n  }\n\n  /**\n   * Execute AI reasoning via provider system\n   *\n   * Output Design Philosophy:\n   * \n   * Think agents return output that's intuitive to use in ensembles:\n   *\n   * 1. If schema defines output fields  AI response maps to those fields\n   *    Schema: { output: { greeting: string } }\n   *    Output: { greeting: \"Hello!\", _meta: { model, provider, tokens } }\n   *    Usage:  ${agent.output.greeting}\n   *\n   * 2. If no schema  AI response is the direct output value\n   *    Output: \"Hello!\"  (string, not wrapped in object)\n   *    Usage:  ${agent.output}\n   *\n   * 3. If AI returns JSON  parsed and spread as output fields\n   *    Output: { name: \"John\", age: 30, _meta: {...} }\n   *    Usage:  ${agent.output.name}, ${agent.output.age}\n   *\n   * The _meta field contains provider details (model, tokens, etc.)\n   * for debugging/logging, but user data is always top-level.\n   */\n  protected async run(context: AgentExecutionContext): Promise<unknown> {\n    const { input, env } = context\n\n    // Load versioned prompt if configured\n    await this.resolvePrompt(env)\n\n    // Render template variables in systemPrompt (e.g., {{input.name}})\n    // Uses configurable template engine (simple or liquid) - both are Cloudflare Workers compatible\n    if (this.thinkConfig.systemPrompt) {\n      const logger = context.logger\n      logger?.debug('Template rendering started', {\n        agentName: this.getName(),\n        templateLength: this.thinkConfig.systemPrompt.length,\n      })\n      try {\n        this.thinkConfig.systemPrompt = await this.templateEngine.render(\n          this.thinkConfig.systemPrompt,\n          {\n            input,\n            env,\n            context,\n          }\n        )\n        logger?.debug('Template rendering completed', {\n          agentName: this.getName(),\n          renderedLength: this.thinkConfig.systemPrompt.length,\n        })\n      } catch (error) {\n        logger?.error('Template rendering failed', error instanceof Error ? error : undefined, {\n          agentName: this.getName(),\n        })\n        throw new Error(\n          `Failed to render systemPrompt template: ${error instanceof Error ? error.message : String(error)}`\n        )\n      }\n    }\n\n    // Load versioned schema if configured\n    await this.resolveSchema(env)\n\n    // Get provider from registry\n    const providerId = this.thinkConfig.provider || AIProvider.Anthropic\n    const provider = this.providerRegistry.get(providerId)\n\n    if (!provider) {\n      throw new Error(\n        `Unknown AI provider: ${providerId}. ` +\n          `Available providers: ${this.providerRegistry.getProviderIds().join(', ')}`\n      )\n    }\n\n    // Build provider config\n    const providerConfig: AIProviderConfig = {\n      model: this.thinkConfig.model || 'claude-3-5-haiku-20241022',\n      temperature: this.thinkConfig.temperature,\n      maxTokens: this.thinkConfig.maxTokens,\n      apiKey: this.thinkConfig.apiKey,\n      apiEndpoint: this.thinkConfig.apiEndpoint,\n      systemPrompt: this.thinkConfig.systemPrompt,\n      schema: this.thinkConfig.schema,\n    }\n\n    // Validate configuration\n    const configError = provider.getConfigError(providerConfig, env)\n    if (configError) {\n      throw new Error(configError)\n    }\n\n    // Build messages from input\n    const messages = this.buildMessages(input)\n\n    // Execute via provider\n    const response = await provider.execute({\n      messages,\n      config: providerConfig,\n      env,\n    })\n\n    // Transform to user-friendly output structure\n    return this.buildOutput(response)\n  }\n\n  /**\n   * Build user-friendly output from AI provider response\n   *\n   * Design Goals:\n   * 1. Schema-defined fields are top-level (not nested under 'content')\n   * 2. Metadata is accessible but doesn't pollute user data\n   * 3. Works intuitively with ${agent.output.fieldName} syntax\n   */\n  private buildOutput(response: AIProviderResponse): unknown {\n    const outputSchema = this.config.schema?.output as Record<string, unknown> | undefined\n\n    // Metadata available as _meta for debugging/logging\n    const meta = {\n      model: response.model,\n      provider: response.provider,\n      tokensUsed: response.tokensUsed,\n      ...(response.metadata || {}),\n    }\n\n    // Try to parse JSON from AI response (common for structured output)\n    let parsedContent: unknown = null\n    try {\n      parsedContent = JSON.parse(response.content)\n    } catch {\n      // Not JSON, use raw content\n    }\n\n    // Case 1: AI returned valid JSON object  spread as top-level fields\n    if (parsedContent && typeof parsedContent === 'object' && !Array.isArray(parsedContent)) {\n      return {\n        ...parsedContent,\n        _meta: meta,\n      }\n    }\n\n    // Case 2: Schema defines output fields  map content to schema field(s)\n    if (outputSchema && typeof outputSchema === 'object') {\n      const schemaFields = Object.keys(outputSchema)\n\n      if (schemaFields.length === 1) {\n        // Single field schema: map content directly to that field\n        // Schema: { message: string }  Output: { message: \"Hello!\", _meta: {...} }\n        const fieldName = schemaFields[0]\n        return {\n          [fieldName]: parsedContent ?? response.content,\n          _meta: meta,\n        }\n      } else if (schemaFields.length > 1) {\n        // Multi-field schema but AI didn't return JSON - put in first field\n        // This is a fallback; ideally AI returns structured JSON\n        const fieldName = schemaFields[0]\n        return {\n          [fieldName]: parsedContent ?? response.content,\n          _meta: meta,\n        }\n      }\n    }\n\n    // Case 3: No schema, AI returned array  wrap with _meta\n    if (Array.isArray(parsedContent)) {\n      return {\n        items: parsedContent,\n        _meta: meta,\n      }\n    }\n\n    // Case 4: No schema, simple string response  return content directly\n    // This allows ${agent.output} to get the string value\n    // But also allows ${agent.output._meta.model} for metadata\n    return {\n      content: response.content,\n      _meta: meta,\n    }\n  }\n\n  /**\n   * Resolve prompt from Edgit if needed\n   */\n  private async resolvePrompt(env: ConductorEnv): Promise<void> {\n    // If systemPrompt already set inline, use it\n    if (this.thinkConfig.systemPrompt) return\n\n    // If prompt reference configured, resolve it\n    if (this.thinkConfig.prompt) {\n      const context: ComponentResolutionContext = {\n        env,\n        baseDir: process.cwd(),\n      }\n\n      try {\n        const resolved = await resolveValue(this.thinkConfig.prompt, context)\n\n        // Set resolved content as systemPrompt\n        if (typeof resolved.content === 'string') {\n          this.thinkConfig.systemPrompt = resolved.content\n        } else {\n          throw new Error(`Prompt must resolve to a string, got ${typeof resolved.content}`)\n        }\n      } catch (error) {\n        throw new Error(\n          `Failed to resolve prompt \"${this.thinkConfig.prompt}\": ${\n            error instanceof Error ? error.message : String(error)\n          }`\n        )\n      }\n    }\n  }\n\n  /**\n   * Resolve schema from Edgit if needed\n   */\n  private async resolveSchema(env: ConductorEnv): Promise<void> {\n    // If schema not configured or already an object, skip resolution\n    if (!this.thinkConfig.schema) return\n    if (typeof this.thinkConfig.schema !== 'string') return\n\n    // If schema is a reference (contains path/name@version format), resolve it\n    const context: ComponentResolutionContext = {\n      env,\n      baseDir: process.cwd(),\n    }\n\n    try {\n      const resolved = await resolveValue(this.thinkConfig.schema, context)\n\n      // Set resolved content as schema (must be an object)\n      if (typeof resolved.content === 'object' && resolved.content !== null) {\n        this.thinkConfig.schema = resolved.content as Record<string, unknown>\n      } else if (typeof resolved.content === 'string') {\n        // Try parsing as JSON if string\n        try {\n          this.thinkConfig.schema = JSON.parse(resolved.content)\n        } catch {\n          throw new Error(`Schema must be valid JSON, got invalid string`)\n        }\n      } else {\n        throw new Error(\n          `Schema must resolve to an object or JSON string, got ${typeof resolved.content}`\n        )\n      }\n    } catch (error) {\n      throw new Error(\n        `Failed to resolve schema \"${this.thinkConfig.schema}\": ${\n          error instanceof Error ? error.message : String(error)\n        }`\n      )\n    }\n  }\n\n  /**\n   * Build messages array from input\n   */\n  private buildMessages(input: ThinkInput): AIMessage[] {\n    const messages: AIMessage[] = []\n\n    // Add system prompt if configured\n    if (this.thinkConfig.systemPrompt) {\n      messages.push({\n        role: 'system',\n        content: this.thinkConfig.systemPrompt,\n      })\n    }\n\n    // If input has messages array, use it\n    if (input.messages && Array.isArray(input.messages)) {\n      messages.push(...(input.messages as AIMessage[]))\n    }\n    // Otherwise, build from prompt\n    else if (input.prompt) {\n      messages.push({\n        role: 'user',\n        content: input.prompt,\n      })\n    }\n    // Build prompt from input data\n    else {\n      const promptParts: string[] = []\n      for (const [key, value] of Object.entries(input)) {\n        if (typeof value === 'string') {\n          promptParts.push(`${key}: ${value}`)\n        } else {\n          promptParts.push(`${key}: ${JSON.stringify(value, null, 2)}`)\n        }\n      }\n\n      messages.push({\n        role: 'user',\n        content: promptParts.join('\\n\\n'),\n      })\n    }\n\n    return messages\n  }\n\n  /**\n   * Get Think configuration\n   */\n  getThinkConfig(): ThinkConfig {\n    return { ...this.thinkConfig }\n  }\n}\n","/**\n * Repository Pattern for Storage Abstraction\n *\n * Provides a unified interface for all storage operations across\n * different storage backends (KV, D1, R2, etc.)\n */\n\nimport type { Result } from '../types/result.js'\nimport type { ConductorError } from '../errors/error-types.js'\n\n/**\n * Generic repository interface for CRUD operations\n */\nexport interface Repository<T, ID = string> {\n  /**\n   * Get a value by ID\n   */\n  get(id: ID): Promise<Result<T, ConductorError>>\n\n  /**\n   * Store a value with an ID\n   */\n  put(id: ID, value: T, options?: PutOptions): Promise<Result<void, ConductorError>>\n\n  /**\n   * Delete a value by ID\n   */\n  delete(id: ID): Promise<Result<void, ConductorError>>\n\n  /**\n   * List values with optional filtering\n   */\n  list(options?: ListOptions): Promise<Result<T[], ConductorError>>\n\n  /**\n   * Check if a key exists\n   */\n  has(id: ID): Promise<Result<boolean, ConductorError>>\n}\n\n/**\n * Options for put operations\n */\nexport interface PutOptions {\n  /**\n   * Time-to-live in seconds\n   */\n  ttl?: number\n\n  /**\n   * Expiration timestamp (Unix timestamp)\n   */\n  expiration?: number\n\n  /**\n   * Custom metadata\n   */\n  metadata?: Record<string, string>\n}\n\n/**\n * Options for list operations\n */\nexport interface ListOptions {\n  /**\n   * Key prefix filter\n   */\n  prefix?: string\n\n  /**\n   * Maximum number of items to return\n   */\n  limit?: number\n\n  /**\n   * Pagination cursor\n   */\n  cursor?: string\n}\n\n/**\n * Result of list operation with pagination\n */\nexport interface ListResult<T> {\n  items: T[]\n  cursor?: string\n  complete: boolean\n}\n\n/**\n * Serializer interface for converting values to/from storage format\n */\nexport interface Serializer<T> {\n  serialize(value: T): string\n  deserialize(raw: string): T\n}\n\n/**\n * JSON serializer - works for most objects\n */\nexport class JSONSerializer<T> implements Serializer<T> {\n  serialize(value: T): string {\n    return JSON.stringify(value)\n  }\n\n  deserialize(raw: string): T {\n    return JSON.parse(raw) as T\n  }\n}\n\n/**\n * String serializer - passthrough for string values\n */\nexport class StringSerializer implements Serializer<string> {\n  serialize(value: string): string {\n    return value\n  }\n\n  deserialize(raw: string): string {\n    return raw\n  }\n}\n\n/**\n * Binary serializer - for ArrayBuffer/Uint8Array\n */\nexport class BinarySerializer implements Serializer<ArrayBuffer> {\n  serialize(value: ArrayBuffer): string {\n    // Convert to base64 for storage\n    const bytes = new Uint8Array(value)\n    return btoa(String.fromCharCode(...bytes))\n  }\n\n  deserialize(raw: string): ArrayBuffer {\n    // Convert from base64\n    const binaryString = atob(raw)\n    const bytes = new Uint8Array(binaryString.length)\n    for (let i = 0; i < binaryString.length; i++) {\n      bytes[i] = binaryString.charCodeAt(i)\n    }\n    return bytes.buffer\n  }\n}\n","/**\n * Cloudflare KV Repository Implementation\n *\n * Provides a Repository interface over Cloudflare KV namespace.\n */\n\nimport { Result } from '../types/result.js'\nimport { Errors, type ConductorError } from '../errors/error-types.js'\nimport type { Repository, PutOptions, ListOptions, Serializer, ListResult } from './repository.js'\nimport { JSONSerializer } from './repository.js'\n\n/**\n * Repository implementation for Cloudflare KV\n */\nexport class KVRepository<T> implements Repository<T, string> {\n  constructor(\n    private readonly binding: KVNamespace,\n    private readonly serializer: Serializer<T> = new JSONSerializer<T>()\n  ) {}\n\n  /**\n   * Get a value from KV\n   */\n  async get(key: string): Promise<Result<T, ConductorError>> {\n    try {\n      const raw = await this.binding.get(key)\n\n      if (raw === null) {\n        return Result.err(Errors.storageNotFound(key, 'KV'))\n      }\n\n      const value = this.serializer.deserialize(raw)\n      return Result.ok(value)\n    } catch (error) {\n      return Result.err(\n        Errors.internal(\n          `KV get operation failed for key \"${key}\"`,\n          error instanceof Error ? error : undefined\n        )\n      )\n    }\n  }\n\n  /**\n   * Store a value in KV\n   */\n  async put(key: string, value: T, options?: PutOptions): Promise<Result<void, ConductorError>> {\n    try {\n      const serialized = this.serializer.serialize(value)\n\n      const kvOptions: KVNamespacePutOptions = {}\n\n      if (options?.ttl) {\n        kvOptions.expirationTtl = options.ttl\n      }\n\n      if (options?.expiration) {\n        kvOptions.expiration = options.expiration\n      }\n\n      if (options?.metadata) {\n        kvOptions.metadata = options.metadata\n      }\n\n      await this.binding.put(key, serialized, kvOptions)\n      return Result.ok(undefined)\n    } catch (error) {\n      return Result.err(\n        Errors.internal(\n          `KV put operation failed for key \"${key}\"`,\n          error instanceof Error ? error : undefined\n        )\n      )\n    }\n  }\n\n  /**\n   * Delete a value from KV\n   */\n  async delete(key: string): Promise<Result<void, ConductorError>> {\n    try {\n      await this.binding.delete(key)\n      return Result.ok(undefined)\n    } catch (error) {\n      return Result.err(\n        Errors.internal(\n          `KV delete operation failed for key \"${key}\"`,\n          error instanceof Error ? error : undefined\n        )\n      )\n    }\n  }\n\n  /**\n   * List keys in KV\n   */\n  async list(options?: ListOptions): Promise<Result<T[], ConductorError>> {\n    try {\n      const listOptions: KVNamespaceListOptions = {}\n\n      if (options?.prefix) {\n        listOptions.prefix = options.prefix\n      }\n\n      if (options?.limit) {\n        listOptions.limit = options.limit\n      }\n\n      if (options?.cursor) {\n        listOptions.cursor = options.cursor\n      }\n\n      const result = await this.binding.list(listOptions)\n\n      // Fetch all values in parallel batches to avoid N+1 queries\n      // Batch size of 10 balances parallelism vs. API rate limits\n      const BATCH_SIZE = 10\n      const keys = result.keys\n      const values: T[] = []\n\n      for (let i = 0; i < keys.length; i += BATCH_SIZE) {\n        const batch = keys.slice(i, i + BATCH_SIZE)\n        const batchResults = await Promise.all(batch.map((key) => this.get(key.name)))\n\n        for (const getResult of batchResults) {\n          if (getResult.success) {\n            values.push(getResult.value)\n          }\n        }\n      }\n\n      return Result.ok(values)\n    } catch (error) {\n      return Result.err(\n        Errors.internal('KV list operation failed', error instanceof Error ? error : undefined)\n      )\n    }\n  }\n\n  /**\n   * Check if a key exists in KV\n   */\n  async has(key: string): Promise<Result<boolean, ConductorError>> {\n    try {\n      const value = await this.binding.get(key)\n      return Result.ok(value !== null)\n    } catch (error) {\n      return Result.err(\n        Errors.internal(\n          `KV has operation failed for key \"${key}\"`,\n          error instanceof Error ? error : undefined\n        )\n      )\n    }\n  }\n\n  /**\n   * Get value with metadata\n   */\n  async getWithMetadata(\n    key: string\n  ): Promise<Result<{ value: T; metadata?: unknown }, ConductorError>> {\n    try {\n      const result = await this.binding.getWithMetadata(key)\n\n      if (result.value === null) {\n        return Result.err(Errors.storageNotFound(key, 'KV'))\n      }\n\n      const value = this.serializer.deserialize(result.value)\n      return Result.ok({\n        value,\n        metadata: result.metadata,\n      })\n    } catch (error) {\n      return Result.err(\n        Errors.internal(\n          `KV getWithMetadata operation failed for key \"${key}\"`,\n          error instanceof Error ? error : undefined\n        )\n      )\n    }\n  }\n}\n","/**\n * Cloudflare D1 Repository Implementation\n *\n * Provides a Repository interface over Cloudflare D1 (SQL database).\n */\n\nimport { Result } from '../types/result.js'\nimport { Errors, type ConductorError } from '../errors/error-types.js'\nimport type { Repository, PutOptions, ListOptions, Serializer } from './repository.js'\nimport { JSONSerializer } from './repository.js'\n\n/**\n * Validate SQL identifier (table/column name) to prevent SQL injection\n *\n * SQL identifiers must:\n * - Start with a letter or underscore\n * - Contain only letters, numbers, and underscores\n * - Be no longer than 128 characters (reasonable limit)\n *\n * @throws Error if identifier is invalid\n */\nfunction validateSqlIdentifier(identifier: string, type: 'table' | 'column'): string {\n  if (!identifier || typeof identifier !== 'string') {\n    throw new Error(`Invalid ${type} name: must be a non-empty string`)\n  }\n\n  if (identifier.length > 128) {\n    throw new Error(\n      `Invalid ${type} name \"${identifier}\": exceeds maximum length of 128 characters`\n    )\n  }\n\n  // SQL identifier pattern: starts with letter/underscore, contains only alphanumeric/underscore\n  const validIdentifierPattern = /^[a-zA-Z_][a-zA-Z0-9_]*$/\n\n  if (!validIdentifierPattern.test(identifier)) {\n    throw new Error(\n      `Invalid ${type} name \"${identifier}\": must start with a letter or underscore and contain only letters, numbers, and underscores`\n    )\n  }\n\n  return identifier\n}\n\n/**\n * Configuration for D1 repository\n */\nexport interface D1RepositoryConfig {\n  /**\n   * Table name\n   */\n  tableName: string\n\n  /**\n   * ID column name (default: 'id')\n   */\n  idColumn?: string\n\n  /**\n   * Value column name (default: 'value')\n   */\n  valueColumn?: string\n\n  /**\n   * Created at column name (default: 'created_at')\n   */\n  createdAtColumn?: string\n\n  /**\n   * Updated at column name (default: 'updated_at')\n   */\n  updatedAtColumn?: string\n\n  /**\n   * Expiration column name (optional)\n   */\n  expirationColumn?: string\n}\n\n/**\n * Repository implementation for Cloudflare D1\n */\nexport class D1Repository<T> implements Repository<T, string> {\n  private readonly tableName: string\n  private readonly idColumn: string\n  private readonly valueColumn: string\n  private readonly createdAtColumn: string\n  private readonly updatedAtColumn: string\n  private readonly expirationColumn?: string\n\n  constructor(\n    private readonly binding: D1Database,\n    config: D1RepositoryConfig,\n    private readonly serializer: Serializer<T> = new JSONSerializer<T>()\n  ) {\n    // Validate all SQL identifiers at construction time (fail-fast)\n    this.tableName = validateSqlIdentifier(config.tableName, 'table')\n    this.idColumn = validateSqlIdentifier(config.idColumn || 'id', 'column')\n    this.valueColumn = validateSqlIdentifier(config.valueColumn || 'value', 'column')\n    this.createdAtColumn = validateSqlIdentifier(config.createdAtColumn || 'created_at', 'column')\n    this.updatedAtColumn = validateSqlIdentifier(config.updatedAtColumn || 'updated_at', 'column')\n    this.expirationColumn = config.expirationColumn\n      ? validateSqlIdentifier(config.expirationColumn, 'column')\n      : undefined\n  }\n\n  /**\n   * Get a value from D1\n   */\n  async get(id: string): Promise<Result<T, ConductorError>> {\n    try {\n      const query = `\n\t\t\t\tSELECT ${this.valueColumn}, ${this.expirationColumn || 'NULL as expiration'}\n\t\t\t\tFROM ${this.tableName}\n\t\t\t\tWHERE ${this.idColumn} = ?\n\t\t\t`\n\n      const result = await this.binding.prepare(query).bind(id).first()\n\n      if (!result) {\n        return Result.err(Errors.storageNotFound(id, 'D1'))\n      }\n\n      // Check expiration if column exists\n      if (this.expirationColumn && result.expiration) {\n        const expiration = new Date(result.expiration as string).getTime()\n        if (expiration < Date.now()) {\n          // Expired - delete and return not found\n          await this.delete(id)\n          return Result.err(Errors.storageNotFound(id, 'D1'))\n        }\n      }\n\n      const value = this.serializer.deserialize(result[this.valueColumn] as string)\n      return Result.ok(value)\n    } catch (error) {\n      return Result.err(\n        Errors.internal(\n          `D1 get operation failed for id \"${id}\"`,\n          error instanceof Error ? error : undefined\n        )\n      )\n    }\n  }\n\n  /**\n   * Store a value in D1\n   */\n  async put(id: string, value: T, options?: PutOptions): Promise<Result<void, ConductorError>> {\n    try {\n      const serialized = this.serializer.serialize(value)\n      const now = new Date().toISOString()\n\n      let query: string\n      let params: unknown[]\n\n      if (this.expirationColumn && (options?.ttl || options?.expiration)) {\n        const expiration = options.expiration\n          ? new Date(options.expiration * 1000).toISOString()\n          : new Date(Date.now() + options.ttl! * 1000).toISOString()\n\n        query = `\n\t\t\t\t\tINSERT INTO ${this.tableName}\n\t\t\t\t\t(${this.idColumn}, ${this.valueColumn}, ${this.createdAtColumn}, ${this.updatedAtColumn}, ${this.expirationColumn})\n\t\t\t\t\tVALUES (?, ?, ?, ?, ?)\n\t\t\t\t\tON CONFLICT(${this.idColumn})\n\t\t\t\t\tDO UPDATE SET\n\t\t\t\t\t\t${this.valueColumn} = excluded.${this.valueColumn},\n\t\t\t\t\t\t${this.updatedAtColumn} = excluded.${this.updatedAtColumn},\n\t\t\t\t\t\t${this.expirationColumn} = excluded.${this.expirationColumn}\n\t\t\t\t`\n        params = [id, serialized, now, now, expiration]\n      } else {\n        query = `\n\t\t\t\t\tINSERT INTO ${this.tableName}\n\t\t\t\t\t(${this.idColumn}, ${this.valueColumn}, ${this.createdAtColumn}, ${this.updatedAtColumn})\n\t\t\t\t\tVALUES (?, ?, ?, ?)\n\t\t\t\t\tON CONFLICT(${this.idColumn})\n\t\t\t\t\tDO UPDATE SET\n\t\t\t\t\t\t${this.valueColumn} = excluded.${this.valueColumn},\n\t\t\t\t\t\t${this.updatedAtColumn} = excluded.${this.updatedAtColumn}\n\t\t\t\t`\n        params = [id, serialized, now, now]\n      }\n\n      await this.binding\n        .prepare(query)\n        .bind(...params)\n        .run()\n      return Result.ok(undefined)\n    } catch (error) {\n      return Result.err(\n        Errors.internal(\n          `D1 put operation failed for id \"${id}\"`,\n          error instanceof Error ? error : undefined\n        )\n      )\n    }\n  }\n\n  /**\n   * Delete a value from D1\n   */\n  async delete(id: string): Promise<Result<void, ConductorError>> {\n    try {\n      const query = `DELETE FROM ${this.tableName} WHERE ${this.idColumn} = ?`\n      await this.binding.prepare(query).bind(id).run()\n      return Result.ok(undefined)\n    } catch (error) {\n      return Result.err(\n        Errors.internal(\n          `D1 delete operation failed for id \"${id}\"`,\n          error instanceof Error ? error : undefined\n        )\n      )\n    }\n  }\n\n  /**\n   * List values from D1\n   */\n  async list(options?: ListOptions): Promise<Result<T[], ConductorError>> {\n    try {\n      let query = `SELECT ${this.valueColumn} FROM ${this.tableName}`\n      const params: unknown[] = []\n\n      // Add WHERE clause for prefix if needed\n      if (options?.prefix) {\n        query += ` WHERE ${this.idColumn} LIKE ?`\n        params.push(`${options.prefix}%`)\n      }\n\n      // Add expiration check\n      if (this.expirationColumn) {\n        const whereOrAnd = options?.prefix ? 'AND' : 'WHERE'\n        query += ` ${whereOrAnd} (${this.expirationColumn} IS NULL OR ${this.expirationColumn} > datetime('now'))`\n      }\n\n      // Add ORDER BY\n      query += ` ORDER BY ${this.createdAtColumn} DESC`\n\n      // Add LIMIT\n      if (options?.limit) {\n        query += ` LIMIT ?`\n        params.push(options.limit)\n      }\n\n      const result = await this.binding\n        .prepare(query)\n        .bind(...params)\n        .all()\n\n      const values: T[] = result.results.map((row) =>\n        this.serializer.deserialize(row[this.valueColumn] as string)\n      )\n\n      return Result.ok(values)\n    } catch (error) {\n      return Result.err(\n        Errors.internal('D1 list operation failed', error instanceof Error ? error : undefined)\n      )\n    }\n  }\n\n  /**\n   * Check if an ID exists in D1\n   */\n  async has(id: string): Promise<Result<boolean, ConductorError>> {\n    try {\n      const query = `SELECT 1 FROM ${this.tableName} WHERE ${this.idColumn} = ? LIMIT 1`\n      const result = await this.binding.prepare(query).bind(id).first()\n      return Result.ok(result !== null)\n    } catch (error) {\n      return Result.err(\n        Errors.internal(\n          `D1 has operation failed for id \"${id}\"`,\n          error instanceof Error ? error : undefined\n        )\n      )\n    }\n  }\n\n  /**\n   * Clean up expired entries\n   */\n  async cleanExpired(): Promise<Result<number, ConductorError>> {\n    if (!this.expirationColumn) {\n      return Result.ok(0)\n    }\n\n    try {\n      const query = `\n\t\t\t\tDELETE FROM ${this.tableName}\n\t\t\t\tWHERE ${this.expirationColumn} IS NOT NULL\n\t\t\t\tAND ${this.expirationColumn} <= datetime('now')\n\t\t\t`\n\n      const result = await this.binding.prepare(query).run()\n      return Result.ok(result.meta.changes || 0)\n    } catch (error) {\n      return Result.err(\n        Errors.internal(\n          'D1 cleanExpired operation failed',\n          error instanceof Error ? error : undefined\n        )\n      )\n    }\n  }\n}\n","/**\n * Cloudflare R2 Repository Implementation\n *\n * Provides a Repository interface over Cloudflare R2 (object storage).\n */\n\nimport { Result } from '../types/result.js'\nimport { Errors, type ConductorError } from '../errors/error-types.js'\nimport type { Repository, PutOptions, ListOptions, Serializer } from './repository.js'\nimport { JSONSerializer } from './repository.js'\n\n/**\n * Repository implementation for Cloudflare R2\n */\nexport class R2Repository<T> implements Repository<T, string> {\n  constructor(\n    private readonly binding: R2Bucket,\n    private readonly serializer: Serializer<T> = new JSONSerializer<T>()\n  ) {}\n\n  /**\n   * Get an object from R2\n   */\n  async get(key: string): Promise<Result<T, ConductorError>> {\n    try {\n      const object = await this.binding.get(key)\n\n      if (object === null) {\n        return Result.err(Errors.storageNotFound(key, 'R2'))\n      }\n\n      const text = await object.text()\n      const value = this.serializer.deserialize(text)\n      return Result.ok(value)\n    } catch (error) {\n      return Result.err(\n        Errors.internal(\n          `R2 get operation failed for key \"${key}\"`,\n          error instanceof Error ? error : undefined\n        )\n      )\n    }\n  }\n\n  /**\n   * Store an object in R2\n   */\n  async put(key: string, value: T, options?: PutOptions): Promise<Result<void, ConductorError>> {\n    try {\n      const serialized = this.serializer.serialize(value)\n\n      const r2Options: R2PutOptions = {}\n\n      // R2 uses httpMetadata for custom headers\n      if (options?.metadata) {\n        r2Options.customMetadata = options.metadata\n      }\n\n      // R2 doesn't have built-in TTL, but we can set custom metadata\n      if (options?.ttl) {\n        const expiration = Date.now() + options.ttl * 1000\n        r2Options.customMetadata = {\n          ...r2Options.customMetadata,\n          'x-expiration': expiration.toString(),\n        }\n      }\n\n      if (options?.expiration) {\n        r2Options.customMetadata = {\n          ...r2Options.customMetadata,\n          'x-expiration': (options.expiration * 1000).toString(),\n        }\n      }\n\n      await this.binding.put(key, serialized, r2Options)\n      return Result.ok(undefined)\n    } catch (error) {\n      return Result.err(\n        Errors.internal(\n          `R2 put operation failed for key \"${key}\"`,\n          error instanceof Error ? error : undefined\n        )\n      )\n    }\n  }\n\n  /**\n   * Delete an object from R2\n   */\n  async delete(key: string): Promise<Result<void, ConductorError>> {\n    try {\n      await this.binding.delete(key)\n      return Result.ok(undefined)\n    } catch (error) {\n      return Result.err(\n        Errors.internal(\n          `R2 delete operation failed for key \"${key}\"`,\n          error instanceof Error ? error : undefined\n        )\n      )\n    }\n  }\n\n  /**\n   * List objects in R2\n   */\n  async list(options?: ListOptions): Promise<Result<T[], ConductorError>> {\n    try {\n      const listOptions: R2ListOptions = {}\n\n      if (options?.prefix) {\n        listOptions.prefix = options.prefix\n      }\n\n      if (options?.limit) {\n        listOptions.limit = options.limit\n      }\n\n      if (options?.cursor) {\n        listOptions.cursor = options.cursor\n      }\n\n      const result = await this.binding.list(listOptions)\n\n      // Filter out expired objects first (using metadata from list, no extra API calls)\n      const now = Date.now()\n      const validObjects: R2Object[] = []\n      const expiredKeys: string[] = []\n\n      for (const object of result.objects) {\n        const expiration = object.customMetadata?.['x-expiration']\n        if (expiration) {\n          const expirationTime = parseInt(expiration, 10)\n          if (expirationTime < now) {\n            expiredKeys.push(object.key)\n            continue\n          }\n        }\n        validObjects.push(object)\n      }\n\n      // Clean up expired objects in background (don't await - fire and forget)\n      if (expiredKeys.length > 0) {\n        Promise.all(expiredKeys.map((key) => this.binding.delete(key))).catch(() => {\n          // Ignore cleanup failures - they'll be retried on next list\n        })\n      }\n\n      // Fetch all valid objects in parallel batches to avoid N+1 queries\n      // Batch size of 10 balances parallelism vs. API rate limits\n      const BATCH_SIZE = 10\n      const values: T[] = []\n\n      for (let i = 0; i < validObjects.length; i += BATCH_SIZE) {\n        const batch = validObjects.slice(i, i + BATCH_SIZE)\n        const batchResults = await Promise.all(batch.map((obj) => this.get(obj.key)))\n\n        for (const getResult of batchResults) {\n          if (getResult.success) {\n            values.push(getResult.value)\n          }\n        }\n      }\n\n      return Result.ok(values)\n    } catch (error) {\n      return Result.err(\n        Errors.internal('R2 list operation failed', error instanceof Error ? error : undefined)\n      )\n    }\n  }\n\n  /**\n   * Check if an object exists in R2\n   */\n  async has(key: string): Promise<Result<boolean, ConductorError>> {\n    try {\n      const object = await this.binding.head(key)\n      return Result.ok(object !== null)\n    } catch (error) {\n      return Result.err(\n        Errors.internal(\n          `R2 has operation failed for key \"${key}\"`,\n          error instanceof Error ? error : undefined\n        )\n      )\n    }\n  }\n\n  /**\n   * Get object with metadata\n   */\n  async getWithMetadata(\n    key: string\n  ): Promise<Result<{ value: T; metadata?: R2ObjectBody }, ConductorError>> {\n    try {\n      const object = await this.binding.get(key)\n\n      if (object === null) {\n        return Result.err(Errors.storageNotFound(key, 'R2'))\n      }\n\n      const text = await object.text()\n      const value = this.serializer.deserialize(text)\n\n      return Result.ok({\n        value,\n        metadata: object,\n      })\n    } catch (error) {\n      return Result.err(\n        Errors.internal(\n          `R2 getWithMetadata operation failed for key \"${key}\"`,\n          error instanceof Error ? error : undefined\n        )\n      )\n    }\n  }\n\n  /**\n   * Get object metadata only (head request)\n   */\n  async getMetadata(key: string): Promise<Result<R2Object | null, ConductorError>> {\n    try {\n      const metadata = await this.binding.head(key)\n      return Result.ok(metadata)\n    } catch (error) {\n      return Result.err(\n        Errors.internal(\n          `R2 getMetadata operation failed for key \"${key}\"`,\n          error instanceof Error ? error : undefined\n        )\n      )\n    }\n  }\n}\n","/**\n * Cloudflare Hyperdrive Repository Implementation\n *\n * Provides access to external databases (Postgres, MySQL, etc.) via Hyperdrive.\n * Hyperdrive provides connection pooling, query caching, and low-latency access.\n *\n * Note: Hyperdrive bindings return a D1Database interface for querying.\n */\n\nimport { Result } from '../types/result.js'\nimport { Errors, type ConductorError } from '../errors/error-types.js'\n\n/**\n * Database type for dialect-specific SQL\n */\nexport type DatabaseType = 'postgres' | 'mysql' | 'mariadb'\n\n/**\n * Configuration for Hyperdrive repository\n */\nexport interface HyperdriveConfig {\n  /**\n   * Database type (for dialect-specific SQL)\n   */\n  databaseType: DatabaseType\n\n  /**\n   * Schema name (optional, for Postgres)\n   */\n  schema?: string\n\n  /**\n   * Connection options\n   */\n  options?: {\n    /**\n     * Query timeout (ms)\n     */\n    timeout?: number\n\n    /**\n     * Read-only mode (prevent writes)\n     */\n    readOnly?: boolean\n\n    /**\n     * Max rows to return\n     */\n    maxRows?: number\n  }\n}\n\n/**\n * Query result metadata\n */\nexport interface QueryMetadata {\n  /**\n   * Number of rows affected (for writes)\n   */\n  rowsAffected?: number\n\n  /**\n   * Execution time (ms)\n   */\n  executionTime: number\n\n  /**\n   * Column names\n   */\n  columns: string[]\n\n  /**\n   * Row count\n   */\n  rowCount: number\n}\n\n/**\n * Query result with metadata\n */\nexport interface QueryResult<T = unknown> {\n  /**\n   * Result rows\n   */\n  rows: T[]\n\n  /**\n   * Metadata\n   */\n  metadata: QueryMetadata\n}\n\n/**\n * Table metadata\n */\nexport interface TableMetadata {\n  /**\n   * Table name\n   */\n  name: string\n\n  /**\n   * Schema name\n   */\n  schema?: string\n\n  /**\n   * Column definitions\n   */\n  columns: Array<{\n    name: string\n    type: string\n    nullable: boolean\n    defaultValue?: string\n  }>\n\n  /**\n   * Primary key columns\n   */\n  primaryKey?: string[]\n\n  /**\n   * Indexes\n   */\n  indexes?: Array<{\n    name: string\n    columns: string[]\n    unique: boolean\n  }>\n}\n\n/**\n * Transaction interface\n */\nexport interface HyperdriveTransaction {\n  /**\n   * Execute a query in the transaction\n   */\n  query<T = unknown>(\n    sql: string,\n    params?: unknown[]\n  ): Promise<Result<QueryResult<T>, ConductorError>>\n\n  /**\n   * Commit the transaction\n   */\n  commit(): Promise<Result<void, ConductorError>>\n\n  /**\n   * Rollback the transaction\n   */\n  rollback(): Promise<Result<void, ConductorError>>\n}\n\n/**\n * Repository implementation for Cloudflare Hyperdrive\n *\n * Hyperdrive bindings provide a D1Database interface for querying.\n */\nexport class HyperdriveRepository {\n  private readonly schema?: string\n  private readonly timeout: number\n  private readonly readOnly: boolean\n  private readonly maxRows?: number\n\n  constructor(\n    private readonly hyperdrive: D1Database,\n    private readonly config: HyperdriveConfig\n  ) {\n    this.schema = config.schema\n    this.timeout = config.options?.timeout || 30000 // 30s default\n    this.readOnly = config.options?.readOnly || false\n    this.maxRows = config.options?.maxRows\n  }\n\n  /**\n   * Execute a raw SQL query\n   */\n  async query<T = unknown>(\n    sql: string,\n    params?: unknown[]\n  ): Promise<Result<QueryResult<T>, ConductorError>> {\n    try {\n      // Validate if read-only\n      if (this.readOnly && this.isWriteQuery(sql)) {\n        return Result.err(Errors.internal('Write operations not allowed in read-only mode'))\n      }\n\n      const startTime = Date.now()\n\n      // Prepare statement with parameters\n      let stmt = this.hyperdrive.prepare(sql)\n      if (params && params.length > 0) {\n        stmt = stmt.bind(...params)\n      }\n\n      // Execute query\n      const result = await stmt.all()\n      const executionTime = Date.now() - startTime\n\n      // Apply row limit if configured\n      let rows = result.results as T[]\n      if (this.maxRows && rows.length > this.maxRows) {\n        rows = rows.slice(0, this.maxRows)\n      }\n\n      // Extract column names from first row\n      const columns =\n        rows.length > 0\n          ? Object.keys(rows[0] as Record<string, unknown>)\n          : result.meta?.columns\n            ? (result.meta.columns as Array<{ name: string }>).map((c) => c.name)\n            : []\n\n      return Result.ok({\n        rows,\n        metadata: {\n          executionTime,\n          columns,\n          rowCount: rows.length,\n          rowsAffected: result.meta?.changes,\n        },\n      })\n    } catch (error) {\n      return Result.err(\n        Errors.internal(\n          `Hyperdrive query failed: ${sql}`,\n          error instanceof Error ? error : undefined\n        )\n      )\n    }\n  }\n\n  /**\n   * Execute a query with named parameters\n   * Converts named parameters (:name) to positional parameters based on database type\n   */\n  async queryNamed<T = unknown>(\n    sql: string,\n    params: Record<string, unknown>\n  ): Promise<Result<QueryResult<T>, ConductorError>> {\n    const { convertedSql, orderedParams } = this.convertNamedParams(sql, params)\n    return this.query<T>(convertedSql, orderedParams)\n  }\n\n  /**\n   * Execute a write query (INSERT, UPDATE, DELETE)\n   */\n  async execute(\n    sql: string,\n    params?: unknown[]\n  ): Promise<Result<{ rowsAffected: number }, ConductorError>> {\n    if (this.readOnly) {\n      return Result.err(Errors.internal('Write operations not allowed in read-only mode'))\n    }\n\n    try {\n      const startTime = Date.now()\n\n      let stmt = this.hyperdrive.prepare(sql)\n      if (params && params.length > 0) {\n        stmt = stmt.bind(...params)\n      }\n\n      const result = await stmt.run()\n\n      return Result.ok({\n        rowsAffected: result.meta.changes || 0,\n      })\n    } catch (error) {\n      return Result.err(\n        Errors.internal(\n          `Hyperdrive execute failed: ${sql}`,\n          error instanceof Error ? error : undefined\n        )\n      )\n    }\n  }\n\n  /**\n   * Begin a transaction\n   * Note: D1/Hyperdrive transaction support is limited - this is a best-effort implementation\n   */\n  async transaction<T>(\n    callback: (tx: HyperdriveTransaction) => Promise<T>\n  ): Promise<Result<T, ConductorError>> {\n    // Begin transaction\n    const beginResult = await this.execute('BEGIN')\n    if (!beginResult.success) {\n      return Result.err(beginResult.error)\n    }\n\n    const tx: HyperdriveTransaction = {\n      query: async <U = unknown>(sql: string, params?: unknown[]) => this.query<U>(sql, params),\n      commit: async () => {\n        const result = await this.execute('COMMIT')\n        return result.success ? Result.ok(undefined) : Result.err(result.error)\n      },\n      rollback: async () => {\n        const result = await this.execute('ROLLBACK')\n        return result.success ? Result.ok(undefined) : Result.err(result.error)\n      },\n    }\n\n    try {\n      const result = await callback(tx)\n      const commitResult = await tx.commit()\n      if (!commitResult.success) {\n        return Result.err(commitResult.error)\n      }\n      return Result.ok(result)\n    } catch (error) {\n      await tx.rollback()\n      return Result.err(\n        Errors.internal('Transaction failed', error instanceof Error ? error : undefined)\n      )\n    }\n  }\n\n  /**\n   * Get table metadata\n   */\n  async getTableInfo(tableName: string): Promise<Result<TableMetadata, ConductorError>> {\n    try {\n      let sql: string\n\n      switch (this.config.databaseType) {\n        case 'postgres':\n          sql = `\n\t\t\t\t\t\tSELECT\n\t\t\t\t\t\t\tcolumn_name as name,\n\t\t\t\t\t\t\tdata_type as type,\n\t\t\t\t\t\t\tis_nullable = 'YES' as nullable,\n\t\t\t\t\t\t\tcolumn_default as default_value\n\t\t\t\t\t\tFROM information_schema.columns\n\t\t\t\t\t\tWHERE table_name = $1\n\t\t\t\t\t\t${this.schema ? 'AND table_schema = $2' : ''}\n\t\t\t\t\t\tORDER BY ordinal_position\n\t\t\t\t\t`\n          break\n\n        case 'mysql':\n        case 'mariadb':\n          sql = `\n\t\t\t\t\t\tSELECT\n\t\t\t\t\t\t\tCOLUMN_NAME as name,\n\t\t\t\t\t\t\tDATA_TYPE as type,\n\t\t\t\t\t\t\tIS_NULLABLE = 'YES' as nullable,\n\t\t\t\t\t\t\tCOLUMN_DEFAULT as default_value\n\t\t\t\t\t\tFROM information_schema.columns\n\t\t\t\t\t\tWHERE TABLE_NAME = ?\n\t\t\t\t\t\t${this.schema ? 'AND TABLE_SCHEMA = ?' : ''}\n\t\t\t\t\t\tORDER BY ORDINAL_POSITION\n\t\t\t\t\t`\n          break\n      }\n\n      const params = this.schema ? [tableName, this.schema] : [tableName]\n      const result = await this.query<{\n        name: string\n        type: string\n        nullable: boolean\n        default_value?: string\n      }>(sql, params)\n\n      if (!result.success) {\n        return Result.err(result.error)\n      }\n\n      return Result.ok({\n        name: tableName,\n        schema: this.schema,\n        columns: result.value.rows.map((row) => ({\n          name: row.name,\n          type: row.type,\n          nullable: row.nullable,\n          defaultValue: row.default_value,\n        })),\n      })\n    } catch (error) {\n      return Result.err(\n        Errors.internal(\n          `Failed to get table info for ${tableName}`,\n          error instanceof Error ? error : undefined\n        )\n      )\n    }\n  }\n\n  /**\n   * List tables in schema\n   */\n  async listTables(): Promise<Result<string[], ConductorError>> {\n    try {\n      let sql: string\n\n      switch (this.config.databaseType) {\n        case 'postgres':\n          sql = `\n\t\t\t\t\t\tSELECT table_name\n\t\t\t\t\t\tFROM information_schema.tables\n\t\t\t\t\t\tWHERE table_schema = $1\n\t\t\t\t\t\tORDER BY table_name\n\t\t\t\t\t`\n          break\n\n        case 'mysql':\n        case 'mariadb':\n          sql = `\n\t\t\t\t\t\tSELECT TABLE_NAME as table_name\n\t\t\t\t\t\tFROM information_schema.tables\n\t\t\t\t\t\tWHERE TABLE_SCHEMA = ?\n\t\t\t\t\t\tORDER BY TABLE_NAME\n\t\t\t\t\t`\n          break\n      }\n\n      const params = [this.schema || 'public']\n      const result = await this.query<{ table_name: string }>(sql, params)\n\n      if (!result.success) {\n        return Result.err(result.error)\n      }\n\n      return Result.ok(result.value.rows.map((row) => row.table_name))\n    } catch (error) {\n      return Result.err(\n        Errors.internal('Failed to list tables', error instanceof Error ? error : undefined)\n      )\n    }\n  }\n\n  /**\n   * Check if a query is a write operation\n   */\n  private isWriteQuery(sql: string): boolean {\n    const upperSQL = sql.trim().toUpperCase()\n    return /^(INSERT|UPDATE|DELETE|DROP|CREATE|ALTER|TRUNCATE|REPLACE)/i.test(upperSQL)\n  }\n\n  /**\n   * Convert named parameters to positional parameters\n   */\n  private convertNamedParams(\n    sql: string,\n    params: Record<string, unknown>\n  ): { convertedSql: string; orderedParams: unknown[] } {\n    const orderedParams: unknown[] = []\n    let paramIndex = 1\n\n    // Replace :paramName with $1, $2, etc. (Postgres style) or ? (MySQL style)\n    const convertedSql = sql.replace(/:(\\w+)/g, (match, paramName) => {\n      if (!(paramName in params)) {\n        throw new Error(`Missing parameter: ${paramName}`)\n      }\n\n      orderedParams.push(params[paramName])\n\n      // Use appropriate placeholder based on database type\n      switch (this.config.databaseType) {\n        case 'postgres':\n          return `$${paramIndex++}`\n        case 'mysql':\n        case 'mariadb':\n          return '?'\n        default:\n          return '?'\n      }\n    })\n\n    return { convertedSql, orderedParams }\n  }\n\n  /**\n   * Get database type\n   */\n  getDatabaseType(): DatabaseType {\n    return this.config.databaseType\n  }\n\n  /**\n   * Check if repository is read-only\n   */\n  isReadOnly(): boolean {\n    return this.readOnly\n  }\n}\n","/**\n * Conductor Configuration Constants\n *\n * Centralized configuration for all magic numbers and hardcoded values.\n * Makes configuration explicit, discoverable, and easy to modify.\n */\n\n/**\n * Timeout Configuration (in milliseconds)\n */\nexport const TIMEOUTS = {\n  /** Default API request timeout (30 seconds) */\n  API_DEFAULT: 30000,\n\n  /** Short timeout for quick operations (5 seconds) */\n  API_SHORT: 5000,\n\n  /** Long timeout for complex operations (10 seconds) */\n  API_LONG: 10000,\n\n  /** HITL approval timeout (24 hours) */\n  HITL_APPROVAL: 86400000,\n\n  /** Database query timeout (30 seconds) */\n  DATABASE: 30000,\n\n  /** Webhook delivery timeout (30 seconds) */\n  WEBHOOK: 30000,\n} as const\n\n/**\n * TTL Configuration (Time To Live in seconds)\n */\nexport const TTL = {\n  /** Default cache TTL (1 hour) */\n  CACHE_DEFAULT: 3600,\n\n  /** Short-lived cache (5 minutes) */\n  CACHE_SHORT: 300,\n\n  /** Medium-lived cache (15 minutes) */\n  CACHE_MEDIUM: 900,\n\n  /** Long-lived cache (24 hours) */\n  CACHE_LONG: 86400,\n\n  /** Session memory TTL (1 hour) */\n  SESSION: 3600,\n\n  /** Resumption token TTL (24 hours) */\n  RESUMPTION_TOKEN: 86400,\n\n  /** Analytical memory cache (5 minutes) */\n  ANALYTICAL_CACHE: 300,\n\n  /** Query result cache - analytics queries (1 hour) */\n  QUERY_ANALYTICS: 3600,\n\n  /** Query result cache - lookup queries (15 minutes) */\n  QUERY_LOOKUP: 900,\n\n  /** Query result cache - list queries (5 minutes) */\n  QUERY_LIST: 300,\n} as const\n\n/**\n * Retry Configuration\n */\nexport const RETRY = {\n  /** Default number of retries for failed operations */\n  DEFAULT_MAX: 3,\n\n  /** Max retries for scoring agent execution */\n  SCORING_MAX: 3,\n} as const\n\n/**\n * Threshold Configuration (0.0 to 1.0)\n */\nexport const THRESHOLDS = {\n  /** Default minimum score threshold (70%) */\n  SCORE_MINIMUM: 0.7,\n\n  /** High confidence threshold (80%) */\n  SCORE_HIGH: 0.8,\n\n  /** Quality degradation detection threshold (10% drop) */\n  QUALITY_DEGRADATION: 0.1,\n\n  /** Score change detection threshold (5% change) */\n  SCORE_CHANGE: 0.05,\n} as const\n\n/**\n * Size and Limit Configuration\n */\nexport const LIMITS = {\n  /** Default chunk size for text processing */\n  CHUNK_SIZE: 512,\n\n  /** Window size for quality trend analysis */\n  QUALITY_WINDOW: 5,\n\n  /** Maximum input length for sanitization */\n  INPUT_MAX_LENGTH: 1000,\n} as const\n\n/**\n * HTTP Status Codes\n */\nexport const HTTP_STATUS = {\n  OK: 200,\n  BAD_REQUEST: 400,\n  UNAUTHORIZED: 401,\n  FORBIDDEN: 403,\n  NOT_FOUND: 404,\n  TIMEOUT: 504,\n  RATE_LIMIT: 429,\n  INTERNAL_ERROR: 500,\n} as const\n\n/**\n * Complete Conductor Configuration\n * Re-exports all configuration constants\n */\nexport const ConductorConfig = {\n  timeouts: TIMEOUTS,\n  ttl: TTL,\n  retry: RETRY,\n  thresholds: THRESHOLDS,\n  limits: LIMITS,\n  httpStatus: HTTP_STATUS,\n} as const\n\nexport default ConductorConfig\n","/**\n * Query Result Caching Layer\n *\n * Provides TTL-based caching for SQL query results using Cloudflare KV.\n * Reduces database load and improves query performance for frequently accessed data.\n */\n\nimport type { QueryResult } from './hyperdrive-repository.js'\nimport { Result } from '../types/result.js'\nimport { Errors, type ConductorError } from '../errors/error-types.js'\nimport { TTL } from '../config/constants.js'\n\n/**\n * Cache configuration\n */\nexport interface QueryCacheConfig {\n  /**\n   * KV namespace for caching\n   */\n  kv: KVNamespace\n\n  /**\n   * Default TTL in seconds (default: TTL.CACHE_SHORT = 5 minutes)\n   */\n  defaultTTL?: number\n\n  /**\n   * Key prefix for cache entries\n   */\n  keyPrefix?: string\n\n  /**\n   * Enable cache statistics tracking\n   */\n  enableStats?: boolean\n}\n\n/**\n * Cache statistics\n */\nexport interface CacheStats {\n  hits: number\n  misses: number\n  sets: number\n  deletes: number\n  errors: number\n  hitRate: number\n}\n\n/**\n * Cache metadata stored with query results\n */\ninterface CacheEntry<T = unknown> {\n  /**\n   * Cached query result\n   */\n  result: QueryResult<T>\n\n  /**\n   * Cache timestamp (ms)\n   */\n  cachedAt: number\n\n  /**\n   * TTL in seconds\n   */\n  ttl: number\n\n  /**\n   * Query metadata for debugging\n   */\n  metadata: {\n    sql: string\n    database?: string\n    paramCount: number\n  }\n}\n\n/**\n * Query Cache - TTL-based caching for query results\n */\nexport class QueryCache {\n  private readonly kv: KVNamespace\n  private readonly defaultTTL: number\n  private readonly keyPrefix: string\n  private readonly enableStats: boolean\n\n  // Statistics\n  private stats = {\n    hits: 0,\n    misses: 0,\n    sets: 0,\n    deletes: 0,\n    errors: 0,\n  }\n\n  constructor(config: QueryCacheConfig) {\n    this.kv = config.kv\n    this.defaultTTL = config.defaultTTL || TTL.CACHE_SHORT\n    this.keyPrefix = config.keyPrefix || 'query:'\n    this.enableStats = config.enableStats !== false\n  }\n\n  /**\n   * Get cached query result\n   */\n  async get<T = unknown>(\n    sql: string,\n    params?: unknown[],\n    database?: string\n  ): Promise<Result<QueryResult<T> | null, ConductorError>> {\n    try {\n      const key = await this.generateKey(sql, params, database)\n      const cached = await this.kv.get<CacheEntry<T>>(key, 'json')\n\n      if (!cached) {\n        if (this.enableStats) this.stats.misses++\n        return Result.ok(null)\n      }\n\n      // Verify cache hasn't expired (additional check beyond KV TTL)\n      const age = (Date.now() - cached.cachedAt) / 1000\n      if (age > cached.ttl) {\n        // Expired - delete and return null\n        await this.delete(sql, params, database)\n        if (this.enableStats) this.stats.misses++\n        return Result.ok(null)\n      }\n\n      if (this.enableStats) this.stats.hits++\n      return Result.ok(cached.result)\n    } catch (error) {\n      if (this.enableStats) this.stats.errors++\n      return Result.err(\n        Errors.internal('Cache get failed', error instanceof Error ? error : undefined)\n      )\n    }\n  }\n\n  /**\n   * Set cached query result\n   */\n  async set<T = unknown>(\n    sql: string,\n    result: QueryResult<T>,\n    params?: unknown[],\n    database?: string,\n    ttl?: number\n  ): Promise<Result<void, ConductorError>> {\n    try {\n      const key = await this.generateKey(sql, params, database)\n      const cacheTTL = ttl || this.defaultTTL\n\n      const entry: CacheEntry<T> = {\n        result,\n        cachedAt: Date.now(),\n        ttl: cacheTTL,\n        metadata: {\n          sql: sql.substring(0, 200), // Truncate for storage\n          database,\n          paramCount: params?.length || 0,\n        },\n      }\n\n      // Store in KV with TTL\n      await this.kv.put(key, JSON.stringify(entry), {\n        expirationTtl: cacheTTL,\n      })\n\n      if (this.enableStats) this.stats.sets++\n      return Result.ok(undefined)\n    } catch (error) {\n      if (this.enableStats) this.stats.errors++\n      return Result.err(\n        Errors.internal('Cache set failed', error instanceof Error ? error : undefined)\n      )\n    }\n  }\n\n  /**\n   * Delete cached query result\n   */\n  async delete(\n    sql: string,\n    params?: unknown[],\n    database?: string\n  ): Promise<Result<void, ConductorError>> {\n    try {\n      const key = await this.generateKey(sql, params, database)\n      await this.kv.delete(key)\n\n      if (this.enableStats) this.stats.deletes++\n      return Result.ok(undefined)\n    } catch (error) {\n      if (this.enableStats) this.stats.errors++\n      return Result.err(\n        Errors.internal('Cache delete failed', error instanceof Error ? error : undefined)\n      )\n    }\n  }\n\n  /**\n   * Clear all cached queries for a database\n   */\n  async clearDatabase(database: string): Promise<Result<number, ConductorError>> {\n    try {\n      // List all keys with database prefix\n      const prefix = `${this.keyPrefix}${database}:`\n      const list = await this.kv.list({ prefix })\n\n      let deleted = 0\n      for (const key of list.keys) {\n        await this.kv.delete(key.name)\n        deleted++\n      }\n\n      if (this.enableStats) this.stats.deletes += deleted\n      return Result.ok(deleted)\n    } catch (error) {\n      if (this.enableStats) this.stats.errors++\n      return Result.err(\n        Errors.internal('Cache clear failed', error instanceof Error ? error : undefined)\n      )\n    }\n  }\n\n  /**\n   * Clear all cached queries\n   */\n  async clearAll(): Promise<Result<number, ConductorError>> {\n    try {\n      const list = await this.kv.list({ prefix: this.keyPrefix })\n\n      let deleted = 0\n      for (const key of list.keys) {\n        await this.kv.delete(key.name)\n        deleted++\n      }\n\n      if (this.enableStats) this.stats.deletes += deleted\n      return Result.ok(deleted)\n    } catch (error) {\n      if (this.enableStats) this.stats.errors++\n      return Result.err(\n        Errors.internal('Cache clear all failed', error instanceof Error ? error : undefined)\n      )\n    }\n  }\n\n  /**\n   * Get cache statistics\n   */\n  getStats(): CacheStats {\n    const total = this.stats.hits + this.stats.misses\n    return {\n      ...this.stats,\n      hitRate: total > 0 ? this.stats.hits / total : 0,\n    }\n  }\n\n  /**\n   * Reset cache statistics\n   */\n  resetStats(): void {\n    this.stats = {\n      hits: 0,\n      misses: 0,\n      sets: 0,\n      deletes: 0,\n      errors: 0,\n    }\n  }\n\n  /**\n   * Generate cache key from query, params, and database\n   */\n  private async generateKey(sql: string, params?: unknown[], database?: string): Promise<string> {\n    // Normalize SQL (remove extra whitespace, lowercase)\n    const normalizedSQL = sql.trim().replace(/\\s+/g, ' ').toLowerCase()\n\n    // Create deterministic key from SQL + params + database\n    const components = [database || 'default', normalizedSQL]\n\n    if (params && params.length > 0) {\n      // Convert params to deterministic string\n      const paramString = JSON.stringify(params)\n      components.push(paramString)\n    }\n\n    // Hash the components for a shorter key\n    const hash = await this.sha256Hash(components.join('|'))\n\n    return `${this.keyPrefix}${hash}`\n  }\n\n  /**\n   * Cryptographically secure SHA-256 hash function\n   * Uses Web Crypto API for secure, collision-resistant hashing\n   */\n  private async sha256Hash(str: string): Promise<string> {\n    // Encode string to Uint8Array\n    const encoder = new TextEncoder()\n    const data = encoder.encode(str)\n\n    // Calculate SHA-256 hash\n    const hashBuffer = await crypto.subtle.digest('SHA-256', data)\n\n    // Convert to hex string\n    const hashArray = Array.from(new Uint8Array(hashBuffer))\n    const hashHex = hashArray.map((b) => b.toString(16).padStart(2, '0')).join('')\n\n    // Return first 16 chars (64 bits) for reasonable key length while maintaining security\n    return hashHex.substring(0, 16)\n  }\n\n  /**\n   * Check if caching is enabled for a query\n   * Certain query types should not be cached (writes, transactions, etc.)\n   */\n  static shouldCache(sql: string): boolean {\n    const upperSQL = sql.trim().toUpperCase()\n\n    // Don't cache write operations\n    if (/^(INSERT|UPDATE|DELETE|DROP|CREATE|ALTER|TRUNCATE|REPLACE)/i.test(upperSQL)) {\n      return false\n    }\n\n    // Don't cache transactions\n    if (/^(BEGIN|COMMIT|ROLLBACK|START TRANSACTION)/i.test(upperSQL)) {\n      return false\n    }\n\n    // Don't cache queries with non-deterministic functions\n    if (/\\b(NOW|CURRENT_TIMESTAMP|RANDOM|UUID|NEWID)\\b/i.test(upperSQL)) {\n      return false\n    }\n\n    return true\n  }\n\n  /**\n   * Get recommended TTL based on query type\n   */\n  static getRecommendedTTL(sql: string): number {\n    const upperSQL = sql.trim().toUpperCase()\n\n    // Analytics queries - longer TTL (1 hour)\n    if (/\\b(COUNT|SUM|AVG|GROUP BY|AGGREGATE)\\b/i.test(upperSQL)) {\n      return TTL.QUERY_ANALYTICS\n    }\n\n    // Lookup queries - medium TTL (15 minutes)\n    if (/\\bWHERE\\s+\\w+\\s*=\\s*[$?:\\d]/i.test(upperSQL)) {\n      return TTL.QUERY_LOOKUP\n    }\n\n    // List queries - short TTL (5 minutes)\n    if (/\\bSELECT\\b/i.test(upperSQL)) {\n      return TTL.QUERY_LIST\n    }\n\n    // Default (5 minutes)\n    return TTL.QUERY_LIST\n  }\n}\n","/**\n * Storage Agent - Key-Value and Object Storage\n *\n * Handles storage operations for KV, R2, and Cache API through a unified Repository interface.\n * Storage backend is injected, making it testable and platform-agnostic.\n *\n * Storage types:\n * - KV: Key-value store (Cloudflare Workers KV)\n * - R2: Object storage (Cloudflare R2)\n * - Cache: Cache API (browser-compatible caching)\n */\n\nimport { BaseAgent, type AgentExecutionContext } from './base-agent.js'\nimport type { AgentConfig } from '../runtime/parser.js'\nimport type { Repository } from '../storage/index.js'\nimport { KVRepository, R2Repository, JSONSerializer } from '../storage/index.js'\nimport { StorageType } from '../types/constants.js'\nimport type { ConductorEnv } from '../types/env.js'\n\nexport interface StorageConfig {\n  backend: StorageType\n  operation: 'get' | 'put' | 'delete' | 'list'\n  binding?: string // Name of the binding in wrangler.toml\n  ttl?: number // Time-to-live for stored values\n}\n\nexport interface StorageInput {\n  key?: string\n  value?: unknown\n  prefix?: string\n  limit?: number\n  cursor?: string\n  ttl?: number\n}\n\n/**\n * Storage Agent performs key-value and object storage operations via Repository pattern\n *\n * Benefits of Repository pattern:\n * - Platform-agnostic (works with any storage backend)\n * - Testable (easy to inject mock repositories)\n * - Composable (repositories can be chained, cached, etc.)\n * - Type-safe (Result types for error handling)\n */\nexport class StorageAgent extends BaseAgent {\n  private storageConfig: StorageConfig\n\n  constructor(\n    config: AgentConfig,\n    private readonly repository?: Repository<unknown, string>\n  ) {\n    super(config)\n\n    const cfg = config.config as StorageConfig | undefined\n    this.storageConfig = {\n      backend: cfg?.backend as StorageType,\n      operation: cfg?.operation as 'get' | 'put' | 'delete' | 'list',\n      binding: cfg?.binding,\n      ttl: cfg?.ttl,\n    }\n\n    // Validate config\n    if (!this.storageConfig.backend) {\n      throw new Error(`Storage agent \"${config.name}\" requires backend type (kv, r2, or cache)`)\n    }\n\n    if (!this.storageConfig.operation) {\n      throw new Error(`Storage agent \"${config.name}\" requires operation type`)\n    }\n  }\n\n  /**\n   * Execute storage operation via repository\n   */\n  protected async run(context: AgentExecutionContext): Promise<unknown> {\n    const { input, env } = context\n\n    // Get or create repository\n    const repo = this.repository || this.createRepository(env)\n\n    switch (this.storageConfig.operation) {\n      case 'get':\n        return await this.executeGet(repo, input)\n\n      case 'put':\n        return await this.executePut(repo, input)\n\n      case 'delete':\n        return await this.executeDelete(repo, input)\n\n      case 'list':\n        return await this.executeList(repo, input)\n\n      default:\n        throw new Error(`Unknown operation: ${this.storageConfig.operation}`)\n    }\n  }\n\n  /**\n   * Execute GET operation\n   */\n  private async executeGet(\n    repo: Repository<unknown, string>,\n    input: StorageInput\n  ): Promise<unknown> {\n    if (!input.key) {\n      throw new Error('GET operation requires \"key\" in input')\n    }\n\n    const result = await repo.get(input.key)\n\n    if (result.success) {\n      return {\n        key: input.key,\n        value: result.value,\n        found: true,\n      }\n    } else {\n      return {\n        key: input.key,\n        value: null,\n        found: false,\n        error: result.error.message,\n      }\n    }\n  }\n\n  /**\n   * Execute PUT operation\n   */\n  private async executePut(\n    repo: Repository<unknown, string>,\n    input: StorageInput\n  ): Promise<unknown> {\n    if (!input.key || input.value === undefined) {\n      throw new Error('PUT operation requires \"key\" and \"value\" in input')\n    }\n\n    const result = await repo.put(input.key, input.value, {\n      ttl: input.ttl || this.storageConfig.ttl,\n    })\n\n    if (result.success) {\n      return {\n        key: input.key,\n        success: true,\n      }\n    } else {\n      return {\n        key: input.key,\n        success: false,\n        error: result.error.message,\n      }\n    }\n  }\n\n  /**\n   * Execute DELETE operation\n   */\n  private async executeDelete(\n    repo: Repository<unknown, string>,\n    input: StorageInput\n  ): Promise<unknown> {\n    if (!input.key) {\n      throw new Error('DELETE operation requires \"key\" in input')\n    }\n\n    const result = await repo.delete(input.key)\n\n    if (result.success) {\n      return {\n        key: input.key,\n        success: true,\n      }\n    } else {\n      return {\n        key: input.key,\n        success: false,\n        error: result.error.message,\n      }\n    }\n  }\n\n  /**\n   * Execute LIST operation\n   */\n  private async executeList(\n    repo: Repository<unknown, string>,\n    input: StorageInput\n  ): Promise<unknown> {\n    const result = await repo.list({\n      prefix: input.prefix,\n      limit: input.limit,\n      cursor: input.cursor,\n    })\n\n    if (result.success) {\n      return {\n        items: result.value,\n        success: true,\n      }\n    } else {\n      return {\n        items: [],\n        success: false,\n        error: result.error.message,\n      }\n    }\n  }\n\n  /**\n   * Create repository from environment bindings\n   * Falls back to original behavior if no repository injected\n   */\n  private createRepository(env: ConductorEnv): Repository<unknown, string> {\n    const bindingName = this.getBindingName()\n    const binding = env[bindingName as keyof ConductorEnv]\n\n    if (!binding) {\n      throw new Error(\n        `Binding \"${bindingName}\" not found. ` +\n          `Add it to wrangler.toml or inject a repository in constructor.`\n      )\n    }\n\n    switch (this.storageConfig.backend) {\n      case StorageType.KV:\n        return new KVRepository(binding, new JSONSerializer())\n\n      case StorageType.R2:\n        return new R2Repository(binding, new JSONSerializer())\n\n      case StorageType.Cache:\n        // Cache API doesn't have a Repository implementation yet\n        // TODO: Implement CacheRepository in storage/repositories/\n        throw new Error('Cache API repository not yet implemented')\n\n      default:\n        throw new Error(`Unknown storage backend: ${this.storageConfig.backend}`)\n    }\n  }\n\n  /**\n   * Get binding name with sensible defaults\n   */\n  private getBindingName(): string {\n    if (this.storageConfig.binding) {\n      return this.storageConfig.binding\n    }\n\n    // Default binding names\n    switch (this.storageConfig.backend) {\n      case StorageType.KV:\n        return 'CACHE'\n      case StorageType.R2:\n        return 'STORAGE'\n      case StorageType.Cache:\n        return 'CACHE_API'\n      default:\n        return 'STORAGE'\n    }\n  }\n\n  /**\n   * Get Storage configuration\n   */\n  getStorageConfig(): StorageConfig {\n    return { ...this.storageConfig }\n  }\n}\n","/**\n * Data export format utilities\n *\n * Support for CSV, JSON, and Excel exports with streaming for large datasets\n */\n\n/**\n * Export format types\n */\nexport type ExportFormat = 'csv' | 'json' | 'xlsx' | 'ndjson'\n\n/**\n * Export options\n */\nexport interface ExportOptions {\n  /** Export format */\n  format: ExportFormat\n  /** Include headers (CSV/Excel) */\n  headers?: boolean\n  /** Custom field names/order */\n  fields?: string[]\n  /** Pretty print JSON */\n  pretty?: boolean\n  /** CSV delimiter */\n  delimiter?: string\n  /** Excel sheet name */\n  sheetName?: string\n  /** Streaming mode for large datasets */\n  streaming?: boolean\n  /** Batch size for streaming */\n  batchSize?: number\n}\n\n/**\n * Export result\n */\nexport interface ExportResult {\n  /** Exported data (string for non-streaming, ReadableStream for streaming) */\n  data: string | ReadableStream<Uint8Array>\n  /** Content type */\n  contentType: string\n  /** File extension */\n  extension: string\n  /** Size in bytes (if known) */\n  size?: number\n  /** Is streaming */\n  streaming: boolean\n}\n\n/**\n * Export data to specified format\n */\nexport async function exportData(data: unknown[], options: ExportOptions): Promise<ExportResult> {\n  switch (options.format) {\n    case 'csv':\n      return exportToCSV(data, options)\n    case 'json':\n      return exportToJSON(data, options)\n    case 'ndjson':\n      return exportToNDJSON(data, options)\n    case 'xlsx':\n      return exportToExcel(data, options)\n    default:\n      throw new Error(`Unsupported export format: ${options.format}`)\n  }\n}\n\n/**\n * Export to CSV\n */\nfunction exportToCSV(data: unknown[], options: ExportOptions): ExportResult {\n  const delimiter = options.delimiter || ','\n  const includeHeaders = options.headers !== false\n\n  if (data.length === 0) {\n    return {\n      data: '',\n      contentType: 'text/csv',\n      extension: 'csv',\n      size: 0,\n      streaming: false,\n    }\n  }\n\n  // Get fields\n  const fields = options.fields || Object.keys(data[0] as Record<string, unknown>)\n\n  const lines: string[] = []\n\n  // Headers\n  if (includeHeaders) {\n    lines.push(fields.map((f) => escapeCsvValue(f, delimiter)).join(delimiter))\n  }\n\n  // Rows\n  for (const row of data) {\n    const rowData = row as Record<string, unknown>\n    const values = fields.map((field) => {\n      const value = rowData[field]\n      return escapeCsvValue(String(value ?? ''), delimiter)\n    })\n    lines.push(values.join(delimiter))\n  }\n\n  const csv = lines.join('\\n')\n\n  return {\n    data: csv,\n    contentType: 'text/csv',\n    extension: 'csv',\n    size: new Blob([csv]).size,\n    streaming: false,\n  }\n}\n\n/**\n * Export to JSON\n */\nfunction exportToJSON(data: unknown[], options: ExportOptions): ExportResult {\n  const json = options.pretty ? JSON.stringify(data, null, 2) : JSON.stringify(data)\n\n  return {\n    data: json,\n    contentType: 'application/json',\n    extension: 'json',\n    size: new Blob([json]).size,\n    streaming: false,\n  }\n}\n\n/**\n * Export to NDJSON (newline-delimited JSON)\n */\nfunction exportToNDJSON(data: unknown[], options: ExportOptions): ExportResult {\n  const lines = data.map((item) => JSON.stringify(item))\n  const ndjson = lines.join('\\n')\n\n  return {\n    data: ndjson,\n    contentType: 'application/x-ndjson',\n    extension: 'ndjson',\n    size: new Blob([ndjson]).size,\n    streaming: false,\n  }\n}\n\n/**\n * Export to Excel (simplified - just CSV with different content type)\n * In production, use a library like ExcelJS\n */\nfunction exportToExcel(data: unknown[], options: ExportOptions): ExportResult {\n  // For now, use CSV format with Excel content type\n  // In production, implement proper XLSX generation\n  const csv = exportToCSV(data, options)\n\n  return {\n    ...csv,\n    contentType: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',\n    extension: 'xlsx',\n  }\n}\n\n/**\n * Escape CSV value\n */\nfunction escapeCsvValue(value: string, delimiter: string): string {\n  // Quote if contains delimiter, newline, or quote\n  if (value.includes(delimiter) || value.includes('\\n') || value.includes('\"')) {\n    return `\"${value.replace(/\"/g, '\"\"')}\"`\n  }\n  return value\n}\n\n/**\n * Create streaming export\n */\nexport function createStreamingExport(\n  dataSource: AsyncIterable<unknown[]>,\n  options: ExportOptions\n): ExportResult {\n  let isFirst = true\n  let fields: string[] = []\n\n  const stream = new ReadableStream<Uint8Array>({\n    async start(controller) {\n      const encoder = new TextEncoder()\n\n      try {\n        for await (const batch of dataSource) {\n          if (batch.length === 0) continue\n\n          // Get fields from first batch\n          if (isFirst) {\n            fields = options.fields || Object.keys(batch[0] as Record<string, unknown>)\n\n            // Write headers for CSV\n            if (options.format === 'csv' && options.headers !== false) {\n              const delimiter = options.delimiter || ','\n              const headerLine =\n                fields.map((f) => escapeCsvValue(f, delimiter)).join(delimiter) + '\\n'\n              controller.enqueue(encoder.encode(headerLine))\n            }\n\n            // Write JSON array start\n            if (options.format === 'json') {\n              controller.enqueue(encoder.encode('[\\n'))\n            }\n\n            isFirst = false\n          }\n\n          // Write batch\n          const chunk = formatBatch(batch, fields, options, isFirst)\n          controller.enqueue(encoder.encode(chunk))\n        }\n\n        // Write JSON array end\n        if (options.format === 'json') {\n          controller.enqueue(encoder.encode('\\n]'))\n        }\n\n        controller.close()\n      } catch (error) {\n        controller.error(error)\n      }\n    },\n  })\n\n  return {\n    data: stream,\n    contentType: getContentType(options.format),\n    extension: getExtension(options.format),\n    streaming: true,\n  }\n}\n\n/**\n * Format batch for streaming\n */\nfunction formatBatch(\n  batch: unknown[],\n  fields: string[],\n  options: ExportOptions,\n  isFirst: boolean\n): string {\n  switch (options.format) {\n    case 'csv':\n      return formatCsvBatch(batch, fields, options.delimiter || ',')\n\n    case 'json':\n      return formatJsonBatch(batch, isFirst)\n\n    case 'ndjson':\n      return formatNdjsonBatch(batch)\n\n    default:\n      return ''\n  }\n}\n\n/**\n * Format CSV batch\n */\nfunction formatCsvBatch(batch: unknown[], fields: string[], delimiter: string): string {\n  const lines: string[] = []\n\n  for (const row of batch) {\n    const rowData = row as Record<string, unknown>\n    const values = fields.map((field) => {\n      const value = rowData[field]\n      return escapeCsvValue(String(value ?? ''), delimiter)\n    })\n    lines.push(values.join(delimiter))\n  }\n\n  return lines.join('\\n') + '\\n'\n}\n\n/**\n * Format JSON batch\n */\nfunction formatJsonBatch(batch: unknown[], isFirst: boolean): string {\n  const items = batch.map((item, index) => {\n    const json = JSON.stringify(item, null, 2)\n    const prefix = isFirst && index === 0 ? '  ' : ',\\n  '\n    return prefix + json\n  })\n\n  return items.join('')\n}\n\n/**\n * Format NDJSON batch\n */\nfunction formatNdjsonBatch(batch: unknown[]): string {\n  return batch.map((item) => JSON.stringify(item)).join('\\n') + '\\n'\n}\n\n/**\n * Get content type for format\n */\nfunction getContentType(format: ExportFormat): string {\n  switch (format) {\n    case 'csv':\n      return 'text/csv'\n    case 'json':\n      return 'application/json'\n    case 'ndjson':\n      return 'application/x-ndjson'\n    case 'xlsx':\n      return 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'\n    default:\n      return 'application/octet-stream'\n  }\n}\n\n/**\n * Get file extension for format\n */\nfunction getExtension(format: ExportFormat): string {\n  switch (format) {\n    case 'csv':\n      return 'csv'\n    case 'json':\n      return 'json'\n    case 'ndjson':\n      return 'ndjson'\n    case 'xlsx':\n      return 'xlsx'\n    default:\n      return 'bin'\n  }\n}\n","/**\n * Data Agent - SQL Databases and Structured Data\n *\n * Handles database operations through a unified Repository interface.\n * Database backend is injected, making it testable and platform-agnostic.\n *\n * Database types:\n * - D1: SQLite database (Cloudflare D1)\n * - Hyperdrive: PostgreSQL/MySQL connection pooling (Cloudflare Hyperdrive)\n * - Vectorize: Vector database for embeddings (Cloudflare Vectorize)\n * - External: Supabase, Neon, PlanetScale, etc.\n */\n\nimport { BaseAgent, type AgentExecutionContext } from './base-agent.js'\nimport type { AgentConfig } from '../runtime/parser.js'\nimport type { Repository } from '../storage/index.js'\nimport {\n  D1Repository,\n  JSONSerializer,\n  HyperdriveRepository,\n  type HyperdriveConfig,\n  type DatabaseType as HyperdriveDatabaseType,\n} from '../storage/index.js'\nimport { DatabaseType } from '../types/constants.js'\nimport type { ConductorEnv } from '../types/env.js'\nimport {\n  exportData,\n  createStreamingExport,\n  type ExportOptions,\n  type ExportFormat,\n} from './data/export-formats.js'\n\nexport interface DataConfig {\n  database: DatabaseType\n  operation: 'get' | 'put' | 'delete' | 'list' | 'query' | 'export'\n  binding?: string // Name of the binding in wrangler.toml\n  // Database options\n  tableName?: string\n  // Hyperdrive options\n  databaseType?: HyperdriveDatabaseType // 'postgres' | 'mysql' | 'mariadb'\n  schema?: string // Schema name (for Postgres)\n  readOnly?: boolean // Prevent write operations\n  // Export options\n  exportFormat?: ExportFormat\n  exportOptions?: ExportOptions\n}\n\nexport interface DataInput {\n  // Record operations\n  key?: string\n  value?: unknown\n  // List/Query options\n  prefix?: string\n  limit?: number\n  cursor?: string\n  // SQL query options\n  query?: string\n  params?: unknown[]\n  filter?: Record<string, unknown>\n  sort?: string\n  // Export options\n  format?: ExportFormat\n  exportOptions?: ExportOptions\n  streaming?: boolean\n}\n\n/**\n * Data Agent performs database operations via Repository pattern\n *\n * Benefits of Repository pattern:\n * - Platform-agnostic (works with any database backend)\n * - Testable (easy to inject mock repositories)\n * - Composable (repositories can be chained, cached, etc.)\n * - Type-safe (Result types for error handling)\n */\nexport class DataAgent extends BaseAgent {\n  private dataConfig: DataConfig\n  private hyperdriveRepo?: HyperdriveRepository\n\n  constructor(\n    config: AgentConfig,\n    private readonly repository?: Repository<unknown, string>\n  ) {\n    super(config)\n\n    const cfg = config.config as DataConfig | undefined\n    this.dataConfig = {\n      database: cfg?.database as DatabaseType,\n      operation: cfg?.operation as 'get' | 'put' | 'delete' | 'list' | 'query' | 'export',\n      binding: cfg?.binding,\n      tableName: cfg?.tableName,\n      // Hyperdrive options\n      databaseType: cfg?.databaseType,\n      schema: cfg?.schema,\n      readOnly: cfg?.readOnly,\n      // Export options\n      exportFormat: cfg?.exportFormat,\n      exportOptions: cfg?.exportOptions,\n    }\n\n    // Validate config\n    if (!this.dataConfig.database) {\n      throw new Error(\n        `Data agent \"${config.name}\" requires database type (d1, hyperdrive, vectorize, etc.)`\n      )\n    }\n\n    if (!this.dataConfig.operation) {\n      throw new Error(`Data agent \"${config.name}\" requires operation type`)\n    }\n  }\n\n  /**\n   * Execute data operation via repository\n   */\n  protected async run(context: AgentExecutionContext): Promise<unknown> {\n    const { input, env } = context\n\n    // Handle Hyperdrive separately (SQL-native, not key-value)\n    if (this.dataConfig.database === DatabaseType.Hyperdrive) {\n      return await this.executeHyperdriveOperation(env, input)\n    }\n\n    // Get or create repository for KV-style databases\n    const repo = this.repository || this.createRepository(env)\n\n    switch (this.dataConfig.operation) {\n      case 'get':\n        return await this.executeGet(repo, input)\n\n      case 'put':\n        return await this.executePut(repo, input)\n\n      case 'delete':\n        return await this.executeDelete(repo, input)\n\n      case 'list':\n        return await this.executeList(repo, input)\n\n      case 'query':\n        return await this.executeQuery(repo, input)\n\n      case 'export':\n        return await this.executeExport(repo, input)\n\n      default:\n        throw new Error(`Unknown operation: ${this.dataConfig.operation}`)\n    }\n  }\n\n  /**\n   * Execute Hyperdrive operation (SQL-native)\n   */\n  private async executeHyperdriveOperation(env: ConductorEnv, input: DataInput): Promise<unknown> {\n    // Create or get cached Hyperdrive repository\n    if (!this.hyperdriveRepo) {\n      this.hyperdriveRepo = this.createHyperdriveRepository(env)\n    }\n\n    switch (this.dataConfig.operation) {\n      case 'query': {\n        // Execute SQL query\n        if (!input.query) {\n          return {\n            success: false,\n            error: 'SQL query is required for Hyperdrive query operation',\n          }\n        }\n\n        const result = await this.hyperdriveRepo.query(input.query, input.params)\n        if (result.success) {\n          return {\n            rows: result.value.rows,\n            metadata: result.value.metadata,\n            success: true,\n          }\n        } else {\n          return {\n            rows: [],\n            success: false,\n            error: result.error.message,\n          }\n        }\n      }\n\n      case 'get': {\n        // Simple get by key - requires tableName and key\n        if (!input.key) {\n          return { value: null, success: false, error: 'Key is required for get operation' }\n        }\n        const tableName = this.dataConfig.tableName || 'data'\n        const sql =\n          this.dataConfig.databaseType === 'postgres'\n            ? `SELECT * FROM ${tableName} WHERE id = $1 LIMIT 1`\n            : `SELECT * FROM ${tableName} WHERE id = ? LIMIT 1`\n\n        const result = await this.hyperdriveRepo.query(sql, [input.key])\n        if (result.success && result.value.rows.length > 0) {\n          return { value: result.value.rows[0], found: true, success: true }\n        }\n        return { value: null, found: false, success: true }\n      }\n\n      case 'put': {\n        // Upsert operation\n        if (!input.key || input.value === undefined) {\n          return { success: false, error: 'Key and value are required for put operation' }\n        }\n        const tableName = this.dataConfig.tableName || 'data'\n        const valueJson = JSON.stringify(input.value)\n\n        let sql: string\n        if (this.dataConfig.databaseType === 'postgres') {\n          sql = `INSERT INTO ${tableName} (id, value) VALUES ($1, $2)\n                 ON CONFLICT (id) DO UPDATE SET value = $2`\n        } else {\n          sql = `INSERT INTO ${tableName} (id, value) VALUES (?, ?)\n                 ON DUPLICATE KEY UPDATE value = VALUES(value)`\n        }\n\n        const result = await this.hyperdriveRepo.execute(sql, [input.key, valueJson])\n        return result.success\n          ? { success: true, rowsAffected: result.value.rowsAffected }\n          : { success: false, error: result.error.message }\n      }\n\n      case 'delete': {\n        if (!input.key) {\n          return { success: false, error: 'Key is required for delete operation' }\n        }\n        const tableName = this.dataConfig.tableName || 'data'\n        const sql =\n          this.dataConfig.databaseType === 'postgres'\n            ? `DELETE FROM ${tableName} WHERE id = $1`\n            : `DELETE FROM ${tableName} WHERE id = ?`\n\n        const result = await this.hyperdriveRepo.execute(sql, [input.key])\n        return result.success\n          ? { success: true, rowsAffected: result.value.rowsAffected }\n          : { success: false, error: result.error.message }\n      }\n\n      case 'list': {\n        const tableName = this.dataConfig.tableName || 'data'\n        const limit = input.limit || 100\n        const sql =\n          this.dataConfig.databaseType === 'postgres'\n            ? `SELECT * FROM ${tableName} LIMIT $1`\n            : `SELECT * FROM ${tableName} LIMIT ?`\n\n        const result = await this.hyperdriveRepo.query(sql, [limit])\n        return result.success\n          ? { items: result.value.rows, count: result.value.rows.length, success: true }\n          : { items: [], success: false, error: result.error.message }\n      }\n\n      default:\n        return {\n          success: false,\n          error: `Operation ${this.dataConfig.operation} not supported for Hyperdrive`,\n        }\n    }\n  }\n\n  /**\n   * Create Hyperdrive repository from environment bindings\n   */\n  private createHyperdriveRepository(env: ConductorEnv): HyperdriveRepository {\n    const bindingName = this.getBindingName()\n    const binding = env[bindingName as keyof ConductorEnv]\n\n    if (!binding) {\n      throw new Error(\n        `Hyperdrive binding \"${bindingName}\" not found. ` +\n          `Add [[hyperdrive]] to wrangler.toml with binding = \"${bindingName}\".`\n      )\n    }\n\n    const config: HyperdriveConfig = {\n      databaseType: this.dataConfig.databaseType || 'postgres',\n      schema: this.dataConfig.schema,\n      options: {\n        readOnly: this.dataConfig.readOnly,\n      },\n    }\n\n    return new HyperdriveRepository(binding as D1Database, config)\n  }\n\n  /**\n   * Execute GET operation\n   */\n  private async executeGet(repo: Repository<unknown, string>, input: DataInput): Promise<unknown> {\n    if (!input.key) {\n      throw new Error('GET operation requires \"key\" in input')\n    }\n\n    const result = await repo.get(input.key)\n\n    if (result.success) {\n      return {\n        key: input.key,\n        value: result.value,\n        found: true,\n      }\n    } else {\n      return {\n        key: input.key,\n        value: null,\n        found: false,\n        error: result.error.message,\n      }\n    }\n  }\n\n  /**\n   * Execute PUT operation\n   */\n  private async executePut(repo: Repository<unknown, string>, input: DataInput): Promise<unknown> {\n    if (!input.key || input.value === undefined) {\n      throw new Error('PUT operation requires \"key\" and \"value\" in input')\n    }\n\n    const result = await repo.put(input.key, input.value)\n\n    if (result.success) {\n      return {\n        key: input.key,\n        success: true,\n      }\n    } else {\n      return {\n        key: input.key,\n        success: false,\n        error: result.error.message,\n      }\n    }\n  }\n\n  /**\n   * Execute DELETE operation\n   */\n  private async executeDelete(\n    repo: Repository<unknown, string>,\n    input: DataInput\n  ): Promise<unknown> {\n    if (!input.key) {\n      throw new Error('DELETE operation requires \"key\" in input')\n    }\n\n    const result = await repo.delete(input.key)\n\n    if (result.success) {\n      return {\n        key: input.key,\n        success: true,\n      }\n    } else {\n      return {\n        key: input.key,\n        success: false,\n        error: result.error.message,\n      }\n    }\n  }\n\n  /**\n   * Execute LIST operation\n   */\n  private async executeList(repo: Repository<unknown, string>, input: DataInput): Promise<unknown> {\n    const result = await repo.list({\n      prefix: input.prefix,\n      limit: input.limit,\n      cursor: input.cursor,\n    })\n\n    if (result.success) {\n      return {\n        items: result.value,\n        success: true,\n      }\n    } else {\n      return {\n        items: [],\n        success: false,\n        error: result.error.message,\n      }\n    }\n  }\n\n  /**\n   * Create repository from environment bindings\n   * Falls back to original behavior if no repository injected\n   */\n  private createRepository(env: ConductorEnv): Repository<unknown, string> {\n    const bindingName = this.getBindingName()\n    const binding = env[bindingName as keyof ConductorEnv]\n\n    if (!binding) {\n      throw new Error(\n        `Binding \"${bindingName}\" not found. ` +\n          `Add it to wrangler.toml or inject a repository in constructor.`\n      )\n    }\n\n    switch (this.dataConfig.database) {\n      case DatabaseType.D1:\n        return new D1Repository(\n          binding,\n          {\n            tableName: this.dataConfig.tableName || 'data',\n            idColumn: 'key',\n            valueColumn: 'value',\n          },\n          new JSONSerializer()\n        )\n\n      case DatabaseType.Hyperdrive:\n        // Hyperdrive is handled separately in executeHyperdriveOperation()\n        // This should never be reached due to the check in run()\n        throw new Error('Hyperdrive uses SQL-native operations, not Repository pattern')\n\n      case DatabaseType.Vectorize:\n        // Vectorize requires embeddings and semantic operations\n        // Use the RAG agent instead: operation: rag with config.operation: search/index\n        throw new Error(\n          'Vectorize is not supported via the data agent. Use the RAG agent (operation: rag) for vector operations.'\n        )\n\n      case DatabaseType.Supabase:\n      case DatabaseType.Neon:\n      case DatabaseType.PlanetScale:\n        // TODO: Implement external database repositories\n        throw new Error(`${this.dataConfig.database} repository not yet implemented`)\n\n      default:\n        throw new Error(`Unknown database type: ${this.dataConfig.database}`)\n    }\n  }\n\n  /**\n   * Get binding name with sensible defaults\n   */\n  private getBindingName(): string {\n    if (this.dataConfig.binding) {\n      return this.dataConfig.binding\n    }\n\n    // Default binding names for databases\n    switch (this.dataConfig.database) {\n      case DatabaseType.D1:\n        return 'DB'\n      case DatabaseType.Hyperdrive:\n        return 'HYPERDRIVE'\n      case DatabaseType.Vectorize:\n        return 'VECTORIZE'\n      case DatabaseType.Supabase:\n        return 'SUPABASE_URL'\n      case DatabaseType.Neon:\n        return 'NEON_URL'\n      case DatabaseType.PlanetScale:\n        return 'PLANETSCALE_URL'\n      default:\n        return 'DATABASE'\n    }\n  }\n\n  /**\n   * Execute QUERY operation (D1 only)\n   */\n  private async executeQuery(\n    repo: Repository<unknown, string>,\n    input: DataInput\n  ): Promise<unknown> {\n    // Query operations are storage-specific\n    // For now, use list with filtering\n    const listResult = await repo.list({\n      prefix: input.prefix,\n      limit: input.limit,\n      cursor: input.cursor,\n    })\n\n    if (!listResult.success) {\n      return {\n        items: [],\n        success: false,\n        error: listResult.error.message,\n      }\n    }\n\n    let items = listResult.value\n\n    // Apply filters if provided\n    if (input.filter) {\n      items = items.filter((item: any) => {\n        return Object.entries(input.filter!).every(([key, value]) => {\n          return item[key] === value\n        })\n      })\n    }\n\n    // Apply sorting if provided\n    if (input.sort) {\n      const [field, order = 'asc'] = input.sort.split(':')\n      items = items.sort((a: any, b: any) => {\n        const aVal = a[field]\n        const bVal = b[field]\n        if (order === 'desc') {\n          return bVal > aVal ? 1 : bVal < aVal ? -1 : 0\n        }\n        return aVal > bVal ? 1 : aVal < bVal ? -1 : 0\n      })\n    }\n\n    return {\n      items,\n      count: items.length,\n      success: true,\n    }\n  }\n\n  /**\n   * Execute EXPORT operation\n   */\n  private async executeExport(\n    repo: Repository<unknown, string>,\n    input: DataInput\n  ): Promise<unknown> {\n    // Get data to export\n    const listResult = await repo.list({\n      prefix: input.prefix,\n      limit: input.limit || 10000, // Default to large limit for exports\n      cursor: input.cursor,\n    })\n\n    if (!listResult.success) {\n      return {\n        success: false,\n        error: listResult.error.message,\n      }\n    }\n\n    let items = listResult.value\n\n    // Apply filters if provided\n    if (input.filter) {\n      items = items.filter((item: any) => {\n        return Object.entries(input.filter!).every(([key, value]) => {\n          return item[key] === value\n        })\n      })\n    }\n\n    // Prepare export options\n    const exportOptions: ExportOptions = {\n      format: input.format || this.dataConfig.exportFormat || 'json',\n      ...this.dataConfig.exportOptions,\n      ...input.exportOptions,\n    }\n\n    // Handle streaming export for large datasets\n    if (input.streaming || items.length > 1000) {\n      // Create async iterable for streaming\n      async function* dataSource() {\n        const batchSize = exportOptions.batchSize || 100\n        for (let i = 0; i < items.length; i += batchSize) {\n          yield items.slice(i, i + batchSize)\n        }\n      }\n\n      const exportResult = createStreamingExport(dataSource(), exportOptions)\n\n      return {\n        success: true,\n        streaming: true,\n        stream: exportResult.data,\n        contentType: exportResult.contentType,\n        extension: exportResult.extension,\n        count: items.length,\n      }\n    }\n\n    // Non-streaming export\n    const exportResult = await exportData(items, exportOptions)\n\n    return {\n      success: true,\n      streaming: false,\n      data: exportResult.data,\n      contentType: exportResult.contentType,\n      extension: exportResult.extension,\n      size: exportResult.size,\n      count: items.length,\n    }\n  }\n\n  /**\n   * Get Data configuration\n   */\n  getDataConfig(): DataConfig {\n    return { ...this.dataConfig }\n  }\n}\n","/**\n * API Agent Engine\n *\n * Makes HTTP requests to external APIs\n * Handles method, headers, body, timeouts, and response parsing\n */\n\nimport { BaseAgent, type AgentExecutionContext } from './base-agent.js'\nimport type { AgentConfig } from '../runtime/parser.js'\nimport type { RouteAuthConfig } from '../routing/config.js'\n\nexport interface APIConfig {\n  /** Route configuration for UnifiedRouter integration */\n  route?: {\n    /** Route path (e.g., \"/api/v1/users\") */\n    path?: string\n    /** HTTP methods (defaults to ['GET', 'POST', 'PUT', 'DELETE', 'PATCH']) */\n    methods?: string[]\n    /** Auth configuration */\n    auth?: Partial<RouteAuthConfig>\n    /** Priority (defaults to 50 for APIs) */\n    priority?: number\n    /** Response headers to add/override */\n    headers?: Record<string, string>\n    /** CORS configuration */\n    cors?: {\n      origins?: string[] | '*'\n      methods?: string[]\n      allowedHeaders?: string[]\n      exposedHeaders?: string[]\n      credentials?: boolean\n      maxAge?: number\n    }\n  }\n  url?: string\n  method?: 'GET' | 'POST' | 'PUT' | 'DELETE' | 'PATCH'\n  headers?: Record<string, string>\n  timeout?: number\n  retries?: number\n}\n\n/**\n * API Agent makes HTTP requests to external services\n *\n * @example User's agent definition:\n * ```yaml\n * # agents/fetch-company/agent.yaml\n * name: fetch-company\n * type: API\n * description: Fetch company data from external API\n * config:\n *   url: https://api.example.com/company\n *   method: GET\n *   headers:\n *     Authorization: Bearer ${env.API_KEY}\n *   timeout: 5000\n * schema:\n *   input:\n *     domain: string\n *   output:\n *     data: object\n * ```\n */\nexport class APIAgent extends BaseAgent {\n  private apiConfig: APIConfig\n\n  constructor(config: AgentConfig) {\n    super(config)\n\n    // Extract API-specific config\n    const cfg = config.config as APIConfig | undefined\n    this.apiConfig = {\n      url: cfg?.url,\n      method: cfg?.method || 'GET',\n      headers: cfg?.headers || {},\n      timeout: cfg?.timeout || 30000,\n      retries: cfg?.retries || 0,\n    }\n  }\n\n  /**\n   * Execute the API request\n   */\n  protected async run(\n    context: AgentExecutionContext\n  ): Promise<{ status: number; headers: Record<string, string>; data: unknown }> {\n    const { input } = context\n\n    // Resolve URL (may contain interpolations)\n    const url = this.apiConfig.url || input.url\n    if (!url) {\n      throw new Error(`API agent \"${this.name}\" requires a URL (in config or input)`)\n    }\n\n    // Build request options\n    const requestInit: RequestInit = {\n      method: this.apiConfig.method,\n      headers: this.resolveHeaders(this.apiConfig.headers || {}, context),\n    }\n\n    // Add body for POST/PUT/PATCH\n    if (['POST', 'PUT', 'PATCH'].includes(this.apiConfig.method!)) {\n      if (input.body) {\n        requestInit.body = typeof input.body === 'string' ? input.body : JSON.stringify(input.body)\n\n        // Set content-type if not already set\n        const headers = requestInit.headers as Record<string, string>\n        if (!headers['content-type'] && !headers['Content-Type']) {\n          headers['content-type'] = 'application/json'\n        }\n      }\n    }\n\n    // Execute with timeout and retries\n    return await this.executeWithRetries(url, requestInit)\n  }\n\n  /**\n   * Resolve headers (may contain env var references)\n   */\n  private resolveHeaders(\n    headers: Record<string, string>,\n    context: AgentExecutionContext\n  ): Record<string, string> {\n    const resolved: Record<string, string> = {}\n\n    for (const [key, value] of Object.entries(headers)) {\n      // Replace ${env.VAR_NAME} with actual env var\n      resolved[key] = value.replace(/\\$\\{env\\.(\\w+)\\}/g, (_, varName) => {\n        return ((context.env as unknown as Record<string, unknown>)[varName] as string) || ''\n      })\n    }\n\n    return resolved\n  }\n\n  /**\n   * Execute request with timeout and retry logic\n   */\n  private async executeWithRetries(\n    url: string,\n    init: RequestInit,\n    attempt: number = 0\n  ): Promise<{ status: number; headers: Record<string, string>; data: unknown }> {\n    try {\n      // Create abort controller for timeout\n      const controller = new AbortController()\n      const timeoutId = setTimeout(() => controller.abort(), this.apiConfig.timeout)\n\n      try {\n        // Make the request\n        const response = await fetch(url, {\n          ...init,\n          signal: controller.signal,\n        })\n\n        clearTimeout(timeoutId)\n\n        // Parse response\n        const contentType = response.headers.get('content-type')\n        let data: unknown\n\n        if (contentType?.includes('application/json')) {\n          data = await response.json()\n        } else {\n          data = await response.text()\n        }\n\n        // Check if response was successful\n        if (!response.ok) {\n          throw new Error(`HTTP ${response.status}: ${response.statusText}`)\n        }\n\n        return {\n          status: response.status,\n          headers: Object.fromEntries(response.headers.entries()),\n          data,\n        }\n      } finally {\n        clearTimeout(timeoutId)\n      }\n    } catch (error) {\n      // Retry logic\n      if (attempt < (this.apiConfig.retries || 0)) {\n        // Exponential backoff\n        const delay = Math.min(1000 * Math.pow(2, attempt), 10000)\n        await new Promise((resolve) => setTimeout(resolve, delay))\n\n        return this.executeWithRetries(url, init, attempt + 1)\n      }\n\n      // Final error\n      throw new Error(\n        `API request to ${url} failed after ${attempt + 1} attempts: ${\n          error instanceof Error ? error.message : 'Unknown error'\n        }`\n      )\n    }\n  }\n\n  /**\n   * Get API configuration\n   */\n  getAPIConfig(): APIConfig {\n    return { ...this.apiConfig }\n  }\n}\n","/**\n * Base Email Provider\n *\n * Abstract base class for all email providers\n */\n\nimport type {\n  EmailProvider,\n  EmailMessage,\n  EmailResult,\n  ValidationResult,\n  EmailStatus,\n} from '../types/index.js'\n\n/**\n * Abstract base email provider\n */\nexport abstract class BaseEmailProvider implements EmailProvider {\n  abstract name: string\n\n  /**\n   * Send an email\n   */\n  abstract send(message: EmailMessage): Promise<EmailResult>\n\n  /**\n   * Validate provider configuration\n   */\n  abstract validateConfig(): Promise<ValidationResult>\n\n  /**\n   * Verify email address (optional)\n   */\n  async verify?(email: string): Promise<boolean>\n\n  /**\n   * Get email status (optional)\n   */\n  async getStatus?(messageId: string): Promise<EmailStatus>\n\n  /**\n   * Normalize recipients to array\n   */\n  protected normalizeRecipients(recipients: string | string[]): string[] {\n    return Array.isArray(recipients) ? recipients : [recipients]\n  }\n\n  /**\n   * Validate email address format\n   */\n  protected validateEmail(email: string): boolean {\n    const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/\n    return emailRegex.test(email)\n  }\n\n  /**\n   * Validate required fields\n   */\n  protected validateMessage(message: EmailMessage): ValidationResult {\n    const errors: string[] = []\n\n    if (!message.to || (Array.isArray(message.to) && message.to.length === 0)) {\n      errors.push('Recipient (to) is required')\n    }\n\n    if (!message.subject || message.subject.trim() === '') {\n      errors.push('Subject is required')\n    }\n\n    if (!message.html && !message.text) {\n      errors.push('Either html or text content is required')\n    }\n\n    // Validate email addresses\n    const recipients = this.normalizeRecipients(message.to)\n    for (const email of recipients) {\n      if (!this.validateEmail(email)) {\n        errors.push(`Invalid email address: ${email}`)\n      }\n    }\n\n    return {\n      valid: errors.length === 0,\n      errors: errors.length > 0 ? errors : undefined,\n    }\n  }\n}\n","/**\n * Cloudflare Email Provider\n *\n * Uses Cloudflare's native Email Workers binding\n * https://developers.cloudflare.com/email-routing/email-workers/\n */\n\nimport { BaseEmailProvider } from './base.js'\nimport type {\n  EmailMessage,\n  EmailResult,\n  ValidationResult,\n  CloudflareEmailBinding,\n  CloudflareEmailRequest,\n} from '../types/index.js'\n\n/**\n * Cloudflare Email Provider\n */\nexport class CloudflareEmailProvider extends BaseEmailProvider {\n  name = 'cloudflare'\n\n  constructor(\n    private binding: CloudflareEmailBinding,\n    private defaultFrom: string,\n    private enableDkim: boolean = true\n  ) {\n    super()\n  }\n\n  /**\n   * Send email via Cloudflare Email Workers\n   */\n  async send(message: EmailMessage): Promise<EmailResult> {\n    // Validate message\n    const validation = this.validateMessage(message)\n    if (!validation.valid) {\n      return {\n        messageId: '',\n        status: 'failed',\n        provider: this.name,\n        error: validation.errors?.join(', '),\n      }\n    }\n\n    try {\n      // Build Cloudflare email request\n      const request: CloudflareEmailRequest = {\n        from: message.from || this.defaultFrom,\n        to: message.to,\n        subject: message.subject,\n        html: message.html,\n        text: message.text,\n        headers: message.headers,\n      }\n\n      // Add DKIM headers if enabled\n      if (this.enableDkim && request.headers) {\n        request.headers['X-Cloudflare-DKIM'] = 'enabled'\n      }\n\n      // Send via binding\n      const response = await this.binding.send(request)\n\n      if (!response.success) {\n        return {\n          messageId: '',\n          status: 'failed',\n          provider: this.name,\n          error: response.error || 'Unknown error',\n        }\n      }\n\n      return {\n        messageId: response.messageId || `cf-${Date.now()}`,\n        status: 'sent',\n        provider: this.name,\n      }\n    } catch (error) {\n      return {\n        messageId: '',\n        status: 'failed',\n        provider: this.name,\n        error: error instanceof Error ? error.message : 'Unknown error',\n      }\n    }\n  }\n\n  /**\n   * Validate configuration\n   */\n  async validateConfig(): Promise<ValidationResult> {\n    const errors: string[] = []\n\n    if (!this.binding) {\n      errors.push('Cloudflare Email binding is not configured')\n    }\n\n    if (!this.defaultFrom) {\n      errors.push('Default from address is required')\n    } else if (!this.validateEmail(this.defaultFrom)) {\n      errors.push('Default from address is invalid')\n    }\n\n    return {\n      valid: errors.length === 0,\n      errors: errors.length > 0 ? errors : undefined,\n    }\n  }\n}\n","/**\n * Resend Email Provider\n *\n * Uses Resend's API for email delivery\n * https://resend.com/docs\n */\n\nimport { BaseEmailProvider } from './base.js'\nimport type {\n  EmailMessage,\n  EmailResult,\n  ValidationResult,\n  EmailAttachment,\n} from '../types/index.js'\n\ninterface ResendEmailRequest {\n  from: string\n  to: string | string[]\n  subject: string\n  html?: string\n  text?: string\n  cc?: string | string[]\n  bcc?: string | string[]\n  reply_to?: string\n  attachments?: ResendAttachment[]\n  tags?: { name: string; value: string }[]\n  headers?: Record<string, string>\n}\n\ninterface ResendAttachment {\n  filename: string\n  content: string\n}\n\ninterface ResendEmailResponse {\n  id: string\n  error?: {\n    message: string\n    name: string\n  }\n}\n\n/**\n * Resend Email Provider\n */\nexport class ResendProvider extends BaseEmailProvider {\n  name = 'resend'\n  private apiUrl = 'https://api.resend.com/emails'\n\n  constructor(\n    private apiKey: string,\n    private defaultFrom: string\n  ) {\n    super()\n  }\n\n  /**\n   * Send email via Resend API\n   */\n  async send(message: EmailMessage): Promise<EmailResult> {\n    // Validate message\n    const validation = this.validateMessage(message)\n    if (!validation.valid) {\n      return {\n        messageId: '',\n        status: 'failed',\n        provider: this.name,\n        error: validation.errors?.join(', '),\n      }\n    }\n\n    try {\n      // Build Resend request\n      const request: ResendEmailRequest = {\n        from: message.from || this.defaultFrom,\n        to: message.to,\n        subject: message.subject,\n        html: message.html,\n        text: message.text,\n      }\n\n      // Optional fields\n      if (message.cc) request.cc = message.cc\n      if (message.bcc) request.bcc = message.bcc\n      if (message.replyTo) request.reply_to = message.replyTo\n      if (message.headers) request.headers = message.headers\n\n      // Convert attachments\n      if (message.attachments) {\n        request.attachments = message.attachments.map((att) => ({\n          filename: att.filename,\n          content: typeof att.content === 'string' ? att.content : att.content.toString('base64'),\n        }))\n      }\n\n      // Convert tags\n      if (message.tags) {\n        request.tags = message.tags.map((tag) => ({\n          name: tag,\n          value: 'true',\n        }))\n      }\n\n      // Send via API\n      const response = await fetch(this.apiUrl, {\n        method: 'POST',\n        headers: {\n          Authorization: `Bearer ${this.apiKey}`,\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(request),\n      })\n\n      const data = (await response.json()) as ResendEmailResponse\n\n      if (!response.ok || data.error) {\n        return {\n          messageId: '',\n          status: 'failed',\n          provider: this.name,\n          error: data.error?.message || `HTTP ${response.status}`,\n        }\n      }\n\n      return {\n        messageId: data.id,\n        status: 'sent',\n        provider: this.name,\n      }\n    } catch (error) {\n      return {\n        messageId: '',\n        status: 'failed',\n        provider: this.name,\n        error: error instanceof Error ? error.message : 'Unknown error',\n      }\n    }\n  }\n\n  /**\n   * Validate configuration\n   */\n  async validateConfig(): Promise<ValidationResult> {\n    const errors: string[] = []\n\n    if (!this.apiKey) {\n      errors.push('Resend API key is required')\n    }\n\n    if (!this.defaultFrom) {\n      errors.push('Default from address is required')\n    } else if (!this.validateEmail(this.defaultFrom)) {\n      errors.push('Default from address is invalid')\n    }\n\n    return {\n      valid: errors.length === 0,\n      errors: errors.length > 0 ? errors : undefined,\n    }\n  }\n}\n","/**\n * SMTP Email Provider\n *\n * Generic SMTP provider for any SMTP server\n * Works with Cloudflare Workers via fetch-based SMTP client\n */\n\nimport { BaseEmailProvider } from './base.js'\nimport type { EmailMessage, EmailResult, ValidationResult } from '../types/index.js'\n\n/**\n * SMTP Configuration\n */\nexport interface SmtpConfig {\n  host: string\n  port: number\n  secure: boolean\n  auth: {\n    user: string\n    pass: string\n  }\n}\n\n/**\n * SMTP Email Provider\n */\nexport class SmtpProvider extends BaseEmailProvider {\n  name = 'smtp'\n\n  constructor(\n    private config: SmtpConfig,\n    private defaultFrom: string\n  ) {\n    super()\n  }\n\n  /**\n   * Send email via SMTP\n   */\n  async send(message: EmailMessage): Promise<EmailResult> {\n    // Validate message\n    const validation = this.validateMessage(message)\n    if (!validation.valid) {\n      return {\n        messageId: '',\n        status: 'failed',\n        provider: this.name,\n        error: validation.errors?.join(', '),\n      }\n    }\n\n    try {\n      // Build SMTP envelope\n      const from = message.from || this.defaultFrom\n      const to = this.normalizeRecipients(message.to)\n      const messageId = `<${Date.now()}.${Math.random().toString(36)}@${from.split('@')[1]}>`\n\n      // Build email headers\n      const headers: string[] = [\n        `Message-ID: ${messageId}`,\n        `From: ${from}`,\n        `To: ${to.join(', ')}`,\n        `Subject: ${message.subject}`,\n        `Date: ${new Date().toUTCString()}`,\n        'MIME-Version: 1.0',\n      ]\n\n      // Add optional headers\n      if (message.cc) {\n        headers.push(`Cc: ${this.normalizeRecipients(message.cc).join(', ')}`)\n      }\n      if (message.bcc) {\n        headers.push(`Bcc: ${this.normalizeRecipients(message.bcc).join(', ')}`)\n      }\n      if (message.replyTo) {\n        headers.push(`Reply-To: ${message.replyTo}`)\n      }\n\n      // Add custom headers\n      if (message.headers) {\n        for (const [key, value] of Object.entries(message.headers)) {\n          headers.push(`${key}: ${value}`)\n        }\n      }\n\n      // Build email body\n      let body = ''\n\n      if (message.html && message.text) {\n        // Multipart alternative\n        const boundary = `boundary_${Date.now()}_${Math.random().toString(36)}`\n        headers.push(`Content-Type: multipart/alternative; boundary=\"${boundary}\"`)\n\n        body = [\n          '',\n          `--${boundary}`,\n          'Content-Type: text/plain; charset=utf-8',\n          'Content-Transfer-Encoding: quoted-printable',\n          '',\n          this.encodeQuotedPrintable(message.text),\n          '',\n          `--${boundary}`,\n          'Content-Type: text/html; charset=utf-8',\n          'Content-Transfer-Encoding: quoted-printable',\n          '',\n          this.encodeQuotedPrintable(message.html),\n          '',\n          `--${boundary}--`,\n        ].join('\\r\\n')\n      } else if (message.html) {\n        headers.push('Content-Type: text/html; charset=utf-8')\n        headers.push('Content-Transfer-Encoding: quoted-printable')\n        body = '\\r\\n' + this.encodeQuotedPrintable(message.html)\n      } else if (message.text) {\n        headers.push('Content-Type: text/plain; charset=utf-8')\n        headers.push('Content-Transfer-Encoding: quoted-printable')\n        body = '\\r\\n' + this.encodeQuotedPrintable(message.text)\n      }\n\n      // Send via SMTP\n      const response = await this.sendSmtp(from, to, headers.join('\\r\\n') + body)\n\n      if (!response.success) {\n        return {\n          messageId: '',\n          status: 'failed',\n          provider: this.name,\n          error: response.error || 'SMTP send failed',\n        }\n      }\n\n      return {\n        messageId: messageId.slice(1, -1), // Remove < >\n        status: 'sent',\n        provider: this.name,\n      }\n    } catch (error) {\n      return {\n        messageId: '',\n        status: 'failed',\n        provider: this.name,\n        error: error instanceof Error ? error.message : 'Unknown error',\n      }\n    }\n  }\n\n  /**\n   * Validate configuration\n   */\n  async validateConfig(): Promise<ValidationResult> {\n    const errors: string[] = []\n\n    if (!this.config.host) {\n      errors.push('SMTP host is required')\n    }\n\n    if (!this.config.port || this.config.port < 1 || this.config.port > 65535) {\n      errors.push('Valid SMTP port is required (1-65535)')\n    }\n\n    if (!this.config.auth?.user) {\n      errors.push('SMTP username is required')\n    }\n\n    if (!this.config.auth?.pass) {\n      errors.push('SMTP password is required')\n    }\n\n    if (!this.defaultFrom) {\n      errors.push('Default from address is required')\n    } else if (!this.validateEmail(this.defaultFrom)) {\n      errors.push('Default from address is invalid')\n    }\n\n    return {\n      valid: errors.length === 0,\n      errors: errors.length > 0 ? errors : undefined,\n    }\n  }\n\n  /**\n   * Send email via SMTP protocol\n   */\n  private async sendSmtp(\n    from: string,\n    to: string[],\n    message: string\n  ): Promise<{ success: boolean; error?: string }> {\n    try {\n      // In Cloudflare Workers, we need to use a fetch-based SMTP proxy\n      // or connect directly via TCP sockets (if available)\n      // For now, we'll use a simple SMTP-over-HTTP proxy pattern\n\n      const protocol = this.config.secure ? 'smtps' : 'smtp'\n      const url = `${protocol}://${this.config.host}:${this.config.port}`\n\n      // This is a simplified implementation\n      // In production, you'd use a proper SMTP client library\n      // or an SMTP-over-HTTP proxy service\n\n      const response = await fetch(url, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'message/rfc822',\n          Authorization: `Basic ${btoa(`${this.config.auth.user}:${this.config.auth.pass}`)}`,\n        },\n        body: `MAIL FROM:<${from}>\\r\\nRCPT TO:<${to.join('>,<')}>\\r\\nDATA\\r\\n${message}\\r\\n.\\r\\n`,\n      })\n\n      if (!response.ok) {\n        return {\n          success: false,\n          error: `SMTP error: ${response.status} ${response.statusText}`,\n        }\n      }\n\n      return { success: true }\n    } catch (error) {\n      return {\n        success: false,\n        error: error instanceof Error ? error.message : 'Unknown SMTP error',\n      }\n    }\n  }\n\n  /**\n   * Encode string as quoted-printable\n   */\n  private encodeQuotedPrintable(text: string): string {\n    return text\n      .replace(/[^\\x20-\\x7E]/g, (char) => {\n        const hex = char.charCodeAt(0).toString(16).toUpperCase()\n        return '=' + (hex.length === 1 ? '0' + hex : hex)\n      })\n      .replace(/=/g, '=3D')\n      .replace(/\\r\\n/g, '\\n')\n      .split('\\n')\n      .map((line) => {\n        // Split long lines\n        if (line.length <= 76) return line\n        const result: string[] = []\n        for (let i = 0; i < line.length; i += 75) {\n          result.push(line.slice(i, i + 75) + '=')\n        }\n        return result.join('\\r\\n')\n      })\n      .join('\\r\\n')\n  }\n}\n","/**\n * Email Provider Registry\n *\n * Factory for creating email providers based on configuration\n */\n\nimport type { EmailProvider, EmailProviderConfig } from '../types/index.js'\nimport { CloudflareEmailProvider } from './cloudflare.js'\nimport { ResendProvider } from './resend.js'\nimport { SmtpProvider } from './smtp.js'\n\n/**\n * Create email provider from configuration\n */\nexport function createEmailProvider(config: EmailProviderConfig): EmailProvider {\n  const from = config.from || 'noreply@example.com'\n\n  switch (config.provider) {\n    case 'cloudflare':\n      if (!config.cloudflare?.binding) {\n        throw new Error('Cloudflare Email binding is required')\n      }\n      return new CloudflareEmailProvider(\n        config.cloudflare.binding,\n        from,\n        config.cloudflare.dkim ?? true\n      )\n\n    case 'resend':\n      if (!config.resend?.apiKey) {\n        throw new Error('Resend API key is required')\n      }\n      return new ResendProvider(config.resend.apiKey, from)\n\n    case 'smtp':\n      if (!config.smtp) {\n        throw new Error('SMTP configuration is required')\n      }\n      return new SmtpProvider(config.smtp, from)\n\n    default:\n      throw new Error(`Unknown email provider: ${config.provider}`)\n  }\n}\n\n/**\n * Export providers\n */\nexport { BaseEmailProvider } from './base.js'\nexport { CloudflareEmailProvider } from './cloudflare.js'\nexport { ResendProvider } from './resend.js'\nexport { SmtpProvider } from './smtp.js'\n","/**!\n\n @license\n handlebars v4.7.8\n\nCopyright (C) 2011-2019 by Yehuda Katz\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in\nall copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\nTHE SOFTWARE.\n\n*/\n(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"Handlebars\"] = factory();\n\telse\n\t\troot[\"Handlebars\"] = factory();\n})(this, function() {\nreturn /******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\texports: {},\n/******/ \t\t\tid: moduleId,\n/******/ \t\t\tloaded: false\n/******/ \t\t};\n\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.loaded = true;\n\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n\n\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\n\tvar _interopRequireWildcard = __webpack_require__(1)['default'];\n\n\tvar _interopRequireDefault = __webpack_require__(2)['default'];\n\n\texports.__esModule = true;\n\n\tvar _handlebarsBase = __webpack_require__(3);\n\n\tvar base = _interopRequireWildcard(_handlebarsBase);\n\n\t// Each of these augment the Handlebars object. No need to setup here.\n\t// (This is done to easily share code between commonjs and browse envs)\n\n\tvar _handlebarsSafeString = __webpack_require__(76);\n\n\tvar _handlebarsSafeString2 = _interopRequireDefault(_handlebarsSafeString);\n\n\tvar _handlebarsException = __webpack_require__(5);\n\n\tvar _handlebarsException2 = _interopRequireDefault(_handlebarsException);\n\n\tvar _handlebarsUtils = __webpack_require__(4);\n\n\tvar Utils = _interopRequireWildcard(_handlebarsUtils);\n\n\tvar _handlebarsRuntime = __webpack_require__(77);\n\n\tvar runtime = _interopRequireWildcard(_handlebarsRuntime);\n\n\tvar _handlebarsNoConflict = __webpack_require__(82);\n\n\tvar _handlebarsNoConflict2 = _interopRequireDefault(_handlebarsNoConflict);\n\n\t// For compatibility and usage outside of module systems, make the Handlebars object a namespace\n\tfunction create() {\n\t  var hb = new base.HandlebarsEnvironment();\n\n\t  Utils.extend(hb, base);\n\t  hb.SafeString = _handlebarsSafeString2['default'];\n\t  hb.Exception = _handlebarsException2['default'];\n\t  hb.Utils = Utils;\n\t  hb.escapeExpression = Utils.escapeExpression;\n\n\t  hb.VM = runtime;\n\t  hb.template = function (spec) {\n\t    return runtime.template(spec, hb);\n\t  };\n\n\t  return hb;\n\t}\n\n\tvar inst = create();\n\tinst.create = create;\n\n\t_handlebarsNoConflict2['default'](inst);\n\n\tinst['default'] = inst;\n\n\texports['default'] = inst;\n\tmodule.exports = exports['default'];\n\n/***/ }),\n/* 1 */\n/***/ (function(module, exports) {\n\n\t\"use strict\";\n\n\texports[\"default\"] = function (obj) {\n\t  if (obj && obj.__esModule) {\n\t    return obj;\n\t  } else {\n\t    var newObj = {};\n\n\t    if (obj != null) {\n\t      for (var key in obj) {\n\t        if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key];\n\t      }\n\t    }\n\n\t    newObj[\"default\"] = obj;\n\t    return newObj;\n\t  }\n\t};\n\n\texports.__esModule = true;\n\n/***/ }),\n/* 2 */\n/***/ (function(module, exports) {\n\n\t\"use strict\";\n\n\texports[\"default\"] = function (obj) {\n\t  return obj && obj.__esModule ? obj : {\n\t    \"default\": obj\n\t  };\n\t};\n\n\texports.__esModule = true;\n\n/***/ }),\n/* 3 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\n\tvar _interopRequireDefault = __webpack_require__(2)['default'];\n\n\texports.__esModule = true;\n\texports.HandlebarsEnvironment = HandlebarsEnvironment;\n\n\tvar _utils = __webpack_require__(4);\n\n\tvar _exception = __webpack_require__(5);\n\n\tvar _exception2 = _interopRequireDefault(_exception);\n\n\tvar _helpers = __webpack_require__(9);\n\n\tvar _decorators = __webpack_require__(69);\n\n\tvar _logger = __webpack_require__(71);\n\n\tvar _logger2 = _interopRequireDefault(_logger);\n\n\tvar _internalProtoAccess = __webpack_require__(72);\n\n\tvar VERSION = '4.7.8';\n\texports.VERSION = VERSION;\n\tvar COMPILER_REVISION = 8;\n\texports.COMPILER_REVISION = COMPILER_REVISION;\n\tvar LAST_COMPATIBLE_COMPILER_REVISION = 7;\n\n\texports.LAST_COMPATIBLE_COMPILER_REVISION = LAST_COMPATIBLE_COMPILER_REVISION;\n\tvar REVISION_CHANGES = {\n\t  1: '<= 1.0.rc.2', // 1.0.rc.2 is actually rev2 but doesn't report it\n\t  2: '== 1.0.0-rc.3',\n\t  3: '== 1.0.0-rc.4',\n\t  4: '== 1.x.x',\n\t  5: '== 2.0.0-alpha.x',\n\t  6: '>= 2.0.0-beta.1',\n\t  7: '>= 4.0.0 <4.3.0',\n\t  8: '>= 4.3.0'\n\t};\n\n\texports.REVISION_CHANGES = REVISION_CHANGES;\n\tvar objectType = '[object Object]';\n\n\tfunction HandlebarsEnvironment(helpers, partials, decorators) {\n\t  this.helpers = helpers || {};\n\t  this.partials = partials || {};\n\t  this.decorators = decorators || {};\n\n\t  _helpers.registerDefaultHelpers(this);\n\t  _decorators.registerDefaultDecorators(this);\n\t}\n\n\tHandlebarsEnvironment.prototype = {\n\t  constructor: HandlebarsEnvironment,\n\n\t  logger: _logger2['default'],\n\t  log: _logger2['default'].log,\n\n\t  registerHelper: function registerHelper(name, fn) {\n\t    if (_utils.toString.call(name) === objectType) {\n\t      if (fn) {\n\t        throw new _exception2['default']('Arg not supported with multiple helpers');\n\t      }\n\t      _utils.extend(this.helpers, name);\n\t    } else {\n\t      this.helpers[name] = fn;\n\t    }\n\t  },\n\t  unregisterHelper: function unregisterHelper(name) {\n\t    delete this.helpers[name];\n\t  },\n\n\t  registerPartial: function registerPartial(name, partial) {\n\t    if (_utils.toString.call(name) === objectType) {\n\t      _utils.extend(this.partials, name);\n\t    } else {\n\t      if (typeof partial === 'undefined') {\n\t        throw new _exception2['default']('Attempting to register a partial called \"' + name + '\" as undefined');\n\t      }\n\t      this.partials[name] = partial;\n\t    }\n\t  },\n\t  unregisterPartial: function unregisterPartial(name) {\n\t    delete this.partials[name];\n\t  },\n\n\t  registerDecorator: function registerDecorator(name, fn) {\n\t    if (_utils.toString.call(name) === objectType) {\n\t      if (fn) {\n\t        throw new _exception2['default']('Arg not supported with multiple decorators');\n\t      }\n\t      _utils.extend(this.decorators, name);\n\t    } else {\n\t      this.decorators[name] = fn;\n\t    }\n\t  },\n\t  unregisterDecorator: function unregisterDecorator(name) {\n\t    delete this.decorators[name];\n\t  },\n\t  /**\n\t   * Reset the memory of illegal property accesses that have already been logged.\n\t   * @deprecated should only be used in handlebars test-cases\n\t   */\n\t  resetLoggedPropertyAccesses: function resetLoggedPropertyAccesses() {\n\t    _internalProtoAccess.resetLoggedProperties();\n\t  }\n\t};\n\n\tvar log = _logger2['default'].log;\n\n\texports.log = log;\n\texports.createFrame = _utils.createFrame;\n\texports.logger = _logger2['default'];\n\n/***/ }),\n/* 4 */\n/***/ (function(module, exports) {\n\n\t'use strict';\n\n\texports.__esModule = true;\n\texports.extend = extend;\n\texports.indexOf = indexOf;\n\texports.escapeExpression = escapeExpression;\n\texports.isEmpty = isEmpty;\n\texports.createFrame = createFrame;\n\texports.blockParams = blockParams;\n\texports.appendContextPath = appendContextPath;\n\tvar escape = {\n\t  '&': '&amp;',\n\t  '<': '&lt;',\n\t  '>': '&gt;',\n\t  '\"': '&quot;',\n\t  \"'\": '&#x27;',\n\t  '`': '&#x60;',\n\t  '=': '&#x3D;'\n\t};\n\n\tvar badChars = /[&<>\"'`=]/g,\n\t    possible = /[&<>\"'`=]/;\n\n\tfunction escapeChar(chr) {\n\t  return escape[chr];\n\t}\n\n\tfunction extend(obj /* , ...source */) {\n\t  for (var i = 1; i < arguments.length; i++) {\n\t    for (var key in arguments[i]) {\n\t      if (Object.prototype.hasOwnProperty.call(arguments[i], key)) {\n\t        obj[key] = arguments[i][key];\n\t      }\n\t    }\n\t  }\n\n\t  return obj;\n\t}\n\n\tvar toString = Object.prototype.toString;\n\n\texports.toString = toString;\n\t// Sourced from lodash\n\t// https://github.com/bestiejs/lodash/blob/master/LICENSE.txt\n\t/* eslint-disable func-style */\n\tvar isFunction = function isFunction(value) {\n\t  return typeof value === 'function';\n\t};\n\t// fallback for older versions of Chrome and Safari\n\t/* istanbul ignore next */\n\tif (isFunction(/x/)) {\n\t  exports.isFunction = isFunction = function (value) {\n\t    return typeof value === 'function' && toString.call(value) === '[object Function]';\n\t  };\n\t}\n\texports.isFunction = isFunction;\n\n\t/* eslint-enable func-style */\n\n\t/* istanbul ignore next */\n\tvar isArray = Array.isArray || function (value) {\n\t  return value && typeof value === 'object' ? toString.call(value) === '[object Array]' : false;\n\t};\n\n\texports.isArray = isArray;\n\t// Older IE versions do not directly support indexOf so we must implement our own, sadly.\n\n\tfunction indexOf(array, value) {\n\t  for (var i = 0, len = array.length; i < len; i++) {\n\t    if (array[i] === value) {\n\t      return i;\n\t    }\n\t  }\n\t  return -1;\n\t}\n\n\tfunction escapeExpression(string) {\n\t  if (typeof string !== 'string') {\n\t    // don't escape SafeStrings, since they're already safe\n\t    if (string && string.toHTML) {\n\t      return string.toHTML();\n\t    } else if (string == null) {\n\t      return '';\n\t    } else if (!string) {\n\t      return string + '';\n\t    }\n\n\t    // Force a string conversion as this will be done by the append regardless and\n\t    // the regex test will do this transparently behind the scenes, causing issues if\n\t    // an object's to string has escaped characters in it.\n\t    string = '' + string;\n\t  }\n\n\t  if (!possible.test(string)) {\n\t    return string;\n\t  }\n\t  return string.replace(badChars, escapeChar);\n\t}\n\n\tfunction isEmpty(value) {\n\t  if (!value && value !== 0) {\n\t    return true;\n\t  } else if (isArray(value) && value.length === 0) {\n\t    return true;\n\t  } else {\n\t    return false;\n\t  }\n\t}\n\n\tfunction createFrame(object) {\n\t  var frame = extend({}, object);\n\t  frame._parent = object;\n\t  return frame;\n\t}\n\n\tfunction blockParams(params, ids) {\n\t  params.path = ids;\n\t  return params;\n\t}\n\n\tfunction appendContextPath(contextPath, id) {\n\t  return (contextPath ? contextPath + '.' : '') + id;\n\t}\n\n/***/ }),\n/* 5 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\n\tvar _Object$defineProperty = __webpack_require__(6)['default'];\n\n\texports.__esModule = true;\n\tvar errorProps = ['description', 'fileName', 'lineNumber', 'endLineNumber', 'message', 'name', 'number', 'stack'];\n\n\tfunction Exception(message, node) {\n\t  var loc = node && node.loc,\n\t      line = undefined,\n\t      endLineNumber = undefined,\n\t      column = undefined,\n\t      endColumn = undefined;\n\n\t  if (loc) {\n\t    line = loc.start.line;\n\t    endLineNumber = loc.end.line;\n\t    column = loc.start.column;\n\t    endColumn = loc.end.column;\n\n\t    message += ' - ' + line + ':' + column;\n\t  }\n\n\t  var tmp = Error.prototype.constructor.call(this, message);\n\n\t  // Unfortunately errors are not enumerable in Chrome (at least), so `for prop in tmp` doesn't work.\n\t  for (var idx = 0; idx < errorProps.length; idx++) {\n\t    this[errorProps[idx]] = tmp[errorProps[idx]];\n\t  }\n\n\t  /* istanbul ignore else */\n\t  if (Error.captureStackTrace) {\n\t    Error.captureStackTrace(this, Exception);\n\t  }\n\n\t  try {\n\t    if (loc) {\n\t      this.lineNumber = line;\n\t      this.endLineNumber = endLineNumber;\n\n\t      // Work around issue under safari where we can't directly set the column value\n\t      /* istanbul ignore next */\n\t      if (_Object$defineProperty) {\n\t        Object.defineProperty(this, 'column', {\n\t          value: column,\n\t          enumerable: true\n\t        });\n\t        Object.defineProperty(this, 'endColumn', {\n\t          value: endColumn,\n\t          enumerable: true\n\t        });\n\t      } else {\n\t        this.column = column;\n\t        this.endColumn = endColumn;\n\t      }\n\t    }\n\t  } catch (nop) {\n\t    /* Ignore if the browser is very particular */\n\t  }\n\t}\n\n\tException.prototype = new Error();\n\n\texports['default'] = Exception;\n\tmodule.exports = exports['default'];\n\n/***/ }),\n/* 6 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\tmodule.exports = { \"default\": __webpack_require__(7), __esModule: true };\n\n/***/ }),\n/* 7 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\tvar $ = __webpack_require__(8);\n\tmodule.exports = function defineProperty(it, key, desc){\n\t  return $.setDesc(it, key, desc);\n\t};\n\n/***/ }),\n/* 8 */\n/***/ (function(module, exports) {\n\n\tvar $Object = Object;\n\tmodule.exports = {\n\t  create:     $Object.create,\n\t  getProto:   $Object.getPrototypeOf,\n\t  isEnum:     {}.propertyIsEnumerable,\n\t  getDesc:    $Object.getOwnPropertyDescriptor,\n\t  setDesc:    $Object.defineProperty,\n\t  setDescs:   $Object.defineProperties,\n\t  getKeys:    $Object.keys,\n\t  getNames:   $Object.getOwnPropertyNames,\n\t  getSymbols: $Object.getOwnPropertySymbols,\n\t  each:       [].forEach\n\t};\n\n/***/ }),\n/* 9 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\n\tvar _interopRequireDefault = __webpack_require__(2)['default'];\n\n\texports.__esModule = true;\n\texports.registerDefaultHelpers = registerDefaultHelpers;\n\texports.moveHelperToHooks = moveHelperToHooks;\n\n\tvar _helpersBlockHelperMissing = __webpack_require__(10);\n\n\tvar _helpersBlockHelperMissing2 = _interopRequireDefault(_helpersBlockHelperMissing);\n\n\tvar _helpersEach = __webpack_require__(11);\n\n\tvar _helpersEach2 = _interopRequireDefault(_helpersEach);\n\n\tvar _helpersHelperMissing = __webpack_require__(64);\n\n\tvar _helpersHelperMissing2 = _interopRequireDefault(_helpersHelperMissing);\n\n\tvar _helpersIf = __webpack_require__(65);\n\n\tvar _helpersIf2 = _interopRequireDefault(_helpersIf);\n\n\tvar _helpersLog = __webpack_require__(66);\n\n\tvar _helpersLog2 = _interopRequireDefault(_helpersLog);\n\n\tvar _helpersLookup = __webpack_require__(67);\n\n\tvar _helpersLookup2 = _interopRequireDefault(_helpersLookup);\n\n\tvar _helpersWith = __webpack_require__(68);\n\n\tvar _helpersWith2 = _interopRequireDefault(_helpersWith);\n\n\tfunction registerDefaultHelpers(instance) {\n\t  _helpersBlockHelperMissing2['default'](instance);\n\t  _helpersEach2['default'](instance);\n\t  _helpersHelperMissing2['default'](instance);\n\t  _helpersIf2['default'](instance);\n\t  _helpersLog2['default'](instance);\n\t  _helpersLookup2['default'](instance);\n\t  _helpersWith2['default'](instance);\n\t}\n\n\tfunction moveHelperToHooks(instance, helperName, keepHelper) {\n\t  if (instance.helpers[helperName]) {\n\t    instance.hooks[helperName] = instance.helpers[helperName];\n\t    if (!keepHelper) {\n\t      delete instance.helpers[helperName];\n\t    }\n\t  }\n\t}\n\n/***/ }),\n/* 10 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\n\texports.__esModule = true;\n\n\tvar _utils = __webpack_require__(4);\n\n\texports['default'] = function (instance) {\n\t  instance.registerHelper('blockHelperMissing', function (context, options) {\n\t    var inverse = options.inverse,\n\t        fn = options.fn;\n\n\t    if (context === true) {\n\t      return fn(this);\n\t    } else if (context === false || context == null) {\n\t      return inverse(this);\n\t    } else if (_utils.isArray(context)) {\n\t      if (context.length > 0) {\n\t        if (options.ids) {\n\t          options.ids = [options.name];\n\t        }\n\n\t        return instance.helpers.each(context, options);\n\t      } else {\n\t        return inverse(this);\n\t      }\n\t    } else {\n\t      if (options.data && options.ids) {\n\t        var data = _utils.createFrame(options.data);\n\t        data.contextPath = _utils.appendContextPath(options.data.contextPath, options.name);\n\t        options = { data: data };\n\t      }\n\n\t      return fn(context, options);\n\t    }\n\t  });\n\t};\n\n\tmodule.exports = exports['default'];\n\n/***/ }),\n/* 11 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\n\tvar _Symbol = __webpack_require__(12)['default'];\n\n\tvar _Symbol$iterator = __webpack_require__(42)['default'];\n\n\tvar _getIterator = __webpack_require__(54)['default'];\n\n\tvar _Object$keys = __webpack_require__(59)['default'];\n\n\tvar _interopRequireDefault = __webpack_require__(2)['default'];\n\n\texports.__esModule = true;\n\n\tvar _utils = __webpack_require__(4);\n\n\tvar _exception = __webpack_require__(5);\n\n\tvar _exception2 = _interopRequireDefault(_exception);\n\n\texports['default'] = function (instance) {\n\t  instance.registerHelper('each', function (context, options) {\n\t    if (!options) {\n\t      throw new _exception2['default']('Must pass iterator to #each');\n\t    }\n\n\t    var fn = options.fn,\n\t        inverse = options.inverse,\n\t        i = 0,\n\t        ret = '',\n\t        data = undefined,\n\t        contextPath = undefined;\n\n\t    if (options.data && options.ids) {\n\t      contextPath = _utils.appendContextPath(options.data.contextPath, options.ids[0]) + '.';\n\t    }\n\n\t    if (_utils.isFunction(context)) {\n\t      context = context.call(this);\n\t    }\n\n\t    if (options.data) {\n\t      data = _utils.createFrame(options.data);\n\t    }\n\n\t    function execIteration(field, index, last) {\n\t      if (data) {\n\t        data.key = field;\n\t        data.index = index;\n\t        data.first = index === 0;\n\t        data.last = !!last;\n\n\t        if (contextPath) {\n\t          data.contextPath = contextPath + field;\n\t        }\n\t      }\n\n\t      ret = ret + fn(context[field], {\n\t        data: data,\n\t        blockParams: _utils.blockParams([context[field], field], [contextPath + field, null])\n\t      });\n\t    }\n\n\t    if (context && typeof context === 'object') {\n\t      if (_utils.isArray(context)) {\n\t        for (var j = context.length; i < j; i++) {\n\t          if (i in context) {\n\t            execIteration(i, i, i === context.length - 1);\n\t          }\n\t        }\n\t      } else if (typeof _Symbol === 'function' && context[_Symbol$iterator]) {\n\t        var newContext = [];\n\t        var iterator = _getIterator(context);\n\t        for (var it = iterator.next(); !it.done; it = iterator.next()) {\n\t          newContext.push(it.value);\n\t        }\n\t        context = newContext;\n\t        for (var j = context.length; i < j; i++) {\n\t          execIteration(i, i, i === context.length - 1);\n\t        }\n\t      } else {\n\t        (function () {\n\t          var priorKey = undefined;\n\n\t          _Object$keys(context).forEach(function (key) {\n\t            // We're running the iterations one step out of sync so we can detect\n\t            // the last iteration without have to scan the object twice and create\n\t            // an itermediate keys array.\n\t            if (priorKey !== undefined) {\n\t              execIteration(priorKey, i - 1);\n\t            }\n\t            priorKey = key;\n\t            i++;\n\t          });\n\t          if (priorKey !== undefined) {\n\t            execIteration(priorKey, i - 1, true);\n\t          }\n\t        })();\n\t      }\n\t    }\n\n\t    if (i === 0) {\n\t      ret = inverse(this);\n\t    }\n\n\t    return ret;\n\t  });\n\t};\n\n\tmodule.exports = exports['default'];\n\n/***/ }),\n/* 12 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\tmodule.exports = { \"default\": __webpack_require__(13), __esModule: true };\n\n/***/ }),\n/* 13 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\t__webpack_require__(14);\n\t__webpack_require__(41);\n\tmodule.exports = __webpack_require__(20).Symbol;\n\n/***/ }),\n/* 14 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t// ECMAScript 6 symbols shim\n\tvar $              = __webpack_require__(8)\n\t  , global         = __webpack_require__(15)\n\t  , has            = __webpack_require__(16)\n\t  , DESCRIPTORS    = __webpack_require__(17)\n\t  , $export        = __webpack_require__(19)\n\t  , redefine       = __webpack_require__(23)\n\t  , $fails         = __webpack_require__(18)\n\t  , shared         = __webpack_require__(26)\n\t  , setToStringTag = __webpack_require__(27)\n\t  , uid            = __webpack_require__(29)\n\t  , wks            = __webpack_require__(28)\n\t  , keyOf          = __webpack_require__(30)\n\t  , $names         = __webpack_require__(35)\n\t  , enumKeys       = __webpack_require__(36)\n\t  , isArray        = __webpack_require__(37)\n\t  , anObject       = __webpack_require__(38)\n\t  , toIObject      = __webpack_require__(31)\n\t  , createDesc     = __webpack_require__(25)\n\t  , getDesc        = $.getDesc\n\t  , setDesc        = $.setDesc\n\t  , _create        = $.create\n\t  , getNames       = $names.get\n\t  , $Symbol        = global.Symbol\n\t  , $JSON          = global.JSON\n\t  , _stringify     = $JSON && $JSON.stringify\n\t  , setter         = false\n\t  , HIDDEN         = wks('_hidden')\n\t  , isEnum         = $.isEnum\n\t  , SymbolRegistry = shared('symbol-registry')\n\t  , AllSymbols     = shared('symbols')\n\t  , useNative      = typeof $Symbol == 'function'\n\t  , ObjectProto    = Object.prototype;\n\n\t// fallback for old Android, https://code.google.com/p/v8/issues/detail?id=687\n\tvar setSymbolDesc = DESCRIPTORS && $fails(function(){\n\t  return _create(setDesc({}, 'a', {\n\t    get: function(){ return setDesc(this, 'a', {value: 7}).a; }\n\t  })).a != 7;\n\t}) ? function(it, key, D){\n\t  var protoDesc = getDesc(ObjectProto, key);\n\t  if(protoDesc)delete ObjectProto[key];\n\t  setDesc(it, key, D);\n\t  if(protoDesc && it !== ObjectProto)setDesc(ObjectProto, key, protoDesc);\n\t} : setDesc;\n\n\tvar wrap = function(tag){\n\t  var sym = AllSymbols[tag] = _create($Symbol.prototype);\n\t  sym._k = tag;\n\t  DESCRIPTORS && setter && setSymbolDesc(ObjectProto, tag, {\n\t    configurable: true,\n\t    set: function(value){\n\t      if(has(this, HIDDEN) && has(this[HIDDEN], tag))this[HIDDEN][tag] = false;\n\t      setSymbolDesc(this, tag, createDesc(1, value));\n\t    }\n\t  });\n\t  return sym;\n\t};\n\n\tvar isSymbol = function(it){\n\t  return typeof it == 'symbol';\n\t};\n\n\tvar $defineProperty = function defineProperty(it, key, D){\n\t  if(D && has(AllSymbols, key)){\n\t    if(!D.enumerable){\n\t      if(!has(it, HIDDEN))setDesc(it, HIDDEN, createDesc(1, {}));\n\t      it[HIDDEN][key] = true;\n\t    } else {\n\t      if(has(it, HIDDEN) && it[HIDDEN][key])it[HIDDEN][key] = false;\n\t      D = _create(D, {enumerable: createDesc(0, false)});\n\t    } return setSymbolDesc(it, key, D);\n\t  } return setDesc(it, key, D);\n\t};\n\tvar $defineProperties = function defineProperties(it, P){\n\t  anObject(it);\n\t  var keys = enumKeys(P = toIObject(P))\n\t    , i    = 0\n\t    , l = keys.length\n\t    , key;\n\t  while(l > i)$defineProperty(it, key = keys[i++], P[key]);\n\t  return it;\n\t};\n\tvar $create = function create(it, P){\n\t  return P === undefined ? _create(it) : $defineProperties(_create(it), P);\n\t};\n\tvar $propertyIsEnumerable = function propertyIsEnumerable(key){\n\t  var E = isEnum.call(this, key);\n\t  return E || !has(this, key) || !has(AllSymbols, key) || has(this, HIDDEN) && this[HIDDEN][key]\n\t    ? E : true;\n\t};\n\tvar $getOwnPropertyDescriptor = function getOwnPropertyDescriptor(it, key){\n\t  var D = getDesc(it = toIObject(it), key);\n\t  if(D && has(AllSymbols, key) && !(has(it, HIDDEN) && it[HIDDEN][key]))D.enumerable = true;\n\t  return D;\n\t};\n\tvar $getOwnPropertyNames = function getOwnPropertyNames(it){\n\t  var names  = getNames(toIObject(it))\n\t    , result = []\n\t    , i      = 0\n\t    , key;\n\t  while(names.length > i)if(!has(AllSymbols, key = names[i++]) && key != HIDDEN)result.push(key);\n\t  return result;\n\t};\n\tvar $getOwnPropertySymbols = function getOwnPropertySymbols(it){\n\t  var names  = getNames(toIObject(it))\n\t    , result = []\n\t    , i      = 0\n\t    , key;\n\t  while(names.length > i)if(has(AllSymbols, key = names[i++]))result.push(AllSymbols[key]);\n\t  return result;\n\t};\n\tvar $stringify = function stringify(it){\n\t  if(it === undefined || isSymbol(it))return; // IE8 returns string on undefined\n\t  var args = [it]\n\t    , i    = 1\n\t    , $$   = arguments\n\t    , replacer, $replacer;\n\t  while($$.length > i)args.push($$[i++]);\n\t  replacer = args[1];\n\t  if(typeof replacer == 'function')$replacer = replacer;\n\t  if($replacer || !isArray(replacer))replacer = function(key, value){\n\t    if($replacer)value = $replacer.call(this, key, value);\n\t    if(!isSymbol(value))return value;\n\t  };\n\t  args[1] = replacer;\n\t  return _stringify.apply($JSON, args);\n\t};\n\tvar buggyJSON = $fails(function(){\n\t  var S = $Symbol();\n\t  // MS Edge converts symbol values to JSON as {}\n\t  // WebKit converts symbol values to JSON as null\n\t  // V8 throws on boxed symbols\n\t  return _stringify([S]) != '[null]' || _stringify({a: S}) != '{}' || _stringify(Object(S)) != '{}';\n\t});\n\n\t// 19.4.1.1 Symbol([description])\n\tif(!useNative){\n\t  $Symbol = function Symbol(){\n\t    if(isSymbol(this))throw TypeError('Symbol is not a constructor');\n\t    return wrap(uid(arguments.length > 0 ? arguments[0] : undefined));\n\t  };\n\t  redefine($Symbol.prototype, 'toString', function toString(){\n\t    return this._k;\n\t  });\n\n\t  isSymbol = function(it){\n\t    return it instanceof $Symbol;\n\t  };\n\n\t  $.create     = $create;\n\t  $.isEnum     = $propertyIsEnumerable;\n\t  $.getDesc    = $getOwnPropertyDescriptor;\n\t  $.setDesc    = $defineProperty;\n\t  $.setDescs   = $defineProperties;\n\t  $.getNames   = $names.get = $getOwnPropertyNames;\n\t  $.getSymbols = $getOwnPropertySymbols;\n\n\t  if(DESCRIPTORS && !__webpack_require__(40)){\n\t    redefine(ObjectProto, 'propertyIsEnumerable', $propertyIsEnumerable, true);\n\t  }\n\t}\n\n\tvar symbolStatics = {\n\t  // 19.4.2.1 Symbol.for(key)\n\t  'for': function(key){\n\t    return has(SymbolRegistry, key += '')\n\t      ? SymbolRegistry[key]\n\t      : SymbolRegistry[key] = $Symbol(key);\n\t  },\n\t  // 19.4.2.5 Symbol.keyFor(sym)\n\t  keyFor: function keyFor(key){\n\t    return keyOf(SymbolRegistry, key);\n\t  },\n\t  useSetter: function(){ setter = true; },\n\t  useSimple: function(){ setter = false; }\n\t};\n\t// 19.4.2.2 Symbol.hasInstance\n\t// 19.4.2.3 Symbol.isConcatSpreadable\n\t// 19.4.2.4 Symbol.iterator\n\t// 19.4.2.6 Symbol.match\n\t// 19.4.2.8 Symbol.replace\n\t// 19.4.2.9 Symbol.search\n\t// 19.4.2.10 Symbol.species\n\t// 19.4.2.11 Symbol.split\n\t// 19.4.2.12 Symbol.toPrimitive\n\t// 19.4.2.13 Symbol.toStringTag\n\t// 19.4.2.14 Symbol.unscopables\n\t$.each.call((\n\t  'hasInstance,isConcatSpreadable,iterator,match,replace,search,' +\n\t  'species,split,toPrimitive,toStringTag,unscopables'\n\t).split(','), function(it){\n\t  var sym = wks(it);\n\t  symbolStatics[it] = useNative ? sym : wrap(sym);\n\t});\n\n\tsetter = true;\n\n\t$export($export.G + $export.W, {Symbol: $Symbol});\n\n\t$export($export.S, 'Symbol', symbolStatics);\n\n\t$export($export.S + $export.F * !useNative, 'Object', {\n\t  // 19.1.2.2 Object.create(O [, Properties])\n\t  create: $create,\n\t  // 19.1.2.4 Object.defineProperty(O, P, Attributes)\n\t  defineProperty: $defineProperty,\n\t  // 19.1.2.3 Object.defineProperties(O, Properties)\n\t  defineProperties: $defineProperties,\n\t  // 19.1.2.6 Object.getOwnPropertyDescriptor(O, P)\n\t  getOwnPropertyDescriptor: $getOwnPropertyDescriptor,\n\t  // 19.1.2.7 Object.getOwnPropertyNames(O)\n\t  getOwnPropertyNames: $getOwnPropertyNames,\n\t  // 19.1.2.8 Object.getOwnPropertySymbols(O)\n\t  getOwnPropertySymbols: $getOwnPropertySymbols\n\t});\n\n\t// 24.3.2 JSON.stringify(value [, replacer [, space]])\n\t$JSON && $export($export.S + $export.F * (!useNative || buggyJSON), 'JSON', {stringify: $stringify});\n\n\t// 19.4.3.5 Symbol.prototype[@@toStringTag]\n\tsetToStringTag($Symbol, 'Symbol');\n\t// 20.2.1.9 Math[@@toStringTag]\n\tsetToStringTag(Math, 'Math', true);\n\t// 24.3.3 JSON[@@toStringTag]\n\tsetToStringTag(global.JSON, 'JSON', true);\n\n/***/ }),\n/* 15 */\n/***/ (function(module, exports) {\n\n\t// https://github.com/zloirock/core-js/issues/86#issuecomment-115759028\n\tvar global = module.exports = typeof window != 'undefined' && window.Math == Math\n\t  ? window : typeof self != 'undefined' && self.Math == Math ? self : Function('return this')();\n\tif(typeof __g == 'number')__g = global; // eslint-disable-line no-undef\n\n/***/ }),\n/* 16 */\n/***/ (function(module, exports) {\n\n\tvar hasOwnProperty = {}.hasOwnProperty;\n\tmodule.exports = function(it, key){\n\t  return hasOwnProperty.call(it, key);\n\t};\n\n/***/ }),\n/* 17 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\t// Thank's IE8 for his funny defineProperty\n\tmodule.exports = !__webpack_require__(18)(function(){\n\t  return Object.defineProperty({}, 'a', {get: function(){ return 7; }}).a != 7;\n\t});\n\n/***/ }),\n/* 18 */\n/***/ (function(module, exports) {\n\n\tmodule.exports = function(exec){\n\t  try {\n\t    return !!exec();\n\t  } catch(e){\n\t    return true;\n\t  }\n\t};\n\n/***/ }),\n/* 19 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\tvar global    = __webpack_require__(15)\n\t  , core      = __webpack_require__(20)\n\t  , ctx       = __webpack_require__(21)\n\t  , PROTOTYPE = 'prototype';\n\n\tvar $export = function(type, name, source){\n\t  var IS_FORCED = type & $export.F\n\t    , IS_GLOBAL = type & $export.G\n\t    , IS_STATIC = type & $export.S\n\t    , IS_PROTO  = type & $export.P\n\t    , IS_BIND   = type & $export.B\n\t    , IS_WRAP   = type & $export.W\n\t    , exports   = IS_GLOBAL ? core : core[name] || (core[name] = {})\n\t    , target    = IS_GLOBAL ? global : IS_STATIC ? global[name] : (global[name] || {})[PROTOTYPE]\n\t    , key, own, out;\n\t  if(IS_GLOBAL)source = name;\n\t  for(key in source){\n\t    // contains in native\n\t    own = !IS_FORCED && target && key in target;\n\t    if(own && key in exports)continue;\n\t    // export native or passed\n\t    out = own ? target[key] : source[key];\n\t    // prevent global pollution for namespaces\n\t    exports[key] = IS_GLOBAL && typeof target[key] != 'function' ? source[key]\n\t    // bind timers to global for call from export context\n\t    : IS_BIND && own ? ctx(out, global)\n\t    // wrap global constructors for prevent change them in library\n\t    : IS_WRAP && target[key] == out ? (function(C){\n\t      var F = function(param){\n\t        return this instanceof C ? new C(param) : C(param);\n\t      };\n\t      F[PROTOTYPE] = C[PROTOTYPE];\n\t      return F;\n\t    // make static versions for prototype methods\n\t    })(out) : IS_PROTO && typeof out == 'function' ? ctx(Function.call, out) : out;\n\t    if(IS_PROTO)(exports[PROTOTYPE] || (exports[PROTOTYPE] = {}))[key] = out;\n\t  }\n\t};\n\t// type bitmap\n\t$export.F = 1;  // forced\n\t$export.G = 2;  // global\n\t$export.S = 4;  // static\n\t$export.P = 8;  // proto\n\t$export.B = 16; // bind\n\t$export.W = 32; // wrap\n\tmodule.exports = $export;\n\n/***/ }),\n/* 20 */\n/***/ (function(module, exports) {\n\n\tvar core = module.exports = {version: '1.2.6'};\n\tif(typeof __e == 'number')__e = core; // eslint-disable-line no-undef\n\n/***/ }),\n/* 21 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\t// optional / simple context binding\n\tvar aFunction = __webpack_require__(22);\n\tmodule.exports = function(fn, that, length){\n\t  aFunction(fn);\n\t  if(that === undefined)return fn;\n\t  switch(length){\n\t    case 1: return function(a){\n\t      return fn.call(that, a);\n\t    };\n\t    case 2: return function(a, b){\n\t      return fn.call(that, a, b);\n\t    };\n\t    case 3: return function(a, b, c){\n\t      return fn.call(that, a, b, c);\n\t    };\n\t  }\n\t  return function(/* ...args */){\n\t    return fn.apply(that, arguments);\n\t  };\n\t};\n\n/***/ }),\n/* 22 */\n/***/ (function(module, exports) {\n\n\tmodule.exports = function(it){\n\t  if(typeof it != 'function')throw TypeError(it + ' is not a function!');\n\t  return it;\n\t};\n\n/***/ }),\n/* 23 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\tmodule.exports = __webpack_require__(24);\n\n/***/ }),\n/* 24 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\tvar $          = __webpack_require__(8)\n\t  , createDesc = __webpack_require__(25);\n\tmodule.exports = __webpack_require__(17) ? function(object, key, value){\n\t  return $.setDesc(object, key, createDesc(1, value));\n\t} : function(object, key, value){\n\t  object[key] = value;\n\t  return object;\n\t};\n\n/***/ }),\n/* 25 */\n/***/ (function(module, exports) {\n\n\tmodule.exports = function(bitmap, value){\n\t  return {\n\t    enumerable  : !(bitmap & 1),\n\t    configurable: !(bitmap & 2),\n\t    writable    : !(bitmap & 4),\n\t    value       : value\n\t  };\n\t};\n\n/***/ }),\n/* 26 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\tvar global = __webpack_require__(15)\n\t  , SHARED = '__core-js_shared__'\n\t  , store  = global[SHARED] || (global[SHARED] = {});\n\tmodule.exports = function(key){\n\t  return store[key] || (store[key] = {});\n\t};\n\n/***/ }),\n/* 27 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\tvar def = __webpack_require__(8).setDesc\n\t  , has = __webpack_require__(16)\n\t  , TAG = __webpack_require__(28)('toStringTag');\n\n\tmodule.exports = function(it, tag, stat){\n\t  if(it && !has(it = stat ? it : it.prototype, TAG))def(it, TAG, {configurable: true, value: tag});\n\t};\n\n/***/ }),\n/* 28 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\tvar store  = __webpack_require__(26)('wks')\n\t  , uid    = __webpack_require__(29)\n\t  , Symbol = __webpack_require__(15).Symbol;\n\tmodule.exports = function(name){\n\t  return store[name] || (store[name] =\n\t    Symbol && Symbol[name] || (Symbol || uid)('Symbol.' + name));\n\t};\n\n/***/ }),\n/* 29 */\n/***/ (function(module, exports) {\n\n\tvar id = 0\n\t  , px = Math.random();\n\tmodule.exports = function(key){\n\t  return 'Symbol('.concat(key === undefined ? '' : key, ')_', (++id + px).toString(36));\n\t};\n\n/***/ }),\n/* 30 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\tvar $         = __webpack_require__(8)\n\t  , toIObject = __webpack_require__(31);\n\tmodule.exports = function(object, el){\n\t  var O      = toIObject(object)\n\t    , keys   = $.getKeys(O)\n\t    , length = keys.length\n\t    , index  = 0\n\t    , key;\n\t  while(length > index)if(O[key = keys[index++]] === el)return key;\n\t};\n\n/***/ }),\n/* 31 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\t// to indexed object, toObject with fallback for non-array-like ES3 strings\n\tvar IObject = __webpack_require__(32)\n\t  , defined = __webpack_require__(34);\n\tmodule.exports = function(it){\n\t  return IObject(defined(it));\n\t};\n\n/***/ }),\n/* 32 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\t// fallback for non-array-like ES3 and non-enumerable old V8 strings\n\tvar cof = __webpack_require__(33);\n\tmodule.exports = Object('z').propertyIsEnumerable(0) ? Object : function(it){\n\t  return cof(it) == 'String' ? it.split('') : Object(it);\n\t};\n\n/***/ }),\n/* 33 */\n/***/ (function(module, exports) {\n\n\tvar toString = {}.toString;\n\n\tmodule.exports = function(it){\n\t  return toString.call(it).slice(8, -1);\n\t};\n\n/***/ }),\n/* 34 */\n/***/ (function(module, exports) {\n\n\t// 7.2.1 RequireObjectCoercible(argument)\n\tmodule.exports = function(it){\n\t  if(it == undefined)throw TypeError(\"Can't call method on  \" + it);\n\t  return it;\n\t};\n\n/***/ }),\n/* 35 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\t// fallback for IE11 buggy Object.getOwnPropertyNames with iframe and window\n\tvar toIObject = __webpack_require__(31)\n\t  , getNames  = __webpack_require__(8).getNames\n\t  , toString  = {}.toString;\n\n\tvar windowNames = typeof window == 'object' && Object.getOwnPropertyNames\n\t  ? Object.getOwnPropertyNames(window) : [];\n\n\tvar getWindowNames = function(it){\n\t  try {\n\t    return getNames(it);\n\t  } catch(e){\n\t    return windowNames.slice();\n\t  }\n\t};\n\n\tmodule.exports.get = function getOwnPropertyNames(it){\n\t  if(windowNames && toString.call(it) == '[object Window]')return getWindowNames(it);\n\t  return getNames(toIObject(it));\n\t};\n\n/***/ }),\n/* 36 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\t// all enumerable object keys, includes symbols\n\tvar $ = __webpack_require__(8);\n\tmodule.exports = function(it){\n\t  var keys       = $.getKeys(it)\n\t    , getSymbols = $.getSymbols;\n\t  if(getSymbols){\n\t    var symbols = getSymbols(it)\n\t      , isEnum  = $.isEnum\n\t      , i       = 0\n\t      , key;\n\t    while(symbols.length > i)if(isEnum.call(it, key = symbols[i++]))keys.push(key);\n\t  }\n\t  return keys;\n\t};\n\n/***/ }),\n/* 37 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\t// 7.2.2 IsArray(argument)\n\tvar cof = __webpack_require__(33);\n\tmodule.exports = Array.isArray || function(arg){\n\t  return cof(arg) == 'Array';\n\t};\n\n/***/ }),\n/* 38 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\tvar isObject = __webpack_require__(39);\n\tmodule.exports = function(it){\n\t  if(!isObject(it))throw TypeError(it + ' is not an object!');\n\t  return it;\n\t};\n\n/***/ }),\n/* 39 */\n/***/ (function(module, exports) {\n\n\tmodule.exports = function(it){\n\t  return typeof it === 'object' ? it !== null : typeof it === 'function';\n\t};\n\n/***/ }),\n/* 40 */\n/***/ (function(module, exports) {\n\n\tmodule.exports = true;\n\n/***/ }),\n/* 41 */\n/***/ (function(module, exports) {\n\n\t\n\n/***/ }),\n/* 42 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\tmodule.exports = { \"default\": __webpack_require__(43), __esModule: true };\n\n/***/ }),\n/* 43 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\t__webpack_require__(44);\n\t__webpack_require__(50);\n\tmodule.exports = __webpack_require__(28)('iterator');\n\n/***/ }),\n/* 44 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\tvar $at  = __webpack_require__(45)(true);\n\n\t// 21.1.3.27 String.prototype[@@iterator]()\n\t__webpack_require__(47)(String, 'String', function(iterated){\n\t  this._t = String(iterated); // target\n\t  this._i = 0;                // next index\n\t// 21.1.5.2.1 %StringIteratorPrototype%.next()\n\t}, function(){\n\t  var O     = this._t\n\t    , index = this._i\n\t    , point;\n\t  if(index >= O.length)return {value: undefined, done: true};\n\t  point = $at(O, index);\n\t  this._i += point.length;\n\t  return {value: point, done: false};\n\t});\n\n/***/ }),\n/* 45 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\tvar toInteger = __webpack_require__(46)\n\t  , defined   = __webpack_require__(34);\n\t// true  -> String#at\n\t// false -> String#codePointAt\n\tmodule.exports = function(TO_STRING){\n\t  return function(that, pos){\n\t    var s = String(defined(that))\n\t      , i = toInteger(pos)\n\t      , l = s.length\n\t      , a, b;\n\t    if(i < 0 || i >= l)return TO_STRING ? '' : undefined;\n\t    a = s.charCodeAt(i);\n\t    return a < 0xd800 || a > 0xdbff || i + 1 === l || (b = s.charCodeAt(i + 1)) < 0xdc00 || b > 0xdfff\n\t      ? TO_STRING ? s.charAt(i) : a\n\t      : TO_STRING ? s.slice(i, i + 2) : (a - 0xd800 << 10) + (b - 0xdc00) + 0x10000;\n\t  };\n\t};\n\n/***/ }),\n/* 46 */\n/***/ (function(module, exports) {\n\n\t// 7.1.4 ToInteger\n\tvar ceil  = Math.ceil\n\t  , floor = Math.floor;\n\tmodule.exports = function(it){\n\t  return isNaN(it = +it) ? 0 : (it > 0 ? floor : ceil)(it);\n\t};\n\n/***/ }),\n/* 47 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\tvar LIBRARY        = __webpack_require__(40)\n\t  , $export        = __webpack_require__(19)\n\t  , redefine       = __webpack_require__(23)\n\t  , hide           = __webpack_require__(24)\n\t  , has            = __webpack_require__(16)\n\t  , Iterators      = __webpack_require__(48)\n\t  , $iterCreate    = __webpack_require__(49)\n\t  , setToStringTag = __webpack_require__(27)\n\t  , getProto       = __webpack_require__(8).getProto\n\t  , ITERATOR       = __webpack_require__(28)('iterator')\n\t  , BUGGY          = !([].keys && 'next' in [].keys()) // Safari has buggy iterators w/o `next`\n\t  , FF_ITERATOR    = '@@iterator'\n\t  , KEYS           = 'keys'\n\t  , VALUES         = 'values';\n\n\tvar returnThis = function(){ return this; };\n\n\tmodule.exports = function(Base, NAME, Constructor, next, DEFAULT, IS_SET, FORCED){\n\t  $iterCreate(Constructor, NAME, next);\n\t  var getMethod = function(kind){\n\t    if(!BUGGY && kind in proto)return proto[kind];\n\t    switch(kind){\n\t      case KEYS: return function keys(){ return new Constructor(this, kind); };\n\t      case VALUES: return function values(){ return new Constructor(this, kind); };\n\t    } return function entries(){ return new Constructor(this, kind); };\n\t  };\n\t  var TAG        = NAME + ' Iterator'\n\t    , DEF_VALUES = DEFAULT == VALUES\n\t    , VALUES_BUG = false\n\t    , proto      = Base.prototype\n\t    , $native    = proto[ITERATOR] || proto[FF_ITERATOR] || DEFAULT && proto[DEFAULT]\n\t    , $default   = $native || getMethod(DEFAULT)\n\t    , methods, key;\n\t  // Fix native\n\t  if($native){\n\t    var IteratorPrototype = getProto($default.call(new Base));\n\t    // Set @@toStringTag to native iterators\n\t    setToStringTag(IteratorPrototype, TAG, true);\n\t    // FF fix\n\t    if(!LIBRARY && has(proto, FF_ITERATOR))hide(IteratorPrototype, ITERATOR, returnThis);\n\t    // fix Array#{values, @@iterator}.name in V8 / FF\n\t    if(DEF_VALUES && $native.name !== VALUES){\n\t      VALUES_BUG = true;\n\t      $default = function values(){ return $native.call(this); };\n\t    }\n\t  }\n\t  // Define iterator\n\t  if((!LIBRARY || FORCED) && (BUGGY || VALUES_BUG || !proto[ITERATOR])){\n\t    hide(proto, ITERATOR, $default);\n\t  }\n\t  // Plug for library\n\t  Iterators[NAME] = $default;\n\t  Iterators[TAG]  = returnThis;\n\t  if(DEFAULT){\n\t    methods = {\n\t      values:  DEF_VALUES  ? $default : getMethod(VALUES),\n\t      keys:    IS_SET      ? $default : getMethod(KEYS),\n\t      entries: !DEF_VALUES ? $default : getMethod('entries')\n\t    };\n\t    if(FORCED)for(key in methods){\n\t      if(!(key in proto))redefine(proto, key, methods[key]);\n\t    } else $export($export.P + $export.F * (BUGGY || VALUES_BUG), NAME, methods);\n\t  }\n\t  return methods;\n\t};\n\n/***/ }),\n/* 48 */\n/***/ (function(module, exports) {\n\n\tmodule.exports = {};\n\n/***/ }),\n/* 49 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\tvar $              = __webpack_require__(8)\n\t  , descriptor     = __webpack_require__(25)\n\t  , setToStringTag = __webpack_require__(27)\n\t  , IteratorPrototype = {};\n\n\t// 25.1.2.1.1 %IteratorPrototype%[@@iterator]()\n\t__webpack_require__(24)(IteratorPrototype, __webpack_require__(28)('iterator'), function(){ return this; });\n\n\tmodule.exports = function(Constructor, NAME, next){\n\t  Constructor.prototype = $.create(IteratorPrototype, {next: descriptor(1, next)});\n\t  setToStringTag(Constructor, NAME + ' Iterator');\n\t};\n\n/***/ }),\n/* 50 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\t__webpack_require__(51);\n\tvar Iterators = __webpack_require__(48);\n\tIterators.NodeList = Iterators.HTMLCollection = Iterators.Array;\n\n/***/ }),\n/* 51 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\tvar addToUnscopables = __webpack_require__(52)\n\t  , step             = __webpack_require__(53)\n\t  , Iterators        = __webpack_require__(48)\n\t  , toIObject        = __webpack_require__(31);\n\n\t// 22.1.3.4 Array.prototype.entries()\n\t// 22.1.3.13 Array.prototype.keys()\n\t// 22.1.3.29 Array.prototype.values()\n\t// 22.1.3.30 Array.prototype[@@iterator]()\n\tmodule.exports = __webpack_require__(47)(Array, 'Array', function(iterated, kind){\n\t  this._t = toIObject(iterated); // target\n\t  this._i = 0;                   // next index\n\t  this._k = kind;                // kind\n\t// 22.1.5.2.1 %ArrayIteratorPrototype%.next()\n\t}, function(){\n\t  var O     = this._t\n\t    , kind  = this._k\n\t    , index = this._i++;\n\t  if(!O || index >= O.length){\n\t    this._t = undefined;\n\t    return step(1);\n\t  }\n\t  if(kind == 'keys'  )return step(0, index);\n\t  if(kind == 'values')return step(0, O[index]);\n\t  return step(0, [index, O[index]]);\n\t}, 'values');\n\n\t// argumentsList[@@iterator] is %ArrayProto_values% (9.4.4.6, 9.4.4.7)\n\tIterators.Arguments = Iterators.Array;\n\n\taddToUnscopables('keys');\n\taddToUnscopables('values');\n\taddToUnscopables('entries');\n\n/***/ }),\n/* 52 */\n/***/ (function(module, exports) {\n\n\tmodule.exports = function(){ /* empty */ };\n\n/***/ }),\n/* 53 */\n/***/ (function(module, exports) {\n\n\tmodule.exports = function(done, value){\n\t  return {value: value, done: !!done};\n\t};\n\n/***/ }),\n/* 54 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\tmodule.exports = { \"default\": __webpack_require__(55), __esModule: true };\n\n/***/ }),\n/* 55 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\t__webpack_require__(50);\n\t__webpack_require__(44);\n\tmodule.exports = __webpack_require__(56);\n\n/***/ }),\n/* 56 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\tvar anObject = __webpack_require__(38)\n\t  , get      = __webpack_require__(57);\n\tmodule.exports = __webpack_require__(20).getIterator = function(it){\n\t  var iterFn = get(it);\n\t  if(typeof iterFn != 'function')throw TypeError(it + ' is not iterable!');\n\t  return anObject(iterFn.call(it));\n\t};\n\n/***/ }),\n/* 57 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\tvar classof   = __webpack_require__(58)\n\t  , ITERATOR  = __webpack_require__(28)('iterator')\n\t  , Iterators = __webpack_require__(48);\n\tmodule.exports = __webpack_require__(20).getIteratorMethod = function(it){\n\t  if(it != undefined)return it[ITERATOR]\n\t    || it['@@iterator']\n\t    || Iterators[classof(it)];\n\t};\n\n/***/ }),\n/* 58 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\t// getting tag from 19.1.3.6 Object.prototype.toString()\n\tvar cof = __webpack_require__(33)\n\t  , TAG = __webpack_require__(28)('toStringTag')\n\t  // ES3 wrong here\n\t  , ARG = cof(function(){ return arguments; }()) == 'Arguments';\n\n\tmodule.exports = function(it){\n\t  var O, T, B;\n\t  return it === undefined ? 'Undefined' : it === null ? 'Null'\n\t    // @@toStringTag case\n\t    : typeof (T = (O = Object(it))[TAG]) == 'string' ? T\n\t    // builtinTag case\n\t    : ARG ? cof(O)\n\t    // ES3 arguments fallback\n\t    : (B = cof(O)) == 'Object' && typeof O.callee == 'function' ? 'Arguments' : B;\n\t};\n\n/***/ }),\n/* 59 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\tmodule.exports = { \"default\": __webpack_require__(60), __esModule: true };\n\n/***/ }),\n/* 60 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\t__webpack_require__(61);\n\tmodule.exports = __webpack_require__(20).Object.keys;\n\n/***/ }),\n/* 61 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\t// 19.1.2.14 Object.keys(O)\n\tvar toObject = __webpack_require__(62);\n\n\t__webpack_require__(63)('keys', function($keys){\n\t  return function keys(it){\n\t    return $keys(toObject(it));\n\t  };\n\t});\n\n/***/ }),\n/* 62 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\t// 7.1.13 ToObject(argument)\n\tvar defined = __webpack_require__(34);\n\tmodule.exports = function(it){\n\t  return Object(defined(it));\n\t};\n\n/***/ }),\n/* 63 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\t// most Object methods by ES6 should accept primitives\n\tvar $export = __webpack_require__(19)\n\t  , core    = __webpack_require__(20)\n\t  , fails   = __webpack_require__(18);\n\tmodule.exports = function(KEY, exec){\n\t  var fn  = (core.Object || {})[KEY] || Object[KEY]\n\t    , exp = {};\n\t  exp[KEY] = exec(fn);\n\t  $export($export.S + $export.F * fails(function(){ fn(1); }), 'Object', exp);\n\t};\n\n/***/ }),\n/* 64 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\n\tvar _interopRequireDefault = __webpack_require__(2)['default'];\n\n\texports.__esModule = true;\n\n\tvar _exception = __webpack_require__(5);\n\n\tvar _exception2 = _interopRequireDefault(_exception);\n\n\texports['default'] = function (instance) {\n\t  instance.registerHelper('helperMissing', function () /* [args, ]options */{\n\t    if (arguments.length === 1) {\n\t      // A missing field in a {{foo}} construct.\n\t      return undefined;\n\t    } else {\n\t      // Someone is actually trying to call something, blow up.\n\t      throw new _exception2['default']('Missing helper: \"' + arguments[arguments.length - 1].name + '\"');\n\t    }\n\t  });\n\t};\n\n\tmodule.exports = exports['default'];\n\n/***/ }),\n/* 65 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\n\tvar _interopRequireDefault = __webpack_require__(2)['default'];\n\n\texports.__esModule = true;\n\n\tvar _utils = __webpack_require__(4);\n\n\tvar _exception = __webpack_require__(5);\n\n\tvar _exception2 = _interopRequireDefault(_exception);\n\n\texports['default'] = function (instance) {\n\t  instance.registerHelper('if', function (conditional, options) {\n\t    if (arguments.length != 2) {\n\t      throw new _exception2['default']('#if requires exactly one argument');\n\t    }\n\t    if (_utils.isFunction(conditional)) {\n\t      conditional = conditional.call(this);\n\t    }\n\n\t    // Default behavior is to render the positive path if the value is truthy and not empty.\n\t    // The `includeZero` option may be set to treat the condtional as purely not empty based on the\n\t    // behavior of isEmpty. Effectively this determines if 0 is handled by the positive path or negative.\n\t    if (!options.hash.includeZero && !conditional || _utils.isEmpty(conditional)) {\n\t      return options.inverse(this);\n\t    } else {\n\t      return options.fn(this);\n\t    }\n\t  });\n\n\t  instance.registerHelper('unless', function (conditional, options) {\n\t    if (arguments.length != 2) {\n\t      throw new _exception2['default']('#unless requires exactly one argument');\n\t    }\n\t    return instance.helpers['if'].call(this, conditional, {\n\t      fn: options.inverse,\n\t      inverse: options.fn,\n\t      hash: options.hash\n\t    });\n\t  });\n\t};\n\n\tmodule.exports = exports['default'];\n\n/***/ }),\n/* 66 */\n/***/ (function(module, exports) {\n\n\t'use strict';\n\n\texports.__esModule = true;\n\n\texports['default'] = function (instance) {\n\t  instance.registerHelper('log', function () /* message, options */{\n\t    var args = [undefined],\n\t        options = arguments[arguments.length - 1];\n\t    for (var i = 0; i < arguments.length - 1; i++) {\n\t      args.push(arguments[i]);\n\t    }\n\n\t    var level = 1;\n\t    if (options.hash.level != null) {\n\t      level = options.hash.level;\n\t    } else if (options.data && options.data.level != null) {\n\t      level = options.data.level;\n\t    }\n\t    args[0] = level;\n\n\t    instance.log.apply(instance, args);\n\t  });\n\t};\n\n\tmodule.exports = exports['default'];\n\n/***/ }),\n/* 67 */\n/***/ (function(module, exports) {\n\n\t'use strict';\n\n\texports.__esModule = true;\n\n\texports['default'] = function (instance) {\n\t  instance.registerHelper('lookup', function (obj, field, options) {\n\t    if (!obj) {\n\t      // Note for 5.0: Change to \"obj == null\" in 5.0\n\t      return obj;\n\t    }\n\t    return options.lookupProperty(obj, field);\n\t  });\n\t};\n\n\tmodule.exports = exports['default'];\n\n/***/ }),\n/* 68 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\n\tvar _interopRequireDefault = __webpack_require__(2)['default'];\n\n\texports.__esModule = true;\n\n\tvar _utils = __webpack_require__(4);\n\n\tvar _exception = __webpack_require__(5);\n\n\tvar _exception2 = _interopRequireDefault(_exception);\n\n\texports['default'] = function (instance) {\n\t  instance.registerHelper('with', function (context, options) {\n\t    if (arguments.length != 2) {\n\t      throw new _exception2['default']('#with requires exactly one argument');\n\t    }\n\t    if (_utils.isFunction(context)) {\n\t      context = context.call(this);\n\t    }\n\n\t    var fn = options.fn;\n\n\t    if (!_utils.isEmpty(context)) {\n\t      var data = options.data;\n\t      if (options.data && options.ids) {\n\t        data = _utils.createFrame(options.data);\n\t        data.contextPath = _utils.appendContextPath(options.data.contextPath, options.ids[0]);\n\t      }\n\n\t      return fn(context, {\n\t        data: data,\n\t        blockParams: _utils.blockParams([context], [data && data.contextPath])\n\t      });\n\t    } else {\n\t      return options.inverse(this);\n\t    }\n\t  });\n\t};\n\n\tmodule.exports = exports['default'];\n\n/***/ }),\n/* 69 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\n\tvar _interopRequireDefault = __webpack_require__(2)['default'];\n\n\texports.__esModule = true;\n\texports.registerDefaultDecorators = registerDefaultDecorators;\n\n\tvar _decoratorsInline = __webpack_require__(70);\n\n\tvar _decoratorsInline2 = _interopRequireDefault(_decoratorsInline);\n\n\tfunction registerDefaultDecorators(instance) {\n\t  _decoratorsInline2['default'](instance);\n\t}\n\n/***/ }),\n/* 70 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\n\texports.__esModule = true;\n\n\tvar _utils = __webpack_require__(4);\n\n\texports['default'] = function (instance) {\n\t  instance.registerDecorator('inline', function (fn, props, container, options) {\n\t    var ret = fn;\n\t    if (!props.partials) {\n\t      props.partials = {};\n\t      ret = function (context, options) {\n\t        // Create a new partials stack frame prior to exec.\n\t        var original = container.partials;\n\t        container.partials = _utils.extend({}, original, props.partials);\n\t        var ret = fn(context, options);\n\t        container.partials = original;\n\t        return ret;\n\t      };\n\t    }\n\n\t    props.partials[options.args[0]] = options.fn;\n\n\t    return ret;\n\t  });\n\t};\n\n\tmodule.exports = exports['default'];\n\n/***/ }),\n/* 71 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\n\texports.__esModule = true;\n\n\tvar _utils = __webpack_require__(4);\n\n\tvar logger = {\n\t  methodMap: ['debug', 'info', 'warn', 'error'],\n\t  level: 'info',\n\n\t  // Maps a given level value to the `methodMap` indexes above.\n\t  lookupLevel: function lookupLevel(level) {\n\t    if (typeof level === 'string') {\n\t      var levelMap = _utils.indexOf(logger.methodMap, level.toLowerCase());\n\t      if (levelMap >= 0) {\n\t        level = levelMap;\n\t      } else {\n\t        level = parseInt(level, 10);\n\t      }\n\t    }\n\n\t    return level;\n\t  },\n\n\t  // Can be overridden in the host environment\n\t  log: function log(level) {\n\t    level = logger.lookupLevel(level);\n\n\t    if (typeof console !== 'undefined' && logger.lookupLevel(logger.level) <= level) {\n\t      var method = logger.methodMap[level];\n\t      // eslint-disable-next-line no-console\n\t      if (!console[method]) {\n\t        method = 'log';\n\t      }\n\n\t      for (var _len = arguments.length, message = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n\t        message[_key - 1] = arguments[_key];\n\t      }\n\n\t      console[method].apply(console, message); // eslint-disable-line no-console\n\t    }\n\t  }\n\t};\n\n\texports['default'] = logger;\n\tmodule.exports = exports['default'];\n\n/***/ }),\n/* 72 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\n\tvar _Object$create = __webpack_require__(73)['default'];\n\n\tvar _Object$keys = __webpack_require__(59)['default'];\n\n\tvar _interopRequireDefault = __webpack_require__(2)['default'];\n\n\texports.__esModule = true;\n\texports.createProtoAccessControl = createProtoAccessControl;\n\texports.resultIsAllowed = resultIsAllowed;\n\texports.resetLoggedProperties = resetLoggedProperties;\n\n\tvar _createNewLookupObject = __webpack_require__(75);\n\n\tvar _logger = __webpack_require__(71);\n\n\tvar _logger2 = _interopRequireDefault(_logger);\n\n\tvar loggedProperties = _Object$create(null);\n\n\tfunction createProtoAccessControl(runtimeOptions) {\n\t  var defaultMethodWhiteList = _Object$create(null);\n\t  defaultMethodWhiteList['constructor'] = false;\n\t  defaultMethodWhiteList['__defineGetter__'] = false;\n\t  defaultMethodWhiteList['__defineSetter__'] = false;\n\t  defaultMethodWhiteList['__lookupGetter__'] = false;\n\n\t  var defaultPropertyWhiteList = _Object$create(null);\n\t  // eslint-disable-next-line no-proto\n\t  defaultPropertyWhiteList['__proto__'] = false;\n\n\t  return {\n\t    properties: {\n\t      whitelist: _createNewLookupObject.createNewLookupObject(defaultPropertyWhiteList, runtimeOptions.allowedProtoProperties),\n\t      defaultValue: runtimeOptions.allowProtoPropertiesByDefault\n\t    },\n\t    methods: {\n\t      whitelist: _createNewLookupObject.createNewLookupObject(defaultMethodWhiteList, runtimeOptions.allowedProtoMethods),\n\t      defaultValue: runtimeOptions.allowProtoMethodsByDefault\n\t    }\n\t  };\n\t}\n\n\tfunction resultIsAllowed(result, protoAccessControl, propertyName) {\n\t  if (typeof result === 'function') {\n\t    return checkWhiteList(protoAccessControl.methods, propertyName);\n\t  } else {\n\t    return checkWhiteList(protoAccessControl.properties, propertyName);\n\t  }\n\t}\n\n\tfunction checkWhiteList(protoAccessControlForType, propertyName) {\n\t  if (protoAccessControlForType.whitelist[propertyName] !== undefined) {\n\t    return protoAccessControlForType.whitelist[propertyName] === true;\n\t  }\n\t  if (protoAccessControlForType.defaultValue !== undefined) {\n\t    return protoAccessControlForType.defaultValue;\n\t  }\n\t  logUnexpecedPropertyAccessOnce(propertyName);\n\t  return false;\n\t}\n\n\tfunction logUnexpecedPropertyAccessOnce(propertyName) {\n\t  if (loggedProperties[propertyName] !== true) {\n\t    loggedProperties[propertyName] = true;\n\t    _logger2['default'].log('error', 'Handlebars: Access has been denied to resolve the property \"' + propertyName + '\" because it is not an \"own property\" of its parent.\\n' + 'You can add a runtime option to disable the check or this warning:\\n' + 'See https://handlebarsjs.com/api-reference/runtime-options.html#options-to-control-prototype-access for details');\n\t  }\n\t}\n\n\tfunction resetLoggedProperties() {\n\t  _Object$keys(loggedProperties).forEach(function (propertyName) {\n\t    delete loggedProperties[propertyName];\n\t  });\n\t}\n\n/***/ }),\n/* 73 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\tmodule.exports = { \"default\": __webpack_require__(74), __esModule: true };\n\n/***/ }),\n/* 74 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\tvar $ = __webpack_require__(8);\n\tmodule.exports = function create(P, D){\n\t  return $.create(P, D);\n\t};\n\n/***/ }),\n/* 75 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\n\tvar _Object$create = __webpack_require__(73)['default'];\n\n\texports.__esModule = true;\n\texports.createNewLookupObject = createNewLookupObject;\n\n\tvar _utils = __webpack_require__(4);\n\n\t/**\n\t * Create a new object with \"null\"-prototype to avoid truthy results on prototype properties.\n\t * The resulting object can be used with \"object[property]\" to check if a property exists\n\t * @param {...object} sources a varargs parameter of source objects that will be merged\n\t * @returns {object}\n\t */\n\n\tfunction createNewLookupObject() {\n\t  for (var _len = arguments.length, sources = Array(_len), _key = 0; _key < _len; _key++) {\n\t    sources[_key] = arguments[_key];\n\t  }\n\n\t  return _utils.extend.apply(undefined, [_Object$create(null)].concat(sources));\n\t}\n\n/***/ }),\n/* 76 */\n/***/ (function(module, exports) {\n\n\t// Build out our basic SafeString type\n\t'use strict';\n\n\texports.__esModule = true;\n\tfunction SafeString(string) {\n\t  this.string = string;\n\t}\n\n\tSafeString.prototype.toString = SafeString.prototype.toHTML = function () {\n\t  return '' + this.string;\n\t};\n\n\texports['default'] = SafeString;\n\tmodule.exports = exports['default'];\n\n/***/ }),\n/* 77 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\n\tvar _Object$seal = __webpack_require__(78)['default'];\n\n\tvar _Object$keys = __webpack_require__(59)['default'];\n\n\tvar _interopRequireWildcard = __webpack_require__(1)['default'];\n\n\tvar _interopRequireDefault = __webpack_require__(2)['default'];\n\n\texports.__esModule = true;\n\texports.checkRevision = checkRevision;\n\texports.template = template;\n\texports.wrapProgram = wrapProgram;\n\texports.resolvePartial = resolvePartial;\n\texports.invokePartial = invokePartial;\n\texports.noop = noop;\n\n\tvar _utils = __webpack_require__(4);\n\n\tvar Utils = _interopRequireWildcard(_utils);\n\n\tvar _exception = __webpack_require__(5);\n\n\tvar _exception2 = _interopRequireDefault(_exception);\n\n\tvar _base = __webpack_require__(3);\n\n\tvar _helpers = __webpack_require__(9);\n\n\tvar _internalWrapHelper = __webpack_require__(81);\n\n\tvar _internalProtoAccess = __webpack_require__(72);\n\n\tfunction checkRevision(compilerInfo) {\n\t  var compilerRevision = compilerInfo && compilerInfo[0] || 1,\n\t      currentRevision = _base.COMPILER_REVISION;\n\n\t  if (compilerRevision >= _base.LAST_COMPATIBLE_COMPILER_REVISION && compilerRevision <= _base.COMPILER_REVISION) {\n\t    return;\n\t  }\n\n\t  if (compilerRevision < _base.LAST_COMPATIBLE_COMPILER_REVISION) {\n\t    var runtimeVersions = _base.REVISION_CHANGES[currentRevision],\n\t        compilerVersions = _base.REVISION_CHANGES[compilerRevision];\n\t    throw new _exception2['default']('Template was precompiled with an older version of Handlebars than the current runtime. ' + 'Please update your precompiler to a newer version (' + runtimeVersions + ') or downgrade your runtime to an older version (' + compilerVersions + ').');\n\t  } else {\n\t    // Use the embedded version info since the runtime doesn't know about this revision yet\n\t    throw new _exception2['default']('Template was precompiled with a newer version of Handlebars than the current runtime. ' + 'Please update your runtime to a newer version (' + compilerInfo[1] + ').');\n\t  }\n\t}\n\n\tfunction template(templateSpec, env) {\n\t  /* istanbul ignore next */\n\t  if (!env) {\n\t    throw new _exception2['default']('No environment passed to template');\n\t  }\n\t  if (!templateSpec || !templateSpec.main) {\n\t    throw new _exception2['default']('Unknown template object: ' + typeof templateSpec);\n\t  }\n\n\t  templateSpec.main.decorator = templateSpec.main_d;\n\n\t  // Note: Using env.VM references rather than local var references throughout this section to allow\n\t  // for external users to override these as pseudo-supported APIs.\n\t  env.VM.checkRevision(templateSpec.compiler);\n\n\t  // backwards compatibility for precompiled templates with compiler-version 7 (<4.3.0)\n\t  var templateWasPrecompiledWithCompilerV7 = templateSpec.compiler && templateSpec.compiler[0] === 7;\n\n\t  function invokePartialWrapper(partial, context, options) {\n\t    if (options.hash) {\n\t      context = Utils.extend({}, context, options.hash);\n\t      if (options.ids) {\n\t        options.ids[0] = true;\n\t      }\n\t    }\n\t    partial = env.VM.resolvePartial.call(this, partial, context, options);\n\n\t    var extendedOptions = Utils.extend({}, options, {\n\t      hooks: this.hooks,\n\t      protoAccessControl: this.protoAccessControl\n\t    });\n\n\t    var result = env.VM.invokePartial.call(this, partial, context, extendedOptions);\n\n\t    if (result == null && env.compile) {\n\t      options.partials[options.name] = env.compile(partial, templateSpec.compilerOptions, env);\n\t      result = options.partials[options.name](context, extendedOptions);\n\t    }\n\t    if (result != null) {\n\t      if (options.indent) {\n\t        var lines = result.split('\\n');\n\t        for (var i = 0, l = lines.length; i < l; i++) {\n\t          if (!lines[i] && i + 1 === l) {\n\t            break;\n\t          }\n\n\t          lines[i] = options.indent + lines[i];\n\t        }\n\t        result = lines.join('\\n');\n\t      }\n\t      return result;\n\t    } else {\n\t      throw new _exception2['default']('The partial ' + options.name + ' could not be compiled when running in runtime-only mode');\n\t    }\n\t  }\n\n\t  // Just add water\n\t  var container = {\n\t    strict: function strict(obj, name, loc) {\n\t      if (!obj || !(name in obj)) {\n\t        throw new _exception2['default']('\"' + name + '\" not defined in ' + obj, {\n\t          loc: loc\n\t        });\n\t      }\n\t      return container.lookupProperty(obj, name);\n\t    },\n\t    lookupProperty: function lookupProperty(parent, propertyName) {\n\t      var result = parent[propertyName];\n\t      if (result == null) {\n\t        return result;\n\t      }\n\t      if (Object.prototype.hasOwnProperty.call(parent, propertyName)) {\n\t        return result;\n\t      }\n\n\t      if (_internalProtoAccess.resultIsAllowed(result, container.protoAccessControl, propertyName)) {\n\t        return result;\n\t      }\n\t      return undefined;\n\t    },\n\t    lookup: function lookup(depths, name) {\n\t      var len = depths.length;\n\t      for (var i = 0; i < len; i++) {\n\t        var result = depths[i] && container.lookupProperty(depths[i], name);\n\t        if (result != null) {\n\t          return depths[i][name];\n\t        }\n\t      }\n\t    },\n\t    lambda: function lambda(current, context) {\n\t      return typeof current === 'function' ? current.call(context) : current;\n\t    },\n\n\t    escapeExpression: Utils.escapeExpression,\n\t    invokePartial: invokePartialWrapper,\n\n\t    fn: function fn(i) {\n\t      var ret = templateSpec[i];\n\t      ret.decorator = templateSpec[i + '_d'];\n\t      return ret;\n\t    },\n\n\t    programs: [],\n\t    program: function program(i, data, declaredBlockParams, blockParams, depths) {\n\t      var programWrapper = this.programs[i],\n\t          fn = this.fn(i);\n\t      if (data || depths || blockParams || declaredBlockParams) {\n\t        programWrapper = wrapProgram(this, i, fn, data, declaredBlockParams, blockParams, depths);\n\t      } else if (!programWrapper) {\n\t        programWrapper = this.programs[i] = wrapProgram(this, i, fn);\n\t      }\n\t      return programWrapper;\n\t    },\n\n\t    data: function data(value, depth) {\n\t      while (value && depth--) {\n\t        value = value._parent;\n\t      }\n\t      return value;\n\t    },\n\t    mergeIfNeeded: function mergeIfNeeded(param, common) {\n\t      var obj = param || common;\n\n\t      if (param && common && param !== common) {\n\t        obj = Utils.extend({}, common, param);\n\t      }\n\n\t      return obj;\n\t    },\n\t    // An empty object to use as replacement for null-contexts\n\t    nullContext: _Object$seal({}),\n\n\t    noop: env.VM.noop,\n\t    compilerInfo: templateSpec.compiler\n\t  };\n\n\t  function ret(context) {\n\t    var options = arguments.length <= 1 || arguments[1] === undefined ? {} : arguments[1];\n\n\t    var data = options.data;\n\n\t    ret._setup(options);\n\t    if (!options.partial && templateSpec.useData) {\n\t      data = initData(context, data);\n\t    }\n\t    var depths = undefined,\n\t        blockParams = templateSpec.useBlockParams ? [] : undefined;\n\t    if (templateSpec.useDepths) {\n\t      if (options.depths) {\n\t        depths = context != options.depths[0] ? [context].concat(options.depths) : options.depths;\n\t      } else {\n\t        depths = [context];\n\t      }\n\t    }\n\n\t    function main(context /*, options*/) {\n\t      return '' + templateSpec.main(container, context, container.helpers, container.partials, data, blockParams, depths);\n\t    }\n\n\t    main = executeDecorators(templateSpec.main, main, container, options.depths || [], data, blockParams);\n\t    return main(context, options);\n\t  }\n\n\t  ret.isTop = true;\n\n\t  ret._setup = function (options) {\n\t    if (!options.partial) {\n\t      var mergedHelpers = Utils.extend({}, env.helpers, options.helpers);\n\t      wrapHelpersToPassLookupProperty(mergedHelpers, container);\n\t      container.helpers = mergedHelpers;\n\n\t      if (templateSpec.usePartial) {\n\t        // Use mergeIfNeeded here to prevent compiling global partials multiple times\n\t        container.partials = container.mergeIfNeeded(options.partials, env.partials);\n\t      }\n\t      if (templateSpec.usePartial || templateSpec.useDecorators) {\n\t        container.decorators = Utils.extend({}, env.decorators, options.decorators);\n\t      }\n\n\t      container.hooks = {};\n\t      container.protoAccessControl = _internalProtoAccess.createProtoAccessControl(options);\n\n\t      var keepHelperInHelpers = options.allowCallsToHelperMissing || templateWasPrecompiledWithCompilerV7;\n\t      _helpers.moveHelperToHooks(container, 'helperMissing', keepHelperInHelpers);\n\t      _helpers.moveHelperToHooks(container, 'blockHelperMissing', keepHelperInHelpers);\n\t    } else {\n\t      container.protoAccessControl = options.protoAccessControl; // internal option\n\t      container.helpers = options.helpers;\n\t      container.partials = options.partials;\n\t      container.decorators = options.decorators;\n\t      container.hooks = options.hooks;\n\t    }\n\t  };\n\n\t  ret._child = function (i, data, blockParams, depths) {\n\t    if (templateSpec.useBlockParams && !blockParams) {\n\t      throw new _exception2['default']('must pass block params');\n\t    }\n\t    if (templateSpec.useDepths && !depths) {\n\t      throw new _exception2['default']('must pass parent depths');\n\t    }\n\n\t    return wrapProgram(container, i, templateSpec[i], data, 0, blockParams, depths);\n\t  };\n\t  return ret;\n\t}\n\n\tfunction wrapProgram(container, i, fn, data, declaredBlockParams, blockParams, depths) {\n\t  function prog(context) {\n\t    var options = arguments.length <= 1 || arguments[1] === undefined ? {} : arguments[1];\n\n\t    var currentDepths = depths;\n\t    if (depths && context != depths[0] && !(context === container.nullContext && depths[0] === null)) {\n\t      currentDepths = [context].concat(depths);\n\t    }\n\n\t    return fn(container, context, container.helpers, container.partials, options.data || data, blockParams && [options.blockParams].concat(blockParams), currentDepths);\n\t  }\n\n\t  prog = executeDecorators(fn, prog, container, depths, data, blockParams);\n\n\t  prog.program = i;\n\t  prog.depth = depths ? depths.length : 0;\n\t  prog.blockParams = declaredBlockParams || 0;\n\t  return prog;\n\t}\n\n\t/**\n\t * This is currently part of the official API, therefore implementation details should not be changed.\n\t */\n\n\tfunction resolvePartial(partial, context, options) {\n\t  if (!partial) {\n\t    if (options.name === '@partial-block') {\n\t      partial = options.data['partial-block'];\n\t    } else {\n\t      partial = options.partials[options.name];\n\t    }\n\t  } else if (!partial.call && !options.name) {\n\t    // This is a dynamic partial that returned a string\n\t    options.name = partial;\n\t    partial = options.partials[partial];\n\t  }\n\t  return partial;\n\t}\n\n\tfunction invokePartial(partial, context, options) {\n\t  // Use the current closure context to save the partial-block if this partial\n\t  var currentPartialBlock = options.data && options.data['partial-block'];\n\t  options.partial = true;\n\t  if (options.ids) {\n\t    options.data.contextPath = options.ids[0] || options.data.contextPath;\n\t  }\n\n\t  var partialBlock = undefined;\n\t  if (options.fn && options.fn !== noop) {\n\t    (function () {\n\t      options.data = _base.createFrame(options.data);\n\t      // Wrapper function to get access to currentPartialBlock from the closure\n\t      var fn = options.fn;\n\t      partialBlock = options.data['partial-block'] = function partialBlockWrapper(context) {\n\t        var options = arguments.length <= 1 || arguments[1] === undefined ? {} : arguments[1];\n\n\t        // Restore the partial-block from the closure for the execution of the block\n\t        // i.e. the part inside the block of the partial call.\n\t        options.data = _base.createFrame(options.data);\n\t        options.data['partial-block'] = currentPartialBlock;\n\t        return fn(context, options);\n\t      };\n\t      if (fn.partials) {\n\t        options.partials = Utils.extend({}, options.partials, fn.partials);\n\t      }\n\t    })();\n\t  }\n\n\t  if (partial === undefined && partialBlock) {\n\t    partial = partialBlock;\n\t  }\n\n\t  if (partial === undefined) {\n\t    throw new _exception2['default']('The partial ' + options.name + ' could not be found');\n\t  } else if (partial instanceof Function) {\n\t    return partial(context, options);\n\t  }\n\t}\n\n\tfunction noop() {\n\t  return '';\n\t}\n\n\tfunction initData(context, data) {\n\t  if (!data || !('root' in data)) {\n\t    data = data ? _base.createFrame(data) : {};\n\t    data.root = context;\n\t  }\n\t  return data;\n\t}\n\n\tfunction executeDecorators(fn, prog, container, depths, data, blockParams) {\n\t  if (fn.decorator) {\n\t    var props = {};\n\t    prog = fn.decorator(prog, props, container, depths && depths[0], data, blockParams, depths);\n\t    Utils.extend(prog, props);\n\t  }\n\t  return prog;\n\t}\n\n\tfunction wrapHelpersToPassLookupProperty(mergedHelpers, container) {\n\t  _Object$keys(mergedHelpers).forEach(function (helperName) {\n\t    var helper = mergedHelpers[helperName];\n\t    mergedHelpers[helperName] = passLookupPropertyOption(helper, container);\n\t  });\n\t}\n\n\tfunction passLookupPropertyOption(helper, container) {\n\t  var lookupProperty = container.lookupProperty;\n\t  return _internalWrapHelper.wrapHelper(helper, function (options) {\n\t    return Utils.extend({ lookupProperty: lookupProperty }, options);\n\t  });\n\t}\n\n/***/ }),\n/* 78 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\tmodule.exports = { \"default\": __webpack_require__(79), __esModule: true };\n\n/***/ }),\n/* 79 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\t__webpack_require__(80);\n\tmodule.exports = __webpack_require__(20).Object.seal;\n\n/***/ }),\n/* 80 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\t// 19.1.2.17 Object.seal(O)\n\tvar isObject = __webpack_require__(39);\n\n\t__webpack_require__(63)('seal', function($seal){\n\t  return function seal(it){\n\t    return $seal && isObject(it) ? $seal(it) : it;\n\t  };\n\t});\n\n/***/ }),\n/* 81 */\n/***/ (function(module, exports) {\n\n\t'use strict';\n\n\texports.__esModule = true;\n\texports.wrapHelper = wrapHelper;\n\n\tfunction wrapHelper(helper, transformOptionsFn) {\n\t  if (typeof helper !== 'function') {\n\t    // This should not happen, but apparently it does in https://github.com/wycats/handlebars.js/issues/1639\n\t    // We try to make the wrapper least-invasive by not wrapping it, if the helper is not a function.\n\t    return helper;\n\t  }\n\t  var wrapper = function wrapper() /* dynamic arguments */{\n\t    var options = arguments[arguments.length - 1];\n\t    arguments[arguments.length - 1] = transformOptionsFn(options);\n\t    return helper.apply(this, arguments);\n\t  };\n\t  return wrapper;\n\t}\n\n/***/ }),\n/* 82 */\n/***/ (function(module, exports) {\n\n\t/* global globalThis */\n\t'use strict';\n\n\texports.__esModule = true;\n\n\texports['default'] = function (Handlebars) {\n\t  /* istanbul ignore next */\n\t  // https://mathiasbynens.be/notes/globalthis\n\t  (function () {\n\t    if (typeof globalThis === 'object') return;\n\t    Object.prototype.__defineGetter__('__magic__', function () {\n\t      return this;\n\t    });\n\t    __magic__.globalThis = __magic__; // eslint-disable-line no-undef\n\t    delete Object.prototype.__magic__;\n\t  })();\n\n\t  var $Handlebars = globalThis.Handlebars;\n\n\t  /* istanbul ignore next */\n\t  Handlebars.noConflict = function () {\n\t    if (globalThis.Handlebars === Handlebars) {\n\t      globalThis.Handlebars = $Handlebars;\n\t    }\n\t    return Handlebars;\n\t  };\n\t};\n\n\tmodule.exports = exports['default'];\n\n/***/ })\n/******/ ])\n});\n;","/**\n * Handlebars Template Engine\n *\n * Full-featured Handlebars template rendering with support for helpers, partials, and all Handlebars features.\n */\n\nimport * as Handlebars from 'handlebars'\nimport type { TemplateContext } from '../types.js'\nimport { BaseTemplateEngine } from './base.js'\n\n/**\n * Handlebars template engine\n */\nexport class HandlebarsTemplateEngine extends BaseTemplateEngine {\n  name = 'handlebars'\n  private handlebars: typeof Handlebars\n  private compiledTemplates: Map<string, HandlebarsTemplateDelegate> = new Map()\n\n  constructor() {\n    super()\n    this.handlebars = Handlebars.create()\n\n    // Register default helpers\n    this.registerDefaultHelpers()\n  }\n\n  /**\n   * Render a template with Handlebars\n   */\n  async render(template: string, context: TemplateContext): Promise<string> {\n    try {\n      // Check if we have a compiled version\n      let compiledTemplate = this.compiledTemplates.get(template)\n\n      if (!compiledTemplate) {\n        compiledTemplate = this.handlebars.compile(template)\n        // Cache compiled template for reuse\n        this.compiledTemplates.set(template, compiledTemplate)\n      }\n\n      return compiledTemplate(context)\n    } catch (error) {\n      throw new Error(\n        `Handlebars render error: ${error instanceof Error ? error.message : String(error)}`\n      )\n    }\n  }\n\n  /**\n   * Validate template syntax\n   */\n  async validate(template: string): Promise<{ valid: boolean; errors?: string[] }> {\n    try {\n      this.handlebars.compile(template)\n      return { valid: true }\n    } catch (error) {\n      return {\n        valid: false,\n        errors: [error instanceof Error ? error.message : String(error)],\n      }\n    }\n  }\n\n  /**\n   * Compile a template for repeated use\n   */\n  async compile(template: string): Promise<HandlebarsTemplateDelegate> {\n    const compiled = this.handlebars.compile(template)\n    this.compiledTemplates.set(template, compiled)\n    return compiled\n  }\n\n  /**\n   * Register a helper function\n   */\n  registerHelper(name: string, fn: Handlebars.HelperDelegate): void {\n    this.handlebars.registerHelper(name, fn)\n  }\n\n  /**\n   * Register a partial template\n   */\n  registerPartial(name: string, template: string): void {\n    this.handlebars.registerPartial(name, template)\n  }\n\n  /**\n   * Register default helpers\n   */\n  private registerDefaultHelpers(): void {\n    // eq - equality check\n    this.handlebars.registerHelper('eq', (a, b) => a === b)\n\n    // ne - not equal check\n    this.handlebars.registerHelper('ne', (a, b) => a !== b)\n\n    // lt - less than\n    this.handlebars.registerHelper('lt', (a, b) => a < b)\n\n    // lte - less than or equal\n    this.handlebars.registerHelper('lte', (a, b) => a <= b)\n\n    // gt - greater than\n    this.handlebars.registerHelper('gt', (a, b) => a > b)\n\n    // gte - greater than or equal\n    this.handlebars.registerHelper('gte', (a, b) => a >= b)\n\n    // and - logical AND\n    this.handlebars.registerHelper('and', (...args) => {\n      // Remove the options object (last argument)\n      const values = args.slice(0, -1)\n      return values.every((v) => !!v)\n    })\n\n    // or - logical OR\n    this.handlebars.registerHelper('or', (...args) => {\n      // Remove the options object (last argument)\n      const values = args.slice(0, -1)\n      return values.some((v) => !!v)\n    })\n\n    // not - logical NOT\n    this.handlebars.registerHelper('not', (value) => !value)\n\n    // length - get array/string length\n    this.handlebars.registerHelper('length', (value) => {\n      if (Array.isArray(value) || typeof value === 'string') {\n        return value.length\n      }\n      return 0\n    })\n\n    // join - join array elements\n    this.handlebars.registerHelper('join', (array, separator = ',') => {\n      if (Array.isArray(array)) {\n        return array.join(separator)\n      }\n      return ''\n    })\n\n    // upper - uppercase string\n    this.handlebars.registerHelper('upper', (str) => {\n      if (typeof str === 'string') {\n        return str.toUpperCase()\n      }\n      return str\n    })\n\n    // lower - lowercase string\n    this.handlebars.registerHelper('lower', (str) => {\n      if (typeof str === 'string') {\n        return str.toLowerCase()\n      }\n      return str\n    })\n\n    // capitalize - capitalize first letter\n    this.handlebars.registerHelper('capitalize', (str) => {\n      if (typeof str === 'string' && str.length > 0) {\n        return str.charAt(0).toUpperCase() + str.slice(1)\n      }\n      return str\n    })\n\n    // truncate - truncate string to length\n    this.handlebars.registerHelper('truncate', (str, length = 100) => {\n      if (typeof str === 'string' && str.length > length) {\n        return str.substring(0, length) + '...'\n      }\n      return str\n    })\n\n    // default - provide default value if empty\n    this.handlebars.registerHelper('default', (value, defaultValue) => {\n      return value ?? defaultValue\n    })\n\n    // json - stringify object as JSON\n    this.handlebars.registerHelper('json', (obj) => {\n      try {\n        return JSON.stringify(obj, null, 2)\n      } catch {\n        return String(obj)\n      }\n    })\n\n    // date - format date\n    this.handlebars.registerHelper('date', (date) => {\n      try {\n        const d = date instanceof Date ? date : new Date(date)\n        return d.toLocaleDateString()\n      } catch {\n        return String(date)\n      }\n    })\n\n    // formatNumber - format number with commas\n    this.handlebars.registerHelper('formatNumber', (num) => {\n      if (typeof num === 'number') {\n        return num.toLocaleString()\n      }\n      return num\n    })\n  }\n\n  /**\n   * Clear the template cache\n   */\n  clearCache(): void {\n    this.compiledTemplates.clear()\n  }\n}\n","/**\n * Template Engine Factory\n *\n * Creates template engines based on type.\n * Supports Workers-compatible engines: 'simple' and 'liquid'\n * Note: handlebars/mjml removed - use eval(), fail in Cloudflare Workers\n */\n\nimport type { TemplateEngine } from '../types.js'\nimport { BaseTemplateEngine } from './base.js'\nimport { SimpleTemplateEngine } from './simple.js'\nimport { HandlebarsTemplateEngine } from './handlebars.js' // Kept for DocsManager (server-side only)\nimport { LiquidTemplateEngine } from './liquid.js'\nimport { MJMLTemplateEngine } from './mjml.js' // Kept for EmailAgent (server-side rendering)\n\n/**\n * Create a template engine instance (Workers-compatible only)\n */\nexport function createTemplateEngine(engine: TemplateEngine): BaseTemplateEngine {\n  switch (engine) {\n    case 'simple':\n      return new SimpleTemplateEngine()\n\n    case 'liquid':\n      return new LiquidTemplateEngine()\n\n    default:\n      throw new Error(`Unknown template engine: ${engine}`)\n  }\n}\n\n/**\n * Check if an engine is available (Workers-compatible)\n */\nexport function isEngineAvailable(engine: TemplateEngine): boolean {\n  return engine === 'simple' || engine === 'liquid'\n}\n\n/**\n * Get list of available engines (Workers-compatible)\n */\nexport function getAvailableEngines(): TemplateEngine[] {\n  return ['simple', 'liquid'] // simple first as default\n}\n\n// Re-export types and classes\nexport { BaseTemplateEngine } from './base.js'\nexport { SimpleTemplateEngine } from './simple.js'\nexport { HandlebarsTemplateEngine } from './handlebars.js'\nexport { LiquidTemplateEngine } from './liquid.js'\nexport { MJMLTemplateEngine } from './mjml.js'\n","/**\n * Email Template Loader\n *\n * Loads and renders email templates from local files or KV storage\n * Supports Handlebars templating and Edgit versioning\n */\n\nimport type { KVNamespace } from '@cloudflare/workers-types'\nimport type { BaseTemplateEngine } from '../../utils/templates/index.js'\nimport { resolveValue, type ComponentResolutionContext } from '../../utils/component-resolver.js'\n\n/**\n * Template data for rendering\n */\nexport interface TemplateData {\n  [key: string]: any\n}\n\n/**\n * Template loader configuration\n */\nexport interface TemplateLoaderConfig {\n  /** Template engine for rendering */\n  engine: BaseTemplateEngine\n  /** KV namespace for templates (optional) */\n  kv?: KVNamespace\n  /** Local templates directory (optional) */\n  localDir?: string\n  /** Default template version */\n  defaultVersion?: string\n}\n\n/**\n * Template reference parsing result\n */\ninterface TemplateRef {\n  /** Storage type */\n  type: 'kv' | 'local' | 'inline'\n  /** Template path */\n  path: string\n  /** Template version (for KV) */\n  version?: string\n}\n\n/**\n * Email Template Loader\n */\nexport class TemplateLoader {\n  private engine: BaseTemplateEngine\n  private kv?: KVNamespace\n  private localDir: string\n  private defaultVersion: string\n  private cache: Map<string, string>\n\n  constructor(config: TemplateLoaderConfig) {\n    this.engine = config.engine\n    this.kv = config.kv\n    this.localDir = config.localDir || 'templates'\n    this.defaultVersion = config.defaultVersion || 'latest'\n    this.cache = new Map()\n  }\n\n  /**\n   * Load and render template\n   */\n  async render(template: string, data: TemplateData = {}, env?: any): Promise<string> {\n    // Use component resolver for unified handling\n    const context: ComponentResolutionContext = {\n      env,\n      baseDir: process.cwd(),\n    }\n\n    // Resolve template content (supports inline, file paths, and component references)\n    const resolved = await resolveValue(template, context)\n    const content =\n      typeof resolved.content === 'string' ? resolved.content : JSON.stringify(resolved.content)\n\n    // Render template with template engine\n    return await this.engine.render(content, data)\n  }\n\n  /**\n   * Parse template reference\n   */\n  private parseTemplateRef(template: string): TemplateRef {\n    // KV reference: kv://templates/email/welcome@v1.0.0\n    if (template.startsWith('kv://')) {\n      const path = template.slice(5)\n      const [pathPart, version] = path.split('@')\n      return {\n        type: 'kv',\n        path: pathPart,\n        version: version || this.defaultVersion,\n      }\n    }\n\n    // Local file reference: templates/email/welcome.html\n    // Must end with file extension and not contain HTML tags\n    const isFilePath =\n      (template.endsWith('.html') || template.endsWith('.mjml')) && !template.includes('<')\n    if (isFilePath) {\n      return {\n        type: 'local',\n        path: template,\n      }\n    }\n\n    // Inline HTML (everything else)\n    return {\n      type: 'inline',\n      path: template,\n    }\n  }\n\n  /**\n   * Load template from storage\n   */\n  private async loadTemplate(ref: TemplateRef): Promise<string> {\n    // Check cache first\n    const cacheKey = `${ref.type}:${ref.path}${ref.version ? `@${ref.version}` : ''}`\n    if (this.cache.has(cacheKey)) {\n      return this.cache.get(cacheKey)!\n    }\n\n    let content: string\n\n    switch (ref.type) {\n      case 'kv':\n        content = await this.loadFromKv(ref.path, ref.version)\n        break\n\n      case 'local':\n        content = await this.loadFromLocal(ref.path)\n        break\n\n      case 'inline':\n        content = ref.path\n        break\n    }\n\n    // Cache template\n    this.cache.set(cacheKey, content)\n\n    return content\n  }\n\n  /**\n   * Load template from KV\n   */\n  private async loadFromKv(path: string, version?: string): Promise<string> {\n    if (!this.kv) {\n      throw new Error('KV namespace not configured for template loading')\n    }\n\n    // Build KV key: templates/email/welcome@v1.0.0\n    const key = version ? `${path}@${version}` : path\n\n    const content = await this.kv.get(key, 'text')\n    if (!content) {\n      throw new Error(`Template not found in KV: ${key}`)\n    }\n\n    return content\n  }\n\n  /**\n   * Load template from local file system\n   */\n  private async loadFromLocal(path: string): Promise<string> {\n    // In Cloudflare Workers, we can't access the file system directly\n    // Templates must be bundled with the Worker or loaded from KV\n    throw new Error(\n      'Local file system access not available in Cloudflare Workers. ' +\n        'Use KV storage (kv://...) or inline templates instead.'\n    )\n  }\n\n  /**\n   * Clear template cache\n   */\n  clearCache(): void {\n    this.cache.clear()\n  }\n\n  /**\n   * Preload template into cache\n   */\n  async preload(template: string): Promise<void> {\n    const ref = this.parseTemplateRef(template)\n    await this.loadTemplate(ref)\n  }\n}\n\n/**\n * Create template loader instance\n */\nexport function createTemplateLoader(config: TemplateLoaderConfig): TemplateLoader {\n  return new TemplateLoader(config)\n}\n","/**\n * Email Agent\n *\n * Sends emails using configured email providers (Cloudflare, Resend, SMTP)\n * Supports templates, batch sending, and email tracking\n */\n\nimport { BaseAgent, type AgentExecutionContext } from '../base-agent.js'\nimport type {\n  EmailMessage,\n  EmailResult,\n  EmailProvider,\n  EmailProviderConfig,\n  EmailMemberInput,\n  EmailMemberOutput,\n  BatchEmailInput,\n  BatchEmailOutput,\n} from './types/index.js'\nimport { createEmailProvider } from './providers/index.js'\nimport {\n  createTemplateEngine,\n  type TemplateEngine,\n  type BaseTemplateEngine,\n} from '../../utils/templates/index.js'\nimport { TemplateLoader } from './template-loader.js'\n\n/**\n * Email Agent configuration\n */\nexport interface EmailAgentConfig {\n  /** Provider configuration */\n  provider: EmailProviderConfig\n  /** Rate limiting (emails per second) */\n  rateLimit?: number\n  /** Enable email tracking */\n  tracking?: boolean\n  /** KV namespace for templates */\n  templatesKv?: string\n  /** Template engine to use (default: 'simple') */\n  templateEngine?: TemplateEngine\n}\n\n/**\n * Email Agent\n */\nexport class EmailAgent extends BaseAgent {\n  private provider: EmailProvider\n  private templateEngine: BaseTemplateEngine\n  private templateLoader: TemplateLoader\n  private rateLimit: number\n  private tracking: boolean\n\n  constructor(config: any) {\n    super(config)\n\n    // Parse email config\n    const emailConfig = config.config as EmailAgentConfig\n    if (!emailConfig?.provider) {\n      throw new Error('Email agent requires provider configuration')\n    }\n\n    // Initialize provider\n    this.provider = createEmailProvider(emailConfig.provider)\n\n    // Initialize template engine (default to 'simple')\n    const engine = emailConfig.templateEngine || 'simple'\n    this.templateEngine = createTemplateEngine(engine)\n\n    // Initialize template loader for KV/file loading\n    this.templateLoader = new TemplateLoader({\n      engine: this.templateEngine,\n      kv: emailConfig.templatesKv ? config.env?.[emailConfig.templatesKv] || undefined : undefined,\n      defaultVersion: 'latest',\n    })\n\n    // Configuration\n    this.rateLimit = emailConfig.rateLimit || 10 // emails per second\n    this.tracking = emailConfig.tracking ?? false\n  }\n\n  /**\n   * Execute email sending\n   */\n  protected async run(\n    context: AgentExecutionContext\n  ): Promise<EmailMemberOutput | BatchEmailOutput> {\n    const input = context.input as EmailMemberInput | BatchEmailInput\n\n    // Check if this is a batch email operation\n    if ('recipients' in input && Array.isArray(input.recipients)) {\n      return this.sendBatch(input as BatchEmailInput, context)\n    }\n\n    // Single email\n    return this.sendSingle(input as EmailMemberInput, context)\n  }\n\n  /**\n   * Send single email\n   */\n  private async sendSingle(\n    input: EmailMemberInput,\n    context: AgentExecutionContext\n  ): Promise<EmailMemberOutput> {\n    // Build email message\n    const message = await this.buildMessage(input, context)\n\n    // Validate provider configuration\n    const validation = await this.provider.validateConfig()\n    if (!validation.valid) {\n      throw new Error(`Provider validation failed: ${validation.errors?.join(', ')}`)\n    }\n\n    // Send email\n    const result = await this.provider.send(message)\n\n    if (result.status === 'failed') {\n      throw new Error(`Email send failed: ${result.error}`)\n    }\n\n    return {\n      messageId: result.messageId,\n      status: result.status,\n      provider: result.provider,\n      timestamp: new Date().toISOString(),\n    }\n  }\n\n  /**\n   * Send batch emails\n   */\n  private async sendBatch(\n    input: BatchEmailInput,\n    context: AgentExecutionContext\n  ): Promise<BatchEmailOutput> {\n    const results: EmailResult[] = []\n    const errors: Array<{ email: string; error: string }> = []\n    const messageIds: string[] = []\n\n    // Rate limiting setup\n    const delayMs = 1000 / this.rateLimit\n    let lastSendTime = 0\n\n    for (const recipient of input.recipients) {\n      try {\n        // Rate limiting\n        const now = Date.now()\n        const timeSinceLastSend = now - lastSendTime\n        if (timeSinceLastSend < delayMs) {\n          await this.delay(delayMs - timeSinceLastSend)\n        }\n        lastSendTime = Date.now()\n\n        // Build email for this recipient\n        const emailInput: EmailMemberInput = {\n          to: recipient.email,\n          subject: input.subject,\n          template: input.template,\n          data: {\n            ...input.commonData,\n            ...recipient.data,\n          },\n        }\n\n        const message = await this.buildMessage(emailInput, context)\n        const result = await this.provider.send(message)\n\n        results.push(result)\n\n        if (result.status === 'sent') {\n          messageIds.push(result.messageId)\n        } else {\n          errors.push({\n            email: recipient.email,\n            error: result.error || 'Unknown error',\n          })\n        }\n      } catch (error) {\n        errors.push({\n          email: recipient.email,\n          error: error instanceof Error ? error.message : 'Unknown error',\n        })\n      }\n    }\n\n    const sent = results.filter((r) => r.status === 'sent').length\n    const failed = results.length - sent\n\n    return {\n      sent,\n      failed,\n      messageIds,\n      errors: errors.length > 0 ? errors : undefined,\n    }\n  }\n\n  /**\n   * Build email message from input\n   */\n  private async buildMessage(\n    input: EmailMemberInput,\n    context: AgentExecutionContext\n  ): Promise<EmailMessage> {\n    let html = input.html\n    let text = input.text\n\n    // Render template if provided\n    if (input.template) {\n      const data = input.data || {}\n      // Use template loader to load and render template (handles KV, files, inline, and component references)\n      html = await this.templateLoader.render(input.template, data, context.env)\n\n      // If no text version provided, strip HTML for plain text\n      if (!text) {\n        text = this.stripHtml(html)\n      }\n    }\n\n    // Build message\n    const message: EmailMessage = {\n      to: input.to,\n      cc: input.cc,\n      bcc: input.bcc,\n      from: input.from,\n      replyTo: input.replyTo,\n      subject: input.subject,\n      html,\n      text,\n      attachments: input.attachments,\n      headers: input.headers,\n      tags: input.tags,\n      metadata: input.metadata,\n    }\n\n    // Add tracking headers if enabled\n    if (this.tracking) {\n      message.headers = {\n        ...message.headers,\n        'X-Conductor-Tracking': 'enabled',\n        'X-Conductor-Ensemble': context.state?.ensembleName || 'unknown',\n      }\n    }\n\n    return message\n  }\n\n  /**\n   * Strip HTML tags for plain text version\n   */\n  private stripHtml(html: string): string {\n    return html\n      .replace(/<style[^>]*>[\\s\\S]*?<\\/style>/gi, '')\n      .replace(/<script[^>]*>[\\s\\S]*?<\\/script>/gi, '')\n      .replace(/<[^>]+>/g, '')\n      .replace(/&nbsp;/g, ' ')\n      .replace(/&lt;/g, '<')\n      .replace(/&gt;/g, '>')\n      .replace(/&amp;/g, '&')\n      .replace(/\\s+/g, ' ')\n      .trim()\n  }\n\n  /**\n   * Delay execution\n   */\n  private delay(ms: number): Promise<void> {\n    return new Promise((resolve) => setTimeout(resolve, ms))\n  }\n}\n\n/**\n * Create email agent instance\n */\nexport function createEmailMember(config: any): EmailAgent {\n  return new EmailAgent(config)\n}\n","/**\n * Base SMS Provider\n *\n * Abstract base class for all SMS providers\n */\n\nimport type {\n  SmsProvider,\n  SmsMessage,\n  SmsResult,\n  ValidationResult,\n  SmsStatus,\n} from '../types/index.js'\n\n/**\n * Abstract base SMS provider\n */\nexport abstract class BaseSmsProvider implements SmsProvider {\n  abstract name: string\n\n  /**\n   * Send an SMS\n   */\n  abstract send(message: SmsMessage): Promise<SmsResult>\n\n  /**\n   * Validate provider configuration\n   */\n  abstract validateConfig(): Promise<ValidationResult>\n\n  /**\n   * Get SMS status (optional)\n   */\n  async getStatus?(messageId: string): Promise<SmsStatus>\n\n  /**\n   * Normalize recipients to array\n   */\n  protected normalizeRecipients(recipients: string | string[]): string[] {\n    return Array.isArray(recipients) ? recipients : [recipients]\n  }\n\n  /**\n   * Validate phone number format (basic E.164 validation)\n   */\n  protected validatePhoneNumber(phone: string): boolean {\n    // E.164 format: +[country code][number]\n    const e164Regex = /^\\+[1-9]\\d{1,14}$/\n    return e164Regex.test(phone)\n  }\n\n  /**\n   * Validate required fields\n   */\n  protected validateMessage(message: SmsMessage): ValidationResult {\n    const errors: string[] = []\n\n    if (!message.to || (Array.isArray(message.to) && message.to.length === 0)) {\n      errors.push('Recipient (to) is required')\n    }\n\n    if (!message.body || message.body.trim() === '') {\n      errors.push('Message body is required')\n    }\n\n    // Validate phone numbers\n    const recipients = this.normalizeRecipients(message.to)\n    for (const phone of recipients) {\n      if (!this.validatePhoneNumber(phone)) {\n        errors.push(\n          `Invalid phone number format: ${phone} (must be E.164 format, e.g., +1234567890)`\n        )\n      }\n    }\n\n    // Check message length (160 chars for SMS, 1600 for concatenated)\n    if (message.body.length > 1600) {\n      errors.push('Message body exceeds maximum length of 1600 characters')\n    }\n\n    return {\n      valid: errors.length === 0,\n      errors: errors.length > 0 ? errors : undefined,\n    }\n  }\n}\n","/**\n * Twilio SMS Provider\n *\n * Uses Twilio's API for SMS delivery\n * https://www.twilio.com/docs/sms/api\n */\n\nimport { BaseSmsProvider } from './base.js'\nimport type { SmsMessage, SmsResult, ValidationResult } from '../types/index.js'\n\n/**\n * Twilio API response shape\n */\ninterface TwilioApiResponse {\n  sid?: string\n  status?: string\n  message?: string\n  error_code?: number\n  error_message?: string\n}\n\n/**\n * Twilio SMS Provider\n */\nexport class TwilioProvider extends BaseSmsProvider {\n  name = 'twilio'\n  private apiUrl = 'https://api.twilio.com/2010-04-01'\n\n  constructor(\n    private accountSid: string,\n    private authToken: string,\n    private defaultFrom: string,\n    private messagingServiceSid?: string\n  ) {\n    super()\n  }\n\n  /**\n   * Send SMS via Twilio API\n   */\n  async send(message: SmsMessage): Promise<SmsResult> {\n    // Validate message\n    const validation = this.validateMessage(message)\n    if (!validation.valid) {\n      return {\n        messageId: '',\n        status: 'failed',\n        provider: this.name,\n        error: validation.errors?.join(', '),\n      }\n    }\n\n    try {\n      const recipients = this.normalizeRecipients(message.to)\n\n      // For single recipient, send directly\n      if (recipients.length === 1) {\n        return await this.sendSingle(message, recipients[0])\n      }\n\n      // For multiple recipients, send individually\n      // Twilio doesn't support batch sending in a single API call\n      const results: SmsResult[] = []\n      for (const recipient of recipients) {\n        const result = await this.sendSingle({ ...message, to: recipient }, recipient)\n        results.push(result)\n      }\n\n      // Return first result (or aggregate if needed)\n      return results[0]\n    } catch (error) {\n      return {\n        messageId: '',\n        status: 'failed',\n        provider: this.name,\n        error: error instanceof Error ? error.message : 'Unknown error',\n      }\n    }\n  }\n\n  /**\n   * Send SMS to single recipient\n   */\n  private async sendSingle(message: SmsMessage, recipient: string): Promise<SmsResult> {\n    // Build request body\n    const body = new URLSearchParams()\n    body.append('To', recipient)\n    body.append('Body', message.body)\n\n    // Use messaging service SID or from number\n    if (this.messagingServiceSid) {\n      body.append('MessagingServiceSid', this.messagingServiceSid)\n    } else {\n      body.append('From', message.from || this.defaultFrom)\n    }\n\n    // Add media URLs for MMS\n    if (message.mediaUrl && message.mediaUrl.length > 0) {\n      message.mediaUrl.forEach((url) => {\n        body.append('MediaUrl', url)\n      })\n    }\n\n    // Add status callback if metadata includes callback URL\n    if (message.metadata?.statusCallback) {\n      body.append('StatusCallback', message.metadata.statusCallback as string)\n    }\n\n    // Send via Twilio API\n    const url = `${this.apiUrl}/Accounts/${this.accountSid}/Messages.json`\n    const auth = btoa(`${this.accountSid}:${this.authToken}`)\n\n    const response = await fetch(url, {\n      method: 'POST',\n      headers: {\n        Authorization: `Basic ${auth}`,\n        'Content-Type': 'application/x-www-form-urlencoded',\n      },\n      body: body.toString(),\n    })\n\n    const data = (await response.json()) as TwilioApiResponse\n\n    if (!response.ok) {\n      return {\n        messageId: '',\n        status: 'failed',\n        provider: this.name,\n        error: data.message || data.error_message || `HTTP ${response.status}`,\n      }\n    }\n\n    return {\n      messageId: data.sid || '',\n      status: this.mapTwilioStatus(data.status || 'unknown'),\n      provider: this.name,\n    }\n  }\n\n  /**\n   * Map Twilio status to our status\n   */\n  private mapTwilioStatus(twilioStatus: string): 'sent' | 'queued' | 'failed' {\n    switch (twilioStatus) {\n      case 'sent':\n      case 'delivered':\n        return 'sent'\n      case 'queued':\n      case 'accepted':\n      case 'sending':\n        return 'queued'\n      case 'failed':\n      case 'undelivered':\n      default:\n        return 'failed'\n    }\n  }\n\n  /**\n   * Validate configuration\n   */\n  async validateConfig(): Promise<ValidationResult> {\n    const errors: string[] = []\n\n    if (!this.accountSid) {\n      errors.push('Twilio Account SID is required')\n    }\n\n    if (!this.authToken) {\n      errors.push('Twilio Auth Token is required')\n    }\n\n    if (!this.messagingServiceSid && !this.defaultFrom) {\n      errors.push('Either Twilio Messaging Service SID or default from number is required')\n    }\n\n    if (this.defaultFrom && !this.validatePhoneNumber(this.defaultFrom)) {\n      errors.push('Default from number must be in E.164 format (e.g., +1234567890)')\n    }\n\n    return {\n      valid: errors.length === 0,\n      errors: errors.length > 0 ? errors : undefined,\n    }\n  }\n}\n","/**\n * SMS Provider Registry\n *\n * Factory for creating SMS providers based on configuration\n */\n\nimport type { SmsProvider, SmsProviderConfig } from '../types/index.js'\nimport { TwilioProvider } from './twilio.js'\n\n/**\n * Create SMS provider from configuration\n */\nexport function createSmsProvider(config: SmsProviderConfig): SmsProvider {\n  const from = config.from || ''\n\n  switch (config.provider) {\n    case 'twilio':\n      if (!config.twilio) {\n        throw new Error('Twilio configuration is required')\n      }\n      if (!config.twilio.accountSid) {\n        throw new Error('Twilio Account SID is required')\n      }\n      if (!config.twilio.authToken) {\n        throw new Error('Twilio Auth Token is required')\n      }\n      return new TwilioProvider(\n        config.twilio.accountSid,\n        config.twilio.authToken,\n        from,\n        config.twilio.messagingServiceSid\n      )\n\n    default:\n      throw new Error(`Unknown SMS provider: ${config.provider}`)\n  }\n}\n\n/**\n * Export providers\n */\nexport { BaseSmsProvider } from './base.js'\nexport { TwilioProvider } from './twilio.js'\n","/**\n * SMS Agent\n *\n * Sends SMS messages using configured SMS providers (Twilio, etc.)\n * Supports batch sending and template rendering\n */\n\nimport { BaseAgent, type AgentExecutionContext } from '../base-agent.js'\nimport type {\n  SmsMessage,\n  SmsResult,\n  SmsProvider,\n  SmsProviderConfig,\n  SmsMemberInput,\n  SmsMemberOutput,\n  BatchSmsInput,\n  BatchSmsOutput,\n} from './types/index.js'\nimport { createSmsProvider } from './providers/index.js'\nimport {\n  createTemplateEngine,\n  type TemplateEngine,\n  type BaseTemplateEngine,\n} from '../../utils/templates/index.js'\n\n/**\n * SMS Agent configuration\n */\nexport interface SmsAgentConfig {\n  /** Provider configuration */\n  provider: SmsProviderConfig\n  /** Rate limiting (SMS per second) */\n  rateLimit?: number\n  /** Template engine to use (default: 'simple') */\n  templateEngine?: TemplateEngine\n}\n\n/**\n * SMS Agent\n */\nexport class SmsAgent extends BaseAgent {\n  private provider: SmsProvider\n  private templateEngine: BaseTemplateEngine\n  private rateLimit: number\n\n  constructor(config: any) {\n    super(config)\n\n    // Parse SMS config\n    const smsConfig = config.config as SmsAgentConfig\n    if (!smsConfig?.provider) {\n      throw new Error('SMS agent requires provider configuration')\n    }\n\n    // Initialize provider\n    this.provider = createSmsProvider(smsConfig.provider)\n\n    // Initialize template engine (default to 'simple' for SMS)\n    const engine = smsConfig.templateEngine || 'simple'\n    this.templateEngine = createTemplateEngine(engine)\n\n    // Configuration\n    this.rateLimit = smsConfig.rateLimit || 10 // SMS per second\n  }\n\n  /**\n   * Execute SMS sending\n   */\n  protected async run(context: AgentExecutionContext): Promise<SmsMemberOutput | BatchSmsOutput> {\n    const input = context.input as SmsMemberInput | BatchSmsInput\n\n    // Check if this is a batch SMS operation\n    if ('recipients' in input && Array.isArray(input.recipients)) {\n      return this.sendBatch(input as BatchSmsInput, context)\n    }\n\n    // Single SMS\n    return this.sendSingle(input as SmsMemberInput, context)\n  }\n\n  /**\n   * Send single SMS\n   */\n  private async sendSingle(\n    input: SmsMemberInput,\n    context: AgentExecutionContext\n  ): Promise<SmsMemberOutput> {\n    // Build SMS message\n    const message = this.buildMessage(input)\n\n    // Validate provider configuration\n    const validation = await this.provider.validateConfig()\n    if (!validation.valid) {\n      throw new Error(`Provider validation failed: ${validation.errors?.join(', ')}`)\n    }\n\n    // Send SMS\n    const result = await this.provider.send(message)\n\n    if (result.status === 'failed') {\n      throw new Error(`SMS send failed: ${result.error}`)\n    }\n\n    return {\n      messageId: result.messageId,\n      status: result.status,\n      provider: result.provider,\n      timestamp: new Date().toISOString(),\n    }\n  }\n\n  /**\n   * Send batch SMS\n   */\n  private async sendBatch(\n    input: BatchSmsInput,\n    context: AgentExecutionContext\n  ): Promise<BatchSmsOutput> {\n    const results: SmsResult[] = []\n    const errors: Array<{ phone: string; error: string }> = []\n    const messageIds: string[] = []\n\n    // Rate limiting setup\n    const delayMs = 1000 / this.rateLimit\n    let lastSendTime = 0\n\n    for (const recipient of input.recipients) {\n      try {\n        // Rate limiting\n        const now = Date.now()\n        const timeSinceLastSend = now - lastSendTime\n        if (timeSinceLastSend < delayMs) {\n          await this.delay(delayMs - timeSinceLastSend)\n        }\n        lastSendTime = Date.now()\n\n        // Render message body with recipient data\n        const body = await this.renderTemplate(input.body, {\n          ...input.commonData,\n          ...recipient.data,\n        })\n\n        // Build SMS for this recipient\n        const smsInput: SmsMemberInput = {\n          to: recipient.phone,\n          body,\n          mediaUrl: input.mediaUrl,\n        }\n\n        const message = this.buildMessage(smsInput)\n        const result = await this.provider.send(message)\n\n        results.push(result)\n\n        if (result.status === 'sent' || result.status === 'queued') {\n          messageIds.push(result.messageId)\n        } else {\n          errors.push({\n            phone: recipient.phone,\n            error: result.error || 'Unknown error',\n          })\n        }\n      } catch (error) {\n        errors.push({\n          phone: recipient.phone,\n          error: error instanceof Error ? error.message : 'Unknown error',\n        })\n      }\n    }\n\n    const sent = results.filter((r) => r.status === 'sent' || r.status === 'queued').length\n    const failed = results.length - sent\n\n    return {\n      sent,\n      failed,\n      messageIds,\n      errors: errors.length > 0 ? errors : undefined,\n    }\n  }\n\n  /**\n   * Build SMS message from input\n   */\n  private buildMessage(input: SmsMemberInput): SmsMessage {\n    return {\n      to: input.to,\n      from: input.from,\n      body: input.body,\n      mediaUrl: input.mediaUrl,\n      metadata: input.metadata,\n    }\n  }\n\n  /**\n   * Render template with variables using template engine\n   */\n  private async renderTemplate(template: string, data: Record<string, any>): Promise<string> {\n    return await this.templateEngine.render(template, data)\n  }\n\n  /**\n   * Delay execution\n   */\n  private delay(ms: number): Promise<void> {\n    return new Promise((resolve) => setTimeout(resolve, ms))\n  }\n}\n\n/**\n * Create SMS agent instance\n */\nexport function createSmsAgent(config: any): SmsAgent {\n  return new SmsAgent(config)\n}\n\n// Backward compatibility aliases\nexport const SmsMember = SmsAgent\nexport type SmsMemberConfig = SmsAgentConfig\n","/**\n * Form field validation utilities\n */\n\nimport type { FormField, ValidationError } from '../types/index.js'\nimport type { AgentExecutionContext } from '../../base-agent.js'\n\n/**\n * Validate a single field\n */\nexport async function validateField(\n  field: FormField,\n  value: unknown,\n  allData: Record<string, unknown>,\n  context: AgentExecutionContext\n): Promise<ValidationError[]> {\n  const errors: ValidationError[] = []\n\n  // Skip validation for disabled or readonly fields\n  if (field.disabled || field.readonly) {\n    return errors\n  }\n\n  const validation = field.validation\n  if (!validation) {\n    return errors\n  }\n\n  // Required validation\n  if (validation.required) {\n    if (isEmpty(value)) {\n      const message =\n        typeof validation.required === 'string'\n          ? validation.required\n          : `${field.label || field.name} is required`\n      errors.push({ field: field.name, message, rule: 'required' })\n      // If required fails, skip other validations\n      return errors\n    }\n  }\n\n  // Skip further validation if value is empty and not required\n  if (isEmpty(value)) {\n    return errors\n  }\n\n  const stringValue = String(value)\n\n  // Email validation\n  if (validation.email) {\n    if (!isValidEmail(stringValue)) {\n      const message =\n        typeof validation.email === 'string'\n          ? validation.email\n          : 'Please enter a valid email address'\n      errors.push({ field: field.name, message, rule: 'email' })\n    }\n  }\n\n  // URL validation\n  if (validation.url) {\n    if (!isValidUrl(stringValue)) {\n      const message =\n        typeof validation.url === 'string' ? validation.url : 'Please enter a valid URL'\n      errors.push({ field: field.name, message, rule: 'url' })\n    }\n  }\n\n  // Pattern validation\n  if (validation.pattern) {\n    const pattern =\n      typeof validation.pattern === 'string'\n        ? { regex: validation.pattern, message: 'Invalid format' }\n        : validation.pattern\n\n    const regex = new RegExp(pattern.regex)\n    if (!regex.test(stringValue)) {\n      errors.push({ field: field.name, message: pattern.message, rule: 'pattern' })\n    }\n  }\n\n  // Min/Max for numbers\n  if (field.type === 'number' && typeof value === 'number') {\n    if (validation.min !== undefined) {\n      const min =\n        typeof validation.min === 'number'\n          ? { value: validation.min, message: `Minimum value is ${validation.min}` }\n          : validation.min\n      if (value < min.value) {\n        errors.push({ field: field.name, message: min.message, rule: 'min' })\n      }\n    }\n\n    if (validation.max !== undefined) {\n      const max =\n        typeof validation.max === 'number'\n          ? { value: validation.max, message: `Maximum value is ${validation.max}` }\n          : validation.max\n      if (value > max.value) {\n        errors.push({ field: field.name, message: max.message, rule: 'max' })\n      }\n    }\n  }\n\n  // MinLength/MaxLength for strings\n  if (validation.minLength !== undefined) {\n    const minLength =\n      typeof validation.minLength === 'number'\n        ? { value: validation.minLength, message: `Minimum length is ${validation.minLength}` }\n        : validation.minLength\n    if (stringValue.length < minLength.value) {\n      errors.push({ field: field.name, message: minLength.message, rule: 'minLength' })\n    }\n  }\n\n  if (validation.maxLength !== undefined) {\n    const maxLength =\n      typeof validation.maxLength === 'number'\n        ? { value: validation.maxLength, message: `Maximum length is ${validation.maxLength}` }\n        : validation.maxLength\n    if (stringValue.length > maxLength.value) {\n      errors.push({ field: field.name, message: maxLength.message, rule: 'maxLength' })\n    }\n  }\n\n  // Matches validation (e.g., password confirmation)\n  if (validation.matches) {\n    const matches =\n      typeof validation.matches === 'string'\n        ? { field: validation.matches, message: 'Fields do not match' }\n        : validation.matches\n\n    const matchValue = allData[matches.field]\n    if (value !== matchValue) {\n      errors.push({ field: field.name, message: matches.message, rule: 'matches' })\n    }\n  }\n\n  // Custom validation function\n  if (validation.custom) {\n    // Custom validation would be provided in context.input.validators\n    type ValidatorFn = (\n      value: unknown,\n      allData: Record<string, unknown>,\n      field: FormField\n    ) => boolean | string | Promise<boolean | string>\n    const input = context.input as { validators?: Record<string, ValidatorFn> } | undefined\n    const customValidator = input?.validators?.[validation.custom]\n    if (typeof customValidator === 'function') {\n      const customResult = await customValidator(value, allData, field)\n      if (customResult !== true) {\n        const message = typeof customResult === 'string' ? customResult : 'Validation failed'\n        errors.push({ field: field.name, message, rule: 'custom' })\n      }\n    }\n  }\n\n  return errors\n}\n\n/**\n * Check if value is empty\n */\nfunction isEmpty(value: unknown): boolean {\n  if (value === null || value === undefined) {\n    return true\n  }\n\n  if (typeof value === 'string') {\n    return value.trim() === ''\n  }\n\n  if (Array.isArray(value)) {\n    return value.length === 0\n  }\n\n  return false\n}\n\n/**\n * Validate email format\n */\nfunction isValidEmail(email: string): boolean {\n  // RFC 5322 simplified regex\n  const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/\n  return emailRegex.test(email)\n}\n\n/**\n * Validate URL format\n */\nfunction isValidUrl(url: string): boolean {\n  try {\n    const parsed = new URL(url)\n    return parsed.protocol === 'http:' || parsed.protocol === 'https:'\n  } catch {\n    return false\n  }\n}\n","/**\n * Form HTML rendering utilities\n */\n\nimport type {\n  FormAgentConfig,\n  FormField,\n  FormStep,\n  SelectOption,\n  ValidationError,\n} from '../types/index.js'\n\nexport interface RenderOptions {\n  config: FormAgentConfig\n  fields: FormField[]\n  data: Record<string, unknown>\n  errors: ValidationError[]\n  csrfToken?: string\n  currentStep?: string\n  stepInfo?: FormStep\n}\n\n/**\n * Render complete form HTML\n */\nexport async function renderForm(options: RenderOptions): Promise<string> {\n  const { config, fields, data, errors, csrfToken, currentStep, stepInfo } = options\n\n  const style = config.style || {}\n  const classes = style.classes || {}\n\n  // Build error map for quick lookup\n  const errorMap = new Map<string, string[]>()\n  for (const error of errors) {\n    if (!errorMap.has(error.field)) {\n      errorMap.set(error.field, [])\n    }\n    errorMap.get(error.field)!.push(error.message)\n  }\n\n  // Start form\n  let html = `<form\n\t\tclass=\"${classes.form || 'conductor-form'}\"\n\t\tmethod=\"${config.method || 'POST'}\"\n\t\t${config.action ? `action=\"${escapeHtml(config.action)}\"` : ''}\n\t\tnovalidate\n\t>`\n\n  // Form title and description (use step info if in multi-step form)\n  const title = stepInfo?.title || config.title\n  const description = stepInfo?.description || config.description\n\n  if (title) {\n    html += `<h2 class=\"form-title\">${escapeHtml(title)}</h2>`\n  }\n  if (description) {\n    html += `<p class=\"form-description\">${escapeHtml(description)}</p>`\n  }\n\n  // CSRF token field\n  if (csrfToken) {\n    const csrfFieldName = config.csrf?.fieldName || '_csrf'\n    html += `<input type=\"hidden\" name=\"${escapeHtml(csrfFieldName)}\" value=\"${escapeHtml(csrfToken)}\">`\n  }\n\n  // Honeypot field\n  if (config.honeypot) {\n    html += `<input type=\"text\" name=\"${escapeHtml(config.honeypot)}\" value=\"\" style=\"position:absolute;left:-9999px;\" tabindex=\"-1\" autocomplete=\"off\" aria-hidden=\"true\">`\n  }\n\n  // Current step field (for multi-step forms)\n  if (currentStep) {\n    html += `<input type=\"hidden\" name=\"_currentStep\" value=\"${escapeHtml(currentStep)}\">`\n  }\n\n  // Render fields\n  for (const field of fields) {\n    html += renderField(field, data[field.name], errorMap.get(field.name), classes)\n  }\n\n  // CAPTCHA\n  if (config.captcha) {\n    html += renderCaptcha(config.captcha.type, config.captcha.siteKey, config.captcha)\n  }\n\n  // Submit button\n  html += `<div class=\"form-actions\">\n\t\t<button type=\"submit\" class=\"${classes.button || 'form-submit'}\">\n\t\t\t${escapeHtml(config.submitText || 'Submit')}\n\t\t</button>\n\t</div>`\n\n  html += `</form>`\n\n  // Add default styles if requested\n  if (style.includeDefaultStyles !== false) {\n    html = renderDefaultStyles() + html\n  }\n\n  return html\n}\n\n/**\n * Render a single form field\n */\nfunction renderField(\n  field: FormField,\n  value: unknown,\n  errors: string[] | undefined,\n  classes: Record<string, string>\n): string {\n  const hasError = errors && errors.length > 0\n  const fieldClass = `${classes.field || 'form-field'} ${hasError ? 'has-error' : ''}`.trim()\n\n  let html = `<div class=\"${fieldClass}\">`\n\n  // Label\n  if (field.label && field.type !== 'hidden') {\n    const required = field.validation?.required ? ' <span class=\"required\">*</span>' : ''\n    html += `<label for=\"${field.name}\" class=\"${classes.label || 'form-label'}\">\n\t\t\t${escapeHtml(field.label)}${required}\n\t\t</label>`\n  }\n\n  // Field input\n  html += renderFieldInput(field, value, classes)\n\n  // Help text\n  if (field.help) {\n    html += `<div class=\"${classes.help || 'form-help'}\">${escapeHtml(field.help)}</div>`\n  }\n\n  // Error messages\n  if (hasError) {\n    for (const error of errors!) {\n      html += `<div class=\"${classes.error || 'form-error'}\">${escapeHtml(error)}</div>`\n    }\n  }\n\n  html += `</div>`\n  return html\n}\n\n/**\n * Render field input element\n */\nfunction renderFieldInput(\n  field: FormField,\n  value: unknown,\n  classes: Record<string, string>\n): string {\n  const inputClass = `${classes.input || 'form-input'} ${field.className || ''}`.trim()\n  const commonAttrs = `\n\t\tname=\"${escapeHtml(field.name)}\"\n\t\tid=\"${field.name}\"\n\t\tclass=\"${inputClass}\"\n\t\t${field.placeholder ? `placeholder=\"${escapeHtml(field.placeholder)}\"` : ''}\n\t\t${field.disabled ? 'disabled' : ''}\n\t\t${field.readonly ? 'readonly' : ''}\n\t\t${field.autocomplete ? `autocomplete=\"${escapeHtml(field.autocomplete)}\"` : ''}\n\t`.trim()\n\n  switch (field.type) {\n    case 'textarea':\n      return `<textarea ${commonAttrs} ${field.rows ? `rows=\"${field.rows}\"` : ''} ${field.cols ? `cols=\"${field.cols}\"` : ''}>${escapeHtml(String(value || field.default || ''))}</textarea>`\n\n    case 'select':\n      return renderSelectField(field, value, commonAttrs)\n\n    case 'checkbox':\n      return renderCheckboxField(field, value, commonAttrs)\n\n    case 'radio':\n      return renderRadioField(field, value, commonAttrs)\n\n    case 'hidden':\n      return `<input type=\"hidden\" name=\"${escapeHtml(field.name)}\" value=\"${escapeHtml(String(value || field.default || ''))}\">`\n\n    default:\n      // text, email, password, number, tel, url, date, time, datetime-local, file\n      return `<input\n\t\t\t\ttype=\"${field.type}\"\n\t\t\t\t${commonAttrs}\n\t\t\t\t${field.min !== undefined ? `min=\"${field.min}\"` : ''}\n\t\t\t\t${field.max !== undefined ? `max=\"${field.max}\"` : ''}\n\t\t\t\t${field.step !== undefined ? `step=\"${field.step}\"` : ''}\n\t\t\t\t${field.accept ? `accept=\"${escapeHtml(field.accept)}\"` : ''}\n\t\t\t\tvalue=\"${escapeHtml(String(value || field.default || ''))}\"\n\t\t\t>`\n  }\n}\n\n/**\n * Render select field\n */\nfunction renderSelectField(field: FormField, value: unknown, commonAttrs: string): string {\n  let html = `<select ${commonAttrs} ${field.multiple ? 'multiple' : ''}>`\n\n  const options = normalizeOptions(field.options || [])\n  const selectedValues = field.multiple && Array.isArray(value) ? value : [value]\n\n  for (const option of options) {\n    const selected = selectedValues.includes(option.value) || option.selected\n    html += `<option value=\"${escapeHtml(option.value)}\" ${selected ? 'selected' : ''} ${option.disabled ? 'disabled' : ''}>\n\t\t\t${escapeHtml(option.label)}\n\t\t</option>`\n  }\n\n  html += `</select>`\n  return html\n}\n\n/**\n * Render checkbox field\n */\nfunction renderCheckboxField(field: FormField, value: unknown, commonAttrs: string): string {\n  const checked = Boolean(value || field.default)\n  return `<input type=\"checkbox\" ${commonAttrs} ${checked ? 'checked' : ''} value=\"true\">`\n}\n\n/**\n * Render radio field\n */\nfunction renderRadioField(field: FormField, value: unknown, commonAttrs: string): string {\n  const options = normalizeOptions(field.options || [])\n  let html = ''\n\n  for (const option of options) {\n    const checked = value === option.value || option.selected\n    html += `<label class=\"radio-option\">\n\t\t\t<input\n\t\t\t\ttype=\"radio\"\n\t\t\t\tname=\"${escapeHtml(field.name)}\"\n\t\t\t\tvalue=\"${escapeHtml(option.value)}\"\n\t\t\t\t${checked ? 'checked' : ''}\n\t\t\t\t${option.disabled ? 'disabled' : ''}\n\t\t\t>\n\t\t\t${escapeHtml(option.label)}\n\t\t</label>`\n  }\n\n  return html\n}\n\n/**\n * Normalize options to SelectOption format\n */\nfunction normalizeOptions(options: (SelectOption | string)[]): SelectOption[] {\n  return options.map((opt) => (typeof opt === 'string' ? { label: opt, value: opt } : opt))\n}\n\n/**\n * Render CAPTCHA widget\n */\nfunction renderCaptcha(\n  type: string,\n  siteKey: string,\n  config: { theme?: string; size?: string }\n): string {\n  switch (type) {\n    case 'turnstile':\n      return `<div class=\"cf-turnstile\"\n\t\t\t\tdata-sitekey=\"${escapeHtml(siteKey)}\"\n\t\t\t\tdata-theme=\"${config.theme || 'auto'}\"\n\t\t\t\tdata-size=\"${config.size || 'normal'}\">\n\t\t\t</div>\n\t\t\t<script src=\"https://challenges.cloudflare.com/turnstile/v0/api.js\" async defer></script>`\n\n    case 'recaptcha':\n      return `<div class=\"g-recaptcha\"\n\t\t\t\tdata-sitekey=\"${escapeHtml(siteKey)}\"\n\t\t\t\tdata-theme=\"${config.theme || 'light'}\"\n\t\t\t\tdata-size=\"${config.size || 'normal'}\">\n\t\t\t</div>\n\t\t\t<script src=\"https://www.google.com/recaptcha/api.js\" async defer></script>`\n\n    case 'hcaptcha':\n      return `<div class=\"h-captcha\"\n\t\t\t\tdata-sitekey=\"${escapeHtml(siteKey)}\"\n\t\t\t\tdata-theme=\"${config.theme || 'light'}\"\n\t\t\t\tdata-size=\"${config.size || 'normal'}\">\n\t\t\t</div>\n\t\t\t<script src=\"https://js.hcaptcha.com/1/api.js\" async defer></script>`\n\n    default:\n      return ''\n  }\n}\n\n/**\n * Render default form styles\n */\nfunction renderDefaultStyles(): string {\n  return `<style>\n\t\t.conductor-form {\n\t\t\tmax-width: 600px;\n\t\t\tmargin: 0 auto;\n\t\t\tpadding: 2rem;\n\t\t}\n\t\t.form-title {\n\t\t\tmargin: 0 0 0.5rem;\n\t\t\tfont-size: 1.75rem;\n\t\t\tfont-weight: 600;\n\t\t}\n\t\t.form-description {\n\t\t\tmargin: 0 0 1.5rem;\n\t\t\tcolor: #666;\n\t\t}\n\t\t.form-field {\n\t\t\tmargin-bottom: 1.5rem;\n\t\t}\n\t\t.form-label {\n\t\t\tdisplay: block;\n\t\t\tmargin-bottom: 0.5rem;\n\t\t\tfont-weight: 500;\n\t\t}\n\t\t.required {\n\t\t\tcolor: #e53e3e;\n\t\t}\n\t\t.form-input, .form-input textarea, .form-input select {\n\t\t\twidth: 100%;\n\t\t\tpadding: 0.5rem 0.75rem;\n\t\t\tborder: 1px solid #d1d5db;\n\t\t\tborder-radius: 0.375rem;\n\t\t\tfont-size: 1rem;\n\t\t\ttransition: border-color 0.15s;\n\t\t}\n\t\t.form-input:focus {\n\t\t\toutline: none;\n\t\t\tborder-color: #3b82f6;\n\t\t\tbox-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);\n\t\t}\n\t\t.form-help {\n\t\t\tmargin-top: 0.25rem;\n\t\t\tfont-size: 0.875rem;\n\t\t\tcolor: #6b7280;\n\t\t}\n\t\t.form-error {\n\t\t\tmargin-top: 0.25rem;\n\t\t\tfont-size: 0.875rem;\n\t\t\tcolor: #e53e3e;\n\t\t}\n\t\t.has-error .form-input {\n\t\t\tborder-color: #e53e3e;\n\t\t}\n\t\t.radio-option {\n\t\t\tdisplay: block;\n\t\t\tmargin-bottom: 0.5rem;\n\t\t}\n\t\t.radio-option input {\n\t\t\tmargin-right: 0.5rem;\n\t\t}\n\t\t.form-actions {\n\t\t\tmargin-top: 2rem;\n\t\t}\n\t\t.form-submit {\n\t\t\tpadding: 0.75rem 1.5rem;\n\t\t\tbackground-color: #3b82f6;\n\t\t\tcolor: white;\n\t\t\tborder: none;\n\t\t\tborder-radius: 0.375rem;\n\t\t\tfont-size: 1rem;\n\t\t\tfont-weight: 500;\n\t\t\tcursor: pointer;\n\t\t\ttransition: background-color 0.15s;\n\t\t}\n\t\t.form-submit:hover {\n\t\t\tbackground-color: #2563eb;\n\t\t}\n\t\t.form-submit:disabled {\n\t\t\topacity: 0.5;\n\t\t\tcursor: not-allowed;\n\t\t}\n\t</style>`\n}\n\n/**\n * Escape HTML special characters\n */\nfunction escapeHtml(str: string): string {\n  const map: Record<string, string> = {\n    '&': '&amp;',\n    '<': '&lt;',\n    '>': '&gt;',\n    '\"': '&quot;',\n    \"'\": '&#39;',\n  }\n  return str.replace(/[&<>\"']/g, (char) => map[char])\n}\n","/**\n * CSRF token utilities for form security\n */\n\nimport type { CsrfConfig } from '../types/index.js'\n\n/**\n * Generate a CSRF token\n */\nexport async function generateCsrfToken(\n  config: CsrfConfig,\n  env: { [key: string]: unknown }\n): Promise<string> {\n  const secret = config.secret || 'default-csrf-secret'\n  const expiresIn = config.expiresIn || 3600 // Default 1 hour\n\n  // Generate random token value\n  const tokenValue = generateRandomString(32)\n  const expiresAt = Date.now() + expiresIn * 1000\n\n  // Create token payload\n  const payload = {\n    value: tokenValue,\n    expiresAt,\n  }\n\n  // Sign the token\n  const signature = await signData(JSON.stringify(payload), secret)\n  const token = btoa(JSON.stringify({ ...payload, signature }))\n\n  // Store token in KV if available (for server-side validation)\n  const kv = env.CSRF_TOKENS as KVNamespace | undefined\n  if (kv) {\n    await kv.put(tokenValue, JSON.stringify(payload), {\n      expirationTtl: expiresIn,\n    })\n  }\n\n  return token\n}\n\n/**\n * Validate a CSRF token\n */\nexport async function validateCsrfToken(\n  token: string,\n  config: CsrfConfig,\n  env: { [key: string]: unknown }\n): Promise<boolean> {\n  if (!token) {\n    return false\n  }\n\n  try {\n    const secret = config.secret || 'default-csrf-secret'\n\n    // Decode token\n    const decoded = JSON.parse(atob(token))\n    const { value, expiresAt, signature } = decoded\n\n    // Check expiration\n    if (Date.now() > expiresAt) {\n      return false\n    }\n\n    // Verify signature\n    const payload = { value, expiresAt }\n    const expectedSignature = await signData(JSON.stringify(payload), secret)\n    if (signature !== expectedSignature) {\n      return false\n    }\n\n    // Check KV storage if available (additional verification)\n    const kv = env.CSRF_TOKENS as KVNamespace | undefined\n    if (kv) {\n      const stored = await kv.get(value)\n      if (!stored) {\n        return false\n      }\n\n      // Delete token after use (one-time use)\n      await kv.delete(value)\n    }\n\n    return true\n  } catch (error) {\n    // Invalid token format or other error\n    return false\n  }\n}\n\n/**\n * Generate a random string\n */\nfunction generateRandomString(length: number): string {\n  const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789'\n  let result = ''\n\n  // Use crypto.getRandomValues if available (browser/Worker)\n  if (typeof crypto !== 'undefined' && crypto.getRandomValues) {\n    const array = new Uint8Array(length)\n    crypto.getRandomValues(array)\n    for (let i = 0; i < length; i++) {\n      result += chars[array[i] % chars.length]\n    }\n  } else {\n    // Fallback to Math.random (less secure, for development only)\n    for (let i = 0; i < length; i++) {\n      result += chars[Math.floor(Math.random() * chars.length)]\n    }\n  }\n\n  return result\n}\n\n/**\n * Sign data using HMAC-SHA256\n */\nasync function signData(data: string, secret: string): Promise<string> {\n  // Use Web Crypto API if available\n  if (typeof crypto !== 'undefined' && crypto.subtle) {\n    const encoder = new TextEncoder()\n    const keyData = encoder.encode(secret)\n    const messageData = encoder.encode(data)\n\n    // Import key\n    const key = await crypto.subtle.importKey(\n      'raw',\n      keyData,\n      { name: 'HMAC', hash: 'SHA-256' },\n      false,\n      ['sign']\n    )\n\n    // Sign\n    const signature = await crypto.subtle.sign('HMAC', key, messageData)\n\n    // Convert to hex string\n    return Array.from(new Uint8Array(signature))\n      .map((b) => b.toString(16).padStart(2, '0'))\n      .join('')\n  }\n\n  // Fallback: simple hash (less secure, for development only)\n  return simpleHash(data + secret)\n}\n\n/**\n * Simple hash function (fallback for environments without crypto.subtle)\n */\nfunction simpleHash(str: string): string {\n  let hash = 0\n  for (let i = 0; i < str.length; i++) {\n    const char = str.charCodeAt(i)\n    hash = (hash << 5) - hash + char\n    hash = hash & hash // Convert to 32-bit integer\n  }\n  return Math.abs(hash).toString(16)\n}\n","/**\n * Rate limiting utilities for form submissions\n */\n\nimport type { RateLimitConfig } from '../types/index.js'\n\nexport interface RateLimitResult {\n  allowed: boolean\n  remaining: number\n  reset: number\n  limit: number\n}\n\n/**\n * Check rate limit for form submission\n */\nexport async function checkRateLimit(\n  identifier: string,\n  config: RateLimitConfig,\n  kv: KVNamespace | undefined\n): Promise<RateLimitResult> {\n  if (!kv) {\n    // No KV available, allow request (rate limiting disabled)\n    return {\n      allowed: true,\n      remaining: config.max,\n      reset: Date.now() + config.window * 1000,\n      limit: config.max,\n    }\n  }\n\n  const key = `rate-limit:${identifier}`\n  const now = Date.now()\n  const windowMs = config.window * 1000\n\n  // Get current rate limit data\n  const stored = await kv.get(key, 'json')\n  let data: RateLimitData\n\n  if (stored) {\n    data = stored as RateLimitData\n\n    // Check if window has expired\n    if (now > data.resetAt) {\n      // Reset window\n      data = {\n        count: 0,\n        resetAt: now + windowMs,\n      }\n    }\n  } else {\n    // First request in window\n    data = {\n      count: 0,\n      resetAt: now + windowMs,\n    }\n  }\n\n  // Check if limit exceeded\n  if (data.count >= config.max) {\n    return {\n      allowed: false,\n      remaining: 0,\n      reset: data.resetAt,\n      limit: config.max,\n    }\n  }\n\n  // Increment count\n  data.count++\n\n  // Store updated data\n  const ttl = Math.ceil((data.resetAt - now) / 1000)\n  await kv.put(key, JSON.stringify(data), {\n    expirationTtl: ttl,\n  })\n\n  return {\n    allowed: true,\n    remaining: config.max - data.count,\n    reset: data.resetAt,\n    limit: config.max,\n  }\n}\n\n/**\n * Get rate limit status without incrementing\n */\nexport async function getRateLimitStatus(\n  identifier: string,\n  config: RateLimitConfig,\n  kv: KVNamespace | undefined\n): Promise<RateLimitResult> {\n  if (!kv) {\n    return {\n      allowed: true,\n      remaining: config.max,\n      reset: Date.now() + config.window * 1000,\n      limit: config.max,\n    }\n  }\n\n  const key = `rate-limit:${identifier}`\n  const now = Date.now()\n  const windowMs = config.window * 1000\n\n  const stored = await kv.get(key, 'json')\n\n  if (!stored) {\n    return {\n      allowed: true,\n      remaining: config.max,\n      reset: now + windowMs,\n      limit: config.max,\n    }\n  }\n\n  const data = stored as RateLimitData\n\n  // Check if window has expired\n  if (now > data.resetAt) {\n    return {\n      allowed: true,\n      remaining: config.max,\n      reset: now + windowMs,\n      limit: config.max,\n    }\n  }\n\n  return {\n    allowed: data.count < config.max,\n    remaining: Math.max(0, config.max - data.count),\n    reset: data.resetAt,\n    limit: config.max,\n  }\n}\n\n/**\n * Reset rate limit for an identifier\n */\nexport async function resetRateLimit(\n  identifier: string,\n  kv: KVNamespace | undefined\n): Promise<void> {\n  if (!kv) {\n    return\n  }\n\n  const key = `rate-limit:${identifier}`\n  await kv.delete(key)\n}\n\n/**\n * Rate limit data structure\n */\ninterface RateLimitData {\n  count: number\n  resetAt: number\n}\n","/**\n * Form Agent\n *\n * Declarative form generation with:\n * - Multiple field types (text, email, select, checkbox, etc.)\n * - Server-side validation\n * - Security features (CAPTCHA, CSRF, honeypot, rate limiting)\n * - Multi-step form support\n * - Customizable styling\n */\n\nimport { BaseAgent, type AgentExecutionContext } from '../base-agent.js'\nimport type { AgentConfig } from '../../runtime/parser.js'\nimport type {\n  FormAgentConfig,\n  FormMemberInput,\n  FormMemberOutput,\n  FormField,\n  FormStep,\n  ValidationError,\n} from './types/index.js'\nimport { validateField } from './utils/validation.js'\nimport { renderForm } from './utils/renderer.js'\nimport { generateCsrfToken, validateCsrfToken } from './utils/csrf.js'\nimport { checkRateLimit } from './utils/rate-limit.js'\n\nexport class FormAgent extends BaseAgent {\n  private formConfig: FormAgentConfig\n\n  constructor(config: AgentConfig) {\n    super(config)\n    // Extract nested config (config.config contains the agent-specific settings)\n    this.formConfig = (config.config || {}) as unknown as FormAgentConfig\n\n    // Validate configuration\n    this.validateConfig()\n  }\n\n  /**\n   * Validate agent configuration\n   */\n  private validateConfig(): void {\n    // Must have either fields or steps\n    if (!this.formConfig.fields && !this.formConfig.steps) {\n      throw new Error('Form agent requires either fields or steps configuration')\n    }\n\n    // Can't have both fields and steps\n    if (this.formConfig.fields && this.formConfig.steps) {\n      throw new Error('Form agent cannot have both fields and steps - use one or the other')\n    }\n\n    // Validate CAPTCHA config if present\n    if (this.formConfig.captcha) {\n      if (!this.formConfig.captcha.siteKey) {\n        throw new Error('CAPTCHA configuration requires siteKey')\n      }\n    }\n\n    // Validate CSRF config if enabled\n    if (this.formConfig.csrf?.enabled) {\n      if (!this.formConfig.csrf.secret) {\n        throw new Error('CSRF protection requires a secret')\n      }\n    }\n  }\n\n  /**\n   * Execute form operation\n   */\n  protected async run(context: AgentExecutionContext): Promise<FormMemberOutput> {\n    const input = context.input as FormMemberInput\n    const mode = input.mode || 'render'\n\n    // Check rate limit if configured\n    if (this.formConfig.rateLimit) {\n      const identifier = input.request?.ip || 'anonymous'\n      const rateLimitResult = await checkRateLimit(\n        identifier,\n        this.formConfig.rateLimit,\n        context.env.RATE_LIMIT\n      )\n\n      if (!rateLimitResult.allowed) {\n        return {\n          valid: false,\n          errors: [\n            {\n              field: '_form',\n              message: 'Rate limit exceeded. Please try again later.',\n              rule: 'rate_limit',\n            },\n          ],\n          rateLimit: {\n            remaining: rateLimitResult.remaining,\n            reset: rateLimitResult.reset,\n          },\n        }\n      }\n    }\n\n    switch (mode) {\n      case 'render':\n        return this.renderForm(input, context)\n      case 'validate':\n        return this.validateForm(input, context)\n      case 'submit':\n        return this.submitForm(input, context)\n      default:\n        throw new Error(`Invalid form mode: ${mode}`)\n    }\n  }\n\n  /**\n   * Render form HTML\n   */\n  private async renderForm(\n    input: FormMemberInput,\n    context: AgentExecutionContext\n  ): Promise<FormMemberOutput> {\n    // Generate CSRF token if enabled\n    let csrfToken: string | undefined\n    if (this.formConfig.csrf?.enabled) {\n      csrfToken = await generateCsrfToken(this.formConfig.csrf, context.env)\n    }\n\n    // Get current step for multi-step forms\n    const currentStep = this.getCurrentStep(input)\n    const fields = this.getFieldsForStep(currentStep)\n\n    // Render form HTML\n    const html = await renderForm({\n      config: this.formConfig,\n      fields,\n      data: input.data || {},\n      csrfToken,\n      currentStep: currentStep?.id,\n      stepInfo: currentStep || undefined,\n      errors: [],\n    })\n\n    return {\n      html,\n      currentStep: currentStep?.id,\n      csrfToken,\n      valid: true,\n    }\n  }\n\n  /**\n   * Validate form data\n   */\n  private async validateForm(\n    input: FormMemberInput,\n    context: AgentExecutionContext\n  ): Promise<FormMemberOutput> {\n    const data = input.data || {}\n    const errors: ValidationError[] = []\n\n    // Check honeypot if configured\n    if (this.formConfig.honeypot && data[this.formConfig.honeypot]) {\n      // Bot detected - fail silently with generic error\n      return {\n        valid: false,\n        errors: [{ field: '_form', message: 'Form submission failed', rule: 'honeypot' }],\n      }\n    }\n\n    // Validate CSRF token if enabled\n    if (this.formConfig.csrf?.enabled) {\n      const csrfToken = data[this.formConfig.csrf.fieldName || '_csrf'] as string\n      const isValid = await validateCsrfToken(csrfToken, this.formConfig.csrf, context.env)\n      if (!isValid) {\n        errors.push({\n          field: '_csrf',\n          message: 'Invalid or expired security token',\n          rule: 'csrf',\n        })\n      }\n    }\n\n    // Get fields to validate for current step\n    const currentStep = this.getCurrentStep(input)\n    const fields = this.getFieldsForStep(currentStep)\n\n    // Validate each field\n    for (const field of fields) {\n      const value = data[field.name]\n      const fieldErrors = await validateField(field, value, data, context)\n      errors.push(...fieldErrors)\n    }\n\n    // Sanitize and normalize data\n    const sanitizedData = this.sanitizeData(data, fields)\n\n    return {\n      valid: errors.length === 0,\n      errors: errors.length > 0 ? errors : undefined,\n      data: sanitizedData,\n      currentStep: currentStep?.id,\n    }\n  }\n\n  /**\n   * Submit form (validate + return next step/completion)\n   */\n  private async submitForm(\n    input: FormMemberInput,\n    context: AgentExecutionContext\n  ): Promise<FormMemberOutput> {\n    // First validate\n    const validationResult = await this.validateForm(input, context)\n\n    if (!validationResult.valid) {\n      return validationResult\n    }\n\n    // For multi-step forms, determine next step\n    if (this.formConfig.steps) {\n      const currentStepIndex = this.formConfig.steps.findIndex(\n        (step) => step.id === input.currentStep\n      )\n      const nextStep = this.formConfig.steps[currentStepIndex + 1]\n\n      return {\n        ...validationResult,\n        currentStep: input.currentStep,\n        nextStep: nextStep?.id,\n        isLastStep: !nextStep,\n      }\n    }\n\n    // Single-step form - submission complete\n    return {\n      ...validationResult,\n      isLastStep: true,\n    }\n  }\n\n  /**\n   * Get current step for multi-step forms\n   */\n  private getCurrentStep(input: FormMemberInput): FormStep | null {\n    if (!this.formConfig.steps) {\n      return null\n    }\n\n    // If currentStep specified, find it\n    if (input.currentStep) {\n      const step = this.formConfig.steps.find((s) => s.id === input.currentStep)\n      if (step) return step\n    }\n\n    // Default to first step\n    return this.formConfig.steps[0]\n  }\n\n  /**\n   * Get fields for current step or all fields\n   */\n  private getFieldsForStep(step: FormStep | null): FormField[] {\n    if (step) {\n      return step.fields\n    }\n    return this.formConfig.fields || []\n  }\n\n  /**\n   * Sanitize form data\n   */\n  private sanitizeData(\n    data: Record<string, unknown>,\n    fields: FormField[]\n  ): Record<string, unknown> {\n    const sanitized: Record<string, unknown> = {}\n\n    for (const field of fields) {\n      const value = data[field.name]\n\n      if (value === undefined || value === null) {\n        continue\n      }\n\n      // Type-specific sanitization\n      switch (field.type) {\n        case 'email':\n          sanitized[field.name] = String(value).toLowerCase().trim()\n          break\n        case 'number':\n          sanitized[field.name] = Number(value)\n          break\n        case 'checkbox':\n          sanitized[field.name] = Boolean(value)\n          break\n        case 'select':\n          if (field.multiple && Array.isArray(value)) {\n            sanitized[field.name] = value.map((v) => String(v).trim())\n          } else {\n            sanitized[field.name] = String(value).trim()\n          }\n          break\n        case 'textarea':\n        case 'text':\n        case 'password':\n        case 'tel':\n        case 'url':\n        default:\n          sanitized[field.name] = String(value).trim()\n      }\n    }\n\n    return sanitized\n  }\n}\n","/**\n * Template Loader\n *\n * Handles loading templates from various sources:\n * - Inline strings\n * - KV storage (Edgit-versioned templates)\n * - R2 storage (static templates)\n * - File system (development)\n */\n\nimport type { TemplateSource, TemplateLoadResult, TemplateEngine } from '../types/index.js'\n\n/**\n * Detect template engine from file extension or content (Workers-compatible)\n * Note: Only supports 'simple' and 'liquid' - both work in Workers without eval()\n */\nexport function detectTemplateEngine(key: string, content?: string): TemplateEngine {\n  // Check file extension\n  if (key.endsWith('.liquid')) {\n    return 'liquid'\n  }\n\n  // Check content for Liquid syntax\n  if (content && /\\{%.*%\\}/.test(content)) {\n    return 'liquid'\n  }\n\n  // Default to simple template engine (Workers-compatible, supports {{variable}}, {{#if}}, {{#each}})\n  return 'simple'\n}\n\n/**\n * Load template from configured source\n */\nexport async function loadTemplate(\n  source: TemplateSource,\n  env?: { TEMPLATES?: KVNamespace; ASSETS?: R2Bucket }\n): Promise<TemplateLoadResult> {\n  // Inline template\n  if (source.inline) {\n    const engine = source.engine || detectTemplateEngine('inline', source.inline)\n    return {\n      content: source.inline,\n      engine,\n      source: 'inline',\n    }\n  }\n\n  // KV template (Edgit-versioned)\n  if (source.kv) {\n    if (!env?.TEMPLATES) {\n      throw new Error('KV namespace TEMPLATES is not configured')\n    }\n\n    const content = await env.TEMPLATES.get(source.kv, 'text')\n\n    if (!content) {\n      throw new Error(`Template not found in KV: ${source.kv}`)\n    }\n\n    const engine = source.engine || detectTemplateEngine(source.kv, content)\n    return {\n      content,\n      engine,\n      source: 'kv',\n    }\n  }\n\n  // R2 template (static assets)\n  if (source.r2) {\n    if (!env?.ASSETS) {\n      throw new Error('R2 bucket ASSETS is not configured')\n    }\n\n    const object = await env.ASSETS.get(source.r2)\n\n    if (!object) {\n      throw new Error(`Template not found in R2: ${source.r2}`)\n    }\n\n    const content = await object.text()\n    const engine = source.engine || detectTemplateEngine(source.r2, content)\n    return {\n      content,\n      engine,\n      source: 'r2',\n    }\n  }\n\n  // File template (development only - not available in Workers)\n  if (source.file) {\n    throw new Error(\n      'File-based templates are not supported in Cloudflare Workers. ' +\n        'Use inline, KV (TEMPLATES), or R2 (ASSETS) instead.'\n    )\n  }\n\n  throw new Error('No valid template source specified (inline, kv, or r2)')\n}\n\n/**\n * Validate template source configuration\n */\nexport function validateTemplateSource(source: TemplateSource): {\n  valid: boolean\n  errors?: string[]\n} {\n  const errors: string[] = []\n  const sourceCount = [source.inline, source.kv, source.r2, source.file].filter(Boolean).length\n\n  if (sourceCount === 0) {\n    errors.push('No template source specified (must provide inline, kv, r2, or file)')\n  }\n\n  if (sourceCount > 1) {\n    errors.push('Multiple template sources specified (provide only one: inline, kv, r2, or file)')\n  }\n\n  return {\n    valid: errors.length === 0,\n    errors: errors.length > 0 ? errors : undefined,\n  }\n}\n\n/**\n * Normalize template source from string or object\n */\nexport function normalizeTemplateSource(source: string | TemplateSource): TemplateSource {\n  if (typeof source === 'string') {\n    // Detect source type from string format\n    if (source.startsWith('kv://')) {\n      return { kv: source.slice(5) }\n    }\n    if (source.startsWith('r2://')) {\n      return { r2: source.slice(5) }\n    }\n    if (source.startsWith('file://')) {\n      return { file: source.slice(7) }\n    }\n    // Default to inline\n    return { inline: source }\n  }\n\n  return source\n}\n\n/**\n * Cache key for template loading\n */\nexport function getTemplateCacheKey(source: TemplateSource): string | null {\n  if (source.kv) {\n    return `template:kv:${source.kv}`\n  }\n  if (source.r2) {\n    return `template:r2:${source.r2}`\n  }\n  // Don't cache inline templates\n  return null\n}\n","/**\n * Component Loader\n *\n * Unified loader for all Edgit components:\n * - Templates (HTML/Handlebars)\n * - Prompts (AI instructions)\n * - Queries (SQL)\n * - Configs (JSON settings)\n * - Scripts (JavaScript/TypeScript)\n * - Schemas (JSON Schema definitions)\n * - Docs (Markdown documentation)\n *\n * URI Format: {protocol}://{path}[@{version}]\n * Version defaults to \"latest\" if not specified.\n *\n * Examples:\n * - template://components/header           templates/components/header@latest\n * - template://components/header@latest    templates/components/header@latest\n * - template://components/header@v1.0.0    templates/components/header@v1.0.0\n * - prompt://analyze-company@prod          prompts/analyze-company@prod\n * - script://transform-data@v1.0.0         scripts/transform-data@v1.0.0\n * - schema://invoice@latest                schemas/invoice@latest\n * - docs://getting-started@latest          docs/getting-started@latest\n *\n * Cache Configuration:\n * - Default: All components cached for 1 hour (3600 seconds)\n * - Custom TTL: Pass options.cache.ttl for custom duration\n * - Bypass: Pass options.cache.bypass = true to skip cache\n *\n * Examples:\n * - await loader.load(uri)                        // Default 1h cache\n * - await loader.load(uri, { cache: { ttl: 7200 }}) // 2h cache\n * - await loader.load(uri, { cache: { bypass: true }}) // No cache\n */\n\nimport type { Cache } from '../cache/cache.js'\nimport type { Logger } from '../observability/types.js'\nimport { Result } from '../types/result.js'\n\nexport type ComponentProtocol =\n  | 'template' // Handlebars/HTML templates\n  | 'prompt' // AI prompts for Think agents\n  | 'query' // SQL queries for Data agents\n  | 'config' // Configuration objects\n  | 'script' // JavaScript/TypeScript scripts\n  | 'schema' // JSON Schema definitions\n  | 'docs' // Markdown documentation files\n\nexport interface ParsedComponentURI {\n  protocol: ComponentProtocol\n  path: string\n  version: string\n  originalURI: string\n}\n\nexport interface ComponentLoaderOptions {\n  kv: KVNamespace\n  cache?: Cache<string>\n  logger?: Logger\n  defaultVersion?: string\n}\n\nexport interface ComponentLoadOptions {\n  cache?: {\n    ttl?: number // Cache duration in seconds\n    bypass?: boolean // Skip cache for this load\n  }\n}\n\nexport class ComponentLoader {\n  private kv: KVNamespace\n  private cache?: Cache<string>\n  private logger?: Logger\n  private defaultVersion: string\n\n  constructor(options: ComponentLoaderOptions) {\n    this.kv = options.kv\n    this.cache = options.cache\n    this.logger = options.logger\n    this.defaultVersion = options.defaultVersion || 'latest'\n  }\n\n  /**\n   * Parse component URI\n   *\n   * Supports:\n   * - template://components/header          (defaults to @latest)\n   * - template://components/header@latest\n   * - template://components/header@v1.0.0\n   * - prompt://analyze-company@prod\n   */\n  parseURI(uri: string): ParsedComponentURI {\n    // Match: protocol://path or protocol://path@version\n    const match = uri.match(/^(\\w+):\\/\\/([^@]+)(?:@(.+))?$/)\n\n    if (!match) {\n      throw new Error(\n        `Invalid component URI: ${uri}\\n` +\n          `Expected format: {protocol}://{path}[@{version}]\\n` +\n          `Examples:\\n` +\n          `  - template://components/header\\n` +\n          `  - template://components/header@latest\\n` +\n          `  - prompt://analyze-company@v1.0.0`\n      )\n    }\n\n    const [, protocol, path, version] = match\n\n    // Validate protocol\n    const validProtocols: ComponentProtocol[] = [\n      'template',\n      'prompt',\n      'query',\n      'config',\n      'script',\n      'schema',\n      'docs',\n    ]\n\n    if (!validProtocols.includes(protocol as ComponentProtocol)) {\n      throw new Error(\n        `Invalid protocol: ${protocol}\\n` + `Valid protocols: ${validProtocols.join(', ')}`\n      )\n    }\n\n    return {\n      protocol: protocol as ComponentProtocol,\n      path,\n      version: version || this.defaultVersion, // Default to \"latest\"\n      originalURI: uri,\n    }\n  }\n\n  /**\n   * Map protocol to KV key prefix\n   */\n  private getPrefix(protocol: ComponentProtocol): string {\n    const prefixMap: Record<ComponentProtocol, string> = {\n      template: 'templates',\n      prompt: 'prompts',\n      query: 'queries',\n      config: 'configs',\n      script: 'scripts',\n      schema: 'schemas',\n      docs: 'docs',\n    }\n    return prefixMap[protocol]\n  }\n\n  /**\n   * Build KV key from parsed URI\n   */\n  private buildKVKey(parsed: ParsedComponentURI): string {\n    const prefix = this.getPrefix(parsed.protocol)\n    return `${prefix}/${parsed.path}@${parsed.version}`\n  }\n\n  /**\n   * Build cache key for component\n   */\n  private buildCacheKey(uri: string): string {\n    return `components:${uri}`\n  }\n\n  /**\n   * Load component content from KV with standard Conductor caching\n   */\n  async load(uri: string, options?: ComponentLoadOptions): Promise<string> {\n    const cacheKey = this.buildCacheKey(uri)\n    const bypass = options?.cache?.bypass ?? false\n    const ttl = options?.cache?.ttl ?? 3600\n\n    // Check standard Conductor cache first (unless bypassed)\n    if (this.cache && !bypass) {\n      const cacheResult = await this.cache.get(cacheKey)\n      if (cacheResult.success && cacheResult.value !== null) {\n        this.logger?.debug('Component cache hit', { uri, cacheKey })\n        return cacheResult.value\n      }\n    }\n\n    // Parse URI\n    const parsed = this.parseURI(uri)\n    const kvKey = this.buildKVKey(parsed)\n\n    // Load from KV\n    this.logger?.debug('Loading component from KV', { uri, kvKey, bypass })\n    const content = await this.kv.get(kvKey, 'text')\n\n    if (!content) {\n      this.logger?.warn('Component not found', { uri, kvKey })\n      throw new Error(\n        `Component not found: ${uri}\\n` +\n          `KV key: ${kvKey}\\n` +\n          `Make sure the component is deployed to KV with:\\n` +\n          `  edgit components add <name> <path> ${parsed.protocol}\\n` +\n          `  edgit tag create <name> ${parsed.version}\\n` +\n          `  edgit deploy set <name> ${parsed.version} --to production`\n      )\n    }\n\n    // Cache using standard Conductor cache (unless bypassed)\n    if (this.cache && !bypass) {\n      const cacheResult = await this.cache.set(cacheKey, content, { ttl })\n      if (cacheResult.success) {\n        this.logger?.debug('Component cached', { uri, cacheKey, ttl })\n      }\n    }\n\n    return content\n  }\n\n  /**\n   * Load and parse JSON component\n   */\n  async loadJSON<T = any>(uri: string, options?: ComponentLoadOptions): Promise<T> {\n    const content = await this.load(uri, options)\n    try {\n      return JSON.parse(content)\n    } catch (error) {\n      const err = error instanceof Error ? error : new Error(String(error))\n      this.logger?.error('JSON parse error', err, { uri })\n      throw new Error(`Failed to parse JSON component: ${uri}\\n` + `Error: ${err.message}`)\n    }\n  }\n\n  /**\n   * Load and evaluate compiled component (for JSX components/pages)\n   *\n   * @deprecated This method uses new Function() which is blocked in Cloudflare Workers.\n   * For scripts, use the ScriptLoader with bundled scripts instead:\n   *\n   * ```typescript\n   * import { scriptsMap } from 'virtual:conductor-scripts'\n   * import { createScriptLoader } from '@ensemble-edge/conductor'\n   *\n   * const loader = createScriptLoader(scriptsMap)\n   * const handler = loader.resolve('script://my-script')\n   * ```\n   *\n   * For other compiled components, bundle them at build time using Vite plugins.\n   */\n  async loadCompiled<T = any>(uri: string, options?: ComponentLoadOptions): Promise<T> {\n    // Log deprecation warning\n    this.logger?.warn('loadCompiled() is deprecated and will not work in Cloudflare Workers', {\n      uri,\n    })\n\n    const content = await this.load(uri, options)\n\n    try {\n      // Compiled components are stored as ES module exports\n      // We wrap in a function and evaluate\n      // NOTE: This uses new Function() which is blocked in Cloudflare Workers\n      const module = new Function('exports', content)\n      const exports: any = {}\n      module(exports)\n\n      // Return default export or entire exports object\n      return (exports.default || exports) as T\n    } catch (error) {\n      const err = error instanceof Error ? error : new Error(String(error))\n      this.logger?.error('Component compilation error', err, { uri })\n      throw new Error(\n        `Failed to load compiled component: ${uri}\\n` +\n          `Error: ${err.message}\\n\\n` +\n          `Note: This method uses new Function() which is blocked in Cloudflare Workers.\\n` +\n          `For Workers compatibility, use bundled scripts via script:// URIs instead.\\n` +\n          `See: https://docs.ensemble.ai/conductor/guides/migrate-inline-code`\n      )\n    }\n  }\n\n  /**\n   * Check if a component exists in KV\n   */\n  async exists(uri: string): Promise<boolean> {\n    try {\n      const parsed = this.parseURI(uri)\n      const kvKey = this.buildKVKey(parsed)\n      const metadata = await this.kv.getWithMetadata(kvKey)\n      return metadata.value !== null\n    } catch (error) {\n      this.logger?.debug('Component exists check failed', { uri, error })\n      return false\n    }\n  }\n\n  /**\n   * List all versions of a component\n   */\n  async listVersions(protocol: ComponentProtocol, path: string): Promise<string[]> {\n    const prefix = this.getPrefix(protocol)\n    const listPrefix = `${prefix}/${path}@`\n\n    const list = await this.kv.list({ prefix: listPrefix })\n\n    return list.keys.map((key) => {\n      // Extract version from key: \"templates/components/header@v1.0.0\"\n      const match = key.name.match(/@(.+)$/)\n      return match ? match[1] : 'unknown'\n    })\n  }\n\n  /**\n   * Invalidate cache for a component\n   */\n  async invalidateCache(uri: string): Promise<void> {\n    if (this.cache) {\n      const cacheKey = this.buildCacheKey(uri)\n      const result = await this.cache.delete(cacheKey)\n      if (result.success) {\n        this.logger?.info('Component cache invalidated', { uri, cacheKey })\n      }\n    }\n  }\n}\n\n/**\n * Create a ComponentLoader instance\n */\nexport function createComponentLoader(options: ComponentLoaderOptions): ComponentLoader {\n  return new ComponentLoader(options)\n}\n","/**\n * Cookie Utilities\n *\n * Handles cookie parsing, serialization, and signing.\n */\n\nimport type { Cookie, CookieOptions, ParsedCookie } from '../types/index.js'\n\n/**\n * Parse cookies from Cookie header string\n */\nexport function parseCookies(cookieHeader: string): Record<string, string> {\n  const cookies: Record<string, string> = {}\n\n  if (!cookieHeader) {\n    return cookies\n  }\n\n  const pairs = cookieHeader.split(';')\n\n  for (const pair of pairs) {\n    const [name, ...valueParts] = pair.split('=')\n    const trimmedName = name?.trim()\n    const value = valueParts.join('=').trim()\n\n    if (trimmedName && value) {\n      cookies[trimmedName] = decodeURIComponent(value)\n    }\n  }\n\n  return cookies\n}\n\n/**\n * Serialize a cookie to Set-Cookie header format\n */\nexport function serializeCookie(name: string, value: string, options: CookieOptions = {}): string {\n  const pairs: string[] = [`${encodeURIComponent(name)}=${encodeURIComponent(value)}`]\n\n  if (options.maxAge !== undefined) {\n    pairs.push(`Max-Age=${options.maxAge}`)\n  }\n\n  if (options.expires) {\n    pairs.push(`Expires=${options.expires.toUTCString()}`)\n  }\n\n  if (options.domain) {\n    pairs.push(`Domain=${options.domain}`)\n  }\n\n  if (options.path) {\n    pairs.push(`Path=${options.path}`)\n  } else {\n    pairs.push('Path=/')\n  }\n\n  if (options.secure) {\n    pairs.push('Secure')\n  }\n\n  if (options.httpOnly) {\n    pairs.push('HttpOnly')\n  }\n\n  if (options.sameSite) {\n    const sameSite = options.sameSite.charAt(0).toUpperCase() + options.sameSite.slice(1)\n    pairs.push(`SameSite=${sameSite}`)\n  }\n\n  return pairs.join('; ')\n}\n\n/**\n * Sign a cookie value using HMAC-SHA256\n */\nexport async function signCookie(value: string, secret: string): Promise<string> {\n  const encoder = new TextEncoder()\n  const key = await crypto.subtle.importKey(\n    'raw',\n    encoder.encode(secret),\n    { name: 'HMAC', hash: 'SHA-256' },\n    false,\n    ['sign']\n  )\n\n  const signature = await crypto.subtle.sign('HMAC', key, encoder.encode(value))\n  const signatureBase64 = btoa(String.fromCharCode(...new Uint8Array(signature)))\n\n  return `${value}.${signatureBase64}`\n}\n\n/**\n * Verify and unsign a cookie value\n */\nexport async function unsignCookie(\n  signedValue: string,\n  secret: string\n): Promise<ParsedCookie | null> {\n  const lastDotIndex = signedValue.lastIndexOf('.')\n\n  if (lastDotIndex === -1) {\n    return null\n  }\n\n  const value = signedValue.slice(0, lastDotIndex)\n  const signatureBase64 = signedValue.slice(lastDotIndex + 1)\n\n  try {\n    const expectedSigned = await signCookie(value, secret)\n    const expectedSignature = expectedSigned.slice(expectedSigned.lastIndexOf('.') + 1)\n\n    if (signatureBase64 === expectedSignature) {\n      return { name: '', value, valid: true }\n    }\n\n    return { name: '', value, valid: false }\n  } catch {\n    return null\n  }\n}\n\n/**\n * Create a Set-Cookie header for a cookie\n */\nexport async function createSetCookieHeader(cookie: Cookie, secret?: string): Promise<string> {\n  let value = cookie.value\n\n  // Sign the cookie if requested and secret is provided\n  if (cookie.options?.signed && secret) {\n    value = await signCookie(value, secret)\n  }\n\n  return serializeCookie(cookie.name, value, cookie.options)\n}\n\n/**\n * Create a deletion cookie (expires in the past)\n */\nexport function createDeleteCookie(name: string, options: Partial<CookieOptions> = {}): string {\n  return serializeCookie(name, '', {\n    ...options,\n    expires: new Date(0),\n    maxAge: 0,\n  })\n}\n\n/**\n * Parse and verify signed cookies\n */\nexport async function parseSignedCookies(\n  cookies: Record<string, string>,\n  secret: string\n): Promise<Record<string, ParsedCookie>> {\n  const parsed: Record<string, ParsedCookie> = {}\n\n  for (const [name, value] of Object.entries(cookies)) {\n    const unsigned = await unsignCookie(value, secret)\n\n    if (unsigned) {\n      parsed[name] = { ...unsigned, name }\n    } else {\n      // Not a signed cookie, return as-is\n      parsed[name] = { name, value, valid: undefined }\n    }\n  }\n\n  return parsed\n}\n\n/**\n * Validate cookie name (RFC 6265)\n */\nexport function isValidCookieName(name: string): boolean {\n  // Cookie names can't contain: ( ) < > @ , ; : \\ \" / [ ] ? = { }\n  const invalidChars = /[()<>@,;:\\\\\"\\/\\[\\]?={}]/\n  return name.length > 0 && !invalidChars.test(name)\n}\n\n/**\n * Validate cookie value\n */\nexport function isValidCookieValue(value: string): boolean {\n  // Cookie values can be any US-ASCII characters excluding control chars, whitespace, \", comma, semicolon, and backslash\n  // We'll encode these, so this is mostly a sanity check\n  return value !== null && value !== undefined\n}\n\n/**\n * Merge cookie options with defaults\n */\nexport function mergeCookieOptions(\n  options: CookieOptions | undefined,\n  defaults: CookieOptions | undefined\n): CookieOptions {\n  return {\n    ...defaults,\n    ...options,\n  }\n}\n","/**\n * HTML Agent\n *\n * Renders HTML templates with support for:\n * - Multiple template engines (Simple, Handlebars, Liquid, MJML)\n * - Template loading from KV, R2, or inline\n * - Cookie management (set, read, delete, signed cookies)\n * - CSS inlining for email compatibility\n * - HTML minification\n */\n\nimport { BaseAgent, type AgentExecutionContext } from '../base-agent.js'\nimport type { AgentConfig } from '../../runtime/parser.js'\nimport type {\n  HtmlAgentConfig,\n  HtmlAgentInput,\n  HtmlAgentOutput,\n  Cookie,\n  TemplateContext,\n} from './types/index.js'\nimport { loadTemplate, normalizeTemplateSource } from './utils/template-loader.js'\nimport { createTemplateEngine, SimpleTemplateEngine } from '../../utils/templates/index.js'\nimport { createComponentLoader } from '../../runtime/component-loader.js'\nimport {\n  parseCookies,\n  createSetCookieHeader,\n  createDeleteCookie,\n  parseSignedCookies,\n  isValidCookieName,\n  mergeCookieOptions,\n} from './utils/cookies.js'\n\nexport class HtmlAgent extends BaseAgent {\n  private htmlConfig: HtmlAgentConfig\n\n  constructor(config: AgentConfig) {\n    super(config)\n    // Extract nested config (config.config contains the agent-specific settings)\n    const rawConfig = (config.config || {}) as Record<string, unknown>\n\n    // Normalize the template configuration\n    // YAML configs use `template: \"<content>\"` with `templateEngine: \"liquid\"`\n    // But the type expects `template: { inline: \"<content>\", engine: \"liquid\" }`\n    this.htmlConfig = this.normalizeConfig(rawConfig)\n\n    // Validate configuration\n    this.validateConfig()\n  }\n\n  /**\n   * Normalize YAML config format to typed config\n   *\n   * Handles the common YAML pattern:\n   *   config:\n   *     templateEngine: liquid\n   *     template: |\n   *       <html>...\n   *\n   * Converts to:\n   *   template: { inline: \"<html>...\", engine: \"liquid\" }\n   */\n  private normalizeConfig(rawConfig: Record<string, unknown>): HtmlAgentConfig {\n    const { template, templateEngine, ...rest } = rawConfig\n\n    // If template is already a TemplateSource object, use it as-is\n    if (template && typeof template === 'object' && !Array.isArray(template)) {\n      const templateObj = template as Record<string, unknown>\n      // Check if it has TemplateSource properties (inline, kv, r2, file)\n      if (\n        'inline' in templateObj ||\n        'kv' in templateObj ||\n        'r2' in templateObj ||\n        'file' in templateObj\n      ) {\n        // Apply templateEngine if specified at top level but not in template object\n        if (templateEngine && !templateObj.engine) {\n          templateObj.engine = templateEngine\n        }\n        return {\n          ...rest,\n          template: templateObj,\n        } as HtmlAgentConfig\n      }\n    }\n\n    // If template is a string, convert to { inline: template }\n    if (typeof template === 'string') {\n      return {\n        ...rest,\n        template: {\n          inline: template,\n          engine: templateEngine as HtmlAgentConfig['template']['engine'],\n        },\n      } as HtmlAgentConfig\n    }\n\n    // Fallback: return as-is and let validation catch issues\n    return rawConfig as unknown as HtmlAgentConfig\n  }\n\n  /**\n   * Validate agent configuration\n   */\n  private validateConfig(): void {\n    if (!this.htmlConfig.template) {\n      throw new Error('HTML agent requires a template configuration')\n    }\n  }\n\n  /**\n   * Execute HTML rendering\n   */\n  protected async run(context: AgentExecutionContext): Promise<HtmlAgentOutput> {\n    const startTime = Date.now()\n    const input = context.input as HtmlAgentInput\n\n    // Load template\n    const templateSource = input.template\n      ? normalizeTemplateSource(input.template)\n      : this.htmlConfig.template\n\n    const templateResult = await loadTemplate(templateSource, {\n      TEMPLATES: context.env.KV,\n      ASSETS: context.env.STORAGE,\n    })\n\n    // Parse request cookies if provided\n    const requestCookies = input.cookies || {}\n    let readCookies: Record<string, string> = {}\n\n    if (Object.keys(requestCookies).length > 0) {\n      if (this.htmlConfig.cookieSecret) {\n        // Parse and verify signed cookies\n        const parsed = await parseSignedCookies(requestCookies, this.htmlConfig.cookieSecret)\n        readCookies = Object.entries(parsed).reduce(\n          (acc, [name, cookie]) => {\n            acc[name] = cookie.value\n            return acc\n          },\n          {} as Record<string, string>\n        )\n      } else {\n        readCookies = requestCookies\n      }\n    }\n\n    // Render template\n    const engine = createTemplateEngine(templateResult.engine)\n\n    // Set up ComponentLoader for component/partial support\n    if (context.env.COMPONENTS && engine instanceof SimpleTemplateEngine) {\n      // Create cache instance if CACHE binding exists\n      let cache\n      if (context.env.CACHE) {\n        const { MemoryCache } = await import('../../cache/cache.js')\n        cache = new MemoryCache({\n          defaultTTL: 3600,\n        })\n      }\n\n      const componentLoader = createComponentLoader({\n        kv: context.env.COMPONENTS,\n        cache,\n        logger: context.logger,\n      })\n      engine.setComponentLoader(componentLoader)\n    }\n\n    const templateContext: TemplateContext = {\n      data: {\n        ...input.data,\n        // Add cookies to template data\n        cookies: readCookies,\n      },\n      helpers: this.getDefaultHelpers(),\n      partials: {},\n    }\n\n    let html = await engine.render(templateResult.content, templateContext)\n\n    // Apply layout if specified\n    if (input.layout && engine instanceof SimpleTemplateEngine) {\n      const layoutContent = await this.loadLayoutContent(input.layout, context, engine)\n      if (layoutContent) {\n        // Render layout with content inserted\n        html = await engine.render(layoutContent, {\n          data: {\n            ...templateContext.data,\n            content: html, // Make rendered HTML available as {{content}}\n          },\n          helpers: templateContext.helpers,\n          partials: templateContext.partials,\n        })\n      }\n    }\n\n    // Apply render options\n    const renderOptions = { ...this.htmlConfig.renderOptions, ...input.renderOptions }\n\n    if (renderOptions?.inlineCss) {\n      html = await this.inlineCss(html)\n    }\n\n    if (renderOptions?.minify) {\n      html = this.minifyHtml(html)\n    }\n\n    // Process cookies to set\n    const setCookieHeaders: string[] = []\n\n    if (input.setCookies && input.setCookies.length > 0) {\n      for (const cookie of input.setCookies) {\n        if (!isValidCookieName(cookie.name)) {\n          throw new Error(`Invalid cookie name: ${cookie.name}`)\n        }\n\n        const options = mergeCookieOptions(cookie.options, this.htmlConfig.defaultCookieOptions)\n        const header = await createSetCookieHeader(\n          { ...cookie, options },\n          this.htmlConfig.cookieSecret\n        )\n        setCookieHeaders.push(header)\n      }\n    }\n\n    // Process cookies to delete\n    if (input.deleteCookies && input.deleteCookies.length > 0) {\n      for (const cookieName of input.deleteCookies) {\n        const deleteHeader = createDeleteCookie(cookieName, this.htmlConfig.defaultCookieOptions)\n        setCookieHeaders.push(deleteHeader)\n      }\n    }\n\n    const renderTime = Date.now() - startTime\n\n    return {\n      html,\n      cookies: setCookieHeaders.length > 0 ? setCookieHeaders : undefined,\n      readCookies: Object.keys(readCookies).length > 0 ? readCookies : undefined,\n      engine: templateResult.engine,\n      metadata: {\n        renderTime,\n        templateSize: templateResult.content.length,\n        outputSize: html.length,\n        cssInlined: renderOptions?.inlineCss || false,\n        minified: renderOptions?.minify || false,\n      },\n    }\n  }\n\n  /**\n   * Load layout content from ComponentLoader or registered partial\n   */\n  private async loadLayoutContent(\n    layout: string,\n    context: AgentExecutionContext,\n    engine: SimpleTemplateEngine\n  ): Promise<string | null> {\n    // Check if it's a URI (contains ://)\n    if (layout.includes('://')) {\n      // Load from ComponentLoader\n      if (context.env.COMPONENTS) {\n        // Create cache instance if CACHE binding exists\n        let cache\n        if (context.env.CACHE) {\n          const { MemoryCache } = await import('../../cache/cache.js')\n          cache = new MemoryCache({\n            defaultTTL: 3600,\n          })\n        }\n\n        const componentLoader = createComponentLoader({\n          kv: context.env.COMPONENTS,\n          cache,\n          logger: context.logger,\n        })\n        try {\n          return await componentLoader.load(layout)\n        } catch (error) {\n          context.logger?.warn('Failed to load layout', {\n            layout,\n            error: error instanceof Error ? error.message : String(error),\n          })\n          return null\n        }\n      }\n    }\n\n    // If not a URI, it might be a registered partial name\n    // For now, return null and let the caller handle\n    return null\n  }\n\n  /**\n   * Get default template helpers\n   */\n  private getDefaultHelpers(): Record<string, (...args: unknown[]) => unknown> {\n    return {\n      // Date formatting\n      formatDate: (date: unknown, format?: unknown) => {\n        const d = typeof date === 'string' ? new Date(date) : (date as Date)\n        return d.toLocaleDateString('en-US', {\n          year: 'numeric',\n          month: 'long',\n          day: 'numeric',\n        })\n      },\n\n      // String helpers\n      uppercase: (str: unknown) => String(str).toUpperCase(),\n      lowercase: (str: unknown) => String(str).toLowerCase(),\n      capitalize: (str: unknown) => {\n        const s = String(str)\n        return s.charAt(0).toUpperCase() + s.slice(1)\n      },\n\n      // Number formatting\n      currency: (amount: unknown, currency: unknown = 'USD') => {\n        return new Intl.NumberFormat('en-US', {\n          style: 'currency',\n          currency: String(currency),\n        }).format(Number(amount))\n      },\n\n      // Conditional helpers\n      eq: (a: unknown, b: unknown) => a === b,\n      ne: (a: unknown, b: unknown) => a !== b,\n      lt: (a: unknown, b: unknown) => Number(a) < Number(b),\n      gt: (a: unknown, b: unknown) => Number(a) > Number(b),\n      and: (...args: unknown[]) => args.every(Boolean),\n      or: (...args: unknown[]) => args.some(Boolean),\n    }\n  }\n\n  /**\n   * Inline CSS for email compatibility\n   * Simple implementation - for production use a library like juice\n   */\n  private async inlineCss(html: string): Promise<string> {\n    // Extract <style> tags\n    const styleRegex = /<style[^>]*>([\\s\\S]*?)<\\/style>/gi\n    const styles: string[] = []\n    let match\n\n    while ((match = styleRegex.exec(html)) !== null) {\n      styles.push(match[1])\n    }\n\n    if (styles.length === 0) {\n      return html\n    }\n\n    // Simple CSS inlining (basic implementation)\n    // In production, use a library like juice for proper CSS parsing\n    let result = html\n\n    for (const style of styles) {\n      // Parse simple CSS rules (class and id selectors only)\n      const rules = style.match(/([.#][\\w-]+)\\s*\\{([^}]+)\\}/g)\n\n      if (rules) {\n        for (const rule of rules) {\n          const [, selector, properties] = rule.match(/([.#][\\w-]+)\\s*\\{([^}]+)\\}/) || []\n\n          if (selector && properties) {\n            const trimmedProps = properties.trim()\n\n            // Apply to elements with matching class or id\n            if (selector.startsWith('.')) {\n              const className = selector.slice(1)\n              const classRegex = new RegExp(\n                `(<[^>]*class=[\"'][^\"']*\\\\b${className}\\\\b[^\"']*[\"'][^>]*)(>)`,\n                'g'\n              )\n              result = result.replace(classRegex, `$1 style=\"${trimmedProps}\"$2`)\n            } else if (selector.startsWith('#')) {\n              const idName = selector.slice(1)\n              const idRegex = new RegExp(`(<[^>]*id=[\"']${idName}[\"'][^>]*)(>)`, 'g')\n              result = result.replace(idRegex, `$1 style=\"${trimmedProps}\"$2`)\n            }\n          }\n        }\n      }\n    }\n\n    // Remove <style> tags after inlining\n    result = result.replace(styleRegex, '')\n\n    return result\n  }\n\n  /**\n   * Minify HTML (basic implementation)\n   */\n  private minifyHtml(html: string): string {\n    return (\n      html\n        // Remove comments\n        .replace(/<!--[\\s\\S]*?-->/g, '')\n        // Remove whitespace between tags\n        .replace(/>\\s+</g, '><')\n        // Remove leading/trailing whitespace\n        .trim()\n    )\n  }\n}\n\n// Backward compatibility aliases\nexport const HtmlMember = HtmlAgent\nexport type HtmlMemberConfig = HtmlAgentConfig\nexport type HtmlMemberInput = HtmlAgentInput\nexport type HtmlMemberOutput = HtmlAgentOutput\n","/**\n * PDF Generator\n *\n * Generates PDFs from HTML using Cloudflare Browser Rendering API.\n * Falls back to a simple implementation if Browser API is not available.\n */\n\nimport type {\n  PdfPageConfig,\n  PdfHeaderFooter,\n  PdfMetadata,\n  PdfGenerationResult,\n  PdfPageSize,\n} from '../types/index.js'\n\n/**\n * PDF generation options\n */\nexport interface PdfGenerateOptions {\n  html: string\n  page?: PdfPageConfig\n  headerFooter?: PdfHeaderFooter\n  metadata?: PdfMetadata\n}\n\n/**\n * Generate PDF from HTML\n */\nexport async function generatePdf(\n  options: PdfGenerateOptions,\n  env?: { BROWSER?: any }\n): Promise<PdfGenerationResult> {\n  const startTime = Date.now()\n\n  // Try Cloudflare Browser Rendering API first\n  if (env?.BROWSER) {\n    return await generatePdfWithBrowser(options, env.BROWSER)\n  }\n\n  // Fallback to basic implementation\n  return await generatePdfBasic(options)\n}\n\n/**\n * Generate PDF using Cloudflare Browser Rendering API\n */\nasync function generatePdfWithBrowser(\n  options: PdfGenerateOptions,\n  browser: any\n): Promise<PdfGenerationResult> {\n  const startTime = Date.now()\n\n  // Launch browser session\n  const session = await browser.newSession()\n\n  try {\n    // Navigate to data URL with HTML\n    const dataUrl = `data:text/html;charset=utf-8,${encodeURIComponent(options.html)}`\n    await session.goto(dataUrl, { waitUntil: 'networkidle' })\n\n    // Build PDF options\n    const pdfOptions: any = {\n      format: options.page?.size || 'A4',\n      landscape: options.page?.orientation === 'landscape',\n      printBackground: options.page?.printBackground !== false,\n      margin: {\n        top: `${options.page?.margins?.top || 10}mm`,\n        right: `${options.page?.margins?.right || 10}mm`,\n        bottom: `${options.page?.margins?.bottom || 10}mm`,\n        left: `${options.page?.margins?.left || 10}mm`,\n      },\n    }\n\n    // Add header/footer if configured\n    if (options.headerFooter?.displayHeaderFooter) {\n      pdfOptions.displayHeaderFooter = true\n      pdfOptions.headerTemplate = options.headerFooter.header || ''\n      pdfOptions.footerTemplate = options.headerFooter.footer || ''\n    }\n\n    // Add scale if configured\n    if (options.page?.scale) {\n      pdfOptions.scale = options.page.scale\n    }\n\n    // Generate PDF\n    const pdfBuffer = await session.pdf(pdfOptions)\n\n    // Convert ArrayBufferLike to ArrayBuffer if needed\n    const pdf = pdfBuffer instanceof ArrayBuffer ? pdfBuffer : new Uint8Array(pdfBuffer).buffer\n\n    return {\n      pdf,\n      generateTime: Date.now() - startTime,\n    }\n  } finally {\n    // Close browser session\n    await session.close()\n  }\n}\n\n/**\n * Basic PDF generation (fallback)\n * Creates a minimal PDF structure\n */\nasync function generatePdfBasic(options: PdfGenerateOptions): Promise<PdfGenerationResult> {\n  const startTime = Date.now()\n\n  // This is a very basic PDF generation for development/testing\n  // In production, Browser Rendering API should be used\n  const pdfContent = createBasicPdf(options)\n  const encoder = new TextEncoder()\n  const pdfBuffer = encoder.encode(pdfContent)\n\n  // Convert Uint8Array buffer to ArrayBuffer (pdfBuffer.buffer is ArrayBufferLike)\n  const pdf = pdfBuffer.buffer.slice(0) as ArrayBuffer\n\n  return {\n    pdf,\n    generateTime: Date.now() - startTime,\n  }\n}\n\n/**\n * Create a basic PDF structure (for fallback only)\n * This creates a minimal valid PDF with the HTML rendered as text\n */\nfunction createBasicPdf(options: PdfGenerateOptions): string {\n  const title = options.metadata?.title || 'Document'\n  const author = options.metadata?.author || 'Conductor'\n  const creationDate = options.metadata?.creationDate || new Date()\n\n  // Strip HTML tags for text content\n  const textContent = options.html\n    .replace(/<[^>]*>/g, ' ')\n    .replace(/\\s+/g, ' ')\n    .trim()\n\n  // Basic PDF structure\n  return `%PDF-1.4\n1 0 obj\n<<\n/Type /Catalog\n/Pages 2 0 R\n/Metadata 3 0 R\n>>\nendobj\n\n2 0 obj\n<<\n/Type /Pages\n/Kids [4 0 R]\n/Count 1\n>>\nendobj\n\n3 0 obj\n<<\n/Type /Metadata\n/Subtype /XML\n/Length 0\n>>\nstream\nendstream\nendobj\n\n4 0 obj\n<<\n/Type /Page\n/Parent 2 0 R\n/MediaBox [0 0 595 842]\n/Contents 5 0 R\n/Resources <<\n/Font <<\n/F1 6 0 R\n>>\n>>\n>>\nendobj\n\n5 0 obj\n<<\n/Length ${textContent.length + 50}\n>>\nstream\nBT\n/F1 12 Tf\n50 800 Td\n(${title}) Tj\n0 -20 Td\n(${textContent.substring(0, 500)}) Tj\nET\nendstream\nendobj\n\n6 0 obj\n<<\n/Type /Font\n/Subtype /Type1\n/BaseFont /Helvetica\n>>\nendobj\n\nxref\n0 7\n0000000000 65535 f\n0000000009 00000 n\n0000000074 00000 n\n0000000131 00000 n\n0000000229 00000 n\n0000000379 00000 n\n0000000${(500 + textContent.length).toString().padStart(3, '0')} 00000 n\ntrailer\n<<\n/Size 7\n/Root 1 0 R\n/Info <<\n/Title (${title})\n/Author (${author})\n/CreationDate (D:${formatPdfDate(creationDate)})\n>>\n>>\nstartxref\n${(550 + textContent.length).toString()}\n%%EOF`\n}\n\n/**\n * Format date for PDF\n */\nfunction formatPdfDate(date: Date): string {\n  const year = date.getFullYear()\n  const month = String(date.getMonth() + 1).padStart(2, '0')\n  const day = String(date.getDate()).padStart(2, '0')\n  const hours = String(date.getHours()).padStart(2, '0')\n  const minutes = String(date.getMinutes()).padStart(2, '0')\n  const seconds = String(date.getSeconds()).padStart(2, '0')\n\n  return `${year}${month}${day}${hours}${minutes}${seconds}`\n}\n\n/**\n * Validate page configuration\n */\nexport function validatePageConfig(page?: PdfPageConfig): { valid: boolean; errors?: string[] } {\n  const errors: string[] = []\n\n  if (page?.scale && (page.scale < 0.1 || page.scale > 2.0)) {\n    errors.push('Scale must be between 0.1 and 2.0')\n  }\n\n  if (page?.margins) {\n    const { top, right, bottom, left } = page.margins\n    if (top && top < 0) errors.push('Top margin cannot be negative')\n    if (right && right < 0) errors.push('Right margin cannot be negative')\n    if (bottom && bottom < 0) errors.push('Bottom margin cannot be negative')\n    if (left && left < 0) errors.push('Left margin cannot be negative')\n  }\n\n  return {\n    valid: errors.length === 0,\n    errors: errors.length > 0 ? errors : undefined,\n  }\n}\n\n/**\n * Create default header template with page numbers\n */\nexport function createDefaultHeader(title?: string): string {\n  return `\n    <div style=\"font-size: 10px; text-align: center; width: 100%; margin: 0 10mm;\">\n      <span>${title || 'Document'}</span>\n    </div>\n  `\n}\n\n/**\n * Create default footer template with page numbers\n */\nexport function createDefaultFooter(): string {\n  return `\n    <div style=\"font-size: 10px; text-align: center; width: 100%; margin: 0 10mm;\">\n      <span class=\"pageNumber\"></span> / <span class=\"totalPages\"></span>\n    </div>\n  `\n}\n","/**\n * PDF Storage Utilities\n *\n * Handles storing PDFs to R2 and generating URLs.\n */\n\nimport type { PdfStorageConfig } from '../types/index.js'\n\n/**\n * Store PDF to R2\n */\nexport async function storePdfToR2(\n  pdf: ArrayBuffer,\n  config: PdfStorageConfig,\n  env: any\n): Promise<{ r2Key: string; url?: string }> {\n  const r2BindingName = config.r2Binding || 'ASSETS'\n  const bucket = env[r2BindingName] as R2Bucket\n\n  if (!bucket) {\n    throw new Error(`R2 bucket binding \"${r2BindingName}\" not found in environment`)\n  }\n\n  // Generate R2 key\n  const r2Key = config.r2Key || generateDefaultR2Key()\n\n  // Store to R2\n  await bucket.put(r2Key, pdf, {\n    httpMetadata: {\n      contentType: 'application/pdf',\n    },\n    customMetadata: {\n      uploadedAt: new Date().toISOString(),\n      generatedBy: 'conductor-pdf-agent',\n    },\n  })\n\n  // Generate public URL if requested\n  let url: string | undefined\n  if (config.publicUrl) {\n    // Cloudflare R2 public URL format\n    // Assumes R2 bucket has public access configured\n    url = `/assets/static/${r2Key.split('/').pop()}`\n  }\n\n  return { r2Key, url }\n}\n\n/**\n * Generate default R2 key\n */\nexport function generateDefaultR2Key(): string {\n  const timestamp = Date.now()\n  const random = Math.random().toString(36).substring(2, 8)\n  return `static/generated-${timestamp}-${random}.pdf`\n}\n\n/**\n * Generate filename from R2 key or config\n */\nexport function generateFilename(\n  r2Key?: string,\n  configFilename?: string,\n  fallback: string = 'document.pdf'\n): string {\n  if (configFilename) {\n    // Ensure .pdf extension\n    return configFilename.endsWith('.pdf') ? configFilename : `${configFilename}.pdf`\n  }\n\n  if (r2Key) {\n    // Extract filename from R2 key\n    const parts = r2Key.split('/')\n    const filename = parts[parts.length - 1]\n    return filename || fallback\n  }\n\n  return fallback\n}\n\n/**\n * Create Content-Disposition header\n */\nexport function createContentDisposition(mode: 'inline' | 'attachment', filename: string): string {\n  // Sanitize filename\n  const safeFilename = filename.replace(/[^a-zA-Z0-9._-]/g, '_')\n\n  if (mode === 'attachment') {\n    return `attachment; filename=\"${safeFilename}\"`\n  }\n\n  return `inline; filename=\"${safeFilename}\"`\n}\n\n/**\n * Validate storage configuration\n */\nexport function validateStorageConfig(config?: PdfStorageConfig): {\n  valid: boolean\n  errors?: string[]\n} {\n  if (!config || !config.saveToR2) {\n    return { valid: true }\n  }\n\n  const errors: string[] = []\n\n  if (config.r2Key) {\n    // Validate R2 key format\n    if (config.r2Key.includes('..')) {\n      errors.push('R2 key cannot contain \"..\"')\n    }\n    if (config.r2Key.startsWith('/')) {\n      errors.push('R2 key should not start with \"/\"')\n    }\n  }\n\n  return {\n    valid: errors.length === 0,\n    errors: errors.length > 0 ? errors : undefined,\n  }\n}\n","/**\n * PDF Agent\n *\n * Generates PDFs from HTML with support for:\n * - Cloudflare Browser Rendering API\n * - R2 storage with configurable paths\n * - Browser display (inline) or download (attachment)\n * - Page configuration (size, margins, orientation)\n * - Headers and footers with page numbers\n * - PDF metadata\n */\n\nimport { BaseAgent, type AgentExecutionContext } from '../base-agent.js'\nimport type { AgentConfig } from '../../runtime/parser.js'\nimport { Operation } from '../../types/constants.js'\nimport type {\n  PdfAgentConfig,\n  PdfAgentInput,\n  PdfAgentOutput,\n  PdfHeaderFooter,\n} from './types/index.js'\nimport { HtmlAgent } from '../html/html-agent.js'\nimport { generatePdf, validatePageConfig } from './utils/pdf-generator.js'\nimport {\n  storePdfToR2,\n  generateFilename,\n  createContentDisposition,\n  validateStorageConfig,\n} from './utils/storage.js'\nimport { createTemplateEngine, type BaseTemplateEngine } from '../../utils/templates/index.js'\n\nexport class PdfAgent extends BaseAgent {\n  private pdfConfig: PdfAgentConfig\n  private templateEngine: BaseTemplateEngine\n\n  constructor(config: AgentConfig) {\n    super(config)\n    // Extract nested config (config.config contains the agent-specific settings)\n    this.pdfConfig = (config.config || {}) as unknown as PdfMemberConfig\n\n    // Initialize template engine (default to 'simple')\n    const engine = this.pdfConfig.templateEngine || 'simple'\n    this.templateEngine = createTemplateEngine(engine)\n\n    // Validate configuration\n    this.validateConfig()\n  }\n\n  /**\n   * Validate agent configuration\n   */\n  private validateConfig(): void {\n    // Validate page config\n    if (this.pdfConfig.page) {\n      const pageValidation = validatePageConfig(this.pdfConfig.page)\n      if (!pageValidation.valid) {\n        throw new Error(`Invalid page config: ${pageValidation.errors?.join(', ')}`)\n      }\n    }\n\n    // Validate storage config\n    if (this.pdfConfig.storage) {\n      const storageValidation = validateStorageConfig(this.pdfConfig.storage)\n      if (!storageValidation.valid) {\n        throw new Error(`Invalid storage config: ${storageValidation.errors?.join(', ')}`)\n      }\n    }\n  }\n\n  /**\n   * Execute PDF generation\n   */\n  protected async run(context: AgentExecutionContext): Promise<PdfAgentOutput> {\n    const startTime = Date.now()\n    const input = context.input as PdfAgentInput\n\n    // Merge config with input\n    const htmlSource = input.html || this.pdfConfig.html\n    const pageConfig = { ...this.pdfConfig.page, ...input.page }\n    const headerFooter = { ...this.pdfConfig.headerFooter, ...input.headerFooter }\n    const storageConfig = { ...this.pdfConfig.storage, ...input.storage }\n    const metadata = { ...this.pdfConfig.metadata, ...input.metadata }\n    const deliveryMode = input.deliveryMode || this.pdfConfig.deliveryMode || 'inline'\n    const filename = input.filename || this.pdfConfig.filename\n\n    // Get HTML content\n    let html: string\n    let htmlSize: number\n\n    if (htmlSource?.inline) {\n      // Inline HTML\n      html = htmlSource.inline\n      htmlSize = html.length\n    } else if (htmlSource?.fromMember) {\n      // Get HTML from previous agent output\n      const memberOutput = context.previousOutputs?.[htmlSource.fromMember]\n      // Type guard for HTML output structure\n      const output = memberOutput?.output as { html?: string } | undefined\n      if (!output?.html) {\n        throw new Error(\n          `Agent \"${htmlSource.fromMember}\" did not produce HTML output. ` +\n            `Make sure it's an HTML agent and executed before this PDF agent.`\n        )\n      }\n      html = output.html\n      htmlSize = html.length\n    } else if (htmlSource?.template) {\n      // Render HTML from template\n      const htmlMemberConfig: AgentConfig = {\n        name: `${this.name}-html-renderer`,\n        operation: Operation.html,\n        config: {\n          template: htmlSource.template,\n          templateEngine: this.pdfConfig.templateEngine || 'simple',\n          renderOptions: {\n            // Don't inline CSS for PDF - browser can handle it\n            inlineCss: false,\n            minify: false,\n          },\n        },\n      }\n\n      const htmlAgent = new HtmlAgent(htmlMemberConfig)\n      // Create child context (security features injected by BaseAgent.execute)\n      const htmlContext: AgentExecutionContext = {\n        input: { data: htmlSource.data || {} },\n        env: context.env,\n        ctx: context.ctx,\n        previousOutputs: context.previousOutputs,\n      }\n\n      const htmlResponse = await htmlAgent.execute(htmlContext)\n\n      if (!htmlResponse.success) {\n        throw new Error(`HTML rendering failed: ${htmlResponse.error}`)\n      }\n\n      // Type-safe access to HTML output\n      const htmlData = htmlResponse.data as { html?: string }\n      if (!htmlData.html) {\n        throw new Error('HTML rendering succeeded but no HTML content was produced')\n      }\n      html = htmlData.html\n      htmlSize = html.length\n    } else {\n      throw new Error(\n        'No HTML source specified. Provide html.inline, html.fromMember, or html.template'\n      )\n    }\n\n    // Render header/footer templates if they contain variables\n    const renderedHeaderFooter = await this.renderHeaderFooter(headerFooter)\n\n    // Generate PDF - pass env with BROWSER binding if available\n    const pdfResult = await generatePdf(\n      {\n        html,\n        page: pageConfig,\n        headerFooter: renderedHeaderFooter,\n        metadata,\n      },\n      { BROWSER: (context.env as Record<string, unknown>).BROWSER }\n    )\n\n    // Store to R2 if configured\n    let r2Key: string | undefined\n    let url: string | undefined\n\n    if (storageConfig?.saveToR2) {\n      const storageResult = await storePdfToR2(pdfResult.pdf, storageConfig, context.env)\n      r2Key = storageResult.r2Key\n      url = storageResult.url\n    }\n\n    // Generate filename\n    const finalFilename = generateFilename(r2Key, filename, 'document.pdf')\n\n    // Create Content-Disposition header\n    const contentDisposition = createContentDisposition(deliveryMode, finalFilename)\n\n    return {\n      pdf: pdfResult.pdf,\n      size: pdfResult.pdf.byteLength,\n      url,\n      r2Key,\n      contentDisposition,\n      filename: finalFilename,\n      metadata: {\n        generateTime: Date.now() - startTime,\n        pageCount: pdfResult.pageCount,\n        htmlSize,\n      },\n    }\n  }\n\n  /**\n   * Render header/footer templates with template engine\n   */\n  private async renderHeaderFooter(\n    headerFooter?: PdfHeaderFooter\n  ): Promise<PdfHeaderFooter | undefined> {\n    if (!headerFooter) {\n      return undefined\n    }\n\n    const data = headerFooter.data || {}\n    const rendered: PdfHeaderFooter = { ...headerFooter }\n\n    // Render header template if it exists\n    if (headerFooter.header) {\n      rendered.header = await this.templateEngine.render(headerFooter.header, data)\n    }\n\n    // Render footer template if it exists\n    if (headerFooter.footer) {\n      rendered.footer = await this.templateEngine.render(headerFooter.footer, data)\n    }\n\n    return rendered\n  }\n}\n\n// Backward compatibility aliases\nexport const PdfMember = PdfAgent\nexport type PdfMemberConfig = PdfAgentConfig\nexport type PdfMemberInput = PdfAgentInput\nexport type PdfMemberOutput = PdfAgentOutput\n","/**\n * Built-In Agent Registry\n *\n * Manages registration, discovery, and lazy loading of built-in agents.\n *\n * Features:\n * - Lazy loading (only load agents when used)\n * - Auto-discovery (list all available agents)\n * - Versioning (each agent has a version)\n * - Metadata (description, schemas, examples)\n */\n\nimport type { BaseAgent } from '../base-agent.js'\nimport type { AgentConfig } from '../../runtime/parser.js'\nimport type { BuiltInAgentMetadata, BuiltInAgentFactory, BuiltInAgentEntry } from './types.js'\nimport { Operation } from '../../types/constants.js'\nimport type { ConductorEnv } from '../../types/env.js'\n\nexport class BuiltInAgentRegistry {\n  private agents = new Map<string, BuiltInAgentEntry>()\n\n  /**\n   * Register a built-in agent\n   */\n  register(metadata: BuiltInAgentMetadata, factory: BuiltInAgentFactory): void {\n    this.agents.set(metadata.name, {\n      metadata,\n      factory,\n      loaded: false,\n    })\n  }\n\n  /**\n   * Check if a agent is built-in\n   */\n  isBuiltIn(name: string): boolean {\n    return this.agents.has(name)\n  }\n\n  /**\n   * Get a built-in agent instance (lazy loading)\n   */\n  async create(name: string, config: AgentConfig, env: ConductorEnv): Promise<BaseAgent> {\n    const entry = this.agents.get(name)\n\n    if (!entry) {\n      throw new Error(\n        `Built-in agent \"${name}\" not found. ` + `Available: ${this.getAvailableNames().join(', ')}`\n      )\n    }\n\n    // Create instance using factory (lazy loading)\n    entry.loaded = true\n    return await entry.factory(config, env)\n  }\n\n  /**\n   * Get metadata for a built-in agent\n   */\n  getMetadata(name: string): BuiltInAgentMetadata | undefined {\n    return this.agents.get(name)?.metadata\n  }\n\n  /**\n   * List all built-in agents\n   */\n  list(): BuiltInAgentMetadata[] {\n    return Array.from(this.agents.values()).map((entry) => entry.metadata)\n  }\n\n  /**\n   * Get available agent names\n   */\n  getAvailableNames(): string[] {\n    return Array.from(this.agents.keys())\n  }\n\n  /**\n   * Get agents by type\n   */\n  listByType(type: string): BuiltInAgentMetadata[] {\n    return this.list().filter((m) => m.operation === type)\n  }\n\n  /**\n   * Get agents by tag\n   */\n  listByTag(tag: string): BuiltInAgentMetadata[] {\n    return this.list().filter((m) => m.tags?.includes(tag))\n  }\n}\n\n// Singleton registry instance\nlet registry: BuiltInAgentRegistry | null = null\n\n/**\n * Get the built-in agent registry (singleton)\n */\nexport function getBuiltInRegistry(): BuiltInAgentRegistry {\n  if (!registry) {\n    registry = new BuiltInAgentRegistry()\n    registerAllBuiltInAgents(registry)\n  }\n  return registry\n}\n\n/**\n * Register all built-in agents\n * This is called once when the registry is first accessed\n *\n * Note: Most agents have been moved to template-based agents that users own and can customize.\n * See: catalog/cloud/cloudflare/templates/agents/system/\n *\n * Only RAG and HITL remain as true built-ins because they require deep framework integration:\n * - RAG: Tight Cloudflare Vectorize and Workers AI embedding integration\n * - HITL: Requires Durable Objects runtime coordination for workflow suspension\n */\nfunction registerAllBuiltInAgents(registry: BuiltInAgentRegistry): void {\n  // Import and register each built-in agent\n  // This happens lazily, so only loaded when first accessed\n\n  // RAG agent\n  registry.register(\n    {\n      name: 'rag',\n      version: '1.0.0',\n      description: 'RAG system using Cloudflare Vectorize and AI embeddings',\n      operation: Operation.storage,\n      tags: ['rag', 'vectorize', 'embeddings', 'search', 'ai'],\n      examples: [\n        {\n          name: 'index-content',\n          description: 'Index content into vector database',\n          input: {\n            content: 'Document content...',\n            id: 'doc-123',\n            source: 'https://example.com',\n          },\n          config: {\n            operation: 'index',\n            chunkStrategy: 'semantic',\n            chunkSize: 512,\n          },\n          output: { indexed: 10, chunks: 10 },\n        },\n        {\n          name: 'search-content',\n          description: 'Search for relevant content',\n          input: { query: 'What is the company mission?' },\n          config: {\n            operation: 'search',\n            topK: 5,\n            rerank: true,\n          },\n          output: { results: [], count: 5 },\n        },\n      ],\n      documentation: 'https://docs.conductor.dev/built-in-agents/rag',\n    },\n    async (config, env) => {\n      const { RAGMember } = await import('./rag/index.js')\n      return new RAGMember(config, env)\n    }\n  )\n\n  // HITL agent\n  registry.register(\n    {\n      name: 'hitl',\n      version: '1.0.0',\n      description: 'Human-in-the-loop workflows with approval gates and notifications',\n      operation: Operation.code,\n      tags: ['workflow', 'approval', 'human-in-loop', 'durable-objects'],\n      examples: [\n        {\n          name: 'approval-gate',\n          description: 'Suspend workflow for manual approval',\n          input: {\n            approvalData: {\n              transaction: { amount: 10000, to: 'account-123' },\n              risk_score: 0.85,\n            },\n          },\n          config: {\n            action: 'suspend',\n            timeout: 86400000,\n            notificationChannel: 'slack',\n          },\n          output: {\n            status: 'suspended',\n            executionId: 'exec-123',\n            approvalUrl: 'https://app.com/approve/exec-123',\n          },\n        },\n      ],\n      documentation: 'https://docs.conductor.dev/built-in-agents/hitl',\n    },\n    async (config, env) => {\n      const { HITLMember } = await import('./hitl/index.js')\n      return new HITLMember(config, env)\n    }\n  )\n}\n\n// Backward compatibility alias\nexport const BuiltInMemberRegistry = BuiltInAgentRegistry\n","/**\n * Scoring Executor\n *\n * Handles agent execution with scoring, retry logic, and backoff strategies.\n */\n\nimport type {\n  AgentScoringConfig,\n  ScoringResult,\n  ScoredExecutionResult,\n  BackoffStrategy,\n  ScoreBreakdown,\n} from './types.js'\nimport { Errors } from '../../errors/error-types.js'\nimport { createLogger } from '../../observability/index.js'\n\nconst logger = createLogger({ serviceName: 'scoring-executor' })\n\nexport class ScoringExecutor {\n  /**\n   * Execute a agent with scoring and retry logic\n   */\n  async executeWithScoring<T = any>(\n    executeAgent: () => Promise<T>,\n    evaluateOutput: (\n      output: T,\n      attempt: number,\n      previousScore?: ScoringResult\n    ) => Promise<ScoringResult>,\n    config: AgentScoringConfig\n  ): Promise<ScoredExecutionResult<T>> {\n    const startTime = Date.now()\n    let attempts = 0\n    let lastScore: ScoringResult | undefined\n    let lastOutput: T | undefined\n    let backoffMs = 1000\n    const maxAttempts = config.retryLimit || 3\n\n    while (attempts < maxAttempts) {\n      attempts++\n\n      try {\n        // Execute the agent\n        const output = await executeAgent()\n        lastOutput = output\n\n        // Evaluate the output\n        const score = await evaluateOutput(output, attempts, lastScore)\n        lastScore = score\n\n        // Check if score meets threshold\n        if (score.passed) {\n          return {\n            output,\n            score,\n            attempts,\n            status: 'passed',\n            executionTime: Date.now() - startTime,\n          }\n        }\n\n        // Check improvement requirement\n        if (config.requireImprovement && lastScore && attempts > 1) {\n          const improvement = score.score - lastScore.score\n          const minImprovement = config.minImprovement || 0.05\n\n          if (improvement < minImprovement) {\n            // Not improving enough, stop retrying\n            return {\n              output,\n              score,\n              attempts,\n              status: 'max_retries_exceeded',\n              executionTime: Date.now() - startTime,\n            }\n          }\n        }\n\n        // Handle failure based on strategy\n        const onFailure = config.onFailure || 'retry'\n\n        switch (onFailure) {\n          case 'retry':\n            if (attempts < maxAttempts) {\n              // Apply backoff\n              await this.applyBackoff(backoffMs)\n              backoffMs = this.calculateNextBackoff(backoffMs, 'exponential')\n            }\n            break\n\n          case 'continue':\n            // Log warning but continue execution\n            logger.warn('Score below threshold, continuing anyway', {\n              score: score.score,\n              threshold: config.thresholds?.minimum,\n              attempts,\n            })\n            return {\n              output,\n              score,\n              attempts,\n              status: 'below_threshold',\n              executionTime: Date.now() - startTime,\n            }\n\n          case 'abort':\n            throw Errors.internal(\n              `Score ${score.score} below minimum threshold ${config.thresholds?.minimum}`\n            )\n        }\n      } catch (error) {\n        // Execution failed\n        if (attempts >= maxAttempts) {\n          throw error\n        }\n\n        // Retry after backoff\n        await this.applyBackoff(backoffMs)\n        backoffMs = this.calculateNextBackoff(backoffMs, 'exponential')\n      }\n    }\n\n    // Max retries exceeded\n    return {\n      output: lastOutput!,\n      score: lastScore!,\n      attempts,\n      status: 'max_retries_exceeded',\n      executionTime: Date.now() - startTime,\n    }\n  }\n\n  /**\n   * Apply backoff delay\n   */\n  private async applyBackoff(ms: number): Promise<void> {\n    return new Promise((resolve) => setTimeout(resolve, ms))\n  }\n\n  /**\n   * Calculate next backoff delay\n   */\n  private calculateNextBackoff(current: number, strategy: BackoffStrategy): number {\n    switch (strategy) {\n      case 'exponential':\n        return Math.min(current * 2, 60000) // Cap at 60s\n      case 'linear':\n        return Math.min(current + 1000, 30000) // Cap at 30s\n      case 'fixed':\n      default:\n        return current\n    }\n  }\n\n  /**\n   * Calculate composite score from breakdown\n   */\n  calculateCompositeScore(breakdown: ScoreBreakdown, weights?: Record<string, number>): number {\n    const criteria = Object.keys(breakdown)\n\n    if (!criteria.length) {\n      return 0\n    }\n\n    if (!weights) {\n      // Simple average\n      const sum = criteria.reduce((acc, key) => acc + breakdown[key], 0)\n      return sum / criteria.length\n    }\n\n    // Weighted average\n    let weightedSum = 0\n    let totalWeight = 0\n\n    for (const criterion of criteria) {\n      const weight = weights[criterion] || 1\n      weightedSum += breakdown[criterion] * weight\n      totalWeight += weight\n    }\n\n    return totalWeight > 0 ? weightedSum / totalWeight : 0\n  }\n\n  /**\n   * Check if score meets threshold\n   */\n  checkThreshold(score: number, threshold: number): boolean {\n    return score >= threshold\n  }\n\n  /**\n   * Get score range category\n   */\n  getScoreRange(score: number): 'excellent' | 'good' | 'acceptable' | 'poor' {\n    if (score >= 0.95) return 'excellent'\n    if (score >= 0.8) return 'good'\n    if (score >= 0.6) return 'acceptable'\n    return 'poor'\n  }\n\n  /**\n   * Get failed criteria from breakdown\n   */\n  getFailedCriteria(breakdown: ScoreBreakdown, threshold: number): string[] {\n    return Object.entries(breakdown)\n      .filter(([_, score]) => score < threshold)\n      .map(([criterion]) => criterion)\n  }\n}\n","/**\n * Ensemble Scorer\n *\n * Aggregates and tracks quality metrics across ensemble execution.\n */\n\nimport type {\n  ScoreHistoryEntry,\n  QualityMetrics,\n  ScoringState,\n  ScoreBreakdown,\n  EnsembleScoringConfig,\n} from './types.js'\n\nexport class EnsembleScorer {\n  constructor(private readonly config: EnsembleScoringConfig) {}\n\n  /**\n   * Calculate overall ensemble score from history\n   */\n  calculateEnsembleScore(history: ScoreHistoryEntry[], weights?: Record<string, number>): number {\n    if (!history.length) {\n      return 0\n    }\n\n    if (!weights) {\n      // Simple average of latest scores per agent\n      const latestScores = this.getLatestScoresPerMember(history)\n      const sum = Array.from(latestScores.values()).reduce((acc, score) => acc + score, 0)\n      return sum / latestScores.size\n    }\n\n    // Weighted average\n    const latestScores = this.getLatestScoresPerMember(history)\n    let weightedSum = 0\n    let totalWeight = 0\n\n    for (const [agent, score] of latestScores.entries()) {\n      const weight = weights[agent] || 1\n      weightedSum += score * weight\n      totalWeight += weight\n    }\n\n    return totalWeight > 0 ? weightedSum / totalWeight : 0\n  }\n\n  /**\n   * Get latest score for each agent\n   */\n  private getLatestScoresPerMember(history: ScoreHistoryEntry[]): Map<string, number> {\n    const scores = new Map<string, number>()\n\n    // Process in order, later entries overwrite earlier ones\n    for (const entry of history) {\n      if (entry.passed) {\n        // Only use passing scores\n        scores.set(entry.agent, entry.score)\n      }\n    }\n\n    return scores\n  }\n\n  /**\n   * Calculate comprehensive quality metrics\n   */\n  calculateQualityMetrics(history: ScoreHistoryEntry[]): QualityMetrics {\n    if (!history.length) {\n      return {\n        ensembleScore: 0,\n        averageScore: 0,\n        minScore: 0,\n        maxScore: 0,\n        totalEvaluations: 0,\n        passRate: 0,\n        totalRetries: 0,\n        averageAttempts: 0,\n      }\n    }\n\n    const scores = history.map((e) => e.score)\n    const attempts = history.map((e) => e.attempt)\n\n    const ensembleScore = this.calculateEnsembleScore(history)\n    const averageScore = scores.reduce((a, b) => a + b, 0) / scores.length\n    const minScore = Math.min(...scores)\n    const maxScore = Math.max(...scores)\n    const passRate = history.filter((e) => e.passed).length / history.length\n    const totalRetries = attempts.filter((a) => a > 1).length\n    const averageAttempts = attempts.reduce((a, b) => a + b, 0) / attempts.length\n\n    const criteriaBreakdown = this.aggregateCriteria(history)\n\n    return {\n      ensembleScore,\n      averageScore,\n      minScore,\n      maxScore,\n      totalEvaluations: history.length,\n      passRate,\n      criteriaBreakdown,\n      totalRetries,\n      averageAttempts,\n    }\n  }\n\n  /**\n   * Aggregate scores by criterion\n   */\n  private aggregateCriteria(history: ScoreHistoryEntry[]): QualityMetrics['criteriaBreakdown'] {\n    const criteria: Record<\n      string,\n      {\n        scores: number[]\n        average: number\n        passRate: number\n      }\n    > = {}\n\n    // Collect scores per criterion\n    for (const entry of history) {\n      if (entry.breakdown) {\n        for (const [criterion, score] of Object.entries(entry.breakdown)) {\n          if (!criteria[criterion]) {\n            criteria[criterion] = { scores: [], average: 0, passRate: 0 }\n          }\n          criteria[criterion].scores.push(score)\n        }\n      }\n    }\n\n    // Calculate averages and pass rates\n    const threshold = this.config.defaultThresholds.minimum\n\n    for (const criterion of Object.keys(criteria)) {\n      const scores = criteria[criterion].scores\n      criteria[criterion].average = scores.reduce((a, b) => a + b, 0) / scores.length\n      criteria[criterion].passRate = scores.filter((s) => s >= threshold).length / scores.length\n    }\n\n    return criteria\n  }\n\n  /**\n   * Update scoring state with new entry\n   */\n  updateScoringState(state: ScoringState, entry: ScoreHistoryEntry): ScoringState {\n    const newHistory = [...state.scoreHistory, entry]\n\n    // Update retry count\n    const retryCount = { ...state.retryCount }\n    if (entry.attempt > 1) {\n      retryCount[entry.agent] = (retryCount[entry.agent] || 0) + 1\n    }\n\n    // Calculate metrics\n    const qualityMetrics = this.calculateQualityMetrics(newHistory)\n    const finalScore = qualityMetrics.ensembleScore\n\n    return {\n      scoreHistory: newHistory,\n      finalScore,\n      retryCount,\n      qualityMetrics,\n    }\n  }\n\n  /**\n   * Initialize empty scoring state\n   */\n  initializeScoringState(): ScoringState {\n    return {\n      scoreHistory: [],\n      finalScore: undefined,\n      retryCount: {},\n      qualityMetrics: undefined,\n    }\n  }\n\n  /**\n   * Check if ensemble quality is degrading\n   */\n  isQualityDegrading(history: ScoreHistoryEntry[], windowSize: number = 5): boolean {\n    if (history.length < windowSize * 2) {\n      return false\n    }\n\n    // Compare recent scores to older scores\n    const recentScores = history.slice(-windowSize).map((e) => e.score)\n    const olderScores = history.slice(-windowSize * 2, -windowSize).map((e) => e.score)\n\n    const recentAvg = recentScores.reduce((a, b) => a + b, 0) / recentScores.length\n    const olderAvg = olderScores.reduce((a, b) => a + b, 0) / olderScores.length\n\n    // Degrading if recent average is significantly lower\n    const degradationThreshold = 0.1 // 10% drop\n    return recentAvg < olderAvg - degradationThreshold\n  }\n\n  /**\n   * Get recommendations based on quality metrics\n   */\n  getRecommendations(metrics: QualityMetrics): string[] {\n    const recommendations: string[] = []\n\n    // Low overall score\n    if (metrics.ensembleScore < 0.7) {\n      recommendations.push(\n        'Overall ensemble score is low. Review agent configurations and criteria.'\n      )\n    }\n\n    // High retry rate\n    if (metrics.totalRetries > metrics.totalEvaluations * 0.5) {\n      recommendations.push(\n        'High retry rate detected. Consider adjusting thresholds or improving agent quality.'\n      )\n    }\n\n    // Low pass rate\n    if (metrics.passRate < 0.8) {\n      recommendations.push(\n        `Pass rate is ${(metrics.passRate * 100).toFixed(0)}%. Review failing criteria.`\n      )\n    }\n\n    // Specific criteria failures\n    if (metrics.criteriaBreakdown) {\n      for (const [criterion, data] of Object.entries(metrics.criteriaBreakdown)) {\n        if (data.passRate < 0.7) {\n          recommendations.push(\n            `Criterion '${criterion}' has low pass rate (${(data.passRate * 100).toFixed(0)}%). Focus improvement efforts here.`\n          )\n        }\n      }\n    }\n\n    return recommendations\n  }\n\n  /**\n   * Get score trend (improving, declining, stable)\n   */\n  getScoreTrend(\n    history: ScoreHistoryEntry[],\n    windowSize: number = 5\n  ): 'improving' | 'declining' | 'stable' {\n    if (history.length < windowSize * 2) {\n      return 'stable'\n    }\n\n    const recentScores = history.slice(-windowSize).map((e) => e.score)\n    const olderScores = history.slice(-windowSize * 2, -windowSize).map((e) => e.score)\n\n    const recentAvg = recentScores.reduce((a, b) => a + b, 0) / recentScores.length\n    const olderAvg = olderScores.reduce((a, b) => a + b, 0) / olderScores.length\n\n    const changeThreshold = 0.05 // 5% change\n\n    if (recentAvg > olderAvg + changeThreshold) {\n      return 'improving'\n    } else if (recentAvg < olderAvg - changeThreshold) {\n      return 'declining'\n    }\n\n    return 'stable'\n  }\n}\n","/**\n * Webhook Notifier\n *\n * Sends outbound webhook notifications with retry logic and signature verification\n */\n\nimport type { NotificationEventData, NotificationDeliveryResult } from './types.js'\nimport { createLogger } from '../../observability/index.js'\n\nconst logger = createLogger({ serviceName: 'webhook-notifier' })\n\nexport interface WebhookNotificationConfig {\n  /** Webhook URL */\n  url: string\n  /** Secret for HMAC signature */\n  secret?: string\n  /** Max retry attempts */\n  retries?: number\n  /** Request timeout in ms */\n  timeout?: number\n}\n\nexport class WebhookNotifier {\n  private config: WebhookNotificationConfig\n\n  constructor(config: WebhookNotificationConfig) {\n    this.config = {\n      retries: config.retries || 3,\n      timeout: config.timeout || 5000,\n      ...config,\n    }\n  }\n\n  /**\n   * Send webhook notification with retry logic\n   */\n  async send(eventData: NotificationEventData): Promise<NotificationDeliveryResult> {\n    const startTime = Date.now()\n    const maxRetries = this.config.retries || 0\n\n    for (let attempt = 0; attempt <= maxRetries; attempt++) {\n      try {\n        const result = await this.sendRequest(eventData, attempt)\n        return {\n          success: true,\n          type: 'webhook',\n          target: this.config.url,\n          event: eventData.event,\n          duration: Date.now() - startTime,\n          statusCode: result.status,\n          attempts: attempt + 1,\n        }\n      } catch (error) {\n        // Log the error\n        logger.error('Webhook notification failed', error instanceof Error ? error : undefined, {\n          url: this.config.url,\n          attempt: attempt + 1,\n          maxRetries: maxRetries + 1,\n        })\n\n        // If this is the last attempt, return failure\n        if (attempt === maxRetries) {\n          return {\n            success: false,\n            type: 'webhook',\n            target: this.config.url,\n            event: eventData.event,\n            duration: Date.now() - startTime,\n            error: error instanceof Error ? error.message : 'Unknown error',\n            attempts: attempt + 1,\n          }\n        }\n\n        // Otherwise, wait and retry with exponential backoff\n        const delay = this.calculateBackoff(attempt)\n        await this.sleep(delay)\n      }\n    }\n\n    // Fallback return (shouldn't reach here)\n    return {\n      success: false,\n      type: 'webhook',\n      target: this.config.url,\n      event: eventData.event,\n      duration: Date.now() - startTime,\n      error: 'Maximum retries exceeded',\n      attempts: maxRetries + 1,\n    }\n  }\n\n  /**\n   * Send webhook HTTP request\n   */\n  private async sendRequest(\n    eventData: NotificationEventData,\n    attempt: number\n  ): Promise<{ status: number }> {\n    const timestamp = Math.floor(Date.now() / 1000)\n\n    // Build payload\n    const payload = {\n      event: eventData.event,\n      timestamp: eventData.timestamp,\n      data: eventData.data,\n    }\n\n    const body = JSON.stringify(payload)\n\n    // Generate signature if secret is provided\n    const headers: Record<string, string> = {\n      'Content-Type': 'application/json',\n      'User-Agent': 'Conductor-Webhook/1.0',\n      'X-Conductor-Event': eventData.event,\n      'X-Conductor-Timestamp': timestamp.toString(),\n      'X-Conductor-Delivery-Attempt': (attempt + 1).toString(),\n    }\n\n    if (this.config.secret) {\n      const signature = await this.generateSignature(body, timestamp, this.config.secret)\n      headers['X-Conductor-Signature'] = signature\n    }\n\n    // Send request with timeout\n    const controller = new AbortController()\n    const timeoutId = setTimeout(() => controller.abort(), this.config.timeout!)\n\n    try {\n      const response = await fetch(this.config.url, {\n        method: 'POST',\n        headers,\n        body,\n        signal: controller.signal,\n      })\n\n      // Check for success status codes (2xx or 3xx)\n      if (!response.ok && response.status >= 400) {\n        throw new Error(`Webhook returned ${response.status}: ${response.statusText}`)\n      }\n\n      return { status: response.status }\n    } finally {\n      clearTimeout(timeoutId)\n    }\n  }\n\n  /**\n   * Generate HMAC signature for webhook verification\n   */\n  private async generateSignature(\n    body: string,\n    timestamp: number,\n    secret: string\n  ): Promise<string> {\n    const payload = `${timestamp}.${body}`\n\n    // Use Web Crypto API (available in Cloudflare Workers)\n    const encoder = new TextEncoder()\n    const key = await crypto.subtle.importKey(\n      'raw',\n      encoder.encode(secret),\n      { name: 'HMAC', hash: 'SHA-256' },\n      false,\n      ['sign']\n    )\n\n    const signature = await crypto.subtle.sign('HMAC', key, encoder.encode(payload))\n\n    // Convert to hex string\n    const hashArray = Array.from(new Uint8Array(signature))\n    const hashHex = hashArray.map((b) => b.toString(16).padStart(2, '0')).join('')\n\n    return `sha256=${hashHex}`\n  }\n\n  /**\n   * Calculate exponential backoff delay\n   */\n  private calculateBackoff(attempt: number): number {\n    // Exponential backoff: 1s, 5s, 30s, 2m, 5m\n    const delays = [1000, 5000, 30000, 120000, 300000]\n    return delays[Math.min(attempt, delays.length - 1)]\n  }\n\n  /**\n   * Sleep for specified milliseconds\n   */\n  private sleep(ms: number): Promise<void> {\n    return new Promise((resolve) => setTimeout(resolve, ms))\n  }\n}\n","/**\n * Email Notifier\n *\n * Sends email notifications using Cloudflare Email Routing / MailChannels\n */\n\nimport type {\n  NotificationEventData,\n  NotificationDeliveryResult,\n  EmailNotificationData,\n} from './types.js'\nimport { createLogger } from '../../observability/index.js'\nimport type { ConductorEnv } from '../../types/env.js'\n\nconst logger = createLogger({ serviceName: 'email-notifier' })\n\nexport interface EmailNotificationConfig {\n  /** Recipient email addresses */\n  to: string[]\n  /** Sender email address */\n  from?: string\n  /** Email subject (supports template variables) */\n  subject?: string\n  /** Events that trigger this email */\n  events: string[]\n}\n\nexport class EmailNotifier {\n  private config: EmailNotificationConfig\n\n  constructor(config: EmailNotificationConfig) {\n    this.config = config\n  }\n\n  /**\n   * Send email notification\n   */\n  async send(\n    eventData: NotificationEventData,\n    env: ConductorEnv\n  ): Promise<NotificationDeliveryResult> {\n    const startTime = Date.now()\n\n    try {\n      // Build email content\n      const emailData = this.buildEmailData(eventData)\n\n      // Send email using MailChannels\n      await this.sendEmail(emailData, env)\n\n      logger.info('Email notification sent', {\n        to: emailData.to,\n        event: eventData.event,\n      })\n\n      return {\n        success: true,\n        type: 'email',\n        target: emailData.to.join(', '),\n        event: eventData.event,\n        duration: Date.now() - startTime,\n      }\n    } catch (error) {\n      logger.error('Email notification failed', error instanceof Error ? error : undefined, {\n        to: this.config.to,\n        event: eventData.event,\n      })\n\n      return {\n        success: false,\n        type: 'email',\n        target: this.config.to.join(', '),\n        event: eventData.event,\n        duration: Date.now() - startTime,\n        error: error instanceof Error ? error.message : 'Unknown error',\n      }\n    }\n  }\n\n  /**\n   * Build email data from event\n   */\n  private buildEmailData(eventData: NotificationEventData): EmailNotificationData {\n    const subject = this.interpolateSubject(eventData)\n    const text = this.buildTextBody(eventData)\n    const html = this.buildHtmlBody(eventData)\n\n    return {\n      to: this.config.to,\n      from: this.config.from || 'notifications@conductor.dev',\n      subject,\n      text,\n      html,\n      event: eventData.event,\n      eventData: eventData.data,\n    }\n  }\n\n  /**\n   * Interpolate subject template with event data\n   */\n  private interpolateSubject(eventData: NotificationEventData): string {\n    if (!this.config.subject) {\n      // Default subject\n      return `Conductor: ${eventData.event}`\n    }\n\n    // Simple template interpolation\n    let subject = this.config.subject\n    subject = subject.replace(/\\${event}/g, eventData.event)\n    subject = subject.replace(\n      /\\${ensemble\\.name}/g,\n      (eventData.data.ensemble as string) || 'Unknown'\n    )\n    subject = subject.replace(/\\${timestamp}/g, eventData.timestamp)\n\n    return subject\n  }\n\n  /**\n   * Build plain text email body\n   */\n  private buildTextBody(eventData: NotificationEventData): string {\n    const lines = [\n      `Event: ${eventData.event}`,\n      `Timestamp: ${eventData.timestamp}`,\n      '',\n      'Details:',\n      JSON.stringify(eventData.data, null, 2),\n      '',\n      '---',\n      'This is an automated notification from Conductor.',\n    ]\n\n    return lines.join('\\n')\n  }\n\n  /**\n   * Build HTML email body\n   */\n  private buildHtmlBody(eventData: NotificationEventData): string {\n    const eventType = eventData.event.split('.')[0]\n    const eventAction = eventData.event.split('.')[1] || ''\n\n    // Color based on event type\n    let color = '#2563eb' // blue\n    if (eventAction === 'failed' || eventAction === 'timeout') {\n      color = '#dc2626' // red\n    } else if (eventAction === 'completed') {\n      color = '#16a34a' // green\n    }\n\n    return `\n<!DOCTYPE html>\n<html>\n<head>\n\t<meta charset=\"UTF-8\">\n\t<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n\t<style>\n\t\tbody {\n\t\t\tfont-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n\t\t\tline-height: 1.6;\n\t\t\tcolor: #333;\n\t\t\tmax-width: 600px;\n\t\t\tmargin: 0 auto;\n\t\t\tpadding: 20px;\n\t\t}\n\t\t.header {\n\t\t\tbackground-color: ${color};\n\t\t\tcolor: white;\n\t\t\tpadding: 20px;\n\t\t\tborder-radius: 8px 8px 0 0;\n\t\t}\n\t\t.header h1 {\n\t\t\tmargin: 0;\n\t\t\tfont-size: 24px;\n\t\t}\n\t\t.content {\n\t\t\tbackground-color: #f9fafb;\n\t\t\tpadding: 20px;\n\t\t\tborder: 1px solid #e5e7eb;\n\t\t\tborder-top: none;\n\t\t\tborder-radius: 0 0 8px 8px;\n\t\t}\n\t\t.detail {\n\t\t\tmargin: 10px 0;\n\t\t}\n\t\t.label {\n\t\t\tfont-weight: 600;\n\t\t\tcolor: #6b7280;\n\t\t}\n\t\t.value {\n\t\t\tcolor: #111827;\n\t\t}\n\t\t.data {\n\t\t\tbackground-color: white;\n\t\t\tborder: 1px solid #e5e7eb;\n\t\t\tborder-radius: 4px;\n\t\t\tpadding: 15px;\n\t\t\tmargin-top: 15px;\n\t\t\toverflow-x: auto;\n\t\t}\n\t\tpre {\n\t\t\tmargin: 0;\n\t\t\tfont-size: 12px;\n\t\t}\n\t\t.footer {\n\t\t\tmargin-top: 20px;\n\t\t\tpadding-top: 20px;\n\t\t\tborder-top: 1px solid #e5e7eb;\n\t\t\ttext-align: center;\n\t\t\tcolor: #6b7280;\n\t\t\tfont-size: 14px;\n\t\t}\n\t</style>\n</head>\n<body>\n\t<div class=\"header\">\n\t\t<h1>${eventData.event}</h1>\n\t</div>\n\t<div class=\"content\">\n\t\t<div class=\"detail\">\n\t\t\t<span class=\"label\">Timestamp:</span>\n\t\t\t<span class=\"value\">${eventData.timestamp}</span>\n\t\t</div>\n\t\t<div class=\"data\">\n\t\t\t<pre>${JSON.stringify(eventData.data, null, 2)}</pre>\n\t\t</div>\n\t</div>\n\t<div class=\"footer\">\n\t\tThis is an automated notification from Conductor.\n\t</div>\n</body>\n</html>\n\t\t`.trim()\n  }\n\n  /**\n   * Send email using MailChannels API\n   */\n  private async sendEmail(emailData: EmailNotificationData, _env: ConductorEnv): Promise<void> {\n    // Use MailChannels API (free for Cloudflare Workers)\n    const response = await fetch('https://api.mailchannels.net/tx/v1/send', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify({\n        personalizations: [\n          {\n            to: emailData.to.map((email) => ({ email })),\n          },\n        ],\n        from: {\n          email: emailData.from,\n          name: 'Conductor Notifications',\n        },\n        subject: emailData.subject,\n        content: [\n          {\n            type: 'text/plain',\n            value: emailData.text,\n          },\n          {\n            type: 'text/html',\n            value: emailData.html || emailData.text,\n          },\n        ],\n      }),\n    })\n\n    if (!response.ok) {\n      const errorText = await response.text().catch(() => 'Unknown error')\n      throw new Error(`MailChannels API error: ${response.status} - ${errorText}`)\n    }\n  }\n}\n","/**\n * Notification Manager\n *\n * Coordinates outbound notifications (webhooks and email) for ensemble events\n */\n\nimport type { EnsembleConfig, NotificationConfig } from '../parser.js'\nimport type {\n  NotificationEvent,\n  NotificationEventData,\n  NotificationDeliveryResult,\n} from './types.js'\nimport { WebhookNotifier } from './webhook-notifier.js'\nimport { EmailNotifier } from './email-notifier.js'\nimport { createLogger } from '../../observability/index.js'\nimport type { ConductorEnv } from '../../types/env.js'\n\nconst logger = createLogger({ serviceName: 'notification-manager' })\n\nexport class NotificationManager {\n  /**\n   * Send notifications for an event\n   */\n  static async notify(\n    ensemble: EnsembleConfig,\n    event: NotificationEvent,\n    eventData: Record<string, unknown>,\n    env: ConductorEnv\n  ): Promise<NotificationDeliveryResult[]> {\n    // Check if ensemble has notifications configured\n    if (!ensemble.notifications || ensemble.notifications.length === 0) {\n      return []\n    }\n\n    // Build event data\n    const notificationEvent: NotificationEventData = {\n      event,\n      timestamp: new Date().toISOString(),\n      data: {\n        ensemble: ensemble.name,\n        ...eventData,\n      },\n    }\n\n    // Filter notifications that should be triggered for this event\n    const relevantNotifications = ensemble.notifications.filter((notification) =>\n      notification.events.includes(event)\n    )\n\n    if (relevantNotifications.length === 0) {\n      return []\n    }\n\n    logger.info('Sending notifications', {\n      ensemble: ensemble.name,\n      event,\n      count: relevantNotifications.length,\n    })\n\n    // Send all notifications in parallel\n    const results = await Promise.all(\n      relevantNotifications.map((notification) =>\n        this.sendNotification(notification, notificationEvent, env)\n      )\n    )\n\n    // Log results\n    const successful = results.filter((r) => r.success).length\n    const failed = results.filter((r) => !r.success).length\n\n    logger.info('Notifications sent', {\n      ensemble: ensemble.name,\n      event,\n      total: results.length,\n      successful,\n      failed,\n    })\n\n    return results\n  }\n\n  /**\n   * Send a single notification\n   */\n  private static async sendNotification(\n    config: NotificationConfig,\n    eventData: NotificationEventData,\n    env: ConductorEnv\n  ): Promise<NotificationDeliveryResult> {\n    try {\n      switch (config.type) {\n        case 'webhook': {\n          const notifier = new WebhookNotifier({\n            url: config.url,\n            secret: config.secret,\n            retries: config.retries,\n            timeout: config.timeout,\n          })\n          return await notifier.send(eventData)\n        }\n\n        case 'email': {\n          const notifier = new EmailNotifier({\n            to: config.to,\n            from: config.from,\n            subject: config.subject,\n            events: config.events,\n          })\n          return await notifier.send(eventData, env)\n        }\n\n        default: {\n          // Exhaustive type check - should never reach here with valid configs\n          const exhaustiveCheck: never = config\n          throw new Error(\n            `Unknown notification type: ${(exhaustiveCheck as { type: string }).type}`\n          )\n        }\n      }\n    } catch (error) {\n      logger.error('Notification failed', error instanceof Error ? error : undefined, {\n        type: config.type,\n        event: eventData.event,\n      })\n\n      // Determine target based on type\n      const target =\n        config.type === 'webhook'\n          ? config.url\n          : config.type === 'email'\n            ? config.to.join(', ')\n            : 'unknown'\n\n      return {\n        success: false,\n        type: config.type,\n        target,\n        event: eventData.event,\n        duration: 0,\n        error: error instanceof Error ? error.message : 'Unknown error',\n      }\n    }\n  }\n\n  /**\n   * Emit an event (convenience method for common events)\n   */\n  static async emitExecutionStarted(\n    ensemble: EnsembleConfig,\n    executionId: string,\n    input: Record<string, unknown>,\n    env: ConductorEnv\n  ): Promise<NotificationDeliveryResult[]> {\n    return this.notify(\n      ensemble,\n      'execution.started',\n      {\n        id: executionId,\n        input,\n      },\n      env\n    )\n  }\n\n  static async emitExecutionCompleted(\n    ensemble: EnsembleConfig,\n    executionId: string,\n    output: unknown,\n    duration: number,\n    env: ConductorEnv\n  ): Promise<NotificationDeliveryResult[]> {\n    return this.notify(\n      ensemble,\n      'execution.completed',\n      {\n        id: executionId,\n        status: 'completed',\n        output,\n        duration,\n      },\n      env\n    )\n  }\n\n  static async emitExecutionFailed(\n    ensemble: EnsembleConfig,\n    executionId: string,\n    error: Error,\n    duration: number,\n    env: ConductorEnv\n  ): Promise<NotificationDeliveryResult[]> {\n    return this.notify(\n      ensemble,\n      'execution.failed',\n      {\n        id: executionId,\n        status: 'failed',\n        error: {\n          message: error.message,\n          stack: error.stack,\n        },\n        duration,\n      },\n      env\n    )\n  }\n\n  static async emitExecutionTimeout(\n    ensemble: EnsembleConfig,\n    executionId: string,\n    duration: number,\n    timeout: number,\n    env: ConductorEnv\n  ): Promise<NotificationDeliveryResult[]> {\n    return this.notify(\n      ensemble,\n      'execution.timeout',\n      {\n        id: executionId,\n        duration,\n        timeout,\n      },\n      env\n    )\n  }\n\n  static async emitAgentCompleted(\n    ensemble: EnsembleConfig,\n    executionId: string,\n    agentName: string,\n    output: unknown,\n    duration: number,\n    env: Env\n  ): Promise<NotificationDeliveryResult[]> {\n    return this.notify(\n      ensemble,\n      'agent.completed',\n      {\n        executionId,\n        agent: agentName,\n        output,\n        duration,\n      },\n      env\n    )\n  }\n\n  static async emitStateUpdated(\n    ensemble: EnsembleConfig,\n    executionId: string,\n    state: Record<string, unknown>,\n    env: Env\n  ): Promise<NotificationDeliveryResult[]> {\n    return this.notify(\n      ensemble,\n      'state.updated',\n      {\n        executionId,\n        state,\n      },\n      env\n    )\n  }\n}\n","/**\n * Schema Registry\n *\n * Provides typed access to JSON schemas with validation support.\n * Wraps the ComponentRegistry for schema-specific operations.\n *\n * @module components/schemas\n */\n\nimport { parseNameWithVersion, type ComponentRegistry } from './registry.js'\n\n/**\n * JSON Schema type (simplified)\n */\nexport interface JSONSchema {\n  type?: string | string[]\n  properties?: Record<string, JSONSchema>\n  required?: string[]\n  items?: JSONSchema | JSONSchema[]\n  additionalProperties?: boolean | JSONSchema\n  enum?: any[]\n  const?: any\n  allOf?: JSONSchema[]\n  anyOf?: JSONSchema[]\n  oneOf?: JSONSchema[]\n  not?: JSONSchema\n  if?: JSONSchema\n  then?: JSONSchema\n  else?: JSONSchema\n  $ref?: string\n  $defs?: Record<string, JSONSchema>\n  definitions?: Record<string, JSONSchema>\n  title?: string\n  description?: string\n  default?: any\n  examples?: any[]\n  format?: string\n  pattern?: string\n  minLength?: number\n  maxLength?: number\n  minimum?: number\n  maximum?: number\n  exclusiveMinimum?: number\n  exclusiveMaximum?: number\n  multipleOf?: number\n  minItems?: number\n  maxItems?: number\n  uniqueItems?: boolean\n  minProperties?: number\n  maxProperties?: number\n  [key: string]: any\n}\n\n/**\n * Validation result from schema validation\n */\nexport interface ValidationResult {\n  /** Whether the data is valid */\n  valid: boolean\n  /** List of validation errors (empty if valid) */\n  errors: ValidationError[]\n}\n\n/**\n * Individual validation error\n */\nexport interface ValidationError {\n  /** JSON path to the invalid property */\n  path: string\n  /** Human-readable error message */\n  message: string\n  /** JSON Schema keyword that failed (e.g., 'required', 'type') */\n  keyword: string\n  /** Expected value/type */\n  expected?: any\n  /** Actual value received */\n  actual?: any\n}\n\n/**\n * Schema registry - access and validate against schemas\n *\n * @example\n * ```typescript\n * // Get a schema\n * const schema = await ctx.schemas.get('order')\n * const schemaWithVersion = await ctx.schemas.get('order@v1.0.0')\n *\n * // Validate data\n * const result = await ctx.schemas.validate('order', orderData)\n * if (!result.valid) {\n *   console.log(result.errors)\n * }\n *\n * // Quick boolean check\n * if (await ctx.schemas.isValid('order', orderData)) {\n *   // process valid order\n * }\n * ```\n */\nexport class SchemaRegistry {\n  constructor(private parent: ComponentRegistry) {}\n\n  /**\n   * Get a schema by name (with optional @version)\n   *\n   * @param nameOrRef - Schema name with optional version\n   * @returns JSON Schema object\n   *\n   * @example\n   * ```typescript\n   * ctx.schemas.get('order')           // order@latest\n   * ctx.schemas.get('order@v1.0.0')    // exact version\n   * ctx.schemas.get('order@^2.0.0')    // semver range\n   * ```\n   */\n  async get(nameOrRef: string): Promise<JSONSchema> {\n    const { name, version } = parseNameWithVersion(nameOrRef)\n    const ref = `schemas/${name}@${version}`\n    return this.parent.resolve(ref)\n  }\n\n  /**\n   * Validate data against a schema\n   *\n   * Uses a lightweight JSON Schema validator optimized for Workers.\n   * Supports most JSON Schema Draft 7 features.\n   *\n   * @param nameOrRef - Schema name with optional version\n   * @param data - Data to validate\n   * @returns Validation result with errors\n   *\n   * @example\n   * ```typescript\n   * const result = await ctx.schemas.validate('order@v1.0.0', orderData)\n   * if (!result.valid) {\n   *   console.log('Validation errors:', result.errors)\n   * }\n   * ```\n   */\n  async validate(nameOrRef: string, data: any): Promise<ValidationResult> {\n    const schema = await this.get(nameOrRef)\n    return validateJsonSchema(schema, data)\n  }\n\n  /**\n   * Check if data matches schema (returns boolean)\n   *\n   * Convenience method for simple valid/invalid checks.\n   *\n   * @param nameOrRef - Schema name with optional version\n   * @param data - Data to validate\n   * @returns True if valid\n   *\n   * @example\n   * ```typescript\n   * if (await ctx.schemas.isValid('order', orderData)) {\n   *   await processOrder(orderData)\n   * }\n   * ```\n   */\n  async isValid(nameOrRef: string, data: any): Promise<boolean> {\n    const result = await this.validate(nameOrRef, data)\n    return result.valid\n  }\n\n  /**\n   * Check if a schema exists\n   *\n   * @param nameOrRef - Schema name with optional version\n   * @returns True if schema exists\n   */\n  async exists(nameOrRef: string): Promise<boolean> {\n    try {\n      await this.get(nameOrRef)\n      return true\n    } catch {\n      return false\n    }\n  }\n}\n\n/**\n * Lightweight JSON Schema validator\n *\n * Optimized for Cloudflare Workers - no external dependencies.\n * Supports most JSON Schema Draft 7 features.\n */\nexport function validateJsonSchema(\n  schema: JSONSchema | boolean,\n  data: any,\n  path: string = ''\n): ValidationResult {\n  const errors: ValidationError[] = []\n\n  // Helper to add error\n  const addError = (keyword: string, message: string, expected?: any, actual?: any) => {\n    errors.push({ path: path || '/', keyword, message, expected, actual })\n  }\n\n  // Handle boolean schemas (JSON Schema Draft 6+)\n  // true matches everything, false matches nothing\n  if (schema === true) {\n    return { valid: true, errors: [] }\n  }\n\n  if (schema === false) {\n    addError('false', 'Schema is false - no data is valid')\n    return { valid: false, errors }\n  }\n\n  // Handle null/undefined schema (matches everything)\n  if (schema === null || schema === undefined) {\n    return { valid: true, errors: [] }\n  }\n\n  // Type validation\n  if (schema.type !== undefined) {\n    const types = Array.isArray(schema.type) ? schema.type : [schema.type]\n    const actualType = getJsonType(data)\n\n    if (!types.includes(actualType)) {\n      // Handle integer as a special case of number\n      if (!(types.includes('integer') && actualType === 'number' && Number.isInteger(data))) {\n        addError('type', `Expected ${types.join(' or ')}, got ${actualType}`, types, actualType)\n      }\n    }\n  }\n\n  // Const validation\n  if (schema.const !== undefined) {\n    if (!deepEqual(data, schema.const)) {\n      addError('const', `Value must be ${JSON.stringify(schema.const)}`, schema.const, data)\n    }\n  }\n\n  // Enum validation\n  if (schema.enum !== undefined) {\n    if (!schema.enum.some((e: any) => deepEqual(data, e))) {\n      addError('enum', `Value must be one of: ${JSON.stringify(schema.enum)}`, schema.enum, data)\n    }\n  }\n\n  // String validations\n  if (typeof data === 'string') {\n    if (schema.minLength !== undefined && data.length < schema.minLength) {\n      addError(\n        'minLength',\n        `String must be at least ${schema.minLength} characters`,\n        schema.minLength,\n        data.length\n      )\n    }\n    if (schema.maxLength !== undefined && data.length > schema.maxLength) {\n      addError(\n        'maxLength',\n        `String must be at most ${schema.maxLength} characters`,\n        schema.maxLength,\n        data.length\n      )\n    }\n    if (schema.pattern !== undefined) {\n      const regex = new RegExp(schema.pattern)\n      if (!regex.test(data)) {\n        addError('pattern', `String must match pattern: ${schema.pattern}`, schema.pattern, data)\n      }\n    }\n    // Format validation (basic)\n    if (schema.format !== undefined) {\n      const formatError = validateFormat(data, schema.format)\n      if (formatError) {\n        addError('format', formatError, schema.format, data)\n      }\n    }\n  }\n\n  // Number validations\n  if (typeof data === 'number') {\n    if (schema.minimum !== undefined && data < schema.minimum) {\n      addError('minimum', `Number must be >= ${schema.minimum}`, schema.minimum, data)\n    }\n    if (schema.maximum !== undefined && data > schema.maximum) {\n      addError('maximum', `Number must be <= ${schema.maximum}`, schema.maximum, data)\n    }\n    if (schema.exclusiveMinimum !== undefined && data <= schema.exclusiveMinimum) {\n      addError(\n        'exclusiveMinimum',\n        `Number must be > ${schema.exclusiveMinimum}`,\n        schema.exclusiveMinimum,\n        data\n      )\n    }\n    if (schema.exclusiveMaximum !== undefined && data >= schema.exclusiveMaximum) {\n      addError(\n        'exclusiveMaximum',\n        `Number must be < ${schema.exclusiveMaximum}`,\n        schema.exclusiveMaximum,\n        data\n      )\n    }\n    if (schema.multipleOf !== undefined && data % schema.multipleOf !== 0) {\n      addError(\n        'multipleOf',\n        `Number must be a multiple of ${schema.multipleOf}`,\n        schema.multipleOf,\n        data\n      )\n    }\n  }\n\n  // Array validations\n  if (Array.isArray(data)) {\n    if (schema.minItems !== undefined && data.length < schema.minItems) {\n      addError(\n        'minItems',\n        `Array must have at least ${schema.minItems} items`,\n        schema.minItems,\n        data.length\n      )\n    }\n    if (schema.maxItems !== undefined && data.length > schema.maxItems) {\n      addError(\n        'maxItems',\n        `Array must have at most ${schema.maxItems} items`,\n        schema.maxItems,\n        data.length\n      )\n    }\n    if (\n      schema.uniqueItems &&\n      new Set(data.map((item: any) => JSON.stringify(item))).size !== data.length\n    ) {\n      addError('uniqueItems', 'Array items must be unique')\n    }\n\n    // Validate items\n    if (schema.items) {\n      if (Array.isArray(schema.items)) {\n        // Tuple validation\n        schema.items.forEach((itemSchema, i) => {\n          if (i < data.length) {\n            const itemResult = validateJsonSchema(itemSchema, data[i], `${path}[${i}]`)\n            errors.push(...itemResult.errors)\n          }\n        })\n      } else {\n        // All items must match schema\n        data.forEach((item, i) => {\n          const itemResult = validateJsonSchema(schema.items as JSONSchema, item, `${path}[${i}]`)\n          errors.push(...itemResult.errors)\n        })\n      }\n    }\n  }\n\n  // Object validations\n  if (typeof data === 'object' && data !== null && !Array.isArray(data)) {\n    const dataKeys = Object.keys(data)\n\n    if (schema.minProperties !== undefined && dataKeys.length < schema.minProperties) {\n      addError(\n        'minProperties',\n        `Object must have at least ${schema.minProperties} properties`,\n        schema.minProperties,\n        dataKeys.length\n      )\n    }\n    if (schema.maxProperties !== undefined && dataKeys.length > schema.maxProperties) {\n      addError(\n        'maxProperties',\n        `Object must have at most ${schema.maxProperties} properties`,\n        schema.maxProperties,\n        dataKeys.length\n      )\n    }\n\n    // Required properties\n    if (schema.required) {\n      for (const req of schema.required) {\n        if (!(req in data)) {\n          errors.push({\n            path: `${path}/${req}`,\n            keyword: 'required',\n            message: `Missing required property: ${req}`,\n            expected: req,\n          })\n        }\n      }\n    }\n\n    // Validate properties\n    if (schema.properties) {\n      for (const [key, propSchema] of Object.entries(schema.properties)) {\n        if (key in data) {\n          const propResult = validateJsonSchema(propSchema, data[key], `${path}/${key}`)\n          errors.push(...propResult.errors)\n        }\n      }\n    }\n\n    // Additional properties\n    if (schema.additionalProperties === false) {\n      const allowedKeys = Object.keys(schema.properties || {})\n      const patternKeys = Object.keys(schema.patternProperties || {})\n      for (const key of dataKeys) {\n        if (!allowedKeys.includes(key) && !patternKeys.some((p) => new RegExp(p).test(key))) {\n          addError('additionalProperties', `Additional property not allowed: ${key}`, false, key)\n        }\n      }\n    }\n  }\n\n  // Combinators (allOf, anyOf, oneOf, not)\n  if (schema.allOf) {\n    for (let i = 0; i < schema.allOf.length; i++) {\n      const result = validateJsonSchema(schema.allOf[i], data, path)\n      errors.push(...result.errors)\n    }\n  }\n\n  if (schema.anyOf) {\n    const anyValid = schema.anyOf.some((s: JSONSchema) => validateJsonSchema(s, data, path).valid)\n    if (!anyValid) {\n      addError('anyOf', 'Data must match at least one schema in anyOf')\n    }\n  }\n\n  if (schema.oneOf) {\n    const matchCount = schema.oneOf.filter(\n      (s: JSONSchema) => validateJsonSchema(s, data, path).valid\n    ).length\n    if (matchCount !== 1) {\n      addError('oneOf', `Data must match exactly one schema in oneOf (matched ${matchCount})`)\n    }\n  }\n\n  if (schema.not) {\n    if (validateJsonSchema(schema.not, data, path).valid) {\n      addError('not', 'Data must not match the schema in not')\n    }\n  }\n\n  // Conditional (if/then/else)\n  if (schema.if) {\n    const ifValid = validateJsonSchema(schema.if, data, path).valid\n    if (ifValid && schema.then) {\n      const thenResult = validateJsonSchema(schema.then, data, path)\n      errors.push(...thenResult.errors)\n    } else if (!ifValid && schema.else) {\n      const elseResult = validateJsonSchema(schema.else, data, path)\n      errors.push(...elseResult.errors)\n    }\n  }\n\n  return {\n    valid: errors.length === 0,\n    errors,\n  }\n}\n\n/**\n * Get JSON type of a value\n */\nfunction getJsonType(value: any): string {\n  if (value === null) return 'null'\n  if (Array.isArray(value)) return 'array'\n  return typeof value\n}\n\n/**\n * Deep equality check\n */\nfunction deepEqual(a: any, b: any): boolean {\n  if (a === b) return true\n  if (typeof a !== typeof b) return false\n  if (typeof a !== 'object' || a === null || b === null) return false\n\n  if (Array.isArray(a) !== Array.isArray(b)) return false\n\n  if (Array.isArray(a)) {\n    if (a.length !== b.length) return false\n    return a.every((item, i) => deepEqual(item, b[i]))\n  }\n\n  const keysA = Object.keys(a)\n  const keysB = Object.keys(b)\n  if (keysA.length !== keysB.length) return false\n\n  return keysA.every((key) => key in b && deepEqual(a[key], b[key]))\n}\n\n/**\n * Validate string format\n */\nfunction validateFormat(value: string, format: string): string | null {\n  switch (format) {\n    case 'email':\n      // Basic email validation\n      if (!/^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(value)) {\n        return 'Invalid email format'\n      }\n      break\n    case 'uri':\n    case 'url':\n      try {\n        new URL(value)\n      } catch {\n        return 'Invalid URL format'\n      }\n      break\n    case 'uuid':\n      if (!/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(value)) {\n        return 'Invalid UUID format'\n      }\n      break\n    case 'date':\n      if (!/^\\d{4}-\\d{2}-\\d{2}$/.test(value) || isNaN(Date.parse(value))) {\n        return 'Invalid date format (expected YYYY-MM-DD)'\n      }\n      break\n    case 'date-time':\n      if (isNaN(Date.parse(value))) {\n        return 'Invalid date-time format'\n      }\n      break\n    case 'time':\n      if (!/^\\d{2}:\\d{2}:\\d{2}/.test(value)) {\n        return 'Invalid time format (expected HH:MM:SS)'\n      }\n      break\n    case 'ipv4':\n      if (\n        !/^(\\d{1,3}\\.){3}\\d{1,3}$/.test(value) ||\n        value.split('.').some((n) => parseInt(n) > 255)\n      ) {\n        return 'Invalid IPv4 address'\n      }\n      break\n    case 'ipv6':\n      // Simplified IPv6 check\n      if (\n        !/^([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}$/.test(value) &&\n        !/^([0-9a-fA-F]{1,4}:)*:([0-9a-fA-F]{1,4}:)*[0-9a-fA-F]{1,4}$/.test(value)\n      ) {\n        return 'Invalid IPv6 address'\n      }\n      break\n    // Add more formats as needed\n  }\n  return null\n}\n","/**\n * Prompt Registry\n *\n * Provides typed access to prompt templates with rendering support.\n * Wraps the ComponentRegistry for prompt-specific operations.\n *\n * @module components/prompts\n */\n\nimport { parseNameWithVersion, type ComponentRegistry } from './registry.js'\n\n/**\n * Prompt template with optional metadata\n */\nexport interface PromptTemplate {\n  /** The prompt template content */\n  content: string\n  /** Optional metadata about the prompt */\n  metadata?: {\n    /** Prompt name */\n    name?: string\n    /** Prompt description */\n    description?: string\n    /** Expected variables */\n    variables?: string[]\n    /** Version */\n    version?: string\n  }\n}\n\n/**\n * Prompt registry - access and render prompts\n *\n * @example\n * ```typescript\n * // Get a prompt template\n * const prompt = await ctx.prompts.get('extraction')\n * const promptWithVersion = await ctx.prompts.get('extraction@v1.0.0')\n *\n * // Render with variables\n * const rendered = await ctx.prompts.render('docs-writer', {\n *   page: 'getting-started',\n *   projectName: 'MyApp'\n * })\n * ```\n */\nexport class PromptRegistry {\n  constructor(private parent: ComponentRegistry) {}\n\n  /**\n   * Get a prompt template by name (with optional @version)\n   *\n   * Returns the raw prompt template string.\n   *\n   * @param nameOrRef - Prompt name with optional version\n   * @returns Prompt template string\n   *\n   * @example\n   * ```typescript\n   * ctx.prompts.get('extraction')           // extraction@latest\n   * ctx.prompts.get('extraction@v1.0.0')    // exact version\n   * ```\n   */\n  async get(nameOrRef: string): Promise<string> {\n    const { name, version } = parseNameWithVersion(nameOrRef)\n    const ref = `prompts/${name}@${version}`\n    const content = await this.parent.resolve(ref)\n\n    // Handle both string prompts and prompt objects with content field\n    if (typeof content === 'string') {\n      return content\n    }\n    if (content && typeof content.content === 'string') {\n      return content.content\n    }\n\n    return String(content)\n  }\n\n  /**\n   * Get prompt with metadata\n   *\n   * @param nameOrRef - Prompt name with optional version\n   * @returns Prompt template with metadata\n   */\n  async getWithMetadata(nameOrRef: string): Promise<PromptTemplate> {\n    const { name, version } = parseNameWithVersion(nameOrRef)\n    const ref = `prompts/${name}@${version}`\n    const resolved = await this.parent.resolveWithMetadata(ref)\n\n    const content = resolved.content\n\n    // Handle both string prompts and prompt objects\n    if (typeof content === 'string') {\n      return {\n        content,\n        metadata: {\n          name,\n          version: resolved.metadata?.version || version,\n        },\n      }\n    }\n\n    if (content && typeof content.content === 'string') {\n      return {\n        content: content.content,\n        metadata: {\n          name,\n          description: content.description,\n          variables: content.variables,\n          version: resolved.metadata?.version || version,\n        },\n      }\n    }\n\n    return {\n      content: String(content),\n      metadata: { name, version },\n    }\n  }\n\n  /**\n   * Render a prompt with variables (Handlebars)\n   *\n   * Uses Handlebars templating to replace variables in the prompt.\n   *\n   * @param nameOrRef - Prompt name with optional version\n   * @param variables - Variables to inject into the template\n   * @returns Rendered prompt string\n   *\n   * @example\n   * ```typescript\n   * const rendered = await ctx.prompts.render('docs-writer@v1.0.0', {\n   *   page: 'getting-started',\n   *   projectName: 'MyApp'\n   * })\n   * ```\n   */\n  async render(nameOrRef: string, variables: Record<string, any>): Promise<string> {\n    const template = await this.get(nameOrRef)\n    return renderHandlebars(template, variables)\n  }\n\n  /**\n   * Check if a prompt exists\n   *\n   * @param nameOrRef - Prompt name with optional version\n   * @returns True if prompt exists\n   */\n  async exists(nameOrRef: string): Promise<boolean> {\n    try {\n      await this.get(nameOrRef)\n      return true\n    } catch {\n      return false\n    }\n  }\n\n  /**\n   * List variables used in a prompt template\n   *\n   * Extracts Handlebars variable references from the template.\n   *\n   * @param nameOrRef - Prompt name with optional version\n   * @returns Array of variable names\n   *\n   * @example\n   * ```typescript\n   * const vars = await ctx.prompts.listVariables('docs-writer')\n   * // ['page', 'projectName', 'description']\n   * ```\n   */\n  async listVariables(nameOrRef: string): Promise<string[]> {\n    const template = await this.get(nameOrRef)\n    return extractHandlebarsVariables(template)\n  }\n}\n\n/**\n * Render a Handlebars template\n *\n * Lightweight implementation optimized for Workers.\n * Supports basic Handlebars features:\n * - {{variable}} - Variable substitution\n * - {{nested.path}} - Nested property access\n * - {{#if condition}}...{{/if}} - Conditionals\n * - {{#each items}}...{{/each}} - Iteration\n * - {{#unless condition}}...{{/unless}} - Negative conditionals\n * - {{@index}}, {{@key}} - Loop context\n *\n * @param template - Handlebars template string\n * @param variables - Variables to inject\n * @returns Rendered string\n */\nexport function renderHandlebars(template: string, variables: Record<string, any>): string {\n  // Use dynamic import to avoid circular dependencies\n  // We'll implement a lightweight version for basic cases\n  return renderLightweightHandlebars(template, variables)\n}\n\n/**\n * Lightweight Handlebars-like renderer\n *\n * Handles most common template patterns without heavy dependencies.\n */\nfunction renderLightweightHandlebars(template: string, context: Record<string, any>): string {\n  let result = template\n\n  // Helper to get nested value\n  const getValue = (path: string, ctx: Record<string, any>): any => {\n    const parts = path.split('.')\n    let value: any = ctx\n    for (const part of parts) {\n      if (value === null || value === undefined) return undefined\n      value = value[part]\n    }\n    return value\n  }\n\n  // Process {{#each items}}...{{/each}}\n  result = result.replace(\n    /\\{\\{#each\\s+(\\w+(?:\\.\\w+)*)\\}\\}([\\s\\S]*?)\\{\\{\\/each\\}\\}/g,\n    (_, path, content) => {\n      const items = getValue(path, context)\n      if (!Array.isArray(items)) return ''\n      return items\n        .map((item, index) => {\n          let itemContent = content\n          // Replace {{this}} with the item\n          itemContent = itemContent.replace(/\\{\\{this\\}\\}/g, String(item ?? ''))\n          // Replace {{@index}}\n          itemContent = itemContent.replace(/\\{\\{@index\\}\\}/g, String(index))\n          // Replace item properties if item is an object\n          if (typeof item === 'object' && item !== null) {\n            itemContent = renderLightweightHandlebars(itemContent, { ...context, ...item })\n          }\n          return itemContent\n        })\n        .join('')\n    }\n  )\n\n  // Process {{#if condition}}...{{else}}...{{/if}}\n  result = result.replace(\n    /\\{\\{#if\\s+(\\w+(?:\\.\\w+)*)\\}\\}([\\s\\S]*?)(?:\\{\\{else\\}\\}([\\s\\S]*?))?\\{\\{\\/if\\}\\}/g,\n    (_, path, ifContent, elseContent = '') => {\n      const value = getValue(path, context)\n      const isTruthy =\n        value !== false && value !== null && value !== undefined && value !== '' && value !== 0\n      return isTruthy\n        ? renderLightweightHandlebars(ifContent, context)\n        : renderLightweightHandlebars(elseContent, context)\n    }\n  )\n\n  // Process {{#unless condition}}...{{/unless}}\n  result = result.replace(\n    /\\{\\{#unless\\s+(\\w+(?:\\.\\w+)*)\\}\\}([\\s\\S]*?)\\{\\{\\/unless\\}\\}/g,\n    (_, path, content) => {\n      const value = getValue(path, context)\n      const isTruthy =\n        value !== false && value !== null && value !== undefined && value !== '' && value !== 0\n      return isTruthy ? '' : renderLightweightHandlebars(content, context)\n    }\n  )\n\n  // Process {{#with obj}}...{{/with}}\n  result = result.replace(\n    /\\{\\{#with\\s+(\\w+(?:\\.\\w+)*)\\}\\}([\\s\\S]*?)\\{\\{\\/with\\}\\}/g,\n    (_, path, content) => {\n      const value = getValue(path, context)\n      if (typeof value !== 'object' || value === null) return ''\n      return renderLightweightHandlebars(content, { ...context, ...value })\n    }\n  )\n\n  // Replace {{variable}} and {{nested.path}}\n  result = result.replace(/\\{\\{([^#/][^}]*)\\}\\}/g, (_, path) => {\n    const trimmedPath = path.trim()\n    const value = getValue(trimmedPath, context)\n    if (value === undefined || value === null) return ''\n    if (typeof value === 'object') return JSON.stringify(value)\n    return String(value)\n  })\n\n  return result\n}\n\n/**\n * Extract variable names from a Handlebars template\n *\n * @param template - Handlebars template string\n * @returns Array of unique variable names\n */\nfunction extractHandlebarsVariables(template: string): string[] {\n  const variables = new Set<string>()\n\n  // Match {{variable}} and {{nested.path}}\n  const varRegex = /\\{\\{([^#/][^}]*)\\}\\}/g\n  let match\n  while ((match = varRegex.exec(template)) !== null) {\n    const path = match[1].trim()\n    // Skip special variables like @index, @key\n    if (!path.startsWith('@')) {\n      // Get root variable name\n      const rootVar = path.split('.')[0]\n      variables.add(rootVar)\n    }\n  }\n\n  // Match {{#each items}}\n  const eachRegex = /\\{\\{#each\\s+(\\w+)/g\n  while ((match = eachRegex.exec(template)) !== null) {\n    variables.add(match[1])\n  }\n\n  // Match {{#if condition}}\n  const ifRegex = /\\{\\{#if\\s+(\\w+(?:\\.\\w+)*)\\}\\}/g\n  while ((match = ifRegex.exec(template)) !== null) {\n    const rootVar = match[1].split('.')[0]\n    variables.add(rootVar)\n  }\n\n  // Match {{#unless condition}}\n  const unlessRegex = /\\{\\{#unless\\s+(\\w+(?:\\.\\w+)*)\\}\\}/g\n  while ((match = unlessRegex.exec(template)) !== null) {\n    const rootVar = match[1].split('.')[0]\n    variables.add(rootVar)\n  }\n\n  // Match {{#with obj}}\n  const withRegex = /\\{\\{#with\\s+(\\w+)/g\n  while ((match = withRegex.exec(template)) !== null) {\n    variables.add(match[1])\n  }\n\n  return Array.from(variables).sort()\n}\n","/**\n * Config Component Registry\n *\n * Provides typed access to config components.\n * Wraps the ComponentRegistry for config-specific operations.\n *\n * @module components/configs\n */\n\nimport { parseNameWithVersion, type ComponentRegistry } from './registry.js'\n\n/**\n * Config component registry - access config components\n *\n * Config components are reusable configuration objects that can be\n * shared across agents and ensembles. They're stored in KV and\n * versioned like other components.\n *\n * @example\n * ```typescript\n * // Get a config component\n * const settings = await ctx.configs.get('docs-settings')\n * const settingsWithVersion = await ctx.configs.get('docs-settings@v1.0.0')\n *\n * // Type-safe access\n * interface DocsSettings {\n *   theme: string\n *   includeExamples: boolean\n * }\n * const typedSettings = await ctx.configs.get<DocsSettings>('docs-settings')\n * ```\n */\nexport class ConfigRegistry {\n  constructor(private parent: ComponentRegistry) {}\n\n  /**\n   * Get a config component by name (with optional @version)\n   *\n   * @param nameOrRef - Config name with optional version\n   * @returns Config object (typed with generic parameter)\n   *\n   * @example\n   * ```typescript\n   * ctx.configs.get('settings')           // settings@latest\n   * ctx.configs.get('settings@v1.0.0')    // exact version\n   * ctx.configs.get<MySettings>('settings') // typed\n   * ```\n   */\n  async get<T = Record<string, any>>(nameOrRef: string): Promise<T> {\n    const { name, version } = parseNameWithVersion(nameOrRef)\n    const ref = `configs/${name}@${version}`\n    return this.parent.resolve(ref)\n  }\n\n  /**\n   * Get a config value at a specific path\n   *\n   * Allows accessing nested properties directly.\n   *\n   * @param nameOrRef - Config name with optional version\n   * @param path - Dot-separated path to the value\n   * @returns Value at the path\n   *\n   * @example\n   * ```typescript\n   * // Get nested value\n   * const theme = await ctx.configs.getValue('docs-settings', 'theme.primaryColor')\n   * const aiEnabled = await ctx.configs.getValue('docs-settings', 'ai.enabled')\n   * ```\n   */\n  async getValue<T = any>(nameOrRef: string, path: string): Promise<T | undefined> {\n    const config = await this.get(nameOrRef)\n    return getNestedValue(config, path)\n  }\n\n  /**\n   * Get a config value with a default fallback\n   *\n   * @param nameOrRef - Config name with optional version\n   * @param path - Dot-separated path to the value\n   * @param defaultValue - Default value if path doesn't exist\n   * @returns Value at the path or default\n   *\n   * @example\n   * ```typescript\n   * const theme = await ctx.configs.getValueOrDefault(\n   *   'docs-settings',\n   *   'theme.primaryColor',\n   *   '#3B82F6'\n   * )\n   * ```\n   */\n  async getValueOrDefault<T>(nameOrRef: string, path: string, defaultValue: T): Promise<T> {\n    const value = await this.getValue<T>(nameOrRef, path)\n    return value !== undefined ? value : defaultValue\n  }\n\n  /**\n   * Check if a config component exists\n   *\n   * @param nameOrRef - Config name with optional version\n   * @returns True if config exists\n   */\n  async exists(nameOrRef: string): Promise<boolean> {\n    try {\n      await this.get(nameOrRef)\n      return true\n    } catch {\n      return false\n    }\n  }\n\n  /**\n   * Check if a config has a specific path\n   *\n   * @param nameOrRef - Config name with optional version\n   * @param path - Dot-separated path to check\n   * @returns True if path exists\n   */\n  async hasPath(nameOrRef: string, path: string): Promise<boolean> {\n    const value = await this.getValue(nameOrRef, path)\n    return value !== undefined\n  }\n\n  /**\n   * Merge a config with overrides\n   *\n   * Returns a new object with overrides applied (does not modify stored config).\n   *\n   * @param nameOrRef - Config name with optional version\n   * @param overrides - Values to override\n   * @returns Merged config object\n   *\n   * @example\n   * ```typescript\n   * const customSettings = await ctx.configs.merge('docs-settings', {\n   *   theme: { primaryColor: '#FF0000' }\n   * })\n   * ```\n   */\n  async merge<T = Record<string, any>>(nameOrRef: string, overrides: Partial<T>): Promise<T> {\n    const base = await this.get<T>(nameOrRef)\n    return deepMerge(base as Record<string, any>, overrides as Record<string, any>) as T\n  }\n}\n\n/**\n * Get a nested value from an object using dot notation\n *\n * @param obj - Object to get value from\n * @param path - Dot-separated path\n * @returns Value at path or undefined\n */\nfunction getNestedValue(obj: any, path: string): any {\n  const parts = path.split('.')\n  let current = obj\n\n  for (const part of parts) {\n    if (current === null || current === undefined) {\n      return undefined\n    }\n    current = current[part]\n  }\n\n  return current\n}\n\n/**\n * Deep merge two objects\n *\n * @param target - Base object\n * @param source - Object with overrides\n * @returns New merged object\n */\nfunction deepMerge<T extends Record<string, unknown>>(target: T, source: Partial<T>): T {\n  const result = { ...target } as Record<string, unknown>\n\n  for (const key of Object.keys(source)) {\n    const sourceValue = source[key as keyof typeof source]\n    const targetValue = target[key as keyof T]\n\n    if (\n      sourceValue !== null &&\n      typeof sourceValue === 'object' &&\n      !Array.isArray(sourceValue) &&\n      targetValue !== null &&\n      typeof targetValue === 'object' &&\n      !Array.isArray(targetValue)\n    ) {\n      // Recursively merge objects\n      result[key] = deepMerge(\n        targetValue as Record<string, unknown>,\n        sourceValue as Partial<Record<string, unknown>>\n      )\n    } else if (sourceValue !== undefined) {\n      // Override with source value\n      result[key] = sourceValue\n    }\n  }\n\n  return result as T\n}\n","/**\n * Query Registry\n *\n * Provides typed access to SQL query templates from KV storage.\n * Queries support versioning and can be used with Data agents.\n *\n * @module components/queries\n */\n\nimport type { ComponentRegistry } from './registry.js'\nimport { parseNameWithVersion } from './registry.js'\n\n/**\n * SQL Query template loaded from KV\n */\nexport interface QueryTemplate {\n  /** Raw SQL query string (may contain placeholders) */\n  sql: string\n  /** Optional description */\n  description?: string\n  /** Parameter definitions */\n  parameters?: Record<string, { type: string; description?: string }>\n}\n\n/**\n * Query registry for accessing SQL query templates\n *\n * @example\n * ```typescript\n * export default async function(ctx: AgentExecutionContext) {\n *   const { queries } = ctx\n *\n *   // Get a query template\n *   const query = await queries.get('find-users@v1.0.0')\n *\n *   // Get raw SQL\n *   const sql = await queries.getSql('find-users')\n *\n *   // Execute with D1\n *   const stmt = ctx.env.DB.prepare(sql)\n *   const results = await stmt.bind(userId).all()\n *\n *   return { users: results.results }\n * }\n * ```\n */\nexport class QueryRegistry {\n  constructor(private parent: ComponentRegistry) {}\n\n  /**\n   * Get a query template by name (with optional @version)\n   *\n   * @param nameOrRef - Query name with optional version (e.g., \"find-users\" or \"find-users@v1.0.0\")\n   * @returns Query template object\n   *\n   * @example\n   * queries.get('find-users')           // find-users@latest\n   * queries.get('find-users@v1.0.0')    // exact version\n   */\n  async get(nameOrRef: string): Promise<QueryTemplate> {\n    const { name, version } = parseNameWithVersion(nameOrRef)\n    const ref = `queries/${name}@${version}`\n    const content = await this.parent.resolve(ref)\n\n    // Handle both raw SQL string and structured query object\n    if (typeof content === 'string') {\n      return { sql: content }\n    }\n    return content as QueryTemplate\n  }\n\n  /**\n   * Get raw SQL string from a query template\n   *\n   * @param nameOrRef - Query name with optional version\n   * @returns Raw SQL string\n   */\n  async getSql(nameOrRef: string): Promise<string> {\n    const template = await this.get(nameOrRef)\n    return template.sql\n  }\n\n  /**\n   * Check if a query exists\n   *\n   * @param nameOrRef - Query name with optional version\n   * @returns True if query exists\n   */\n  async exists(nameOrRef: string): Promise<boolean> {\n    try {\n      await this.get(nameOrRef)\n      return true\n    } catch {\n      return false\n    }\n  }\n}\n","/**\n * Script Registry\n *\n * Provides typed access to JavaScript/TypeScript scripts from KV storage.\n * Scripts can be dynamically loaded and executed at runtime.\n *\n * @module components/scripts\n */\n\nimport type { ComponentRegistry } from './registry.js'\nimport { parseNameWithVersion } from './registry.js'\n\n/**\n * Script metadata\n */\nexport interface ScriptMetadata {\n  /** Script name */\n  name: string\n  /** Script version */\n  version: string\n  /** Optional description */\n  description?: string\n  /** Export names available from the script */\n  exports?: string[]\n}\n\n/**\n * Loaded script with content and metadata\n */\nexport interface LoadedScript {\n  /** Raw script content (JavaScript/TypeScript) */\n  content: string\n  /** Script metadata if available */\n  metadata?: ScriptMetadata\n}\n\n/**\n * Script registry for accessing JavaScript/TypeScript scripts\n *\n * @example\n * ```typescript\n * export default async function(ctx: AgentExecutionContext) {\n *   const { scripts } = ctx\n *\n *   // Get a script's source code\n *   const script = await scripts.get('transform-data@v1.0.0')\n *\n *   // Check if a script exists\n *   if (await scripts.exists('custom-validator')) {\n *     const validator = await scripts.get('custom-validator')\n *     // Use script content...\n *   }\n *\n *   return { processed: true }\n * }\n * ```\n */\nexport class ScriptRegistry {\n  constructor(private parent: ComponentRegistry) {}\n\n  /**\n   * Get a script by name (with optional @version)\n   *\n   * @param nameOrRef - Script name with optional version (e.g., \"transform\" or \"transform@v1.0.0\")\n   * @returns Loaded script with content\n   *\n   * @example\n   * scripts.get('transform')           // transform@latest\n   * scripts.get('transform@v1.0.0')    // exact version\n   */\n  async get(nameOrRef: string): Promise<LoadedScript> {\n    const { name, version } = parseNameWithVersion(nameOrRef)\n    const ref = `scripts/${name}@${version}`\n    const content = await this.parent.resolve(ref)\n\n    // Handle both raw string and structured object\n    if (typeof content === 'string') {\n      return {\n        content,\n        metadata: { name, version },\n      }\n    }\n\n    return {\n      content: content.content || content.code || String(content),\n      metadata: {\n        name,\n        version,\n        description: content.description,\n        exports: content.exports,\n      },\n    }\n  }\n\n  /**\n   * Get raw script content as string\n   *\n   * @param nameOrRef - Script name with optional version\n   * @returns Raw script content\n   */\n  async getContent(nameOrRef: string): Promise<string> {\n    const script = await this.get(nameOrRef)\n    return script.content\n  }\n\n  /**\n   * Check if a script exists\n   *\n   * @param nameOrRef - Script name with optional version\n   * @returns True if script exists\n   */\n  async exists(nameOrRef: string): Promise<boolean> {\n    try {\n      await this.get(nameOrRef)\n      return true\n    } catch {\n      return false\n    }\n  }\n}\n","/**\n * Template Registry\n *\n * Provides typed access to HTML/Handlebars templates from KV storage.\n * Templates support versioning and can be rendered with variables.\n *\n * @module components/templates\n */\n\nimport type { ComponentRegistry } from './registry.js'\nimport { parseNameWithVersion } from './registry.js'\nimport { renderHandlebars } from './prompts.js'\n\n/**\n * HTML/Handlebars template loaded from KV\n */\nexport interface Template {\n  /** Raw template content (HTML/Handlebars) */\n  content: string\n  /** Template engine to use */\n  engine?: 'handlebars' | 'html' | 'liquid'\n  /** Optional description */\n  description?: string\n}\n\n/**\n * Template registry for accessing HTML/Handlebars templates\n *\n * @example\n * ```typescript\n * export default async function(ctx: AgentExecutionContext) {\n *   const { templates } = ctx\n *\n *   // Get a template\n *   const template = await templates.get('email-header@v1.0.0')\n *\n *   // Render with variables\n *   const html = await templates.render('page-layout', {\n *     title: 'Welcome',\n *     content: 'Hello World',\n *   })\n *\n *   return { html }\n * }\n * ```\n */\nexport class TemplateRegistry {\n  constructor(private parent: ComponentRegistry) {}\n\n  /**\n   * Get a template by name (with optional @version)\n   *\n   * @param nameOrRef - Template name with optional version (e.g., \"header\" or \"header@v1.0.0\")\n   * @returns Template object with content\n   *\n   * @example\n   * templates.get('header')           // header@latest\n   * templates.get('header@v1.0.0')    // exact version\n   */\n  async get(nameOrRef: string): Promise<Template> {\n    const { name, version } = parseNameWithVersion(nameOrRef)\n    const ref = `templates/${name}@${version}`\n    const content = await this.parent.resolve(ref)\n\n    // Handle both raw string and structured object\n    if (typeof content === 'string') {\n      return { content, engine: 'handlebars' }\n    }\n    return {\n      content: content.content || content.template || String(content),\n      engine: content.engine || 'handlebars',\n      description: content.description,\n    }\n  }\n\n  /**\n   * Get raw template content as string\n   *\n   * @param nameOrRef - Template name with optional version\n   * @returns Raw template content\n   */\n  async getContent(nameOrRef: string): Promise<string> {\n    const template = await this.get(nameOrRef)\n    return template.content\n  }\n\n  /**\n   * Render a template with variables\n   *\n   * Uses Handlebars for rendering by default.\n   *\n   * @param nameOrRef - Template name with optional version\n   * @param variables - Variables to substitute in the template\n   * @returns Rendered HTML string\n   *\n   * @example\n   * const html = await templates.render('email-template', {\n   *   userName: 'John',\n   *   orderNumber: '12345',\n   * })\n   */\n  async render(nameOrRef: string, variables: Record<string, unknown>): Promise<string> {\n    const template = await this.get(nameOrRef)\n\n    // Use Handlebars rendering (same as prompts)\n    if (template.engine === 'handlebars' || !template.engine) {\n      return renderHandlebars(template.content, variables)\n    }\n\n    // For plain HTML, just return content (no variable substitution)\n    if (template.engine === 'html') {\n      return template.content\n    }\n\n    // Default: Handlebars\n    return renderHandlebars(template.content, variables)\n  }\n\n  /**\n   * Check if a template exists\n   *\n   * @param nameOrRef - Template name with optional version\n   * @returns True if template exists\n   */\n  async exists(nameOrRef: string): Promise<boolean> {\n    try {\n      await this.get(nameOrRef)\n      return true\n    } catch {\n      return false\n    }\n  }\n}\n","/**\n * Component Registry\n *\n * Unified component access for all component types:\n * - schemas - JSON Schema definitions\n * - prompts - AI prompt templates\n * - configs - Configuration objects\n * - queries - SQL query templates\n * - scripts - JavaScript/TypeScript scripts\n * - templates - HTML/Handlebars templates\n *\n * Used by both YAML expression resolution and TypeScript handlers.\n *\n * @module components/registry\n */\n\nimport {\n  resolveValue,\n  type ComponentResolutionContext,\n  type ResolvedComponent,\n} from '../utils/component-resolver.js'\nimport { SchemaRegistry } from './schemas.js'\nimport { PromptRegistry } from './prompts.js'\nimport { ConfigRegistry } from './configs.js'\nimport { QueryRegistry } from './queries.js'\nimport { ScriptRegistry } from './scripts.js'\nimport { TemplateRegistry } from './templates.js'\n\n/**\n * Parse name with optional version\n *\n * @example\n * parseNameWithVersion('order')            { name: 'order', version: 'latest' }\n * parseNameWithVersion('order@v1.0.0')     { name: 'order', version: 'v1.0.0' }\n * parseNameWithVersion('order@^2.0.0')     { name: 'order', version: '^2.0.0' }\n * parseNameWithVersion('order@latest')     { name: 'order', version: 'latest' }\n */\nexport function parseNameWithVersion(nameOrRef: string): { name: string; version: string } {\n  if (nameOrRef.includes('@')) {\n    const atIndex = nameOrRef.lastIndexOf('@')\n    const name = nameOrRef.substring(0, atIndex)\n    const version = nameOrRef.substring(atIndex + 1)\n    return { name, version }\n  }\n  return { name: nameOrRef, version: 'latest' }\n}\n\n/**\n * Unified component registry for accessing schemas, prompts, configs\n *\n * Used by both YAML expression resolution and TypeScript handlers.\n *\n * @example\n * ```typescript\n * // Create registry\n * const registry = new ComponentRegistry({ env })\n *\n * // Access schemas\n * const schema = await registry.schemas.get('order@v1.0.0')\n * const isValid = await registry.schemas.isValid('order', data)\n *\n * // Access prompts\n * const prompt = await registry.prompts.get('extraction')\n * const rendered = await registry.prompts.render('docs-writer', { page: 'intro' })\n *\n * // Access configs\n * const settings = await registry.configs.get('docs-settings')\n * ```\n */\nexport class ComponentRegistry {\n  private resolutionContext: ComponentResolutionContext\n  private cache = new Map<string, any>()\n\n  // Sub-registries (lazily initialized)\n  private _schemas?: SchemaRegistry\n  private _prompts?: PromptRegistry\n  private _configs?: ConfigRegistry\n  private _queries?: QueryRegistry\n  private _scripts?: ScriptRegistry\n  private _templates?: TemplateRegistry\n\n  constructor(context: ComponentResolutionContext) {\n    this.resolutionContext = context\n  }\n\n  /**\n   * Schema registry - access and validate against schemas\n   */\n  get schemas(): SchemaRegistry {\n    if (!this._schemas) {\n      this._schemas = new SchemaRegistry(this)\n    }\n    return this._schemas!\n  }\n\n  /**\n   * Prompt registry - access and render prompts\n   */\n  get prompts(): PromptRegistry {\n    if (!this._prompts) {\n      this._prompts = new PromptRegistry(this)\n    }\n    return this._prompts!\n  }\n\n  /**\n   * Config component registry - access config components\n   */\n  get configs(): ConfigRegistry {\n    if (!this._configs) {\n      this._configs = new ConfigRegistry(this)\n    }\n    return this._configs!\n  }\n\n  /**\n   * Query registry - access SQL query templates\n   */\n  get queries(): QueryRegistry {\n    if (!this._queries) {\n      this._queries = new QueryRegistry(this)\n    }\n    return this._queries!\n  }\n\n  /**\n   * Script registry - access JavaScript/TypeScript scripts\n   */\n  get scripts(): ScriptRegistry {\n    if (!this._scripts) {\n      this._scripts = new ScriptRegistry(this)\n    }\n    return this._scripts!\n  }\n\n  /**\n   * Template registry - access HTML/Handlebars templates\n   */\n  get templates(): TemplateRegistry {\n    if (!this._templates) {\n      this._templates = new TemplateRegistry(this)\n    }\n    return this._templates!\n  }\n\n  /**\n   * Resolve any component reference\n   *\n   * This is the core resolution method that delegates to resolveValue()\n   * from component-resolver.ts. Results are cached within the execution.\n   *\n   * @param ref - Component reference (e.g., \"schemas/order@v1.0.0\")\n   * @returns Resolved component content\n   */\n  async resolve(ref: string): Promise<any> {\n    // Check cache first\n    if (this.cache.has(ref)) {\n      return this.cache.get(ref)\n    }\n\n    // Resolve using the low-level component resolver\n    const resolved: ResolvedComponent = await resolveValue(ref, this.resolutionContext)\n\n    // Cache the resolved content\n    this.cache.set(ref, resolved.content)\n\n    return resolved.content\n  }\n\n  /**\n   * Resolve with full metadata (source, version, etc.)\n   *\n   * @param ref - Component reference\n   * @returns Full resolved component with metadata\n   */\n  async resolveWithMetadata(ref: string): Promise<ResolvedComponent> {\n    return resolveValue(ref, this.resolutionContext)\n  }\n\n  /**\n   * Check if a component exists\n   *\n   * @param ref - Component reference\n   * @returns True if component exists\n   */\n  async exists(ref: string): Promise<boolean> {\n    try {\n      await this.resolve(ref)\n      return true\n    } catch {\n      return false\n    }\n  }\n\n  /**\n   * Clear component cache\n   *\n   * Useful for testing or long-running processes that need fresh data.\n   */\n  clearCache(): void {\n    this.cache.clear()\n  }\n\n  /**\n   * Get cache statistics\n   *\n   * @returns Cache hit information\n   */\n  getCacheStats(): { size: number; keys: string[] } {\n    return {\n      size: this.cache.size,\n      keys: Array.from(this.cache.keys()),\n    }\n  }\n\n  /**\n   * Get the resolution context\n   *\n   * Useful for passing to other functions that need KV access.\n   */\n  getContext(): ComponentResolutionContext {\n    return this.resolutionContext\n  }\n}\n\n/**\n * Create a component registry from Cloudflare environment\n *\n * @param env - Cloudflare environment with KV bindings\n * @returns Configured ComponentRegistry\n *\n * @example\n * ```typescript\n * const registry = createComponentRegistry(env)\n * const schema = await registry.schemas.get('order')\n * ```\n */\nexport function createComponentRegistry(env: {\n  EDGIT?: KVNamespace\n  COMPONENTS?: KVNamespace\n  [key: string]: any\n}): ComponentRegistry {\n  return new ComponentRegistry({ env })\n}\n","/**\n * Discovery Registries for Agents and Ensembles\n *\n * Provides read-only access to discover and inspect registered agents and ensembles.\n * Used by TypeScript handlers that need to enumerate available resources (e.g., OpenAPI generation).\n *\n * @module components/discovery\n */\n\nimport type { BaseAgent } from '../agents/base-agent.js'\nimport type { EnsembleConfig } from '../runtime/parser.js'\n\n/**\n * Metadata about a registered agent\n */\nexport interface AgentMetadata {\n  /** Agent name */\n  name: string\n  /** Operation type (think, code, data, api, etc.) */\n  operation: string\n  /** Agent description */\n  description?: string\n  /** Input schema if defined */\n  inputSchema?: Record<string, unknown>\n  /** Output schema if defined */\n  outputSchema?: Record<string, unknown>\n  /** Whether this is a built-in agent */\n  builtIn: boolean\n}\n\n/**\n * Metadata about a registered ensemble\n */\nexport interface EnsembleMetadata {\n  /** Ensemble name */\n  name: string\n  /** Ensemble description */\n  description?: string\n  /** Triggers configured for this ensemble */\n  triggers: Array<{\n    type: string\n    path?: string\n    methods?: string[]\n    cron?: string\n  }>\n  /** Input schema if defined */\n  inputSchema?: Record<string, unknown>\n  /** Output schema if defined */\n  outputSchema?: unknown\n  /** Source type (yaml or typescript) */\n  source: 'yaml' | 'typescript'\n  /** Names of agents used in the flow */\n  agentNames: string[]\n  /** Number of steps in the flow */\n  stepCount: number\n}\n\n/**\n * Read-only registry for discovering agents\n *\n * @example\n * ```typescript\n * export default async function(ctx: AgentExecutionContext) {\n *   const agents = ctx.agentRegistry?.list() || []\n *\n *   // Find all data agents\n *   const dataAgents = agents.filter(a => a.operation === 'data')\n *\n *   // Get specific agent metadata\n *   const scraper = ctx.agentRegistry?.get('scrape')\n *\n *   return { agentCount: agents.length }\n * }\n * ```\n */\nexport interface AgentRegistry {\n  /**\n   * List all registered agents with their metadata\n   */\n  list(): AgentMetadata[]\n\n  /**\n   * Get metadata for a specific agent by name\n   */\n  get(name: string): AgentMetadata | undefined\n\n  /**\n   * Check if an agent is registered\n   */\n  has(name: string): boolean\n}\n\n/**\n * Read-only registry for discovering ensembles\n *\n * @example\n * ```typescript\n * export default async function(ctx: AgentExecutionContext) {\n *   const ensembles = ctx.ensembleRegistry?.list() || []\n *\n *   // Find all HTTP-triggered ensembles\n *   const httpEnsembles = ensembles.filter(e =>\n *     e.triggers.some(t => t.type === 'http')\n *   )\n *\n *   // Generate OpenAPI paths\n *   const paths = {}\n *   for (const ensemble of httpEnsembles) {\n *     for (const trigger of ensemble.triggers) {\n *       if (trigger.type === 'http' && trigger.path) {\n *         paths[trigger.path] = { ... }\n *       }\n *     }\n *   }\n *\n *   return { paths }\n * }\n * ```\n */\nexport interface EnsembleRegistry {\n  /**\n   * List all registered ensembles with their metadata\n   */\n  list(): EnsembleMetadata[]\n\n  /**\n   * Get metadata for a specific ensemble by name\n   */\n  get(name: string): EnsembleMetadata | undefined\n\n  /**\n   * Check if an ensemble is registered\n   */\n  has(name: string): boolean\n}\n\n/**\n * Metadata about a documentation page\n */\nexport interface DocsPageMetadata {\n  /** Page slug (URL-friendly identifier) */\n  slug: string\n  /** Page title */\n  title: string\n  /** Markdown content */\n  content: string\n  /** Page order in navigation */\n  order?: number\n}\n\n/**\n * Read-only registry for discovering documentation pages\n *\n * @example\n * ```typescript\n * export default async function(ctx: AgentExecutionContext) {\n *   const pages = ctx.docsRegistry?.list() || []\n *\n *   // Find a specific page\n *   const gettingStarted = ctx.docsRegistry?.get('getting-started')\n *\n *   // Check if page exists\n *   if (ctx.docsRegistry?.has('advanced')) {\n *     // ...\n *   }\n *\n *   return { pageCount: pages.length }\n * }\n * ```\n */\nexport interface DocsRegistry {\n  /**\n   * List all documentation pages with their metadata\n   */\n  list(): DocsPageMetadata[]\n\n  /**\n   * Get a specific page by slug\n   */\n  get(slug: string): DocsPageMetadata | undefined\n\n  /**\n   * Check if a page exists\n   */\n  has(slug: string): boolean\n}\n\n/**\n * Create an AgentRegistry from a Map of BaseAgent instances\n */\nexport function createAgentRegistry(agents: Map<string, BaseAgent>): AgentRegistry {\n  return {\n    list(): AgentMetadata[] {\n      const result: AgentMetadata[] = []\n      for (const [name, agent] of agents) {\n        result.push(extractAgentMetadata(name, agent))\n      }\n      return result\n    },\n\n    get(name: string): AgentMetadata | undefined {\n      const agent = agents.get(name)\n      if (!agent) return undefined\n      return extractAgentMetadata(name, agent)\n    },\n\n    has(name: string): boolean {\n      return agents.has(name)\n    },\n  }\n}\n\n/**\n * Extract metadata from a BaseAgent instance\n */\nfunction extractAgentMetadata(name: string, agent: BaseAgent): AgentMetadata {\n  const config = agent.getConfig?.() || {}\n  return {\n    name,\n    operation: agent.getType?.() || config.operation || 'unknown',\n    description: config.description,\n    // AgentConfig stores input/output schema under config.schema\n    inputSchema: config.schema?.input,\n    outputSchema: config.schema?.output,\n    builtIn: isBuiltInAgent(name),\n  }\n}\n\n/**\n * Check if an agent is a built-in type\n */\nfunction isBuiltInAgent(name: string): boolean {\n  const builtInNames = [\n    'scrape',\n    'validate',\n    'rag',\n    'hitl',\n    'fetch',\n    'html',\n    'form',\n    'storage',\n    'queue',\n    'pdf',\n    'email',\n    'sms',\n  ]\n  return builtInNames.includes(name)\n}\n\n/**\n * Create an EnsembleRegistry from a Map of EnsembleConfig instances\n */\nexport function createEnsembleRegistry(\n  ensembles: Map<string, { config: EnsembleConfig; source: 'yaml' | 'typescript' }>\n): EnsembleRegistry {\n  return {\n    list(): EnsembleMetadata[] {\n      const result: EnsembleMetadata[] = []\n      for (const [name, { config, source }] of ensembles) {\n        result.push(extractEnsembleMetadata(name, config, source))\n      }\n      return result\n    },\n\n    get(name: string): EnsembleMetadata | undefined {\n      const entry = ensembles.get(name)\n      if (!entry) return undefined\n      return extractEnsembleMetadata(name, entry.config, entry.source)\n    },\n\n    has(name: string): boolean {\n      return ensembles.has(name)\n    },\n  }\n}\n\n/**\n * Extract metadata from an EnsembleConfig\n */\nfunction extractEnsembleMetadata(\n  name: string,\n  config: EnsembleConfig,\n  source: 'yaml' | 'typescript'\n): EnsembleMetadata {\n  // Extract triggers\n  const triggers =\n    config.trigger?.map((t: any) => ({\n      type: t.type,\n      path: t.path || t.paths?.[0]?.path,\n      methods: t.methods || t.paths?.[0]?.methods,\n      cron: t.cron,\n    })) || []\n\n  // Extract agent names from flow\n  const agentNames: string[] = []\n  if (Array.isArray(config.flow)) {\n    for (const step of config.flow) {\n      if ('agent' in step && typeof step.agent === 'string') {\n        agentNames.push(step.agent)\n      }\n    }\n  }\n\n  return {\n    name,\n    description: config.description,\n    triggers,\n    inputSchema: config.inputs,\n    outputSchema: config.output,\n    source,\n    agentNames,\n    stepCount: Array.isArray(config.flow) ? config.flow.length : 0,\n  }\n}\n\n/**\n * Create a DocsRegistry from a Map of docs pages\n *\n * @param docs - Map from DocsDirectoryLoader.getRegistryData()\n */\nexport function createDocsRegistry(\n  docs: Map<string, { content: string; title: string; slug: string; order?: number }>\n): DocsRegistry {\n  return {\n    list(): DocsPageMetadata[] {\n      const result: DocsPageMetadata[] = []\n      for (const [slug, page] of docs) {\n        result.push({\n          slug,\n          title: page.title,\n          content: page.content,\n          order: page.order,\n        })\n      }\n      // Sort by order if available\n      return result.sort((a, b) => (a.order ?? 999) - (b.order ?? 999))\n    },\n\n    get(slug: string): DocsPageMetadata | undefined {\n      const page = docs.get(slug)\n      if (!page) return undefined\n      return {\n        slug,\n        title: page.title,\n        content: page.content,\n        order: page.order,\n      }\n    },\n\n    has(slug: string): boolean {\n      return docs.has(slug)\n    },\n  }\n}\n","/**\n * Output Resolver\n *\n * Resolves conditional output blocks and builds HTTP responses.\n * Supports status codes, headers, redirects, and raw body responses.\n *\n * @module runtime/output-resolver\n */\n\nimport {\n  type OutputBlock,\n  type ResolvedOutput,\n  type EnsembleOutput,\n  type OutputFormat,\n  normalizeOutput,\n  getFormatContentType,\n  getFormatType,\n  getFormatExtract,\n} from './output-types.js'\nimport { Parser } from './parser.js'\n\n// Re-export types for convenience\nexport type { ResolvedOutput, EnsembleOutput, OutputBlock, OutputFormat } from './output-types.js'\nexport { getFormatContentType, getFormatType, getFormatExtract } from './output-types.js'\n\n/**\n * Evaluation context for output resolution\n */\nexport interface OutputEvaluationContext {\n  /** Input data */\n  input?: unknown\n  /** Agent outputs keyed by name */\n  [agentName: string]: unknown\n}\n\n/**\n * Resolve output blocks against evaluation context\n *\n * Evaluates `when` conditions and returns the first matching block.\n * If no `when` clause is specified, the block always matches (default case).\n *\n * @param output - Output configuration (array of blocks or legacy object)\n * @param context - Evaluation context with agent outputs\n * @returns Resolved output with status, headers, body, etc.\n *\n * @example\n * ```typescript\n * const output = [\n *   { when: '${found}', status: 200, body: { data: '${result}' } },\n *   { status: 404, body: { error: 'not_found' } },\n * ]\n *\n * const resolved = resolveOutput(output, { found: true, result: 'data' })\n * // { status: 200, body: { data: 'data' } }\n * ```\n */\nexport function resolveOutput(\n  output: EnsembleOutput | undefined,\n  context: OutputEvaluationContext\n): ResolvedOutput {\n  // No output defined - return empty success\n  if (!output) {\n    return { status: 200 }\n  }\n\n  // Normalize to array format\n  const blocks = normalizeOutput(output)\n\n  // Find first matching block\n  for (const block of blocks) {\n    // No `when` clause means always match (default case)\n    if (!block.when) {\n      return resolveOutputBlock(block, context)\n    }\n\n    // Evaluate condition\n    const condition = evaluateCondition(block.when, context)\n    if (condition) {\n      return resolveOutputBlock(block, context)\n    }\n  }\n\n  // No match - return empty success\n  return { status: 200 }\n}\n\n/**\n * Resolve a single output block by interpolating expressions\n *\n * @param block - Output block to resolve\n * @param context - Evaluation context\n * @returns Resolved output\n */\nfunction resolveOutputBlock(block: OutputBlock, context: OutputEvaluationContext): ResolvedOutput {\n  const resolved: ResolvedOutput = {\n    status: block.status || 200,\n  }\n\n  // Resolve headers (interpolate values)\n  if (block.headers) {\n    resolved.headers = {}\n    for (const [key, value] of Object.entries(block.headers)) {\n      resolved.headers[key] = String(Parser.resolveInterpolation(value, context))\n    }\n  }\n\n  // Handle redirect\n  if (block.redirect) {\n    // Interpolate status if it's a template string\n    let redirectStatus: 301 | 302 | 307 | 308 | undefined = undefined\n    if (block.redirect.status !== undefined) {\n      const resolvedStatus = Parser.resolveInterpolation(block.redirect.status, context)\n      const numStatus = typeof resolvedStatus === 'number' ? resolvedStatus : Number(resolvedStatus)\n      if ([301, 302, 307, 308].includes(numStatus)) {\n        redirectStatus = numStatus as 301 | 302 | 307 | 308\n      }\n    }\n\n    resolved.redirect = {\n      url: String(Parser.resolveInterpolation(block.redirect.url, context)),\n      status: redirectStatus,\n    }\n    return resolved\n  }\n\n  // Handle raw body\n  if (block.rawBody !== undefined) {\n    resolved.rawBody = String(Parser.resolveInterpolation(block.rawBody, context))\n    return resolved\n  }\n\n  // Handle JSON body\n  if (block.body !== undefined) {\n    resolved.body = Parser.resolveInterpolation(block.body, context)\n  }\n\n  // Pass through format for triggers (Execute API ignores this)\n  if (block.format !== undefined) {\n    resolved.format = block.format\n  }\n\n  return resolved\n}\n\n/**\n * Evaluate a condition expression\n *\n * Supports:\n * - Simple variable access: `${found}`\n * - Equality: `${status} == 'active'`\n * - Inequality: `${status} != 'deleted'`\n * - Boolean expressions: `${agent.output.success}`\n * - Comparisons: `${count} > 0`\n *\n * @param condition - Condition expression string\n * @param context - Evaluation context\n * @returns Boolean result\n */\nfunction evaluateCondition(condition: string, context: OutputEvaluationContext): boolean {\n  // Resolve interpolations in the condition\n  const resolved = Parser.resolveInterpolation(condition, context)\n\n  // If it's already a boolean, return it\n  if (typeof resolved === 'boolean') {\n    return resolved\n  }\n\n  // If it's a string that looks like a comparison, evaluate it\n  if (typeof resolved === 'string') {\n    // Handle \"true\" / \"false\" strings\n    if (resolved === 'true') return true\n    if (resolved === 'false') return false\n\n    // Handle comparison operators\n    const comparisonMatch = resolved.match(/^(.+?)\\s*(==|!=|>=|<=|>|<)\\s*(.+)$/)\n    if (comparisonMatch) {\n      const [, left, op, right] = comparisonMatch\n      return evaluateComparison(left.trim(), op, right.trim())\n    }\n  }\n\n  // Truthy check\n  return Boolean(resolved)\n}\n\n/**\n * Evaluate a comparison expression\n */\nfunction evaluateComparison(left: string, op: string, right: string): boolean {\n  // Parse values (handle strings, numbers, booleans)\n  const leftVal = parseValue(left)\n  const rightVal = parseValue(right)\n\n  switch (op) {\n    case '==':\n      return leftVal === rightVal\n    case '!=':\n      return leftVal !== rightVal\n    case '>':\n      return Number(leftVal) > Number(rightVal)\n    case '>=':\n      return Number(leftVal) >= Number(rightVal)\n    case '<':\n      return Number(leftVal) < Number(rightVal)\n    case '<=':\n      return Number(leftVal) <= Number(rightVal)\n    default:\n      return false\n  }\n}\n\n/**\n * Parse a string value to its typed form\n */\nfunction parseValue(value: string): string | number | boolean {\n  // Remove quotes\n  if (\n    (value.startsWith(\"'\") && value.endsWith(\"'\")) ||\n    (value.startsWith('\"') && value.endsWith('\"'))\n  ) {\n    return value.slice(1, -1)\n  }\n\n  // Boolean\n  if (value === 'true') return true\n  if (value === 'false') return false\n  if (value === 'null') return ''\n\n  // Number\n  const num = Number(value)\n  if (!isNaN(num)) return num\n\n  // String\n  return value\n}\n\n/**\n * Build an HTTP Response from resolved output\n *\n * This function handles format-based serialization for trigger responses.\n * Execute API ignores the format field and always returns JSON.\n *\n * @param output - Resolved output\n * @param options - Options for response building\n * @param options.ignoreFormat - If true, always return JSON (used by Execute API)\n * @returns HTTP Response\n */\nexport function buildHttpResponse(\n  output: ResolvedOutput,\n  options?: { ignoreFormat?: boolean }\n): Response {\n  const headers = new Headers()\n\n  // Apply custom headers\n  if (output.headers) {\n    for (const [key, value] of Object.entries(output.headers)) {\n      headers.set(key, value)\n    }\n  }\n\n  // Handle redirect\n  if (output.redirect) {\n    const status = output.redirect.status || 302\n    headers.set('Location', output.redirect.url)\n    return new Response(null, { status, headers })\n  }\n\n  // Handle raw body\n  if (output.rawBody !== undefined) {\n    // Set default content-type if not specified\n    if (!headers.has('Content-Type')) {\n      headers.set('Content-Type', 'text/plain')\n    }\n    return new Response(output.rawBody, { status: output.status, headers })\n  }\n\n  // Handle format-based response (only for triggers, not Execute API)\n  if (output.format && !options?.ignoreFormat && output.body !== undefined) {\n    return buildFormattedResponse(output, headers)\n  }\n\n  // Default: JSON body\n  headers.set('Content-Type', 'application/json')\n  const body = output.body !== undefined ? JSON.stringify(output.body) : '{}'\n  return new Response(body, { status: output.status, headers })\n}\n\n/**\n * Build a response using the format specification\n *\n * Handles field extraction and Content-Type mapping based on format.\n */\nfunction buildFormattedResponse(output: ResolvedOutput, headers: Headers): Response {\n  const format = output.format!\n  const body = output.body as Record<string, unknown>\n\n  // Get Content-Type from format\n  const contentType = getFormatContentType(format)\n\n  // Get format type and extract field\n  const formatType = getFormatType(format)\n  const extractField = getFormatExtract(format)\n\n  // Determine what content to return\n  let content: unknown\n\n  if (extractField) {\n    // Extract specific field\n    content = body[extractField]\n    if (content === undefined) {\n      // Field not found - return error\n      headers.set('Content-Type', 'application/json')\n      return new Response(\n        JSON.stringify({\n          success: false,\n          error: {\n            code: 'FORMAT_EXTRACTION_FAILED',\n            message: `Field '${extractField}' not found in body for format extraction.`,\n          },\n        }),\n        { status: 500, headers }\n      )\n    }\n  } else if (typeof body === 'object' && body !== null) {\n    // No extract field - for non-JSON formats, try to find a single field\n    const keys = Object.keys(body)\n    if (keys.length === 1) {\n      content = body[keys[0]]\n    } else if (formatType !== 'json') {\n      // Multiple fields without extract - error for non-JSON formats\n      headers.set('Content-Type', 'application/json')\n      return new Response(\n        JSON.stringify({\n          success: false,\n          error: {\n            code: 'FORMAT_EXTRACTION_FAILED',\n            message: `Cannot extract single field for format '${formatType}': body has multiple fields (${keys.join(', ')}). Specify format.extract to indicate which field to use.`,\n          },\n        }),\n        { status: 500, headers }\n      )\n    } else {\n      // JSON format with multiple fields - just return the whole body\n      content = body\n    }\n  } else {\n    // Body is not an object - use directly\n    content = body\n  }\n\n  // Serialize based on format type\n  let serialized: string\n  switch (formatType) {\n    case 'json':\n      serialized = JSON.stringify(content)\n      break\n    case 'yaml':\n      // Simple YAML serialization for objects\n      serialized = serializeToYaml(content)\n      break\n    case 'csv':\n      // Simple CSV serialization\n      serialized = serializeToCsv(content)\n      break\n    default:\n      // text, html, xml, markdown, ics, rss, atom - use string value directly\n      serialized = String(content)\n  }\n\n  // Set Content-Type (can be overridden by custom headers)\n  if (!headers.has('Content-Type')) {\n    headers.set('Content-Type', contentType)\n  }\n\n  return new Response(serialized, { status: output.status, headers })\n}\n\n/**\n * Simple YAML serialization\n * For complex objects, this is a basic implementation\n */\nfunction serializeToYaml(value: unknown, indent = 0): string {\n  const spaces = '  '.repeat(indent)\n\n  if (value === null || value === undefined) {\n    return 'null'\n  }\n\n  if (typeof value === 'string') {\n    // Check if string needs quoting\n    if (value.includes('\\n') || value.includes(':') || value.includes('#')) {\n      return `\"${value.replace(/\"/g, '\\\\\"').replace(/\\n/g, '\\\\n')}\"`\n    }\n    return value\n  }\n\n  if (typeof value === 'number' || typeof value === 'boolean') {\n    return String(value)\n  }\n\n  if (Array.isArray(value)) {\n    if (value.length === 0) return '[]'\n    return value.map((item) => `${spaces}- ${serializeToYaml(item, indent + 1)}`).join('\\n')\n  }\n\n  if (typeof value === 'object') {\n    const entries = Object.entries(value)\n    if (entries.length === 0) return '{}'\n    return entries\n      .map(([key, val]) => {\n        const serializedVal = serializeToYaml(val, indent + 1)\n        if (typeof val === 'object' && val !== null && !Array.isArray(val)) {\n          return `${spaces}${key}:\\n${serializedVal}`\n        }\n        return `${spaces}${key}: ${serializedVal}`\n      })\n      .join('\\n')\n  }\n\n  return String(value)\n}\n\n/**\n * Simple CSV serialization\n * Handles arrays of objects or arrays of arrays\n */\nfunction serializeToCsv(value: unknown): string {\n  if (!Array.isArray(value)) {\n    // Single value - just return it\n    return String(value)\n  }\n\n  if (value.length === 0) {\n    return ''\n  }\n\n  const first = value[0]\n\n  // Array of objects - use keys as headers\n  if (typeof first === 'object' && first !== null && !Array.isArray(first)) {\n    const headers = Object.keys(first)\n    const headerRow = headers.map(escapeCsvField).join(',')\n    const dataRows = value\n      .map((row) => {\n        const obj = row as Record<string, unknown>\n        return headers.map((h) => escapeCsvField(String(obj[h] ?? ''))).join(',')\n      })\n      .join('\\n')\n    return `${headerRow}\\n${dataRows}`\n  }\n\n  // Array of arrays\n  if (Array.isArray(first)) {\n    return value.map((row) => (row as unknown[]).map((cell) => escapeCsvField(String(cell))).join(',')).join('\\n')\n  }\n\n  // Array of primitives - one per line\n  return value.map((v) => escapeCsvField(String(v))).join('\\n')\n}\n\n/**\n * Escape a CSV field\n */\nfunction escapeCsvField(value: string): string {\n  if (value.includes(',') || value.includes('\"') || value.includes('\\n')) {\n    return `\"${value.replace(/\"/g, '\"\"')}\"`\n  }\n  return value\n}\n\n/**\n * Check if output indicates a redirect response\n */\nexport function isRedirectOutput(output: ResolvedOutput): boolean {\n  return output.redirect !== undefined\n}\n\n/**\n * Check if output indicates a raw body response\n */\nexport function isRawBodyOutput(output: ResolvedOutput): boolean {\n  return output.rawBody !== undefined\n}\n","/**\n * Working Memory - In-Memory Storage\n *\n * Stores current execution context, intermediate results, and variables.\n * Lives only for the duration of the current execution.\n */\n\nexport class WorkingMemory {\n  private memory = new Map<string, unknown>()\n\n  /**\n   * Set a value in working memory\n   */\n  set(key: string, value: unknown): void {\n    this.memory.set(key, value)\n  }\n\n  /**\n   * Get a value from working memory\n   */\n  get(key: string): unknown {\n    return this.memory.get(key)\n  }\n\n  /**\n   * Check if key exists\n   */\n  has(key: string): boolean {\n    return this.memory.has(key)\n  }\n\n  /**\n   * Delete a key\n   */\n  delete(key: string): boolean {\n    return this.memory.delete(key)\n  }\n\n  /**\n   * Get all keys\n   */\n  keys(): string[] {\n    return Array.from(this.memory.keys())\n  }\n\n  /**\n   * Get all values as object\n   */\n  getAll(): Record<string, unknown> {\n    return Object.fromEntries(this.memory)\n  }\n\n  /**\n   * Clear all memory\n   */\n  clear(): void {\n    this.memory.clear()\n  }\n\n  /**\n   * Get memory size\n   */\n  size(): number {\n    return this.memory.size\n  }\n\n  /**\n   * Merge another object into working memory\n   */\n  merge(data: Record<string, unknown>): void {\n    for (const [key, value] of Object.entries(data)) {\n      this.memory.set(key, value)\n    }\n  }\n\n  /**\n   * Create a snapshot of working memory\n   */\n  snapshot(): Record<string, unknown> {\n    return { ...this.getAll() }\n  }\n\n  /**\n   * Restore from a snapshot\n   */\n  restore(snapshot: Record<string, unknown>): void {\n    this.memory.clear()\n    this.merge(snapshot)\n  }\n}\n","/**\n * Session Memory - KV with TTL\n *\n * Stores conversation history and session-specific data.\n * Automatically expires after TTL (default: 1 hour).\n *\n * Enhanced with:\n * - Per-message TTL filtering (sliding window by age)\n * - Message count limits\n * - Conversation size limits\n * - Model tracking for AI responses\n */\n\nimport type { ConversationHistory, Message } from './types.js'\nimport type { ConductorEnv } from '../../types/env.js'\n\n/** Configuration for session memory behavior */\nexport interface SessionMemoryConfig {\n  /** Time-to-live for the KV key in seconds (default: 3600 = 1 hour) */\n  ttl?: number\n  /** Maximum number of messages to keep (default: 50) */\n  maxMessages?: number\n  /** Maximum age of individual messages in hours (default: 24) */\n  messageMaxAgeHours?: number\n  /** Maximum conversation size in bytes (default: 1MB) */\n  maxConversationSize?: number\n}\n\nexport class SessionMemory {\n  private readonly defaultTTL = 3600 // 1 hour in seconds\n  private readonly defaultMaxMessages = 50\n  private readonly defaultMessageMaxAgeHours = 24\n  private readonly defaultMaxConversationSize = 1024 * 1024 // 1MB\n\n  private readonly ttl: number\n  private readonly maxMessages: number\n  private readonly messageMaxAgeHours: number\n  private readonly maxConversationSize: number\n\n  constructor(\n    private readonly env: ConductorEnv,\n    private readonly sessionId?: string,\n    config?: number | SessionMemoryConfig\n  ) {\n    // Support legacy signature (ttl as number) and new config object\n    if (typeof config === 'number') {\n      this.ttl = config\n      this.maxMessages = this.defaultMaxMessages\n      this.messageMaxAgeHours = this.defaultMessageMaxAgeHours\n      this.maxConversationSize = this.defaultMaxConversationSize\n    } else {\n      this.ttl = config?.ttl ?? this.defaultTTL\n      this.maxMessages = config?.maxMessages ?? this.defaultMaxMessages\n      this.messageMaxAgeHours = config?.messageMaxAgeHours ?? this.defaultMessageMaxAgeHours\n      this.maxConversationSize = config?.maxConversationSize ?? this.defaultMaxConversationSize\n    }\n  }\n\n  /**\n   * Get the KV key for this session\n   */\n  private getKey(): string {\n    if (!this.sessionId) {\n      throw new Error('Session ID is required for session memory')\n    }\n    return `session:${this.sessionId}`\n  }\n\n  /**\n   * Filter messages by age (sliding window memory)\n   * Removes messages older than messageMaxAgeHours\n   * @private\n   */\n  private filterByAge(messages: Message[]): Message[] {\n    if (!Array.isArray(messages) || messages.length === 0) {\n      return []\n    }\n\n    const cutoffTime = Date.now() - this.messageMaxAgeHours * 60 * 60 * 1000\n\n    return messages.filter((msg) => {\n      // Keep messages without timestamps (shouldn't happen, but be safe)\n      if (!msg.timestamp) return true\n      return msg.timestamp > cutoffTime\n    })\n  }\n\n  /**\n   * Enforce message count limit (keeps most recent)\n   * @private\n   */\n  private enforceMaxMessages(messages: Message[]): Message[] {\n    if (messages.length <= this.maxMessages) {\n      return messages\n    }\n\n    // Keep the most recent messages\n    const trimmed = messages.slice(-this.maxMessages)\n\n    // If we cut off in the middle of a user/assistant pair, remove orphaned assistant\n    if (trimmed.length > 0 && trimmed[0].role === 'assistant') {\n      trimmed.shift()\n    }\n\n    return trimmed\n  }\n\n  /**\n   * Enforce conversation size limit\n   * Progressively removes oldest message pairs until under limit\n   * @private\n   */\n  private enforceMaxSize(messages: Message[]): Message[] {\n    if (!Array.isArray(messages)) return []\n\n    let conversationJson = JSON.stringify(messages)\n\n    // Progressively remove oldest pairs (user + assistant)\n    while (conversationJson.length > this.maxConversationSize && messages.length > 2) {\n      // Remove oldest pair\n      messages.splice(0, 2)\n      conversationJson = JSON.stringify(messages)\n    }\n\n    return messages\n  }\n\n  /**\n   * Apply all filters to messages (age, count, size)\n   * @private\n   */\n  private applyFilters(messages: Message[]): Message[] {\n    // Order matters: filter by age first, then count, then size\n    let filtered = this.filterByAge(messages)\n    filtered = this.enforceMaxMessages(filtered)\n    filtered = this.enforceMaxSize(filtered)\n    return filtered\n  }\n\n  /**\n   * Get conversation history\n   * Automatically filters out old messages and enforces limits\n   */\n  async get(): Promise<ConversationHistory> {\n    if (!this.sessionId) {\n      return { messages: [], createdAt: Date.now(), updatedAt: Date.now() }\n    }\n\n    const key = this.getKey()\n    const data = await this.env.SESSIONS?.get(key)\n\n    if (!data) {\n      return { messages: [], createdAt: Date.now(), updatedAt: Date.now() }\n    }\n\n    const history: ConversationHistory = JSON.parse(data)\n\n    // Apply filters on read (sliding window)\n    history.messages = this.applyFilters(history.messages)\n\n    return history\n  }\n\n  /**\n   * Add a message to conversation history\n   * Automatically enforces limits after adding\n   */\n  async add(message: Message): Promise<void> {\n    if (!this.sessionId) {\n      return\n    }\n\n    const history = await this.get()\n    history.messages.push(message)\n\n    // Apply filters to enforce limits\n    history.messages = this.applyFilters(history.messages)\n    history.updatedAt = Date.now()\n\n    const key = this.getKey()\n    await this.env.SESSIONS?.put(key, JSON.stringify(history), {\n      expirationTtl: this.ttl,\n    })\n  }\n\n  /**\n   * Add multiple messages\n   * Automatically enforces limits after adding\n   */\n  async addMany(messages: Message[]): Promise<void> {\n    if (!this.sessionId) {\n      return\n    }\n\n    const history = await this.get()\n    history.messages.push(...messages)\n\n    // Apply filters to enforce limits\n    history.messages = this.applyFilters(history.messages)\n    history.updatedAt = Date.now()\n\n    const key = this.getKey()\n    await this.env.SESSIONS?.put(key, JSON.stringify(history), {\n      expirationTtl: this.ttl,\n    })\n  }\n\n  /**\n   * Replace entire conversation history\n   */\n  async replace(history: ConversationHistory): Promise<void> {\n    if (!this.sessionId) {\n      return\n    }\n\n    history.updatedAt = Date.now()\n\n    const key = this.getKey()\n    await this.env.SESSIONS?.put(key, JSON.stringify(history), {\n      expirationTtl: this.ttl,\n    })\n  }\n\n  /**\n   * Clear conversation history\n   */\n  async clear(): Promise<void> {\n    if (!this.sessionId) {\n      return\n    }\n\n    const key = this.getKey()\n    await this.env.SESSIONS?.delete(key)\n  }\n\n  /**\n   * Get last N messages\n   */\n  async getLastN(n: number): Promise<Message[]> {\n    const history = await this.get()\n    return history.messages.slice(-n)\n  }\n\n  /**\n   * Get messages since timestamp\n   */\n  async getSince(timestamp: number): Promise<Message[]> {\n    const history = await this.get()\n    return history.messages.filter((m) => m.timestamp >= timestamp)\n  }\n\n  /**\n   * Count messages\n   */\n  async count(): Promise<number> {\n    const history = await this.get()\n    return history.messages.length\n  }\n\n  /**\n   * Compress history by summarizing older messages\n   */\n  async compress(maxMessages: number): Promise<void> {\n    if (!this.sessionId) {\n      return\n    }\n\n    const history = await this.get()\n\n    if (history.messages.length <= maxMessages) {\n      return\n    }\n\n    // Keep recent messages, create summary of older ones\n    const recentMessages = history.messages.slice(-maxMessages)\n    const olderMessages = history.messages.slice(0, -maxMessages)\n\n    // Create summary message\n    const summaryText = `[Previous conversation summary: ${olderMessages.length} messages]`\n    const summaryMessage: Message = {\n      role: 'system',\n      content: summaryText,\n      timestamp: olderMessages[olderMessages.length - 1]?.timestamp || Date.now(),\n      metadata: { type: 'summary', messageCount: olderMessages.length },\n    }\n\n    history.messages = [summaryMessage, ...recentMessages]\n    history.updatedAt = Date.now()\n\n    const key = this.getKey()\n    await this.env.SESSIONS?.put(key, JSON.stringify(history), {\n      expirationTtl: this.ttl,\n    })\n  }\n\n  /**\n   * Extend TTL (reset expiration)\n   */\n  async extend(): Promise<void> {\n    if (!this.sessionId) {\n      return\n    }\n\n    const history = await this.get()\n    const key = this.getKey()\n    await this.env.SESSIONS?.put(key, JSON.stringify(history), {\n      expirationTtl: this.ttl,\n    })\n  }\n\n  /**\n   * Format messages for AI model consumption\n   * Strips metadata, timestamps, model info - returns only role + content\n   * Limits to maxContext most recent messages\n   *\n   * @param maxContext - Maximum messages to include (default: 10 = 5 exchanges)\n   */\n  async formatForAI(maxContext: number = 10): Promise<Array<{ role: string; content: string }>> {\n    const history = await this.get()\n\n    if (history.messages.length === 0) {\n      return []\n    }\n\n    // Take only the most recent messages\n    const recentMessages =\n      history.messages.length > maxContext ? history.messages.slice(-maxContext) : history.messages\n\n    return recentMessages.map((msg) => ({\n      role: msg.role,\n      content: msg.content,\n    }))\n  }\n\n  /**\n   * Get conversation metadata (for debugging/analytics)\n   * Returns stats about the conversation without full message content\n   */\n  async getMetadata(): Promise<{\n    sessionId: string | undefined\n    messageCount: number\n    modelsUsed: string[]\n    firstMessage?: number\n    lastMessage?: number\n    userMessages: number\n    assistantMessages: number\n    totalTokens: { input: number; output: number }\n  } | null> {\n    const history = await this.get()\n\n    if (history.messages.length === 0) {\n      return null\n    }\n\n    const modelsUsed = [\n      ...new Set(history.messages.map((m) => m.model).filter(Boolean)),\n    ] as string[]\n\n    // Sum up token usage\n    const totalTokens = history.messages.reduce(\n      (acc, msg) => ({\n        input: acc.input + (msg.tokens?.input ?? 0),\n        output: acc.output + (msg.tokens?.output ?? 0),\n      }),\n      { input: 0, output: 0 }\n    )\n\n    return {\n      sessionId: this.sessionId,\n      messageCount: history.messages.length,\n      modelsUsed,\n      firstMessage: history.messages[0]?.timestamp,\n      lastMessage: history.messages[history.messages.length - 1]?.timestamp,\n      userMessages: history.messages.filter((m) => m.role === 'user').length,\n      assistantMessages: history.messages.filter((m) => m.role === 'assistant').length,\n      totalTokens,\n    }\n  }\n}\n","/**\n * Long-Term Memory - D1 Database\n *\n * Stores persistent user data, preferences, and facts.\n * Data persists indefinitely until explicitly deleted.\n */\n\nimport type { ConductorEnv } from '../../types/env.js'\n\n/**\n * Type for D1 query result row\n */\ninterface D1ResultRow {\n  key: string\n  value: string\n  updated_at?: number\n}\n\nexport class LongTermMemory {\n  private readonly tableName = 'long_term_memory'\n\n  constructor(\n    private readonly env: ConductorEnv,\n    private readonly userId?: string\n  ) {}\n\n  /**\n   * Get a value by key\n   */\n  async get(key: string): Promise<unknown> {\n    if (!this.userId || !this.env.DB) {\n      return null\n    }\n\n    const result = await this.env.DB.prepare(\n      `SELECT value, updated_at FROM ${this.tableName} WHERE user_id = ? AND key = ?`\n    )\n      .bind(this.userId, key)\n      .first()\n\n    if (!result) {\n      return null\n    }\n\n    return JSON.parse(result.value as string)\n  }\n\n  /**\n   * Set a value\n   */\n  async set(key: string, value: unknown): Promise<void> {\n    if (!this.userId || !this.env.DB) {\n      return\n    }\n\n    await this.env.DB.prepare(\n      `INSERT INTO ${this.tableName} (user_id, key, value, updated_at)\n       VALUES (?, ?, ?, ?)\n       ON CONFLICT(user_id, key) DO UPDATE SET\n       value = excluded.value,\n       updated_at = excluded.updated_at`\n    )\n      .bind(this.userId, key, JSON.stringify(value), Date.now())\n      .run()\n  }\n\n  /**\n   * Delete a key\n   */\n  async delete(key: string): Promise<void> {\n    if (!this.userId || !this.env.DB) {\n      return\n    }\n\n    await this.env.DB.prepare(`DELETE FROM ${this.tableName} WHERE user_id = ? AND key = ?`)\n      .bind(this.userId, key)\n      .run()\n  }\n\n  /**\n   * Check if key exists\n   */\n  async has(key: string): Promise<boolean> {\n    if (!this.userId || !this.env.DB) {\n      return false\n    }\n\n    const result = await this.env.DB.prepare(\n      `SELECT 1 FROM ${this.tableName} WHERE user_id = ? AND key = ? LIMIT 1`\n    )\n      .bind(this.userId, key)\n      .first()\n\n    return !!result\n  }\n\n  /**\n   * Get all keys for this user\n   */\n  async keys(): Promise<string[]> {\n    if (!this.userId || !this.env.DB) {\n      return []\n    }\n\n    const results = await this.env.DB.prepare(\n      `SELECT key FROM ${this.tableName} WHERE user_id = ? ORDER BY updated_at DESC`\n    )\n      .bind(this.userId)\n      .all()\n\n    return (results.results as unknown as D1ResultRow[]).map((row) => row.key)\n  }\n\n  /**\n   * Get all key-value pairs\n   */\n  async getAll(): Promise<Record<string, unknown>> {\n    if (!this.userId || !this.env.DB) {\n      return {}\n    }\n\n    const results = await this.env.DB.prepare(\n      `SELECT key, value FROM ${this.tableName} WHERE user_id = ? ORDER BY updated_at DESC`\n    )\n      .bind(this.userId)\n      .all()\n\n    const data: Record<string, unknown> = {}\n    for (const row of results.results as unknown as D1ResultRow[]) {\n      data[row.key] = JSON.parse(row.value)\n    }\n\n    return data\n  }\n\n  /**\n   * Get multiple values by keys\n   */\n  async getMany(keys: string[]): Promise<Record<string, unknown>> {\n    if (!this.userId || !this.env.DB || keys.length === 0) {\n      return {}\n    }\n\n    const placeholders = keys.map(() => '?').join(',')\n    const results = await this.env.DB.prepare(\n      `SELECT key, value FROM ${this.tableName} WHERE user_id = ? AND key IN (${placeholders})`\n    )\n      .bind(this.userId, ...keys)\n      .all()\n\n    const data: Record<string, unknown> = {}\n    for (const row of results.results as unknown as D1ResultRow[]) {\n      data[row.key] = JSON.parse(row.value)\n    }\n\n    return data\n  }\n\n  /**\n   * Set multiple key-value pairs\n   */\n  async setMany(data: Record<string, unknown>): Promise<void> {\n    if (!this.userId || !this.env.DB) {\n      return\n    }\n\n    const timestamp = Date.now()\n    const batch = this.env.DB.batch(\n      Object.entries(data).map(([key, value]) =>\n        this.env\n          .DB!.prepare(\n            `INSERT INTO ${this.tableName} (user_id, key, value, updated_at)\n           VALUES (?, ?, ?, ?)\n           ON CONFLICT(user_id, key) DO UPDATE SET\n           value = excluded.value,\n           updated_at = excluded.updated_at`\n          )\n          .bind(this.userId, key, JSON.stringify(value), timestamp)\n      )\n    )\n\n    await batch\n  }\n\n  /**\n   * Clear all data for this user\n   */\n  async clear(): Promise<void> {\n    if (!this.userId || !this.env.DB) {\n      return\n    }\n\n    await this.env.DB.prepare(`DELETE FROM ${this.tableName} WHERE user_id = ?`)\n      .bind(this.userId)\n      .run()\n  }\n\n  /**\n   * Count entries for this user\n   */\n  async count(): Promise<number> {\n    if (!this.userId || !this.env.DB) {\n      return 0\n    }\n\n    const result = await this.env.DB.prepare(\n      `SELECT COUNT(*) as count FROM ${this.tableName} WHERE user_id = ?`\n    )\n      .bind(this.userId)\n      .first()\n\n    return (result?.count as number) || 0\n  }\n\n  /**\n   * Search keys by prefix\n   */\n  async searchByPrefix(prefix: string): Promise<Record<string, unknown>> {\n    if (!this.userId || !this.env.DB) {\n      return {}\n    }\n\n    const results = await this.env.DB.prepare(\n      `SELECT key, value FROM ${this.tableName}\n       WHERE user_id = ? AND key LIKE ?\n       ORDER BY updated_at DESC`\n    )\n      .bind(this.userId, `${prefix}%`)\n      .all()\n\n    const data: Record<string, unknown> = {}\n    for (const row of results.results as unknown as D1ResultRow[]) {\n      data[row.key] = JSON.parse(row.value)\n    }\n\n    return data\n  }\n}\n","/**\n * Semantic Memory - Vectorize\n *\n * Stores memories as embeddings for semantic search and retrieval.\n * Useful for finding contextually relevant information.\n */\n\nimport type { Memory, SearchOptions } from './types.js'\nimport { createLogger } from '../../observability/index.js'\nimport type { ConductorEnv } from '../../types/env.js'\n\nconst logger = createLogger({ serviceName: 'semantic-memory' })\n\n/**\n * Vectorize match result\n */\ninterface VectorizeMatch {\n  id: string\n  score: number\n  metadata: {\n    user_id?: string\n    content: string\n    timestamp: number\n    [key: string]: unknown\n  }\n}\n\n/**\n * AI embedding result\n */\ninterface AIEmbeddingResult {\n  data: number[][] | number[]\n}\n\nexport class SemanticMemory {\n  private readonly embeddingModel = '@cf/baai/bge-base-en-v1.5'\n\n  constructor(\n    private readonly env: ConductorEnv,\n    private readonly userId?: string\n  ) {}\n\n  /**\n   * Add a memory to semantic storage\n   */\n  async add(content: string, metadata?: Record<string, unknown>): Promise<string> {\n    if (!this.userId || !this.env.VECTORIZE || !this.env.AI) {\n      return ''\n    }\n\n    // Generate embedding\n    const embedding = await this.generateEmbedding(content)\n\n    // Create unique ID\n    const userId = this.userId // Type narrowed after check\n    const id = `${userId}-${Date.now()}-${Math.random().toString(36).substring(7)}`\n\n    // Store in Vectorize\n    await this.env.VECTORIZE.upsert([\n      {\n        id,\n        values: embedding,\n        metadata: {\n          user_id: userId,\n          content: content,\n          timestamp: Date.now(),\n          ...metadata,\n        },\n      },\n    ])\n\n    return id\n  }\n\n  /**\n   * Add multiple memories\n   */\n  async addMany(\n    memories: Array<{ content: string; metadata?: Record<string, unknown> }>\n  ): Promise<string[]> {\n    if (!this.userId || !this.env.VECTORIZE || !this.env.AI) {\n      return []\n    }\n\n    // Generate embeddings for all memories\n    const embeddings = await this.generateEmbeddings(memories.map((m) => m.content))\n\n    // Type narrowed after check\n    const userId = this.userId\n\n    // Create vectors\n    const vectors = memories.map((memory, i) => ({\n      id: `${userId}-${Date.now()}-${i}-${Math.random().toString(36).substring(7)}`,\n      values: embeddings[i],\n      metadata: {\n        user_id: userId,\n        content: memory.content,\n        timestamp: Date.now(),\n        ...memory.metadata,\n      },\n    }))\n\n    // Store in Vectorize\n    await this.env.VECTORIZE.upsert(vectors)\n\n    return vectors.map((v) => v.id)\n  }\n\n  /**\n   * Search for semantically similar memories\n   */\n  async search(query: string, options?: SearchOptions): Promise<Memory[]> {\n    if (!this.userId || !this.env.VECTORIZE || !this.env.AI) {\n      return []\n    }\n\n    // Generate query embedding\n    const queryEmbedding = await this.generateEmbedding(query)\n\n    // Search Vectorize\n    const results = await this.env.VECTORIZE.query(queryEmbedding, {\n      topK: options?.topK || 5,\n      filter: { user_id: this.userId, ...options?.filter },\n      returnValues: false,\n      returnMetadata: true,\n    })\n\n    // Convert to Memory objects\n    return (results.matches as VectorizeMatch[])\n      .filter((match) => !options?.minScore || match.score >= options.minScore)\n      .map((match) => ({\n        id: match.id,\n        content: match.metadata.content,\n        timestamp: match.metadata.timestamp,\n        metadata: match.metadata,\n        score: match.score,\n      }))\n  }\n\n  /**\n   * Get a specific memory by ID\n   */\n  async get(id: string): Promise<Memory | null> {\n    if (!this.userId || !this.env.VECTORIZE) {\n      return null\n    }\n\n    // Vectorize doesn't have a direct get by ID, so we search with a dummy vector\n    // and filter by ID in metadata\n    // This is a limitation - in production, consider caching or using a separate store\n    return null\n  }\n\n  /**\n   * Delete a memory\n   */\n  async delete(id: string): Promise<void> {\n    if (!this.userId || !this.env.VECTORIZE) {\n      return\n    }\n\n    await this.env.VECTORIZE.deleteByIds([id])\n  }\n\n  /**\n   * Delete multiple memories\n   */\n  async deleteMany(ids: string[]): Promise<void> {\n    if (!this.userId || !this.env.VECTORIZE || ids.length === 0) {\n      return\n    }\n\n    await this.env.VECTORIZE.deleteByIds(ids)\n  }\n\n  /**\n   * Clear all memories for this user\n   */\n  async clear(): Promise<void> {\n    if (!this.userId || !this.env.VECTORIZE) {\n      return\n    }\n\n    // Delete by filter (requires Vectorize to support metadata filtering in delete)\n    // This is a placeholder - Vectorize may not support this yet\n    // In production, you may need to track IDs separately\n    logger.warn('Semantic memory clear not fully implemented - requires ID tracking', {\n      userId: this.userId,\n    })\n  }\n\n  /**\n   * Generate embedding for a single text\n   */\n  private async generateEmbedding(text: string): Promise<number[]> {\n    const result = (await this.env.AI.run(this.embeddingModel, {\n      text: [text],\n    })) as AIEmbeddingResult\n\n    return Array.isArray(result.data[0]) ? result.data[0] : (result.data as number[])\n  }\n\n  /**\n   * Generate embeddings for multiple texts\n   */\n  private async generateEmbeddings(texts: string[]): Promise<number[][]> {\n    const result = (await this.env.AI.run(this.embeddingModel, {\n      text: texts,\n    })) as AIEmbeddingResult\n\n    return result.data as number[][]\n  }\n\n  /**\n   * Calculate similarity between two texts\n   */\n  async similarity(text1: string, text2: string): Promise<number> {\n    if (!this.env.AI) {\n      return 0\n    }\n\n    const embeddings = await this.generateEmbeddings([text1, text2])\n    return this.cosineSimilarity(embeddings[0], embeddings[1])\n  }\n\n  /**\n   * Calculate cosine similarity between two vectors\n   */\n  private cosineSimilarity(vec1: number[], vec2: number[]): number {\n    if (vec1.length !== vec2.length) {\n      return 0\n    }\n\n    let dotProduct = 0\n    let norm1 = 0\n    let norm2 = 0\n\n    for (let i = 0; i < vec1.length; i++) {\n      dotProduct += vec1[i] * vec2[i]\n      norm1 += vec1[i] * vec1[i]\n      norm2 += vec2[i] * vec2[i]\n    }\n\n    norm1 = Math.sqrt(norm1)\n    norm2 = Math.sqrt(norm2)\n\n    if (norm1 === 0 || norm2 === 0) {\n      return 0\n    }\n\n    return dotProduct / (norm1 * norm2)\n  }\n}\n","/**\n * Analytical Memory - 5th Memory Tier\n *\n * Provides access to structured data across multiple databases via Hyperdrive.\n * This layer is for querying production databases, analytics DBs, and data warehouses.\n */\n\nimport {\n  HyperdriveRepository,\n  type DatabaseType,\n  type QueryResult,\n} from '../../storage/hyperdrive-repository.js'\nimport { QueryCache } from '../../storage/query-cache.js'\nimport type { ConductorError } from '../../errors/error-types.js'\nimport { Result } from '../../types/result.js'\nimport { Errors } from '../../errors/error-types.js'\n\n/**\n * Database configuration\n */\nexport interface DatabaseConfig {\n  /**\n   * Hyperdrive binding (returns D1Database interface)\n   */\n  binding: D1Database\n\n  /**\n   * Database type\n   */\n  type: DatabaseType\n\n  /**\n   * Schema name (optional)\n   */\n  schema?: string\n\n  /**\n   * Read-only mode\n   */\n  readOnly?: boolean\n\n  /**\n   * Query timeout (ms)\n   */\n  timeout?: number\n\n  /**\n   * Max rows per query\n   */\n  maxRows?: number\n}\n\n/**\n * Analytical memory configuration\n */\nexport interface AnalyticalMemoryConfig {\n  /**\n   * Database configurations by alias\n   */\n  databases: Record<string, DatabaseConfig>\n\n  /**\n   * Default database alias\n   */\n  defaultDatabase?: string\n\n  /**\n   * Enable query result caching\n   */\n  enableCache?: boolean\n\n  /**\n   * Cache TTL for query results (seconds)\n   */\n  cacheTTL?: number\n\n  /**\n   * KV namespace for caching (required if enableCache is true)\n   */\n  cacheKV?: KVNamespace\n}\n\n/**\n * Federated query - query across multiple databases\n */\nexport interface FederatedQuery {\n  /**\n   * Database alias\n   */\n  database: string\n\n  /**\n   * SQL query\n   */\n  sql: string\n\n  /**\n   * Query parameters\n   */\n  params?: unknown[]\n}\n\n/**\n * Analytical Memory - 5th Memory Tier\n *\n * Provides structured data access across multiple Hyperdrive-connected databases.\n */\nexport class AnalyticalMemory {\n  private repositories: Map<string, HyperdriveRepository>\n  private defaultDatabase?: string\n  private cache?: QueryCache\n\n  constructor(\n    _env: unknown, // env reserved for future use, databases come from config\n    private readonly config: AnalyticalMemoryConfig\n  ) {\n    this.repositories = new Map()\n    this.defaultDatabase = config.defaultDatabase\n\n    // Initialize cache if enabled\n    if (config.enableCache && config.cacheKV) {\n      this.cache = new QueryCache({\n        kv: config.cacheKV,\n        defaultTTL: config.cacheTTL || 300,\n        keyPrefix: 'analytical:',\n        enableStats: true,\n      })\n    }\n\n    // Initialize repositories for each database\n    for (const [alias, dbConfig] of Object.entries(config.databases)) {\n      const repository = new HyperdriveRepository(dbConfig.binding, {\n        databaseType: dbConfig.type,\n        schema: dbConfig.schema,\n        options: {\n          readOnly: dbConfig.readOnly,\n          timeout: dbConfig.timeout,\n          maxRows: dbConfig.maxRows,\n        },\n      })\n\n      this.repositories.set(alias, repository)\n    }\n  }\n\n  /**\n   * Query a specific database\n   */\n  async query<T = unknown>(sql: string, params?: unknown[], database?: string): Promise<T[]> {\n    const dbAlias = database || this.defaultDatabase\n\n    if (!dbAlias) {\n      throw new Error('No database specified and no default database configured')\n    }\n\n    const repository = this.repositories.get(dbAlias)\n    if (!repository) {\n      throw new Error(`Database not found: ${dbAlias}`)\n    }\n\n    // Try cache first if enabled\n    if (this.cache && QueryCache.shouldCache(sql)) {\n      const cachedResult = await this.cache.get<T>(sql, params, dbAlias)\n      if (cachedResult.success && cachedResult.value) {\n        return cachedResult.value.rows\n      }\n    }\n\n    // Execute query\n    const result = await repository.query<T>(sql, params)\n\n    if (!result.success) {\n      throw new Error(`Query failed: ${result.error.message}`)\n    }\n\n    // Cache the result if caching is enabled\n    if (this.cache && QueryCache.shouldCache(sql)) {\n      const ttl = QueryCache.getRecommendedTTL(sql)\n      await this.cache.set(sql, result.value, params, dbAlias, ttl)\n    }\n\n    return result.value.rows\n  }\n\n  /**\n   * Query with named parameters\n   */\n  async queryNamed<T = unknown>(\n    sql: string,\n    params: Record<string, unknown>,\n    database?: string\n  ): Promise<T[]> {\n    const dbAlias = database || this.defaultDatabase\n\n    if (!dbAlias) {\n      throw new Error('No database specified and no default database configured')\n    }\n\n    const repository = this.repositories.get(dbAlias)\n    if (!repository) {\n      throw new Error(`Database not found: ${dbAlias}`)\n    }\n\n    const result = await repository.queryNamed<T>(sql, params)\n\n    if (!result.success) {\n      throw new Error(`Query failed: ${result.error.message}`)\n    }\n\n    return result.value.rows\n  }\n\n  /**\n   * Query with full result metadata\n   */\n  async queryWithMetadata<T = unknown>(\n    sql: string,\n    params?: unknown[],\n    database?: string\n  ): Promise<Result<QueryResult<T>, ConductorError>> {\n    const dbAlias = database || this.defaultDatabase\n\n    if (!dbAlias) {\n      return Result.err(Errors.internal('No database specified and no default database configured'))\n    }\n\n    const repository = this.repositories.get(dbAlias)\n    if (!repository) {\n      return Result.err(Errors.internal(`Database not found: ${dbAlias}`))\n    }\n\n    return repository.query<T>(sql, params)\n  }\n\n  /**\n   * Execute a write query (INSERT, UPDATE, DELETE)\n   */\n  async execute(sql: string, params?: unknown[], database?: string): Promise<number> {\n    const dbAlias = database || this.defaultDatabase\n\n    if (!dbAlias) {\n      throw new Error('No database specified and no default database configured')\n    }\n\n    const repository = this.repositories.get(dbAlias)\n    if (!repository) {\n      throw new Error(`Database not found: ${dbAlias}`)\n    }\n\n    if (repository.isReadOnly()) {\n      throw new Error(`Database is read-only: ${dbAlias}`)\n    }\n\n    const result = await repository.execute(sql, params)\n\n    if (!result.success) {\n      throw new Error(`Execute failed: ${result.error.message}`)\n    }\n\n    return result.value.rowsAffected\n  }\n\n  /**\n   * Execute queries across multiple databases (federated query)\n   */\n  async queryMultiple(queries: FederatedQuery[]): Promise<Map<string, unknown[]>> {\n    const results = new Map<string, unknown[]>()\n\n    // Execute queries in parallel\n    const promises = queries.map(async (query) => {\n      const rows = await this.query(query.sql, query.params, query.database)\n      return { database: query.database, rows }\n    })\n\n    const queryResults = await Promise.all(promises)\n\n    // Build result map\n    for (const result of queryResults) {\n      results.set(result.database, result.rows)\n    }\n\n    return results\n  }\n\n  /**\n   * Begin a transaction on a specific database\n   */\n  async transaction<T>(\n    database: string,\n    callback: (repository: HyperdriveRepository) => Promise<T>\n  ): Promise<T> {\n    const repository = this.repositories.get(database)\n    if (!repository) {\n      throw new Error(`Database not found: ${database}`)\n    }\n\n    const result = await repository.transaction(async (tx) => {\n      // For now, pass the repository itself since transaction API is limited\n      return await callback(repository)\n    })\n\n    if (!result.success) {\n      throw new Error(`Transaction failed: ${result.error.message}`)\n    }\n\n    return result.value\n  }\n\n  /**\n   * Get list of available databases\n   */\n  getDatabases(): string[] {\n    return Array.from(this.repositories.keys())\n  }\n\n  /**\n   * Check if a database is available\n   */\n  hasDatabase(alias: string): boolean {\n    return this.repositories.has(alias)\n  }\n\n  /**\n   * Get database configuration\n   */\n  getDatabaseConfig(alias: string): DatabaseConfig | undefined {\n    return this.config.databases[alias]\n  }\n\n  /**\n   * Get repository for a database\n   */\n  getRepository(alias: string): HyperdriveRepository | undefined {\n    return this.repositories.get(alias)\n  }\n\n  /**\n   * List tables in a database\n   */\n  async listTables(database?: string): Promise<string[]> {\n    const dbAlias = database || this.defaultDatabase\n\n    if (!dbAlias) {\n      throw new Error('No database specified and no default database configured')\n    }\n\n    const repository = this.repositories.get(dbAlias)\n    if (!repository) {\n      throw new Error(`Database not found: ${dbAlias}`)\n    }\n\n    const result = await repository.listTables()\n\n    if (!result.success) {\n      throw new Error(`Failed to list tables: ${result.error.message}`)\n    }\n\n    return result.value\n  }\n\n  /**\n   * Get table metadata\n   */\n  async getTableInfo(tableName: string, database?: string) {\n    const dbAlias = database || this.defaultDatabase\n\n    if (!dbAlias) {\n      throw new Error('No database specified and no default database configured')\n    }\n\n    const repository = this.repositories.get(dbAlias)\n    if (!repository) {\n      throw new Error(`Database not found: ${dbAlias}`)\n    }\n\n    const result = await repository.getTableInfo(tableName)\n\n    if (!result.success) {\n      throw new Error(`Failed to get table info: ${result.error.message}`)\n    }\n\n    return result.value\n  }\n\n  /**\n   * Get default database alias\n   */\n  getDefaultDatabase(): string | undefined {\n    return this.defaultDatabase\n  }\n\n  /**\n   * Set default database\n   */\n  setDefaultDatabase(alias: string): void {\n    if (!this.repositories.has(alias)) {\n      throw new Error(`Database not found: ${alias}`)\n    }\n    this.defaultDatabase = alias\n  }\n\n  /**\n   * Get cache statistics (if caching is enabled)\n   */\n  getCacheStats() {\n    return this.cache?.getStats()\n  }\n\n  /**\n   * Clear cache for a specific database\n   */\n  async clearCache(database?: string): Promise<number> {\n    if (!this.cache) {\n      return 0\n    }\n\n    if (database) {\n      const result = await this.cache.clearDatabase(database)\n      return result.success ? result.value : 0\n    } else {\n      const result = await this.cache.clearAll()\n      return result.success ? result.value : 0\n    }\n  }\n\n  /**\n   * Reset cache statistics\n   */\n  resetCacheStats(): void {\n    this.cache?.resetStats()\n  }\n\n  /**\n   * Check if caching is enabled\n   */\n  isCacheEnabled(): boolean {\n    return this.cache !== undefined\n  }\n}\n","/**\n * Memory Manager - Hierarchical Memory System\n *\n * Orchestrates 5 memory layers:\n * 1. Working - Current execution context (in-memory)\n * 2. Session - Conversation history (KV with TTL)\n * 3. Long-Term - Persistent user data (D1)\n * 4. Semantic - Vector-based retrieval (Vectorize)\n * 5. Analytical - Structured data via Hyperdrive (SQL databases)\n *\n * Provides a unified interface for memory operations across all layers.\n */\n\nimport { WorkingMemory } from './working-memory.js'\nimport { SessionMemory } from './session-memory.js'\nimport { LongTermMemory } from './long-term-memory.js'\nimport { SemanticMemory } from './semantic-memory.js'\nimport { AnalyticalMemory } from './analytical-memory.js'\nimport type { MemoryConfig, Message, Memory, SearchOptions, MemorySnapshot } from './types.js'\nimport type { ConductorEnv } from '../../types/env.js'\n\nexport class MemoryManager {\n  private workingMemory: WorkingMemory\n  private sessionMemory: SessionMemory | null = null\n  private longTermMemory: LongTermMemory | null = null\n  private semanticMemory: SemanticMemory | null = null\n  private analyticalMemory: AnalyticalMemory | null = null\n\n  constructor(\n    private readonly env: ConductorEnv,\n    private readonly config: MemoryConfig,\n    private readonly userId?: string,\n    private readonly sessionId?: string\n  ) {\n    // Always create working memory\n    this.workingMemory = new WorkingMemory()\n\n    // Create other layers based on config\n    if (config.layers.session && sessionId) {\n      this.sessionMemory = new SessionMemory(env, sessionId, config.sessionTTL)\n    }\n\n    if (config.layers.longTerm && userId) {\n      this.longTermMemory = new LongTermMemory(env, userId)\n    }\n\n    if (config.layers.semantic && userId) {\n      this.semanticMemory = new SemanticMemory(env, userId)\n    }\n\n    if (config.layers.analytical && config.analyticalConfig) {\n      this.analyticalMemory = new AnalyticalMemory(env, config.analyticalConfig)\n    }\n  }\n\n  // ==================== Working Memory ====================\n\n  /**\n   * Set a value in working memory\n   */\n  setWorking(key: string, value: unknown): void {\n    this.workingMemory.set(key, value)\n  }\n\n  /**\n   * Get a value from working memory\n   */\n  getWorking(key: string): unknown {\n    return this.workingMemory.get(key)\n  }\n\n  /**\n   * Get all working memory\n   */\n  getWorkingAll(): Record<string, unknown> {\n    return this.workingMemory.getAll()\n  }\n\n  /**\n   * Clear working memory\n   */\n  clearWorking(): void {\n    this.workingMemory.clear()\n  }\n\n  // ==================== Session Memory ====================\n\n  /**\n   * Add a message to session memory\n   */\n  async addMessage(message: Message): Promise<void> {\n    if (!this.sessionMemory) {\n      return\n    }\n    await this.sessionMemory.add(message)\n  }\n\n  /**\n   * Get conversation history\n   */\n  async getConversationHistory(): Promise<Message[]> {\n    if (!this.sessionMemory) {\n      return []\n    }\n    const history = await this.sessionMemory.get()\n    return history.messages\n  }\n\n  /**\n   * Get last N messages\n   */\n  async getLastMessages(n: number): Promise<Message[]> {\n    if (!this.sessionMemory) {\n      return []\n    }\n    return await this.sessionMemory.getLastN(n)\n  }\n\n  /**\n   * Clear session memory\n   */\n  async clearSession(): Promise<void> {\n    if (!this.sessionMemory) {\n      return\n    }\n    await this.sessionMemory.clear()\n  }\n\n  /**\n   * Compress session memory\n   */\n  async compressSession(maxMessages: number): Promise<void> {\n    if (!this.sessionMemory) {\n      return\n    }\n    await this.sessionMemory.compress(maxMessages)\n  }\n\n  /**\n   * Format messages for AI model consumption\n   * Strips metadata - returns only role + content\n   * Limits to maxContext most recent messages\n   *\n   * @param maxContext - Maximum messages to include (default: 10 = 5 exchanges)\n   */\n  async formatMessagesForAI(\n    maxContext: number = 10\n  ): Promise<Array<{ role: string; content: string }>> {\n    if (!this.sessionMemory) {\n      return []\n    }\n    return await this.sessionMemory.formatForAI(maxContext)\n  }\n\n  /**\n   * Get conversation metadata (for debugging/analytics)\n   */\n  async getConversationMetadata(): Promise<{\n    sessionId: string | undefined\n    messageCount: number\n    modelsUsed: string[]\n    firstMessage?: number\n    lastMessage?: number\n    userMessages: number\n    assistantMessages: number\n    totalTokens: { input: number; output: number }\n  } | null> {\n    if (!this.sessionMemory) {\n      return null\n    }\n    return await this.sessionMemory.getMetadata()\n  }\n\n  // ==================== Long-Term Memory ====================\n\n  /**\n   * Set a value in long-term memory\n   */\n  async setLongTerm(key: string, value: unknown): Promise<void> {\n    if (!this.longTermMemory) {\n      return\n    }\n    await this.longTermMemory.set(key, value)\n  }\n\n  /**\n   * Get a value from long-term memory\n   */\n  async getLongTerm(key: string): Promise<unknown> {\n    if (!this.longTermMemory) {\n      return null\n    }\n    return await this.longTermMemory.get(key)\n  }\n\n  /**\n   * Get all long-term memory\n   */\n  async getLongTermAll(): Promise<Record<string, unknown>> {\n    if (!this.longTermMemory) {\n      return {}\n    }\n    return await this.longTermMemory.getAll()\n  }\n\n  /**\n   * Delete from long-term memory\n   */\n  async deleteLongTerm(key: string): Promise<void> {\n    if (!this.longTermMemory) {\n      return\n    }\n    await this.longTermMemory.delete(key)\n  }\n\n  /**\n   * Clear long-term memory\n   */\n  async clearLongTerm(): Promise<void> {\n    if (!this.longTermMemory) {\n      return\n    }\n    await this.longTermMemory.clear()\n  }\n\n  // ==================== Semantic Memory ====================\n\n  /**\n   * Add a memory to semantic storage\n   */\n  async addSemantic(content: string, metadata?: Record<string, unknown>): Promise<string> {\n    if (!this.semanticMemory) {\n      return ''\n    }\n    return await this.semanticMemory.add(content, metadata)\n  }\n\n  /**\n   * Search semantic memory\n   */\n  async searchSemantic(query: string, options?: SearchOptions): Promise<Memory[]> {\n    if (!this.semanticMemory) {\n      return []\n    }\n    return await this.semanticMemory.search(query, options)\n  }\n\n  /**\n   * Delete from semantic memory\n   */\n  async deleteSemantic(id: string): Promise<void> {\n    if (!this.semanticMemory) {\n      return\n    }\n    await this.semanticMemory.delete(id)\n  }\n\n  /**\n   * Clear semantic memory\n   */\n  async clearSemantic(): Promise<void> {\n    if (!this.semanticMemory) {\n      return\n    }\n    await this.semanticMemory.clear()\n  }\n\n  // ==================== Unified Operations ====================\n\n  /**\n   * Create a complete memory snapshot\n   */\n  async snapshot(): Promise<MemorySnapshot> {\n    const snapshot: MemorySnapshot = {\n      working: this.workingMemory.getAll(),\n    }\n\n    if (this.sessionMemory) {\n      snapshot.session = await this.sessionMemory.get()\n    }\n\n    if (this.longTermMemory) {\n      snapshot.longTerm = await this.longTermMemory.getAll()\n    }\n\n    if (this.semanticMemory) {\n      // Note: Can't snapshot all semantic memories efficiently\n      // This would require tracking all memory IDs\n      snapshot.semantic = []\n    }\n\n    return snapshot\n  }\n\n  /**\n   * Clear all memory layers\n   */\n  async clearAll(): Promise<void> {\n    this.clearWorking()\n    await this.clearSession()\n    await this.clearLongTerm()\n    await this.clearSemantic()\n  }\n\n  /**\n   * Get memory statistics\n   */\n  async getStats(): Promise<{\n    working: { size: number }\n    session?: { messageCount: number }\n    longTerm?: { keyCount: number }\n    semantic?: { note: string }\n    analytical?: { databases: string[]; databaseCount: number }\n  }> {\n    const stats: {\n      working: { size: number }\n      session?: { messageCount: number }\n      longTerm?: { keyCount: number }\n      semantic?: { note: string }\n      analytical?: { databases: string[]; databaseCount: number }\n    } = {\n      working: { size: this.workingMemory.size() },\n    }\n\n    if (this.sessionMemory) {\n      stats.session = {\n        messageCount: await this.sessionMemory.count(),\n      }\n    }\n\n    if (this.longTermMemory) {\n      stats.longTerm = {\n        keyCount: await this.longTermMemory.count(),\n      }\n    }\n\n    if (this.semanticMemory) {\n      stats.semantic = {\n        note: 'Semantic memory count not available via Vectorize API',\n      }\n    }\n\n    if (this.analyticalMemory) {\n      stats.analytical = {\n        databases: this.analyticalMemory.getDatabases(),\n        databaseCount: this.analyticalMemory.getDatabases().length,\n      }\n    }\n\n    return stats\n  }\n\n  /**\n   * Check if a memory layer is enabled\n   */\n  isLayerEnabled(layer: 'working' | 'session' | 'longTerm' | 'semantic' | 'analytical'): boolean {\n    switch (layer) {\n      case 'working':\n        return true // Always enabled\n      case 'session':\n        return !!this.sessionMemory\n      case 'longTerm':\n        return !!this.longTermMemory\n      case 'semantic':\n        return !!this.semanticMemory\n      case 'analytical':\n        return !!this.analyticalMemory\n      default:\n        return false\n    }\n  }\n\n  // ==================== Analytical Memory ====================\n\n  /**\n   * Query analytical database\n   */\n  async queryAnalytical<T = unknown>(\n    sql: string,\n    params?: unknown[],\n    database?: string\n  ): Promise<T[]> {\n    if (!this.analyticalMemory) {\n      return []\n    }\n    return await this.analyticalMemory.query<T>(sql, params, database)\n  }\n\n  /**\n   * Query analytical database with named parameters\n   */\n  async queryAnalyticalNamed<T = unknown>(\n    sql: string,\n    params: Record<string, unknown>,\n    database?: string\n  ): Promise<T[]> {\n    if (!this.analyticalMemory) {\n      return []\n    }\n    return await this.analyticalMemory.queryNamed<T>(sql, params, database)\n  }\n\n  /**\n   * Execute write query on analytical database\n   */\n  async executeAnalytical(sql: string, params?: unknown[], database?: string): Promise<number> {\n    if (!this.analyticalMemory) {\n      return 0\n    }\n    return await this.analyticalMemory.execute(sql, params, database)\n  }\n\n  /**\n   * Execute federated query across multiple databases\n   */\n  async queryMultiple(\n    queries: Array<{ database: string; sql: string; params?: unknown[] }>\n  ): Promise<Map<string, unknown[]>> {\n    if (!this.analyticalMemory) {\n      return new Map()\n    }\n    return await this.analyticalMemory.queryMultiple(queries)\n  }\n\n  /**\n   * Get available analytical databases\n   */\n  getAnalyticalDatabases(): string[] {\n    if (!this.analyticalMemory) {\n      return []\n    }\n    return this.analyticalMemory.getDatabases()\n  }\n\n  /**\n   * Check if analytical database exists\n   */\n  hasAnalyticalDatabase(alias: string): boolean {\n    if (!this.analyticalMemory) {\n      return false\n    }\n    return this.analyticalMemory.hasDatabase(alias)\n  }\n\n  /**\n   * List tables in analytical database\n   */\n  async listAnalyticalTables(database?: string): Promise<string[]> {\n    if (!this.analyticalMemory) {\n      return []\n    }\n    return await this.analyticalMemory.listTables(database)\n  }\n\n  /**\n   * Get analytical memory instance (for advanced usage)\n   */\n  getAnalyticalMemory(): AnalyticalMemory | null {\n    return this.analyticalMemory\n  }\n}\n","/**\n * Core Executor - Refactored with Result Types\n *\n * Orchestrates ensemble execution with explicit error handling using Result types.\n * Makes all error cases explicit and checked at compile time.\n */\n\nimport {\n  Parser,\n  type EnsembleConfig,\n  type FlowStep,\n  type AgentConfig,\n  type AgentFlowStep,\n  type FlowStepType,\n} from './parser.js'\nimport {\n  GraphExecutor,\n  hasControlFlowSteps,\n  type AgentExecutorFn,\n  type GraphExecutionContext,\n} from './graph-executor.js'\n\n/**\n * Type guard to check if a flow step is an agent step (not a control flow step)\n */\nfunction isAgentStep(step: FlowStepType): step is AgentFlowStep {\n  return 'agent' in step && typeof (step as AgentFlowStep).agent === 'string'\n}\nimport { StateManager, type AccessReport, type AccessLogEntry } from './state-manager.js'\nimport type { BaseAgent, AgentExecutionContext, AgentResponse } from '../agents/base-agent.js'\nimport type { ConductorEnv } from '../types/env.js'\nimport { FunctionAgent } from '../agents/function-agent.js'\nimport { CodeAgent } from '../agents/code-agent.js'\nimport { ThinkAgent } from '../agents/think-agent.js'\nimport { StorageAgent } from '../agents/storage-agent.js'\nimport { DataAgent } from '../agents/data-agent.js'\nimport { APIAgent } from '../agents/api-agent.js'\nimport { EmailAgent } from '../agents/email/email-agent.js'\nimport { SmsMember } from '../agents/sms/sms-agent.js'\nimport { FormAgent } from '../agents/form/form-agent.js'\nimport { HtmlMember } from '../agents/html/html-agent.js'\nimport { PdfMember } from '../agents/pdf/pdf-agent.js'\nimport { getBuiltInRegistry } from '../agents/built-in/registry.js'\nimport { Result, type AsyncResult } from '../types/result.js'\nimport {\n  Errors,\n  type ConductorError,\n  AgentExecutionError,\n  EnsembleExecutionError,\n  ConfigurationError,\n} from '../errors/error-types.js'\nimport { Operation } from '../types/constants.js'\nimport {\n  ScoringExecutor,\n  EnsembleScorer,\n  type ScoringState,\n  type ScoringResult,\n  type AgentScoringConfig,\n  type EnsembleScoringConfig,\n} from './scoring/index.js'\nimport { ResumptionManager, type SuspendedExecutionState } from './resumption-manager.js'\nimport {\n  createLogger,\n  type Logger,\n  ObservabilityManager,\n  createObservabilityManager,\n  generateExecutionId,\n  type MetricsRecorder,\n} from '../observability/index.js'\nimport type { ExecutionId, RequestId } from '../types/branded.js'\nimport type { ObservabilityConfig } from '../config/types.js'\nimport { NotificationManager } from './notifications/index.js'\nimport { createComponentLoader, type ComponentLoader } from './component-loader.js'\nimport {\n  hasGlobalScriptLoader,\n  getGlobalScriptLoader,\n  parseScriptURI,\n  isScriptReference,\n} from '../utils/script-loader.js'\nimport {\n  ComponentRegistry,\n  createComponentRegistry,\n  createAgentRegistry,\n  createEnsembleRegistry,\n  createDocsRegistry,\n  type AgentRegistry,\n  type EnsembleRegistry,\n  type DocsRegistry,\n} from '../components/index.js'\nimport { resolveOutput, type EnsembleOutput, type OutputFormat } from './output-resolver.js'\nimport { MemoryManager } from './memory/memory-manager.js'\nimport type { MemoryConfig } from './memory/types.js'\n\nimport type { AuthContext } from '../auth/types.js'\n\n/** Default timeout for agent execution (30 seconds) */\nconst DEFAULT_AGENT_TIMEOUT_MS = 30000\n\n/**\n * Discovery data for agents, ensembles, and other resources\n *\n * Allows agents to discover and enumerate available resources at runtime.\n * This is the canonical way to pass auto-discovered resources to the executor.\n *\n * The interface is designed to be extensible for future resource types.\n * Each resource type provides the Map format expected by its registry.\n *\n * @example\n * ```typescript\n * const executor = new Executor({\n *   env,\n *   ctx,\n *   discovery: {\n *     ensembles: ensembleLoader.getRegistryData(),\n *     agents: agentLoader.getRegistryData(),\n *     docs: docsLoader.getRegistryData(),\n *   }\n * });\n * ```\n */\nexport interface DiscoveryData {\n  /**\n   * Ensemble registry data from EnsembleLoader.getRegistryData()\n   * Used to populate ctx.ensembleRegistry for agent access\n   */\n  ensembles?: Map<string, { config: EnsembleConfig; source: 'yaml' | 'typescript' }>\n\n  /**\n   * Agent metadata for discovery (agents are also passed via registerAgent)\n   * This provides additional discovery data beyond what's in the agent registry\n   */\n  agents?: Map<string, { config: AgentConfig; source: 'yaml' | 'typescript' }>\n\n  /**\n   * Docs pages from DocsDirectoryLoader\n   * Allows agents to discover available documentation pages\n   */\n  docs?: Map<string, { content: string; title: string; slug: string }>\n\n  /**\n   * Extensible custom discovery data\n   * Use this for project-specific or future resource types\n   *\n   * @example\n   * ```typescript\n   * discovery: {\n   *   custom: {\n   *     'workflows': myWorkflowsMap,\n   *     'integrations': myIntegrationsMap,\n   *   }\n   * }\n   * ```\n   */\n  custom?: Record<string, Map<string, unknown>>\n}\n\nexport interface ExecutorConfig {\n  env: ConductorEnv\n  ctx: ExecutionContext\n  logger?: Logger\n  /** Observability configuration from conductor.config.ts */\n  observability?: ObservabilityConfig\n  /** Request ID from incoming HTTP request (for tracing) - branded type for type safety */\n  requestId?: RequestId\n  /** Authentication context from the request */\n  auth?: AuthContext\n  /** Default timeout for agent execution in milliseconds (default: 30000) */\n  defaultTimeout?: number\n  /** Discovery data for agents and ensembles - enables ctx.agentRegistry and ctx.ensembleRegistry */\n  discovery?: DiscoveryData\n}\n\n/**\n * Execute a promise with a timeout\n * @param promise - The promise to execute\n * @param timeoutMs - Timeout in milliseconds\n * @param agentName - Agent name for error messages\n * @returns The promise result or throws a timeout error\n */\nasync function withTimeout<T>(\n  promise: Promise<T>,\n  timeoutMs: number,\n  agentName: string\n): Promise<T> {\n  let timeoutId: ReturnType<typeof setTimeout> | undefined\n\n  const timeoutPromise = new Promise<never>((_, reject) => {\n    timeoutId = setTimeout(() => {\n      reject(new AgentExecutionError(agentName, `Agent execution timed out after ${timeoutMs}ms`))\n    }, timeoutMs)\n  })\n\n  try {\n    const result = await Promise.race([promise, timeoutPromise])\n    return result\n  } finally {\n    if (timeoutId !== undefined) {\n      clearTimeout(timeoutId)\n    }\n  }\n}\n\n/**\n * Response metadata for HTTP responses\n */\nexport interface ResponseMetadata {\n  /** HTTP status code (default: 200) */\n  status: number\n  /** Custom response headers */\n  headers?: Record<string, string>\n  /** Redirect configuration */\n  redirect?: {\n    url: string\n    status?: 301 | 302 | 307 | 308\n  }\n  /** If true, output is raw string (not JSON) */\n  isRawBody?: boolean\n  /** Output format for Content-Type and serialization (triggers only) */\n  format?: OutputFormat\n}\n\n/**\n * Successful execution output\n */\nexport interface ExecutionOutput {\n  output: unknown\n  metrics: ExecutionMetrics\n  stateReport?: AccessReport\n  scoring?: ScoringState\n  /** Response metadata for HTTP responses (status, headers, redirect) */\n  response?: ResponseMetadata\n}\n\n/**\n * Legacy execution result for backwards compatibility\n * New code should use Result<ExecutionOutput, ConductorError>\n */\nexport interface ExecutionResult {\n  success: boolean\n  output?: unknown\n  error?: string\n  metrics: ExecutionMetrics\n  stateReport?: AccessReport\n}\n\nexport interface ExecutionMetrics {\n  ensemble: string\n  totalDuration: number\n  agents: AgentMetric[]\n  cacheHits: number\n  stateAccess?: AccessReport\n}\n\nexport interface AgentMetric {\n  name: string\n  duration: number\n  cached: boolean\n  success: boolean\n}\n\n/**\n * Structure stored in execution context for each agent\n * Available for interpolation in output blocks as ${agentName.output} and ${agentName.success}\n */\ninterface AgentExecutionResult {\n  output: unknown\n  /** Whether the agent completed successfully (true when we reach context storage) */\n  success: boolean\n  [key: string]: unknown // Allow additional metadata\n}\n\n/**\n * Execution context type with proper agent result typing\n */\ninterface ExecutionContextMap {\n  input?: unknown\n  state?: unknown\n  [agentName: string]: unknown | AgentExecutionResult\n}\n\n/**\n * Internal context for flow execution\n * Encapsulates shared state during ensemble execution\n */\ninterface FlowExecutionContext {\n  ensemble: EnsembleConfig\n  executionContext: ExecutionContextMap\n  metrics: ExecutionMetrics\n  stateManager: StateManager | null\n  scoringState: ScoringState | null\n  ensembleScorer: EnsembleScorer | null\n  scoringExecutor: ScoringExecutor\n  startTime: number\n  /** Observability manager for this execution */\n  observability: ObservabilityManager\n  /** Execution ID for tracing - branded type for type safety */\n  executionId: ExecutionId\n  /** Component registry for schemas, prompts, configs */\n  componentRegistry: ComponentRegistry\n  /** Agent registry for discovering available agents */\n  agentRegistry: AgentRegistry\n  /** Ensemble registry for discovering available ensembles */\n  ensembleRegistry: EnsembleRegistry\n  /** Docs registry for discovering documentation pages */\n  docsRegistry: DocsRegistry\n  /** Memory manager for conversation history and persistent storage */\n  memoryManager: MemoryManager | null\n}\n\n/**\n * Context passed to agent execution\n * Used internally by executeStep helper methods\n */\ninterface StepExecutionContext {\n  step: AgentFlowStep\n  flowContext: FlowExecutionContext\n  stepIndex: number\n  agent: BaseAgent\n  resolvedInput: unknown\n  agentLogger: Logger\n  agentMetrics: MetricsRecorder\n  agentContext: AgentExecutionContext\n  getPendingUpdates: (() => { updates: Record<string, unknown>; newLog: AccessLogEntry[] }) | null\n}\n\n/**\n * Core execution engine for ensembles with Result-based error handling\n */\nexport class Executor {\n  private env: ConductorEnv\n  private ctx: ExecutionContext\n  private agentRegistry: Map<string, BaseAgent>\n  private logger: Logger\n  private observabilityConfig?: ObservabilityConfig\n  private requestId?: RequestId\n  private auth?: AuthContext\n  private defaultTimeout: number\n  private discoveryData?: DiscoveryData\n\n  constructor(config: ExecutorConfig) {\n    this.env = config.env\n    this.ctx = config.ctx\n    this.agentRegistry = new Map()\n    this.observabilityConfig = config.observability\n    this.requestId = config.requestId\n    this.auth = config.auth\n    this.defaultTimeout = config.defaultTimeout ?? DEFAULT_AGENT_TIMEOUT_MS\n    this.logger = config.logger || createLogger({ serviceName: 'executor' }, this.env.ANALYTICS)\n    this.discoveryData = config.discovery\n  }\n\n  /**\n   * Register an agent for use in ensembles\n   */\n  registerAgent(agent: BaseAgent): void {\n    this.agentRegistry.set(agent.getName(), agent)\n  }\n\n  /**\n   * Resolve an agent by reference with explicit error handling\n   * Supports both simple names and versioned references (name@version)\n   *\n   * Loading priority:\n   * 1. Check built-in agents (scrape, validate, rag, hitl, fetch)\n   * 2. Check user-defined agents (registered via registerAgent)\n   * 3. Error if not found\n   *\n   * @param agentRef - Agent reference (e.g., \"greet\" or \"analyze-company@production\")\n   * @returns Result containing the agent or an error\n   */\n  private async resolveAgent(agentRef: string): AsyncResult<BaseAgent, ConductorError> {\n    const { name, version } = Parser.parseAgentReference(agentRef)\n\n    // If no version specified, check both built-in and user registries\n    if (!version) {\n      // 1. Check if it's a built-in agent first\n      const builtInRegistry = getBuiltInRegistry()\n      if (builtInRegistry.isBuiltIn(name)) {\n        try {\n          // Create a minimal AgentConfig for built-in agents\n          const config: AgentConfig = {\n            name: name,\n            operation: builtInRegistry.getMetadata(name)?.operation || Operation.code,\n            config: {},\n          }\n          const agent = await builtInRegistry.create(name, config, this.env)\n          return Result.ok(agent)\n        } catch (error) {\n          return Result.err(\n            Errors.agentConfig(\n              name,\n              `Failed to load built-in agent: ${error instanceof Error ? error.message : 'Unknown error'}`\n            )\n          )\n        }\n      }\n\n      // 2. Check user-defined agent registry\n      const agent = this.agentRegistry.get(name)\n      if (!agent) {\n        return Result.err(Errors.agentNotFound(name))\n      }\n      return Result.ok(agent)\n    }\n\n    // Version specified - check cache first\n    const versionedKey = `${name}@${version}`\n    if (this.agentRegistry.has(versionedKey)) {\n      const agent = this.agentRegistry.get(versionedKey)!\n      return Result.ok(agent)\n    }\n\n    // Try to load from local registry (Edgit not yet integrated)\n    const localAgent = this.agentRegistry.get(name)\n    if (localAgent) {\n      // Cache it under versioned key\n      this.agentRegistry.set(versionedKey, localAgent)\n      return Result.ok(localAgent)\n    }\n\n    // Not found\n    return Result.err(\n      Errors.agentConfig(\n        agentRef,\n        'Versioned agent loading requires Edgit integration. ' +\n          'Register agents manually using executor.registerAgent()'\n      )\n    )\n  }\n\n  /**\n   * Create an agent instance from config\n   * Used for dynamically loading agents from Edgit\n   */\n  private createAgentFromConfig(config: AgentConfig): Result<BaseAgent, ConductorError> {\n    switch (config.operation) {\n      case Operation.think:\n        return Result.ok(new ThinkAgent(config))\n\n      case Operation.storage:\n        return Result.ok(new StorageAgent(config))\n\n      case Operation.data:\n        return Result.ok(new DataAgent(config))\n\n      case Operation.http:\n        return Result.ok(new APIAgent(config))\n\n      case Operation.email:\n        return Result.ok(new EmailAgent(config))\n\n      case Operation.sms:\n        return Result.ok(new SmsMember(config))\n\n      case Operation.form:\n        return Result.ok(new FormAgent(config))\n\n      case Operation.html:\n        return Result.ok(new HtmlMember(config))\n\n      case Operation.pdf:\n        return Result.ok(new PdfMember(config))\n\n      case Operation.code:\n        // Try to create CodeAgent (supports both inline and script:// URIs)\n        const codeAgent = CodeAgent.fromConfig(config)\n        if (codeAgent) {\n          return Result.ok(codeAgent)\n        }\n\n        // Fallback to FunctionAgent for backwards compatibility\n        const inlineAgent = FunctionAgent.fromConfig(config)\n        if (inlineAgent) {\n          return Result.ok(inlineAgent)\n        }\n\n        return Result.err(\n          Errors.agentConfig(\n            config.name,\n            'Code agents require either a script:// URI or an inline handler function'\n          )\n        )\n\n      case Operation.tools:\n        return Result.err(Errors.agentConfig(config.name, 'MCP agent type not yet implemented'))\n\n      case Operation.scoring:\n        return Result.err(Errors.agentConfig(config.name, 'Scoring agent type not yet implemented'))\n\n      default:\n        return Result.err(\n          Errors.agentConfig(config.name, `Unknown agent operation: ${config.operation}`)\n        )\n    }\n  }\n\n  /**\n   * Resolve input for a step based on explicit mapping, previous output, or ensemble input\n   * @private\n   */\n  private resolveStepInput(\n    step: AgentFlowStep,\n    flowContext: FlowExecutionContext,\n    stepIndex: number\n  ): unknown {\n    const { ensemble, executionContext } = flowContext\n\n    if (step.input) {\n      // User specified explicit input mapping\n      return Parser.resolveInterpolation(step.input, executionContext)\n    } else if (stepIndex > 0 && ensemble.flow) {\n      // Default to previous agent's output for chaining\n      const previousStep = ensemble.flow[stepIndex - 1]\n      const previousAgentName = isAgentStep(previousStep) ? previousStep.agent : undefined\n      if (previousAgentName) {\n        const previousResult = executionContext[previousAgentName] as\n          | AgentExecutionResult\n          | undefined\n        return previousResult?.output || {}\n      }\n    }\n    // First step with no input - use original ensemble input\n    return executionContext.input || {}\n  }\n\n  /**\n   * Build the agent execution context with all necessary dependencies\n   * @private\n   */\n  private buildAgentContext(\n    resolvedInput: unknown,\n    flowContext: FlowExecutionContext,\n    agentLogger: Logger,\n    agentMetrics: MetricsRecorder,\n    agentConfig: Record<string, any> | undefined\n  ): AgentExecutionContext {\n    return {\n      input: resolvedInput as Record<string, any>,\n      env: this.env,\n      ctx: this.ctx,\n      previousOutputs: flowContext.executionContext,\n      logger: agentLogger,\n      metrics: agentMetrics,\n      executionId: flowContext.executionId,\n      requestId: this.requestId,\n      auth: this.auth,\n      // Component registries for TypeScript handlers\n      schemas: flowContext.componentRegistry.schemas,\n      prompts: flowContext.componentRegistry.prompts,\n      configs: flowContext.componentRegistry.configs,\n      queries: flowContext.componentRegistry.queries,\n      scripts: flowContext.componentRegistry.scripts,\n      templates: flowContext.componentRegistry.templates,\n      // Discovery registries for agents, ensembles, and docs\n      agentRegistry: flowContext.agentRegistry,\n      ensembleRegistry: flowContext.ensembleRegistry,\n      docsRegistry: flowContext.docsRegistry,\n      // Agent-specific config from ensemble definition\n      config: agentConfig,\n      // Memory manager for conversation history and persistent storage\n      memory: flowContext.memoryManager ?? undefined,\n    }\n  }\n\n  /**\n   * Execute agent with scoring/retry logic\n   * @private\n   */\n  private async executeAgentWithScoring(\n    stepContext: StepExecutionContext\n  ): Promise<{ response: AgentResponse; scoringResult?: ScoringResult }> {\n    const { step, flowContext, agent, agentContext, getPendingUpdates } = stepContext\n    const {\n      ensemble,\n      executionContext,\n      scoringState,\n      ensembleScorer,\n      scoringExecutor,\n      stateManager,\n    } = flowContext\n\n    const agentTimeout = step.timeout ?? this.defaultTimeout\n    const scoringConfig = step.scoring as AgentScoringConfig\n\n    const scoredResult = await scoringExecutor.executeWithScoring(\n      // Agent execution function (with timeout)\n      async () => {\n        const resp = await withTimeout(agent.execute(agentContext), agentTimeout, step.agent)\n        // Apply state updates after each attempt\n        if (stateManager && getPendingUpdates) {\n          const { updates, newLog } = getPendingUpdates()\n          flowContext.stateManager = stateManager.applyPendingUpdates(updates, newLog)\n        }\n        return resp\n      },\n      // Evaluator function\n      async (output, attempt, previousScore) => {\n        // Resolve the evaluator agent\n        const evaluatorResult = await this.resolveAgent(scoringConfig.evaluator)\n        if (!evaluatorResult.success) {\n          throw new Error(`Failed to resolve evaluator agent: ${evaluatorResult.error.message}`)\n        }\n\n        const evaluator = evaluatorResult.value\n\n        // Create evaluation context with the output to score\n        const evalContext: AgentExecutionContext = {\n          input: {\n            output: output.success ? output.data : null,\n            attempt,\n            previousScore,\n            criteria: scoringConfig.criteria || ensemble.scoring?.criteria,\n          },\n          env: this.env,\n          ctx: this.ctx,\n          previousOutputs: executionContext,\n        }\n\n        // Execute evaluator\n        const evalResponse = await evaluator.execute(evalContext)\n\n        if (!evalResponse.success) {\n          throw new Error(`Evaluator failed: ${evalResponse.error || 'Unknown error'}`)\n        }\n\n        // Parse evaluator output as ScoringResult\n        const evalData = evalResponse.data as Record<string, unknown> | number\n        const score =\n          typeof evalData === 'number'\n            ? evalData\n            : typeof evalData === 'object' && evalData !== null && 'score' in evalData\n              ? (evalData.score as number)\n              : typeof evalData === 'object' && evalData !== null && 'value' in evalData\n                ? (evalData.value as number)\n                : 0\n\n        const threshold =\n          scoringConfig.thresholds?.minimum || ensemble.scoring?.defaultThresholds?.minimum || 0.7\n\n        return {\n          score,\n          passed: score >= threshold,\n          feedback:\n            typeof evalData === 'object' && evalData !== null && 'feedback' in evalData\n              ? String(evalData.feedback)\n              : typeof evalData === 'object' && evalData !== null && 'message' in evalData\n                ? String(evalData.message)\n                : '',\n          breakdown:\n            typeof evalData === 'object' && evalData !== null && 'breakdown' in evalData\n              ? (evalData.breakdown as Record<string, number>)\n              : {},\n          metadata: {\n            attempt,\n            evaluator: scoringConfig.evaluator,\n            timestamp: Date.now(),\n          },\n        }\n      },\n      scoringConfig\n    )\n\n    // Update scoring state\n    const scoringResult = scoredResult.score\n    if (scoringState && ensembleScorer) {\n      scoringState.scoreHistory.push({\n        agent: step.agent,\n        score: scoringResult.score,\n        passed: scoringResult.passed,\n        feedback: scoringResult.feedback,\n        breakdown: scoringResult.breakdown,\n        timestamp: Date.now(),\n        attempt: scoredResult.attempts,\n      })\n      scoringState.retryCount[step.agent] = scoredResult.attempts - 1\n\n      // Handle scoring status\n      if (scoredResult.status === 'max_retries_exceeded') {\n        this.logger.warn('Agent exceeded max retries', {\n          agentName: step.agent,\n          score: scoringResult.score,\n          attempts: scoredResult.attempts,\n          ensembleName: ensemble.name,\n        })\n      }\n    }\n\n    return { response: scoredResult.output, scoringResult }\n  }\n\n  /**\n   * Execute agent without scoring (normal path)\n   * @private\n   */\n  private async executeAgentDirect(stepContext: StepExecutionContext): Promise<AgentResponse> {\n    const { step, flowContext, agent, agentContext, getPendingUpdates } = stepContext\n    const { stateManager } = flowContext\n\n    const agentTimeout = step.timeout ?? this.defaultTimeout\n\n    const response = await withTimeout(agent.execute(agentContext), agentTimeout, step.agent)\n\n    // Apply pending state updates\n    if (stateManager && getPendingUpdates) {\n      const { updates, newLog } = getPendingUpdates()\n      flowContext.stateManager = stateManager.applyPendingUpdates(updates, newLog)\n    }\n\n    return response\n  }\n\n  /**\n   * Record agent execution metrics\n   * @private\n   */\n  private recordAgentMetrics(\n    stepContext: StepExecutionContext,\n    response: AgentResponse,\n    agentStartTime: number\n  ): void {\n    const { step, flowContext, agentMetrics } = stepContext\n    const agentDuration = Date.now() - agentStartTime\n\n    flowContext.metrics.agents.push({\n      name: step.agent,\n      duration: agentDuration,\n      cached: response.cached,\n      success: response.success,\n    })\n\n    if (response.cached) {\n      flowContext.metrics.cacheHits++\n      if (flowContext.observability.shouldLogEvent('cache:hit')) {\n        stepContext.agentLogger.debug('Cache hit', { agentName: step.agent })\n      }\n      agentMetrics.recordCachePerformance(true, step.agent)\n    } else {\n      agentMetrics.recordCachePerformance(false, step.agent)\n    }\n\n    agentMetrics.recordAgentExecution(step.agent, agentDuration, response.success, response.cached)\n  }\n\n  /**\n   * Execute a single flow step with all associated logic\n   * Only handles AgentFlowStep - control flow steps should use GraphExecutor\n   * @private\n   */\n  private async executeStep(\n    step: AgentFlowStep,\n    flowContext: FlowExecutionContext,\n    stepIndex: number\n  ): AsyncResult<void, ConductorError> {\n    const { ensemble, executionContext, stateManager, scoringState, ensembleScorer } = flowContext\n    const agentStartTime = Date.now()\n\n    // 1. Resolve input for this step\n    const resolvedInput = this.resolveStepInput(step, flowContext, stepIndex)\n\n    // 2. Resolve agent - error handling is explicit\n    const agentResult = await this.resolveAgent(step.agent)\n    if (!agentResult.success) {\n      return Result.err(new EnsembleExecutionError(ensemble.name, step.agent, agentResult.error))\n    }\n    const agent = agentResult.value\n\n    // 3. Create scoped observability for this agent\n    const agentObservability = flowContext.observability.forAgent(step.agent, stepIndex)\n    const agentLogger = agentObservability.getLogger()\n    const agentMetrics = agentObservability.getMetrics()\n\n    // Log agent start if configured\n    if (flowContext.observability.shouldLogEvent('agent:start')) {\n      agentLogger.info('Agent execution started', {\n        agentName: step.agent,\n        stepIndex,\n        ensembleName: ensemble.name,\n      })\n    }\n\n    // 4. Find agent config from ensemble definition (if any)\n    const agentDef = ensemble.agents?.find(\n      (a) => (a as Record<string, unknown>).name === step.agent\n    ) as Record<string, unknown> | undefined\n    const agentConfig = (agentDef?.config as Record<string, any>) || undefined\n\n    // 5. Build agent execution context using helper\n    const agentContext = this.buildAgentContext(\n      resolvedInput,\n      flowContext,\n      agentLogger,\n      agentMetrics,\n      agentConfig\n    )\n\n    // 6. Add state context if available and track updates\n    let getPendingUpdates:\n      | (() => { updates: Record<string, unknown>; newLog: AccessLogEntry[] })\n      | null = null\n    if (stateManager && step.state) {\n      const { context, getPendingUpdates: getUpdates } = stateManager.getStateForAgent(\n        step.agent,\n        step.state\n      )\n      agentContext.state = context.state\n      agentContext.setState = context.setState\n      getPendingUpdates = getUpdates\n    }\n\n    // 7. Build step context for helper methods\n    const stepContext: StepExecutionContext = {\n      step,\n      flowContext,\n      stepIndex,\n      agent,\n      resolvedInput,\n      agentLogger,\n      agentMetrics,\n      agentContext,\n      getPendingUpdates,\n    }\n\n    // 8. Execute agent (with scoring if configured, or direct)\n    let response: AgentResponse\n    if (step.scoring && scoringState && ensembleScorer) {\n      const result = await this.executeAgentWithScoring(stepContext)\n      response = result.response\n    } else {\n      response = await this.executeAgentDirect(stepContext)\n    }\n\n    // 9. Record metrics\n    this.recordAgentMetrics(stepContext, response, agentStartTime)\n\n    // 10. Handle agent execution errors explicitly\n    if (!response.success) {\n      const agentDuration = Date.now() - agentStartTime\n      if (flowContext.observability.shouldLogEvent('agent:error')) {\n        agentLogger.error('Agent execution failed', new Error(response.error || 'Unknown error'), {\n          agentName: step.agent,\n          durationMs: agentDuration,\n          stepIndex,\n        })\n      }\n      agentMetrics.recordError('AgentExecutionError', step.agent)\n\n      return Result.err(\n        new AgentExecutionError(step.agent, response.error || 'Unknown error', undefined)\n      )\n    }\n\n    // 11. Log agent completion if configured\n    if (flowContext.observability.shouldLogEvent('agent:complete')) {\n      const agentDuration = Date.now() - agentStartTime\n      agentLogger.info('Agent execution completed', {\n        agentName: step.agent,\n        durationMs: agentDuration,\n        stepIndex,\n        cached: response.cached,\n      })\n    }\n\n    // 12. Store agent output in context for future interpolations\n    // Priority: id > name > agent (name is an alias for id, more natural for YAML authors)\n    const contextKey = step.id || step.name || step.agent\n    executionContext[contextKey] = {\n      output: response.data,\n      success: true,\n    }\n\n    // 13. Update state context with new state from immutable StateManager\n    if (flowContext.stateManager) {\n      executionContext.state = flowContext.stateManager.getState()\n    }\n\n    // 14. Update scoring context for interpolations\n    if (scoringState) {\n      executionContext.scoring = scoringState\n    }\n\n    return Result.ok(undefined)\n  }\n\n  /**\n   * Execute ensemble flow from a given step\n   * Automatically uses GraphExecutor for flows with control flow steps (parallel, branch, etc.)\n   * @private\n   */\n  private async executeFlow(\n    flowContext: FlowExecutionContext,\n    startStep: number = 0\n  ): AsyncResult<ExecutionOutput, ConductorError> {\n    const {\n      ensemble,\n      executionContext,\n      metrics,\n      stateManager,\n      scoringState,\n      ensembleScorer,\n      startTime,\n    } = flowContext\n\n    // Execute flow steps sequentially from startStep\n    if (!ensemble.flow || ensemble.flow.length === 0) {\n      return Result.err(\n        new EnsembleExecutionError(\n          ensemble.name,\n          'validation',\n          new Error('Ensemble has no flow steps defined')\n        )\n      )\n    }\n\n    // Check if flow contains control flow steps\n    // If so, delegate to GraphExecutor for DAG-based execution\n    const flowSteps = ensemble.flow.slice(startStep) as FlowStepType[]\n    if (hasControlFlowSteps(flowSteps)) {\n      return this.executeFlowWithGraph(flowContext, startStep)\n    }\n\n    // Simple agent-only flow - execute sequentially\n    for (let i = startStep; i < ensemble.flow.length; i++) {\n      const step = ensemble.flow[i]\n\n      // Double-check this is an agent step (should always be true here)\n      if (!isAgentStep(step)) {\n        return Result.err(\n          new EnsembleExecutionError(\n            ensemble.name,\n            'flow',\n            new Error(`Unexpected control flow step at index ${i}`)\n          )\n        )\n      }\n\n      const stepResult = await this.executeStep(step, flowContext, i)\n\n      if (!stepResult.success) {\n        return Result.err(stepResult.error)\n      }\n    }\n\n    // Calculate final ensemble score if scoring was enabled\n    if (scoringState && ensembleScorer && scoringState.scoreHistory.length > 0) {\n      scoringState.finalScore = ensembleScorer.calculateEnsembleScore(scoringState.scoreHistory)\n      scoringState.qualityMetrics = ensembleScorer.calculateQualityMetrics(\n        scoringState.scoreHistory\n      )\n    }\n\n    // Resolve final output using the output resolver\n    // Supports conditional outputs, status codes, headers, redirects, and raw body\n    let finalOutput: unknown\n    let responseMetadata: ResponseMetadata | undefined\n\n    if (ensemble.output) {\n      // Use the new output resolver for conditional outputs\n      const resolved = resolveOutput(ensemble.output as EnsembleOutput, executionContext)\n\n      // Extract the body/rawBody as the output\n      if (resolved.redirect) {\n        // For redirects, output is empty but we set response metadata\n        finalOutput = {}\n        responseMetadata = {\n          status: resolved.status,\n          headers: resolved.headers,\n          redirect: resolved.redirect,\n        }\n      } else if (resolved.rawBody !== undefined) {\n        // Raw body - output is the string, mark as raw\n        finalOutput = resolved.rawBody\n        responseMetadata = {\n          status: resolved.status,\n          headers: resolved.headers,\n          isRawBody: true,\n        }\n      } else {\n        // JSON body (or formatted body for triggers)\n        finalOutput = resolved.body ?? {}\n        responseMetadata = {\n          status: resolved.status,\n          headers: resolved.headers,\n          format: resolved.format,\n        }\n      }\n    } else if (ensemble.flow && ensemble.flow.length > 0) {\n      // Default to last agent's output\n      const lastStep = ensemble.flow[ensemble.flow.length - 1]\n      const lastMemberName = isAgentStep(lastStep) ? lastStep.agent : undefined\n      if (lastMemberName) {\n        const lastResult = executionContext[lastMemberName] as AgentExecutionResult | undefined\n        finalOutput = lastResult?.output\n      } else {\n        finalOutput = {}\n      }\n    } else {\n      // No flow steps - return empty\n      finalOutput = {}\n    }\n\n    // Calculate total duration\n    metrics.totalDuration = Date.now() - startTime\n\n    // Get state report if available\n    const stateReport = flowContext.stateManager?.getAccessReport()\n\n    // Build execution output with scoring data and response metadata\n    const executionOutput: ExecutionOutput = {\n      output: finalOutput,\n      metrics,\n      stateReport,\n      response: responseMetadata,\n    }\n\n    // Add scoring data if available\n    if (scoringState) {\n      executionOutput.scoring = scoringState\n    }\n\n    return Result.ok(executionOutput)\n  }\n\n  /**\n   * Execute flow using GraphExecutor for control flow constructs\n   * Handles parallel, branch, foreach, try/catch, switch, while, and map-reduce steps\n   * @private\n   */\n  private async executeFlowWithGraph(\n    flowContext: FlowExecutionContext,\n    startStep: number = 0\n  ): AsyncResult<ExecutionOutput, ConductorError> {\n    const {\n      ensemble,\n      executionContext,\n      metrics,\n      stateManager,\n      scoringState,\n      ensembleScorer,\n      startTime,\n    } = flowContext\n\n    // Create agent executor callback that delegates to this.executeStep\n    // This allows GraphExecutor to call back into Executor for agent execution\n    const agentExecutorFn: AgentExecutorFn = async (\n      step: AgentFlowStep,\n      graphContext: GraphExecutionContext\n    ): Promise<unknown> => {\n      // Merge graph context into flow context's execution context\n      // This ensures previous step outputs are available\n      for (const [key, value] of graphContext.results) {\n        executionContext[key] = { output: value, success: true }\n      }\n\n      // Execute the agent step using existing logic\n      const stepIndex = ensemble.flow\n        ? ensemble.flow.findIndex(\n            (s) => isAgentStep(s) && (s.id === step.id || s.agent === step.agent)\n          )\n        : -1\n\n      const result = await this.executeStep(step, flowContext, stepIndex >= 0 ? stepIndex : 0)\n\n      if (!result.success) {\n        throw result.error\n      }\n\n      // Get the output from execution context\n      const contextKey = step.id || step.agent\n      const agentResult = executionContext[contextKey] as AgentExecutionResult | undefined\n      return agentResult?.output\n    }\n\n    // Create GraphExecutor with our callback\n    const graphExecutor = new GraphExecutor(agentExecutorFn, ensemble.name)\n\n    // Execute the flow\n    const flowSteps = (ensemble.flow?.slice(startStep) || []) as FlowStepType[]\n    const graphResult = await graphExecutor.execute(flowSteps, {\n      input: executionContext.input,\n      state: stateManager ? stateManager.getState() : undefined,\n    })\n\n    if (!graphResult.success) {\n      return Result.err(graphResult.error)\n    }\n\n    // Merge graph results into execution context\n    for (const [key, value] of Object.entries(graphResult.value)) {\n      executionContext[key] = { output: value, success: true }\n    }\n\n    // Calculate final ensemble score if scoring was enabled\n    if (scoringState && ensembleScorer && scoringState.scoreHistory.length > 0) {\n      scoringState.finalScore = ensembleScorer.calculateEnsembleScore(scoringState.scoreHistory)\n      scoringState.qualityMetrics = ensembleScorer.calculateQualityMetrics(\n        scoringState.scoreHistory\n      )\n    }\n\n    // Resolve final output using the output resolver\n    let finalOutput: unknown\n    let responseMetadata: ResponseMetadata | undefined\n\n    if (ensemble.output) {\n      // Use the new output resolver for conditional outputs\n      const resolved = resolveOutput(ensemble.output as EnsembleOutput, executionContext)\n\n      // Extract the body/rawBody as the output\n      if (resolved.redirect) {\n        finalOutput = {}\n        responseMetadata = {\n          status: resolved.status,\n          headers: resolved.headers,\n          redirect: resolved.redirect,\n        }\n      } else if (resolved.rawBody !== undefined) {\n        finalOutput = resolved.rawBody\n        responseMetadata = {\n          status: resolved.status,\n          headers: resolved.headers,\n          isRawBody: true,\n        }\n      } else {\n        // JSON body (or formatted body for triggers)\n        finalOutput = resolved.body ?? {}\n        responseMetadata = {\n          status: resolved.status,\n          headers: resolved.headers,\n          format: resolved.format,\n        }\n      }\n    } else if (ensemble.flow && ensemble.flow.length > 0) {\n      // Default to last step's output\n      const lastStep = ensemble.flow[ensemble.flow.length - 1]\n      const lastKey = isAgentStep(lastStep)\n        ? lastStep.id || lastStep.agent\n        : `step_${ensemble.flow.length - 1}`\n\n      if (graphResult.value[lastKey]) {\n        finalOutput = graphResult.value[lastKey]\n      } else {\n        // For control flow steps, get the last result\n        const keys = Object.keys(graphResult.value)\n        if (keys.length > 0) {\n          finalOutput = graphResult.value[keys[keys.length - 1]]\n        } else {\n          finalOutput = {}\n        }\n      }\n    } else {\n      finalOutput = {}\n    }\n\n    // Calculate total duration\n    metrics.totalDuration = Date.now() - startTime\n\n    // Get state report if available\n    const stateReport = flowContext.stateManager?.getAccessReport()\n\n    // Build execution output\n    const executionOutput: ExecutionOutput = {\n      output: finalOutput,\n      metrics,\n      stateReport,\n      response: responseMetadata,\n    }\n\n    // Add scoring data if available\n    if (scoringState) {\n      executionOutput.scoring = scoringState\n    }\n\n    return Result.ok(executionOutput)\n  }\n\n  /**\n   * Register inline agents defined in an ensemble's agents array\n   *\n   * Supports:\n   * 1. script:// URIs - Resolved from bundled scripts (Works in Workers!)\n   * 2. Pre-compiled handlers - Function objects passed in config.handler\n   * 3. Inline code strings - DEPRECATED, only works in test environments\n   *\n   * @private\n   */\n  private registerInlineAgents(ensemble: EnsembleConfig): void {\n    if (!ensemble.agents || ensemble.agents.length === 0) {\n      return\n    }\n\n    for (const agentDef of ensemble.agents) {\n      // Skip if not a valid agent definition object\n      if (typeof agentDef !== 'object' || agentDef === null) {\n        continue\n      }\n\n      const name = (agentDef as Record<string, unknown>).name as string | undefined\n      const operation = (agentDef as Record<string, unknown>).operation as string | undefined\n      const config = (agentDef as Record<string, unknown>).config as\n        | Record<string, unknown>\n        | undefined\n\n      if (!name || !operation) {\n        this.logger.warn('Skipping inline agent without name or operation', { agentDef })\n        continue\n      }\n\n      // Skip if already registered\n      if (this.agentRegistry.has(name)) {\n        this.logger.debug('Inline agent already registered', { name })\n        continue\n      }\n\n      // Build AgentConfig from the inline definition\n      const agentConfig: AgentConfig = {\n        name,\n        operation: operation as AgentConfig['operation'],\n        config: config || {},\n      }\n\n      // Handle code/function operations\n      if (operation === Operation.code || operation === 'function') {\n        const scriptRef = config?.script as string | undefined\n        const inlineCode = config?.code || config?.function\n        const precompiledHandler = config?.handler\n\n        // Priority 1: Script reference - resolve from bundled scripts\n        // Supports both formats: \"script://path\" and \"scripts/path\"\n        if (isScriptReference(scriptRef)) {\n          try {\n            const handler = this.resolveScriptHandler(scriptRef, name)\n            agentConfig.config = { ...config, handler }\n          } catch (error) {\n            this.logger.error(\n              'Failed to resolve script',\n              error instanceof Error ? error : undefined,\n              { name, scriptRef }\n            )\n            continue\n          }\n        }\n        // Priority 2: Pre-compiled handler function (already a function object)\n        else if (typeof precompiledHandler === 'function') {\n          // Handler is already compiled, nothing to do\n          this.logger.debug('Using pre-compiled handler', { name })\n        }\n        // Priority 3: Inline code string - NOT SUPPORTED\n        // Inline code uses new Function() which is blocked in Cloudflare Workers\n        else if (typeof inlineCode === 'string') {\n          this.logger.error(\n            'Inline code is not supported',\n            new Error(\n              `Agent \"${name}\" uses inline code (config.code) which is not supported.\\n` +\n                `Cloudflare Workers block new Function() and eval() for security.\\n\\n` +\n                `To fix this, migrate to bundled scripts:\\n` +\n                `1. Create a file: scripts/${name}.ts\\n` +\n                `2. Export your function: export default async function(context) { ... }\\n` +\n                `3. Update your ensemble to use: config.script: \"scripts/${name}\"\\n\\n` +\n                `See: https://docs.ensemble.ai/conductor/guides/migrate-inline-code`\n            ),\n            { name }\n          )\n          continue\n        }\n      }\n\n      // Create and register the agent\n      const agentResult = this.createAgentFromConfig(agentConfig)\n      if (agentResult.success) {\n        this.agentRegistry.set(name, agentResult.value)\n        this.logger.debug('Registered inline agent', { name, operation })\n      } else {\n        this.logger.warn('Failed to create inline agent', {\n          name,\n          error: agentResult.error.message,\n        })\n      }\n    }\n  }\n\n  /**\n   * Resolve a script:// URI to a handler function from bundled scripts\n   * @private\n   */\n  private resolveScriptHandler(\n    scriptUri: string,\n    agentName: string\n  ): (context: AgentExecutionContext) => Promise<unknown> {\n    if (!hasGlobalScriptLoader()) {\n      const scriptPath = parseScriptURI(scriptUri)\n      throw new Error(\n        `Cannot resolve script \"${scriptUri}\" for agent \"${agentName}\".\\n\\n` +\n          `Script loader not initialized. For Cloudflare Workers:\\n` +\n          `1. Ensure scripts/${scriptPath}.ts exists with a default export\\n` +\n          `2. Initialize the script loader in your worker entry:\\n\\n` +\n          `   import { scriptsMap } from 'virtual:conductor-scripts'\\n` +\n          `   import { setGlobalScriptLoader, createScriptLoader } from '@ensemble-edge/conductor'\\n` +\n          `   setGlobalScriptLoader(createScriptLoader(scriptsMap))`\n      )\n    }\n\n    const scriptLoader = getGlobalScriptLoader()\n    const handler = scriptLoader.resolve(scriptUri)\n\n    // Wrap to match expected signature (handler receives full context)\n    return async (context: AgentExecutionContext): Promise<unknown> => {\n      return handler(context)\n    }\n  }\n\n  /**\n   * Create memory manager from ensemble config\n   * Extracts userId/sessionId from input and auth context\n   * @private\n   */\n  private createMemoryManager(\n    ensemble: EnsembleConfig,\n    input: Record<string, any>\n  ): MemoryManager | null {\n    // Check if memory is configured\n    if (!ensemble.memory || ensemble.memory.enabled === false) {\n      return null\n    }\n\n    const memoryParsed = ensemble.memory\n\n    // Convert parsed config to MemoryConfig format\n    const memoryConfig: MemoryConfig = {\n      enabled: memoryParsed.enabled !== false,\n      layers: {\n        working: true, // Always enabled\n        session: memoryParsed.session?.enabled !== false && !!memoryParsed.session,\n        longTerm: memoryParsed.longTerm?.enabled !== false && !!memoryParsed.longTerm,\n        semantic: memoryParsed.semantic?.enabled !== false && !!memoryParsed.semantic,\n        analytical: memoryParsed.analytical?.enabled !== false && !!memoryParsed.analytical,\n      },\n      sessionTTL: memoryParsed.session?.ttl ?? 3600, // Default 1 hour\n      semanticModel: memoryParsed.semantic?.model,\n    }\n\n    // Extract userId - try multiple sources\n    let userId: string | undefined\n    if (memoryParsed.longTerm?.userId) {\n      // Resolve template expression like {{ auth.userId }} or {{ input.userId }}\n      const userIdTemplate = memoryParsed.longTerm.userId\n      if (userIdTemplate.includes('{{') || userIdTemplate.includes('${')) {\n        // Template expression - resolve it\n        userId = Parser.resolveInterpolation(userIdTemplate, {\n          input,\n          auth: this.auth,\n        }) as string | undefined\n      } else {\n        // Direct value\n        userId = userIdTemplate\n      }\n    }\n    // Fallback to auth context\n    if (!userId && this.auth?.user?.id) {\n      userId = String(this.auth.user.id)\n    }\n\n    // Extract sessionId from input (commonly passed as conversationId or sessionId)\n    const sessionId =\n      (input.sessionId as string) ||\n      (input.conversationId as string) ||\n      (input.conversation_id as string) ||\n      undefined\n\n    // Log memory initialization\n    this.logger.debug('Initializing memory manager', {\n      ensembleName: ensemble.name,\n      layers: memoryConfig.layers,\n      hasUserId: !!userId,\n      hasSessionId: !!sessionId,\n    })\n\n    return new MemoryManager(this.env, memoryConfig, userId, sessionId)\n  }\n\n  /**\n   * Execute an ensemble with Result-based error handling\n   * @param ensemble - Parsed ensemble configuration\n   * @param input - Input data for the ensemble\n   * @returns Result containing execution output or error\n   */\n  async executeEnsemble(\n    ensemble: EnsembleConfig,\n    input: Record<string, any>\n  ): AsyncResult<ExecutionOutput, ConductorError> {\n    const startTime = Date.now()\n    const executionId = generateExecutionId()\n\n    // Initialize observability for this execution\n    const observability = createObservabilityManager(\n      this.observabilityConfig,\n      {\n        requestId: this.requestId,\n        executionId,\n        ensembleName: ensemble.name,\n        environment: this.env.ENVIRONMENT,\n      },\n      this.env.ANALYTICS\n    )\n\n    const ensembleLogger = observability.getLogger()\n    const ensembleMetrics = observability.getMetrics()\n\n    // Log ensemble start if configured\n    if (observability.shouldLogEvent('ensemble:start')) {\n      ensembleLogger.info('Ensemble execution started', {\n        ensembleName: ensemble.name,\n        executionId,\n      })\n    }\n\n    const metrics: ExecutionMetrics = {\n      ensemble: ensemble.name,\n      totalDuration: 0,\n      agents: [],\n      cacheHits: 0,\n    }\n\n    // Register inline agents from the ensemble's agents array\n    // This enables ensembles to define agents with inline code that work without\n    // separate agent files (e.g., operation: code with config.code)\n    this.registerInlineAgents(ensemble)\n\n    // Send execution.started notification (fire and forget)\n    this.ctx.waitUntil(\n      NotificationManager.emitExecutionStarted(ensemble, executionId, input, this.env as Env)\n    )\n\n    // Initialize state manager if configured\n    const stateManager = ensemble.state ? new StateManager(ensemble.state) : null\n\n    // Initialize memory manager if configured\n    const memoryManager = this.createMemoryManager(ensemble, input)\n\n    // Initialize scoring if enabled\n    let scoringState: ScoringState | null = null\n    let ensembleScorer: EnsembleScorer | null = null\n    const scoringExecutor = new ScoringExecutor()\n\n    if (ensemble.scoring?.enabled) {\n      ensembleScorer = new EnsembleScorer(ensemble.scoring as EnsembleScoringConfig)\n      scoringState = {\n        scoreHistory: [],\n        retryCount: {},\n        qualityMetrics: undefined,\n        finalScore: undefined,\n      }\n    }\n\n    // Context for resolving interpolations\n    // Both 'input' and 'trigger' reference the same data for backwards compatibility\n    // - 'input' is the original key (for agent step inputs)\n    // - 'trigger' is an alias for HTTP request context (method, path, query, headers, body)\n    const executionContext: ExecutionContextMap = {\n      input,\n      trigger: input, // Alias for semantic clarity in YAML templates\n      state: stateManager ? stateManager.getState() : {},\n      scoring: scoringState || {},\n    }\n\n    // Create component registry for this execution\n    const componentRegistry = createComponentRegistry(this.env)\n\n    // Create discovery registries for agents and ensembles\n    // Agent registry uses the executor's internal agent map (registered via registerAgent)\n    const agentDiscoveryRegistry = createAgentRegistry(this.agentRegistry)\n\n    // Ensemble registry uses discovery data passed from API layer (via EnsembleLoader.getRegistryData())\n    // This enables agents to discover all loaded ensembles for documentation, OpenAPI generation, etc.\n    const ensembleDiscoveryRegistry = createEnsembleRegistry(\n      this.discoveryData?.ensembles || new Map()\n    )\n\n    // Docs registry uses discovery data passed from API layer (via DocsDirectoryLoader.getRegistryData())\n    // This enables agents to discover documentation pages for rendering\n    const docsDiscoveryRegistry = createDocsRegistry(this.discoveryData?.docs || new Map())\n\n    // Create flow execution context with observability\n    const flowContext: FlowExecutionContext = {\n      ensemble,\n      executionContext,\n      metrics,\n      stateManager,\n      scoringState,\n      ensembleScorer,\n      scoringExecutor,\n      startTime,\n      observability,\n      executionId,\n      componentRegistry,\n      agentRegistry: agentDiscoveryRegistry,\n      ensembleRegistry: ensembleDiscoveryRegistry,\n      docsRegistry: docsDiscoveryRegistry,\n      memoryManager,\n    }\n\n    // Execute flow from the beginning\n    const result = await this.executeFlow(flowContext, 0)\n\n    // Record ensemble execution metric\n    const totalDuration = Date.now() - startTime\n    ensembleMetrics.recordEnsembleExecution(ensemble.name, totalDuration, result.success)\n\n    // Log ensemble completion/error\n    if (result.success) {\n      if (observability.shouldLogEvent('ensemble:complete')) {\n        ensembleLogger.info('Ensemble execution completed', {\n          ensembleName: ensemble.name,\n          executionId,\n          durationMs: totalDuration,\n          agentCount: metrics.agents.length,\n          cacheHits: metrics.cacheHits,\n        })\n      }\n    } else {\n      if (observability.shouldLogEvent('ensemble:error')) {\n        ensembleLogger.error('Ensemble execution failed', result.error, {\n          ensembleName: ensemble.name,\n          executionId,\n          durationMs: totalDuration,\n        })\n      }\n      ensembleMetrics.recordError('EnsembleExecutionError', result.error.code)\n    }\n\n    // Send notifications based on result\n    if (result.success) {\n      // execution.completed\n      this.ctx.waitUntil(\n        NotificationManager.emitExecutionCompleted(\n          ensemble,\n          executionId,\n          result.value.output,\n          result.value.metrics.totalDuration,\n          this.env as Env\n        )\n      )\n    } else {\n      // execution.failed\n      const error = new Error(result.error.message)\n      error.stack = result.error.stack\n      this.ctx.waitUntil(\n        NotificationManager.emitExecutionFailed(\n          ensemble,\n          executionId,\n          error,\n          Date.now() - startTime,\n          this.env as Env\n        )\n      )\n    }\n\n    return result\n  }\n\n  /**\n   * Load and execute an ensemble from YAML with Result-based error handling\n   */\n  async executeFromYAML(\n    yamlContent: string,\n    input: Record<string, any>\n  ): AsyncResult<ExecutionOutput, ConductorError> {\n    // Parse YAML\n    const parseResult = Result.fromThrowable(() => Parser.parseEnsemble(yamlContent))\n    if (!parseResult.success) {\n      return Result.err(Errors.ensembleParse('unknown', parseResult.error.message))\n    }\n    const ensemble = parseResult.value\n\n    // Validate agent references\n    const availableMembers = new Set(this.agentRegistry.keys())\n    const validationResult = Result.fromThrowable(() =>\n      Parser.validateAgentReferences(ensemble, availableMembers)\n    )\n    if (!validationResult.success) {\n      return Result.err(Errors.ensembleParse(ensemble.name, validationResult.error.message))\n    }\n\n    // Execute the ensemble\n    return await this.executeEnsemble(ensemble, input)\n  }\n\n  /**\n   * Get all registered agent names (both built-in and user-defined)\n   */\n  getRegisteredMembers(): string[] {\n    const builtInRegistry = getBuiltInRegistry()\n    const builtInNames = builtInRegistry.getAvailableNames()\n    const userDefinedNames = Array.from(this.agentRegistry.keys())\n\n    // Combine both, user-defined agents take precedence (can override built-in)\n    const allNames = new Set([...builtInNames, ...userDefinedNames])\n    return Array.from(allNames)\n  }\n\n  /**\n   * Check if a agent is registered (checks both built-in and user-defined)\n   */\n  hasMember(agentName: string): boolean {\n    const builtInRegistry = getBuiltInRegistry()\n    return builtInRegistry.isBuiltIn(agentName) || this.agentRegistry.has(agentName)\n  }\n\n  /**\n   * Get all built-in agent metadata\n   */\n  getBuiltInMembers() {\n    const builtInRegistry = getBuiltInRegistry()\n    return builtInRegistry.list()\n  }\n\n  /**\n   * Resume execution from suspended state\n   * Used for HITL approval workflows and webhook resumption\n   */\n  async resumeExecution(\n    suspendedState: SuspendedExecutionState,\n    resumeInput?: Record<string, any>\n  ): AsyncResult<ExecutionOutput, ConductorError> {\n    const ensemble = suspendedState.ensemble\n    const executionContext = suspendedState.executionContext\n\n    // Merge resume input if provided (e.g., HITL approval data)\n    if (resumeInput) {\n      executionContext.resumeInput = resumeInput\n    }\n\n    // Restore state manager if it existed\n    let stateManager: StateManager | null = null\n    if (suspendedState.stateSnapshot) {\n      // Create state manager from snapshot\n      if (ensemble.state) {\n        stateManager = new StateManager(ensemble.state)\n        // TODO: Restore state from snapshot\n        // This requires StateManager to support state restoration\n      }\n    }\n\n    // Restore scoring state if it existed\n    let scoringState: ScoringState | null = null\n    let ensembleScorer: EnsembleScorer | null = null\n    const scoringExecutor = new ScoringExecutor()\n\n    if (suspendedState.scoringSnapshot) {\n      scoringState = suspendedState.scoringSnapshot as ScoringState\n      if (ensemble.scoring?.enabled) {\n        ensembleScorer = new EnsembleScorer(ensemble.scoring as EnsembleScoringConfig)\n      }\n    }\n\n    // Restore metrics\n    const metrics: ExecutionMetrics = {\n      ensemble: ensemble.name,\n      totalDuration: 0,\n      agents: suspendedState.metrics.agents || [],\n      cacheHits: suspendedState.metrics.cacheHits || 0,\n    }\n\n    const startTime = suspendedState.metrics.startTime || Date.now()\n\n    // Update execution context with restored state\n    if (stateManager) {\n      executionContext.state = stateManager.getState()\n    }\n    if (scoringState) {\n      executionContext.scoring = scoringState\n    }\n\n    // Restore or generate execution ID\n    const executionId = suspendedState.executionId || generateExecutionId()\n\n    // Initialize observability for resumed execution\n    const observability = createObservabilityManager(\n      this.observabilityConfig,\n      {\n        requestId: this.requestId,\n        executionId,\n        ensembleName: ensemble.name,\n        environment: this.env.ENVIRONMENT,\n      },\n      this.env.ANALYTICS\n    )\n\n    // Create component registry for resumed execution\n    const componentRegistry = createComponentRegistry(this.env)\n\n    // Create discovery registries for agents, ensembles, and docs\n    const agentDiscoveryRegistry = createAgentRegistry(this.agentRegistry)\n    const ensembleDiscoveryRegistry = createEnsembleRegistry(\n      this.discoveryData?.ensembles || new Map()\n    )\n    const docsDiscoveryRegistry = createDocsRegistry(this.discoveryData?.docs || new Map())\n\n    // Re-create memory manager for resumed execution\n    // Use original input from suspended state plus any resumeInput\n    const originalInput = (executionContext.input as Record<string, any>) ?? {}\n    const memoryManager = this.createMemoryManager(ensemble, {\n      ...originalInput,\n      ...resumeInput,\n    })\n\n    // Create flow execution context\n    const flowContext: FlowExecutionContext = {\n      ensemble,\n      executionContext,\n      metrics,\n      stateManager,\n      scoringState,\n      ensembleScorer,\n      scoringExecutor,\n      startTime,\n      observability,\n      executionId,\n      componentRegistry,\n      agentRegistry: agentDiscoveryRegistry,\n      ensembleRegistry: ensembleDiscoveryRegistry,\n      docsRegistry: docsDiscoveryRegistry,\n      memoryManager,\n    }\n\n    // Resume from the specified step\n    const resumeFromStep = suspendedState.resumeFromStep\n\n    // Execute flow from the resume point\n    return await this.executeFlow(flowContext, resumeFromStep)\n  }\n}\n","/**\n * Plugin Registry\n *\n * Global registry for operations that can be used across ALL contexts\n * (ensembles, forms, APIs, webhooks, etc.)\n *\n * This enables:\n * - Dynamic operation registration (plugins can add operations)\n * - Universal operation interface (same operation works everywhere)\n * - Operation discovery and metadata\n */\n\nimport type { ConductorEnv } from '../types/env.js'\n\n/**\n * Context in which an operation is being executed\n */\nexport interface OperationContext {\n  /** Cloudflare Request object (if available) */\n  request?: Request\n  /** Cloudflare Workers environment bindings */\n  env: ConductorEnv\n  /** Cloudflare Workers execution context */\n  ctx: ExecutionContext\n  /** URL/route parameters */\n  params?: Record<string, string>\n  /** Query string parameters */\n  query?: Record<string, string>\n  /** Request headers */\n  headers?: Record<string, string>\n  /** Input data for the operation */\n  data?: Record<string, any>\n  /** Context type where operation is being used */\n  contextType: 'ensemble' | 'form' | 'api' | 'webhook'\n  /** Agent registry (for agent operations) */\n  agentRegistry?: Map<string, any>\n}\n\n/**\n * Configuration for an operation\n */\nexport interface OperationConfig {\n  /** Operation name/type (e.g., 'think', 'fetch-data', 'plasmic:render') */\n  operation: string\n  /** Operation-specific configuration */\n  config: Record<string, any>\n  /** Optional custom handler (overrides registered handler) */\n  handler?: (context: OperationContext) => Promise<any>\n}\n\n/**\n * Operation handler interface\n */\nexport interface OperationHandler {\n  /**\n   * Execute the operation\n   */\n  execute(operation: OperationConfig, context: OperationContext): Promise<any>\n}\n\n/**\n * Metadata about an operation\n */\nexport interface OperationMetadata {\n  /** Operation identifier */\n  name: string\n  /** Human-readable description */\n  description: string\n  /** Version (semver) */\n  version?: string\n  /** Plugin/package that provides this operation */\n  author?: string\n  /** Contexts where this operation can be used */\n  contexts?: Array<'ensemble' | 'form' | 'api' | 'webhook' | 'all'>\n  /** Input schema (for validation/documentation) */\n  inputs?: Record<string, any>\n  /** Output schema (for validation/documentation) */\n  outputs?: Record<string, any>\n  /** Tags for categorization */\n  tags?: string[]\n}\n\n/**\n * Global Plugin Registry\n *\n * Singleton registry for ALL operations across ALL contexts.\n * Enables plugins to register custom operations that work universally.\n */\nexport class PluginRegistry {\n  private static instance: PluginRegistry\n  private operations = new Map<string, OperationHandler>()\n  private metadata = new Map<string, OperationMetadata>()\n\n  private constructor() {\n    // Register built-in operations\n    this.registerBuiltInOperations()\n  }\n\n  /**\n   * Get singleton instance\n   */\n  static getInstance(): PluginRegistry {\n    if (!PluginRegistry.instance) {\n      PluginRegistry.instance = new PluginRegistry()\n    }\n    return PluginRegistry.instance\n  }\n\n  /**\n   * Register an operation handler\n   *\n   * This operation will be available in ALL contexts (ensembles, forms, etc.)\n   * Plugins use this to add custom operations.\n   *\n   * @example\n   * ```typescript\n   * registry.register('plasmic:render', plasmicHandler, {\n   *   name: 'plasmic:render',\n   *   description: 'Render Plasmic component',\n   *   version: '1.0.0',\n   *   author: '@conductor/plasmic'\n   * })\n   * ```\n   */\n  register(name: string, handler: OperationHandler, metadata?: OperationMetadata): void {\n    // Note: Silently allow overwriting - this is a valid use case for plugins\n    this.operations.set(name, handler)\n\n    if (metadata) {\n      this.metadata.set(name, {\n        ...metadata,\n        contexts: metadata.contexts || ['all'],\n      })\n    }\n  }\n\n  /**\n   * Get operation handler\n   */\n  get(name: string): OperationHandler | undefined {\n    return this.operations.get(name)\n  }\n\n  /**\n   * Get operation metadata\n   */\n  getMetadata(name: string): OperationMetadata | undefined {\n    return this.metadata.get(name)\n  }\n\n  /**\n   * List all registered operations\n   */\n  list(): string[] {\n    return Array.from(this.operations.keys())\n  }\n\n  /**\n   * List operations by context type\n   */\n  listByContext(contextType: 'ensemble' | 'form' | 'api' | 'webhook'): string[] {\n    return Array.from(this.metadata.entries())\n      .filter(([_, meta]) => {\n        if (!meta.contexts || meta.contexts.length === 0) return true\n        if (meta.contexts.includes('all')) return true\n        return meta.contexts.includes(contextType)\n      })\n      .map(([name]) => name)\n  }\n\n  /**\n   * List operations by tag\n   */\n  listByTag(tag: string): string[] {\n    return Array.from(this.metadata.entries())\n      .filter(([_, meta]) => meta.tags?.includes(tag))\n      .map(([name]) => name)\n  }\n\n  /**\n   * Check if operation exists\n   */\n  has(name: string): boolean {\n    return this.operations.has(name)\n  }\n\n  /**\n   * Execute an operation\n   */\n  async execute(operation: OperationConfig, context: OperationContext): Promise<any> {\n    // Use custom handler if provided\n    if (operation.handler) {\n      return operation.handler(context)\n    }\n\n    // Look up registered handler\n    const handler = this.get(operation.operation)\n    if (!handler) {\n      throw new Error(`[PluginRegistry] Unknown operation: ${operation.operation}`)\n    }\n\n    return handler.execute(operation, context)\n  }\n\n  /**\n   * Register built-in operations\n   *\n   * These are the core operations provided by Conductor.\n   * Plugins can add additional operations via register().\n   */\n  private registerBuiltInOperations(): void {\n    // fetch-data: Universal data fetching operation\n    this.register(\n      'fetch-data',\n      {\n        async execute(operation: OperationConfig, _context: OperationContext) {\n          const { source, collection, query } = operation.config\n\n          // TODO: Integrate with actual data sources\n          // - Payload CMS via @conductor/payload plugin\n          // - D1 database\n          // - KV storage\n          // - R2 storage\n          // - External APIs\n\n          return {\n            _mock: true,\n            source,\n            collection,\n            query,\n            data: [],\n          }\n        },\n      },\n      {\n        name: 'fetch-data',\n        description: 'Fetch data from various sources (Payload, D1, KV, R2, APIs)',\n        contexts: ['all'],\n        tags: ['data', 'fetch', 'database'],\n        inputs: {\n          source: 'string (payload, d1, kv, r2, api)',\n          collection: 'string (collection/table name)',\n          query: 'object (query parameters)',\n        },\n        outputs: {\n          data: 'array (fetched records)',\n        },\n      }\n    )\n\n    // transform-data: Universal data transformation operation\n    this.register(\n      'transform-data',\n      {\n        async execute(operation: OperationConfig, _context: OperationContext) {\n          const { input, transform } = operation.config\n\n          // TODO: Implement actual transformation logic\n          // - JSONata expressions\n          // - JavaScript functions\n          // - Template interpolation\n\n          return {\n            _mock: true,\n            input,\n            transform,\n            output: input, // Mock: return input unchanged\n          }\n        },\n      },\n      {\n        name: 'transform-data',\n        description: 'Transform data using JSONata, JavaScript, or templates',\n        contexts: ['all'],\n        tags: ['data', 'transform', 'processing'],\n        inputs: {\n          input: 'any (data to transform)',\n          transform: 'string (transformation expression)',\n        },\n        outputs: {\n          output: 'any (transformed data)',\n        },\n      }\n    )\n\n    // Custom code operation (inline JavaScript/TypeScript)\n    this.register(\n      'custom-code',\n      {\n        async execute(operation: OperationConfig, _context: OperationContext) {\n          const { code, input } = operation.config\n\n          // TODO: Implement safe code execution\n          // - Sandbox environment\n          // - Timeout limits\n          // - Memory limits\n\n          return {\n            _mock: true,\n            code,\n            input,\n            output: null,\n          }\n        },\n      },\n      {\n        name: 'custom-code',\n        description: 'Execute custom JavaScript/TypeScript code',\n        contexts: ['all'],\n        tags: ['code', 'custom', 'javascript'],\n        inputs: {\n          code: 'string (JavaScript code)',\n          input: 'any (input data)',\n        },\n        outputs: {\n          output: 'any (code execution result)',\n        },\n      }\n    )\n\n    // Agent invocation operation (invoke registered agents)\n    this.register(\n      'agent',\n      {\n        async execute(operation: OperationConfig, context: OperationContext) {\n          const { agent: agentName, input } = operation.config\n\n          if (!agentName) {\n            throw new Error('[agent] Missing required config: agent (name of agent to invoke)')\n          }\n\n          if (!context.agentRegistry) {\n            throw new Error(\n              '[agent] Agent registry not available in operation context. ' +\n                'Make sure agents are registered before using the agent operation.'\n            )\n          }\n\n          // Get agent from registry\n          const agentInstance = context.agentRegistry.get(agentName)\n          if (!agentInstance) {\n            const availableAgents = Array.from(context.agentRegistry.keys()).join(', ')\n            throw new Error(\n              `[agent] Agent \"${agentName}\" not found. Available agents: ${availableAgents || 'none'}`\n            )\n          }\n\n          // Execute agent\n          try {\n            const result = await agentInstance.execute({\n              input: input || {},\n              env: context.env,\n              ctx: context.ctx,\n            })\n\n            // Check if execution was successful\n            if (result.success === false) {\n              throw new Error(result.error || 'Agent execution failed')\n            }\n\n            // Return the actual output data (unwrap the AgentResponse)\n            // Agents return { success, data, output, ... } - we want the data/output\n            return result.data || result.output || result\n          } catch (error) {\n            throw new Error(\n              `[agent] Failed to execute agent \"${agentName}\": ${\n                error instanceof Error ? error.message : String(error)\n              }`\n            )\n          }\n        },\n      },\n      {\n        name: 'agent',\n        description: 'Invoke a registered Conductor agent (think, code, storage, etc.)',\n        contexts: ['all'],\n        tags: ['agent', 'invoke', 'conductor'],\n        inputs: {\n          agent: 'string (name of agent to invoke)',\n          input: 'object (input data to pass to agent)',\n        },\n        outputs: {\n          output: 'any (agent execution result)',\n        },\n      }\n    )\n  }\n\n  /**\n   * Unregister an operation (for testing)\n   */\n  unregister(name: string): boolean {\n    const deleted = this.operations.delete(name)\n    this.metadata.delete(name)\n    return deleted\n  }\n\n  /**\n   * Clear all operations (for testing)\n   */\n  clear(): void {\n    this.operations.clear()\n    this.metadata.clear()\n  }\n\n  /**\n   * Reset registry to initial state (for testing)\n   */\n  reset(): void {\n    this.clear()\n    this.registerBuiltInOperations()\n  }\n}\n\n/**\n * Get global plugin registry instance\n */\nexport function getPluginRegistry(): PluginRegistry {\n  return PluginRegistry.getInstance()\n}\n\n// Backwards compatibility - export as OperationRegistry\n/** @deprecated Use PluginRegistry instead */\nexport const OperationRegistry = PluginRegistry\n\n/** @deprecated Use getPluginRegistry instead */\nexport const getOperationRegistry = getPluginRegistry\n","/**\n * Trigger Registry\n *\n * Allows plugins to register custom trigger types and handlers.\n * Built-in triggers (webhook, http, mcp, email, queue, cron) are registered here.\n * Plugins can extend by registering additional triggers (e.g., twilio-sms, slack, discord).\n */\n\nimport type { Hono } from 'hono'\nimport type { z } from 'zod'\nimport type { EnsembleConfig } from './parser.js'\nimport type { BaseAgent } from '../agents/base-agent.js'\nimport { createLogger } from '../observability/index.js'\nimport type { ConductorEnv } from '../types/env.js'\nimport type { DiscoveryData } from './executor.js'\n\nconst logger = createLogger({ serviceName: 'trigger-registry' })\n\n/**\n * Trigger handler context provided to trigger handlers\n * Uses generic Hono to accept any app typing (ConductorApp or bare Hono)\n */\nexport interface TriggerHandlerContext {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  app: Hono<any, any, any>\n  ensemble: EnsembleConfig\n  trigger: unknown // The specific trigger config (typed by handler)\n  agents: BaseAgent[]\n  env: ConductorEnv\n  ctx: ExecutionContext\n  /**\n   * Discovery data for agents, ensembles, and docs\n   * Passed to Executor to enable ctx.agentRegistry and ctx.ensembleRegistry\n   */\n  discovery?: DiscoveryData\n}\n\n/**\n * Trigger handler function\n * Responsible for registering routes/listeners for a specific trigger type\n */\nexport type TriggerHandler = (context: TriggerHandlerContext) => void | Promise<void>\n\n/**\n * Trigger registration metadata\n */\nexport interface TriggerMetadata {\n  /**\n   * Trigger type identifier (e.g., 'http', 'twilio-sms', 'slack')\n   */\n  type: string\n\n  /**\n   * Human-readable name\n   */\n  name: string\n\n  /**\n   * Description of what this trigger does\n   */\n  description: string\n\n  /**\n   * Zod schema for validating trigger configuration\n   * This should be a z.object() schema\n   */\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  schema: z.ZodObject<z.ZodRawShape, any, any>\n\n  /**\n   * Whether this trigger requires authentication by default\n   */\n  requiresAuth?: boolean\n\n  /**\n   * Tags for categorization (e.g., ['messaging', 'sms'])\n   */\n  tags?: string[]\n\n  /**\n   * Plugin that registered this trigger (optional)\n   */\n  plugin?: string\n}\n\n/**\n * Global registry for trigger types and handlers\n */\nexport class TriggerRegistry {\n  private static instance: TriggerRegistry | null = null\n  private handlers: Map<string, TriggerHandler> = new Map()\n  private metadata: Map<string, TriggerMetadata> = new Map()\n\n  private constructor() {\n    // Private constructor for singleton\n  }\n\n  /**\n   * Get singleton instance\n   */\n  static getInstance(): TriggerRegistry {\n    if (!TriggerRegistry.instance) {\n      TriggerRegistry.instance = new TriggerRegistry()\n    }\n    return TriggerRegistry.instance\n  }\n\n  /**\n   * Reset registry (for testing)\n   */\n  reset(): void {\n    this.handlers.clear()\n    this.metadata.clear()\n  }\n\n  /**\n   * Register a new trigger type\n   */\n  register(handler: TriggerHandler, metadata: TriggerMetadata): void {\n    const { type } = metadata\n\n    if (this.handlers.has(type)) {\n      logger.warn(`[TriggerRegistry] Overwriting existing trigger type: ${type}`)\n    }\n\n    this.handlers.set(type, handler)\n    this.metadata.set(type, metadata)\n\n    logger.info(`[TriggerRegistry] Registered trigger: ${type}`, {\n      name: metadata.name,\n      plugin: metadata.plugin,\n    })\n  }\n\n  /**\n   * Get handler for a trigger type\n   */\n  getHandler(type: string): TriggerHandler | undefined {\n    return this.handlers.get(type)\n  }\n\n  /**\n   * Get metadata for a trigger type\n   */\n  getMetadata(type: string): TriggerMetadata | undefined {\n    return this.metadata.get(type)\n  }\n\n  /**\n   * Check if a trigger type is registered\n   */\n  has(type: string): boolean {\n    return this.handlers.has(type)\n  }\n\n  /**\n   * Get all registered trigger types\n   */\n  getAllTypes(): string[] {\n    return Array.from(this.handlers.keys())\n  }\n\n  /**\n   * Get all registered trigger metadata\n   */\n  getAllMetadata(): TriggerMetadata[] {\n    return Array.from(this.metadata.values())\n  }\n\n  /**\n   * Register all triggers for an ensemble\n   * Called during auto-discovery initialization\n   *\n   * @param app - Hono app instance\n   * @param ensemble - Ensemble configuration\n   * @param agents - Array of agent instances\n   * @param env - Cloudflare environment\n   * @param ctx - Execution context\n   * @param discovery - Optional discovery data for agents/ensembles/docs\n   */\n  async registerEnsembleTriggers(\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    app: Hono<any, any, any>,\n    ensemble: EnsembleConfig,\n    agents: BaseAgent[],\n    env: ConductorEnv,\n    ctx: ExecutionContext,\n    discovery?: DiscoveryData\n  ): Promise<void> {\n    if (!ensemble.trigger || ensemble.trigger.length === 0) {\n      return // No triggers to register\n    }\n\n    for (const trigger of ensemble.trigger) {\n      const handler = this.getHandler(trigger.type)\n\n      if (!handler) {\n        logger.warn(`[TriggerRegistry] No handler found for trigger type: ${trigger.type}`, {\n          ensemble: ensemble.name,\n          availableTypes: this.getAllTypes(),\n        })\n        continue\n      }\n\n      try {\n        await handler({\n          app,\n          ensemble,\n          trigger,\n          agents,\n          env,\n          ctx,\n          discovery,\n        })\n\n        logger.info(\n          `[TriggerRegistry] Registered ${trigger.type} trigger for ensemble: ${ensemble.name}`\n        )\n      } catch (error) {\n        logger.error(\n          `[TriggerRegistry] Failed to register ${trigger.type} trigger for ${ensemble.name}`,\n          error instanceof Error ? error : undefined\n        )\n      }\n    }\n  }\n}\n\n/**\n * Get the global trigger registry instance\n */\nexport function getTriggerRegistry(): TriggerRegistry {\n  return TriggerRegistry.getInstance()\n}\n","/**\n * HTTP Middleware Registry\n *\n * Allows registration of named Hono middleware that can be referenced\n * in YAML ensemble files by string identifier.\n *\n * This is specifically for HTTP trigger middleware (Hono framework).\n *\n * Example usage:\n * ```typescript\n * import { getHttpMiddlewareRegistry } from '@ensemble-edge/conductor'\n * import { logger } from 'hono/logger'\n *\n * const registry = getHttpMiddlewareRegistry()\n * registry.register('logger', logger())\n * ```\n *\n * Then in YAML:\n * ```yaml\n * trigger:\n *   - type: http\n *     middleware: [logger, compress, timing]\n * ```\n */\n\nimport type { MiddlewareHandler } from 'hono'\nimport { createLogger } from '../observability/index.js'\n\nconst logger = createLogger({ serviceName: 'http-middleware-registry' })\n\nexport interface HttpMiddlewareMetadata {\n  /**\n   * Middleware identifier (e.g., 'logger', 'compress', 'timing')\n   */\n  name: string\n\n  /**\n   * Human-readable description\n   */\n  description: string\n\n  /**\n   * Package that provides this middleware (optional)\n   */\n  package?: string\n\n  /**\n   * Configuration options (optional)\n   */\n  configurable?: boolean\n}\n\n/**\n * Global registry for named Hono middleware (HTTP trigger specific)\n */\nexport class HttpMiddlewareRegistry {\n  private static instance: HttpMiddlewareRegistry | null = null\n  private middleware: Map<string, MiddlewareHandler> = new Map()\n  private metadata: Map<string, HttpMiddlewareMetadata> = new Map()\n\n  private constructor() {\n    // Private constructor for singleton\n  }\n\n  /**\n   * Get singleton instance\n   */\n  static getInstance(): HttpMiddlewareRegistry {\n    if (!HttpMiddlewareRegistry.instance) {\n      HttpMiddlewareRegistry.instance = new HttpMiddlewareRegistry()\n    }\n    return HttpMiddlewareRegistry.instance\n  }\n\n  /**\n   * Reset registry (for testing)\n   */\n  reset(): void {\n    this.middleware.clear()\n    this.metadata.clear()\n  }\n\n  /**\n   * Register a middleware handler\n   */\n  register(\n    name: string,\n    handler: MiddlewareHandler,\n    metadata?: Partial<HttpMiddlewareMetadata>\n  ): void {\n    if (this.middleware.has(name)) {\n      logger.warn(`[HttpMiddlewareRegistry] Overwriting middleware: ${name}`)\n    }\n\n    this.middleware.set(name, handler)\n\n    const fullMetadata: HttpMiddlewareMetadata = {\n      name,\n      description: metadata?.description || name,\n      package: metadata?.package,\n      configurable: metadata?.configurable || false,\n    }\n\n    this.metadata.set(name, fullMetadata)\n\n    logger.info(`[HttpMiddlewareRegistry] Registered middleware: ${name}`, {\n      package: fullMetadata.package,\n    })\n  }\n\n  /**\n   * Get middleware handler by name\n   */\n  get(name: string): MiddlewareHandler | undefined {\n    return this.middleware.get(name)\n  }\n\n  /**\n   * Get metadata for a middleware\n   */\n  getMetadata(name: string): HttpMiddlewareMetadata | undefined {\n    return this.metadata.get(name)\n  }\n\n  /**\n   * Check if middleware exists\n   */\n  has(name: string): boolean {\n    return this.middleware.has(name)\n  }\n\n  /**\n   * List all registered middleware names\n   */\n  list(): string[] {\n    return Array.from(this.middleware.keys())\n  }\n\n  /**\n   * Get all middleware metadata\n   */\n  getAllMetadata(): HttpMiddlewareMetadata[] {\n    return Array.from(this.metadata.values())\n  }\n\n  /**\n   * Resolve middleware array from mixed string/function array\n   * Supports both YAML (strings) and TypeScript (functions)\n   */\n  resolve(middlewareArray: (string | MiddlewareHandler)[]): MiddlewareHandler[] {\n    const resolved: MiddlewareHandler[] = []\n\n    for (const item of middlewareArray) {\n      if (typeof item === 'string') {\n        // String identifier - look up in registry\n        const handler = this.get(item)\n        if (!handler) {\n          logger.warn(`[HttpMiddlewareRegistry] Middleware not found: ${item}`, {\n            available: this.list(),\n          })\n          continue\n        }\n        resolved.push(handler)\n      } else if (typeof item === 'function') {\n        // Direct function reference (TypeScript usage)\n        resolved.push(item)\n      } else {\n        logger.warn(`[HttpMiddlewareRegistry] Invalid middleware type: ${typeof item}`, { item })\n      }\n    }\n\n    return resolved\n  }\n}\n\n/**\n * Get the global HTTP middleware registry instance\n */\nexport function getHttpMiddlewareRegistry(): HttpMiddlewareRegistry {\n  return HttpMiddlewareRegistry.getInstance()\n}\n","/**\n * Queue Agent\n *\n * Cloudflare Queues integration for async message processing with:\n * - Message sending (single and batch)\n * - Message consumption with retry logic\n * - Dead letter queue support\n * - Exponential backoff\n */\n\nimport { BaseAgent, type AgentExecutionContext } from '../base-agent.js'\nimport type { AgentConfig } from '../../runtime/parser.js'\nimport type {\n  QueueAgentConfig,\n  QueueAgentInput,\n  QueueAgentOutput,\n  QueueMessage,\n  QueueMode,\n  ConsumerResult,\n  FailedMessage,\n  ReceivedQueueMessage,\n} from './types/index.js'\n\nexport class QueueAgent extends BaseAgent {\n  private queueConfig: QueueAgentConfig\n\n  constructor(config: AgentConfig) {\n    super(config)\n    // Extract nested config (config.config contains the agent-specific settings)\n    this.queueConfig = (config.config || {}) as unknown as QueueAgentConfig\n\n    // Validate configuration\n    this.validateConfig()\n  }\n\n  /**\n   * Validate agent configuration\n   */\n  private validateConfig(): void {\n    if (!this.queueConfig.queue) {\n      throw new Error('Queue agent requires queue binding name')\n    }\n\n    if (this.queueConfig.retry) {\n      if (this.queueConfig.retry.maxAttempts < 1) {\n        throw new Error('Retry maxAttempts must be at least 1')\n      }\n    }\n\n    if (this.queueConfig.dlq) {\n      if (!this.queueConfig.dlq.queueName) {\n        throw new Error('DLQ configuration requires queueName')\n      }\n      if (this.queueConfig.dlq.maxDeliveryAttempts < 1) {\n        throw new Error('DLQ maxDeliveryAttempts must be at least 1')\n      }\n    }\n  }\n\n  /**\n   * Execute queue operation\n   */\n  protected async run(context: AgentExecutionContext): Promise<QueueAgentOutput> {\n    const input = context.input as QueueAgentInput\n    const mode = input.mode || this.queueConfig.mode || 'send'\n\n    switch (mode) {\n      case 'send':\n        return this.sendMessage(input, context)\n\n      case 'send-batch':\n        return this.sendBatch(input, context)\n\n      case 'consume':\n        return this.consumeMessages(input, context)\n\n      default:\n        throw new Error(`Unknown queue mode: ${mode}`)\n    }\n  }\n\n  /**\n   * Send single message\n   */\n  private async sendMessage(\n    input: QueueAgentInput,\n    context: AgentExecutionContext\n  ): Promise<QueueAgentOutput> {\n    if (!input.message) {\n      throw new Error('Send mode requires message in input')\n    }\n\n    const queue = this.getQueue(context)\n    const message = this.prepareMessage(input.message)\n\n    try {\n      // In Cloudflare Queues, we use the send method\n      await queue.send(message.body, {\n        contentType: this.queueConfig.contentType || 'json',\n        delaySeconds: message.delaySeconds,\n      })\n\n      return {\n        mode: 'send',\n        success: true,\n        messageId: message.id || this.generateMessageId(),\n        messageCount: 1,\n      }\n    } catch (error) {\n      return {\n        mode: 'send',\n        success: false,\n        error: (error as Error).message,\n      }\n    }\n  }\n\n  /**\n   * Send batch of messages\n   */\n  private async sendBatch(\n    input: QueueAgentInput,\n    context: AgentExecutionContext\n  ): Promise<QueueAgentOutput> {\n    const messages = input.messages || input.batchOptions?.messages\n\n    if (!messages || messages.length === 0) {\n      throw new Error('Send-batch mode requires messages array')\n    }\n\n    const queue = this.getQueue(context)\n    const atomic = input.batchOptions?.atomic || false\n    const messageIds: string[] = []\n    const failedMessages: FailedMessage[] = []\n\n    for (const msg of messages) {\n      try {\n        const preparedMsg = this.prepareMessage(msg)\n        await queue.send(preparedMsg.body, {\n          contentType: this.queueConfig.contentType || 'json',\n          delaySeconds: preparedMsg.delaySeconds,\n        })\n\n        const msgId = preparedMsg.id || this.generateMessageId()\n        messageIds.push(msgId)\n      } catch (error) {\n        failedMessages.push({\n          message: msg,\n          error: (error as Error).message,\n        })\n\n        // If atomic, stop on first failure\n        if (atomic) {\n          break\n        }\n      }\n    }\n\n    const success = atomic ? failedMessages.length === 0 : messageIds.length > 0\n\n    return {\n      mode: 'send-batch',\n      success,\n      messageIds,\n      messageCount: messageIds.length,\n      failedMessages: failedMessages.length > 0 ? failedMessages : undefined,\n      error: !success ? 'Some messages failed to send' : undefined,\n    }\n  }\n\n  /**\n   * Consume messages (called by Cloudflare Queue consumer)\n   */\n  private async consumeMessages(\n    input: QueueAgentInput,\n    context: AgentExecutionContext\n  ): Promise<QueueAgentOutput> {\n    // This would be called by the queue consumer handler\n    // For testing purposes, we simulate message consumption\n\n    const consumerConfig = this.queueConfig.consumer\n    if (!consumerConfig) {\n      throw new Error('Consume mode requires consumer configuration')\n    }\n\n    // In production, messages would come from the queue\n    // For now, return a placeholder\n    const results: ConsumerResult[] = []\n\n    return {\n      mode: 'consume',\n      success: true,\n      consumerResults: results,\n    }\n  }\n\n  /**\n   * Process a single message with retry logic\n   */\n  private async processMessage(\n    message: ReceivedQueueMessage,\n    context: AgentExecutionContext\n  ): Promise<ConsumerResult> {\n    const maxRetries = this.queueConfig.retry?.maxAttempts || 3\n    const exponentialBackoff = this.queueConfig.retry?.exponentialBackoff !== false\n\n    let lastError: Error | null = null\n\n    for (let attempt = 0; attempt <= maxRetries; attempt++) {\n      try {\n        // Call handler ensemble if configured\n        const output = await this.executeHandler(message, context)\n\n        return {\n          messageId: message.id,\n          success: true,\n          output,\n          retryCount: attempt,\n        }\n      } catch (error) {\n        lastError = error as Error\n\n        // Calculate backoff delay\n        if (attempt < maxRetries && exponentialBackoff) {\n          const delay = this.calculateBackoff(attempt)\n          await this.sleep(delay)\n        }\n      }\n    }\n\n    // All retries exhausted - check if we should send to DLQ\n    const shouldSendToDLQ =\n      this.queueConfig.dlq && message.attempts >= this.queueConfig.dlq.maxDeliveryAttempts\n\n    if (shouldSendToDLQ) {\n      await this.sendToDLQ(message, context)\n    }\n\n    return {\n      messageId: message.id,\n      success: false,\n      error: lastError?.message || 'Unknown error',\n      retryCount: maxRetries,\n      sentToDLQ: shouldSendToDLQ,\n    }\n  }\n\n  /**\n   * Execute handler ensemble for message\n   */\n  private async executeHandler(\n    message: ReceivedQueueMessage,\n    context: AgentExecutionContext\n  ): Promise<unknown> {\n    // In production, this would call the configured handler ensemble\n    // For now, return the message body\n    return message.body\n  }\n\n  /**\n   * Send message to dead letter queue\n   */\n  private async sendToDLQ(\n    message: ReceivedQueueMessage,\n    context: AgentExecutionContext\n  ): Promise<void> {\n    if (!this.queueConfig.dlq) return\n\n    const dlqName = this.queueConfig.dlq.queueName\n    const dlqBinding = context.env[dlqName as keyof typeof context.env]\n\n    if (dlqBinding && typeof dlqBinding === 'object' && 'send' in dlqBinding) {\n      // Type-safe queue send - Cloudflare Queue binding\n      const queue = dlqBinding as { send: (message: unknown) => Promise<void> }\n      await queue.send({\n        originalMessage: message,\n        failedAt: new Date().toISOString(),\n        attempts: message.attempts,\n      })\n    }\n  }\n\n  /**\n   * Calculate exponential backoff delay\n   */\n  private calculateBackoff(attempt: number): number {\n    const initialDelay = this.queueConfig.retry?.initialDelay || 1000 // 1 second\n    const maxDelay = this.queueConfig.retry?.maxDelay || 60000 // 60 seconds\n    const multiplier = this.queueConfig.retry?.backoffMultiplier || 2\n    const jitter = this.queueConfig.retry?.jitter || 0.1\n\n    // Calculate base delay\n    let delay = initialDelay * Math.pow(multiplier, attempt)\n    delay = Math.min(delay, maxDelay)\n\n    // Add jitter\n    const jitterAmount = delay * jitter * (Math.random() * 2 - 1)\n    delay += jitterAmount\n\n    return Math.max(0, Math.floor(delay))\n  }\n\n  /**\n   * Sleep utility\n   */\n  private sleep(ms: number): Promise<void> {\n    return new Promise((resolve) => setTimeout(resolve, ms))\n  }\n\n  /**\n   * Get queue binding from environment\n   */\n  private getQueue(context: AgentExecutionContext): any {\n    const queueName = this.queueConfig.queue\n    const queue = context.env[queueName as keyof typeof context.env]\n\n    if (!queue) {\n      throw new Error(`Queue binding \"${queueName}\" not found. Add it to wrangler.toml`)\n    }\n\n    return queue\n  }\n\n  /**\n   * Prepare message for sending\n   */\n  private prepareMessage(message: QueueMessage): QueueMessage {\n    return {\n      id: message.id || this.generateMessageId(),\n      body: message.body,\n      metadata: message.metadata,\n      delaySeconds: message.delaySeconds,\n      headers: message.headers,\n    }\n  }\n\n  /**\n   * Generate unique message ID\n   */\n  private generateMessageId(): string {\n    return `msg_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`\n  }\n}\n\n// Backward compatibility aliases\nexport const QueueMember = QueueAgent\nexport type QueueMemberInput = QueueAgentInput\nexport type QueueMemberOutput = QueueAgentOutput\n","/**\n * Agent Loader Utility\n *\n * Dynamically loads user-created agents from their project directory\n * This runs in the user's project context, not in the conductor package\n *\n * Note: tools, validate, autorag agents have been moved to template-based agents.\n * They now use `operation: code` with handlers like any other agent.\n * See: catalog/cloud/cloudflare/templates/agents/system/\n */\n\nimport { Parser, type AgentConfig } from '../runtime/parser.js'\nimport { BaseAgent } from '../agents/base-agent.js'\nimport { FunctionAgent, type FunctionImplementation } from '../agents/function-agent.js'\nimport { ThinkAgent } from '../agents/think-agent.js'\nimport { DataAgent } from '../agents/data-agent.js'\nimport { APIAgent } from '../agents/api-agent.js'\nimport { EmailAgent } from '../agents/email/email-agent.js'\nimport { SmsAgent } from '../agents/sms/sms-agent.js'\nimport { FormAgent } from '../agents/form/form-agent.js'\nimport { HtmlAgent } from '../agents/html/html-agent.js'\nimport { PdfAgent } from '../agents/pdf/pdf-agent.js'\nimport { QueueAgent } from '../agents/queue/queue-agent.js'\nimport { createLogger } from '../observability/index.js'\nimport type { ConductorEnv } from '../types/env.js'\n\nconst logger = createLogger({ serviceName: 'agent-loader' })\n\nexport interface LoaderConfig {\n  /**\n   * Base directory where agents are located\n   * @default './agents'\n   */\n  agentsDir?: string\n\n  /**\n   * Base directory where ensembles are located\n   * @default './ensembles'\n   */\n  ensemblesDir?: string\n\n  /**\n   * Environment context (passed from Worker)\n   */\n  env: ConductorEnv\n\n  /**\n   * Execution context (passed from Worker)\n   */\n  ctx: ExecutionContext\n}\n\nexport interface LoadedAgent {\n  config: AgentConfig\n  instance: BaseAgent\n}\n\n/**\n * AgentLoader handles dynamic loading of user-created agents\n *\n * Note: In Cloudflare Workers, we can't use Node.js fs module.\n * Agents must be bundled at build time using wrangler's module imports.\n *\n * For now, users will need to manually import and register their agents.\n * Future: We can build a CLI tool that generates the registration code.\n */\nexport class AgentLoader {\n  private config: LoaderConfig\n  private loadedAgents: Map<string, LoadedAgent>\n\n  constructor(config: LoaderConfig) {\n    this.config = {\n      agentsDir: config.agentsDir || './agents',\n      ensemblesDir: config.ensemblesDir || './ensembles',\n      env: config.env,\n      ctx: config.ctx,\n    }\n    this.loadedAgents = new Map()\n  }\n\n  /**\n   * Auto-discover and register agents from virtual module\n   *\n   * This method is designed to work with the Vite plugin system that generates\n   * a virtual module containing all agent definitions at build time.\n   *\n   * @param discoveredAgents - Array of agent definitions from virtual:conductor-agents\n   *\n   * @example\n   * ```typescript\n   * import { agents as discoveredAgents } from 'virtual:conductor-agents';\n   *\n   * const loader = new AgentLoader({ env, ctx });\n   * await loader.autoDiscover(discoveredAgents);\n   * ```\n   */\n  async autoDiscover(\n    discoveredAgents: Array<{\n      name: string\n      config: string\n      handler?: () => Promise<any>\n    }>\n  ): Promise<void> {\n    for (const agentDef of discoveredAgents) {\n      try {\n        // Parse YAML config\n        const config = Parser.parseAgent(agentDef.config)\n\n        // Load handler if available\n        let implementation: FunctionImplementation | undefined\n        if (agentDef.handler) {\n          const handlerModule = await agentDef.handler()\n          implementation = handlerModule?.default || handlerModule\n        }\n\n        // Register the agent\n        this.registerAgent(config, implementation)\n\n        logger.debug(`Auto-discovered agent: ${agentDef.name}`, { agentName: agentDef.name })\n      } catch (error) {\n        logger.error(\n          `Failed to load agent \"${agentDef.name}\"`,\n          error instanceof Error ? error : undefined,\n          {\n            agentName: agentDef.name,\n          }\n        )\n        // Continue with other agents even if one fails\n      }\n    }\n\n    logger.info(`Auto-discovery complete: ${this.loadedAgents.size} agents loaded`, {\n      agentCount: this.loadedAgents.size,\n    })\n  }\n\n  /**\n   * Register a agent manually\n   *\n   * @example\n   * ```typescript\n   * import greetConfig from './agents/greet/agent.yaml.js';\n   * import greetFunction from './agents/greet/index.js';\n   *\n   * loader.registerAgent(greetConfig, greetFunction);\n   * ```\n   */\n  registerAgent(\n    agentConfig: AgentConfig | string,\n    implementation?: FunctionImplementation\n  ): BaseAgent {\n    // Parse config if it's a string (YAML)\n    const config = typeof agentConfig === 'string' ? Parser.parseAgent(agentConfig) : agentConfig\n\n    // Create agent instance based on type\n    const instance = this.createAgentInstance(config, implementation)\n\n    // Store in registry\n    this.loadedAgents.set(config.name, {\n      config,\n      instance,\n    })\n\n    return instance\n  }\n\n  /**\n   * Load an agent from Edgit by version reference\n   *\n   * This enables loading versioned agent configs at runtime for A/B testing,\n   * environment-specific configs, and config-only deployments.\n   *\n   * @example\n   * ```typescript\n   * // Load specific version\n   * await loader.loadAgentFromEdgit('analyze-company@v1.0.0');\n   *\n   * // Load production deployment\n   * await loader.loadAgentFromEdgit('analyze-company@production');\n   * ```\n   */\n  async loadAgentFromEdgit(agentRef: string): Promise<BaseAgent> {\n    const { name, version } = Parser.parseAgentReference(agentRef)\n\n    if (!version) {\n      throw new Error(`Agent reference must include version: ${agentRef}`)\n    }\n\n    // Check if already loaded\n    const versionedKey = `${name}@${version}`\n    if (this.loadedAgents.has(versionedKey)) {\n      return this.loadedAgents.get(versionedKey)!.instance\n    }\n\n    // TODO: Load from Edgit when available\n    // Expected implementation:\n    // import { loadAgentConfig } from '../sdk/edgit.js';\n    // const config = await loadAgentConfig(agentRef, this.config.env);\n    // const instance = this.createAgentInstance(config);\n    // this.loadedAgents.set(versionedKey, { config, instance });\n    // return instance;\n\n    throw new Error(\n      `Cannot load versioned agent from Edgit: ${agentRef}. ` +\n        `Edgit integration not yet available. ` +\n        `Use loader.registerAgent() for now.`\n    )\n  }\n\n  /**\n   * Create an agent instance based on type\n   */\n  private createAgentInstance(\n    config: AgentConfig,\n    implementation?: FunctionImplementation\n  ): BaseAgent {\n    switch (config.operation) {\n      case 'code':\n        if (!implementation) {\n          throw new Error(`Code agent \"${config.name}\" requires an implementation function`)\n        }\n        // Code operation agents receive the full context object\n        // User functions are exported as: (context: { input: any }) => result\n        // FunctionAgent already passes the full context, so just use the implementation directly\n        return new FunctionAgent(config, implementation)\n\n      case 'think':\n        return new ThinkAgent(config)\n\n      case 'storage':\n        return new DataAgent(config)\n\n      case 'data':\n        return new DataAgent(config)\n\n      case 'http':\n        return new APIAgent(config)\n\n      case 'email':\n        return new EmailAgent(config)\n\n      case 'sms':\n        return new SmsAgent(config)\n\n      case 'form':\n        return new FormAgent(config)\n\n      case 'html':\n        return new HtmlAgent(config)\n\n      case 'pdf':\n        return new PdfAgent(config)\n\n      case 'queue':\n        return new QueueAgent(config)\n\n      default:\n        throw new Error(\n          `Unknown agent operation type: \"${config.operation}\". ` +\n            `If using tools, validate, or autorag, these are now template-based agents. ` +\n            `Use 'operation: code' with a handler instead. ` +\n            `See: catalog/cloud/cloudflare/templates/agents/system/`\n        )\n    }\n  }\n\n  /**\n   * Get a loaded agent by name\n   */\n  getAgent(name: string): BaseAgent | undefined {\n    return this.loadedAgents.get(name)?.instance\n  }\n\n  /**\n   * Get agent config by name\n   */\n  getAgentConfig(name: string): AgentConfig | undefined {\n    return this.loadedAgents.get(name)?.config\n  }\n\n  /**\n   * Get all loaded agents\n   */\n  getAllAgents(): BaseAgent[] {\n    return Array.from(this.loadedAgents.values()).map((a) => a.instance)\n  }\n\n  /**\n   * Get all agent names\n   */\n  getAgentNames(): string[] {\n    return Array.from(this.loadedAgents.keys())\n  }\n\n  /**\n   * Check if an agent is loaded\n   */\n  hasAgent(name: string): boolean {\n    return this.loadedAgents.has(name)\n  }\n\n  /**\n   * Clear all loaded agents\n   */\n  clear(): void {\n    this.loadedAgents.clear()\n  }\n}\n\n/**\n * Helper function to create a loader instance\n */\nexport function createLoader(config: LoaderConfig): AgentLoader {\n  return new AgentLoader(config)\n}\n\n// Backward compatibility aliases\nexport const MemberLoader = AgentLoader\nexport type LoadedMember = LoadedAgent\n","/**\n * Ensemble Loader Utility\n *\n * Dynamically loads user-created ensembles from their project directory.\n * Supports both YAML and TypeScript ensemble authoring:\n *\n * - YAML: Parsed via Parser  EnsembleConfig  Ensemble instance\n * - TypeScript: Direct import of Ensemble instances via createEnsemble()\n *\n * Both authoring paths produce identical Ensemble instances for execution.\n */\n\nimport {\n  Parser,\n  type EnsembleConfig,\n  Ensemble,\n  isEnsemble,\n  ensembleFromConfig,\n} from '../runtime/parser.js'\nimport type { ConductorEnv } from '../types/env.js'\nimport type { AgentLoader } from './loader.js'\nimport { createLogger } from '../observability/index.js'\n\nconst logger = createLogger({ serviceName: 'ensemble-loader' })\n\nexport interface EnsembleLoaderConfig {\n  /**\n   * Base directory where ensembles are located\n   * @default './ensembles'\n   */\n  ensemblesDir?: string\n\n  /**\n   * Environment context (passed from Worker)\n   */\n  env: ConductorEnv\n\n  /**\n   * Execution context (passed from Worker)\n   */\n  ctx: ExecutionContext\n\n  /**\n   * Agent loader instance for registering inline agents\n   * Optional - if provided, inline agents will be automatically registered\n   */\n  agentLoader?: AgentLoader\n}\n\nexport interface LoadedEnsemble {\n  /** The original config (for YAML-loaded ensembles) */\n  config: EnsembleConfig\n  /** The Ensemble instance (canonical runtime object) */\n  instance: Ensemble\n  /** Source type */\n  source: 'yaml' | 'typescript'\n  /** Whether this ensemble is from the catalog (vs user-defined) */\n  isFromCatalog?: boolean\n}\n\n/**\n * EnsembleLoader handles dynamic loading of user-created ensembles\n *\n * Note: In Cloudflare Workers, we can't use Node.js fs module.\n * Ensembles must be bundled at build time using wrangler's module imports.\n */\nexport class EnsembleLoader {\n  private config: EnsembleLoaderConfig\n  private loadedEnsembles: Map<string, LoadedEnsemble>\n\n  constructor(config: EnsembleLoaderConfig) {\n    this.config = {\n      ensemblesDir: config.ensemblesDir || './ensembles',\n      env: config.env,\n      ctx: config.ctx,\n    }\n    this.loadedEnsembles = new Map()\n  }\n\n  /**\n   * Auto-discover and register ensembles from virtual module\n   *\n   * This method is designed to work with the Vite plugin system that generates\n   * a virtual module containing all ensemble definitions at build time.\n   *\n   * Supports both YAML configs and TypeScript Ensemble instances.\n   *\n   * @param discoveredEnsembles - Array of ensemble definitions from virtual:conductor-ensembles\n   *\n   * @example\n   * ```typescript\n   * // YAML ensembles\n   * import { ensembles as discoveredEnsembles } from 'virtual:conductor-ensembles';\n   *\n   * // TypeScript ensembles\n   * import dataPipeline from './ensembles/data-pipeline.ts';\n   *\n   * const loader = new EnsembleLoader({ env, ctx });\n   * await loader.autoDiscover([\n   *   ...discoveredEnsembles,\n   *   { name: 'data-pipeline', instance: dataPipeline }\n   * ]);\n   * ```\n   */\n  async autoDiscover(\n    discoveredEnsembles: Array<{\n      name: string\n      config?: string // YAML config string\n      instance?: Ensemble // TypeScript Ensemble instance\n    }>\n  ): Promise<void> {\n    for (const ensembleDef of discoveredEnsembles) {\n      try {\n        if (ensembleDef.instance && isEnsemble(ensembleDef.instance)) {\n          // TypeScript ensemble - register directly\n          this.registerEnsembleInstance(ensembleDef.instance)\n          logger.debug(`Auto-discovered TypeScript ensemble: ${ensembleDef.name}`)\n        } else if (ensembleDef.config) {\n          // YAML ensemble - parse and register\n          const config = Parser.parseEnsemble(ensembleDef.config)\n          this.registerEnsemble(config)\n          logger.debug(`Auto-discovered YAML ensemble: ${ensembleDef.name}`)\n        } else {\n          logger.warn(`Skipping ensemble \"${ensembleDef.name}\": no config or instance`)\n        }\n      } catch (error) {\n        logger.error(`Failed to load ensemble \"${ensembleDef.name}\"`, error as Error)\n        // Continue with other ensembles even if one fails\n      }\n    }\n\n    logger.info(`Auto-discovery complete: ${this.loadedEnsembles.size} ensembles loaded`)\n  }\n\n  /**\n   * Register an ensemble from a config object or YAML string\n   *\n   * @example\n   * ```typescript\n   * import blogWorkflowConfig from './ensembles/blog-workflow.yaml.js';\n   *\n   * loader.registerEnsemble(blogWorkflowConfig);\n   * ```\n   */\n  registerEnsemble(ensembleConfig: EnsembleConfig | string, isFromCatalog = false): Ensemble {\n    // Parse config if it's a string (YAML)\n    const config =\n      typeof ensembleConfig === 'string' ? Parser.parseEnsemble(ensembleConfig) : ensembleConfig\n\n    // Check for naming conflicts\n    const existing = this.loadedEnsembles.get(config.name)\n    if (existing) {\n      if (existing.isFromCatalog && !isFromCatalog) {\n        // User ensemble overriding catalog ensemble - warn them\n        logger.warn(\n          `Ensemble name conflict: \"${config.name}\" already exists in the catalog. ` +\n            `Your ensemble will override it. Consider renaming to avoid confusion.`\n        )\n      } else if (!existing.isFromCatalog && !isFromCatalog) {\n        // Two user ensembles with same name - warn them\n        logger.warn(\n          `Duplicate ensemble name: \"${config.name}\" is defined multiple times. ` +\n            `The later definition will override the earlier one.`\n        )\n      }\n    }\n\n    // Create Ensemble instance from config\n    // Cast to primitive EnsembleConfig - Zod schema is source of truth for runtime validation\n    const instance = ensembleFromConfig(\n      config as import('../primitives/ensemble.js').EnsembleConfig\n    )\n\n    // Register inline agents if present and agent loader is available\n    if (config.agents && config.agents.length > 0 && this.config.agentLoader) {\n      for (const agentDef of config.agents) {\n        try {\n          // Inline agents are validated AgentConfig objects from the ensemble YAML\n          // Cast to AgentConfig since they follow the same schema\n          const agentConfig = agentDef as import('../runtime/parser.js').AgentConfig\n          this.config.agentLoader.registerAgent(agentConfig)\n          logger.debug(\n            `Registered inline agent \"${agentConfig.name}\" from ensemble \"${config.name}\"`\n          )\n        } catch (error) {\n          logger.error(\n            `Failed to register inline agent \"${(agentDef as { name?: string }).name}\"`,\n            error as Error\n          )\n        }\n      }\n    }\n\n    // Store in registry\n    this.loadedEnsembles.set(config.name, {\n      config,\n      instance,\n      source: 'yaml',\n      isFromCatalog,\n    })\n\n    return instance\n  }\n\n  /**\n   * Register a TypeScript Ensemble instance directly\n   *\n   * Use this when you have an Ensemble created via createEnsemble() in TypeScript.\n   *\n   * @example\n   * ```typescript\n   * import { createEnsemble, step, parallel } from '@ensemble-edge/conductor';\n   *\n   * const myPipeline = createEnsemble({\n   *   name: 'my-pipeline',\n   *   steps: [\n   *     parallel([step('fetch-a'), step('fetch-b')]),\n   *     step('merge')\n   *   ]\n   * });\n   *\n   * loader.registerEnsembleInstance(myPipeline);\n   * ```\n   */\n  registerEnsembleInstance(ensemble: Ensemble, isFromCatalog = false): Ensemble {\n    if (!isEnsemble(ensemble)) {\n      throw new Error('registerEnsembleInstance expects an Ensemble instance')\n    }\n\n    // Check for naming conflicts\n    const existing = this.loadedEnsembles.get(ensemble.name)\n    if (existing) {\n      if (existing.isFromCatalog && !isFromCatalog) {\n        // User ensemble overriding catalog ensemble - warn them\n        logger.warn(\n          `Ensemble name conflict: \"${ensemble.name}\" already exists in the catalog. ` +\n            `Your ensemble will override it. Consider renaming to avoid confusion.`\n        )\n      } else if (!existing.isFromCatalog && !isFromCatalog) {\n        // Two user ensembles with same name - warn them\n        logger.warn(\n          `Duplicate ensemble name: \"${ensemble.name}\" is defined multiple times. ` +\n            `The later definition will override the earlier one.`\n        )\n      }\n    }\n\n    // Register inline agents if present and agent loader is available\n    if (ensemble.agents && ensemble.agents.length > 0 && this.config.agentLoader) {\n      for (const agentDef of ensemble.agents) {\n        try {\n          // TypeScript ensemble agents follow InlineAgentConfig which is compatible with AgentConfig\n          const agentConfig = agentDef as unknown as import('../runtime/parser.js').AgentConfig\n          this.config.agentLoader.registerAgent(agentConfig)\n          logger.debug(\n            `Registered inline agent \"${agentConfig.name}\" from TypeScript ensemble \"${ensemble.name}\"`\n          )\n        } catch (error) {\n          logger.error(`Failed to register inline agent \"${agentDef.name}\"`, error as Error)\n        }\n      }\n    }\n\n    // Store in registry\n    this.loadedEnsembles.set(ensemble.name, {\n      config: ensemble.toConfig(),\n      instance: ensemble,\n      source: 'typescript',\n      isFromCatalog,\n    })\n\n    return ensemble\n  }\n\n  /**\n   * Get an ensemble config by name\n   * @deprecated Use getEnsembleInstance() to get the Ensemble instance directly\n   */\n  getEnsemble(name: string): EnsembleConfig | undefined {\n    return this.loadedEnsembles.get(name)?.config\n  }\n\n  /**\n   * Get an Ensemble instance by name\n   *\n   * This is the preferred method - returns the canonical Ensemble object\n   * that can be directly executed.\n   */\n  getEnsembleInstance(name: string): Ensemble | undefined {\n    return this.loadedEnsembles.get(name)?.instance\n  }\n\n  /**\n   * Get full loaded ensemble data (config, instance, and source)\n   */\n  getLoadedEnsemble(name: string): LoadedEnsemble | undefined {\n    return this.loadedEnsembles.get(name)\n  }\n\n  /**\n   * Get all loaded ensemble configs\n   * @deprecated Use getAllEnsembleInstances() to get Ensemble instances directly\n   */\n  getAllEnsembles(): EnsembleConfig[] {\n    return Array.from(this.loadedEnsembles.values()).map((e) => e.config)\n  }\n\n  /**\n   * Get all loaded Ensemble instances\n   *\n   * This is the preferred method - returns canonical Ensemble objects\n   * that can be directly executed.\n   */\n  getAllEnsembleInstances(): Ensemble[] {\n    return Array.from(this.loadedEnsembles.values()).map((e) => e.instance)\n  }\n\n  /**\n   * Get all loaded ensemble data\n   */\n  getAllLoadedEnsembles(): LoadedEnsemble[] {\n    return Array.from(this.loadedEnsembles.values())\n  }\n\n  /**\n   * Get ensemble data in registry format for createEnsembleRegistry()\n   * Returns a Map suitable for passing to the Executor's discovery data\n   */\n  getRegistryData(): Map<string, { config: EnsembleConfig; source: 'yaml' | 'typescript' }> {\n    const result = new Map<string, { config: EnsembleConfig; source: 'yaml' | 'typescript' }>()\n    for (const [name, loaded] of this.loadedEnsembles) {\n      result.set(name, { config: loaded.config, source: loaded.source })\n    }\n    return result\n  }\n\n  /**\n   * Get all ensemble names\n   */\n  getEnsembleNames(): string[] {\n    return Array.from(this.loadedEnsembles.keys())\n  }\n\n  /**\n   * Check if an ensemble is loaded\n   */\n  hasEnsemble(name: string): boolean {\n    return this.loadedEnsembles.has(name)\n  }\n\n  /**\n   * Clear all loaded ensembles\n   */\n  clear(): void {\n    this.loadedEnsembles.clear()\n  }\n}\n\n/**\n * Helper function to create an ensemble loader instance\n */\nexport function createEnsembleLoader(config: EnsembleLoaderConfig): EnsembleLoader {\n  return new EnsembleLoader(config)\n}\n","export const encoder = new TextEncoder();\nexport const decoder = new TextDecoder();\nconst MAX_INT32 = 2 ** 32;\nexport function concat(...buffers) {\n    const size = buffers.reduce((acc, { length }) => acc + length, 0);\n    const buf = new Uint8Array(size);\n    let i = 0;\n    for (const buffer of buffers) {\n        buf.set(buffer, i);\n        i += buffer.length;\n    }\n    return buf;\n}\nfunction writeUInt32BE(buf, value, offset) {\n    if (value < 0 || value >= MAX_INT32) {\n        throw new RangeError(`value must be >= 0 and <= ${MAX_INT32 - 1}. Received ${value}`);\n    }\n    buf.set([value >>> 24, value >>> 16, value >>> 8, value & 0xff], offset);\n}\nexport function uint64be(value) {\n    const high = Math.floor(value / MAX_INT32);\n    const low = value % MAX_INT32;\n    const buf = new Uint8Array(8);\n    writeUInt32BE(buf, high, 0);\n    writeUInt32BE(buf, low, 4);\n    return buf;\n}\nexport function uint32be(value) {\n    const buf = new Uint8Array(4);\n    writeUInt32BE(buf, value);\n    return buf;\n}\nexport function encode(string) {\n    const bytes = new Uint8Array(string.length);\n    for (let i = 0; i < string.length; i++) {\n        const code = string.charCodeAt(i);\n        if (code > 127) {\n            throw new TypeError('non-ASCII string encountered in encode()');\n        }\n        bytes[i] = code;\n    }\n    return bytes;\n}\n","export function encodeBase64(input) {\n    if (Uint8Array.prototype.toBase64) {\n        return input.toBase64();\n    }\n    const CHUNK_SIZE = 0x8000;\n    const arr = [];\n    for (let i = 0; i < input.length; i += CHUNK_SIZE) {\n        arr.push(String.fromCharCode.apply(null, input.subarray(i, i + CHUNK_SIZE)));\n    }\n    return btoa(arr.join(''));\n}\nexport function decodeBase64(encoded) {\n    if (Uint8Array.fromBase64) {\n        return Uint8Array.fromBase64(encoded);\n    }\n    const binary = atob(encoded);\n    const bytes = new Uint8Array(binary.length);\n    for (let i = 0; i < binary.length; i++) {\n        bytes[i] = binary.charCodeAt(i);\n    }\n    return bytes;\n}\n","import { encoder, decoder } from '../lib/buffer_utils.js';\nimport { encodeBase64, decodeBase64 } from '../lib/base64.js';\nexport function decode(input) {\n    if (Uint8Array.fromBase64) {\n        return Uint8Array.fromBase64(typeof input === 'string' ? input : decoder.decode(input), {\n            alphabet: 'base64url',\n        });\n    }\n    let encoded = input;\n    if (encoded instanceof Uint8Array) {\n        encoded = decoder.decode(encoded);\n    }\n    encoded = encoded.replace(/-/g, '+').replace(/_/g, '/');\n    try {\n        return decodeBase64(encoded);\n    }\n    catch {\n        throw new TypeError('The input to be decoded is not correctly encoded.');\n    }\n}\nexport function encode(input) {\n    let unencoded = input;\n    if (typeof unencoded === 'string') {\n        unencoded = encoder.encode(unencoded);\n    }\n    if (Uint8Array.prototype.toBase64) {\n        return unencoded.toBase64({ alphabet: 'base64url', omitPadding: true });\n    }\n    return encodeBase64(unencoded).replace(/=/g, '').replace(/\\+/g, '-').replace(/\\//g, '_');\n}\n","export class JOSEError extends Error {\n    static code = 'ERR_JOSE_GENERIC';\n    code = 'ERR_JOSE_GENERIC';\n    constructor(message, options) {\n        super(message, options);\n        this.name = this.constructor.name;\n        Error.captureStackTrace?.(this, this.constructor);\n    }\n}\nexport class JWTClaimValidationFailed extends JOSEError {\n    static code = 'ERR_JWT_CLAIM_VALIDATION_FAILED';\n    code = 'ERR_JWT_CLAIM_VALIDATION_FAILED';\n    claim;\n    reason;\n    payload;\n    constructor(message, payload, claim = 'unspecified', reason = 'unspecified') {\n        super(message, { cause: { claim, reason, payload } });\n        this.claim = claim;\n        this.reason = reason;\n        this.payload = payload;\n    }\n}\nexport class JWTExpired extends JOSEError {\n    static code = 'ERR_JWT_EXPIRED';\n    code = 'ERR_JWT_EXPIRED';\n    claim;\n    reason;\n    payload;\n    constructor(message, payload, claim = 'unspecified', reason = 'unspecified') {\n        super(message, { cause: { claim, reason, payload } });\n        this.claim = claim;\n        this.reason = reason;\n        this.payload = payload;\n    }\n}\nexport class JOSEAlgNotAllowed extends JOSEError {\n    static code = 'ERR_JOSE_ALG_NOT_ALLOWED';\n    code = 'ERR_JOSE_ALG_NOT_ALLOWED';\n}\nexport class JOSENotSupported extends JOSEError {\n    static code = 'ERR_JOSE_NOT_SUPPORTED';\n    code = 'ERR_JOSE_NOT_SUPPORTED';\n}\nexport class JWEDecryptionFailed extends JOSEError {\n    static code = 'ERR_JWE_DECRYPTION_FAILED';\n    code = 'ERR_JWE_DECRYPTION_FAILED';\n    constructor(message = 'decryption operation failed', options) {\n        super(message, options);\n    }\n}\nexport class JWEInvalid extends JOSEError {\n    static code = 'ERR_JWE_INVALID';\n    code = 'ERR_JWE_INVALID';\n}\nexport class JWSInvalid extends JOSEError {\n    static code = 'ERR_JWS_INVALID';\n    code = 'ERR_JWS_INVALID';\n}\nexport class JWTInvalid extends JOSEError {\n    static code = 'ERR_JWT_INVALID';\n    code = 'ERR_JWT_INVALID';\n}\nexport class JWKInvalid extends JOSEError {\n    static code = 'ERR_JWK_INVALID';\n    code = 'ERR_JWK_INVALID';\n}\nexport class JWKSInvalid extends JOSEError {\n    static code = 'ERR_JWKS_INVALID';\n    code = 'ERR_JWKS_INVALID';\n}\nexport class JWKSNoMatchingKey extends JOSEError {\n    static code = 'ERR_JWKS_NO_MATCHING_KEY';\n    code = 'ERR_JWKS_NO_MATCHING_KEY';\n    constructor(message = 'no applicable key found in the JSON Web Key Set', options) {\n        super(message, options);\n    }\n}\nexport class JWKSMultipleMatchingKeys extends JOSEError {\n    [Symbol.asyncIterator];\n    static code = 'ERR_JWKS_MULTIPLE_MATCHING_KEYS';\n    code = 'ERR_JWKS_MULTIPLE_MATCHING_KEYS';\n    constructor(message = 'multiple matching keys found in the JSON Web Key Set', options) {\n        super(message, options);\n    }\n}\nexport class JWKSTimeout extends JOSEError {\n    static code = 'ERR_JWKS_TIMEOUT';\n    code = 'ERR_JWKS_TIMEOUT';\n    constructor(message = 'request timed out', options) {\n        super(message, options);\n    }\n}\nexport class JWSSignatureVerificationFailed extends JOSEError {\n    static code = 'ERR_JWS_SIGNATURE_VERIFICATION_FAILED';\n    code = 'ERR_JWS_SIGNATURE_VERIFICATION_FAILED';\n    constructor(message = 'signature verification failed', options) {\n        super(message, options);\n    }\n}\n","const unusable = (name, prop = 'algorithm.name') => new TypeError(`CryptoKey does not support this operation, its ${prop} must be ${name}`);\nconst isAlgorithm = (algorithm, name) => algorithm.name === name;\nfunction getHashLength(hash) {\n    return parseInt(hash.name.slice(4), 10);\n}\nfunction getNamedCurve(alg) {\n    switch (alg) {\n        case 'ES256':\n            return 'P-256';\n        case 'ES384':\n            return 'P-384';\n        case 'ES512':\n            return 'P-521';\n        default:\n            throw new Error('unreachable');\n    }\n}\nfunction checkUsage(key, usage) {\n    if (usage && !key.usages.includes(usage)) {\n        throw new TypeError(`CryptoKey does not support this operation, its usages must include ${usage}.`);\n    }\n}\nexport function checkSigCryptoKey(key, alg, usage) {\n    switch (alg) {\n        case 'HS256':\n        case 'HS384':\n        case 'HS512': {\n            if (!isAlgorithm(key.algorithm, 'HMAC'))\n                throw unusable('HMAC');\n            const expected = parseInt(alg.slice(2), 10);\n            const actual = getHashLength(key.algorithm.hash);\n            if (actual !== expected)\n                throw unusable(`SHA-${expected}`, 'algorithm.hash');\n            break;\n        }\n        case 'RS256':\n        case 'RS384':\n        case 'RS512': {\n            if (!isAlgorithm(key.algorithm, 'RSASSA-PKCS1-v1_5'))\n                throw unusable('RSASSA-PKCS1-v1_5');\n            const expected = parseInt(alg.slice(2), 10);\n            const actual = getHashLength(key.algorithm.hash);\n            if (actual !== expected)\n                throw unusable(`SHA-${expected}`, 'algorithm.hash');\n            break;\n        }\n        case 'PS256':\n        case 'PS384':\n        case 'PS512': {\n            if (!isAlgorithm(key.algorithm, 'RSA-PSS'))\n                throw unusable('RSA-PSS');\n            const expected = parseInt(alg.slice(2), 10);\n            const actual = getHashLength(key.algorithm.hash);\n            if (actual !== expected)\n                throw unusable(`SHA-${expected}`, 'algorithm.hash');\n            break;\n        }\n        case 'Ed25519':\n        case 'EdDSA': {\n            if (!isAlgorithm(key.algorithm, 'Ed25519'))\n                throw unusable('Ed25519');\n            break;\n        }\n        case 'ML-DSA-44':\n        case 'ML-DSA-65':\n        case 'ML-DSA-87': {\n            if (!isAlgorithm(key.algorithm, alg))\n                throw unusable(alg);\n            break;\n        }\n        case 'ES256':\n        case 'ES384':\n        case 'ES512': {\n            if (!isAlgorithm(key.algorithm, 'ECDSA'))\n                throw unusable('ECDSA');\n            const expected = getNamedCurve(alg);\n            const actual = key.algorithm.namedCurve;\n            if (actual !== expected)\n                throw unusable(expected, 'algorithm.namedCurve');\n            break;\n        }\n        default:\n            throw new TypeError('CryptoKey does not support this operation');\n    }\n    checkUsage(key, usage);\n}\nexport function checkEncCryptoKey(key, alg, usage) {\n    switch (alg) {\n        case 'A128GCM':\n        case 'A192GCM':\n        case 'A256GCM': {\n            if (!isAlgorithm(key.algorithm, 'AES-GCM'))\n                throw unusable('AES-GCM');\n            const expected = parseInt(alg.slice(1, 4), 10);\n            const actual = key.algorithm.length;\n            if (actual !== expected)\n                throw unusable(expected, 'algorithm.length');\n            break;\n        }\n        case 'A128KW':\n        case 'A192KW':\n        case 'A256KW': {\n            if (!isAlgorithm(key.algorithm, 'AES-KW'))\n                throw unusable('AES-KW');\n            const expected = parseInt(alg.slice(1, 4), 10);\n            const actual = key.algorithm.length;\n            if (actual !== expected)\n                throw unusable(expected, 'algorithm.length');\n            break;\n        }\n        case 'ECDH': {\n            switch (key.algorithm.name) {\n                case 'ECDH':\n                case 'X25519':\n                    break;\n                default:\n                    throw unusable('ECDH or X25519');\n            }\n            break;\n        }\n        case 'PBES2-HS256+A128KW':\n        case 'PBES2-HS384+A192KW':\n        case 'PBES2-HS512+A256KW':\n            if (!isAlgorithm(key.algorithm, 'PBKDF2'))\n                throw unusable('PBKDF2');\n            break;\n        case 'RSA-OAEP':\n        case 'RSA-OAEP-256':\n        case 'RSA-OAEP-384':\n        case 'RSA-OAEP-512': {\n            if (!isAlgorithm(key.algorithm, 'RSA-OAEP'))\n                throw unusable('RSA-OAEP');\n            const expected = parseInt(alg.slice(9), 10) || 1;\n            const actual = getHashLength(key.algorithm.hash);\n            if (actual !== expected)\n                throw unusable(`SHA-${expected}`, 'algorithm.hash');\n            break;\n        }\n        default:\n            throw new TypeError('CryptoKey does not support this operation');\n    }\n    checkUsage(key, usage);\n}\n","function message(msg, actual, ...types) {\n    types = types.filter(Boolean);\n    if (types.length > 2) {\n        const last = types.pop();\n        msg += `one of type ${types.join(', ')}, or ${last}.`;\n    }\n    else if (types.length === 2) {\n        msg += `one of type ${types[0]} or ${types[1]}.`;\n    }\n    else {\n        msg += `of type ${types[0]}.`;\n    }\n    if (actual == null) {\n        msg += ` Received ${actual}`;\n    }\n    else if (typeof actual === 'function' && actual.name) {\n        msg += ` Received function ${actual.name}`;\n    }\n    else if (typeof actual === 'object' && actual != null) {\n        if (actual.constructor?.name) {\n            msg += ` Received an instance of ${actual.constructor.name}`;\n        }\n    }\n    return msg;\n}\nexport const invalidKeyInput = (actual, ...types) => message('Key must be ', actual, ...types);\nexport const withAlg = (alg, actual, ...types) => message(`Key for the ${alg} algorithm must be `, actual, ...types);\n","export function assertCryptoKey(key) {\n    if (!isCryptoKey(key)) {\n        throw new Error('CryptoKey instance expected');\n    }\n}\nexport const isCryptoKey = (key) => {\n    if (key?.[Symbol.toStringTag] === 'CryptoKey')\n        return true;\n    try {\n        return key instanceof CryptoKey;\n    }\n    catch {\n        return false;\n    }\n};\nexport const isKeyObject = (key) => key?.[Symbol.toStringTag] === 'KeyObject';\nexport const isKeyLike = (key) => isCryptoKey(key) || isKeyObject(key);\n","export function isDisjoint(...headers) {\n    const sources = headers.filter(Boolean);\n    if (sources.length === 0 || sources.length === 1) {\n        return true;\n    }\n    let acc;\n    for (const header of sources) {\n        const parameters = Object.keys(header);\n        if (!acc || acc.size === 0) {\n            acc = new Set(parameters);\n            continue;\n        }\n        for (const parameter of parameters) {\n            if (acc.has(parameter)) {\n                return false;\n            }\n            acc.add(parameter);\n        }\n    }\n    return true;\n}\n","const isObjectLike = (value) => typeof value === 'object' && value !== null;\nexport function isObject(input) {\n    if (!isObjectLike(input) || Object.prototype.toString.call(input) !== '[object Object]') {\n        return false;\n    }\n    if (Object.getPrototypeOf(input) === null) {\n        return true;\n    }\n    let proto = input;\n    while (Object.getPrototypeOf(proto) !== null) {\n        proto = Object.getPrototypeOf(proto);\n    }\n    return Object.getPrototypeOf(input) === proto;\n}\n","export function checkKeyLength(alg, key) {\n    if (alg.startsWith('RS') || alg.startsWith('PS')) {\n        const { modulusLength } = key.algorithm;\n        if (typeof modulusLength !== 'number' || modulusLength < 2048) {\n            throw new TypeError(`${alg} requires key modulusLength to be 2048 bits or larger`);\n        }\n    }\n}\n","import { JOSENotSupported } from '../util/errors.js';\nfunction subtleMapping(jwk) {\n    let algorithm;\n    let keyUsages;\n    switch (jwk.kty) {\n        case 'AKP': {\n            switch (jwk.alg) {\n                case 'ML-DSA-44':\n                case 'ML-DSA-65':\n                case 'ML-DSA-87':\n                    algorithm = { name: jwk.alg };\n                    keyUsages = jwk.priv ? ['sign'] : ['verify'];\n                    break;\n                default:\n                    throw new JOSENotSupported('Invalid or unsupported JWK \"alg\" (Algorithm) Parameter value');\n            }\n            break;\n        }\n        case 'RSA': {\n            switch (jwk.alg) {\n                case 'PS256':\n                case 'PS384':\n                case 'PS512':\n                    algorithm = { name: 'RSA-PSS', hash: `SHA-${jwk.alg.slice(-3)}` };\n                    keyUsages = jwk.d ? ['sign'] : ['verify'];\n                    break;\n                case 'RS256':\n                case 'RS384':\n                case 'RS512':\n                    algorithm = { name: 'RSASSA-PKCS1-v1_5', hash: `SHA-${jwk.alg.slice(-3)}` };\n                    keyUsages = jwk.d ? ['sign'] : ['verify'];\n                    break;\n                case 'RSA-OAEP':\n                case 'RSA-OAEP-256':\n                case 'RSA-OAEP-384':\n                case 'RSA-OAEP-512':\n                    algorithm = {\n                        name: 'RSA-OAEP',\n                        hash: `SHA-${parseInt(jwk.alg.slice(-3), 10) || 1}`,\n                    };\n                    keyUsages = jwk.d ? ['decrypt', 'unwrapKey'] : ['encrypt', 'wrapKey'];\n                    break;\n                default:\n                    throw new JOSENotSupported('Invalid or unsupported JWK \"alg\" (Algorithm) Parameter value');\n            }\n            break;\n        }\n        case 'EC': {\n            switch (jwk.alg) {\n                case 'ES256':\n                    algorithm = { name: 'ECDSA', namedCurve: 'P-256' };\n                    keyUsages = jwk.d ? ['sign'] : ['verify'];\n                    break;\n                case 'ES384':\n                    algorithm = { name: 'ECDSA', namedCurve: 'P-384' };\n                    keyUsages = jwk.d ? ['sign'] : ['verify'];\n                    break;\n                case 'ES512':\n                    algorithm = { name: 'ECDSA', namedCurve: 'P-521' };\n                    keyUsages = jwk.d ? ['sign'] : ['verify'];\n                    break;\n                case 'ECDH-ES':\n                case 'ECDH-ES+A128KW':\n                case 'ECDH-ES+A192KW':\n                case 'ECDH-ES+A256KW':\n                    algorithm = { name: 'ECDH', namedCurve: jwk.crv };\n                    keyUsages = jwk.d ? ['deriveBits'] : [];\n                    break;\n                default:\n                    throw new JOSENotSupported('Invalid or unsupported JWK \"alg\" (Algorithm) Parameter value');\n            }\n            break;\n        }\n        case 'OKP': {\n            switch (jwk.alg) {\n                case 'Ed25519':\n                case 'EdDSA':\n                    algorithm = { name: 'Ed25519' };\n                    keyUsages = jwk.d ? ['sign'] : ['verify'];\n                    break;\n                case 'ECDH-ES':\n                case 'ECDH-ES+A128KW':\n                case 'ECDH-ES+A192KW':\n                case 'ECDH-ES+A256KW':\n                    algorithm = { name: jwk.crv };\n                    keyUsages = jwk.d ? ['deriveBits'] : [];\n                    break;\n                default:\n                    throw new JOSENotSupported('Invalid or unsupported JWK \"alg\" (Algorithm) Parameter value');\n            }\n            break;\n        }\n        default:\n            throw new JOSENotSupported('Invalid or unsupported JWK \"kty\" (Key Type) Parameter value');\n    }\n    return { algorithm, keyUsages };\n}\nexport async function jwkToKey(jwk) {\n    if (!jwk.alg) {\n        throw new TypeError('\"alg\" argument is required when \"jwk.alg\" is not present');\n    }\n    const { algorithm, keyUsages } = subtleMapping(jwk);\n    const keyData = { ...jwk };\n    if (keyData.kty !== 'AKP') {\n        delete keyData.alg;\n    }\n    delete keyData.use;\n    return crypto.subtle.importKey('jwk', keyData, algorithm, jwk.ext ?? (jwk.d || jwk.priv ? false : true), jwk.key_ops ?? keyUsages);\n}\n","import { decode as decodeBase64URL } from '../util/base64url.js';\nimport { fromSPKI, fromPKCS8, fromX509 } from '../lib/asn1.js';\nimport { jwkToKey } from '../lib/jwk_to_key.js';\nimport { JOSENotSupported } from '../util/errors.js';\nimport { isObject } from '../lib/is_object.js';\nexport async function importSPKI(spki, alg, options) {\n    if (typeof spki !== 'string' || spki.indexOf('-----BEGIN PUBLIC KEY-----') !== 0) {\n        throw new TypeError('\"spki\" must be SPKI formatted string');\n    }\n    return fromSPKI(spki, alg, options);\n}\nexport async function importX509(x509, alg, options) {\n    if (typeof x509 !== 'string' || x509.indexOf('-----BEGIN CERTIFICATE-----') !== 0) {\n        throw new TypeError('\"x509\" must be X.509 formatted string');\n    }\n    return fromX509(x509, alg, options);\n}\nexport async function importPKCS8(pkcs8, alg, options) {\n    if (typeof pkcs8 !== 'string' || pkcs8.indexOf('-----BEGIN PRIVATE KEY-----') !== 0) {\n        throw new TypeError('\"pkcs8\" must be PKCS#8 formatted string');\n    }\n    return fromPKCS8(pkcs8, alg, options);\n}\nexport async function importJWK(jwk, alg, options) {\n    if (!isObject(jwk)) {\n        throw new TypeError('JWK must be an object');\n    }\n    let ext;\n    alg ??= jwk.alg;\n    ext ??= options?.extractable ?? jwk.ext;\n    switch (jwk.kty) {\n        case 'oct':\n            if (typeof jwk.k !== 'string' || !jwk.k) {\n                throw new TypeError('missing \"k\" (Key Value) Parameter value');\n            }\n            return decodeBase64URL(jwk.k);\n        case 'RSA':\n            if ('oth' in jwk && jwk.oth !== undefined) {\n                throw new JOSENotSupported('RSA JWK \"oth\" (Other Primes Info) Parameter value is not supported');\n            }\n            return jwkToKey({ ...jwk, alg, ext });\n        case 'AKP': {\n            if (typeof jwk.alg !== 'string' || !jwk.alg) {\n                throw new TypeError('missing \"alg\" (Algorithm) Parameter value');\n            }\n            if (alg !== undefined && alg !== jwk.alg) {\n                throw new TypeError('JWK alg and alg option value mismatch');\n            }\n            return jwkToKey({ ...jwk, ext });\n        }\n        case 'EC':\n        case 'OKP':\n            return jwkToKey({ ...jwk, alg, ext });\n        default:\n            throw new JOSENotSupported('Unsupported \"kty\" (Key Type) Parameter value');\n    }\n}\n","import { JOSENotSupported, JWEInvalid, JWSInvalid } from '../util/errors.js';\nexport function validateCrit(Err, recognizedDefault, recognizedOption, protectedHeader, joseHeader) {\n    if (joseHeader.crit !== undefined && protectedHeader?.crit === undefined) {\n        throw new Err('\"crit\" (Critical) Header Parameter MUST be integrity protected');\n    }\n    if (!protectedHeader || protectedHeader.crit === undefined) {\n        return new Set();\n    }\n    if (!Array.isArray(protectedHeader.crit) ||\n        protectedHeader.crit.length === 0 ||\n        protectedHeader.crit.some((input) => typeof input !== 'string' || input.length === 0)) {\n        throw new Err('\"crit\" (Critical) Header Parameter MUST be an array of non-empty strings when present');\n    }\n    let recognized;\n    if (recognizedOption !== undefined) {\n        recognized = new Map([...Object.entries(recognizedOption), ...recognizedDefault.entries()]);\n    }\n    else {\n        recognized = recognizedDefault;\n    }\n    for (const parameter of protectedHeader.crit) {\n        if (!recognized.has(parameter)) {\n            throw new JOSENotSupported(`Extension Header Parameter \"${parameter}\" is not recognized`);\n        }\n        if (joseHeader[parameter] === undefined) {\n            throw new Err(`Extension Header Parameter \"${parameter}\" is missing`);\n        }\n        if (recognized.get(parameter) && protectedHeader[parameter] === undefined) {\n            throw new Err(`Extension Header Parameter \"${parameter}\" MUST be integrity protected`);\n        }\n    }\n    return new Set(protectedHeader.crit);\n}\n","export function validateAlgorithms(option, algorithms) {\n    if (algorithms !== undefined &&\n        (!Array.isArray(algorithms) || algorithms.some((s) => typeof s !== 'string'))) {\n        throw new TypeError(`\"${option}\" option must be an array of strings`);\n    }\n    if (!algorithms) {\n        return undefined;\n    }\n    return new Set(algorithms);\n}\n","import { isObject } from './is_object.js';\nexport const isJWK = (key) => isObject(key) && typeof key.kty === 'string';\nexport const isPrivateJWK = (key) => key.kty !== 'oct' &&\n    ((key.kty === 'AKP' && typeof key.priv === 'string') || typeof key.d === 'string');\nexport const isPublicJWK = (key) => key.kty !== 'oct' && key.d === undefined && key.priv === undefined;\nexport const isSecretJWK = (key) => key.kty === 'oct' && typeof key.k === 'string';\n","import { isJWK } from './is_jwk.js';\nimport { decode } from '../util/base64url.js';\nimport { jwkToKey } from './jwk_to_key.js';\nimport { isCryptoKey, isKeyObject } from './is_key_like.js';\nlet cache;\nconst handleJWK = async (key, jwk, alg, freeze = false) => {\n    cache ||= new WeakMap();\n    let cached = cache.get(key);\n    if (cached?.[alg]) {\n        return cached[alg];\n    }\n    const cryptoKey = await jwkToKey({ ...jwk, alg });\n    if (freeze)\n        Object.freeze(key);\n    if (!cached) {\n        cache.set(key, { [alg]: cryptoKey });\n    }\n    else {\n        cached[alg] = cryptoKey;\n    }\n    return cryptoKey;\n};\nconst handleKeyObject = (keyObject, alg) => {\n    cache ||= new WeakMap();\n    let cached = cache.get(keyObject);\n    if (cached?.[alg]) {\n        return cached[alg];\n    }\n    const isPublic = keyObject.type === 'public';\n    const extractable = isPublic ? true : false;\n    let cryptoKey;\n    if (keyObject.asymmetricKeyType === 'x25519') {\n        switch (alg) {\n            case 'ECDH-ES':\n            case 'ECDH-ES+A128KW':\n            case 'ECDH-ES+A192KW':\n            case 'ECDH-ES+A256KW':\n                break;\n            default:\n                throw new TypeError('given KeyObject instance cannot be used for this algorithm');\n        }\n        cryptoKey = keyObject.toCryptoKey(keyObject.asymmetricKeyType, extractable, isPublic ? [] : ['deriveBits']);\n    }\n    if (keyObject.asymmetricKeyType === 'ed25519') {\n        if (alg !== 'EdDSA' && alg !== 'Ed25519') {\n            throw new TypeError('given KeyObject instance cannot be used for this algorithm');\n        }\n        cryptoKey = keyObject.toCryptoKey(keyObject.asymmetricKeyType, extractable, [\n            isPublic ? 'verify' : 'sign',\n        ]);\n    }\n    switch (keyObject.asymmetricKeyType) {\n        case 'ml-dsa-44':\n        case 'ml-dsa-65':\n        case 'ml-dsa-87': {\n            if (alg !== keyObject.asymmetricKeyType.toUpperCase()) {\n                throw new TypeError('given KeyObject instance cannot be used for this algorithm');\n            }\n            cryptoKey = keyObject.toCryptoKey(keyObject.asymmetricKeyType, extractable, [\n                isPublic ? 'verify' : 'sign',\n            ]);\n        }\n    }\n    if (keyObject.asymmetricKeyType === 'rsa') {\n        let hash;\n        switch (alg) {\n            case 'RSA-OAEP':\n                hash = 'SHA-1';\n                break;\n            case 'RS256':\n            case 'PS256':\n            case 'RSA-OAEP-256':\n                hash = 'SHA-256';\n                break;\n            case 'RS384':\n            case 'PS384':\n            case 'RSA-OAEP-384':\n                hash = 'SHA-384';\n                break;\n            case 'RS512':\n            case 'PS512':\n            case 'RSA-OAEP-512':\n                hash = 'SHA-512';\n                break;\n            default:\n                throw new TypeError('given KeyObject instance cannot be used for this algorithm');\n        }\n        if (alg.startsWith('RSA-OAEP')) {\n            return keyObject.toCryptoKey({\n                name: 'RSA-OAEP',\n                hash,\n            }, extractable, isPublic ? ['encrypt'] : ['decrypt']);\n        }\n        cryptoKey = keyObject.toCryptoKey({\n            name: alg.startsWith('PS') ? 'RSA-PSS' : 'RSASSA-PKCS1-v1_5',\n            hash,\n        }, extractable, [isPublic ? 'verify' : 'sign']);\n    }\n    if (keyObject.asymmetricKeyType === 'ec') {\n        const nist = new Map([\n            ['prime256v1', 'P-256'],\n            ['secp384r1', 'P-384'],\n            ['secp521r1', 'P-521'],\n        ]);\n        const namedCurve = nist.get(keyObject.asymmetricKeyDetails?.namedCurve);\n        if (!namedCurve) {\n            throw new TypeError('given KeyObject instance cannot be used for this algorithm');\n        }\n        if (alg === 'ES256' && namedCurve === 'P-256') {\n            cryptoKey = keyObject.toCryptoKey({\n                name: 'ECDSA',\n                namedCurve,\n            }, extractable, [isPublic ? 'verify' : 'sign']);\n        }\n        if (alg === 'ES384' && namedCurve === 'P-384') {\n            cryptoKey = keyObject.toCryptoKey({\n                name: 'ECDSA',\n                namedCurve,\n            }, extractable, [isPublic ? 'verify' : 'sign']);\n        }\n        if (alg === 'ES512' && namedCurve === 'P-521') {\n            cryptoKey = keyObject.toCryptoKey({\n                name: 'ECDSA',\n                namedCurve,\n            }, extractable, [isPublic ? 'verify' : 'sign']);\n        }\n        if (alg.startsWith('ECDH-ES')) {\n            cryptoKey = keyObject.toCryptoKey({\n                name: 'ECDH',\n                namedCurve,\n            }, extractable, isPublic ? [] : ['deriveBits']);\n        }\n    }\n    if (!cryptoKey) {\n        throw new TypeError('given KeyObject instance cannot be used for this algorithm');\n    }\n    if (!cached) {\n        cache.set(keyObject, { [alg]: cryptoKey });\n    }\n    else {\n        cached[alg] = cryptoKey;\n    }\n    return cryptoKey;\n};\nexport async function normalizeKey(key, alg) {\n    if (key instanceof Uint8Array) {\n        return key;\n    }\n    if (isCryptoKey(key)) {\n        return key;\n    }\n    if (isKeyObject(key)) {\n        if (key.type === 'secret') {\n            return key.export();\n        }\n        if ('toCryptoKey' in key && typeof key.toCryptoKey === 'function') {\n            try {\n                return handleKeyObject(key, alg);\n            }\n            catch (err) {\n                if (err instanceof TypeError) {\n                    throw err;\n                }\n            }\n        }\n        let jwk = key.export({ format: 'jwk' });\n        return handleJWK(key, jwk, alg);\n    }\n    if (isJWK(key)) {\n        if (key.k) {\n            return decode(key.k);\n        }\n        return handleJWK(key, key, alg, true);\n    }\n    throw new Error('unreachable');\n}\n","import { withAlg as invalidKeyInput } from './invalid_key_input.js';\nimport { isKeyLike } from './is_key_like.js';\nimport * as jwk from './is_jwk.js';\nconst tag = (key) => key?.[Symbol.toStringTag];\nconst jwkMatchesOp = (alg, key, usage) => {\n    if (key.use !== undefined) {\n        let expected;\n        switch (usage) {\n            case 'sign':\n            case 'verify':\n                expected = 'sig';\n                break;\n            case 'encrypt':\n            case 'decrypt':\n                expected = 'enc';\n                break;\n        }\n        if (key.use !== expected) {\n            throw new TypeError(`Invalid key for this operation, its \"use\" must be \"${expected}\" when present`);\n        }\n    }\n    if (key.alg !== undefined && key.alg !== alg) {\n        throw new TypeError(`Invalid key for this operation, its \"alg\" must be \"${alg}\" when present`);\n    }\n    if (Array.isArray(key.key_ops)) {\n        let expectedKeyOp;\n        switch (true) {\n            case usage === 'sign' || usage === 'verify':\n            case alg === 'dir':\n            case alg.includes('CBC-HS'):\n                expectedKeyOp = usage;\n                break;\n            case alg.startsWith('PBES2'):\n                expectedKeyOp = 'deriveBits';\n                break;\n            case /^A\\d{3}(?:GCM)?(?:KW)?$/.test(alg):\n                if (!alg.includes('GCM') && alg.endsWith('KW')) {\n                    expectedKeyOp = usage === 'encrypt' ? 'wrapKey' : 'unwrapKey';\n                }\n                else {\n                    expectedKeyOp = usage;\n                }\n                break;\n            case usage === 'encrypt' && alg.startsWith('RSA'):\n                expectedKeyOp = 'wrapKey';\n                break;\n            case usage === 'decrypt':\n                expectedKeyOp = alg.startsWith('RSA') ? 'unwrapKey' : 'deriveBits';\n                break;\n        }\n        if (expectedKeyOp && key.key_ops?.includes?.(expectedKeyOp) === false) {\n            throw new TypeError(`Invalid key for this operation, its \"key_ops\" must include \"${expectedKeyOp}\" when present`);\n        }\n    }\n    return true;\n};\nconst symmetricTypeCheck = (alg, key, usage) => {\n    if (key instanceof Uint8Array)\n        return;\n    if (jwk.isJWK(key)) {\n        if (jwk.isSecretJWK(key) && jwkMatchesOp(alg, key, usage))\n            return;\n        throw new TypeError(`JSON Web Key for symmetric algorithms must have JWK \"kty\" (Key Type) equal to \"oct\" and the JWK \"k\" (Key Value) present`);\n    }\n    if (!isKeyLike(key)) {\n        throw new TypeError(invalidKeyInput(alg, key, 'CryptoKey', 'KeyObject', 'JSON Web Key', 'Uint8Array'));\n    }\n    if (key.type !== 'secret') {\n        throw new TypeError(`${tag(key)} instances for symmetric algorithms must be of type \"secret\"`);\n    }\n};\nconst asymmetricTypeCheck = (alg, key, usage) => {\n    if (jwk.isJWK(key)) {\n        switch (usage) {\n            case 'decrypt':\n            case 'sign':\n                if (jwk.isPrivateJWK(key) && jwkMatchesOp(alg, key, usage))\n                    return;\n                throw new TypeError(`JSON Web Key for this operation be a private JWK`);\n            case 'encrypt':\n            case 'verify':\n                if (jwk.isPublicJWK(key) && jwkMatchesOp(alg, key, usage))\n                    return;\n                throw new TypeError(`JSON Web Key for this operation be a public JWK`);\n        }\n    }\n    if (!isKeyLike(key)) {\n        throw new TypeError(invalidKeyInput(alg, key, 'CryptoKey', 'KeyObject', 'JSON Web Key'));\n    }\n    if (key.type === 'secret') {\n        throw new TypeError(`${tag(key)} instances for asymmetric algorithms must not be of type \"secret\"`);\n    }\n    if (key.type === 'public') {\n        switch (usage) {\n            case 'sign':\n                throw new TypeError(`${tag(key)} instances for asymmetric algorithm signing must be of type \"private\"`);\n            case 'decrypt':\n                throw new TypeError(`${tag(key)} instances for asymmetric algorithm decryption must be of type \"private\"`);\n        }\n    }\n    if (key.type === 'private') {\n        switch (usage) {\n            case 'verify':\n                throw new TypeError(`${tag(key)} instances for asymmetric algorithm verifying must be of type \"public\"`);\n            case 'encrypt':\n                throw new TypeError(`${tag(key)} instances for asymmetric algorithm encryption must be of type \"public\"`);\n        }\n    }\n};\nexport function checkKeyType(alg, key, usage) {\n    switch (alg.substring(0, 2)) {\n        case 'A1':\n        case 'A2':\n        case 'di':\n        case 'HS':\n        case 'PB':\n            symmetricTypeCheck(alg, key, usage);\n            break;\n        default:\n            asymmetricTypeCheck(alg, key, usage);\n    }\n}\n","import { JOSENotSupported } from '../util/errors.js';\nexport function subtleAlgorithm(alg, algorithm) {\n    const hash = `SHA-${alg.slice(-3)}`;\n    switch (alg) {\n        case 'HS256':\n        case 'HS384':\n        case 'HS512':\n            return { hash, name: 'HMAC' };\n        case 'PS256':\n        case 'PS384':\n        case 'PS512':\n            return { hash, name: 'RSA-PSS', saltLength: parseInt(alg.slice(-3), 10) >> 3 };\n        case 'RS256':\n        case 'RS384':\n        case 'RS512':\n            return { hash, name: 'RSASSA-PKCS1-v1_5' };\n        case 'ES256':\n        case 'ES384':\n        case 'ES512':\n            return { hash, name: 'ECDSA', namedCurve: algorithm.namedCurve };\n        case 'Ed25519':\n        case 'EdDSA':\n            return { name: 'Ed25519' };\n        case 'ML-DSA-44':\n        case 'ML-DSA-65':\n        case 'ML-DSA-87':\n            return { name: alg };\n        default:\n            throw new JOSENotSupported(`alg ${alg} is not supported either by JOSE or your javascript runtime`);\n    }\n}\n","import { checkSigCryptoKey } from './crypto_key.js';\nimport { invalidKeyInput } from './invalid_key_input.js';\nexport async function getSigKey(alg, key, usage) {\n    if (key instanceof Uint8Array) {\n        if (!alg.startsWith('HS')) {\n            throw new TypeError(invalidKeyInput(key, 'CryptoKey', 'KeyObject', 'JSON Web Key'));\n        }\n        return crypto.subtle.importKey('raw', key, { hash: `SHA-${alg.slice(-3)}`, name: 'HMAC' }, false, [usage]);\n    }\n    checkSigCryptoKey(key, alg, usage);\n    return key;\n}\n","import { subtleAlgorithm } from './subtle_dsa.js';\nimport { checkKeyLength } from './check_key_length.js';\nimport { getSigKey } from './get_sign_verify_key.js';\nexport async function verify(alg, key, signature, data) {\n    const cryptoKey = await getSigKey(alg, key, 'verify');\n    checkKeyLength(alg, cryptoKey);\n    const algorithm = subtleAlgorithm(alg, cryptoKey.algorithm);\n    try {\n        return await crypto.subtle.verify(algorithm, cryptoKey, signature, data);\n    }\n    catch {\n        return false;\n    }\n}\n","import { decode as b64u } from '../../util/base64url.js';\nimport { verify } from '../../lib/verify.js';\nimport { JOSEAlgNotAllowed, JWSInvalid, JWSSignatureVerificationFailed } from '../../util/errors.js';\nimport { concat, encoder, decoder, encode } from '../../lib/buffer_utils.js';\nimport { isDisjoint } from '../../lib/is_disjoint.js';\nimport { isObject } from '../../lib/is_object.js';\nimport { checkKeyType } from '../../lib/check_key_type.js';\nimport { validateCrit } from '../../lib/validate_crit.js';\nimport { validateAlgorithms } from '../../lib/validate_algorithms.js';\nimport { normalizeKey } from '../../lib/normalize_key.js';\nexport async function flattenedVerify(jws, key, options) {\n    if (!isObject(jws)) {\n        throw new JWSInvalid('Flattened JWS must be an object');\n    }\n    if (jws.protected === undefined && jws.header === undefined) {\n        throw new JWSInvalid('Flattened JWS must have either of the \"protected\" or \"header\" members');\n    }\n    if (jws.protected !== undefined && typeof jws.protected !== 'string') {\n        throw new JWSInvalid('JWS Protected Header incorrect type');\n    }\n    if (jws.payload === undefined) {\n        throw new JWSInvalid('JWS Payload missing');\n    }\n    if (typeof jws.signature !== 'string') {\n        throw new JWSInvalid('JWS Signature missing or incorrect type');\n    }\n    if (jws.header !== undefined && !isObject(jws.header)) {\n        throw new JWSInvalid('JWS Unprotected Header incorrect type');\n    }\n    let parsedProt = {};\n    if (jws.protected) {\n        try {\n            const protectedHeader = b64u(jws.protected);\n            parsedProt = JSON.parse(decoder.decode(protectedHeader));\n        }\n        catch {\n            throw new JWSInvalid('JWS Protected Header is invalid');\n        }\n    }\n    if (!isDisjoint(parsedProt, jws.header)) {\n        throw new JWSInvalid('JWS Protected and JWS Unprotected Header Parameter names must be disjoint');\n    }\n    const joseHeader = {\n        ...parsedProt,\n        ...jws.header,\n    };\n    const extensions = validateCrit(JWSInvalid, new Map([['b64', true]]), options?.crit, parsedProt, joseHeader);\n    let b64 = true;\n    if (extensions.has('b64')) {\n        b64 = parsedProt.b64;\n        if (typeof b64 !== 'boolean') {\n            throw new JWSInvalid('The \"b64\" (base64url-encode payload) Header Parameter must be a boolean');\n        }\n    }\n    const { alg } = joseHeader;\n    if (typeof alg !== 'string' || !alg) {\n        throw new JWSInvalid('JWS \"alg\" (Algorithm) Header Parameter missing or invalid');\n    }\n    const algorithms = options && validateAlgorithms('algorithms', options.algorithms);\n    if (algorithms && !algorithms.has(alg)) {\n        throw new JOSEAlgNotAllowed('\"alg\" (Algorithm) Header Parameter value not allowed');\n    }\n    if (b64) {\n        if (typeof jws.payload !== 'string') {\n            throw new JWSInvalid('JWS Payload must be a string');\n        }\n    }\n    else if (typeof jws.payload !== 'string' && !(jws.payload instanceof Uint8Array)) {\n        throw new JWSInvalid('JWS Payload must be a string or an Uint8Array instance');\n    }\n    let resolvedKey = false;\n    if (typeof key === 'function') {\n        key = await key(parsedProt, jws);\n        resolvedKey = true;\n    }\n    checkKeyType(alg, key, 'verify');\n    const data = concat(jws.protected !== undefined ? encode(jws.protected) : new Uint8Array(), encode('.'), typeof jws.payload === 'string'\n        ? b64\n            ? encode(jws.payload)\n            : encoder.encode(jws.payload)\n        : jws.payload);\n    let signature;\n    try {\n        signature = b64u(jws.signature);\n    }\n    catch {\n        throw new JWSInvalid('Failed to base64url decode the signature');\n    }\n    const k = await normalizeKey(key, alg);\n    const verified = await verify(alg, k, signature, data);\n    if (!verified) {\n        throw new JWSSignatureVerificationFailed();\n    }\n    let payload;\n    if (b64) {\n        try {\n            payload = b64u(jws.payload);\n        }\n        catch {\n            throw new JWSInvalid('Failed to base64url decode the payload');\n        }\n    }\n    else if (typeof jws.payload === 'string') {\n        payload = encoder.encode(jws.payload);\n    }\n    else {\n        payload = jws.payload;\n    }\n    const result = { payload };\n    if (jws.protected !== undefined) {\n        result.protectedHeader = parsedProt;\n    }\n    if (jws.header !== undefined) {\n        result.unprotectedHeader = jws.header;\n    }\n    if (resolvedKey) {\n        return { ...result, key: k };\n    }\n    return result;\n}\n","import { flattenedVerify } from '../flattened/verify.js';\nimport { JWSInvalid } from '../../util/errors.js';\nimport { decoder } from '../../lib/buffer_utils.js';\nexport async function compactVerify(jws, key, options) {\n    if (jws instanceof Uint8Array) {\n        jws = decoder.decode(jws);\n    }\n    if (typeof jws !== 'string') {\n        throw new JWSInvalid('Compact JWS must be a string or Uint8Array');\n    }\n    const { 0: protectedHeader, 1: payload, 2: signature, length } = jws.split('.');\n    if (length !== 3) {\n        throw new JWSInvalid('Invalid Compact JWS');\n    }\n    const verified = await flattenedVerify({ payload, protected: protectedHeader, signature }, key, options);\n    const result = { payload: verified.payload, protectedHeader: verified.protectedHeader };\n    if (typeof key === 'function') {\n        return { ...result, key: verified.key };\n    }\n    return result;\n}\n","import { JWTClaimValidationFailed, JWTExpired, JWTInvalid } from '../util/errors.js';\nimport { encoder, decoder } from './buffer_utils.js';\nimport { isObject } from './is_object.js';\nconst epoch = (date) => Math.floor(date.getTime() / 1000);\nconst minute = 60;\nconst hour = minute * 60;\nconst day = hour * 24;\nconst week = day * 7;\nconst year = day * 365.25;\nconst REGEX = /^(\\+|\\-)? ?(\\d+|\\d+\\.\\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i;\nexport function secs(str) {\n    const matched = REGEX.exec(str);\n    if (!matched || (matched[4] && matched[1])) {\n        throw new TypeError('Invalid time period format');\n    }\n    const value = parseFloat(matched[2]);\n    const unit = matched[3].toLowerCase();\n    let numericDate;\n    switch (unit) {\n        case 'sec':\n        case 'secs':\n        case 'second':\n        case 'seconds':\n        case 's':\n            numericDate = Math.round(value);\n            break;\n        case 'minute':\n        case 'minutes':\n        case 'min':\n        case 'mins':\n        case 'm':\n            numericDate = Math.round(value * minute);\n            break;\n        case 'hour':\n        case 'hours':\n        case 'hr':\n        case 'hrs':\n        case 'h':\n            numericDate = Math.round(value * hour);\n            break;\n        case 'day':\n        case 'days':\n        case 'd':\n            numericDate = Math.round(value * day);\n            break;\n        case 'week':\n        case 'weeks':\n        case 'w':\n            numericDate = Math.round(value * week);\n            break;\n        default:\n            numericDate = Math.round(value * year);\n            break;\n    }\n    if (matched[1] === '-' || matched[4] === 'ago') {\n        return -numericDate;\n    }\n    return numericDate;\n}\nfunction validateInput(label, input) {\n    if (!Number.isFinite(input)) {\n        throw new TypeError(`Invalid ${label} input`);\n    }\n    return input;\n}\nconst normalizeTyp = (value) => {\n    if (value.includes('/')) {\n        return value.toLowerCase();\n    }\n    return `application/${value.toLowerCase()}`;\n};\nconst checkAudiencePresence = (audPayload, audOption) => {\n    if (typeof audPayload === 'string') {\n        return audOption.includes(audPayload);\n    }\n    if (Array.isArray(audPayload)) {\n        return audOption.some(Set.prototype.has.bind(new Set(audPayload)));\n    }\n    return false;\n};\nexport function validateClaimsSet(protectedHeader, encodedPayload, options = {}) {\n    let payload;\n    try {\n        payload = JSON.parse(decoder.decode(encodedPayload));\n    }\n    catch {\n    }\n    if (!isObject(payload)) {\n        throw new JWTInvalid('JWT Claims Set must be a top-level JSON object');\n    }\n    const { typ } = options;\n    if (typ &&\n        (typeof protectedHeader.typ !== 'string' ||\n            normalizeTyp(protectedHeader.typ) !== normalizeTyp(typ))) {\n        throw new JWTClaimValidationFailed('unexpected \"typ\" JWT header value', payload, 'typ', 'check_failed');\n    }\n    const { requiredClaims = [], issuer, subject, audience, maxTokenAge } = options;\n    const presenceCheck = [...requiredClaims];\n    if (maxTokenAge !== undefined)\n        presenceCheck.push('iat');\n    if (audience !== undefined)\n        presenceCheck.push('aud');\n    if (subject !== undefined)\n        presenceCheck.push('sub');\n    if (issuer !== undefined)\n        presenceCheck.push('iss');\n    for (const claim of new Set(presenceCheck.reverse())) {\n        if (!(claim in payload)) {\n            throw new JWTClaimValidationFailed(`missing required \"${claim}\" claim`, payload, claim, 'missing');\n        }\n    }\n    if (issuer &&\n        !(Array.isArray(issuer) ? issuer : [issuer]).includes(payload.iss)) {\n        throw new JWTClaimValidationFailed('unexpected \"iss\" claim value', payload, 'iss', 'check_failed');\n    }\n    if (subject && payload.sub !== subject) {\n        throw new JWTClaimValidationFailed('unexpected \"sub\" claim value', payload, 'sub', 'check_failed');\n    }\n    if (audience &&\n        !checkAudiencePresence(payload.aud, typeof audience === 'string' ? [audience] : audience)) {\n        throw new JWTClaimValidationFailed('unexpected \"aud\" claim value', payload, 'aud', 'check_failed');\n    }\n    let tolerance;\n    switch (typeof options.clockTolerance) {\n        case 'string':\n            tolerance = secs(options.clockTolerance);\n            break;\n        case 'number':\n            tolerance = options.clockTolerance;\n            break;\n        case 'undefined':\n            tolerance = 0;\n            break;\n        default:\n            throw new TypeError('Invalid clockTolerance option type');\n    }\n    const { currentDate } = options;\n    const now = epoch(currentDate || new Date());\n    if ((payload.iat !== undefined || maxTokenAge) && typeof payload.iat !== 'number') {\n        throw new JWTClaimValidationFailed('\"iat\" claim must be a number', payload, 'iat', 'invalid');\n    }\n    if (payload.nbf !== undefined) {\n        if (typeof payload.nbf !== 'number') {\n            throw new JWTClaimValidationFailed('\"nbf\" claim must be a number', payload, 'nbf', 'invalid');\n        }\n        if (payload.nbf > now + tolerance) {\n            throw new JWTClaimValidationFailed('\"nbf\" claim timestamp check failed', payload, 'nbf', 'check_failed');\n        }\n    }\n    if (payload.exp !== undefined) {\n        if (typeof payload.exp !== 'number') {\n            throw new JWTClaimValidationFailed('\"exp\" claim must be a number', payload, 'exp', 'invalid');\n        }\n        if (payload.exp <= now - tolerance) {\n            throw new JWTExpired('\"exp\" claim timestamp check failed', payload, 'exp', 'check_failed');\n        }\n    }\n    if (maxTokenAge) {\n        const age = now - payload.iat;\n        const max = typeof maxTokenAge === 'number' ? maxTokenAge : secs(maxTokenAge);\n        if (age - tolerance > max) {\n            throw new JWTExpired('\"iat\" claim timestamp check failed (too far in the past)', payload, 'iat', 'check_failed');\n        }\n        if (age < 0 - tolerance) {\n            throw new JWTClaimValidationFailed('\"iat\" claim timestamp check failed (it should be in the past)', payload, 'iat', 'check_failed');\n        }\n    }\n    return payload;\n}\nexport class JWTClaimsBuilder {\n    #payload;\n    constructor(payload) {\n        if (!isObject(payload)) {\n            throw new TypeError('JWT Claims Set MUST be an object');\n        }\n        this.#payload = structuredClone(payload);\n    }\n    data() {\n        return encoder.encode(JSON.stringify(this.#payload));\n    }\n    get iss() {\n        return this.#payload.iss;\n    }\n    set iss(value) {\n        this.#payload.iss = value;\n    }\n    get sub() {\n        return this.#payload.sub;\n    }\n    set sub(value) {\n        this.#payload.sub = value;\n    }\n    get aud() {\n        return this.#payload.aud;\n    }\n    set aud(value) {\n        this.#payload.aud = value;\n    }\n    set jti(value) {\n        this.#payload.jti = value;\n    }\n    set nbf(value) {\n        if (typeof value === 'number') {\n            this.#payload.nbf = validateInput('setNotBefore', value);\n        }\n        else if (value instanceof Date) {\n            this.#payload.nbf = validateInput('setNotBefore', epoch(value));\n        }\n        else {\n            this.#payload.nbf = epoch(new Date()) + secs(value);\n        }\n    }\n    set exp(value) {\n        if (typeof value === 'number') {\n            this.#payload.exp = validateInput('setExpirationTime', value);\n        }\n        else if (value instanceof Date) {\n            this.#payload.exp = validateInput('setExpirationTime', epoch(value));\n        }\n        else {\n            this.#payload.exp = epoch(new Date()) + secs(value);\n        }\n    }\n    set iat(value) {\n        if (value === undefined) {\n            this.#payload.iat = epoch(new Date());\n        }\n        else if (value instanceof Date) {\n            this.#payload.iat = validateInput('setIssuedAt', epoch(value));\n        }\n        else if (typeof value === 'string') {\n            this.#payload.iat = validateInput('setIssuedAt', epoch(new Date()) + secs(value));\n        }\n        else {\n            this.#payload.iat = validateInput('setIssuedAt', value);\n        }\n    }\n}\n","import { compactVerify } from '../jws/compact/verify.js';\nimport { validateClaimsSet } from '../lib/jwt_claims_set.js';\nimport { JWTInvalid } from '../util/errors.js';\nexport async function jwtVerify(jwt, key, options) {\n    const verified = await compactVerify(jwt, key, options);\n    if (verified.protectedHeader.crit?.includes('b64') && verified.protectedHeader.b64 === false) {\n        throw new JWTInvalid('JWTs MUST NOT use unencoded payload');\n    }\n    const payload = validateClaimsSet(verified.protectedHeader, verified.payload, options);\n    const result = { payload, protectedHeader: verified.protectedHeader };\n    if (typeof key === 'function') {\n        return { ...result, key: verified.key };\n    }\n    return result;\n}\n","import { importJWK } from '../key/import.js';\nimport { JWKSInvalid, JOSENotSupported, JWKSNoMatchingKey, JWKSMultipleMatchingKeys, } from '../util/errors.js';\nimport { isObject } from '../lib/is_object.js';\nfunction getKtyFromAlg(alg) {\n    switch (typeof alg === 'string' && alg.slice(0, 2)) {\n        case 'RS':\n        case 'PS':\n            return 'RSA';\n        case 'ES':\n            return 'EC';\n        case 'Ed':\n            return 'OKP';\n        case 'ML':\n            return 'AKP';\n        default:\n            throw new JOSENotSupported('Unsupported \"alg\" value for a JSON Web Key Set');\n    }\n}\nfunction isJWKSLike(jwks) {\n    return (jwks &&\n        typeof jwks === 'object' &&\n        Array.isArray(jwks.keys) &&\n        jwks.keys.every(isJWKLike));\n}\nfunction isJWKLike(key) {\n    return isObject(key);\n}\nclass LocalJWKSet {\n    #jwks;\n    #cached = new WeakMap();\n    constructor(jwks) {\n        if (!isJWKSLike(jwks)) {\n            throw new JWKSInvalid('JSON Web Key Set malformed');\n        }\n        this.#jwks = structuredClone(jwks);\n    }\n    jwks() {\n        return this.#jwks;\n    }\n    async getKey(protectedHeader, token) {\n        const { alg, kid } = { ...protectedHeader, ...token?.header };\n        const kty = getKtyFromAlg(alg);\n        const candidates = this.#jwks.keys.filter((jwk) => {\n            let candidate = kty === jwk.kty;\n            if (candidate && typeof kid === 'string') {\n                candidate = kid === jwk.kid;\n            }\n            if (candidate && (typeof jwk.alg === 'string' || kty === 'AKP')) {\n                candidate = alg === jwk.alg;\n            }\n            if (candidate && typeof jwk.use === 'string') {\n                candidate = jwk.use === 'sig';\n            }\n            if (candidate && Array.isArray(jwk.key_ops)) {\n                candidate = jwk.key_ops.includes('verify');\n            }\n            if (candidate) {\n                switch (alg) {\n                    case 'ES256':\n                        candidate = jwk.crv === 'P-256';\n                        break;\n                    case 'ES384':\n                        candidate = jwk.crv === 'P-384';\n                        break;\n                    case 'ES512':\n                        candidate = jwk.crv === 'P-521';\n                        break;\n                    case 'Ed25519':\n                    case 'EdDSA':\n                        candidate = jwk.crv === 'Ed25519';\n                        break;\n                }\n            }\n            return candidate;\n        });\n        const { 0: jwk, length } = candidates;\n        if (length === 0) {\n            throw new JWKSNoMatchingKey();\n        }\n        if (length !== 1) {\n            const error = new JWKSMultipleMatchingKeys();\n            const _cached = this.#cached;\n            error[Symbol.asyncIterator] = async function* () {\n                for (const jwk of candidates) {\n                    try {\n                        yield await importWithAlgCache(_cached, jwk, alg);\n                    }\n                    catch { }\n                }\n            };\n            throw error;\n        }\n        return importWithAlgCache(this.#cached, jwk, alg);\n    }\n}\nasync function importWithAlgCache(cache, jwk, alg) {\n    const cached = cache.get(jwk) || cache.set(jwk, {}).get(jwk);\n    if (cached[alg] === undefined) {\n        const key = await importJWK({ ...jwk, ext: true }, alg);\n        if (key instanceof Uint8Array || key.type !== 'public') {\n            throw new JWKSInvalid('JSON Web Key Set members must be public keys');\n        }\n        cached[alg] = key;\n    }\n    return cached[alg];\n}\nexport function createLocalJWKSet(jwks) {\n    const set = new LocalJWKSet(jwks);\n    const localJWKSet = async (protectedHeader, token) => set.getKey(protectedHeader, token);\n    Object.defineProperties(localJWKSet, {\n        jwks: {\n            value: () => structuredClone(set.jwks()),\n            enumerable: false,\n            configurable: false,\n            writable: false,\n        },\n    });\n    return localJWKSet;\n}\n","import { JOSEError, JWKSNoMatchingKey, JWKSTimeout } from '../util/errors.js';\nimport { createLocalJWKSet } from './local.js';\nimport { isObject } from '../lib/is_object.js';\nfunction isCloudflareWorkers() {\n    return (typeof WebSocketPair !== 'undefined' ||\n        (typeof navigator !== 'undefined' && navigator.userAgent === 'Cloudflare-Workers') ||\n        (typeof EdgeRuntime !== 'undefined' && EdgeRuntime === 'vercel'));\n}\nlet USER_AGENT;\nif (typeof navigator === 'undefined' || !navigator.userAgent?.startsWith?.('Mozilla/5.0 ')) {\n    const NAME = 'jose';\n    const VERSION = 'v6.1.2';\n    USER_AGENT = `${NAME}/${VERSION}`;\n}\nexport const customFetch = Symbol();\nasync function fetchJwks(url, headers, signal, fetchImpl = fetch) {\n    const response = await fetchImpl(url, {\n        method: 'GET',\n        signal,\n        redirect: 'manual',\n        headers,\n    }).catch((err) => {\n        if (err.name === 'TimeoutError') {\n            throw new JWKSTimeout();\n        }\n        throw err;\n    });\n    if (response.status !== 200) {\n        throw new JOSEError('Expected 200 OK from the JSON Web Key Set HTTP response');\n    }\n    try {\n        return await response.json();\n    }\n    catch {\n        throw new JOSEError('Failed to parse the JSON Web Key Set HTTP response as JSON');\n    }\n}\nexport const jwksCache = Symbol();\nfunction isFreshJwksCache(input, cacheMaxAge) {\n    if (typeof input !== 'object' || input === null) {\n        return false;\n    }\n    if (!('uat' in input) || typeof input.uat !== 'number' || Date.now() - input.uat >= cacheMaxAge) {\n        return false;\n    }\n    if (!('jwks' in input) ||\n        !isObject(input.jwks) ||\n        !Array.isArray(input.jwks.keys) ||\n        !Array.prototype.every.call(input.jwks.keys, isObject)) {\n        return false;\n    }\n    return true;\n}\nclass RemoteJWKSet {\n    #url;\n    #timeoutDuration;\n    #cooldownDuration;\n    #cacheMaxAge;\n    #jwksTimestamp;\n    #pendingFetch;\n    #headers;\n    #customFetch;\n    #local;\n    #cache;\n    constructor(url, options) {\n        if (!(url instanceof URL)) {\n            throw new TypeError('url must be an instance of URL');\n        }\n        this.#url = new URL(url.href);\n        this.#timeoutDuration =\n            typeof options?.timeoutDuration === 'number' ? options?.timeoutDuration : 5000;\n        this.#cooldownDuration =\n            typeof options?.cooldownDuration === 'number' ? options?.cooldownDuration : 30000;\n        this.#cacheMaxAge = typeof options?.cacheMaxAge === 'number' ? options?.cacheMaxAge : 600000;\n        this.#headers = new Headers(options?.headers);\n        if (USER_AGENT && !this.#headers.has('User-Agent')) {\n            this.#headers.set('User-Agent', USER_AGENT);\n        }\n        if (!this.#headers.has('accept')) {\n            this.#headers.set('accept', 'application/json');\n            this.#headers.append('accept', 'application/jwk-set+json');\n        }\n        this.#customFetch = options?.[customFetch];\n        if (options?.[jwksCache] !== undefined) {\n            this.#cache = options?.[jwksCache];\n            if (isFreshJwksCache(options?.[jwksCache], this.#cacheMaxAge)) {\n                this.#jwksTimestamp = this.#cache.uat;\n                this.#local = createLocalJWKSet(this.#cache.jwks);\n            }\n        }\n    }\n    pendingFetch() {\n        return !!this.#pendingFetch;\n    }\n    coolingDown() {\n        return typeof this.#jwksTimestamp === 'number'\n            ? Date.now() < this.#jwksTimestamp + this.#cooldownDuration\n            : false;\n    }\n    fresh() {\n        return typeof this.#jwksTimestamp === 'number'\n            ? Date.now() < this.#jwksTimestamp + this.#cacheMaxAge\n            : false;\n    }\n    jwks() {\n        return this.#local?.jwks();\n    }\n    async getKey(protectedHeader, token) {\n        if (!this.#local || !this.fresh()) {\n            await this.reload();\n        }\n        try {\n            return await this.#local(protectedHeader, token);\n        }\n        catch (err) {\n            if (err instanceof JWKSNoMatchingKey) {\n                if (this.coolingDown() === false) {\n                    await this.reload();\n                    return this.#local(protectedHeader, token);\n                }\n            }\n            throw err;\n        }\n    }\n    async reload() {\n        if (this.#pendingFetch && isCloudflareWorkers()) {\n            this.#pendingFetch = undefined;\n        }\n        this.#pendingFetch ||= fetchJwks(this.#url.href, this.#headers, AbortSignal.timeout(this.#timeoutDuration), this.#customFetch)\n            .then((json) => {\n            this.#local = createLocalJWKSet(json);\n            if (this.#cache) {\n                this.#cache.uat = Date.now();\n                this.#cache.jwks = json;\n            }\n            this.#jwksTimestamp = Date.now();\n            this.#pendingFetch = undefined;\n        })\n            .catch((err) => {\n            this.#pendingFetch = undefined;\n            throw err;\n        });\n        await this.#pendingFetch;\n    }\n}\nexport function createRemoteJWKSet(url, options) {\n    const set = new RemoteJWKSet(url, options);\n    const remoteJWKSet = async (protectedHeader, token) => set.getKey(protectedHeader, token);\n    Object.defineProperties(remoteJWKSet, {\n        coolingDown: {\n            get: () => set.coolingDown(),\n            enumerable: true,\n            configurable: false,\n        },\n        fresh: {\n            get: () => set.fresh(),\n            enumerable: true,\n            configurable: false,\n        },\n        reload: {\n            value: () => set.reload(),\n            enumerable: true,\n            configurable: false,\n            writable: false,\n        },\n        reloading: {\n            get: () => set.pendingFetch(),\n            enumerable: true,\n            configurable: false,\n        },\n        jwks: {\n            value: () => set.jwks(),\n            enumerable: true,\n            configurable: false,\n            writable: false,\n        },\n    });\n    return remoteJWKSet;\n}\n","/**\n * Bearer Token Authentication Provider\n *\n * JWT token validation for APIs and authenticated services\n *\n * Features:\n * - Cryptographic JWT signature verification using jose\n * - Support for HMAC (HS256/384/512) and RSA (RS256/384/512) algorithms\n * - Issuer/audience verification\n * - Expiration checking\n * - Custom claims extraction\n * - JWKS (JSON Web Key Set) support for key rotation\n *\n * @see https://jwt.io\n * @see https://github.com/panva/jose\n */\n\nimport * as jose from 'jose'\nimport type { AuthValidator, AuthValidationResult, AuthContext, TokenPayload } from '../types.js'\nimport type { ConductorEnv } from '../../types/env.js'\n\n/**\n * Bearer token configuration\n */\nexport interface BearerConfig {\n  /** JWT secret for HMAC algorithms (HS256, HS384, HS512) */\n  secret?: string\n\n  /** JWKS URL for RSA/EC algorithms - enables automatic key rotation */\n  jwksUrl?: string\n\n  /** Expected issuer (validates 'iss' claim) */\n  issuer?: string\n\n  /** Expected audience (validates 'aud' claim) */\n  audience?: string\n\n  /** Allowed algorithms (defaults to ['HS256', 'RS256']) */\n  algorithms?: jose.JWTVerifyOptions['algorithms']\n\n  /** Custom token decoder (if not using standard JWT) */\n  customDecoder?: (token: string) => Promise<TokenPayload>\n}\n\n// Cache JWKS for performance (refreshed automatically by jose)\nconst jwksCache = new Map<string, ReturnType<typeof jose.createRemoteJWKSet>>()\n\n/**\n * Bearer Token Validator\n */\nexport class BearerValidator implements AuthValidator {\n  constructor(private config: BearerConfig = {}) {}\n\n  /**\n   * Extract bearer token from Authorization header\n   */\n  extractToken(request: Request): string | null {\n    const authHeader = request.headers.get('Authorization')\n    if (!authHeader?.startsWith('Bearer ')) {\n      return null\n    }\n    return authHeader.substring(7)\n  }\n\n  /**\n   * Get JWKS key resolver for RSA/EC algorithms\n   */\n  private getJWKS(): ReturnType<typeof jose.createRemoteJWKSet> | null {\n    if (!this.config.jwksUrl) {\n      return null\n    }\n\n    // Use cached JWKS or create new one\n    let jwks = jwksCache.get(this.config.jwksUrl)\n    if (!jwks) {\n      jwks = jose.createRemoteJWKSet(new URL(this.config.jwksUrl))\n      jwksCache.set(this.config.jwksUrl, jwks)\n    }\n    return jwks\n  }\n\n  /**\n   * Get HMAC secret key for HS256/384/512 algorithms\n   */\n  private getSecretKey(): Uint8Array | null {\n    if (!this.config.secret) {\n      return null\n    }\n    return new TextEncoder().encode(this.config.secret)\n  }\n\n  /**\n   * Verify JWT token with cryptographic signature verification\n   *\n   * Uses the jose library to properly verify:\n   * 1. Signature integrity (HMAC or RSA/EC)\n   * 2. Expiration time (exp claim)\n   * 3. Not-before time (nbf claim)\n   * 4. Issuer (iss claim) if configured\n   * 5. Audience (aud claim) if configured\n   */\n  private async verifyToken(token: string): Promise<TokenPayload | null> {\n    // If custom decoder provided, use it\n    if (this.config.customDecoder) {\n      try {\n        return await this.config.customDecoder(token)\n      } catch {\n        return null\n      }\n    }\n\n    try {\n      // Build verification options\n      const options: jose.JWTVerifyOptions = {}\n\n      if (this.config.issuer) {\n        options.issuer = this.config.issuer\n      }\n\n      if (this.config.audience) {\n        options.audience = this.config.audience\n      }\n\n      if (this.config.algorithms) {\n        options.algorithms = this.config.algorithms\n      }\n\n      // Try JWKS first (for RSA/EC), then fall back to secret (for HMAC)\n      const jwks = this.getJWKS()\n      if (jwks) {\n        const { payload } = await jose.jwtVerify(token, jwks, options)\n        return payload as TokenPayload\n      }\n\n      const secretKey = this.getSecretKey()\n      if (secretKey) {\n        const { payload } = await jose.jwtVerify(token, secretKey, options)\n        return payload as TokenPayload\n      }\n\n      throw new Error('No JWT secret or JWKS URL configured')\n    } catch (error) {\n      // Log verification failures for debugging (but don't expose details to caller)\n      if (error instanceof jose.errors.JWTExpired) {\n        // Token expired - expected failure, no need to log\n      } else if (error instanceof jose.errors.JWTClaimValidationFailed) {\n        // Claim validation failed (issuer, audience, etc.)\n      } else if (error instanceof jose.errors.JWSSignatureVerificationFailed) {\n        // Signature invalid - potential attack, could log this\n      }\n      return null\n    }\n  }\n\n  /**\n   * Validate bearer token\n   */\n  async validate(request: Request, _env: ConductorEnv): Promise<AuthValidationResult> {\n    const token = this.extractToken(request)\n\n    // No token provided\n    if (!token) {\n      return {\n        valid: false,\n        error: 'invalid_token',\n        message: 'No bearer token provided',\n      }\n    }\n\n    // Verify token\n    const payload = await this.verifyToken(token)\n    if (!payload) {\n      return {\n        valid: false,\n        error: 'invalid_token',\n        message: 'Invalid or expired bearer token',\n      }\n    }\n\n    // Build auth context\n    const context: AuthContext = {\n      authenticated: true,\n      method: 'bearer',\n      token,\n      user: {\n        id: payload.sub,\n        email: payload.email,\n        roles: payload.roles || [],\n        permissions: payload.permissions || [],\n        metadata: {},\n      },\n      expiresAt: payload.exp,\n    }\n\n    // Add custom claims to metadata\n    const standardClaims = ['sub', 'email', 'roles', 'permissions', 'exp', 'iat', 'iss', 'aud']\n    for (const [key, value] of Object.entries(payload)) {\n      if (!standardClaims.includes(key)) {\n        context.user!.metadata![key] = value\n      }\n    }\n\n    return {\n      valid: true,\n      context,\n    }\n  }\n}\n\n/**\n * Create Bearer validator from environment\n *\n * Environment variables:\n * - JWT_SECRET: HMAC secret for HS256/384/512 algorithms\n * - JWT_JWKS_URL: URL to JWKS endpoint for RSA/EC algorithms (supports key rotation)\n * - JWT_ISSUER: Expected issuer claim\n * - JWT_AUDIENCE: Expected audience claim\n * - JWT_ALGORITHMS: Comma-separated list of allowed algorithms\n */\nexport function createBearerValidator(env: ConductorEnv): BearerValidator | null {\n  // JWT secret or JWKS URL must be present\n  if (!env.JWT_SECRET && !env.JWT_JWKS_URL) {\n    return null\n  }\n\n  return new BearerValidator({\n    secret: env.JWT_SECRET,\n    jwksUrl: env.JWT_JWKS_URL,\n    issuer: env.JWT_ISSUER,\n    audience: env.JWT_AUDIENCE,\n    algorithms: env.JWT_ALGORITHMS\n      ? (env.JWT_ALGORITHMS.split(',') as jose.JWTVerifyOptions['algorithms'])\n      : undefined,\n  })\n}\n","/**\n * API Key Authentication Provider\n *\n * API key validation using KV storage\n *\n * Features:\n * - Multiple key sources (header, cookie)\n * - KV-based key storage\n * - Key prefix validation\n * - Metadata extraction\n * - Expiration checking\n *\n * SECURITY NOTE: Query parameter API keys are discouraged because they:\n * - Appear in server access logs\n * - Are stored in browser history\n * - Can leak via referer headers\n * - May be cached by proxies\n *\n * @see https://developers.cloudflare.com/kv\n */\n\nimport type { AuthValidator, AuthValidationResult, AuthContext, ApiKeyMetadata } from '../types.js'\nimport type { ConductorEnv } from '../../types/env.js'\nimport { createLogger } from '../../observability/index.js'\n\nconst logger = createLogger({ serviceName: 'auth-apikey' })\n\n/**\n * API Key configuration\n */\nexport interface ApiKeyConfig {\n  /** KV namespace binding name */\n  kvNamespace: string\n\n  /**\n   * Key sources to check (default: ['header'] for security)\n   *\n   * SECURITY WARNING: 'query' is strongly discouraged because API keys in URLs:\n   * - Appear in server access logs\n   * - Are stored in browser history\n   * - Can leak via Referer headers\n   * - May be cached by proxies/CDNs\n   *\n   * Only use 'query' if you understand the risks and have a specific need.\n   */\n  sources?: ('header' | 'query' | 'cookie')[]\n\n  /** Header name for API key (default: 'X-API-Key') */\n  headerName?: string\n\n  /**\n   * Query parameter name for API key (default: 'api_key')\n   * @deprecated Use header-based auth instead for security\n   */\n  queryName?: string\n\n  /** Cookie name for API key (default: 'api_key') */\n  cookieName?: string\n\n  /** Expected key prefix (e.g., 'myapp_') */\n  prefix?: string\n\n  /** Enable stealth mode (404 instead of 401) */\n  stealthMode?: boolean\n}\n\n/**\n * API Key Validator\n */\nexport class ApiKeyValidator implements AuthValidator {\n  constructor(private config: ApiKeyConfig) {}\n\n  /**\n   * Extract API key from request\n   *\n   * Checks sources in order of preference: header  cookie  query\n   * Query is checked last and only if explicitly enabled (security risk)\n   */\n  extractToken(request: Request): string | null {\n    // Default to header-only for security (no query params)\n    const sources = this.config.sources || ['header']\n    const headerName = this.config.headerName || 'X-API-Key'\n    const queryName = this.config.queryName || 'api_key'\n    const cookieName = this.config.cookieName || 'api_key'\n\n    // Try header first (most secure)\n    if (sources.includes('header')) {\n      const headerValue = request.headers.get(headerName)\n      if (headerValue) return headerValue\n    }\n\n    // Try cookie (reasonably secure with httpOnly)\n    if (sources.includes('cookie')) {\n      const cookieHeader = request.headers.get('Cookie')\n      if (cookieHeader) {\n        const cookies = cookieHeader.split(';').map((c) => c.trim())\n        for (const cookie of cookies) {\n          const [name, value] = cookie.split('=')\n          if (name === cookieName && value) {\n            return decodeURIComponent(value)\n          }\n        }\n      }\n    }\n\n    // Try query last (security risk - only if explicitly enabled)\n    if (sources.includes('query')) {\n      const url = new URL(request.url)\n      const queryValue = url.searchParams.get(queryName)\n      if (queryValue) {\n        // Log a warning - API keys in URLs are a security risk\n        logger.warn('API key extracted from query parameter - this is insecure', {\n          source: 'query',\n          warning: 'URLs appear in logs, browser history, and Referer headers',\n        })\n        return queryValue\n      }\n    }\n\n    return null\n  }\n\n  /**\n   * Validate key format\n   */\n  private isValidFormat(apiKey: string): boolean {\n    if (!apiKey) return false\n\n    // Check prefix if configured\n    if (this.config.prefix && !apiKey.startsWith(this.config.prefix)) {\n      return false\n    }\n\n    // Basic format validation (non-empty, reasonable length)\n    return apiKey.length >= 8 && apiKey.length <= 256\n  }\n\n  /**\n   * Validate API key\n   */\n  async validate(request: Request, env: ConductorEnv): Promise<AuthValidationResult> {\n    const apiKey = this.extractToken(request)\n\n    // No API key provided\n    if (!apiKey) {\n      return {\n        valid: false,\n        error: 'invalid_token',\n        message: 'No API key provided',\n      }\n    }\n\n    // Invalid format\n    if (!this.isValidFormat(apiKey)) {\n      return {\n        valid: false,\n        error: 'invalid_token',\n        message: 'Invalid API key format',\n      }\n    }\n\n    // Get KV namespace\n    const kv = env[this.config.kvNamespace]\n    if (!kv) {\n      logger.error(`KV namespace \"${this.config.kvNamespace}\" not found in env`, undefined, {\n        kvNamespace: this.config.kvNamespace,\n      })\n      return {\n        valid: false,\n        error: 'unknown',\n        message: 'Authentication service error',\n      }\n    }\n\n    // Look up key in KV\n    try {\n      const metadataJson = await kv.get(apiKey)\n      if (!metadataJson) {\n        return {\n          valid: false,\n          error: 'invalid_token',\n          message: 'Invalid API key',\n        }\n      }\n\n      const metadata: ApiKeyMetadata = JSON.parse(metadataJson)\n\n      // Check expiration\n      if (metadata.expiresAt && Date.now() > metadata.expiresAt) {\n        return {\n          valid: false,\n          error: 'expired',\n          message: 'API key has expired',\n        }\n      }\n\n      // Build auth context\n      const context: AuthContext = {\n        authenticated: true,\n        method: 'apiKey',\n        token: apiKey,\n        user: {\n          id: metadata.userId || metadata.keyId,\n          permissions: metadata.permissions || [],\n          roles: [],\n          metadata: {\n            ...metadata.metadata,\n            keyId: metadata.keyId,\n            keyName: metadata.name,\n          },\n        },\n        expiresAt: metadata.expiresAt,\n      }\n\n      return {\n        valid: true,\n        context,\n        ratelimit: metadata.rateLimit\n          ? {\n              limit: metadata.rateLimit.requests,\n              remaining: metadata.rateLimit.requests, // TODO: Implement actual rate limiting\n              reset: Math.floor(Date.now() / 1000) + metadata.rateLimit.window,\n            }\n          : undefined,\n      }\n    } catch (error) {\n      logger.error('API key validation error', error instanceof Error ? error : undefined)\n      return {\n        valid: false,\n        error: 'unknown',\n        message: 'Authentication validation failed',\n      }\n    }\n  }\n}\n\n/**\n * Create API Key validator from environment\n *\n * Environment variables:\n * - API_KEY_KV_NAMESPACE: KV binding name (default: 'API_KEYS')\n * - API_KEY_SOURCES: Comma-separated sources (default: 'header')\n *   WARNING: Including 'query' is a security risk\n * - API_KEY_HEADER_NAME: Custom header name (default: 'X-API-Key')\n * - API_KEY_COOKIE_NAME: Custom cookie name (default: 'api_key')\n * - API_KEY_PREFIX: Required key prefix\n * - API_KEY_STEALTH_MODE: Return 404 instead of 401 (default: false)\n */\nexport function createApiKeyValidator(env: ConductorEnv): ApiKeyValidator | null {\n  // KV namespace must be configured\n  const kvNamespace = env.API_KEY_KV_NAMESPACE || 'API_KEYS'\n\n  // Check if KV namespace exists\n  if (!env[kvNamespace]) {\n    return null\n  }\n\n  // Parse sources - default to header-only for security\n  let sources: ('header' | 'query' | 'cookie')[] = ['header']\n  if (env.API_KEY_SOURCES) {\n    sources = env.API_KEY_SOURCES.split(',').map((s: string) => s.trim()) as (\n      | 'header'\n      | 'query'\n      | 'cookie'\n    )[]\n\n    // Warn if query is enabled\n    if (sources.includes('query')) {\n      logger.warn('API_KEY_SOURCES includes \"query\" - this is insecure', {\n        warning: 'API keys in URLs appear in logs, browser history, and Referer headers',\n      })\n    }\n  }\n\n  return new ApiKeyValidator({\n    kvNamespace,\n    sources,\n    headerName: env.API_KEY_HEADER_NAME || 'X-API-Key',\n    queryName: env.API_KEY_QUERY_NAME || 'api_key',\n    cookieName: env.API_KEY_COOKIE_NAME || 'api_key',\n    prefix: env.API_KEY_PREFIX,\n    stealthMode: env.API_KEY_STEALTH_MODE === 'true',\n  })\n}\n","/**\n * Cookie Session Authentication Provider\n *\n * Session-based authentication using cookies and KV storage\n *\n * Features:\n * - Session management with KV\n * - Secure cookie handling\n * - Session expiration\n * - CSRF protection\n * - Remember me support\n *\n * @see https://developers.cloudflare.com/kv\n */\n\nimport type { AuthValidator, AuthValidationResult, AuthContext, SessionData } from '../types.js'\nimport type { ConductorEnv } from '../../types/env.js'\nimport { createLogger } from '../../observability/index.js'\n\nconst logger = createLogger({ serviceName: 'auth-cookie' })\n\n/**\n * Cookie session configuration\n */\nexport interface CookieConfig {\n  /** KV namespace binding name for sessions */\n  kvNamespace: string\n\n  /** Cookie name */\n  cookieName?: string\n\n  /** Cookie domain */\n  domain?: string\n\n  /** Cookie path */\n  path?: string\n\n  /** Secure flag (https only) */\n  secure?: boolean\n\n  /** HttpOnly flag */\n  httpOnly?: boolean\n\n  /** SameSite policy */\n  sameSite?: 'strict' | 'lax' | 'none'\n\n  /** Session TTL in seconds */\n  sessionTTL?: number\n}\n\n/**\n * Cookie Session Validator\n */\nexport class CookieValidator implements AuthValidator {\n  constructor(private config: CookieConfig) {}\n\n  /**\n   * Extract session token from cookie\n   */\n  extractToken(request: Request): string | null {\n    const cookieName = this.config.cookieName || 'session_token'\n    const cookieHeader = request.headers.get('Cookie')\n\n    if (!cookieHeader) {\n      return null\n    }\n\n    // Parse cookies\n    const cookies = cookieHeader.split(';').map((c) => c.trim())\n    for (const cookie of cookies) {\n      const [name, value] = cookie.split('=')\n      if (name === cookieName && value) {\n        return decodeURIComponent(value)\n      }\n    }\n\n    return null\n  }\n\n  /**\n   * Validate session token format\n   */\n  private isValidFormat(token: string): boolean {\n    // Session tokens should be long random strings (UUIDs, etc.)\n    return Boolean(token && token.length >= 16 && token.length <= 512)\n  }\n\n  /**\n   * Validate cookie session\n   */\n  async validate(request: Request, env: ConductorEnv): Promise<AuthValidationResult> {\n    const sessionToken = this.extractToken(request)\n\n    // No session token provided\n    if (!sessionToken) {\n      return {\n        valid: false,\n        error: 'invalid_token',\n        message: 'No session token provided',\n      }\n    }\n\n    // Invalid format\n    if (!this.isValidFormat(sessionToken)) {\n      return {\n        valid: false,\n        error: 'invalid_token',\n        message: 'Invalid session token format',\n      }\n    }\n\n    // Get KV namespace\n    const kv = env[this.config.kvNamespace]\n    if (!kv) {\n      logger.error(`KV namespace \"${this.config.kvNamespace}\" not found in env`)\n      return {\n        valid: false,\n        error: 'unknown',\n        message: 'Authentication service error',\n      }\n    }\n\n    // Look up session in KV\n    try {\n      const sessionJson = await kv.get(`session:${sessionToken}`)\n      if (!sessionJson) {\n        return {\n          valid: false,\n          error: 'invalid_token',\n          message: 'Invalid or expired session',\n        }\n      }\n\n      const session: SessionData = JSON.parse(sessionJson)\n\n      // Check expiration\n      if (session.expiresAt && Date.now() > session.expiresAt) {\n        // Delete expired session\n        await kv.delete(`session:${sessionToken}`)\n        return {\n          valid: false,\n          error: 'expired',\n          message: 'Session has expired',\n        }\n      }\n\n      // Build auth context\n      const context: AuthContext = {\n        authenticated: true,\n        method: 'cookie',\n        token: sessionToken,\n        user: {\n          id: session.userId,\n          email: session.email,\n          roles: session.roles || [],\n          permissions: session.permissions || [],\n          metadata: {\n            ...session.metadata,\n            sessionId: session.sessionId,\n            sessionCreated: session.createdAt,\n          },\n        },\n        expiresAt: session.expiresAt,\n      }\n\n      return {\n        valid: true,\n        context,\n      }\n    } catch (error) {\n      logger.error('Cookie session validation error', error as Error)\n      return {\n        valid: false,\n        error: 'unknown',\n        message: 'Authentication validation failed',\n      }\n    }\n  }\n\n  /**\n   * Create session cookie header\n   */\n  createCookie(sessionToken: string, options?: { maxAge?: number; expires?: Date }): string {\n    const cookieName = this.config.cookieName || 'session_token'\n    const parts: string[] = [`${cookieName}=${encodeURIComponent(sessionToken)}`]\n\n    if (this.config.domain) {\n      parts.push(`Domain=${this.config.domain}`)\n    }\n\n    if (this.config.path || this.config.path === '') {\n      parts.push(`Path=${this.config.path}`)\n    } else {\n      parts.push('Path=/')\n    }\n\n    if (options?.maxAge !== undefined) {\n      parts.push(`Max-Age=${options.maxAge}`)\n    } else if (options?.expires) {\n      parts.push(`Expires=${options.expires.toUTCString()}`)\n    }\n\n    if (this.config.secure !== false) {\n      parts.push('Secure')\n    }\n\n    if (this.config.httpOnly !== false) {\n      parts.push('HttpOnly')\n    }\n\n    const sameSite = this.config.sameSite || 'lax'\n    parts.push(`SameSite=${sameSite.charAt(0).toUpperCase() + sameSite.slice(1)}`)\n\n    return parts.join('; ')\n  }\n\n  /**\n   * Create session in KV\n   */\n  async createSession(\n    kv: KVNamespace,\n    sessionData: Omit<SessionData, 'sessionId' | 'createdAt' | 'expiresAt'> & { expiresAt?: number }\n  ): Promise<string> {\n    // Generate session token\n    const sessionToken = crypto.randomUUID()\n    const sessionId = crypto.randomUUID()\n\n    const now = Date.now()\n    const ttl = this.config.sessionTTL || 86400 // 24 hours default\n    const expiresAt = sessionData.expiresAt || now + ttl * 1000\n\n    const session: SessionData = {\n      ...sessionData,\n      sessionId,\n      createdAt: now,\n      expiresAt,\n    }\n\n    // Store in KV with TTL\n    await kv.put(`session:${sessionToken}`, JSON.stringify(session), { expirationTtl: ttl })\n\n    return sessionToken\n  }\n\n  /**\n   * Delete session from KV\n   */\n  async deleteSession(kv: KVNamespace, sessionToken: string): Promise<void> {\n    await kv.delete(`session:${sessionToken}`)\n  }\n}\n\n/**\n * Create Cookie validator from environment\n */\nexport function createCookieValidator(env: ConductorEnv): CookieValidator | null {\n  // KV namespace must be configured\n  const kvNamespace = env.SESSION_KV_NAMESPACE || 'SESSIONS'\n\n  // Check if KV namespace exists\n  if (!env[kvNamespace]) {\n    return null\n  }\n\n  return new CookieValidator({\n    kvNamespace,\n    cookieName: env.SESSION_COOKIE_NAME || 'session_token',\n    domain: env.SESSION_COOKIE_DOMAIN,\n    path: env.SESSION_COOKIE_PATH || '/',\n    secure: env.SESSION_COOKIE_SECURE !== 'false',\n    httpOnly: env.SESSION_COOKIE_HTTP_ONLY !== 'false',\n    sameSite: (env.SESSION_COOKIE_SAME_SITE as 'strict' | 'lax' | 'none') || 'lax',\n    sessionTTL: env.SESSION_TTL ? parseInt(env.SESSION_TTL) : 86400,\n  })\n}\n","/**\n * Unkey Authentication Provider\n *\n * Integration with Unkey.dev for API key management\n * Similar to Twilio integration for SMS\n *\n * Features:\n * - API key validation\n * - Rate limiting\n * - Service account detection\n * - Permission management\n * - Owner/tenant isolation\n *\n * @see https://unkey.dev\n */\n\nimport type { AuthValidator, AuthValidationResult, AuthContext } from '../types.js'\nimport type { ConductorEnv } from '../../types/env.js'\nimport { createLogger } from '../../observability/index.js'\n\nconst logger = createLogger({ serviceName: 'auth-unkey' })\n\n/**\n * Unkey configuration\n */\nexport interface UnkeyConfig {\n  /** Unkey root key (from env.UNKEY_ROOT_KEY) */\n  rootKey: string\n\n  /** Unkey API ID (from env.UNKEY_API_ID) */\n  apiId?: string\n\n  /** API key prefix (e.g., 'ownerco_', 'oiq_') */\n  keyPrefix?: string[]\n\n  /** Enable stealth mode (404 instead of 401) */\n  stealthMode?: boolean\n}\n\n/**\n * Unkey API response\n */\ninterface UnkeyVerifyResponse {\n  valid: boolean\n  keyId?: string\n  ownerId?: string\n  meta?: Record<string, any>\n  permissions?: string[]\n  ratelimit?: {\n    remaining: number\n    limit: number\n    reset: number\n  }\n  code?: string\n  error?: string\n}\n\n/**\n * Unkey Auth Validator\n */\nexport class UnkeyValidator implements AuthValidator {\n  constructor(private config: UnkeyConfig) {}\n\n  /**\n   * Extract API key from request\n   * Checks multiple locations: X-API-Key header, Authorization header, query param\n   */\n  extractToken(request: Request): string | null {\n    // Check X-API-Key header (most common)\n    const apiKeyHeader = request.headers.get('X-API-Key')\n    if (apiKeyHeader) {\n      return apiKeyHeader\n    }\n\n    // Check Authorization header (Bearer token style)\n    const authHeader = request.headers.get('Authorization')\n    if (authHeader?.startsWith('Bearer ')) {\n      return authHeader.substring(7)\n    }\n\n    // Check query parameter\n    const url = new URL(request.url)\n    const apiKeyQuery = url.searchParams.get('api_key')\n    if (apiKeyQuery) {\n      return apiKeyQuery\n    }\n\n    return null\n  }\n\n  /**\n   * Validate API key format\n   */\n  private isValidKeyFormat(apiKey: string): boolean {\n    if (!apiKey) return false\n\n    // If prefixes configured, check for match\n    if (this.config.keyPrefix && this.config.keyPrefix.length > 0) {\n      return this.config.keyPrefix.some((prefix) => apiKey.startsWith(prefix))\n    }\n\n    // Default: any non-empty string\n    return true\n  }\n\n  /**\n   * Check if key is a service account\n   */\n  private isServiceAccount(apiKey: string): boolean {\n    return Boolean(apiKey && apiKey.includes('_service'))\n  }\n\n  /**\n   * Validate with Unkey API\n   */\n  async validate(request: Request, env: ConductorEnv): Promise<AuthValidationResult> {\n    const apiKey = this.extractToken(request)\n\n    // No API key provided\n    if (!apiKey) {\n      return {\n        valid: false,\n        error: 'invalid_token',\n        message: 'No API key provided',\n      }\n    }\n\n    // Invalid format\n    if (!this.isValidKeyFormat(apiKey)) {\n      return {\n        valid: false,\n        error: 'invalid_token',\n        message: 'Invalid API key format',\n      }\n    }\n\n    // Call Unkey verification endpoint\n    try {\n      const response = await fetch('https://api.unkey.dev/v1/keys.verifyKey', {\n        method: 'POST',\n        headers: {\n          Authorization: `Bearer ${this.config.rootKey}`,\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          ...(this.config.apiId && { apiId: this.config.apiId }),\n          key: apiKey,\n        }),\n      })\n\n      if (!response.ok) {\n        logger.error('Unkey API error', undefined, {\n          status: response.status,\n          statusText: response.statusText,\n        })\n        return {\n          valid: false,\n          error: 'unknown',\n          message: 'Authentication service error',\n        }\n      }\n\n      const result: UnkeyVerifyResponse = await response.json()\n\n      // Check if key is valid\n      if (!result.valid) {\n        // Rate limited\n        if (\n          result.code === 'RATE_LIMITED' ||\n          (result.ratelimit && result.ratelimit.remaining <= 0)\n        ) {\n          return {\n            valid: false,\n            error: 'rate_limited',\n            message: 'Rate limit exceeded',\n            ratelimit: result.ratelimit,\n          }\n        }\n\n        // Invalid key\n        return {\n          valid: false,\n          error: 'invalid_token',\n          message: 'Invalid API key',\n        }\n      }\n\n      // Build auth context\n      const context: AuthContext = {\n        authenticated: true,\n        method: 'unkey',\n        token: apiKey,\n        user: {\n          id: result.ownerId || 'unknown',\n          permissions: result.permissions || [],\n          metadata: result.meta || {},\n        },\n        unkey: {\n          keyId: result.keyId!,\n          ownerId: result.ownerId,\n          isServiceAccount: this.isServiceAccount(apiKey),\n          ratelimit: result.ratelimit,\n        },\n      }\n\n      return {\n        valid: true,\n        context,\n        ratelimit: result.ratelimit,\n      }\n    } catch (error) {\n      logger.error('Unkey validation error', error as Error)\n      return {\n        valid: false,\n        error: 'unknown',\n        message: 'Authentication validation failed',\n      }\n    }\n  }\n}\n\n/**\n * Create Unkey validator from environment\n */\nexport function createUnkeyValidator(env: ConductorEnv): UnkeyValidator | null {\n  if (!env.UNKEY_ROOT_KEY) {\n    return null\n  }\n\n  return new UnkeyValidator({\n    rootKey: env.UNKEY_ROOT_KEY,\n    apiId: env.UNKEY_API_ID,\n    keyPrefix: env.UNKEY_KEY_PREFIX ? env.UNKEY_KEY_PREFIX.split(',') : ['ownerco_', 'oiq_'],\n    stealthMode: env.UNKEY_STEALTH_MODE === 'true',\n  })\n}\n","/**\n * Custom Authentication Validators\n *\n * Custom validators for webhook signature verification and other use cases\n *\n * Includes:\n * - Stripe webhook signature validation\n * - GitHub webhook signature validation\n * - Twilio webhook signature validation\n * - Custom validator interface\n */\n\nimport type { AuthValidator, AuthValidationResult, AuthContext } from '../types.js'\nimport type { ConductorEnv } from '../../types/env.js'\nimport { createLogger } from '../../observability/index.js'\n\nconst logger = createLogger({ serviceName: 'auth-custom' })\n\n/**\n * Stripe Webhook Signature Validator\n */\nexport class StripeSignatureValidator implements AuthValidator {\n  constructor(private webhookSecret: string) {}\n\n  extractToken(request: Request): string | null {\n    return request.headers.get('stripe-signature')\n  }\n\n  async validate(request: Request, _env: ConductorEnv): Promise<AuthValidationResult> {\n    const signature = this.extractToken(request)\n    if (!signature) {\n      return {\n        valid: false,\n        error: 'invalid_token',\n        message: 'Missing Stripe signature',\n      }\n    }\n\n    const body = await request.text()\n    const isValid = await this.verifyStripeSignature(body, signature)\n\n    if (!isValid) {\n      return {\n        valid: false,\n        error: 'invalid_token',\n        message: 'Invalid Stripe signature',\n      }\n    }\n\n    return {\n      valid: true,\n      context: {\n        authenticated: true,\n        method: 'custom',\n        custom: {\n          provider: 'stripe',\n          signature,\n        },\n      },\n    }\n  }\n\n  private async verifyStripeSignature(payload: string, signature: string): Promise<boolean> {\n    try {\n      // Parse signature header\n      const elements = signature.split(',')\n      const signatureData: Record<string, string> = {}\n\n      for (const element of elements) {\n        const [key, value] = element.split('=')\n        signatureData[key] = value\n      }\n\n      const timestamp = signatureData['t']\n      const signatures = [signatureData['v1']]\n\n      if (!timestamp || !signatures[0]) {\n        return false\n      }\n\n      // Check timestamp (prevent replay attacks)\n      const timestampAge = Math.floor(Date.now() / 1000) - parseInt(timestamp)\n      if (timestampAge > 300) {\n        // 5 minutes\n        return false\n      }\n\n      // Compute expected signature\n      const signedPayload = `${timestamp}.${payload}`\n      const expectedSignature = await this.computeHMAC(signedPayload, this.webhookSecret)\n\n      // Compare signatures\n      return signatures.some((sig) => this.secureCompare(sig, expectedSignature))\n    } catch (error) {\n      logger.error(\n        'Stripe signature verification error',\n        error instanceof Error ? error : undefined\n      )\n      return false\n    }\n  }\n\n  private async computeHMAC(data: string, secret: string): Promise<string> {\n    const encoder = new TextEncoder()\n    const keyData = encoder.encode(secret)\n    const messageData = encoder.encode(data)\n\n    const key = await crypto.subtle.importKey(\n      'raw',\n      keyData,\n      { name: 'HMAC', hash: 'SHA-256' },\n      false,\n      ['sign']\n    )\n\n    const signature = await crypto.subtle.sign('HMAC', key, messageData)\n    return Array.from(new Uint8Array(signature))\n      .map((b) => b.toString(16).padStart(2, '0'))\n      .join('')\n  }\n\n  private secureCompare(a: string, b: string): boolean {\n    if (a.length !== b.length) return false\n\n    let result = 0\n    for (let i = 0; i < a.length; i++) {\n      result |= a.charCodeAt(i) ^ b.charCodeAt(i)\n    }\n    return result === 0\n  }\n}\n\n/**\n * GitHub Webhook Signature Validator\n */\nexport class GitHubSignatureValidator implements AuthValidator {\n  constructor(private webhookSecret: string) {}\n\n  extractToken(request: Request): string | null {\n    return request.headers.get('x-hub-signature-256')\n  }\n\n  async validate(request: Request, _env: ConductorEnv): Promise<AuthValidationResult> {\n    const signature = this.extractToken(request)\n    if (!signature) {\n      return {\n        valid: false,\n        error: 'invalid_token',\n        message: 'Missing GitHub signature',\n      }\n    }\n\n    const body = await request.text()\n    const isValid = await this.verifyGitHubSignature(body, signature)\n\n    if (!isValid) {\n      return {\n        valid: false,\n        error: 'invalid_token',\n        message: 'Invalid GitHub signature',\n      }\n    }\n\n    return {\n      valid: true,\n      context: {\n        authenticated: true,\n        method: 'custom',\n        custom: {\n          provider: 'github',\n          signature,\n        },\n      },\n    }\n  }\n\n  private async verifyGitHubSignature(payload: string, signature: string): Promise<boolean> {\n    try {\n      // GitHub signature format: sha256=<hex>\n      if (!signature.startsWith('sha256=')) {\n        return false\n      }\n\n      const receivedSignature = signature.substring(7)\n      const expectedSignature = await this.computeHMAC(payload, this.webhookSecret)\n\n      return this.secureCompare(receivedSignature, expectedSignature)\n    } catch (error) {\n      logger.error(\n        'GitHub signature verification error',\n        error instanceof Error ? error : undefined\n      )\n      return false\n    }\n  }\n\n  private async computeHMAC(data: string, secret: string): Promise<string> {\n    const encoder = new TextEncoder()\n    const keyData = encoder.encode(secret)\n    const messageData = encoder.encode(data)\n\n    const key = await crypto.subtle.importKey(\n      'raw',\n      keyData,\n      { name: 'HMAC', hash: 'SHA-256' },\n      false,\n      ['sign']\n    )\n\n    const signature = await crypto.subtle.sign('HMAC', key, messageData)\n    return Array.from(new Uint8Array(signature))\n      .map((b) => b.toString(16).padStart(2, '0'))\n      .join('')\n  }\n\n  private secureCompare(a: string, b: string): boolean {\n    if (a.length !== b.length) return false\n\n    let result = 0\n    for (let i = 0; i < a.length; i++) {\n      result |= a.charCodeAt(i) ^ b.charCodeAt(i)\n    }\n    return result === 0\n  }\n}\n\n/**\n * Twilio Webhook Signature Validator\n */\nexport class TwilioSignatureValidator implements AuthValidator {\n  constructor(private authToken: string) {}\n\n  extractToken(request: Request): string | null {\n    return request.headers.get('x-twilio-signature')\n  }\n\n  async validate(request: Request, _env: ConductorEnv): Promise<AuthValidationResult> {\n    const signature = this.extractToken(request)\n    if (!signature) {\n      return {\n        valid: false,\n        error: 'invalid_token',\n        message: 'Missing Twilio signature',\n      }\n    }\n\n    const url = request.url\n    const body = await request.text()\n    const isValid = await this.verifyTwilioSignature(url, body, signature)\n\n    if (!isValid) {\n      return {\n        valid: false,\n        error: 'invalid_token',\n        message: 'Invalid Twilio signature',\n      }\n    }\n\n    return {\n      valid: true,\n      context: {\n        authenticated: true,\n        method: 'custom',\n        custom: {\n          provider: 'twilio',\n          signature,\n        },\n      },\n    }\n  }\n\n  private async verifyTwilioSignature(\n    url: string,\n    body: string,\n    signature: string\n  ): Promise<boolean> {\n    try {\n      // Twilio signature: base64(hmac-sha1(url + params))\n      const params = new URLSearchParams(body)\n      const sortedParams = Array.from(params.entries()).sort(([a], [b]) => a.localeCompare(b))\n\n      let data = url\n      for (const [key, value] of sortedParams) {\n        data += key + value\n      }\n\n      const expectedSignature = await this.computeHMAC(data, this.authToken)\n\n      return this.secureCompare(signature, expectedSignature)\n    } catch (error) {\n      logger.error(\n        'Twilio signature verification error',\n        error instanceof Error ? error : undefined\n      )\n      return false\n    }\n  }\n\n  private async computeHMAC(data: string, secret: string): Promise<string> {\n    const encoder = new TextEncoder()\n    const keyData = encoder.encode(secret)\n    const messageData = encoder.encode(data)\n\n    const key = await crypto.subtle.importKey(\n      'raw',\n      keyData,\n      { name: 'HMAC', hash: 'SHA-1' },\n      false,\n      ['sign']\n    )\n\n    const signature = await crypto.subtle.sign('HMAC', key, messageData)\n\n    // Convert to base64\n    const bytes = new Uint8Array(signature)\n    let binary = ''\n    for (let i = 0; i < bytes.length; i++) {\n      binary += String.fromCharCode(bytes[i])\n    }\n    return btoa(binary)\n  }\n\n  private secureCompare(a: string, b: string): boolean {\n    if (a.length !== b.length) return false\n\n    let result = 0\n    for (let i = 0; i < a.length; i++) {\n      result |= a.charCodeAt(i) ^ b.charCodeAt(i)\n    }\n    return result === 0\n  }\n}\n\n/**\n * Custom Validator Registry\n */\nexport class CustomValidatorRegistry {\n  private validators: Map<string, AuthValidator> = new Map()\n\n  /**\n   * Register a custom validator\n   */\n  register(name: string, validator: AuthValidator): void {\n    this.validators.set(name, validator)\n  }\n\n  /**\n   * Get a validator by name\n   */\n  get(name: string): AuthValidator | undefined {\n    return this.validators.get(name)\n  }\n\n  /**\n   * Check if validator exists\n   */\n  has(name: string): boolean {\n    return this.validators.has(name)\n  }\n\n  /**\n   * Register built-in validators from environment\n   */\n  registerBuiltIn(env: ConductorEnv): void {\n    // Stripe\n    if (env.STRIPE_WEBHOOK_SECRET) {\n      this.register('stripe-signature', new StripeSignatureValidator(env.STRIPE_WEBHOOK_SECRET))\n    }\n\n    // GitHub\n    if (env.GITHUB_WEBHOOK_SECRET) {\n      this.register('github-signature', new GitHubSignatureValidator(env.GITHUB_WEBHOOK_SECRET))\n    }\n\n    // Twilio\n    if (env.TWILIO_AUTH_TOKEN) {\n      this.register('twilio-signature', new TwilioSignatureValidator(env.TWILIO_AUTH_TOKEN))\n    }\n  }\n}\n\n/**\n * Create custom validator registry\n */\nexport function createCustomValidatorRegistry(env: ConductorEnv): CustomValidatorRegistry {\n  const registry = new CustomValidatorRegistry()\n  registry.registerBuiltIn(env)\n  return registry\n}\n","/**\n * Cryptographic Utilities\n *\n * Shared crypto functions for authentication providers.\n * All implementations are designed for Cloudflare Workers (Web Crypto API).\n *\n * @see https://developers.cloudflare.com/workers/runtime-apis/web-crypto/\n */\n\n/**\n * Timing-safe string comparison using HMAC\n *\n * This implementation prevents timing attacks by:\n * 1. Using HMAC to compare strings (constant-time crypto operation)\n * 2. NOT short-circuiting on length mismatch (which would leak length info)\n *\n * The naive XOR approach with early length-check is vulnerable because:\n * - Different string lengths return at different times\n * - Attackers can probe to discover the expected length\n *\n * @param a - First string to compare\n * @param b - Second string to compare\n * @returns Promise<boolean> - true if strings are equal\n */\nexport async function timingSafeEqual(a: string, b: string): Promise<boolean> {\n  const encoder = new TextEncoder()\n\n  // Use a fixed key - we're not protecting a secret here, just doing constant-time comparison\n  const key = await crypto.subtle.importKey(\n    'raw',\n    encoder.encode('timing-safe-comparison-key'),\n    { name: 'HMAC', hash: 'SHA-256' },\n    false,\n    ['sign']\n  )\n\n  // Compute HMAC of both strings\n  const [macA, macB] = await Promise.all([\n    crypto.subtle.sign('HMAC', key, encoder.encode(a)),\n    crypto.subtle.sign('HMAC', key, encoder.encode(b)),\n  ])\n\n  // Compare the MACs byte-by-byte in constant time\n  // This is safe because MACs are always the same length (32 bytes for SHA-256)\n  const viewA = new Uint8Array(macA)\n  const viewB = new Uint8Array(macB)\n\n  let result = 0\n  for (let i = 0; i < viewA.length; i++) {\n    result |= viewA[i] ^ viewB[i]\n  }\n\n  return result === 0\n}\n\n/**\n * Synchronous timing-safe comparison (legacy compatibility)\n *\n * WARNING: This version has a small timing leak on length mismatch.\n * Prefer the async version (timingSafeEqual) for security-critical comparisons.\n *\n * This is provided for backwards compatibility where async is difficult.\n * It pads shorter strings to match the longer one's length to reduce\n * (but not eliminate) the timing leak.\n *\n * @param a - First string to compare\n * @param b - Second string to compare\n * @returns boolean - true if strings are equal\n */\nexport function timingSafeEqualSync(a: string, b: string): boolean {\n  // Pad the shorter string to prevent length-based timing leak\n  const maxLen = Math.max(a.length, b.length)\n  const paddedA = a.padEnd(maxLen, '\\0')\n  const paddedB = b.padEnd(maxLen, '\\0')\n\n  // XOR all characters\n  let result = 0\n  for (let i = 0; i < maxLen; i++) {\n    result |= paddedA.charCodeAt(i) ^ paddedB.charCodeAt(i)\n  }\n\n  // Also include length comparison in constant time\n  // (Different lengths should return false even if padded comparison matches)\n  result |= a.length ^ b.length\n\n  return result === 0\n}\n\n/**\n * Compute HMAC signature using Web Crypto API\n *\n * @param message - The message to sign\n * @param secret - The secret key\n * @param algorithm - Hash algorithm (sha256, sha1, sha384, sha512)\n * @returns Promise<string> - Hex-encoded signature\n */\nexport async function computeHMAC(\n  message: string,\n  secret: string,\n  algorithm: 'sha256' | 'sha1' | 'sha384' | 'sha512' = 'sha256'\n): Promise<string> {\n  const encoder = new TextEncoder()\n  const keyData = encoder.encode(secret)\n  const messageData = encoder.encode(message)\n\n  // Map algorithm names to Web Crypto format\n  const algoMap: Record<string, string> = {\n    sha256: 'SHA-256',\n    sha1: 'SHA-1',\n    sha384: 'SHA-384',\n    sha512: 'SHA-512',\n  }\n\n  const cryptoAlgorithm = algoMap[algorithm.toLowerCase()] || 'SHA-256'\n\n  const key = await crypto.subtle.importKey(\n    'raw',\n    keyData,\n    { name: 'HMAC', hash: cryptoAlgorithm },\n    false,\n    ['sign']\n  )\n\n  const signature = await crypto.subtle.sign('HMAC', key, messageData)\n\n  // Convert to hex string\n  return Array.from(new Uint8Array(signature))\n    .map((b) => b.toString(16).padStart(2, '0'))\n    .join('')\n}\n","/**\n * HMAC Signature Authentication Provider\n *\n * Validates webhook signatures using HMAC-SHA256 (or other algorithms).\n * Commonly used for webhook integrations (GitHub, Stripe, Slack, etc.).\n *\n * Features:\n * - HMAC signature validation\n * - Timestamp-based replay protection\n * - Multiple signature header formats\n * - Configurable algorithms (sha256, sha1, etc.)\n *\n * @see https://docs.ensemble.ai/conductor/building/security-authentication\n */\n\nimport type { AuthValidator, AuthValidationResult, AuthContext } from '../types.js'\nimport type { ConductorEnv } from '../../types/env.js'\nimport { timingSafeEqual, computeHMAC } from '../utils/crypto.js'\n\n/**\n * Signature validation configuration\n */\nexport interface SignatureConfig {\n  /** Shared secret for HMAC computation */\n  secret: string\n\n  /** Hash algorithm (default: sha256) */\n  algorithm?: 'sha256' | 'sha1' | 'sha384' | 'sha512'\n\n  /** Header name for signature (default: x-webhook-signature) */\n  signatureHeader?: string\n\n  /** Header name for timestamp (default: x-webhook-timestamp) */\n  timestampHeader?: string\n\n  /** Timestamp tolerance in seconds for replay protection (default: 300 = 5 minutes) */\n  timestampTolerance?: number\n\n  /** Signature prefix (e.g., \"sha256=\" for GitHub-style) */\n  signaturePrefix?: string\n\n  /** Payload format: how to construct the payload for signing */\n  payloadFormat?: 'timestamp.body' | 'body' | 'custom'\n\n  /** Custom payload builder function */\n  customPayloadBuilder?: (timestamp: string, body: string) => string\n}\n\n/**\n * Signature Validator\n *\n * Validates HMAC signatures on incoming requests.\n * Supports various webhook signature formats (GitHub, Stripe, Slack, etc.)\n */\nexport class SignatureValidator implements AuthValidator {\n  private readonly config: {\n    secret: string\n    algorithm: 'sha256' | 'sha1' | 'sha384' | 'sha512'\n    signatureHeader: string\n    timestampHeader: string\n    timestampTolerance: number\n    signaturePrefix: string\n    payloadFormat: 'timestamp.body' | 'body' | 'custom'\n    customPayloadBuilder?: (timestamp: string, body: string) => string\n  }\n\n  constructor(config: SignatureConfig) {\n    this.config = {\n      secret: config.secret,\n      algorithm: config.algorithm || 'sha256',\n      signatureHeader: config.signatureHeader || 'x-webhook-signature',\n      timestampHeader: config.timestampHeader || 'x-webhook-timestamp',\n      timestampTolerance: config.timestampTolerance ?? 300,\n      signaturePrefix: config.signaturePrefix || '',\n      payloadFormat: config.payloadFormat || 'timestamp.body',\n      customPayloadBuilder: config.customPayloadBuilder,\n    }\n  }\n\n  /**\n   * Extract signature from request header\n   */\n  extractToken(request: Request): string | null {\n    const signature = request.headers.get(this.config.signatureHeader)\n    if (!signature) {\n      return null\n    }\n\n    // Remove prefix if present (e.g., \"sha256=\"  actual signature)\n    if (this.config.signaturePrefix && signature.startsWith(this.config.signaturePrefix)) {\n      return signature.substring(this.config.signaturePrefix.length)\n    }\n\n    return signature\n  }\n\n  /**\n   * Validate the webhook signature\n   */\n  async validate(request: Request, _env: ConductorEnv): Promise<AuthValidationResult> {\n    const signature = this.extractToken(request)\n    const timestamp = request.headers.get(this.config.timestampHeader)\n\n    // Check for required headers\n    if (!signature) {\n      return {\n        valid: false,\n        error: 'invalid_token',\n        message: `Missing signature header: ${this.config.signatureHeader}`,\n      }\n    }\n\n    // Timestamp validation (replay protection)\n    if (this.config.timestampTolerance > 0) {\n      if (!timestamp) {\n        return {\n          valid: false,\n          error: 'invalid_token',\n          message: `Missing timestamp header: ${this.config.timestampHeader}`,\n        }\n      }\n\n      const now = Math.floor(Date.now() / 1000)\n      const requestTime = parseInt(timestamp, 10)\n\n      if (isNaN(requestTime)) {\n        return {\n          valid: false,\n          error: 'invalid_token',\n          message: 'Invalid timestamp format',\n        }\n      }\n\n      if (Math.abs(now - requestTime) > this.config.timestampTolerance) {\n        return {\n          valid: false,\n          error: 'expired',\n          message: `Timestamp outside tolerance window (${this.config.timestampTolerance}s)`,\n        }\n      }\n    }\n\n    // Get request body\n    const body = await request.clone().text()\n\n    // Build payload for signature verification\n    let payload: string\n    switch (this.config.payloadFormat) {\n      case 'timestamp.body':\n        payload = `${timestamp || ''}.${body}`\n        break\n      case 'body':\n        payload = body\n        break\n      case 'custom':\n        if (this.config.customPayloadBuilder) {\n          payload = this.config.customPayloadBuilder(timestamp || '', body)\n        } else {\n          payload = body\n        }\n        break\n      default:\n        payload = body\n    }\n\n    // Compute expected signature\n    const expectedSignature = await computeHMAC(payload, this.config.secret, this.config.algorithm)\n\n    // Compare signatures using timing-safe HMAC comparison\n    const signaturesMatch = await timingSafeEqual(\n      signature.toLowerCase(),\n      expectedSignature.toLowerCase()\n    )\n    if (!signaturesMatch) {\n      return {\n        valid: false,\n        error: 'invalid_token',\n        message: 'Invalid webhook signature',\n      }\n    }\n\n    // Build auth context\n    const context: AuthContext = {\n      authenticated: true,\n      method: 'bearer', // Use 'bearer' as the generic authenticated method\n      custom: {\n        signatureVerified: true,\n        algorithm: this.config.algorithm,\n        timestamp: timestamp ? parseInt(timestamp, 10) : undefined,\n      },\n    }\n\n    return {\n      valid: true,\n      context,\n    }\n  }\n}\n\n/**\n * Create a signature validator with common presets\n */\nexport function createSignatureValidator(config: SignatureConfig): SignatureValidator {\n  return new SignatureValidator(config)\n}\n\n/**\n * Preset configurations for popular webhook providers\n */\nexport const signaturePresets = {\n  /**\n   * GitHub webhook signature format\n   * Header: X-Hub-Signature-256\n   * Format: sha256=<signature>\n   */\n  github: (secret: string): SignatureConfig => ({\n    secret,\n    algorithm: 'sha256',\n    signatureHeader: 'x-hub-signature-256',\n    signaturePrefix: 'sha256=',\n    payloadFormat: 'body',\n    timestampTolerance: 0, // GitHub doesn't use timestamps\n  }),\n\n  /**\n   * Stripe webhook signature format\n   * Header: Stripe-Signature\n   * Format: t=<timestamp>,v1=<signature>\n   */\n  stripe: (secret: string): SignatureConfig => ({\n    secret,\n    algorithm: 'sha256',\n    signatureHeader: 'stripe-signature',\n    timestampHeader: 'stripe-signature', // Timestamp is in the signature header\n    payloadFormat: 'custom',\n    customPayloadBuilder: (timestamp, body) => `${timestamp}.${body}`,\n    // Note: Stripe parsing requires extracting timestamp from header\n    // This is a simplified version - full Stripe support would need custom parsing\n  }),\n\n  /**\n   * Slack webhook signature format\n   * Headers: X-Slack-Signature, X-Slack-Request-Timestamp\n   * Format: v0=<signature>\n   */\n  slack: (secret: string): SignatureConfig => ({\n    secret,\n    algorithm: 'sha256',\n    signatureHeader: 'x-slack-signature',\n    timestampHeader: 'x-slack-request-timestamp',\n    signaturePrefix: 'v0=',\n    payloadFormat: 'custom',\n    customPayloadBuilder: (timestamp, body) => `v0:${timestamp}:${body}`,\n    timestampTolerance: 300,\n  }),\n\n  /**\n   * Generic/default webhook signature format\n   * Used by Conductor and many custom implementations\n   */\n  default: (secret: string): SignatureConfig => ({\n    secret,\n    algorithm: 'sha256',\n    signatureHeader: 'x-webhook-signature',\n    timestampHeader: 'x-webhook-timestamp',\n    signaturePrefix: 'sha256=',\n    payloadFormat: 'timestamp.body',\n    timestampTolerance: 300,\n  }),\n}\n","/**\n * Basic Authentication Provider\n *\n * Implements HTTP Basic Authentication (RFC 7617).\n * Validates username:password credentials sent in the Authorization header.\n *\n * Features:\n * - Standard HTTP Basic auth validation\n * - Multiple credential support\n * - Optional realm specification\n * - Secure comparison to prevent timing attacks\n *\n * @see https://docs.ensemble.ai/conductor/building/security-authentication\n */\n\nimport type { AuthValidator, AuthValidationResult, AuthContext } from '../types.js'\nimport type { ConductorEnv } from '../../types/env.js'\nimport { timingSafeEqual } from '../utils/crypto.js'\n\n/**\n * Basic auth configuration\n */\nexport interface BasicAuthConfig {\n  /**\n   * Credentials in \"username:password\" format.\n   * Can be a single string or array of valid credentials.\n   */\n  credentials: string | string[]\n\n  /**\n   * Authentication realm (displayed in browser prompt)\n   * @default \"Conductor API\"\n   */\n  realm?: string\n}\n\n/**\n * Parsed credentials\n */\ninterface Credentials {\n  username: string\n  password: string\n}\n\n/**\n * Parse credentials from \"username:password\" format\n */\nfunction parseCredentials(credential: string): Credentials | null {\n  const colonIndex = credential.indexOf(':')\n  if (colonIndex === -1) {\n    return null\n  }\n\n  return {\n    username: credential.substring(0, colonIndex),\n    password: credential.substring(colonIndex + 1),\n  }\n}\n\n/**\n * Basic Auth Validator\n *\n * Validates HTTP Basic Authentication credentials.\n */\nexport class BasicAuthValidator implements AuthValidator {\n  private readonly credentials: Credentials[]\n  private readonly realm: string\n\n  constructor(config: BasicAuthConfig) {\n    this.realm = config.realm || 'Conductor API'\n\n    // Parse all valid credentials\n    const credentialList = Array.isArray(config.credentials)\n      ? config.credentials\n      : [config.credentials]\n\n    this.credentials = credentialList\n      .map(parseCredentials)\n      .filter((c): c is Credentials => c !== null)\n\n    if (this.credentials.length === 0) {\n      throw new Error(\n        'BasicAuthValidator: No valid credentials provided. Format: \"username:password\"'\n      )\n    }\n  }\n\n  /**\n   * Extract base64-encoded credentials from Authorization header\n   */\n  extractToken(request: Request): string | null {\n    const authHeader = request.headers.get('Authorization')\n    if (!authHeader?.startsWith('Basic ')) {\n      return null\n    }\n    return authHeader.substring(6) // Remove \"Basic \" prefix\n  }\n\n  /**\n   * Validate basic auth credentials\n   */\n  async validate(request: Request, _env: ConductorEnv): Promise<AuthValidationResult> {\n    const token = this.extractToken(request)\n\n    if (!token) {\n      return {\n        valid: false,\n        error: 'invalid_token',\n        message: 'Missing or invalid Authorization header. Expected: Basic <base64-credentials>',\n      }\n    }\n\n    // Decode base64 credentials\n    let decoded: string\n    try {\n      decoded = atob(token)\n    } catch {\n      return {\n        valid: false,\n        error: 'invalid_token',\n        message: 'Invalid base64 encoding in Authorization header',\n      }\n    }\n\n    // Parse username:password\n    const provided = parseCredentials(decoded)\n    if (!provided) {\n      return {\n        valid: false,\n        error: 'invalid_token',\n        message: 'Invalid credential format. Expected: username:password',\n      }\n    }\n\n    // Check against all valid credentials using timing-safe comparison\n    let matchedUsername: string | null = null\n    for (const valid of this.credentials) {\n      // Use timing-safe comparison for both username and password\n      // The async version uses HMAC for constant-time comparison\n      const [usernameMatch, passwordMatch] = await Promise.all([\n        timingSafeEqual(provided.username, valid.username),\n        timingSafeEqual(provided.password, valid.password),\n      ])\n\n      if (usernameMatch && passwordMatch) {\n        matchedUsername = valid.username\n        break\n      }\n    }\n\n    if (!matchedUsername) {\n      return {\n        valid: false,\n        error: 'invalid_token',\n        message: 'Invalid username or password',\n      }\n    }\n\n    // Build auth context\n    const context: AuthContext = {\n      authenticated: true,\n      method: 'basic',\n      user: {\n        id: matchedUsername,\n        metadata: {\n          authMethod: 'basic',\n          realm: this.realm,\n        },\n      },\n    }\n\n    return {\n      valid: true,\n      context,\n    }\n  }\n\n  /**\n   * Get WWW-Authenticate header value for 401 responses\n   */\n  getWWWAuthenticateHeader(): string {\n    return `Basic realm=\"${this.realm}\", charset=\"UTF-8\"`\n  }\n}\n\n/**\n * Create a basic auth validator\n */\nexport function createBasicValidator(config: BasicAuthConfig): BasicAuthValidator\nexport function createBasicValidator(credentials: string | string[]): BasicAuthValidator\nexport function createBasicValidator(\n  configOrCredentials: BasicAuthConfig | string | string[]\n): BasicAuthValidator {\n  if (typeof configOrCredentials === 'string' || Array.isArray(configOrCredentials)) {\n    return new BasicAuthValidator({ credentials: configOrCredentials })\n  }\n  return new BasicAuthValidator(configOrCredentials)\n}\n\n/**\n * Create a basic auth validator from environment variable\n *\n * Looks for BASIC_AUTH_CREDENTIALS in the environment.\n * Can be a single credential or comma-separated list.\n */\nexport function createBasicValidatorFromEnv(\n  env: Record<string, string>\n): BasicAuthValidator | null {\n  const credentials = env.BASIC_AUTH_CREDENTIALS\n  if (!credentials) {\n    return null\n  }\n\n  // Support comma-separated credentials for multiple users\n  const credentialList = credentials.includes(',')\n    ? credentials.split(',').map((c) => c.trim())\n    : [credentials]\n\n  return new BasicAuthValidator({ credentials: credentialList })\n}\n","/**\n * Trigger Authentication Bridge\n *\n * Bridges trigger auth configuration (from YAML) to the unified auth provider system.\n * This allows triggers to use the same auth mechanisms as API routes.\n *\n * Features:\n * - Unified auth handling for HTTP, Webhook, and MCP triggers\n * - Support for bearer, signature, basic, and apiKey auth\n * - Automatic provider selection based on config\n * - Consistent auth context for all routes\n *\n * @see https://docs.ensemble.ai/conductor/building/security-authentication\n */\n\nimport type { AuthValidator, AuthValidationResult, AuthContext } from './types.js'\nimport type { ConductorEnv } from '../types/env.js'\nimport { BearerValidator } from './providers/bearer.js'\nimport {\n  SignatureValidator,\n  createSignatureValidator,\n  signaturePresets,\n} from './providers/signature.js'\nimport { BasicAuthValidator, createBasicValidator } from './providers/basic.js'\nimport { createApiKeyValidator } from './providers/apikey.js'\nimport { timingSafeEqual } from './utils/crypto.js'\nimport { createLogger } from '../observability/index.js'\n\nconst logger = createLogger({ serviceName: 'trigger-auth' })\n\n/**\n * Trigger auth configuration (from YAML)\n */\nexport interface TriggerAuthConfig {\n  /** Auth type */\n  type: 'bearer' | 'signature' | 'basic' | 'apiKey' | 'unkey'\n\n  /** Shared secret (for bearer, signature, basic) */\n  secret?: string\n\n  /** Hash algorithm for signature auth (default: sha256) */\n  algorithm?: 'sha256' | 'sha1' | 'sha384' | 'sha512'\n\n  /** Custom signature header name */\n  signatureHeader?: string\n\n  /** Custom timestamp header name */\n  timestampHeader?: string\n\n  /** Timestamp tolerance in seconds (default: 300) */\n  timestampTolerance?: number\n\n  /** Preset signature format (github, stripe, slack, default) */\n  preset?: 'github' | 'stripe' | 'slack' | 'default'\n\n  /** Basic auth realm */\n  realm?: string\n}\n\n/**\n * Simple Bearer Token Validator\n *\n * Used when JWT_SECRET is not available - does simple token comparison.\n * This is the behavior triggers had before the bridge.\n */\nclass SimpleBearerValidator implements AuthValidator {\n  constructor(private readonly secret: string) {}\n\n  extractToken(request: Request): string | null {\n    const authHeader = request.headers.get('Authorization')\n    if (!authHeader?.startsWith('Bearer ')) {\n      return null\n    }\n    return authHeader.substring(7)\n  }\n\n  async validate(request: Request, _env: ConductorEnv): Promise<AuthValidationResult> {\n    const token = this.extractToken(request)\n\n    if (!token) {\n      return {\n        valid: false,\n        error: 'invalid_token',\n        message: 'Missing or invalid Authorization header. Expected: Bearer <token>',\n      }\n    }\n\n    // Use shared timing-safe comparison (HMAC-based for constant time)\n    const isValid = await timingSafeEqual(token, this.secret)\n\n    if (!isValid) {\n      return {\n        valid: false,\n        error: 'invalid_token',\n        message: 'Invalid bearer token',\n      }\n    }\n\n    return {\n      valid: true,\n      context: {\n        authenticated: true,\n        method: 'bearer',\n        token,\n      },\n    }\n  }\n}\n\n/**\n * Resolve environment variable references in a string\n *\n * Supports two syntaxes:\n * - $env.VAR_NAME (shorthand)\n * - ${env.VAR_NAME} (template syntax)\n *\n * @param value - The string potentially containing env var references\n * @param env - The environment object containing variable values\n * @returns The resolved string, or the original if no env var syntax found\n */\nfunction resolveEnvSecret(value: string | undefined, env: ConductorEnv): string | undefined {\n  if (!value || typeof value !== 'string') {\n    return value\n  }\n\n  // Match $env.VAR_NAME (shorthand syntax)\n  const shorthandMatch = value.match(/^\\$env\\.(\\w+)$/)\n  if (shorthandMatch) {\n    const varName = shorthandMatch[1]\n    const resolved = env?.[varName]\n    if (resolved === undefined) {\n      logger.warn(`Environment variable '${varName}' not found`, { varName })\n    }\n    return resolved ?? value\n  }\n\n  // Match ${env.VAR_NAME} (template syntax)\n  const templateMatch = value.match(/^\\$\\{env\\.(\\w+)\\}$/)\n  if (templateMatch) {\n    const varName = templateMatch[1]\n    const resolved = env?.[varName]\n    if (resolved === undefined) {\n      logger.warn(`Environment variable '${varName}' not found`, { varName })\n    }\n    return resolved ?? value\n  }\n\n  return value\n}\n\n/**\n * Get the appropriate auth validator based on trigger config\n */\nexport async function getValidatorForTrigger(\n  config: TriggerAuthConfig,\n  env: ConductorEnv\n): Promise<AuthValidator> {\n  // Resolve environment variable references in the secret\n  const resolvedSecret = resolveEnvSecret(config.secret, env)\n\n  switch (config.type) {\n    case 'bearer':\n      // Use JWT validation if JWT_SECRET exists, otherwise simple token match\n      if (env.JWT_SECRET) {\n        return new BearerValidator({\n          secret: env.JWT_SECRET,\n          issuer: env.JWT_ISSUER,\n          audience: env.JWT_AUDIENCE,\n        })\n      }\n      if (!resolvedSecret) {\n        throw new Error('Bearer auth requires a secret')\n      }\n      return new SimpleBearerValidator(resolvedSecret)\n\n    case 'signature':\n      if (!resolvedSecret) {\n        throw new Error('Signature auth requires a secret')\n      }\n\n      // Use preset if specified\n      if (config.preset) {\n        const presetConfig = signaturePresets[config.preset](resolvedSecret)\n        return createSignatureValidator(presetConfig)\n      }\n\n      // Use custom config\n      return createSignatureValidator({\n        secret: resolvedSecret,\n        algorithm: config.algorithm || 'sha256',\n        signatureHeader: config.signatureHeader,\n        timestampHeader: config.timestampHeader,\n        timestampTolerance: config.timestampTolerance,\n      })\n\n    case 'basic':\n      if (!resolvedSecret) {\n        throw new Error('Basic auth requires credentials (format: username:password)')\n      }\n      return createBasicValidator({\n        credentials: resolvedSecret,\n        realm: config.realm,\n      })\n\n    case 'apiKey': {\n      const validator = createApiKeyValidator(env)\n      if (!validator) {\n        throw new Error('API key auth requires API_KEYS KV namespace to be configured')\n      }\n      return validator\n    }\n\n    case 'unkey': {\n      // Use the Unkey validator for API key management\n      const { createUnkeyValidator } = await import('./providers/unkey.js')\n      const validator = createUnkeyValidator(env)\n      if (!validator) {\n        throw new Error('Unkey auth requires UNKEY_ROOT_KEY to be configured')\n      }\n      return validator\n    }\n\n    default: {\n      // TypeScript's exhaustive check - this handles runtime validation for unexpected types\n      const unknownType: never = config.type\n      throw new Error(`Unknown trigger auth type: ${unknownType}`)\n    }\n  }\n}\n\n/**\n * Create auth middleware for triggers using the unified provider system\n *\n * This is the main entry point for trigger auth. It creates a Hono middleware\n * that validates authentication using the appropriate provider.\n *\n * @param authConfig - Auth configuration from trigger YAML\n * @param env - Environment bindings (for KV, secrets, etc.)\n * @returns Hono middleware function\n */\nexport function createTriggerAuthMiddleware(\n  authConfig: TriggerAuthConfig,\n  env: ConductorEnv\n): (c: any, next: () => Promise<void>) => Promise<Response | void> {\n  return async (c: any, next: () => Promise<void>) => {\n    const validator = await getValidatorForTrigger(authConfig, env)\n    const request = c.req.raw as Request\n\n    try {\n      const result = await validator.validate(request, env)\n\n      if (!result.valid) {\n        // Build appropriate error response\n        const status = result.error === 'expired' ? 401 : 401\n        const response: Record<string, any> = {\n          error: result.error || 'unauthorized',\n          message: result.message || 'Authentication failed',\n        }\n\n        // Add WWW-Authenticate header for basic auth\n        if (authConfig.type === 'basic' && validator instanceof BasicAuthValidator) {\n          c.header('WWW-Authenticate', validator.getWWWAuthenticateHeader())\n        }\n\n        // Add rate limit info if available\n        if (result.ratelimit) {\n          c.header('X-RateLimit-Remaining', result.ratelimit.remaining.toString())\n          c.header('X-RateLimit-Limit', result.ratelimit.limit.toString())\n          c.header('X-RateLimit-Reset', result.ratelimit.reset.toString())\n        }\n\n        return c.json(response, status)\n      }\n\n      // Store auth context for downstream handlers\n      if (result.context) {\n        c.set('auth', result.context)\n        c.set('authenticated', true)\n\n        if (result.context.user) {\n          c.set('user', result.context.user)\n          c.set('userId', result.context.user.id)\n        }\n\n        if (result.context.custom) {\n          c.set('authCustom', result.context.custom)\n        }\n      }\n\n      await next()\n    } catch (error) {\n      // Handle validation errors gracefully\n      logger.error('Validation error', error instanceof Error ? error : undefined, {\n        authType: authConfig.type,\n      })\n      return c.json(\n        {\n          error: 'auth_error',\n          message: error instanceof Error ? error.message : 'Authentication error',\n        },\n        500\n      )\n    }\n  }\n}\n\n/**\n * Validate trigger auth config\n *\n * Used during build/startup to catch configuration errors early.\n */\nexport function validateTriggerAuthConfig(config: TriggerAuthConfig): string[] {\n  const errors: string[] = []\n\n  if (!config.type) {\n    errors.push('Auth type is required')\n    return errors\n  }\n\n  const validTypes = ['bearer', 'signature', 'basic', 'apiKey', 'unkey']\n  if (!validTypes.includes(config.type)) {\n    errors.push(`Invalid auth type: ${config.type}. Valid types: ${validTypes.join(', ')}`)\n  }\n\n  // Type-specific validation\n  switch (config.type) {\n    case 'bearer':\n    case 'basic':\n      if (!config.secret) {\n        errors.push(`${config.type} auth requires a secret`)\n      }\n      break\n\n    case 'signature':\n      if (!config.secret) {\n        errors.push('signature auth requires a secret')\n      }\n      if (config.algorithm && !['sha256', 'sha1', 'sha384', 'sha512'].includes(config.algorithm)) {\n        errors.push(`Invalid signature algorithm: ${config.algorithm}`)\n      }\n      if (config.preset && !['github', 'stripe', 'slack', 'default'].includes(config.preset)) {\n        errors.push(`Invalid signature preset: ${config.preset}`)\n      }\n      break\n  }\n\n  return errors\n}\n\n/**\n * Re-export types for convenience\n */\nexport type { AuthValidator, AuthValidationResult, AuthContext }\n","/**\n * Permission Utilities\n *\n * Industry-standard permission checking with wildcard support.\n * Compatible with OAuth 2.0 / RBAC permission patterns.\n *\n * Permission format: {resource}:{name}:{action}\n * Examples:\n *   - ensemble:invoice-pdf:execute\n *   - agent:http:execute\n *   - ensemble:*:execute (wildcard)\n *   - * (superuser)\n */\n\n/**\n * Check if user has the required permission\n *\n * Supports wildcards:\n *   - \"*\" matches everything (superuser)\n *   - \"ensemble:*\" matches all ensemble permissions\n *   - \"ensemble:*:execute\" matches execute on any ensemble\n *   - \"ensemble:billing-*:execute\" matches pattern\n *\n * @param userPermissions - Array of permissions the user has\n * @param requiredPermission - The permission required for the action\n * @returns true if user has permission\n */\nexport function hasPermission(userPermissions: string[], requiredPermission: string): boolean {\n  // No permissions required\n  if (!requiredPermission) {\n    return true\n  }\n\n  // No user permissions\n  if (!userPermissions || userPermissions.length === 0) {\n    return false\n  }\n\n  // Check each user permission\n  for (const userPerm of userPermissions) {\n    if (matchesPermission(userPerm, requiredPermission)) {\n      return true\n    }\n  }\n\n  return false\n}\n\n/**\n * Check if a single user permission matches the required permission\n */\nfunction matchesPermission(userPerm: string, required: string): boolean {\n  // Exact match\n  if (userPerm === required) {\n    return true\n  }\n\n  // Superuser wildcard\n  if (userPerm === '*') {\n    return true\n  }\n\n  // Parse permissions into parts\n  const userParts = userPerm.split(':')\n  const requiredParts = required.split(':')\n\n  // Category-level wildcard (e.g., \"ensemble:*\" matches \"ensemble:foo:execute\")\n  if (userParts.length === 2 && userParts[1] === '*') {\n    return requiredParts[0] === userParts[0]\n  }\n\n  // Three-part permission matching with wildcards\n  if (userParts.length === 3 && requiredParts.length === 3) {\n    const [userResource, userName, userAction] = userParts\n    const [reqResource, reqName, reqAction] = requiredParts\n\n    // Resource must match\n    if (userResource !== reqResource && userResource !== '*') {\n      return false\n    }\n\n    // Action must match (or wildcard)\n    if (userAction !== reqAction && userAction !== '*') {\n      return false\n    }\n\n    // Name matching with glob-style wildcards\n    if (userName === '*') {\n      return true\n    }\n\n    // Pattern matching (e.g., \"billing-*\" matches \"billing-invoice\")\n    if (userName.includes('*')) {\n      return matchesGlob(userName, reqName)\n    }\n\n    // Exact name match\n    return userName === reqName\n  }\n\n  return false\n}\n\n/**\n * Simple glob-style pattern matching\n * Supports * as wildcard for any characters\n *\n * Examples:\n *   - \"billing-*\" matches \"billing-invoice\", \"billing-receipt\"\n *   - \"*-pdf\" matches \"invoice-pdf\", \"report-pdf\"\n *   - \"report-*-v2\" matches \"report-monthly-v2\"\n */\nfunction matchesGlob(pattern: string, value: string): boolean {\n  // Convert glob pattern to regex\n  const regexPattern = pattern\n    .replace(/[.+?^${}()|[\\]\\\\]/g, '\\\\$&') // Escape special regex chars\n    .replace(/\\*/g, '.*') // Convert * to .*\n\n  const regex = new RegExp(`^${regexPattern}$`)\n  return regex.test(value)\n}\n\n/**\n * Check if user has ANY of the required permissions\n */\nexport function hasAnyPermission(\n  userPermissions: string[],\n  requiredPermissions: string[]\n): boolean {\n  return requiredPermissions.some((perm) => hasPermission(userPermissions, perm))\n}\n\n/**\n * Check if user has ALL of the required permissions\n */\nexport function hasAllPermissions(\n  userPermissions: string[],\n  requiredPermissions: string[]\n): boolean {\n  return requiredPermissions.every((perm) => hasPermission(userPermissions, perm))\n}\n\n/**\n * Get missing permissions from required set\n */\nexport function getMissingPermissions(\n  userPermissions: string[],\n  requiredPermissions: string[]\n): string[] {\n  return requiredPermissions.filter((perm) => !hasPermission(userPermissions, perm))\n}\n\n/**\n * Normalize permission string (lowercase, trim)\n */\nexport function normalizePermission(permission: string): string {\n  return permission.toLowerCase().trim()\n}\n\n/**\n * Validate permission format\n * Returns true if permission follows the resource:name:action pattern\n */\nexport function isValidPermissionFormat(permission: string): boolean {\n  // Superuser wildcard is valid\n  if (permission === '*') {\n    return true\n  }\n\n  const parts = permission.split(':')\n\n  // Two-part (category wildcard) or three-part (full permission)\n  if (parts.length < 2 || parts.length > 3) {\n    return false\n  }\n\n  // Each part must be non-empty\n  return parts.every((part) => part.length > 0)\n}\n\n/**\n * Parse a permission string into its components\n */\nexport function parsePermission(permission: string): {\n  resource: string\n  name: string\n  action: string\n} | null {\n  if (permission === '*') {\n    return { resource: '*', name: '*', action: '*' }\n  }\n\n  const parts = permission.split(':')\n\n  if (parts.length === 2) {\n    return { resource: parts[0], name: parts[1], action: '*' }\n  }\n\n  if (parts.length === 3) {\n    return { resource: parts[0], name: parts[1], action: parts[2] }\n  }\n\n  return null\n}\n\n/**\n * Build a permission string from components\n */\nexport function buildPermission(\n  resource: string,\n  name: string,\n  action: string = 'execute'\n): string {\n  return `${resource}:${name}:${action}`\n}\n","/**\n * Unified Router\n *\n * Central routing system with type-specific defaults and path-based rules\n */\n\nimport type {\n  ConductorConfig,\n  RouteConfig,\n  RouteAuthConfig,\n  ResolvedRouteAuthConfig,\n  RouteMatch,\n  Operation,\n} from './config.js'\nimport type { AuthValidator, AuthValidationResult, AuthContext } from '../auth/types.js'\nimport {\n  BearerValidator,\n  ApiKeyValidator,\n  CookieValidator,\n  UnkeyValidator,\n  CustomValidatorRegistry,\n  createBearerValidator,\n  createApiKeyValidator,\n  createCookieValidator,\n  createUnkeyValidator,\n  createCustomValidatorRegistry,\n} from '../auth/index.js'\n\n/**\n * Registered route\n */\ninterface RegisteredRoute {\n  pattern: string\n  path: string\n  methods: string[]\n  operation: Operation\n  agentName: string\n  auth?: Partial<RouteAuthConfig>\n  priority?: number\n  handler?: (\n    request: Request,\n    env: any,\n    ctx: ExecutionContext,\n    auth: AuthContext\n  ) => Promise<Response>\n}\n\n/**\n * Route registration options\n */\nexport interface RouteRegistrationOptions {\n  pattern: string | 'default'\n  path?: string\n  methods: string[]\n  operation: Operation\n  agentName: string\n  auth?: Partial<RouteAuthConfig>\n  priority?: number\n  handler?: (\n    request: Request,\n    env: any,\n    ctx: ExecutionContext,\n    auth: AuthContext\n  ) => Promise<Response>\n  /** Directory path for 'default' route resolution */\n  memberPath?: string\n}\n\n/**\n * Unified Router\n */\nexport class UnifiedRouter {\n  private routes: RegisteredRoute[] = []\n  private config: ConductorConfig\n  private validators: Map<string, AuthValidator> = new Map()\n  private customValidatorRegistry: CustomValidatorRegistry\n\n  constructor(config: ConductorConfig = {}) {\n    this.config = config\n    this.customValidatorRegistry = new CustomValidatorRegistry()\n  }\n\n  /**\n   * Initialize validators from environment\n   */\n  async init(env: any): Promise<void> {\n    // Register built-in validators\n    const bearer = createBearerValidator(env)\n    if (bearer) this.validators.set('bearer', bearer)\n\n    const apiKey = createApiKeyValidator(env)\n    if (apiKey) this.validators.set('apiKey', apiKey)\n\n    const cookie = createCookieValidator(env)\n    if (cookie) this.validators.set('cookie', cookie)\n\n    const unkey = createUnkeyValidator(env)\n    if (unkey) this.validators.set('unkey', unkey)\n\n    // Register custom validators\n    this.customValidatorRegistry = createCustomValidatorRegistry(env)\n  }\n\n  /**\n   * Register a route\n   */\n  register(options: RouteRegistrationOptions): void {\n    // Resolve 'default' path from directory structure\n    let pattern = options.pattern\n    let path = options.path || options.pattern\n\n    if (pattern === 'default' || pattern === 'auto') {\n      // Use agent path as the route\n      // For /pages/login/page.yaml -> /login\n      // For /agents/api/users/agent.yaml -> /api/users\n      // For /ensembles/workflows/invoice/ensemble.yaml -> /ensembles/workflows/invoice\n      if (options.memberPath) {\n        pattern = this.resolveDefaultPath(options.memberPath, options.operation)\n        path = pattern\n      } else {\n        // Fallback to agent name if no path provided\n        pattern = `/${options.operation}s/${options.agentName}`\n        path = pattern\n      }\n    }\n\n    const route: RegisteredRoute = {\n      pattern,\n      path,\n      methods: options.methods,\n      operation: options.operation,\n      agentName: options.agentName,\n      auth: options.auth,\n      priority: options.priority,\n      handler: options.handler,\n    }\n\n    this.routes.push(route)\n\n    // Sort by priority (lower = higher priority)\n    this.routes.sort((a, b) => {\n      const aPrio = a.priority ?? this.getDefaultPriority(a.operation)\n      const bPrio = b.priority ?? this.getDefaultPriority(b.operation)\n      if (aPrio !== bPrio) return aPrio - bPrio\n\n      // Static routes before dynamic (both : params and * wildcards)\n      const aStatic = !a.pattern.includes(':') && !a.pattern.includes('*')\n      const bStatic = !b.pattern.includes(':') && !b.pattern.includes('*')\n      if (aStatic && !bStatic) return -1\n      if (!aStatic && bStatic) return 1\n\n      // Longer paths first\n      return b.pattern.length - a.pattern.length\n    })\n  }\n\n  /**\n   * Resolve default path from agent directory structure\n   */\n  private resolveDefaultPath(memberPath: string, operation: Operation): string {\n    // Remove file extensions and standard names\n    let path = memberPath\n      .replace(/\\.(yaml|yml|ts|js|tsx|jsx)$/, '')\n      .replace(/\\/(agent|page|ensemble|form|api)$/, '')\n\n    // Remove type-specific prefixes\n    const prefixes = [\n      '/pages/',\n      '/agents/',\n      '/ensembles/',\n      '/forms/',\n      '/apis/',\n      '/webhooks/',\n      '/docs/',\n    ]\n    for (const prefix of prefixes) {\n      if (path.startsWith(prefix)) {\n        path = path.substring(prefix.length - 1) // Keep leading slash\n        break\n      }\n    }\n\n    // Ensure leading slash\n    if (!path.startsWith('/')) {\n      path = '/' + path\n    }\n\n    // Handle index pages\n    if (path.endsWith('/index')) {\n      path = path.substring(0, path.length - 6) || '/'\n    }\n\n    return path\n  }\n\n  /**\n   * Get default priority for agent type\n   */\n  private getDefaultPriority(operation: Operation): number {\n    const priorities: Record<Operation, number> = {\n      static: 1,\n      health: 2,\n      auth: 3,\n      api: 50,\n      webhook: 60,\n      docs: 70,\n      form: 90,\n    }\n    return priorities[operation] || 100\n  }\n\n  /**\n   * Match route pattern\n   */\n  private matchPattern(pattern: string, path: string): Record<string, string> | null {\n    // Normalize paths\n    pattern = pattern.replace(/\\/+$/, '') || '/'\n    path = path.replace(/\\/+$/, '') || '/'\n\n    // Wildcard match\n    if (pattern.endsWith('*')) {\n      const prefix = pattern.slice(0, -1)\n      if (path.startsWith(prefix)) {\n        return {}\n      }\n      return null\n    }\n\n    // Exact match\n    if (!pattern.includes(':')) {\n      return pattern === path ? {} : null\n    }\n\n    // Dynamic match\n    const patternParts = pattern.split('/')\n    const pathParts = path.split('/')\n\n    if (patternParts.length !== pathParts.length) {\n      return null\n    }\n\n    const params: Record<string, string> = {}\n\n    for (let i = 0; i < patternParts.length; i++) {\n      const patternPart = patternParts[i]\n      const pathPart = pathParts[i]\n\n      if (patternPart.startsWith(':')) {\n        const paramName = patternPart.slice(1)\n        params[paramName] = decodeURIComponent(pathPart)\n      } else if (patternPart !== pathPart) {\n        return null\n      }\n    }\n\n    return params\n  }\n\n  /**\n   * Find matching route\n   */\n  match(path: string, method: string): RouteMatch | null {\n    for (const route of this.routes) {\n      // Check method\n      if (!route.methods.includes(method) && !route.methods.includes('*')) {\n        continue\n      }\n\n      // Check pattern\n      const params = this.matchPattern(route.pattern, path)\n      if (params === null) {\n        continue\n      }\n\n      // Resolve auth config\n      const auth = this.resolveAuthConfig(route.pattern, route.operation, route.auth)\n\n      return {\n        pattern: route.pattern,\n        params,\n        auth,\n        operation: route.operation,\n        priority: route.priority ?? this.getDefaultPriority(route.operation),\n      }\n    }\n\n    return null\n  }\n\n  /**\n   * Resolve auth config by merging defaults and rules\n   */\n  private resolveAuthConfig(\n    path: string,\n    operation: Operation,\n    memberAuth?: Partial<RouteAuthConfig>\n  ): ResolvedRouteAuthConfig {\n    // Priority: agent > path rule > type default > global default\n\n    let resolved: Partial<RouteAuthConfig> = {}\n    let source: 'agent' | 'rule' | 'type-default' | 'global-default' = 'global-default'\n\n    // 1. Global default\n    if (this.config.routing?.auth?.global) {\n      resolved = { ...this.config.routing.auth.global }\n    }\n\n    // 2. Type default\n    const typeDefaults = this.config.routing?.auth?.defaults\n    if (typeDefaults) {\n      // Map agent types to config keys (handle singular/plural variations)\n      const typeKeyMap: Record<Operation, keyof typeof typeDefaults> = {\n        api: 'api',\n        webhook: 'webhooks',\n        form: 'forms',\n        docs: 'docs',\n        static: 'api', // Use api default for static\n        health: 'api', // Use api default for health\n        auth: 'api', // Use api default for auth\n      }\n      const typeKey = typeKeyMap[operation]\n      if (typeKey && typeDefaults[typeKey]) {\n        resolved = { ...resolved, ...typeDefaults[typeKey] }\n        source = 'type-default'\n      }\n    }\n\n    // 3. Path rules\n    const rules = this.config.routing?.auth?.rules || []\n    for (const rule of rules) {\n      if (this.matchPattern(rule.pattern, path)) {\n        resolved = { ...resolved, ...rule.auth }\n        if (rule.rateLimit) {\n          resolved.rateLimit = rule.rateLimit\n        }\n        source = 'rule'\n        break\n      }\n    }\n\n    // 4. Agent-specific\n    if (memberAuth) {\n      resolved = { ...resolved, ...memberAuth }\n      source = 'agent'\n    }\n\n    // Ensure requirement is set\n    if (!resolved.requirement) {\n      resolved.requirement = 'required'\n    }\n\n    return {\n      requirement: resolved.requirement,\n      methods: resolved.methods,\n      permissions: resolved.permissions,\n      roles: resolved.roles,\n      serviceAccountOnly: resolved.serviceAccountOnly,\n      stealthMode: resolved.stealthMode,\n      customValidator: resolved.customValidator,\n      onFailure: resolved.onFailure,\n      auditLog: resolved.auditLog,\n      source,\n      rateLimit: resolved.rateLimit,\n    }\n  }\n\n  /**\n   * Authenticate request\n   */\n  async authenticate(\n    request: Request,\n    env: any,\n    auth: ResolvedRouteAuthConfig\n  ): Promise<AuthValidationResult> {\n    // Public routes don't need auth\n    if (auth.requirement === 'public') {\n      return {\n        valid: true,\n        context: {\n          authenticated: false,\n          method: undefined,\n        },\n      }\n    }\n\n    const methods = auth.methods || ['bearer', 'apiKey', 'cookie']\n\n    // Try custom validator first\n    if (auth.customValidator) {\n      const validator = this.customValidatorRegistry.get(auth.customValidator)\n      if (validator) {\n        const result = await validator.validate(request, env)\n        if (result.valid) return result\n      }\n    }\n\n    // Try each auth method\n    for (const method of methods) {\n      const validator = this.validators.get(method)\n      if (!validator) continue\n\n      const result = await validator.validate(request, env)\n      if (result.valid) {\n        // Check service account requirement\n        if (auth.serviceAccountOnly && result.context?.unkey?.isServiceAccount !== true) {\n          continue\n        }\n\n        // Check permissions\n        if (auth.permissions && auth.permissions.length > 0) {\n          const userPerms = result.context?.user?.permissions || []\n          const hasPerms = auth.permissions.every((p) => userPerms.includes(p))\n          if (!hasPerms) {\n            return {\n              valid: false,\n              error: 'insufficient_permissions',\n              message: 'Insufficient permissions',\n            }\n          }\n        }\n\n        // Check roles\n        if (auth.roles && auth.roles.length > 0) {\n          const userRoles = result.context?.user?.roles || []\n          const hasRoles = auth.roles.some((r) => userRoles.includes(r))\n          if (!hasRoles) {\n            return {\n              valid: false,\n              error: 'insufficient_permissions',\n              message: 'Insufficient role',\n            }\n          }\n        }\n\n        return result\n      }\n    }\n\n    // Optional auth\n    if (auth.requirement === 'optional') {\n      return {\n        valid: true,\n        context: {\n          authenticated: false,\n          method: undefined,\n        },\n      }\n    }\n\n    // Required but not provided\n    return {\n      valid: false,\n      error: 'invalid_token',\n      message: 'Authentication required',\n    }\n  }\n\n  /**\n   * Handle request\n   */\n  async handle(request: Request, env: any, ctx: ExecutionContext): Promise<Response | null> {\n    const url = new URL(request.url)\n    const path = url.pathname\n    const method = request.method\n\n    // Find matching route\n    const match = this.match(path, method)\n    if (!match) {\n      return null // No match, let caller handle 404\n    }\n\n    // Authenticate\n    const authResult = await this.authenticate(request, env, match.auth)\n\n    if (!authResult.valid) {\n      return this.handleAuthFailure(authResult, match.auth)\n    }\n\n    // Find registered route handler\n    const route = this.routes.find((r) => r.pattern === match.pattern)\n    if (!route?.handler) {\n      return null // No handler, let agent handle it\n    }\n\n    // Call handler with auth context\n    return await route.handler(request, env, ctx, authResult.context!)\n  }\n\n  /**\n   * Handle auth failure\n   */\n  private handleAuthFailure(\n    authResult: AuthValidationResult,\n    auth: ResolvedRouteAuthConfig\n  ): Response {\n    // Stealth mode\n    if (auth.stealthMode) {\n      return new Response('Not Found', { status: 404 })\n    }\n\n    // Custom failure action\n    if (auth.onFailure) {\n      if (auth.onFailure.action === 'redirect') {\n        const location = auth.onFailure.redirectTo || '/login'\n        return Response.redirect(location, 302)\n      }\n    }\n\n    // Default error response\n    const status = authResult.error === 'insufficient_permissions' ? 403 : 401\n    return new Response(\n      JSON.stringify({\n        error: authResult.error,\n        message: authResult.message,\n      }),\n      {\n        status,\n        headers: { 'Content-Type': 'application/json' },\n      }\n    )\n  }\n}\n","/**\n * Build Manager\n *\n * Manages build-time ensemble execution.\n * Ensembles with build triggers run during `conductor build` or deploy time.\n *\n * Use cases:\n * - Generate static documentation\n * - Pre-compute data that doesn't change frequently\n * - Generate OpenAPI specs\n * - Build static assets\n */\n\nimport type { EnsembleConfig, BuildTriggerConfig, TriggerConfig } from './parser.js'\nimport { Executor } from './executor.js'\nimport { createLogger, type Logger } from '../observability/index.js'\n\n/**\n * Build execution result\n */\nexport interface BuildExecutionResult {\n  ensemble: string\n  success: boolean\n  duration: number\n  output?: unknown\n  outputPath?: string\n  error?: string\n}\n\n/**\n * Build Manager\n *\n * Coordinates build-time ensemble execution.\n */\nexport class BuildManager {\n  private readonly ensembles: Map<string, EnsembleConfig> = new Map()\n  private readonly logger: Logger\n\n  constructor(logger?: Logger) {\n    this.logger = logger || createLogger({ serviceName: 'build-manager' })\n  }\n\n  /**\n   * Register ensemble with build triggers\n   */\n  register(ensemble: EnsembleConfig): void {\n    const buildTriggers = ensemble.trigger?.filter((t) => t.type === 'build') || []\n    if (buildTriggers.length === 0) {\n      return\n    }\n\n    this.ensembles.set(ensemble.name, ensemble)\n  }\n\n  /**\n   * Register multiple ensembles at once\n   */\n  registerAll(ensembles: EnsembleConfig[]): void {\n    for (const ensemble of ensembles) {\n      this.register(ensemble)\n    }\n  }\n\n  /**\n   * Run all build triggers\n   * Called during `conductor build` or deploy\n   */\n  async runBuildTriggers(\n    env: Env,\n    ctx: ExecutionContext,\n    options?: {\n      filter?: string[] // Only run specific ensembles\n      dryRun?: boolean // Log what would run without executing\n    }\n  ): Promise<BuildExecutionResult[]> {\n    const results: BuildExecutionResult[] = []\n\n    // Get ensembles to run\n    let ensemblesToRun = Array.from(this.ensembles.values())\n    if (options?.filter && options.filter.length > 0) {\n      ensemblesToRun = ensemblesToRun.filter((e) => options.filter!.includes(e.name))\n    }\n\n    if (ensemblesToRun.length === 0) {\n      this.logger.info('No build triggers to run')\n      return results\n    }\n\n    this.logger.info(`Running ${ensemblesToRun.length} build trigger(s)`, {\n      ensembles: ensemblesToRun.map((e) => e.name),\n      dryRun: options?.dryRun,\n    })\n\n    const executor = new Executor({ env, ctx })\n\n    for (const ensemble of ensemblesToRun) {\n      // Get build trigger(s) for this ensemble\n      const buildTriggers =\n        ensemble.trigger?.filter((t): t is BuildTriggerConfig => t.type === 'build') || []\n\n      for (const trigger of buildTriggers) {\n        // Skip disabled triggers\n        if (trigger.enabled === false) {\n          this.logger.debug(`Skipping disabled build trigger for ${ensemble.name}`)\n          continue\n        }\n\n        if (options?.dryRun) {\n          this.logger.info(`[DRY RUN] Would run build trigger for ${ensemble.name}`, {\n            output: trigger.output,\n            input: trigger.input,\n          })\n          results.push({\n            ensemble: ensemble.name,\n            success: true,\n            duration: 0,\n            outputPath: trigger.output,\n          })\n          continue\n        }\n\n        const startTime = Date.now()\n\n        try {\n          // Prepare input with build metadata\n          const input = {\n            ...(trigger.input || {}),\n            _build: {\n              triggeredAt: Date.now(),\n              output: trigger.output,\n              metadata: trigger.metadata,\n            },\n          }\n\n          // Execute ensemble\n          const result = await executor.executeEnsemble(ensemble, input)\n          const duration = Date.now() - startTime\n\n          if (result.success) {\n            this.logger.info(`Build trigger completed for ${ensemble.name}`, {\n              durationMs: duration,\n              outputPath: trigger.output,\n            })\n\n            results.push({\n              ensemble: ensemble.name,\n              success: true,\n              duration,\n              output: result.value?.output,\n              outputPath: trigger.output,\n            })\n          } else {\n            this.logger.error(`Build trigger failed for ${ensemble.name}`, undefined, {\n              durationMs: duration,\n              error: result.error?.message,\n            })\n\n            results.push({\n              ensemble: ensemble.name,\n              success: false,\n              duration,\n              error: result.error?.message || 'Unknown error',\n              outputPath: trigger.output,\n            })\n          }\n        } catch (error) {\n          const duration = Date.now() - startTime\n          const errorMessage = error instanceof Error ? error.message : 'Unknown error'\n\n          this.logger.error(\n            `Build trigger error for ${ensemble.name}`,\n            error instanceof Error ? error : undefined,\n            { durationMs: duration }\n          )\n\n          results.push({\n            ensemble: ensemble.name,\n            success: false,\n            duration,\n            error: errorMessage,\n            outputPath: trigger.output,\n          })\n        }\n      }\n    }\n\n    // Summary\n    const successful = results.filter((r) => r.success).length\n    const failed = results.filter((r) => !r.success).length\n\n    this.logger.info('Build triggers completed', {\n      total: results.length,\n      successful,\n      failed,\n    })\n\n    return results\n  }\n\n  /**\n   * List all ensembles with build triggers\n   */\n  listBuildEnsembles(): Array<{\n    ensembleName: string\n    triggers: BuildTriggerConfig[]\n  }> {\n    const buildEnsembles: Array<{ ensembleName: string; triggers: BuildTriggerConfig[] }> = []\n\n    for (const ensemble of this.ensembles.values()) {\n      const buildTriggers =\n        ensemble.trigger?.filter((t): t is BuildTriggerConfig => t.type === 'build') || []\n\n      if (buildTriggers.length > 0) {\n        buildEnsembles.push({\n          ensembleName: ensemble.name,\n          triggers: buildTriggers,\n        })\n      }\n    }\n\n    return buildEnsembles\n  }\n\n  /**\n   * Get count of registered ensembles with build triggers\n   */\n  getBuildCount(): number {\n    return this.ensembles.size\n  }\n\n  /**\n   * Clear all registered ensembles\n   */\n  clear(): void {\n    this.ensembles.clear()\n  }\n}\n\n/**\n * Global build manager instance\n */\nlet globalBuildManager: BuildManager | null = null\n\n/**\n * Get or create the global build manager\n */\nexport function getBuildManager(): BuildManager {\n  if (!globalBuildManager) {\n    globalBuildManager = new BuildManager()\n  }\n  return globalBuildManager\n}\n\n/**\n * Reset the global build manager (for testing)\n */\nexport function resetBuildManager(): void {\n  globalBuildManager = null\n}\n","/**\n * CLI Manager\n *\n * Manages CLI-triggered ensemble execution.\n * Ensembles with CLI triggers can be invoked via `conductor run <command>`.\n *\n * Use cases:\n * - Generate documentation on demand\n * - Run data migrations\n * - Execute maintenance tasks\n * - Custom development commands\n */\n\nimport type { EnsembleConfig, CLITriggerConfig, TriggerConfig } from './parser.js'\nimport { Executor } from './executor.js'\nimport { createLogger, type Logger } from '../observability/index.js'\n\n/**\n * CLI command option definition\n */\nexport interface CLIOption {\n  name: string\n  type?: 'string' | 'number' | 'boolean'\n  default?: string | number | boolean\n  description?: string\n  required?: boolean\n}\n\n/**\n * CLI command metadata\n */\nexport interface CLICommandMetadata {\n  command: string\n  description?: string\n  options: CLIOption[]\n  ensembleName: string\n}\n\n/**\n * CLI execution result\n */\nexport interface CLIExecutionResult {\n  command: string\n  ensemble: string\n  success: boolean\n  duration: number\n  output?: unknown\n  error?: string\n}\n\n/**\n * CLI Manager\n *\n * Coordinates CLI-triggered ensemble execution.\n */\nexport class CLIManager {\n  private readonly commands: Map<string, { ensemble: EnsembleConfig; trigger: CLITriggerConfig }> =\n    new Map()\n  private readonly logger: Logger\n\n  constructor(logger?: Logger) {\n    this.logger = logger || createLogger({ serviceName: 'cli-manager' })\n  }\n\n  /**\n   * Register ensemble with CLI triggers\n   */\n  register(ensemble: EnsembleConfig): void {\n    const cliTriggers =\n      ensemble.trigger?.filter((t): t is CLITriggerConfig => t.type === 'cli') || []\n\n    for (const trigger of cliTriggers) {\n      if (trigger.enabled === false) continue\n\n      if (this.commands.has(trigger.command)) {\n        this.logger.warn(`CLI command \"${trigger.command}\" already registered, overwriting`)\n      }\n\n      this.commands.set(trigger.command, { ensemble, trigger })\n      this.logger.debug(`Registered CLI command: ${trigger.command}  ${ensemble.name}`)\n    }\n  }\n\n  /**\n   * Register multiple ensembles at once\n   */\n  registerAll(ensembles: EnsembleConfig[]): void {\n    for (const ensemble of ensembles) {\n      this.register(ensemble)\n    }\n  }\n\n  /**\n   * Check if a command is registered\n   */\n  hasCommand(command: string): boolean {\n    return this.commands.has(command)\n  }\n\n  /**\n   * Get command metadata\n   */\n  getCommandMetadata(command: string): CLICommandMetadata | null {\n    const entry = this.commands.get(command)\n    if (!entry) return null\n\n    return {\n      command: entry.trigger.command,\n      description: entry.trigger.description,\n      options: entry.trigger.options || [],\n      ensembleName: entry.ensemble.name,\n    }\n  }\n\n  /**\n   * Run a CLI command\n   */\n  async runCommand(\n    command: string,\n    options: Record<string, string | number | boolean>,\n    env: Env,\n    ctx: ExecutionContext\n  ): Promise<CLIExecutionResult> {\n    const entry = this.commands.get(command)\n\n    if (!entry) {\n      return {\n        command,\n        ensemble: '',\n        success: false,\n        duration: 0,\n        error: `Command not found: ${command}`,\n      }\n    }\n\n    const { ensemble, trigger } = entry\n    const startTime = Date.now()\n\n    this.logger.info(`Running CLI command: ${command}`, {\n      ensemble: ensemble.name,\n      options,\n    })\n\n    try {\n      // Parse and validate options\n      const parsedOptions = this.parseOptions(trigger.options || [], options)\n\n      // Prepare input with CLI metadata\n      const input = {\n        ...parsedOptions,\n        _cli: {\n          command,\n          triggeredAt: Date.now(),\n          options: parsedOptions,\n        },\n      }\n\n      // Create executor\n      const executor = new Executor({ env, ctx })\n\n      // Execute ensemble\n      const result = await executor.executeEnsemble(ensemble, input)\n      const duration = Date.now() - startTime\n\n      if (result.success) {\n        this.logger.info(`CLI command completed: ${command}`, {\n          durationMs: duration,\n        })\n\n        return {\n          command,\n          ensemble: ensemble.name,\n          success: true,\n          duration,\n          output: result.value?.output,\n        }\n      } else {\n        this.logger.error(`CLI command failed: ${command}`, undefined, {\n          durationMs: duration,\n          error: result.error?.message,\n        })\n\n        return {\n          command,\n          ensemble: ensemble.name,\n          success: false,\n          duration,\n          error: result.error?.message || 'Unknown error',\n        }\n      }\n    } catch (error) {\n      const duration = Date.now() - startTime\n      const errorMessage = error instanceof Error ? error.message : 'Unknown error'\n\n      this.logger.error(\n        `CLI command error: ${command}`,\n        error instanceof Error ? error : undefined,\n        { durationMs: duration }\n      )\n\n      return {\n        command,\n        ensemble: ensemble.name,\n        success: false,\n        duration,\n        error: errorMessage,\n      }\n    }\n  }\n\n  /**\n   * Parse and validate command options\n   */\n  private parseOptions(\n    definitions: CLIOption[],\n    provided: Record<string, string | number | boolean>\n  ): Record<string, string | number | boolean> {\n    const result: Record<string, string | number | boolean> = {}\n\n    for (const def of definitions) {\n      const value = provided[def.name]\n\n      if (value === undefined) {\n        if (def.required) {\n          throw new Error(`Missing required option: --${def.name}`)\n        }\n        if (def.default !== undefined) {\n          result[def.name] = def.default\n        }\n        continue\n      }\n\n      // Type coercion\n      switch (def.type) {\n        case 'number':\n          const num = Number(value)\n          if (isNaN(num)) {\n            throw new Error(`Option --${def.name} must be a number`)\n          }\n          result[def.name] = num\n          break\n        case 'boolean':\n          result[def.name] = value === true || value === 'true' || value === '1' || value === 'yes'\n          break\n        default:\n          result[def.name] = String(value)\n      }\n    }\n\n    // Include any extra options not in definitions\n    for (const [key, value] of Object.entries(provided)) {\n      if (!(key in result)) {\n        result[key] = value\n      }\n    }\n\n    return result\n  }\n\n  /**\n   * List all registered CLI commands\n   */\n  listCommands(): CLICommandMetadata[] {\n    const commands: CLICommandMetadata[] = []\n\n    for (const [command, entry] of this.commands) {\n      commands.push({\n        command,\n        description: entry.trigger.description,\n        options: entry.trigger.options || [],\n        ensembleName: entry.ensemble.name,\n      })\n    }\n\n    return commands.sort((a, b) => a.command.localeCompare(b.command))\n  }\n\n  /**\n   * Get count of registered commands\n   */\n  getCommandCount(): number {\n    return this.commands.size\n  }\n\n  /**\n   * Clear all registered commands\n   */\n  clear(): void {\n    this.commands.clear()\n  }\n}\n\n/**\n * Global CLI manager instance\n */\nlet globalCLIManager: CLIManager | null = null\n\n/**\n * Get or create the global CLI manager\n */\nexport function getCLIManager(): CLIManager {\n  if (!globalCLIManager) {\n    globalCLIManager = new CLIManager()\n  }\n  return globalCLIManager\n}\n\n/**\n * Reset the global CLI manager (for testing)\n */\nexport function resetCLIManager(): void {\n  globalCLIManager = null\n}\n","/**\n * Plugin System Types\n *\n * Defines the plugin architecture for Conductor.\n * Supports two patterns:\n * 1. Functional plugins - Simple config transformers\n * 2. Lifecycle plugins - Complex plugins with async initialization\n */\n\nimport type {\n  PluginRegistry,\n  OperationHandler,\n  OperationMetadata,\n} from '../runtime/plugin-registry.js'\nimport type { ConductorEnv } from './env.js'\nimport type { MiddlewareHandler } from 'hono'\nimport type { BaseAgent } from '../agents/base-agent.js'\nimport type { AgentConfig } from '../runtime/parser.js'\nimport type { AuthContext } from '../auth/types.js'\n\n/**\n * Configuration for Conductor\n */\nexport interface ConductorConfig {\n  /** Registered plugins */\n  plugins?: ConductorPlugin[]\n  /** Custom operations */\n  operations?: OperationRegistration[]\n  /** Environment-specific configuration */\n  env?: Record<string, any>\n  /** Additional configuration */\n  [key: string]: any\n}\n\n/**\n * Plugin context provided during initialization\n */\nexport interface PluginContext {\n  /** Global plugin registry */\n  operationRegistry: PluginRegistry\n  /** Cloudflare Workers environment bindings */\n  env: ConductorEnv\n  /** Cloudflare Workers execution context */\n  ctx: ExecutionContext\n  /** Configuration passed to the plugin */\n  config: Record<string, unknown>\n  /** Plugin-specific logger */\n  logger: PluginLogger\n}\n\n/**\n * Plugin logger interface\n */\nexport interface PluginLogger {\n  info(message: string, meta?: Record<string, unknown>): void\n  warn(message: string, meta?: Record<string, unknown>): void\n  error(message: string, error?: Error, meta?: Record<string, unknown>): void\n  debug(message: string, meta?: Record<string, unknown>): void\n}\n\n/**\n * Operation registration from plugin\n */\nexport interface OperationRegistration {\n  /** Operation name (e.g., 'plasmic:render', 'unkey:validate') */\n  name: string\n  /** Operation handler */\n  handler: OperationHandler\n  /** Operation metadata */\n  metadata?: OperationMetadata\n}\n\n/**\n * Middleware registration from plugin\n */\nexport interface MiddlewareRegistration {\n  /** Middleware name */\n  name: string\n  /** Middleware handler - Hono MiddlewareHandler */\n  handler: MiddlewareHandler\n  /** Apply to specific routes/paths */\n  paths?: string[]\n}\n\n/**\n * Agent factory function type\n */\nexport type AgentFactory = (\n  config: AgentConfig,\n  env: ConductorEnv\n) => BaseAgent | Promise<BaseAgent>\n\n/**\n * Agent registration from plugin\n */\nexport interface AgentRegistration {\n  /** Agent type name */\n  type: string\n  /** Agent class or factory function */\n  factory: AgentFactory\n}\n\n/**\n * Auth validator registration from plugin\n */\nexport interface AuthValidatorRegistration {\n  /** Validator name */\n  name: string\n  /** Validation handler */\n  handler: (token: string, context: PluginContext) => Promise<AuthValidationResult>\n}\n\n/**\n * Auth validation result\n */\nexport interface AuthValidationResult {\n  valid: boolean\n  user?: AuthContext['user']\n  metadata?: Record<string, unknown>\n  error?: string\n}\n\n/**\n * Plugin dependency declaration\n */\nexport interface PluginDependency {\n  /** Plugin name */\n  name: string\n  /** Required version (semver) */\n  version?: string\n  /** Is this dependency optional */\n  optional?: boolean\n}\n\n/**\n * Functional Plugin Pattern\n *\n * Simple plugins that transform configuration.\n * Use for lightweight integrations without async setup.\n *\n * @example\n * ```typescript\n * export const simplePlugin = (options: Options) =>\n *   (config: ConductorConfig): ConductorConfig => ({\n *     ...config,\n *     operations: [\n *       ...config.operations,\n *       { name: 'simple:op', handler: simpleHandler }\n *     ]\n *   })\n * ```\n */\nexport type FunctionalPlugin = (\n  config: ConductorConfig\n) => ConductorConfig | Promise<ConductorConfig>\n\n/**\n * Lifecycle Plugin Pattern\n *\n * Complex plugins with full lifecycle management.\n * Use for external API connections, database setup, etc.\n *\n * @example\n * ```typescript\n * export const complexPlugin: LifecyclePlugin = {\n *   name: 'complex',\n *   version: '1.0.0',\n *   async initialize(context) {\n *     await connectToExternalService()\n *     context.operationRegistry.register('complex:op', handler)\n *   }\n * }\n * ```\n */\nexport interface LifecyclePlugin {\n  /** Plugin identifier (unique name) */\n  name: string\n  /** Plugin version (semver) */\n  version: string\n  /** Human-readable description */\n  description?: string\n\n  /**\n   * Initialize plugin (called once during Conductor startup)\n   * Register operations, setup connections, etc.\n   */\n  initialize(context: PluginContext): Promise<void>\n\n  /**\n   * Shutdown plugin (called on Worker termination)\n   * Cleanup connections, close handles, etc.\n   */\n  shutdown?(): Promise<void>\n\n  /**\n   * Operations provided by this plugin\n   * Called during initialization to register operations\n   */\n  operations?(): OperationRegistration[]\n\n  /**\n   * Middleware provided by this plugin\n   */\n  middleware?(): MiddlewareRegistration[]\n\n  /**\n   * Agents provided by this plugin\n   */\n  agents?(): AgentRegistration[]\n\n  /**\n   * Auth validators provided by this plugin\n   */\n  authValidators?(): AuthValidatorRegistration[]\n\n  /**\n   * Plugin dependencies\n   */\n  dependencies?: PluginDependency[]\n\n  /**\n   * Required environment variables\n   */\n  requiredEnv?: string[]\n\n  /**\n   * Plugin configuration schema (for validation)\n   * Accepts Zod schemas or JSON Schema objects\n   */\n  configSchema?: Record<string, unknown>\n}\n\n/**\n * Union type supporting both plugin patterns\n */\nexport type ConductorPlugin = FunctionalPlugin | LifecyclePlugin\n\n/**\n * Type guard to check if plugin is lifecycle-based\n */\nexport function isLifecyclePlugin(plugin: ConductorPlugin): plugin is LifecyclePlugin {\n  return typeof plugin === 'object' && 'initialize' in plugin\n}\n\n/**\n * Type guard to check if plugin is functional\n */\nexport function isFunctionalPlugin(plugin: ConductorPlugin): plugin is FunctionalPlugin {\n  return typeof plugin === 'function'\n}\n\n/**\n * Plugin builder helper for functional plugins\n *\n * @example\n * ```typescript\n * export const myPlugin = buildPlugin((options: Options) => (config) => {\n *   // Transform config\n *   return config\n * })\n * ```\n */\nexport function buildPlugin<TOptions = Record<string, unknown>>(\n  factory: (options?: TOptions) => FunctionalPlugin\n): (options?: TOptions) => FunctionalPlugin {\n  return factory\n}\n\n/**\n * Plugin metadata (for discovery and documentation)\n */\nexport interface PluginMetadata {\n  name: string\n  version: string\n  description?: string\n  author?: string\n  homepage?: string\n  repository?: string\n  keywords?: string[]\n  license?: string\n}\n","/**\n * Docs Manager\n *\n * Manages markdown documentation with:\n * - Handlebars template rendering\n * - In-memory caching for performance\n * - Variable substitution\n * - Component reference support (docs://path@version)\n * - File-based auto-loading\n */\n\nimport { HandlebarsTemplateEngine } from '../utils/templates/engines/handlebars.js'\nimport type { TemplateContext } from '../utils/templates/types.js'\n\nexport interface DocsTemplate {\n  /** Template name (file name without extension) */\n  name: string\n  /** Markdown content (may contain Handlebars) */\n  content: string\n  /** Metadata extracted from frontmatter (optional) */\n  metadata?: {\n    title?: string\n    description?: string\n    version?: string\n    [key: string]: any\n  }\n}\n\nexport interface DocsManagerConfig {\n  /** Enable in-memory caching */\n  cacheEnabled?: boolean\n  /** Enable Handlebars rendering */\n  handlebarsEnabled?: boolean\n}\n\nexport interface RenderOptions {\n  /** Variables to inject into template */\n  variables?: TemplateContext\n  /** Skip Handlebars rendering (return raw markdown) */\n  skipHandlebars?: boolean\n}\n\nexport interface RenderedDocs {\n  /** Rendered markdown content */\n  content: string\n  /** Template metadata */\n  metadata?: DocsTemplate['metadata']\n}\n\n/**\n * Docs Manager - First-class component support for markdown documentation\n *\n * Works exactly like PromptManager with Handlebars rendering and caching.\n */\nexport class DocsManager {\n  private cache = new Map<string, DocsTemplate>()\n  private handlebars: HandlebarsTemplateEngine\n  private config: Required<DocsManagerConfig>\n\n  constructor(config: DocsManagerConfig = {}) {\n    this.config = {\n      cacheEnabled: config.cacheEnabled ?? true,\n      handlebarsEnabled: config.handlebarsEnabled ?? true,\n    }\n\n    this.handlebars = new HandlebarsTemplateEngine()\n  }\n\n  /**\n   * Register a docs template in cache\n   */\n  register(template: DocsTemplate): void {\n    const key = template.name\n    this.cache.set(key, template)\n  }\n\n  /**\n   * Get a docs template from cache\n   */\n  get(name: string): DocsTemplate | null {\n    return this.cache.get(name) || null\n  }\n\n  /**\n   * Check if docs template exists in cache\n   */\n  has(name: string): boolean {\n    return this.cache.has(name)\n  }\n\n  /**\n   * List all cached docs templates\n   */\n  list(): Array<{ name: string; title?: string }> {\n    return Array.from(this.cache.values()).map((template) => ({\n      name: template.name,\n      title: template.metadata?.title,\n    }))\n  }\n\n  /**\n   * Clear cache\n   */\n  clearCache(): void {\n    this.cache.clear()\n  }\n\n  /**\n   * Render markdown with Handlebars\n   */\n  async render(template: DocsTemplate, options?: RenderOptions): Promise<RenderedDocs> {\n    let content = template.content\n\n    // Apply Handlebars rendering if enabled\n    if (this.config.handlebarsEnabled && !options?.skipHandlebars) {\n      const variables = options?.variables || {}\n      content = await this.handlebars.render(content, variables)\n    }\n\n    return {\n      content,\n      metadata: template.metadata,\n    }\n  }\n\n  /**\n   * Render docs by name from cache\n   */\n  async renderByName(name: string, options?: RenderOptions): Promise<RenderedDocs> {\n    const template = this.get(name)\n    if (!template) {\n      throw new Error(`Docs template not found: ${name}`)\n    }\n\n    return this.render(template, options)\n  }\n\n  /**\n   * Load docs from markdown string\n   *\n   * Supports optional YAML frontmatter:\n   * ---\n   * title: Getting Started\n   * description: Quick start guide\n   * ---\n   * # Content here\n   */\n  loadFromMarkdown(markdown: string, name: string): DocsTemplate {\n    const { content, metadata } = this.parseFrontmatter(markdown)\n\n    const template: DocsTemplate = {\n      name,\n      content,\n      metadata,\n    }\n\n    if (this.config.cacheEnabled) {\n      this.register(template)\n    }\n\n    return template\n  }\n\n  /**\n   * Parse YAML frontmatter from markdown\n   */\n  private parseFrontmatter(markdown: string): {\n    content: string\n    metadata?: Record<string, any>\n  } {\n    // Check for frontmatter (--- at start)\n    const frontmatterRegex = /^---\\s*\\n([\\s\\S]*?)\\n---\\s*\\n([\\s\\S]*)$/\n    const match = markdown.match(frontmatterRegex)\n\n    if (!match) {\n      return { content: markdown }\n    }\n\n    const [, frontmatterYaml, content] = match\n\n    try {\n      // Simple YAML parser for frontmatter\n      const metadata: Record<string, any> = {}\n      const lines = frontmatterYaml.split('\\n')\n\n      for (const line of lines) {\n        const colonIndex = line.indexOf(':')\n        if (colonIndex === -1) continue\n\n        const key = line.substring(0, colonIndex).trim()\n        const value = line.substring(colonIndex + 1).trim()\n\n        // Remove quotes\n        metadata[key] = value.replace(/^[\"']|[\"']$/g, '')\n      }\n\n      return { content, metadata }\n    } catch (error) {\n      console.warn('Failed to parse frontmatter, using raw markdown:', error)\n      return { content: markdown }\n    }\n  }\n\n  /**\n   * Register a custom Handlebars helper\n   */\n  registerHelper(name: string, fn: (...args: any[]) => any): void {\n    this.handlebars.registerHelper(name, fn)\n  }\n\n  /**\n   * Register a Handlebars partial\n   */\n  registerPartial(name: string, template: string): void {\n    this.handlebars.registerPartial(name, template)\n  }\n}\n\n/**\n * Global docs manager instance\n */\nlet globalManager: DocsManager | null = null\n\n/**\n * Get or create the global docs manager\n */\nexport function getGlobalDocsManager(config?: DocsManagerConfig): DocsManager {\n  if (!globalManager) {\n    globalManager = new DocsManager(config)\n  }\n  return globalManager\n}\n","/**\n * Docs Directory Loader\n *\n * Loads and manages the docs/ first-class component directory.\n * Handles:\n * - Loading docs/docs.yaml or docs/docs.ts definition\n * - Loading markdown pages from docs/*.md\n * - Parsing frontmatter metadata\n * - Building navigation from file structure\n */\n\nimport { DocsManager } from './docs-manager.js'\nimport type {\n  DocsDefinition,\n  DocsPage,\n  DocsFrontmatter,\n  DocsNavItem,\n  DocsRouteConfig,\n} from './types.js'\nimport {\n  DEFAULT_DOCS_DEFINITION,\n  mergeDocsDefinition,\n  isReservedRoute,\n  RESERVED_ROUTES,\n} from './types.js'\nimport { createLogger } from '../observability/index.js'\n\nconst logger = createLogger({ serviceName: 'docs-loader' })\n\n/**\n * Docs directory loader\n *\n * Manages the docs/ first-class component directory:\n * - Loads definition from docs/docs.yaml\n * - Loads markdown pages\n * - Builds navigation\n * - Renders pages with Handlebars\n */\nexport class DocsDirectoryLoader {\n  private definition: DocsDefinition = DEFAULT_DOCS_DEFINITION\n  private pages = new Map<string, DocsPage>()\n  private manager: DocsManager\n  private basePath: string = '/docs'\n  private initialized = false\n\n  constructor() {\n    this.manager = new DocsManager({\n      cacheEnabled: true,\n      handlebarsEnabled: true,\n    })\n  }\n\n  /**\n   * Initialize with docs definition and markdown pages\n   *\n   * @param definition - Docs definition from docs/docs.yaml or docs/docs.ts\n   * @param markdownFiles - Map of file paths to markdown content\n   */\n  async init(\n    definition: Partial<DocsDefinition> | undefined,\n    markdownFiles: Map<string, string>\n  ): Promise<void> {\n    // Merge with defaults\n    this.definition = mergeDocsDefinition(definition)\n    this.basePath = this.definition.route?.path || '/docs'\n\n    // Load markdown pages\n    for (const [filePath, content] of markdownFiles) {\n      const page = this.parseMarkdownPage(filePath, content)\n      if (page && !isReservedRoute(page.slug)) {\n        this.pages.set(page.slug, page)\n        // Register with DocsManager for Handlebars rendering\n        this.manager.loadFromMarkdown(content, page.slug)\n      }\n    }\n\n    this.initialized = true\n    logger.info(`Docs loader initialized with ${this.pages.size} pages`)\n  }\n\n  /**\n   * Parse a markdown file into a DocsPage\n   */\n  private parseMarkdownPage(filePath: string, content: string): DocsPage | null {\n    // Extract slug from file path (e.g., 'getting-started.md' -> 'getting-started')\n    const fileName = filePath.split('/').pop()\n    if (!fileName) return null\n\n    const slug = fileName.replace(/\\.md$/, '')\n\n    // Skip docs.yaml, docs.ts, README\n    if (slug === 'docs' || slug === 'README') {\n      return null\n    }\n\n    // Parse frontmatter\n    const { frontmatter, body } = this.parseFrontmatter(content)\n\n    // Extract title from frontmatter or first heading\n    const title = frontmatter.title || this.extractTitleFromContent(body) || this.slugToTitle(slug)\n\n    // Determine order\n    const order = frontmatter.order ?? this.getOrderFromNav(slug) ?? 999\n\n    return {\n      slug,\n      path: filePath,\n      content: body,\n      frontmatter,\n      title,\n      order,\n    }\n  }\n\n  /**\n   * Parse YAML frontmatter from markdown\n   */\n  private parseFrontmatter(content: string): { frontmatter: DocsFrontmatter; body: string } {\n    const frontmatterRegex = /^---\\s*\\n([\\s\\S]*?)\\n---\\s*\\n([\\s\\S]*)$/\n    const match = content.match(frontmatterRegex)\n\n    if (!match) {\n      return { frontmatter: {}, body: content }\n    }\n\n    const [, yaml, body] = match\n\n    try {\n      // Simple YAML parser for frontmatter\n      const frontmatter: DocsFrontmatter = {}\n      const lines = yaml.split('\\n')\n\n      for (const line of lines) {\n        const colonIndex = line.indexOf(':')\n        if (colonIndex === -1) continue\n\n        const key = line.substring(0, colonIndex).trim()\n        let value: string | number | boolean = line.substring(colonIndex + 1).trim()\n\n        // Remove quotes\n        value = value.replace(/^[\"']|[\"']$/g, '')\n\n        // Parse booleans and numbers into proper types\n        let parsedValue: string | number | boolean = value\n        if (value === 'true') parsedValue = true\n        else if (value === 'false') parsedValue = false\n        else if (/^\\d+$/.test(value)) parsedValue = parseInt(value, 10)\n\n        value = parsedValue\n\n        frontmatter[key] = value\n      }\n\n      return { frontmatter, body }\n    } catch (error) {\n      logger.warn('Failed to parse frontmatter', { error: String(error) })\n      return { frontmatter: {}, body: content }\n    }\n  }\n\n  /**\n   * Extract title from first heading in markdown\n   */\n  private extractTitleFromContent(content: string): string | null {\n    const headingMatch = content.match(/^#\\s+(.+)$/m)\n    return headingMatch ? headingMatch[1].trim() : null\n  }\n\n  /**\n   * Convert slug to title (e.g., 'getting-started' -> 'Getting Started')\n   */\n  private slugToTitle(slug: string): string {\n    return slug\n      .split('-')\n      .map((word) => word.charAt(0).toUpperCase() + word.slice(1))\n      .join(' ')\n  }\n\n  /**\n   * Get order from nav config\n   */\n  private getOrderFromNav(slug: string): number | null {\n    const navOrder = this.definition.nav?.order\n    if (!navOrder) return null\n    const index = navOrder.indexOf(slug)\n    return index >= 0 ? index : null\n  }\n\n  /**\n   * Get the docs definition\n   */\n  getDefinition(): DocsDefinition {\n    return this.definition\n  }\n\n  /**\n   * Get route configuration\n   */\n  getRouteConfig(): DocsRouteConfig {\n    return this.definition.route || DEFAULT_DOCS_DEFINITION.route!\n  }\n\n  /**\n   * Get base path for docs (e.g., '/docs', '/help', '/reference')\n   */\n  getBasePath(): string {\n    return this.basePath\n  }\n\n  /**\n   * Get a page by slug\n   */\n  getPage(slug: string): DocsPage | null {\n    return this.pages.get(slug) || null\n  }\n\n  /**\n   * Get all pages\n   */\n  getAllPages(): DocsPage[] {\n    return Array.from(this.pages.values())\n  }\n\n  /**\n   * Get pages sorted by order\n   */\n  getSortedPages(): DocsPage[] {\n    const hidden = new Set(this.definition.nav?.hide || [])\n    return Array.from(this.pages.values())\n      .filter((page) => !page.frontmatter.hidden && !hidden.has(page.slug))\n      .sort((a, b) => a.order - b.order)\n  }\n\n  /**\n   * Build navigation items\n   */\n  buildNavigation(activePath?: string): DocsNavItem[] {\n    const items: DocsNavItem[] = []\n    const showReserved = this.definition.nav?.showReserved\n\n    // Add markdown pages\n    for (const page of this.getSortedPages()) {\n      items.push({\n        slug: page.slug,\n        title: page.title,\n        icon: page.frontmatter.icon,\n        path: `${this.basePath}/${page.slug}`,\n        active: activePath === page.slug,\n        reserved: false,\n      })\n    }\n\n    // Add reserved sections\n    if (showReserved?.agents !== false) {\n      items.push({\n        slug: 'agents',\n        title: 'Agents',\n        icon: '',\n        path: `${this.basePath}/agents`,\n        active: activePath === 'agents',\n        reserved: true,\n      })\n    }\n\n    if (showReserved?.ensembles !== false) {\n      items.push({\n        slug: 'ensembles',\n        title: 'Ensembles',\n        icon: '',\n        path: `${this.basePath}/ensembles`,\n        active: activePath === 'ensembles',\n        reserved: true,\n      })\n    }\n\n    if (showReserved?.api !== false) {\n      items.push({\n        slug: 'api',\n        title: 'API Reference',\n        icon: '',\n        path: `${this.basePath}/api`,\n        active: activePath === 'api',\n        reserved: true,\n      })\n    }\n\n    return items\n  }\n\n  /**\n   * Render a page with Handlebars variables\n   */\n  async renderPage(\n    slug: string,\n    variables?: Record<string, unknown>\n  ): Promise<{ content: string; page: DocsPage } | null> {\n    const page = this.pages.get(slug)\n    if (!page) return null\n\n    try {\n      const rendered = await this.manager.renderByName(slug, { variables })\n      return {\n        content: rendered.content,\n        page,\n      }\n    } catch (error) {\n      logger.error(`Failed to render page: ${slug}`, error instanceof Error ? error : undefined)\n      return null\n    }\n  }\n\n  /**\n   * Check if docs are initialized\n   */\n  isInitialized(): boolean {\n    return this.initialized\n  }\n\n  /**\n   * Get page count\n   */\n  getPageCount(): number {\n    return this.pages.size\n  }\n\n  /**\n   * Register a custom Handlebars helper\n   */\n  registerHelper(name: string, fn: (...args: unknown[]) => unknown): void {\n    this.manager.registerHelper(name, fn)\n  }\n\n  /**\n   * Register a Handlebars partial\n   */\n  registerPartial(name: string, template: string): void {\n    this.manager.registerPartial(name, template)\n  }\n\n  /**\n   * Get registry data for discovery\n   *\n   * Returns a Map suitable for passing to the Executor's discovery data.\n   * This enables agents to discover available documentation pages.\n   *\n   * @example\n   * ```typescript\n   * const executor = new Executor({\n   *   env,\n   *   ctx,\n   *   discovery: {\n   *     docs: docsLoader.getRegistryData(),\n   *   }\n   * });\n   * ```\n   */\n  getRegistryData(): Map<string, { content: string; title: string; slug: string }> {\n    const result = new Map<string, { content: string; title: string; slug: string }>()\n    for (const [slug, page] of this.pages) {\n      result.set(slug, {\n        content: page.content,\n        title: page.title,\n        slug: page.slug,\n      })\n    }\n    return result\n  }\n}\n\n/**\n * Global docs loader instance\n */\nlet globalLoader: DocsDirectoryLoader | null = null\n\n/**\n * Get or create the global docs loader\n */\nexport function getDocsLoader(): DocsDirectoryLoader {\n  if (!globalLoader) {\n    globalLoader = new DocsDirectoryLoader()\n  }\n  return globalLoader\n}\n\n/**\n * Set the global docs loader (for testing)\n */\nexport function setDocsLoader(loader: DocsDirectoryLoader | null): void {\n  globalLoader = loader\n}\n\n/**\n * Reset the global docs loader\n */\nexport function resetDocsLoader(): void {\n  globalLoader = null\n}\n","/**\n * Step Primitives\n *\n * Functions for creating agent execution steps programmatically.\n * These produce the same objects as YAML parsing.\n */\n\nimport type {\n  AgentFlowStep,\n  AgentStepConfig,\n  FlowStepType,\n  OperationType,\n  RetryConfig,\n  CacheConfig,\n  ScoringConfig,\n  StateAccessConfig,\n  TimeoutConfig,\n} from './types.js'\n\n/**\n * Configuration options for creating a step\n */\nexport interface StepOptions {\n  /** Operation type (think, code, http, etc.) - used when referencing inline agent */\n  operation?: OperationType\n\n  /** Script path for code operations */\n  script?: string\n\n  /** Agent-specific configuration */\n  config?: Record<string, unknown>\n\n  /** Input data mapping (supports expression syntax like ${previous.output}) */\n  input?: Record<string, unknown>\n\n  /** Conditional execution expression */\n  condition?: unknown\n\n  /** Alias for condition */\n  when?: unknown\n\n  /** Step identifier for referencing in expressions */\n  id?: string\n\n  /** Dependencies (step names that must complete first) */\n  depends_on?: string[]\n\n  /** Retry configuration */\n  retry?: RetryConfig\n\n  /** Timeout in milliseconds */\n  timeout?: number\n\n  /** Timeout behavior */\n  onTimeout?: TimeoutConfig\n\n  /** Cache configuration */\n  cache?: CacheConfig\n\n  /** Scoring configuration */\n  scoring?: ScoringConfig\n\n  /** State access configuration */\n  state?: StateAccessConfig\n}\n\n/**\n * Create an agent execution step\n *\n * @param name - Agent name to execute\n * @param options - Step configuration options\n * @returns AgentFlowStep object\n *\n * @example\n * ```typescript\n * // Simple step\n * step('fetch-data')\n *\n * // Step with operation and config\n * step('analyze', {\n *   operation: 'think',\n *   config: {\n *     model: 'claude-sonnet-4',\n *     prompt: 'Analyze this data: ${input.data}'\n *   }\n * })\n *\n * // Step with input mapping\n * step('transform', {\n *   script: 'scripts/transform',\n *   input: {\n *     data: '${fetch-data.output}'\n *   }\n * })\n *\n * // Step with retry and timeout\n * step('external-api', {\n *   operation: 'http',\n *   config: { url: 'https://api.example.com' },\n *   retry: { attempts: 3, backoff: 'exponential' },\n *   timeout: 5000\n * })\n * ```\n */\nexport function step(name: string, options: StepOptions = {}): AgentFlowStep {\n  const {\n    operation,\n    script,\n    config,\n    input,\n    condition,\n    when,\n    id,\n    depends_on,\n    retry,\n    timeout,\n    onTimeout,\n    cache,\n    scoring,\n    state,\n  } = options\n\n  // Build the step object\n  const agentStep: AgentFlowStep = {\n    agent: name,\n  }\n\n  // Add optional fields only if provided\n  if (id !== undefined) agentStep.id = id\n  if (input !== undefined) agentStep.input = input\n  if (condition !== undefined) agentStep.condition = condition\n  if (when !== undefined) agentStep.when = when\n  if (depends_on !== undefined) agentStep.depends_on = depends_on\n  if (retry !== undefined) agentStep.retry = retry\n  if (timeout !== undefined) agentStep.timeout = timeout\n  if (onTimeout !== undefined) agentStep.onTimeout = onTimeout\n  if (cache !== undefined) agentStep.cache = cache\n  if (scoring !== undefined) agentStep.scoring = scoring\n  if (state !== undefined) agentStep.state = state\n\n  // Handle operation/script/config - these go into the step for inline agents\n  // When the step references a pre-defined agent, these are ignored\n  // When the step IS the agent definition, these define it\n  if (operation !== undefined || script !== undefined || config !== undefined) {\n    // For inline agent definition, we store these in a way the executor understands\n    // The executor will create an inline agent from these properties\n    ;(agentStep as AgentFlowStep & AgentStepConfig).operation = operation\n    ;(agentStep as AgentFlowStep & AgentStepConfig).script = script\n    ;(agentStep as AgentFlowStep & AgentStepConfig).config = config\n  }\n\n  return agentStep\n}\n\n/**\n * Create a sequence of steps (explicit sequential execution)\n *\n * This is syntactic sugar - it simply returns the array of steps.\n * Steps in an array are executed sequentially by default.\n *\n * @param steps - Steps to execute in sequence\n * @returns Array of steps\n *\n * @example\n * ```typescript\n * sequence(\n *   step('fetch'),\n *   step('transform'),\n *   step('store')\n * )\n * ```\n */\nexport function sequence(...steps: FlowStepType[]): FlowStepType[] {\n  return steps\n}\n\n/**\n * Create a step that executes a script\n *\n * Shorthand for step() with script config.\n *\n * @param name - Step name\n * @param scriptPath - Path to the script\n * @param options - Additional step options\n * @returns AgentFlowStep\n *\n * @example\n * ```typescript\n * scriptStep('transform', 'scripts/transform-data', {\n *   input: { data: '${fetch.output}' }\n * })\n * ```\n */\nexport function scriptStep(\n  name: string,\n  scriptPath: string,\n  options: Omit<StepOptions, 'script' | 'operation'> = {}\n): AgentFlowStep {\n  return step(name, {\n    ...options,\n    operation: 'code',\n    script: scriptPath,\n  })\n}\n\n/**\n * Create a step that calls an HTTP endpoint\n *\n * Shorthand for step() with http operation.\n *\n * @param name - Step name\n * @param url - URL to call\n * @param options - HTTP and step options\n * @returns AgentFlowStep\n *\n * @example\n * ```typescript\n * httpStep('fetch-users', 'https://api.example.com/users', {\n *   method: 'GET',\n *   headers: { 'Authorization': 'Bearer ${env.API_KEY}' }\n * })\n * ```\n */\nexport function httpStep(\n  name: string,\n  url: string,\n  options: Omit<StepOptions, 'operation'> & {\n    method?: 'GET' | 'POST' | 'PUT' | 'PATCH' | 'DELETE'\n    headers?: Record<string, string>\n    body?: unknown\n  } = {}\n): AgentFlowStep {\n  const { method, headers, body, ...stepOptions } = options\n\n  const config: Record<string, unknown> = {\n    url,\n    method: method ?? 'GET',\n  }\n  if (headers) config.headers = headers\n  if (body !== undefined) config.body = body\n\n  return step(name, {\n    ...stepOptions,\n    operation: 'http',\n    config,\n  })\n}\n\n/**\n * Create a step that uses AI reasoning\n *\n * Shorthand for step() with think operation.\n *\n * @param name - Step name\n * @param prompt - Prompt for the AI\n * @param options - Think and step options\n * @returns AgentFlowStep\n *\n * @example\n * ```typescript\n * thinkStep('analyze', 'Analyze this data and extract insights: ${input.data}', {\n *   model: 'claude-sonnet-4',\n *   temperature: 0.7\n * })\n * ```\n */\nexport function thinkStep(\n  name: string,\n  prompt: string,\n  options: Omit<StepOptions, 'operation'> & {\n    model?: string\n    provider?: string\n    temperature?: number\n    maxTokens?: number\n    systemPrompt?: string\n  } = {}\n): AgentFlowStep {\n  const { model, provider, temperature, maxTokens, systemPrompt, ...stepOptions } = options\n\n  return step(name, {\n    ...stepOptions,\n    operation: 'think',\n    config: {\n      prompt,\n      ...(model && { model }),\n      ...(provider && { provider }),\n      ...(temperature !== undefined && { temperature }),\n      ...(maxTokens && { maxTokens }),\n      ...(systemPrompt && { systemPrompt }),\n    },\n  })\n}\n\n/**\n * Create a step that stores data\n *\n * Shorthand for step() with storage operation.\n *\n * @param name - Step name\n * @param action - Storage action (get, put, delete, list)\n * @param options - Storage and step options\n * @returns AgentFlowStep\n *\n * @example\n * ```typescript\n * storageStep('cache-result', 'put', {\n *   binding: 'CACHE',\n *   key: 'result-${input.id}',\n *   value: '${transform.output}'\n * })\n * ```\n */\nexport function storageStep(\n  name: string,\n  action: 'get' | 'put' | 'delete' | 'list',\n  options: Omit<StepOptions, 'operation'> & {\n    binding: string\n    type?: 'kv' | 'r2' | 'cache'\n    key?: string\n    value?: unknown\n    prefix?: string\n  } = { binding: '' }\n): AgentFlowStep {\n  const { binding, type, key, value, prefix, ...stepOptions } = options\n\n  return step(name, {\n    ...stepOptions,\n    operation: 'storage',\n    config: {\n      action,\n      binding,\n      ...(type && { type }),\n      ...(key && { key }),\n      ...(value !== undefined && { value }),\n      ...(prefix && { prefix }),\n    },\n  })\n}\n\n/**\n * Create a step that queries a database\n *\n * Shorthand for step() with data operation.\n *\n * @param name - Step name\n * @param query - SQL query or action\n * @param options - Data and step options\n * @returns AgentFlowStep\n *\n * @example\n * ```typescript\n * dataStep('get-users', 'SELECT * FROM users WHERE active = ?', {\n *   binding: 'DB',\n *   params: [true]\n * })\n * ```\n */\nexport function dataStep(\n  name: string,\n  query: string,\n  options: Omit<StepOptions, 'operation'> & {\n    binding: string\n    type?: 'd1' | 'hyperdrive' | 'vectorize'\n    params?: unknown[]\n  } = { binding: '' }\n): AgentFlowStep {\n  const { binding, type, params, ...stepOptions } = options\n\n  return step(name, {\n    ...stepOptions,\n    operation: 'data',\n    config: {\n      query,\n      binding,\n      ...(type && { type }),\n      ...(params && { params }),\n    },\n  })\n}\n\n/**\n * Create a step that sends an email\n *\n * Shorthand for step() with email operation.\n *\n * @param name - Step name\n * @param options - Email and step options\n * @returns AgentFlowStep\n *\n * @example\n * ```typescript\n * emailStep('send-notification', {\n *   to: ['user@example.com'],\n *   subject: 'Your order is ready',\n *   body: '${transform.output.emailBody}'\n * })\n * ```\n */\nexport function emailStep(\n  name: string,\n  options: Omit<StepOptions, 'operation'> & {\n    to: string[]\n    subject?: string\n    body?: string\n    from?: string\n    template?: string\n  }\n): AgentFlowStep {\n  const { to, subject, body, from, template, ...stepOptions } = options\n\n  return step(name, {\n    ...stepOptions,\n    operation: 'email',\n    config: {\n      to,\n      ...(subject && { subject }),\n      ...(body && { body }),\n      ...(from && { from }),\n      ...(template && { template }),\n    },\n  })\n}\n\n/**\n * Create a step that references an existing agent by name\n *\n * This is useful when you want to explicitly call an agent defined elsewhere.\n *\n * @param agentName - Name of the agent to reference\n * @param options - Step options (input mapping, conditions, etc.)\n * @returns AgentFlowStep\n *\n * @example\n * ```typescript\n * agentStep('my-analyzer', {\n *   input: { data: '${fetch.output}' }\n * })\n * ```\n */\nexport function agentStep(\n  agentName: string,\n  options: Omit<StepOptions, 'operation' | 'script'> = {}\n): AgentFlowStep {\n  return step(agentName, options)\n}\n","/**\n * Flow Control Primitives\n *\n * Functions for creating control flow structures in ensembles.\n * These produce the same objects as YAML parsing.\n */\n\nimport type {\n  FlowStepType,\n  ParallelFlowStep,\n  BranchFlowStep,\n  ForeachFlowStep,\n  TryFlowStep,\n  SwitchFlowStep,\n  WhileFlowStep,\n  MapReduceFlowStep,\n  ParallelOptions,\n  BranchOptions,\n  ForeachOptions,\n  TryOptions,\n  WhileOptions,\n  MapReduceOptions,\n} from './types.js'\n\n// Re-export option types for convenience\nexport type { ParallelOptions, BranchOptions, TryOptions }\nexport type { ForeachOptions as LoopOptions }\n\n/**\n * Create a parallel execution block\n *\n * Executes multiple steps concurrently for better performance.\n *\n * @param steps - Steps to execute in parallel\n * @param options - Parallel execution options\n * @returns ParallelFlowStep\n *\n * @example\n * ```typescript\n * // Wait for all steps to complete (default)\n * parallel([\n *   step('fetch-users'),\n *   step('fetch-products'),\n *   step('fetch-orders')\n * ])\n *\n * // Wait for any one step to complete\n * parallel([\n *   step('primary-api'),\n *   step('fallback-api')\n * ], { waitFor: 'any' })\n *\n * // Wait for first step to complete (ignore others)\n * parallel([\n *   step('fast-search'),\n *   step('comprehensive-search')\n * ], { waitFor: 'first' })\n * ```\n */\nexport function parallel(steps: FlowStepType[], options: ParallelOptions = {}): ParallelFlowStep {\n  return {\n    type: 'parallel',\n    steps,\n    waitFor: options.waitFor ?? 'all',\n  }\n}\n\n/**\n * Create a conditional branch\n *\n * Executes different steps based on a condition.\n *\n * @param condition - Condition expression (supports ${} syntax)\n * @param options - Branch options with then/else steps\n * @returns BranchFlowStep\n *\n * @example\n * ```typescript\n * // Simple if/then\n * branch('${input.premium}', {\n *   then: [step('premium-flow')]\n * })\n *\n * // If/then/else\n * branch('${validate.output.valid}', {\n *   then: [\n *     step('process'),\n *     step('notify-success')\n *   ],\n *   else: [\n *     step('log-error'),\n *     step('notify-failure')\n *   ]\n * })\n *\n * // Complex condition\n * branch('${input.amount > 1000 && input.verified}', {\n *   then: [step('high-value-flow')],\n *   else: [step('standard-flow')]\n * })\n * ```\n */\nexport function branch(condition: unknown, options: BranchOptions): BranchFlowStep {\n  return {\n    type: 'branch',\n    condition,\n    then: options.then,\n    ...(options.else && { else: options.else }),\n  }\n}\n\n/**\n * Create an if/then shorthand (alias for branch without else)\n *\n * @param condition - Condition expression\n * @param steps - Steps to execute if condition is true\n * @returns BranchFlowStep\n *\n * @example\n * ```typescript\n * ifThen('${input.sendEmail}', [\n *   step('send-confirmation-email')\n * ])\n * ```\n */\nexport function ifThen(condition: unknown, steps: FlowStepType[]): BranchFlowStep {\n  return branch(condition, { then: steps })\n}\n\n/**\n * Create an if/then/else shorthand\n *\n * @param condition - Condition expression\n * @param thenSteps - Steps to execute if condition is true\n * @param elseSteps - Steps to execute if condition is false\n * @returns BranchFlowStep\n *\n * @example\n * ```typescript\n * ifThenElse('${input.premium}',\n *   [step('premium-flow')],\n *   [step('standard-flow')]\n * )\n * ```\n */\nexport function ifThenElse(\n  condition: unknown,\n  thenSteps: FlowStepType[],\n  elseSteps: FlowStepType[]\n): BranchFlowStep {\n  return branch(condition, { then: thenSteps, else: elseSteps })\n}\n\n/**\n * Create a foreach iteration\n *\n * Iterates over a collection and executes steps for each item.\n *\n * @param items - Collection to iterate (expression like ${input.items})\n * @param stepToExecute - Step to execute for each item\n * @param options - Foreach options\n * @returns ForeachFlowStep\n *\n * @example\n * ```typescript\n * // Process each item sequentially\n * foreach('${input.users}', step('process-user', {\n *   input: { user: '${item}' }\n * }))\n *\n * // Process with concurrency limit\n * foreach('${input.urls}', step('fetch-url', {\n *   input: { url: '${item}' }\n * }), { maxConcurrency: 5 })\n *\n * // Early exit on condition\n * foreach('${input.records}', step('validate'), {\n *   breakWhen: '${item.output.invalid}'\n * })\n * ```\n */\nexport function foreach(\n  items: unknown,\n  stepToExecute: FlowStepType,\n  options: ForeachOptions = {}\n): ForeachFlowStep {\n  return {\n    type: 'foreach',\n    items,\n    step: stepToExecute,\n    ...(options.maxConcurrency && { maxConcurrency: options.maxConcurrency }),\n    ...(options.breakWhen !== undefined && { breakWhen: options.breakWhen }),\n  }\n}\n\n/**\n * Create a try/catch/finally block\n *\n * Handles errors gracefully with optional recovery steps.\n *\n * @param steps - Steps to try\n * @param options - Catch and finally handlers\n * @returns TryFlowStep\n *\n * @example\n * ```typescript\n * // Try with catch\n * tryStep([\n *   step('risky-operation')\n * ], {\n *   catch: [step('handle-error')]\n * })\n *\n * // Try with catch and finally\n * tryStep([\n *   step('open-connection'),\n *   step('process-data')\n * ], {\n *   catch: [step('log-error')],\n *   finally: [step('close-connection')]\n * })\n *\n * // Nested try blocks\n * tryStep([\n *   step('outer-operation'),\n *   tryStep([step('inner-operation')], {\n *     catch: [step('inner-recovery')]\n *   })\n * ], {\n *   catch: [step('outer-recovery')]\n * })\n * ```\n */\nexport function tryStep(steps: FlowStepType[], options: TryOptions = {}): TryFlowStep {\n  return {\n    type: 'try',\n    steps,\n    ...(options.catch && { catch: options.catch }),\n    ...(options.finally && { finally: options.finally }),\n  }\n}\n\n/**\n * Create a switch/case block\n *\n * Multi-way branching based on a value.\n *\n * @param value - Value to switch on (expression)\n * @param cases - Map of case values to steps\n * @param defaultCase - Steps to execute if no case matches\n * @returns SwitchFlowStep\n *\n * @example\n * ```typescript\n * // Simple switch\n * switchStep('${input.type}', {\n *   'create': [step('handle-create')],\n *   'update': [step('handle-update')],\n *   'delete': [step('handle-delete')]\n * })\n *\n * // Switch with default\n * switchStep('${classify.output.category}', {\n *   'urgent': [step('priority-queue')],\n *   'normal': [step('standard-queue')]\n * }, [step('low-priority-queue')])\n *\n * // Switch with multiple steps per case\n * switchStep('${input.plan}', {\n *   'enterprise': [\n *     step('unlock-features'),\n *     step('assign-account-manager'),\n *     step('setup-sla')\n *   ],\n *   'pro': [\n *     step('unlock-features')\n *   ]\n * }, [step('basic-setup')])\n * ```\n */\nexport function switchStep(\n  value: unknown,\n  cases: Record<string, FlowStepType[]>,\n  defaultCase?: FlowStepType[]\n): SwitchFlowStep {\n  return {\n    type: 'switch',\n    value,\n    cases,\n    ...(defaultCase && { default: defaultCase }),\n  }\n}\n\n/**\n * Create a while loop\n *\n * Repeats steps while a condition is true.\n *\n * @param condition - Condition to check (expression)\n * @param steps - Steps to repeat\n * @param options - Loop options (maxIterations for safety)\n * @returns WhileFlowStep\n *\n * @example\n * ```typescript\n * // Simple while loop\n * whileStep('${state.hasMore}', [\n *   step('fetch-page'),\n *   step('process-page')\n * ])\n *\n * // While with safety limit\n * whileStep('${state.retryNeeded}', [\n *   step('attempt-operation')\n * ], { maxIterations: 5 })\n *\n * // Pagination loop\n * whileStep('${state.nextCursor}', [\n *   step('fetch-batch', {\n *     input: { cursor: '${state.nextCursor}' }\n *   }),\n *   step('process-batch')\n * ], { maxIterations: 100 })\n * ```\n */\nexport function whileStep(\n  condition: unknown,\n  steps: FlowStepType[],\n  options: WhileOptions = {}\n): WhileFlowStep {\n  return {\n    type: 'while',\n    condition,\n    steps,\n    maxIterations: options.maxIterations ?? 100, // Default safety limit\n  }\n}\n\n/**\n * Create a do-while loop (executes at least once)\n *\n * Syntactic sugar that creates a sequence with initial execution + while loop.\n *\n * @param steps - Steps to repeat\n * @param condition - Condition to check after each iteration\n * @param options - Loop options\n * @returns Array of steps (initial + while)\n *\n * @example\n * ```typescript\n * doWhile([\n *   step('fetch-data'),\n *   step('process')\n * ], '${state.hasMore}')\n * ```\n */\nexport function doWhile(\n  steps: FlowStepType[],\n  condition: unknown,\n  options: WhileOptions = {}\n): FlowStepType[] {\n  return [\n    ...steps, // Execute once\n    whileStep(condition, steps, options), // Then loop if condition is true\n  ]\n}\n\n/**\n * Create a do-until loop (executes until condition becomes true)\n *\n * Opposite of do-while - continues while condition is false.\n *\n * @param steps - Steps to repeat\n * @param condition - Condition that stops the loop when true\n * @param options - Loop options\n * @returns Array of steps\n *\n * @example\n * ```typescript\n * doUntil([\n *   step('poll-status')\n * ], '${state.completed}', { maxIterations: 30 })\n * ```\n */\nexport function doUntil(\n  steps: FlowStepType[],\n  condition: unknown,\n  options: WhileOptions = {}\n): FlowStepType[] {\n  // Negate the condition for while\n  const negatedCondition = typeof condition === 'string' ? `!(${condition})` : { $not: condition }\n\n  return [...steps, whileStep(negatedCondition, steps, options)]\n}\n\n/**\n * Create a map-reduce operation\n *\n * Process items in parallel (map) then aggregate results (reduce).\n *\n * @param items - Collection to process (expression)\n * @param mapStep - Step to execute for each item\n * @param reduceStep - Step to aggregate results\n * @param options - Map-reduce options\n * @returns MapReduceFlowStep\n *\n * @example\n * ```typescript\n * // Parallel processing with aggregation\n * mapReduce(\n *   '${input.documents}',\n *   step('analyze-document', {\n *     input: { doc: '${item}' }\n *   }),\n *   step('combine-analyses', {\n *     input: { analyses: '${results}' }\n *   })\n * )\n *\n * // With concurrency limit\n * mapReduce(\n *   '${input.urls}',\n *   step('fetch-url'),\n *   step('merge-responses'),\n *   { maxConcurrency: 10 }\n * )\n * ```\n */\nexport function mapReduce(\n  items: unknown,\n  mapStep: FlowStepType,\n  reduceStep: FlowStepType,\n  options: MapReduceOptions = {}\n): MapReduceFlowStep {\n  return {\n    type: 'map-reduce',\n    items,\n    map: mapStep,\n    reduce: reduceStep,\n    ...(options.maxConcurrency && { maxConcurrency: options.maxConcurrency }),\n  }\n}\n\n/**\n * Create a map transformation (without reduce)\n *\n * Syntactic sugar for foreach that collects all results.\n *\n * @param items - Collection to transform\n * @param stepToExecute - Transformation step\n * @param options - Map options\n * @returns ForeachFlowStep configured for mapping\n *\n * @example\n * ```typescript\n * map('${input.ids}', step('fetch-by-id', {\n *   input: { id: '${item}' }\n * }))\n * ```\n */\nexport function map(\n  items: unknown,\n  stepToExecute: FlowStepType,\n  options: ForeachOptions = {}\n): ForeachFlowStep {\n  return foreach(items, stepToExecute, options)\n}\n\n/**\n * Create a repeat loop (fixed number of iterations)\n *\n * @param count - Number of iterations\n * @param steps - Steps to repeat\n * @returns ForeachFlowStep over a range\n *\n * @example\n * ```typescript\n * repeat(3, [\n *   step('retry-operation')\n * ])\n * ```\n */\nexport function repeat(count: number, steps: FlowStepType[]): ForeachFlowStep {\n  // Create an array of indices to iterate over\n  return {\n    type: 'foreach',\n    items: `\\${Array.from({length: ${count}}, (_, i) => i)}`,\n    step:\n      steps.length === 1\n        ? steps[0]\n        : ({ type: 'parallel', steps, waitFor: 'all' } as ParallelFlowStep),\n  }\n}\n\n/**\n * Create a race condition (first to complete wins)\n *\n * Alias for parallel with waitFor: 'first'.\n *\n * @param steps - Steps to race\n * @returns ParallelFlowStep configured for racing\n *\n * @example\n * ```typescript\n * race([\n *   step('fast-api'),\n *   step('slow-api')\n * ])\n * ```\n */\nexport function race(steps: FlowStepType[]): ParallelFlowStep {\n  return parallel(steps, { waitFor: 'first' })\n}\n\n/**\n * Create a fallback chain (try each until one succeeds)\n *\n * Tries each step in order, stopping at first success.\n *\n * @param steps - Steps to try in order\n * @returns TryFlowStep chain\n *\n * @example\n * ```typescript\n * fallback([\n *   step('primary-service'),\n *   step('secondary-service'),\n *   step('tertiary-service')\n * ])\n * ```\n */\nexport function fallback(steps: FlowStepType[]): FlowStepType {\n  if (steps.length === 0) {\n    throw new Error('fallback requires at least one step')\n  }\n\n  if (steps.length === 1) {\n    return steps[0]\n  }\n\n  // Build nested try/catch chain\n  // try step[0] catch try step[1] catch try step[2] ...\n  let result: FlowStepType = steps[steps.length - 1]\n\n  for (let i = steps.length - 2; i >= 0; i--) {\n    result = tryStep([steps[i]], { catch: [result] })\n  }\n\n  return result\n}\n","/**\n * Tool Primitives\n *\n * Provides primitives for defining and configuring tools that agents can use.\n * Supports MCP (Model Context Protocol) tools, custom functions, and skill integration.\n */\n\nimport type { OperationType } from '../types/operation.js'\n\n/**\n * Tool parameter definition\n */\nexport interface ToolParameter {\n  /** Parameter name */\n  name: string\n  /** Parameter type */\n  type: 'string' | 'number' | 'boolean' | 'object' | 'array'\n  /** Description for the AI model */\n  description?: string\n  /** Whether the parameter is required */\n  required?: boolean\n  /** Default value if not provided */\n  default?: unknown\n  /** Enum values for constrained parameters */\n  enum?: unknown[]\n  /** JSON Schema for complex types */\n  schema?: Record<string, unknown>\n}\n\n/**\n * Tool definition for agent use\n */\nexport interface ToolDefinition {\n  /** Tool identifier */\n  name: string\n  /** Human-readable description */\n  description: string\n  /** Input parameters */\n  parameters?: ToolParameter[]\n  /** Parameter schema (JSON Schema format) */\n  inputSchema?: Record<string, unknown>\n  /** Return type description */\n  returns?: {\n    type: string\n    description?: string\n    schema?: Record<string, unknown>\n  }\n  /** Tool metadata */\n  metadata?: Record<string, unknown>\n}\n\n/**\n * MCP Server configuration\n */\nexport interface MCPServerConfig {\n  /** Server type */\n  type: 'mcp'\n  /** Server URL or connection string */\n  url?: string\n  /** Server name for local servers */\n  name?: string\n  /** Transport type */\n  transport?: 'stdio' | 'http' | 'websocket'\n  /** Command to start the server (for stdio transport) */\n  command?: string\n  /** Arguments for the command */\n  args?: string[]\n  /** Environment variables */\n  env?: Record<string, string>\n  /** Authentication configuration */\n  auth?: {\n    type: 'bearer' | 'api-key' | 'oauth'\n    token?: string\n    secret?: string\n  }\n  /** Tool filtering - only expose these tools */\n  tools?: string[]\n  /** Tool filtering - exclude these tools */\n  excludeTools?: string[]\n}\n\n/**\n * Custom tool configuration (JavaScript function)\n */\nexport interface CustomToolConfig {\n  /** Tool type */\n  type: 'custom'\n  /** Tool definition */\n  definition: ToolDefinition\n  /** Handler function path (for bundled code) */\n  handler?: string\n  /** Inline handler (only for programmatic use) */\n  execute?: (input: Record<string, unknown>) => Promise<unknown>\n}\n\n/**\n * HTTP API tool configuration\n */\nexport interface HTTPToolConfig {\n  /** Tool type */\n  type: 'http'\n  /** Tool definition */\n  definition: ToolDefinition\n  /** API endpoint URL */\n  url: string\n  /** HTTP method */\n  method?: 'GET' | 'POST' | 'PUT' | 'PATCH' | 'DELETE'\n  /** Request headers */\n  headers?: Record<string, string>\n  /** Response mapping */\n  responseMapping?: Record<string, string>\n  /** Authentication */\n  auth?: {\n    type: 'bearer' | 'api-key' | 'basic'\n    token?: string\n    key?: string\n    secret?: string\n  }\n}\n\n/**\n * Skill reference configuration\n */\nexport interface SkillToolConfig {\n  /** Tool type */\n  type: 'skill'\n  /** Skill name to reference */\n  skill: string\n  /** Tool name within the skill */\n  tool?: string\n  /** Override configuration */\n  config?: Record<string, unknown>\n}\n\n/**\n * Union type for all tool configurations\n */\nexport type ToolConfig = MCPServerConfig | CustomToolConfig | HTTPToolConfig | SkillToolConfig\n\n/**\n * Tool collection for agent configuration\n */\nexport interface ToolCollection {\n  /** Collection name */\n  name?: string\n  /** Tools in this collection */\n  tools: ToolConfig[]\n  /** Default timeout for tool calls */\n  timeout?: number\n  /** Maximum concurrent tool calls */\n  maxConcurrent?: number\n  /** Retry configuration */\n  retry?: {\n    maxAttempts: number\n    backoff?: 'linear' | 'exponential'\n    initialDelay?: number\n  }\n}\n\n/**\n * Tool class - runtime representation of a tool configuration\n */\nexport class Tool {\n  public readonly name: string\n  public readonly description: string\n  public readonly config: ToolConfig\n  public readonly parameters?: ToolParameter[]\n  public readonly metadata?: Record<string, unknown>\n\n  constructor(config: ToolConfig) {\n    this.config = config\n\n    // Extract name and description based on tool type\n    if (config.type === 'custom' || config.type === 'http') {\n      this.name = config.definition.name\n      this.description = config.definition.description\n      this.parameters = config.definition.parameters\n      this.metadata = config.definition.metadata\n    } else if (config.type === 'mcp') {\n      this.name = config.name ?? 'mcp-server'\n      this.description = `MCP Server: ${config.url ?? config.name}`\n    } else if (config.type === 'skill') {\n      this.name = config.tool ?? config.skill\n      this.description = `Skill: ${config.skill}`\n    } else {\n      this.name = 'unknown'\n      this.description = 'Unknown tool type'\n    }\n  }\n\n  /**\n   * Check if this is an MCP server tool\n   */\n  isMCP(): this is Tool & { config: MCPServerConfig } {\n    return this.config.type === 'mcp'\n  }\n\n  /**\n   * Check if this is a custom tool\n   */\n  isCustom(): this is Tool & { config: CustomToolConfig } {\n    return this.config.type === 'custom'\n  }\n\n  /**\n   * Check if this is an HTTP tool\n   */\n  isHTTP(): this is Tool & { config: HTTPToolConfig } {\n    return this.config.type === 'http'\n  }\n\n  /**\n   * Check if this is a skill reference\n   */\n  isSkill(): this is Tool & { config: SkillToolConfig } {\n    return this.config.type === 'skill'\n  }\n\n  /**\n   * Convert to plain config object\n   */\n  toConfig(): ToolConfig {\n    return this.config\n  }\n}\n\n/**\n * Create an MCP tool configuration\n *\n * @example\n * ```typescript\n * const browserTool = mcpTool({\n *   url: 'https://mcp.example.com/browser',\n *   auth: { type: 'bearer', token: '${env.MCP_TOKEN}' },\n *   tools: ['navigate', 'screenshot', 'click']\n * });\n * ```\n */\nexport function mcpTool(config: Omit<MCPServerConfig, 'type'>): Tool {\n  return new Tool({ type: 'mcp', ...config })\n}\n\n/**\n * Create a custom tool from a function definition\n *\n * @example\n * ```typescript\n * const calculatorTool = customTool({\n *   name: 'calculator',\n *   description: 'Performs mathematical calculations',\n *   parameters: [\n *     { name: 'expression', type: 'string', required: true }\n *   ],\n *   handler: 'tools/calculator'\n * });\n * ```\n */\nexport function customTool(options: {\n  name: string\n  description: string\n  parameters?: ToolParameter[]\n  handler?: string\n  execute?: (input: Record<string, unknown>) => Promise<unknown>\n  metadata?: Record<string, unknown>\n}): Tool {\n  return new Tool({\n    type: 'custom',\n    definition: {\n      name: options.name,\n      description: options.description,\n      parameters: options.parameters,\n      metadata: options.metadata,\n    },\n    handler: options.handler,\n    execute: options.execute,\n  })\n}\n\n/**\n * Create an HTTP API tool\n *\n * @example\n * ```typescript\n * const weatherTool = httpTool({\n *   name: 'get_weather',\n *   description: 'Get current weather for a location',\n *   url: 'https://api.weather.com/v1/current',\n *   method: 'GET',\n *   parameters: [\n *     { name: 'location', type: 'string', required: true }\n *   ],\n *   auth: { type: 'api-key', key: '${env.WEATHER_API_KEY}' }\n * });\n * ```\n */\nexport function httpTool(options: {\n  name: string\n  description: string\n  url: string\n  method?: 'GET' | 'POST' | 'PUT' | 'PATCH' | 'DELETE'\n  headers?: Record<string, string>\n  parameters?: ToolParameter[]\n  auth?: HTTPToolConfig['auth']\n  metadata?: Record<string, unknown>\n}): Tool {\n  return new Tool({\n    type: 'http',\n    definition: {\n      name: options.name,\n      description: options.description,\n      parameters: options.parameters,\n      metadata: options.metadata,\n    },\n    url: options.url,\n    method: options.method,\n    headers: options.headers,\n    auth: options.auth,\n  })\n}\n\n/**\n * Create a skill reference tool\n *\n * @example\n * ```typescript\n * const searchTool = skillTool({\n *   skill: 'web-search',\n *   tool: 'search',\n *   config: { maxResults: 10 }\n * });\n * ```\n */\nexport function skillTool(options: {\n  skill: string\n  tool?: string\n  config?: Record<string, unknown>\n}): Tool {\n  return new Tool({\n    type: 'skill',\n    skill: options.skill,\n    tool: options.tool,\n    config: options.config,\n  })\n}\n\n/**\n * Create a tool from any supported configuration\n *\n * @example\n * ```typescript\n * const tool = createTool({\n *   type: 'mcp',\n *   url: 'https://mcp.example.com'\n * });\n * ```\n */\nexport function createTool(config: ToolConfig): Tool {\n  return new Tool(config)\n}\n\n/**\n * Create a tool collection\n *\n * @example\n * ```typescript\n * const tools = toolCollection({\n *   name: 'research-tools',\n *   tools: [\n *     mcpTool({ url: 'https://mcp.example.com/browser' }),\n *     httpTool({ name: 'search', url: '...' })\n *   ],\n *   timeout: 30000,\n *   maxConcurrent: 3\n * });\n * ```\n */\nexport function toolCollection(options: {\n  name?: string\n  tools: (Tool | ToolConfig)[]\n  timeout?: number\n  maxConcurrent?: number\n  retry?: ToolCollection['retry']\n}): ToolCollection {\n  return {\n    name: options.name,\n    tools: options.tools.map((t) => (t instanceof Tool ? t.toConfig() : t)),\n    timeout: options.timeout,\n    maxConcurrent: options.maxConcurrent,\n    retry: options.retry,\n  }\n}\n\n/**\n * Check if a value is a Tool instance\n */\nexport function isTool(value: unknown): value is Tool {\n  return value instanceof Tool\n}\n\n/**\n * Check if a value is a valid tool configuration\n */\nexport function isToolConfig(value: unknown): value is ToolConfig {\n  if (typeof value !== 'object' || value === null) {\n    return false\n  }\n  const config = value as Record<string, unknown>\n  return ['mcp', 'custom', 'http', 'skill'].includes(config.type as string)\n}\n","/**\n * Instruction Primitives\n *\n * Provides primitives for defining instructions, prompts, and system messages\n * that guide agent behavior. Instructions are the primary way to configure\n * how AI agents (think operation) behave.\n */\n\n/**\n * Instruction source types\n */\nexport type InstructionSource =\n  | { type: 'inline'; content: string }\n  | { type: 'file'; path: string }\n  | { type: 'template'; name: string; variables?: Record<string, unknown> }\n  | { type: 'dynamic'; generator: (context: InstructionContext) => string | Promise<string> }\n\n/**\n * Context available during instruction generation\n */\nexport interface InstructionContext {\n  /** Current input to the agent */\n  input: Record<string, unknown>\n  /** Current state */\n  state: Record<string, unknown>\n  /** Environment variables */\n  env: Record<string, unknown>\n  /** Results from previous steps */\n  results: Record<string, unknown>\n}\n\n/**\n * Instruction configuration\n */\nexport interface InstructionConfig {\n  /** Instruction name/identifier */\n  name?: string\n  /** The instruction content or source */\n  source: InstructionSource\n  /** Role for the instruction (system, user, assistant) */\n  role?: 'system' | 'user' | 'assistant'\n  /** Priority for ordering multiple instructions */\n  priority?: number\n  /** Conditional application */\n  when?: string | ((context: InstructionContext) => boolean)\n  /** Variables for template interpolation */\n  variables?: Record<string, unknown>\n  /** Cache the resolved instruction */\n  cache?: boolean\n}\n\n/**\n * Instruction class - runtime representation of an instruction\n */\nexport class Instruction {\n  public readonly name?: string\n  public readonly source: InstructionSource\n  public readonly role: 'system' | 'user' | 'assistant'\n  public readonly priority: number\n  public readonly when?: string | ((context: InstructionContext) => boolean)\n  public readonly variables?: Record<string, unknown>\n  public readonly cache: boolean\n\n  constructor(config: InstructionConfig) {\n    this.name = config.name\n    this.source = config.source\n    this.role = config.role ?? 'system'\n    this.priority = config.priority ?? 0\n    this.when = config.when\n    this.variables = config.variables\n    this.cache = config.cache ?? false\n  }\n\n  /**\n   * Check if this is an inline instruction\n   */\n  isInline(): boolean {\n    return this.source.type === 'inline'\n  }\n\n  /**\n   * Check if this is a file-based instruction\n   */\n  isFile(): boolean {\n    return this.source.type === 'file'\n  }\n\n  /**\n   * Check if this is a template instruction\n   */\n  isTemplate(): boolean {\n    return this.source.type === 'template'\n  }\n\n  /**\n   * Check if this is a dynamic instruction\n   */\n  isDynamic(): boolean {\n    return this.source.type === 'dynamic'\n  }\n\n  /**\n   * Get the raw content (for inline instructions)\n   */\n  getContent(): string | undefined {\n    if (this.source.type === 'inline') {\n      return this.source.content\n    }\n    return undefined\n  }\n\n  /**\n   * Get the file path (for file instructions)\n   */\n  getFilePath(): string | undefined {\n    if (this.source.type === 'file') {\n      return this.source.path\n    }\n    return undefined\n  }\n\n  /**\n   * Convert to plain config object\n   */\n  toConfig(): InstructionConfig {\n    return {\n      name: this.name,\n      source: this.source,\n      role: this.role,\n      priority: this.priority,\n      when: typeof this.when === 'string' ? this.when : undefined,\n      variables: this.variables,\n      cache: this.cache,\n    }\n  }\n}\n\n/**\n * Create an instruction from inline content\n *\n * @example\n * ```typescript\n * const systemPrompt = instruction(`\n *   You are a helpful assistant specialized in data analysis.\n *   Always provide clear explanations with your results.\n * `);\n * ```\n */\nexport function instruction(\n  content: string,\n  options?: Omit<InstructionConfig, 'source'>\n): Instruction {\n  return new Instruction({\n    ...options,\n    source: { type: 'inline', content },\n  })\n}\n\n/**\n * Create a system instruction\n *\n * @example\n * ```typescript\n * const system = systemInstruction(`\n *   You are an expert code reviewer.\n *   Focus on security, performance, and maintainability.\n * `);\n * ```\n */\nexport function systemInstruction(\n  content: string,\n  options?: Omit<InstructionConfig, 'source' | 'role'>\n): Instruction {\n  return new Instruction({\n    ...options,\n    source: { type: 'inline', content },\n    role: 'system',\n  })\n}\n\n/**\n * Create a user instruction (for few-shot examples or context)\n *\n * @example\n * ```typescript\n * const context = userInstruction(`\n *   Here is the code to review:\n *   ${state.code}\n * `);\n * ```\n */\nexport function userInstruction(\n  content: string,\n  options?: Omit<InstructionConfig, 'source' | 'role'>\n): Instruction {\n  return new Instruction({\n    ...options,\n    source: { type: 'inline', content },\n    role: 'user',\n  })\n}\n\n/**\n * Create an assistant instruction (for few-shot examples)\n *\n * @example\n * ```typescript\n * const example = assistantInstruction(`\n *   I found 3 potential issues in the code...\n * `);\n * ```\n */\nexport function assistantInstruction(\n  content: string,\n  options?: Omit<InstructionConfig, 'source' | 'role'>\n): Instruction {\n  return new Instruction({\n    ...options,\n    source: { type: 'inline', content },\n    role: 'assistant',\n  })\n}\n\n/**\n * Create an instruction from a file\n *\n * @example\n * ```typescript\n * const prompt = fileInstruction('prompts/code-review.md');\n * ```\n */\nexport function fileInstruction(\n  path: string,\n  options?: Omit<InstructionConfig, 'source'>\n): Instruction {\n  return new Instruction({\n    ...options,\n    source: { type: 'file', path },\n  })\n}\n\n/**\n * Create an instruction from a named template\n *\n * @example\n * ```typescript\n * const prompt = templateInstruction('code-review', {\n *   language: 'typescript',\n *   focusAreas: ['security', 'performance']\n * });\n * ```\n */\nexport function templateInstruction(\n  name: string,\n  variables?: Record<string, unknown>,\n  options?: Omit<InstructionConfig, 'source'>\n): Instruction {\n  return new Instruction({\n    ...options,\n    source: { type: 'template', name, variables },\n  })\n}\n\n/**\n * Create a dynamic instruction that's generated at runtime\n *\n * @example\n * ```typescript\n * const dynamicPrompt = dynamicInstruction(async (ctx) => {\n *   const guidelines = await fetchGuidelines(ctx.input.projectId);\n *   return `Review code following these guidelines:\\n${guidelines}`;\n * });\n * ```\n */\nexport function dynamicInstruction(\n  generator: (context: InstructionContext) => string | Promise<string>,\n  options?: Omit<InstructionConfig, 'source'>\n): Instruction {\n  return new Instruction({\n    ...options,\n    source: { type: 'dynamic', generator },\n  })\n}\n\n/**\n * Create a conditional instruction\n *\n * @example\n * ```typescript\n * const securityPrompt = conditionalInstruction(\n *   'input.includeSecurityReview',\n *   'Pay special attention to security vulnerabilities.'\n * );\n * ```\n */\nexport function conditionalInstruction(\n  condition: string | ((context: InstructionContext) => boolean),\n  content: string,\n  options?: Omit<InstructionConfig, 'source' | 'when'>\n): Instruction {\n  return new Instruction({\n    ...options,\n    source: { type: 'inline', content },\n    when: condition,\n  })\n}\n\n/**\n * Combine multiple instructions into an ordered list\n *\n * @example\n * ```typescript\n * const instructions = combineInstructions([\n *   systemInstruction('You are an expert...'),\n *   conditionalInstruction('input.verbose', 'Be very detailed.'),\n *   fileInstruction('prompts/guidelines.md')\n * ]);\n * ```\n */\nexport function combineInstructions(instructions: Instruction[]): Instruction[] {\n  // Sort by priority (higher priority first)\n  return [...instructions].sort((a, b) => b.priority - a.priority)\n}\n\n/**\n * Create a prompt object for agent configuration\n *\n * @example\n * ```typescript\n * const agentPrompt = prompt({\n *   system: 'You are a helpful assistant.',\n *   user: 'Analyze the following data: ${input.data}',\n *   examples: [\n *     { user: 'Example input', assistant: 'Example output' }\n *   ]\n * });\n * ```\n */\nexport function prompt(config: {\n  system?: string | Instruction\n  user?: string | Instruction\n  examples?: Array<{ user: string; assistant: string }>\n  additional?: Instruction[]\n}): Instruction[] {\n  const instructions: Instruction[] = []\n\n  // Add system instruction\n  if (config.system) {\n    if (typeof config.system === 'string') {\n      instructions.push(systemInstruction(config.system, { priority: 100 }))\n    } else {\n      instructions.push(config.system)\n    }\n  }\n\n  // Add examples as few-shot prompts\n  if (config.examples) {\n    config.examples.forEach((example, index) => {\n      instructions.push(userInstruction(example.user, { priority: 50 - index }))\n      instructions.push(assistantInstruction(example.assistant, { priority: 50 - index }))\n    })\n  }\n\n  // Add user instruction\n  if (config.user) {\n    if (typeof config.user === 'string') {\n      instructions.push(userInstruction(config.user, { priority: 0 }))\n    } else {\n      instructions.push(config.user)\n    }\n  }\n\n  // Add any additional instructions\n  if (config.additional) {\n    instructions.push(...config.additional)\n  }\n\n  return combineInstructions(instructions)\n}\n\n/**\n * Check if a value is an Instruction instance\n */\nexport function isInstruction(value: unknown): value is Instruction {\n  return value instanceof Instruction\n}\n\n/**\n * Check if a value is a valid instruction config\n */\nexport function isInstructionConfig(value: unknown): value is InstructionConfig {\n  if (typeof value !== 'object' || value === null) {\n    return false\n  }\n  const config = value as Record<string, unknown>\n  return typeof config.source === 'object' && config.source !== null\n}\n","/**\n * Memory Primitives\n *\n * Provides primitives for PERSISTENT storage that survives across executions.\n * Memory is different from State:\n *\n * - **State** (StateManager): Workflow-scoped shared memory within a SINGLE\n *   ensemble execution. Use for passing data between steps. Declared with\n *   `state:` schema and accessed via `use:`/`set:`.\n *\n * - **Memory** (this module): Persistent storage that survives ACROSS multiple\n *   executions. Use for conversation history, knowledge bases, caching, and\n *   any data that should persist beyond a single workflow run.\n *\n * Memory providers map to Cloudflare storage:\n * - KV: Fast key-value for sessions, user preferences\n * - R2: Large objects like documents, images\n * - D1: Structured relational data\n * - Vectorize: Semantic search and RAG\n * - Durable Objects: Strongly consistent real-time state\n */\n\n/**\n * Memory provider types\n */\nexport type MemoryProviderType = 'kv' | 'r2' | 'd1' | 'vectorize' | 'durable-object' | 'custom'\n\n/**\n * Memory scope defines the visibility of memory\n */\nexport type MemoryScope = 'agent' | 'ensemble' | 'session' | 'global'\n\n/**\n * Memory entry with metadata\n */\nexport interface MemoryEntry<T = unknown> {\n  /** Unique key for this entry */\n  key: string\n  /** The stored value */\n  value: T\n  /** When the entry was created */\n  createdAt: Date\n  /** When the entry was last updated */\n  updatedAt: Date\n  /** Time-to-live in seconds */\n  ttl?: number\n  /** Custom metadata */\n  metadata?: Record<string, unknown>\n}\n\n/**\n * Vector memory entry for semantic search\n */\nexport interface VectorMemoryEntry extends MemoryEntry {\n  /** Vector embedding */\n  embedding?: number[]\n  /** Content for embedding generation */\n  content?: string\n  /** Similarity score (when returned from search) */\n  score?: number\n}\n\n/**\n * Memory provider configuration\n */\nexport interface MemoryProviderConfig {\n  /** Provider type */\n  type: MemoryProviderType\n  /** Binding name in wrangler.toml */\n  binding?: string\n  /** Namespace or table name */\n  namespace?: string\n  /** Custom configuration */\n  config?: Record<string, unknown>\n}\n\n/**\n * KV memory configuration\n */\nexport interface KVMemoryConfig extends MemoryProviderConfig {\n  type: 'kv'\n  /** KV namespace binding */\n  binding: string\n  /** Key prefix for namespacing */\n  prefix?: string\n  /** Default TTL in seconds */\n  defaultTTL?: number\n}\n\n/**\n * R2 memory configuration (for large objects)\n */\nexport interface R2MemoryConfig extends MemoryProviderConfig {\n  type: 'r2'\n  /** R2 bucket binding */\n  binding: string\n  /** Key prefix */\n  prefix?: string\n  /** Maximum object size in bytes */\n  maxSize?: number\n}\n\n/**\n * D1 memory configuration (structured data)\n */\nexport interface D1MemoryConfig extends MemoryProviderConfig {\n  type: 'd1'\n  /** D1 database binding */\n  binding: string\n  /** Table name */\n  table?: string\n  /** Auto-create table if not exists */\n  autoCreate?: boolean\n}\n\n/**\n * Vectorize memory configuration (semantic search)\n */\nexport interface VectorizeMemoryConfig extends MemoryProviderConfig {\n  type: 'vectorize'\n  /** Vectorize index binding */\n  binding: string\n  /** Embedding model to use */\n  model?: string\n  /** Dimensions of the embeddings */\n  dimensions?: number\n  /** Distance metric */\n  metric?: 'cosine' | 'euclidean' | 'dot-product'\n}\n\n/**\n * Durable Object memory configuration (strongly consistent)\n */\nexport interface DurableObjectMemoryConfig extends MemoryProviderConfig {\n  type: 'durable-object'\n  /** Durable Object namespace binding */\n  binding: string\n  /** ID generation strategy */\n  idStrategy?: 'hash' | 'random' | 'custom'\n}\n\n/**\n * Custom memory provider configuration\n */\nexport interface CustomMemoryConfig extends MemoryProviderConfig {\n  type: 'custom'\n  /** Custom handler path */\n  handler?: string\n  /** Custom implementation */\n  implementation?: MemoryImplementation\n}\n\n/**\n * Memory implementation interface for custom providers\n */\nexport interface MemoryImplementation {\n  get<T = unknown>(key: string): Promise<T | null>\n  set<T = unknown>(key: string, value: T, options?: { ttl?: number }): Promise<void>\n  delete(key: string): Promise<boolean>\n  list(options?: { prefix?: string; limit?: number }): Promise<string[]>\n  clear(prefix?: string): Promise<void>\n}\n\n/**\n * Union type for memory configurations\n */\nexport type MemoryConfig =\n  | KVMemoryConfig\n  | R2MemoryConfig\n  | D1MemoryConfig\n  | VectorizeMemoryConfig\n  | DurableObjectMemoryConfig\n  | CustomMemoryConfig\n\n/**\n * Memory configuration for an agent\n */\nexport interface AgentMemoryConfig {\n  /** Memory provider configuration */\n  provider: MemoryConfig\n  /** Memory scope */\n  scope?: MemoryScope\n  /** Maximum entries to store */\n  maxEntries?: number\n  /** Eviction policy when max is reached */\n  evictionPolicy?: 'lru' | 'fifo' | 'ttl'\n  /** Default TTL in seconds */\n  defaultTTL?: number\n  /** Enable automatic summarization */\n  summarize?: boolean\n  /** Summarization threshold (number of entries) */\n  summarizeThreshold?: number\n}\n\n/**\n * Memory class - runtime representation of memory configuration\n */\nexport class Memory {\n  public readonly provider: MemoryConfig\n  public readonly scope: MemoryScope\n  public readonly maxEntries?: number\n  public readonly evictionPolicy: 'lru' | 'fifo' | 'ttl'\n  public readonly defaultTTL?: number\n  public readonly summarize: boolean\n  public readonly summarizeThreshold: number\n\n  constructor(config: AgentMemoryConfig) {\n    this.provider = config.provider\n    this.scope = config.scope ?? 'agent'\n    this.maxEntries = config.maxEntries\n    this.evictionPolicy = config.evictionPolicy ?? 'lru'\n    this.defaultTTL = config.defaultTTL\n    this.summarize = config.summarize ?? false\n    this.summarizeThreshold = config.summarizeThreshold ?? 100\n  }\n\n  /**\n   * Check if using KV storage\n   */\n  isKV(): this is Memory & { provider: KVMemoryConfig } {\n    return this.provider.type === 'kv'\n  }\n\n  /**\n   * Check if using R2 storage\n   */\n  isR2(): this is Memory & { provider: R2MemoryConfig } {\n    return this.provider.type === 'r2'\n  }\n\n  /**\n   * Check if using D1 storage\n   */\n  isD1(): this is Memory & { provider: D1MemoryConfig } {\n    return this.provider.type === 'd1'\n  }\n\n  /**\n   * Check if using Vectorize\n   */\n  isVectorize(): this is Memory & { provider: VectorizeMemoryConfig } {\n    return this.provider.type === 'vectorize'\n  }\n\n  /**\n   * Check if using Durable Objects\n   */\n  isDurableObject(): this is Memory & { provider: DurableObjectMemoryConfig } {\n    return this.provider.type === 'durable-object'\n  }\n\n  /**\n   * Convert to plain config object\n   */\n  toConfig(): AgentMemoryConfig {\n    return {\n      provider: this.provider,\n      scope: this.scope,\n      maxEntries: this.maxEntries,\n      evictionPolicy: this.evictionPolicy,\n      defaultTTL: this.defaultTTL,\n      summarize: this.summarize,\n      summarizeThreshold: this.summarizeThreshold,\n    }\n  }\n}\n\n/**\n * Create a memory configuration\n *\n * @example\n * ```typescript\n * const agentMemory = memory({\n *   provider: { type: 'kv', binding: 'MEMORY_KV' },\n *   scope: 'session',\n *   defaultTTL: 3600\n * });\n * ```\n */\nexport function memory(config: AgentMemoryConfig): Memory {\n  return new Memory(config)\n}\n\n/**\n * Create KV-backed memory\n *\n * @example\n * ```typescript\n * const kvMemory = kvMemory({\n *   binding: 'AGENT_MEMORY',\n *   prefix: 'chat/',\n *   defaultTTL: 86400\n * });\n * ```\n */\nexport function kvMemory(\n  config: Omit<KVMemoryConfig, 'type'>,\n  options?: Omit<AgentMemoryConfig, 'provider'>\n): Memory {\n  return new Memory({\n    ...options,\n    provider: { type: 'kv', ...config },\n  })\n}\n\n/**\n * Create R2-backed memory for large objects\n *\n * @example\n * ```typescript\n * const objectMemory = r2Memory({\n *   binding: 'DOCUMENTS',\n *   prefix: 'uploads/',\n *   maxSize: 10 * 1024 * 1024 // 10MB\n * });\n * ```\n */\nexport function r2Memory(\n  config: Omit<R2MemoryConfig, 'type'>,\n  options?: Omit<AgentMemoryConfig, 'provider'>\n): Memory {\n  return new Memory({\n    ...options,\n    provider: { type: 'r2', ...config },\n  })\n}\n\n/**\n * Create D1-backed structured memory\n *\n * @example\n * ```typescript\n * const dbMemory = d1Memory({\n *   binding: 'DB',\n *   table: 'agent_memory',\n *   autoCreate: true\n * });\n * ```\n */\nexport function d1Memory(\n  config: Omit<D1MemoryConfig, 'type'>,\n  options?: Omit<AgentMemoryConfig, 'provider'>\n): Memory {\n  return new Memory({\n    ...options,\n    provider: { type: 'd1', ...config },\n  })\n}\n\n/**\n * Create Vectorize-backed semantic memory\n *\n * @example\n * ```typescript\n * const semanticMemory = vectorMemory({\n *   binding: 'KNOWLEDGE_BASE',\n *   model: '@cf/baai/bge-base-en-v1.5',\n *   dimensions: 768,\n *   metric: 'cosine'\n * });\n * ```\n */\nexport function vectorMemory(\n  config: Omit<VectorizeMemoryConfig, 'type'>,\n  options?: Omit<AgentMemoryConfig, 'provider'>\n): Memory {\n  return new Memory({\n    ...options,\n    provider: { type: 'vectorize', ...config },\n  })\n}\n\n/**\n * Create Durable Object-backed strongly consistent memory\n *\n * @example\n * ```typescript\n * const consistentMemory = durableMemory({\n *   binding: 'AGENT_STATE',\n *   idStrategy: 'hash'\n * });\n * ```\n */\nexport function durableMemory(\n  config: Omit<DurableObjectMemoryConfig, 'type'>,\n  options?: Omit<AgentMemoryConfig, 'provider'>\n): Memory {\n  return new Memory({\n    ...options,\n    provider: { type: 'durable-object', ...config },\n  })\n}\n\n/**\n * Create a custom memory provider\n *\n * @example\n * ```typescript\n * const redisMemory = customMemory({\n *   handler: 'memory/redis',\n *   config: { url: '${env.REDIS_URL}' }\n * });\n * ```\n */\nexport function customMemory(\n  config: Omit<CustomMemoryConfig, 'type'>,\n  options?: Omit<AgentMemoryConfig, 'provider'>\n): Memory {\n  return new Memory({\n    ...options,\n    provider: { type: 'custom', ...config },\n  })\n}\n\n/**\n * Check if a value is a Memory instance\n */\nexport function isMemory(value: unknown): value is Memory {\n  return value instanceof Memory\n}\n\n/**\n * Check if a value is a valid memory configuration\n */\nexport function isMemoryConfig(value: unknown): value is AgentMemoryConfig {\n  if (typeof value !== 'object' || value === null) {\n    return false\n  }\n  const config = value as Record<string, unknown>\n  return typeof config.provider === 'object' && config.provider !== null\n}\n\n/**\n * Conversation memory helper for chat-like interactions\n *\n * @example\n * ```typescript\n * const chatMemory = conversationMemory({\n *   binding: 'CHAT_HISTORY',\n *   maxMessages: 100,\n *   summarizeAfter: 50\n * });\n * ```\n */\nexport function conversationMemory(options: {\n  binding: string\n  maxMessages?: number\n  summarizeAfter?: number\n  ttl?: number\n}): Memory {\n  return kvMemory(\n    {\n      binding: options.binding,\n      prefix: 'conversation/',\n      defaultTTL: options.ttl,\n    },\n    {\n      scope: 'session',\n      maxEntries: options.maxMessages,\n      evictionPolicy: 'fifo',\n      summarize: options.summarizeAfter !== undefined,\n      summarizeThreshold: options.summarizeAfter,\n    }\n  )\n}\n\n/**\n * Knowledge base memory for RAG applications\n *\n * @example\n * ```typescript\n * const knowledge = knowledgeBase({\n *   vectorBinding: 'KNOWLEDGE_VECTORS',\n *   storageBinding: 'KNOWLEDGE_DOCS'\n * });\n * ```\n */\nexport function knowledgeBase(options: {\n  vectorBinding: string\n  storageBinding?: string\n  model?: string\n  dimensions?: number\n}): Memory {\n  return vectorMemory({\n    binding: options.vectorBinding,\n    model: options.model ?? '@cf/baai/bge-base-en-v1.5',\n    dimensions: options.dimensions ?? 768,\n    metric: 'cosine',\n  })\n}\n","/**\n * Reference Primitives\n *\n * Provides primitives for referencing values from state, input, environment,\n * and step results. References enable dynamic value resolution at runtime.\n */\n\n/**\n * Reference source types\n */\nexport type ReferenceSource = 'input' | 'state' | 'env' | 'steps' | 'context' | 'output'\n\n/**\n * Reference options\n */\nexport interface ReferenceOptions {\n  /** Default value if reference is undefined */\n  default?: unknown\n  /** Transform function to apply to the value */\n  transform?: (value: unknown) => unknown\n  /** Whether the reference is required */\n  required?: boolean\n  /** Type validation */\n  type?: 'string' | 'number' | 'boolean' | 'object' | 'array'\n}\n\n/**\n * Reference class - represents a dynamic value reference\n */\nexport class Reference {\n  public readonly source: ReferenceSource\n  public readonly path: string\n  public readonly defaultValue?: unknown\n  public readonly transform?: (value: unknown) => unknown\n  public readonly required: boolean\n  public readonly type?: 'string' | 'number' | 'boolean' | 'object' | 'array'\n\n  /** Internal marker for serialization */\n  public readonly __isReference = true\n\n  constructor(source: ReferenceSource, path: string, options?: ReferenceOptions) {\n    this.source = source\n    this.path = path\n    this.defaultValue = options?.default\n    this.transform = options?.transform\n    this.required = options?.required ?? false\n    this.type = options?.type\n  }\n\n  /**\n   * Get the full reference path (source.path)\n   */\n  getFullPath(): string {\n    return `${this.source}.${this.path}`\n  }\n\n  /**\n   * Convert to string expression for YAML/serialization\n   */\n  toExpression(): string {\n    return `\\${${this.getFullPath()}}`\n  }\n\n  /**\n   * Convert to plain config object\n   */\n  toConfig(): { ref: string; default?: unknown; required?: boolean; type?: string } {\n    const config: { ref: string; default?: unknown; required?: boolean; type?: string } = {\n      ref: this.getFullPath(),\n    }\n    if (this.defaultValue !== undefined) {\n      config.default = this.defaultValue\n    }\n    if (this.required) {\n      config.required = true\n    }\n    if (this.type) {\n      config.type = this.type\n    }\n    return config\n  }\n}\n\n/**\n * Create a reference to a value\n *\n * @example\n * ```typescript\n * // Reference input\n * const userId = ref('input.userId');\n *\n * // Reference state with default\n * const count = ref('state.counter', { default: 0 });\n *\n * // Reference step result\n * const analysis = ref('steps.analyze.result');\n *\n * // Reference environment variable\n * const apiKey = ref('env.API_KEY', { required: true });\n * ```\n */\nexport function ref(path: string, options?: ReferenceOptions): Reference {\n  // Parse the path to extract source\n  const parts = path.split('.')\n  const source = parts[0] as ReferenceSource\n  const restPath = parts.slice(1).join('.')\n\n  // Validate source\n  const validSources: ReferenceSource[] = ['input', 'state', 'env', 'steps', 'context', 'output']\n  if (!validSources.includes(source)) {\n    throw new Error(\n      `Invalid reference source: ${source}. Must be one of: ${validSources.join(', ')}`\n    )\n  }\n\n  return new Reference(source, restPath, options)\n}\n\n/**\n * Create a reference to input data\n *\n * @example\n * ```typescript\n * const query = inputRef('query');\n * const userId = inputRef('user.id', { required: true });\n * ```\n */\nexport function inputRef(path: string, options?: ReferenceOptions): Reference {\n  return new Reference('input', path, options)\n}\n\n/**\n * Create a reference to state data\n *\n * @example\n * ```typescript\n * const counter = stateRef('counter', { default: 0 });\n * const userData = stateRef('user', { type: 'object' });\n * ```\n */\nexport function stateRef(path: string, options?: ReferenceOptions): Reference {\n  return new Reference('state', path, options)\n}\n\n/**\n * Create a reference to environment variables\n *\n * @example\n * ```typescript\n * const apiKey = envRef('API_KEY', { required: true });\n * const debug = envRef('DEBUG', { default: 'false', type: 'boolean' });\n * ```\n */\nexport function envRef(path: string, options?: ReferenceOptions): Reference {\n  return new Reference('env', path, options)\n}\n\n/**\n * Create a reference to a step's result\n *\n * @example\n * ```typescript\n * const analysisResult = stepRef('analyze', 'result');\n * const fetchedData = stepRef('fetch-data', 'data.items');\n * ```\n */\nexport function stepRef(stepName: string, path?: string, options?: ReferenceOptions): Reference {\n  const fullPath = path ? `${stepName}.${path}` : stepName\n  return new Reference('steps', fullPath, options)\n}\n\n/**\n * Create a reference to the current context\n *\n * @example\n * ```typescript\n * const executionId = contextRef('executionId');\n * const timestamp = contextRef('timestamp');\n * ```\n */\nexport function contextRef(path: string, options?: ReferenceOptions): Reference {\n  return new Reference('context', path, options)\n}\n\n/**\n * Create a reference to the output being built\n *\n * @example\n * ```typescript\n * const currentOutput = outputRef('summary');\n * ```\n */\nexport function outputRef(path: string, options?: ReferenceOptions): Reference {\n  return new Reference('output', path, options)\n}\n\n/**\n * Check if a value is a Reference instance\n */\nexport function isReference(value: unknown): value is Reference {\n  return (\n    value instanceof Reference ||\n    (typeof value === 'object' && value !== null && '__isReference' in value)\n  )\n}\n\n/**\n * Create a computed value from multiple references\n *\n * @example\n * ```typescript\n * const fullName = computed(\n *   [inputRef('firstName'), inputRef('lastName')],\n *   ([first, last]) => `${first} ${last}`\n * );\n * ```\n */\nexport function computed(\n  refs: Reference[],\n  compute: (values: unknown[]) => unknown\n): { refs: Reference[]; compute: (values: unknown[]) => unknown; __isComputed: true } {\n  return {\n    refs,\n    compute,\n    __isComputed: true as const,\n  }\n}\n\n/**\n * Check if a value is a computed reference\n */\nexport function isComputed(\n  value: unknown\n): value is { refs: Reference[]; compute: (values: unknown[]) => unknown; __isComputed: true } {\n  return typeof value === 'object' && value !== null && '__isComputed' in value\n}\n\n/**\n * Template string helper for creating expressions with references\n *\n * @example\n * ```typescript\n * const greeting = template`Hello, ${inputRef('name')}! Your order ${stateRef('orderId')} is ready.`;\n * ```\n */\nexport function template(\n  strings: TemplateStringsArray,\n  ...values: (Reference | string | number)[]\n): { template: string; refs: Reference[]; __isTemplate: true } {\n  const refs: Reference[] = []\n  let result = strings[0]\n\n  values.forEach((value, i) => {\n    if (isReference(value)) {\n      refs.push(value)\n      result += value.toExpression()\n    } else {\n      result += String(value)\n    }\n    result += strings[i + 1]\n  })\n\n  return {\n    template: result,\n    refs,\n    __isTemplate: true as const,\n  }\n}\n\n/**\n * Check if a value is a template expression\n */\nexport function isTemplate(\n  value: unknown\n): value is { template: string; refs: Reference[]; __isTemplate: true } {\n  return typeof value === 'object' && value !== null && '__isTemplate' in value\n}\n\n/**\n * Parse a string expression into a Reference\n *\n * @example\n * ```typescript\n * const ref = parseRef('${input.userId}');\n * // Returns Reference { source: 'input', path: 'userId' }\n * ```\n */\nexport function parseRef(expression: string): Reference | null {\n  const match = expression.match(/^\\$\\{(.+)\\}$/)\n  if (!match) {\n    return null\n  }\n  try {\n    return ref(match[1])\n  } catch {\n    return null\n  }\n}\n\n/**\n * Check if a string looks like a reference expression\n */\nexport function isRefExpression(value: unknown): boolean {\n  return typeof value === 'string' && /^\\$\\{.+\\}$/.test(value)\n}\n\n/**\n * Utility to create a map of references\n *\n * @example\n * ```typescript\n * const refs = refMap({\n *   userId: 'input.userId',\n *   apiKey: 'env.API_KEY',\n *   previousResult: 'steps.analyze.result'\n * });\n * ```\n */\nexport function refMap(\n  paths: Record<string, string>,\n  defaultOptions?: ReferenceOptions\n): Record<string, Reference> {\n  const result: Record<string, Reference> = {}\n  for (const [key, path] of Object.entries(paths)) {\n    result[key] = ref(path, defaultOptions)\n  }\n  return result\n}\n","/**\n * Async Primitives\n *\n * Provides primitives for asynchronous execution patterns including\n * suspension, scheduling, delays, and human-in-the-loop (HITL) workflows.\n */\n\nimport type { FlowStepType } from './types.js'\n\n/**\n * Suspension reason types\n */\nexport type SuspensionReason =\n  | 'approval' // Waiting for human approval\n  | 'input' // Waiting for additional input\n  | 'external' // Waiting for external event\n  | 'scheduled' // Waiting for scheduled time\n  | 'manual' // Manual suspension\n\n/**\n * Suspension state\n */\nexport interface SuspensionState {\n  /** Unique suspension ID */\n  id: string\n  /** Reason for suspension */\n  reason: SuspensionReason\n  /** When the suspension was created */\n  createdAt: Date\n  /** When the suspension expires (optional) */\n  expiresAt?: Date\n  /** Data to preserve during suspension */\n  data?: Record<string, unknown>\n  /** Message describing what's needed to resume */\n  message?: string\n  /** URL or webhook for resume callback */\n  resumeUrl?: string\n  /** Allowed resume actions */\n  allowedActions?: string[]\n}\n\n/**\n * Sleep/delay configuration\n */\nexport interface SleepConfig {\n  /** Duration in milliseconds */\n  duration: number\n  /** Whether to use durable timer (survives restarts) */\n  durable?: boolean\n  /** Reason for the delay */\n  reason?: string\n}\n\n/**\n * Schedule configuration\n */\nexport interface ScheduleConfig {\n  /** ISO timestamp to resume at */\n  at?: string | Date\n  /** Cron expression for recurring */\n  cron?: string\n  /** Timezone for scheduling */\n  timezone?: string\n  /** Whether to use durable scheduling */\n  durable?: boolean\n}\n\n/**\n * Approval request configuration\n */\nexport interface ApprovalConfig {\n  /** Message to show to approver */\n  message: string\n  /** Who can approve (email, role, etc.) */\n  approvers?: string[]\n  /** Timeout for approval (in seconds) */\n  timeout?: number\n  /** Action on timeout */\n  timeoutAction?: 'approve' | 'reject' | 'fail'\n  /** Data to include in approval request */\n  data?: Record<string, unknown>\n  /** Allowed responses */\n  options?: Array<{\n    label: string\n    value: string\n    description?: string\n  }>\n}\n\n/**\n * Webhook wait configuration\n */\nexport interface WebhookWaitConfig {\n  /** Webhook path to listen on */\n  path?: string\n  /** Expected webhook event type */\n  event?: string\n  /** Timeout in seconds */\n  timeout?: number\n  /** Validation schema for webhook payload */\n  schema?: Record<string, unknown>\n  /** Secret for webhook verification */\n  secret?: string\n}\n\n/**\n * Suspend step configuration\n */\nexport interface SuspendStepConfig {\n  /** Step type marker */\n  type: 'suspend'\n  /** Suspension reason */\n  reason: SuspensionReason\n  /** Message for the suspension */\n  message?: string\n  /** Data to preserve */\n  data?: Record<string, unknown>\n  /** Timeout in seconds */\n  timeout?: number\n  /** Steps to execute on resume */\n  onResume?: FlowStepType[]\n  /** Steps to execute on timeout */\n  onTimeout?: FlowStepType[]\n}\n\n/**\n * Sleep step configuration\n */\nexport interface SleepStepConfig {\n  /** Step type marker */\n  type: 'sleep'\n  /** Duration in milliseconds */\n  duration: number\n  /** Whether to use durable timer */\n  durable?: boolean\n  /** Reason for the delay */\n  reason?: string\n}\n\n/**\n * Schedule step configuration\n */\nexport interface ScheduleStepConfig {\n  /** Step type marker */\n  type: 'schedule'\n  /** When to execute */\n  at?: string | Date\n  /** Cron expression */\n  cron?: string\n  /** Timezone */\n  timezone?: string\n  /** Steps to execute at scheduled time */\n  steps: FlowStepType[]\n}\n\n/**\n * Approval step configuration\n */\nexport interface ApprovalStepConfig {\n  /** Step type marker */\n  type: 'approval'\n  /** Approval configuration */\n  config: ApprovalConfig\n  /** Steps to execute on approval */\n  onApprove?: FlowStepType[]\n  /** Steps to execute on rejection */\n  onReject?: FlowStepType[]\n  /** Steps to execute on timeout */\n  onTimeout?: FlowStepType[]\n}\n\n/**\n * Create a suspend step that pauses execution\n *\n * @example\n * ```typescript\n * // Suspend for manual review\n * const reviewStep = suspend({\n *   reason: 'approval',\n *   message: 'Please review the generated content',\n *   timeout: 3600, // 1 hour\n *   onResume: [step('publish', { ... })]\n * });\n * ```\n */\nexport function suspend(config: {\n  reason: SuspensionReason\n  message?: string\n  data?: Record<string, unknown>\n  timeout?: number\n  onResume?: FlowStepType[]\n  onTimeout?: FlowStepType[]\n}): SuspendStepConfig {\n  return {\n    type: 'suspend',\n    reason: config.reason,\n    message: config.message,\n    data: config.data,\n    timeout: config.timeout,\n    onResume: config.onResume,\n    onTimeout: config.onTimeout,\n  }\n}\n\n/**\n * Create a sleep step that delays execution\n *\n * @example\n * ```typescript\n * // Wait 5 seconds\n * const waitStep = sleep(5000);\n *\n * // Wait with durable timer (survives restarts)\n * const durableWait = sleep(60000, { durable: true });\n * ```\n */\nexport function sleep(\n  duration: number,\n  options?: { durable?: boolean; reason?: string }\n): SleepStepConfig {\n  return {\n    type: 'sleep',\n    duration,\n    durable: options?.durable,\n    reason: options?.reason,\n  }\n}\n\n/**\n * Create a sleep step using seconds\n *\n * @example\n * ```typescript\n * const wait = sleepSeconds(30);\n * ```\n */\nexport function sleepSeconds(\n  seconds: number,\n  options?: { durable?: boolean; reason?: string }\n): SleepStepConfig {\n  return sleep(seconds * 1000, options)\n}\n\n/**\n * Create a sleep step using minutes\n *\n * @example\n * ```typescript\n * const wait = sleepMinutes(5);\n * ```\n */\nexport function sleepMinutes(\n  minutes: number,\n  options?: { durable?: boolean; reason?: string }\n): SleepStepConfig {\n  return sleep(minutes * 60 * 1000, options)\n}\n\n/**\n * Create a sleep step that waits until a specific time\n *\n * @example\n * ```typescript\n * // Wait until a specific timestamp\n * const waitUntil = sleepUntil(new Date('2024-12-25T00:00:00Z'));\n *\n * // Wait until an ISO string time\n * const waitUntilStr = sleepUntil('2024-12-25T00:00:00Z');\n * ```\n */\nexport function sleepUntil(\n  time: Date | string,\n  options?: { durable?: boolean; reason?: string }\n): SleepStepConfig {\n  const targetTime = typeof time === 'string' ? new Date(time) : time\n  const now = new Date()\n  const duration = Math.max(0, targetTime.getTime() - now.getTime())\n\n  return {\n    type: 'sleep',\n    duration,\n    durable: options?.durable ?? true, // Default to durable for absolute times\n    reason: options?.reason ?? `Waiting until ${targetTime.toISOString()}`,\n  }\n}\n\n/**\n * Create a scheduled execution step\n *\n * @example\n * ```typescript\n * // Execute at a specific time\n * const scheduledJob = schedule({\n *   at: '2024-12-25T00:00:00Z',\n *   steps: [step('send-notification', { ... })]\n * });\n *\n * // Execute on a cron schedule\n * const recurringJob = schedule({\n *   cron: '0 9 * * MON',\n *   timezone: 'America/New_York',\n *   steps: [step('weekly-report', { ... })]\n * });\n * ```\n */\nexport function schedule(config: {\n  at?: string | Date\n  cron?: string\n  timezone?: string\n  steps: FlowStepType[]\n}): ScheduleStepConfig {\n  return {\n    type: 'schedule',\n    at: config.at,\n    cron: config.cron,\n    timezone: config.timezone,\n    steps: config.steps,\n  }\n}\n\n/**\n * Create a human approval step\n *\n * @example\n * ```typescript\n * const approvalStep = approval({\n *   message: 'Approve deployment to production?',\n *   approvers: ['team-lead@example.com'],\n *   timeout: 7200, // 2 hours\n *   options: [\n *     { label: 'Approve', value: 'approve' },\n *     { label: 'Reject', value: 'reject' },\n *     { label: 'Defer', value: 'defer' }\n *   ],\n *   onApprove: [step('deploy', { ... })],\n *   onReject: [step('notify-rejection', { ... })]\n * });\n * ```\n */\nexport function approval(config: {\n  message: string\n  approvers?: string[]\n  timeout?: number\n  timeoutAction?: 'approve' | 'reject' | 'fail'\n  data?: Record<string, unknown>\n  options?: Array<{ label: string; value: string; description?: string }>\n  onApprove?: FlowStepType[]\n  onReject?: FlowStepType[]\n  onTimeout?: FlowStepType[]\n}): ApprovalStepConfig {\n  return {\n    type: 'approval',\n    config: {\n      message: config.message,\n      approvers: config.approvers,\n      timeout: config.timeout,\n      timeoutAction: config.timeoutAction,\n      data: config.data,\n      options: config.options,\n    },\n    onApprove: config.onApprove,\n    onReject: config.onReject,\n    onTimeout: config.onTimeout,\n  }\n}\n\n/**\n * Create a step that waits for a webhook event\n *\n * @example\n * ```typescript\n * const paymentStep = waitForWebhook({\n *   event: 'payment.completed',\n *   timeout: 3600,\n *   schema: {\n *     type: 'object',\n *     properties: {\n *       paymentId: { type: 'string' },\n *       amount: { type: 'number' }\n *     }\n *   },\n *   onReceive: [step('process-payment', { ... })]\n * });\n * ```\n */\nexport function waitForWebhook(config: {\n  path?: string\n  event?: string\n  timeout?: number\n  schema?: Record<string, unknown>\n  secret?: string\n  onReceive?: FlowStepType[]\n  onTimeout?: FlowStepType[]\n}): SuspendStepConfig {\n  return {\n    type: 'suspend',\n    reason: 'external',\n    message: `Waiting for webhook event: ${config.event ?? 'any'}`,\n    data: {\n      webhookConfig: {\n        path: config.path,\n        event: config.event,\n        schema: config.schema,\n        secret: config.secret,\n      },\n    },\n    timeout: config.timeout,\n    onResume: config.onReceive,\n    onTimeout: config.onTimeout,\n  }\n}\n\n/**\n * Create a step that waits for external input\n *\n * @example\n * ```typescript\n * const inputStep = waitForInput({\n *   message: 'Please provide additional information',\n *   fields: [\n *     { name: 'reason', type: 'string', required: true },\n *     { name: 'priority', type: 'number', default: 1 }\n *   ],\n *   timeout: 86400 // 24 hours\n * });\n * ```\n */\nexport function waitForInput(config: {\n  message: string\n  fields?: Array<{\n    name: string\n    type: 'string' | 'number' | 'boolean' | 'object'\n    required?: boolean\n    default?: unknown\n  }>\n  timeout?: number\n  onInput?: FlowStepType[]\n  onTimeout?: FlowStepType[]\n}): SuspendStepConfig {\n  return {\n    type: 'suspend',\n    reason: 'input',\n    message: config.message,\n    data: {\n      inputConfig: {\n        fields: config.fields,\n      },\n    },\n    timeout: config.timeout,\n    onResume: config.onInput,\n    onTimeout: config.onTimeout,\n  }\n}\n\n/**\n * Create a checkpoint that can be resumed from\n *\n * @example\n * ```typescript\n * const checkpoint = createCheckpoint({\n *   name: 'after-analysis',\n *   data: { analysisResult: stepRef('analyze', 'result') }\n * });\n * ```\n */\nexport function checkpoint(config: {\n  name: string\n  data?: Record<string, unknown>\n}): SuspendStepConfig {\n  return {\n    type: 'suspend',\n    reason: 'manual',\n    message: `Checkpoint: ${config.name}`,\n    data: {\n      checkpoint: config.name,\n      ...config.data,\n    },\n  }\n}\n\n/**\n * Type guards\n */\nexport function isSuspendStep(step: unknown): step is SuspendStepConfig {\n  return typeof step === 'object' && step !== null && (step as SuspendStepConfig).type === 'suspend'\n}\n\nexport function isSleepStep(step: unknown): step is SleepStepConfig {\n  return typeof step === 'object' && step !== null && (step as SleepStepConfig).type === 'sleep'\n}\n\nexport function isScheduleStep(step: unknown): step is ScheduleStepConfig {\n  return (\n    typeof step === 'object' && step !== null && (step as ScheduleStepConfig).type === 'schedule'\n  )\n}\n\nexport function isApprovalStep(step: unknown): step is ApprovalStepConfig {\n  return (\n    typeof step === 'object' && step !== null && (step as ApprovalStepConfig).type === 'approval'\n  )\n}\n\nexport function isAsyncStep(\n  step: unknown\n): step is SuspendStepConfig | SleepStepConfig | ScheduleStepConfig | ApprovalStepConfig {\n  return isSuspendStep(step) || isSleepStep(step) || isScheduleStep(step) || isApprovalStep(step)\n}\n","/**\n * @ensemble-edge/conductor\n *\n * Edge-native orchestration for AI agents\n * Built on Cloudflare Workers\n */\n\n// Core Runtime\nexport { Executor } from './runtime/executor.js'\nexport { Parser } from './runtime/parser.js'\nexport { StateManager } from './runtime/state-manager.js'\nexport {\n  GraphExecutor,\n  hasControlFlowSteps,\n  type AgentExecutorFn,\n  type GraphExecutionContext,\n  type GraphExecutionResult,\n} from './runtime/graph-executor.js'\nexport {\n  PluginRegistry,\n  getPluginRegistry,\n  // Backwards compatibility\n  OperationRegistry,\n  getOperationRegistry,\n  type OperationHandler,\n  type OperationContext,\n  type OperationConfig,\n  type OperationMetadata,\n} from './runtime/plugin-registry.js'\nexport {\n  TriggerRegistry,\n  getTriggerRegistry,\n  type TriggerHandler,\n  type TriggerHandlerContext,\n  type TriggerMetadata,\n} from './runtime/trigger-registry.js'\n\nexport {\n  HttpMiddlewareRegistry,\n  getHttpMiddlewareRegistry,\n  type HttpMiddlewareMetadata,\n} from './runtime/http-middleware-registry.js'\n\n// Observability\nexport { createLogger } from './observability/index.js'\n\n// Durable Objects\n// These are available via '@ensemble-edge/conductor/cloudflare' to avoid\n// importing cloudflare: protocol modules in non-Cloudflare environments.\n// See: src/cloudflare.ts for Cloudflare-specific exports\n\n// Agent Types\nexport { BaseAgent } from './agents/base-agent.js'\nexport { FunctionAgent } from './agents/function-agent.js'\nexport { ThinkAgent } from './agents/think-agent.js'\nexport { DataAgent } from './agents/data-agent.js'\nexport { APIAgent } from './agents/api-agent.js'\n// Utilities\nexport { MemberLoader, createLoader } from './utils/loader.js'\nexport { EnsembleLoader, createEnsembleLoader } from './utils/ensemble-loader.js'\n// export { CacheManager } from './utils/cache.js';\n// export { Normalizer } from './utils/normalize.js';\n\n// API Layer\n// export { Router } from './api/router.js';\n// export { createHandler } from './api/handlers.js';\n// export { authenticate } from './api/auth.js';\n\n// Authentication Module\nexport * from './auth/index.js'\n\n// Routing Module\nexport { UnifiedRouter } from './routing/router.js'\nexport type {\n  ConductorConfig,\n  RoutingConfig,\n  RouteConfig,\n  RouteAuthConfig as RoutingAuthConfig,\n  ResolvedRouteAuthConfig,\n  RouteMatch,\n  Operation,\n  AuthDefaults,\n  RateLimitConfig as RoutingRateLimitConfig,\n  AuthFailureAction,\n} from './routing/config.js'\n\n// Config Module (full config type for conductor.config.ts)\nexport type { ConductorConfig as FullConductorConfig } from './config/types.js'\n\n// Types\nexport type {\n  EnsembleConfig,\n  AgentConfig,\n  FlowStep,\n  ExposeConfig,\n  NotificationConfig,\n  ScheduleConfig,\n  BuildTriggerConfig,\n  CLITriggerConfig,\n} from './runtime/parser.js'\n\n// Build and CLI Managers\nexport { BuildManager, getBuildManager, resetBuildManager } from './runtime/build-manager.js'\nexport type { BuildExecutionResult } from './runtime/build-manager.js'\n\nexport { CLIManager, getCLIManager, resetCLIManager } from './runtime/cli-manager.js'\nexport type { CLICommandMetadata, CLIExecutionResult, CLIOption } from './runtime/cli-manager.js'\n\nexport type {\n  StateConfig,\n  MemberStateConfig,\n  StateContext,\n  AccessReport,\n} from './runtime/state-manager.js'\n\nexport type { AgentExecutionContext, AgentResponse } from './agents/base-agent.js'\n\nexport type { ExecutorConfig, ExecutionResult, ExecutionMetrics } from './runtime/executor.js'\n\n// Branded Types - Type-safe identifiers for domain concepts\n// Exports both type definitions and factory functions (same name by design)\nexport {\n  ModelId,\n  AgentName,\n  EnsembleName,\n  ProviderId,\n  PlatformName,\n  BindingName,\n  VersionString,\n  ExecutionId,\n  RequestId,\n  ResumeToken,\n  CacheKey,\n} from './types/branded.js'\nexport type { Brand } from './types/branded.js'\n\nexport type {\n  ExecutionStatus,\n  StoredExecutionState,\n  ExecutionProgressEvent,\n  ExecutionCompletionEvent,\n  ExecutionEvent,\n} from './durable-objects/execution-state.js'\n\nexport type { HITLStatus, StoredHITLState, HITLEvent } from './durable-objects/hitl-state.js'\n\n// Plugin System\nexport type {\n  ConductorPlugin,\n  FunctionalPlugin,\n  LifecyclePlugin,\n  ConductorConfig as PluginConductorConfig,\n  PluginContext,\n  PluginLogger,\n  OperationRegistration,\n  MiddlewareRegistration,\n  AgentRegistration,\n  AuthValidatorRegistration,\n  AuthValidationResult,\n  PluginDependency,\n  PluginMetadata,\n} from './types/plugin.js'\nexport { isLifecyclePlugin, isFunctionalPlugin, buildPlugin } from './types/plugin.js'\n\n// Docs - First-class component support for markdown documentation\nexport { DocsManager, getGlobalDocsManager } from './docs/index.js'\nexport type {\n  DocsTemplate,\n  DocsManagerConfig,\n  RenderOptions as DocsRenderOptions,\n  RenderedDocs,\n} from './docs/index.js'\n\n// ============================================================================\n// Primitives - TypeScript-first authoring for agents and ensembles\n// ============================================================================\n// The canonical building blocks used by both YAML and TypeScript authoring.\n// Both formats produce identical runtime objects through these primitives.\n\n// Step Primitives\nexport {\n  step,\n  sequence,\n  scriptStep,\n  httpStep,\n  thinkStep,\n  storageStep,\n  dataStep,\n  emailStep,\n  agentStep,\n} from './primitives/step.js'\n\n// Flow Control Primitives\nexport {\n  parallel,\n  race,\n  branch,\n  ifThen,\n  ifThenElse,\n  switchStep,\n  foreach,\n  map,\n  repeat,\n  whileStep,\n  doWhile,\n  doUntil,\n  tryStep,\n  fallback,\n  mapReduce,\n} from './primitives/flow.js'\n\n// Ensemble Primitives\nexport { createEnsemble, Ensemble, isEnsemble, ensembleFromConfig } from './primitives/ensemble.js'\n\n// Tool Primitives\nexport {\n  createTool,\n  mcpTool,\n  customTool,\n  httpTool,\n  skillTool,\n  toolCollection,\n  Tool,\n  isTool,\n  isToolConfig,\n} from './primitives/tool.js'\n\n// Instruction Primitives\nexport {\n  instruction,\n  systemInstruction,\n  userInstruction,\n  assistantInstruction,\n  fileInstruction,\n  templateInstruction,\n  dynamicInstruction,\n  conditionalInstruction,\n  combineInstructions,\n  prompt,\n  Instruction,\n  isInstruction,\n  isInstructionConfig,\n} from './primitives/instruction.js'\n\n// Memory Primitives (persistent storage - NOT workflow state)\nexport {\n  memory,\n  kvMemory,\n  r2Memory,\n  d1Memory,\n  vectorMemory,\n  durableMemory,\n  customMemory,\n  conversationMemory,\n  knowledgeBase,\n  Memory,\n  isMemory,\n  isMemoryConfig,\n} from './primitives/memory.js'\n\n// Reference Primitives\nexport {\n  ref,\n  inputRef,\n  stateRef,\n  envRef,\n  stepRef,\n  contextRef,\n  outputRef,\n  computed,\n  template,\n  parseRef,\n  refMap,\n  Reference,\n  isReference,\n  isComputed,\n  isTemplate,\n  isRefExpression,\n} from './primitives/reference.js'\n\n// Async Primitives (suspension, scheduling, HITL)\nexport {\n  suspend,\n  checkpoint,\n  sleep,\n  sleepSeconds,\n  sleepMinutes,\n  sleepUntil,\n  schedule,\n  approval,\n  waitForWebhook,\n  waitForInput,\n  isSuspendStep,\n  isSleepStep,\n  isScheduleStep,\n  isApprovalStep,\n  isAsyncStep,\n} from './primitives/async.js'\n\n// Type Guards from primitives\nexport {\n  isParallelStep,\n  isAgentStep,\n  isBranchStep,\n  isForeachStep,\n  isTryStep,\n  isSwitchStep,\n  isWhileStep,\n  isMapReduceStep,\n  isFlowControlStep,\n  isControlFlowStep,\n} from './primitives/types.js'\n\n// Primitive Types\nexport type {\n  // Context\n  Context,\n  // Flow step types\n  FlowStepType,\n  AgentFlowStep,\n  ParallelFlowStep,\n  BranchFlowStep,\n  ForeachFlowStep,\n  TryFlowStep,\n  SwitchFlowStep,\n  WhileFlowStep,\n  MapReduceFlowStep,\n  // Configuration types\n  StepOptions,\n  AgentSchemaConfig,\n  EnsembleHooks,\n  OutputConfig,\n  // Option types for flow control\n  ParallelOptions,\n  BranchOptions,\n  ForeachOptions,\n  TryOptions,\n  WhileOptions,\n  MapReduceOptions,\n} from './primitives/types.js'\n\nexport type {\n  EnsembleOptions,\n  EnsembleConfig as PrimitiveEnsembleConfig,\n  TriggerConfig,\n  WebhookTrigger,\n  HttpTrigger,\n  McpTrigger,\n  EmailTrigger,\n  QueueTrigger,\n  CronTrigger,\n  NotificationConfig as PrimitiveNotificationConfig,\n  WebhookNotification,\n  EmailNotification,\n  ScoringConfig,\n  InlineAgentConfig,\n} from './primitives/ensemble.js'\n\nexport type {\n  ToolConfig,\n  ToolDefinition,\n  ToolParameter,\n  ToolCollection,\n  MCPServerConfig,\n  CustomToolConfig,\n  HTTPToolConfig,\n  SkillToolConfig,\n} from './primitives/tool.js'\n\nexport type {\n  InstructionConfig,\n  InstructionSource,\n  InstructionContext,\n} from './primitives/instruction.js'\n\nexport type {\n  MemoryConfig as PrimitiveMemoryConfig,\n  AgentMemoryConfig,\n  MemoryProviderType,\n  MemoryScope,\n  MemoryEntry,\n  VectorMemoryEntry,\n  KVMemoryConfig,\n  R2MemoryConfig,\n  D1MemoryConfig,\n  VectorizeMemoryConfig,\n  DurableObjectMemoryConfig,\n  CustomMemoryConfig,\n  MemoryImplementation,\n} from './primitives/memory.js'\n\nexport type { ReferenceSource, ReferenceOptions } from './primitives/reference.js'\n\nexport type {\n  SuspensionReason,\n  SuspensionState,\n  SleepConfig,\n  ScheduleConfig as AsyncScheduleConfig,\n  ApprovalConfig,\n  WebhookWaitConfig,\n  SuspendStepConfig,\n  SleepStepConfig,\n  ScheduleStepConfig,\n  ApprovalStepConfig,\n} from './primitives/async.js'\n\n/**\n * Create a Cloudflare Worker handler with Conductor\n *\n * @example\n * ```typescript\n * import { createConductorHandler } from '@ensemble-edge/conductor';\n *\n * export default createConductorHandler({\n *   membersDir: './agents',\n *   ensemblesDir: './ensembles'\n * });\n * ```\n */\nexport function createConductorHandler(config?: {\n  membersDir?: string\n  ensemblesDir?: string\n}): ExportedHandler<Env> {\n  return {\n    async fetch(request: Request, env: Env, ctx: ExecutionContext): Promise<Response> {\n      // This will be implemented after we build the router and loader\n      return new Response('Conductor initialized - handler implementation coming soon', {\n        headers: { 'content-type': 'text/plain' },\n      })\n    },\n  }\n}\n"],"names":["SCALAR","tags","isValid","tag","ref","res","map","schema","node","split","i","end","isBlock","limit","json","stringify","value","comment","str","sum","seq","format","floatNaN","floatExp","float","intIdentify","intResolve","offset","intStringify","intOct","int","intHex","pairs","omap","n","set","year","day","hour","minute","date","schema$2","merge","message","last","search","composeNode","composeEmptyNode","sep","isMap","CN","first","raw","range","isEmpty","ch","start","fs","Parser","util","objectUtil","defaultErrorMap","errorUtil","errorMap","ctx","step","result","issues","schemas","elements","size","processed","ZodFirstPartyTypeKind","filters","filter","template","Operation","AIProvider","StorageType","DatabaseType","z.enum","z.object","z.string","z.union","z.literal","z.number","z.record","z.unknown","z.array","LogLevel","LogLevelEnum","logger","z.boolean","z.lazy","z.discriminatedUnion","z.function","YAML.parse","z.ZodError","isAgentStep","encoder","isObject","__assign","resolve","reject","trimLeft","trimRight","cache","token","visit","variables","LookupType","tokens","TokenKind","BlockMode","concat","collection","branch","templates","emitter","self","exportResult","emailRegex","this","module","exports","objectType","escape","escapeChar","toString","isFunction","isArray","string","global","has","Symbol","hasOwnProperty","ceil","floor","options","ret","context","wrapper","Handlebars.create","isFilePath","url","timestamp","fallback","registry","latestScores","isTruthy","memory","agent","binary","decodeBase64URL","jwk.isJWK","jwk.isSecretJWK","invalidKeyInput","jwk.isPrivateJWK","jwk.isPublicJWK","b64u","jwk","jwksCache","jose.createRemoteJWKSet","jose.jwtVerify","createUnkeyValidator","unknownType","unkey","agentStep","prompt","defaultOptions"],"mappings":"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","x_google_ignoreList":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,106,125,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199]}